/*! For license information please see officebrowserfeedback_floodgate_bare.min.js.LICENSE.txt */
!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=68)}([function(t,e,n){"use strict";n.d(e,"h",(function(){return i})),n.d(e,"j",(function(){return o})),n.d(e,"i",(function(){return a})),n.d(e,"f",(function(){return d})),n.d(e,"e",(function(){return g})),n.d(e,"g",(function(){return h})),n.d(e,"c",(function(){return f})),n.d(e,"b",(function(){return v})),n.d(e,"d",(function(){return y})),n.d(e,"a",(function(){return m}));var r=n(2),i=r.Utils.guid,o=r.Utils.overrideValues,a=r.Utils.isNOU,s=r.Utils.isBoolean,u=r.Utils.isString,c=r.Utils.isObject,l=r.Utils.isEnumValue;function p(t){return"number"==typeof t}function d(t,e){if(!c(t))throw e+" is not an object: "+t}function g(t,e){if(!p(t))throw e+" is not a number: "+t}function h(t,e){if(!u(t))throw e+" is not a string: "+t}function f(t,e){if(!s(t))throw e+" is not a boolean: "+t}function v(t,e){if(!Array.isArray(t))throw e+" is not an array: "+t}function y(t,e,n){if(!p(t)||!l(t,e))throw n+" is not an enum: "+t}function m(t,e){var n=new Promise((function(e,n){var r=setTimeout((function(){clearTimeout(r),n("Timed out in "+t+"ms.")}),t)}));return Promise.race([e,n])}},function(t,e,n){"use strict";n.d(e,"get",(function(){return s}));var r=n(0),i=(n(5),n(32)),o=n(4);n.d(e,"AgeGroup",(function(){return o.a})),n.d(e,"AuthenticationType",(function(){return o.b}));n(31);var a=new(function(){function t(){this.feedbackSubmitted=!1}return t.validateCategoryOptions=function(t){if(!t)return{show:!1};if(r.c(t.show,"categories.show"),t.customCategories){r.b(t.customCategories,"categories.customCategories");for(var e=0,n=t.customCategories;e<n.length;e++){var i=n[e];if(r.g(i,"custom category '"+i+"'"),i.length>20)throw"custom category '"+i+"' too long, max 20 characters."}}return t},t.prototype.getFeedbackSubmitted=function(){return this.feedbackSubmitted},t.prototype.setFeedbackSubmitted=function(t){this.feedbackSubmitted=t},t.prototype.getCommonInitOptions=function(){return this.commonInitOptions},t.prototype.getInAppFeedbackInitOptions=function(){return this.inAppFeedbackInitOptions},t.prototype.getInAppFeedbackLaunchOptions=function(){return this.inAppFeedbackLaunchOptions},t.prototype.getFloodgateInitOptions=function(){return this.floodgateInitOptions},t.prototype.getFloodgateSurvey=function(){return this.floodgateSurvey},t.prototype.getSdkSessionId=function(){return this.sdkSessionId||(this.sdkSessionId=r.h()),this.sdkSessionId},t.prototype.getEventSampling=function(){return this.eventSampling},t.prototype.setCommonInitOptions=function(t){r.f(t,"passedInitOptions");var e={appId:t.appId,applicationGroup:t.applicationGroup||{},build:t.build,cid:t.cid,environment:t.environment,intlFilename:t.intlFilename,intlUrl:t.intlUrl,webSurfacesResourceBaseUrl:t.webSurfacesResourceBaseUrl,locale:t.locale,onError:t.onError,originalLocale:t.locale,primaryColour:t.primaryColour,secondaryColour:t.secondaryColour,sessionId:t.sessionId,stylesUrl:t.stylesUrl,telemetryGroup:t.telemetryGroup||{},userEmail:t.userEmail,webGroup:t.webGroup||{},eventSampling:t.eventSampling,petrolTimeout:t.petrolTimeout,isCommercialHost:t.isCommercialHost,customResourcesSetExternally:t.customResourcesSetExternally,emailPolicyValue:t.emailPolicyValue,screenshotPolicyValue:t.screenshotPolicyValue,ageGroup:t.ageGroup,authenticationType:t.authenticationType,applicationSettings:t.applicationSettings,webSurfacesSettings:t.webSurfacesSettings};if(r.e(e.appId,"initOptions.appId"),!(e.appId%1==0&&e.appId>0))throw"initOptions.appId is not a positive integer: "+e.appId;var n=o.c.Strings|o.c.Css;if(void 0===e.customResourcesSetExternally)e.customResourcesSetExternally=o.c.None;else if("number"!=typeof e.customResourcesSetExternally||(e.customResourcesSetExternally|n)!==n)throw"initOptions.customResourcesSetExternally has an invalid value: "+e.customResourcesSetExternally;if((e.customResourcesSetExternally&o.c.Css)!==o.c.Css&&r.g(e.stylesUrl,"initOptions.stylesUrl"),(e.customResourcesSetExternally&o.c.Strings)!==o.c.Strings&&r.g(e.intlUrl,"initOptions.intlUrl"),void 0!==e.intlFilename?r.g(e.intlFilename,"initOptions.intlFilename"):e.intlFilename="officebrowserfeedbackstrings.js",r.e(e.environment,"initOptions.environment"),1!==e.environment&&0!==e.environment)throw"initOptions.environment has a bad value: "+e.environment;if(void 0!==e.userEmail?r.g(e.userEmail,"initOptions.userEmail"):e.userEmail="",void 0!==e.sessionId?r.g(e.sessionId,"initOptions.sessionId"):e.sessionId="00000000-0000-0000-0000-000000000000",e.telemetryGroup.processSessionId=e.sessionId,void 0!==e.cid&&(r.g(e.cid,"initOptions.cid"),e.applicationGroup.extendedManifestData=JSON.stringify({cid:e.cid})),void 0!==e.build){r.g(e.build,"initOptions.build");new RegExp("^[0-9]{1,9}(\\.[0-9]{1,9})?(\\.[0-9]{1,9})?(\\.[0-9]{1,9})?$").test(e.build)||(e.build="0.0.0.0")}else e.build="0.0.0.0";e.telemetryGroup.officeBuild=e.build;var a=new RegExp("^#[0-9a-f]{3}([0-9a-f]{3})?$","i");if(void 0!==e.primaryColour&&(a.test(e.primaryColour)||(e.primaryColour=void 0)),void 0!==e.secondaryColour&&(a.test(e.secondaryColour)||(e.secondaryColour=void 0)),void 0!==e.locale?(r.g(e.locale,"initOptions.locale"),e.locale=i.a(e.locale)):e.locale="en",void 0===e.onError&&(e.onError=function(t){}),void 0!==e.petrolTimeout&&r.e(e.petrolTimeout,"initOptions.petrolTimeout"),void 0!==e.authenticationType?r.d(e.authenticationType,o.b,"initOptions.authenticationType"):e.authenticationType=o.b.Unauthenticated,void 0!==e.ageGroup?r.d(e.ageGroup,o.a,"initOptions.ageGroup"):e.ageGroup=o.a.Undefined,this.eventSampling=this.parseEventSamplingOption(e.eventSampling),this.commonInitOptions=e,this.commonPolicyAllowAADC=this.determineAADCPolicy(e.authenticationType,e.ageGroup),void 0===e.isCommercialHost||null==e.isCommercialHost?e.isCommercialHost=!1:r.c(e.isCommercialHost,"initOptions.isCommercialHost"),void 0===e.emailPolicyValue)e.emailPolicyValue=0;else if("number"!=typeof e.emailPolicyValue||0!==e.emailPolicyValue&&1!==e.emailPolicyValue&&2!==e.emailPolicyValue)throw"initOptions.emailPolicyValue has an invalid value: "+e.emailPolicyValue;if(void 0===e.screenshotPolicyValue)e.screenshotPolicyValue=0;else if("number"!=typeof e.screenshotPolicyValue||0!==e.screenshotPolicyValue&&1!==e.screenshotPolicyValue&&2!==e.screenshotPolicyValue)throw"initOptions.screenshotPolicyValue has an invalid value: "+e.screenshotPolicyValue},t.prototype.setInAppFeedbackInitOptions=function(t){r.f(t,"passedInitOptions");var e={bugForm:t.bugForm,onDismiss:t.onDismiss,screenshot:t.screenshot,showEmailAddress:t.showEmailAddress,userEmail:t.userEmail,transitionEnabled:t.transitionEnabled,isShowThanks:t.isShowThanks,sendFeedbackPolicyValue:t.sendFeedbackPolicyValue,feedbackForumUrl:void 0!==t.feedbackForumUrl?t.feedbackForumUrl:void 0,myFeedbackForumUrl:void 0!==t.myFeedbackForumUrl?t.myFeedbackForumUrl:void 0};if(void 0===e.onDismiss&&(e.onDismiss=function(t){}),void 0!==e.bugForm?r.c(e.bugForm,"initOptions.bugForm"):e.bugForm=!1,void 0!==e.userEmail&&r.g(e.userEmail,"initOptions.userEmail"),void 0!==e.screenshot?r.c(e.screenshot,"initOptions.screenshot"):e.screenshot=!0,void 0!==e.showEmailAddress?r.c(e.showEmailAddress,"initOptions.showEmailAddress"):e.showEmailAddress=!0,void 0!==e.feedbackForumUrl?r.g(e.feedbackForumUrl,"initOptions.feedbackForumUrl"):e.feedbackForumUrl=void 0,void 0!==e.isShowThanks?r.c(e.isShowThanks,"initOptions.isShowThanks"):e.isShowThanks=!0,void 0!==e.myFeedbackForumUrl?r.g(e.myFeedbackForumUrl,"initOptions.myFeedbackForumUrl"):e.myFeedbackForumUrl=void 0,void 0===e.transitionEnabled&&(e.transitionEnabled=!0),void 0===e.sendFeedbackPolicyValue)e.sendFeedbackPolicyValue=0;else if("number"!=typeof e.sendFeedbackPolicyValue||0!==e.sendFeedbackPolicyValue&&1!==e.sendFeedbackPolicyValue&&2!==e.sendFeedbackPolicyValue)throw"initOptions.sendFeedbackPolicyValue has an invalid value: "+e.sendFeedbackPolicyValue;this.inAppFeedbackInitOptions=e},t.prototype.setInAppFeedbackLaunchOptions=function(e){if(!this.commonInitOptions)throw"commonInitOptions not set";e||(e={}),this.commonInitOptions.applicationGroup=r.j(e.applicationGroup,this.commonInitOptions.applicationGroup),this.commonInitOptions.telemetryGroup=r.j(e.telemetryGroup,this.commonInitOptions.telemetryGroup),this.commonInitOptions.webGroup=r.j(e.webGroup,this.commonInitOptions.webGroup),e.categories=t.validateCategoryOptions(e.categories),this.inAppFeedbackLaunchOptions=e},t.prototype.setFloodgateInitOptions=function(t){r.f(t,"passedInitOptions");var e={autoDismiss:t.autoDismiss,campaignDefinitions:t.campaignDefinitions,campaignFlights:t.campaignFlights,campaignQueryParameters:t.campaignQueryParameters,onDismiss:t.onDismiss,onSurveyActivatedCallback:t.onSurveyActivatedCallback,settingStorageCallback:t.settingStorageCallback,uIStringGetter:t.uIStringGetter,authTokenCallback:t.authTokenCallback,surveyEnabled:t.surveyEnabled,showEmailAddress:t.showEmailAddress,augLoopCallback:t.augLoopCallback,customerVoiceSurveyParams:t.customerVoiceSurveyParams,governanceServiceEnabled:t.governanceServiceEnabled,governanceServiceConfig:t.governanceServiceConfig,personalizerEnabled:t.personalizerEnabled,messagingServiceSettings:t.messagingServiceSettings};if(void 0===e.autoDismiss&&(e.autoDismiss=0),void 0===e.onDismiss&&(e.onDismiss=function(t,e){}),void 0===e.onSurveyActivatedCallback){e.onSurveyActivatedCallback={onSurveyActivated:function(t,e,n){t.launch()}}}void 0===e.uIStringGetter&&(e.uIStringGetter=function(t){return t}),void 0===e.surveyEnabled?e.surveyEnabled=!0:r.c(e.surveyEnabled,"surveyEnabled"),void 0!==e.showEmailAddress?r.c(e.showEmailAddress,"initOptionsFloodgate.showEmailAddress"):e.showEmailAddress=!0,void 0!==e.governanceServiceEnabled?r.c(e.governanceServiceEnabled,"initOptionsFloodgate.governanceServiceEnable"):e.governanceServiceEnabled=!1,e.governanceServiceEnabled&&(e.governanceServiceConfig=this.parseGovernanceServiceConfig(void 0!==e.governanceServiceConfig?e.governanceServiceConfig:{})),void 0===e.customerVoiceSurveyParams&&(e.customerVoiceSurveyParams={cvFlights:"",isCVSurveyEnabled:!1,productName:"",uiHost:""}),void 0!==e.personalizerEnabled?r.c(e.personalizerEnabled,"initOptionsFloodgate.personalizerEnabled"):e.personalizerEnabled=!1,this.floodgateInitOptions=e},t.prototype.setFloodgateSurvey=function(t){this.floodgateSurvey=t},t.prototype.checkIfSurveysEnabled=function(){return(!this.floodgateInitOptions||this.floodgateInitOptions.surveyEnabled)&&this.commonPolicyAllowAADC},t.prototype.isFeedbackSurveyEnabledByAADC=function(){return this.commonPolicyAllowAADC},t.prototype.getCVSurveyFlights=function(){return this.floodgateInitOptions&&this.floodgateInitOptions.customerVoiceSurveyParams?this.floodgateInitOptions.customerVoiceSurveyParams.cvFlights:""},t.prototype.isCVSurveyEnabled=function(){return!(!this.floodgateInitOptions||!this.floodgateInitOptions.customerVoiceSurveyParams)&&this.floodgateInitOptions.customerVoiceSurveyParams.isCVSurveyEnabled},t.prototype.getProductName=function(){return this.floodgateInitOptions&&this.floodgateInitOptions.customerVoiceSurveyParams?this.floodgateInitOptions.customerVoiceSurveyParams.productName:""},t.prototype.getUIHost=function(){return this.floodgateInitOptions&&this.floodgateInitOptions.customerVoiceSurveyParams?this.floodgateInitOptions.customerVoiceSurveyParams.uiHost:""},t.prototype.determineAADCPolicy=function(t,e){return t===o.b.Unauthenticated||t===o.b.AAD||e!==o.a.MinorWithParentalConsent&&e!==o.a.MinorWithoutParentalConsent},t.prototype.getUserConsentGroup=function(){var t=this.commonInitOptions.authenticationType;if(t===o.b.Unauthenticated||t===o.b.AAD)return 1;switch(this.commonInitOptions.ageGroup){case o.a.Undefined:return 1;case o.a.MinorWithoutParentalConsent:case o.a.MinorWithParentalConsent:return 3;case o.a.Adult:return 1;case o.a.NotAdult:return 2;case o.a.MinorNoParentalConsentRequired:return 1;default:return 3}return 3},t.prototype.parseEventSamplingOption=function(t){var e={event:{}};if(void 0!==t)for(var n in t)if(t.hasOwnProperty(n))switch(t[n].type){case"Event":var i=t[n].sampleRate;if(r.e(i,"initOption.EventSampling.SampleRate"),r.g(t[n].name,"initOption.EventSampling.Name"),i<0||i>1)throw"initOption.EventSampling."+t[n].name+".SampleRate is out of range";e.event[t[n].name]=i;break;default:throw"initOption.EventSampling.Type value is not recognized"}return e},t.prototype.parseGovernanceServiceConfig=function(t){var e,n,r,i;return{forceServicelessSurveyDisplay:null!==(e=t.forceServicelessSurveyDisplay)&&void 0!==e&&e,retry:null!==(n=t.retry)&&void 0!==n?n:1,timeout:null!==(r=t.timeout)&&void 0!==r?r:1e3,simpleRequestEnabled:null!==(i=t.simpleRequestEnabled)&&void 0!==i&&i}},t}());function s(){return a}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=e.Api=void 0;var r=n(7);e.Api=r;var i=n(3);e.Utils=i;var o=n(12);Object.defineProperty(e,"FloodgateEngine",{enumerable:!0,get:function(){return o.FloodgateEngine}})},function(t,e,n){"use strict";function r(t){return"[object Date]"===Object.prototype.toString.call(t)&&!isNaN(t.getTime())}function i(t){return null==t}function o(t){return"string"==typeof t}function a(t,n){if(!t)return null;if(n<0)return n=-n,this.addSecondsWithoutOverflow(t,n);var r=t.getTime()-1e3*n;return r>e.MIN_DATE_MILLISECONDS?new Date(r):new Date(e.MIN_DATE_MILLISECONDS)}Object.defineProperty(e,"__esModule",{value:!0}),e.safeParseObject=e.isValidUserId=e.fyShuffle=e.dateToShortUtcString=e.isUtcDatetimeString=e.overrideValues=e.stringToDate=e.makeArrayFromObjectValuesSortedByKeyString=e.guid=e.extractLanguageSubtag=e.isValidLanguageSubTag=e.subtractSecondsWithoutOverflow=e.addSecondsWithoutOverflow=e.MIN_DATE_MILLISECONDS=e.MAX_DATE_MILLISECONDS=e.getDistantFuture=e.getDistantPast=e.isBoolean=e.isString=e.isArray=e.isFunction=e.isObject=e.isNOU=e.isNumber=e.isEnumValue=e.isDate=e.timeAdd=void 0,e.timeAdd=function(t,e,n){switch(e.toLowerCase()){case"h":case"hour":return new Date(t.getTime()+36e5*n);case"m":case"minute":return new Date(t.getTime()+6e4*n);case"s":case"second":return new Date(t.getTime()+1e3*n);default:throw new Error("Invalid interval value of "+e)}},e.isDate=r,e.isEnumValue=function(t,e){return t in e},e.isNumber=function(t){return null!==t&&!isNaN(t)&&isFinite(t)},e.isNOU=i,e.isObject=function(t){return null!=t&&"object"==typeof t},e.isFunction=function(t){return null!=t&&"function"==typeof t},e.isArray=function(t){return null!=t&&Array.isArray(t)},e.isString=o,e.isBoolean=function(t){return"boolean"==typeof t},e.getDistantPast=function(){return new Date(-116444736e5)},e.getDistantFuture=function(){return new Date(640922112e5)},e.MAX_DATE_MILLISECONDS=864e13,e.MIN_DATE_MILLISECONDS=-864e13,e.addSecondsWithoutOverflow=function(t,n){if(!t)return null;if(n<0)return a(t,-1*n);var r=t.getTime()+1e3*n;return r<e.MAX_DATE_MILLISECONDS?new Date(r):new Date(e.MAX_DATE_MILLISECONDS)},e.subtractSecondsWithoutOverflow=a;function s(t){if(!t)return null;var e=t.match("^((?:[a-zA-Z]{2,3}(?:-[a-zA-Z]{3}){0,3})|(?:[a-zA-Z]{4,8}))(?:-([a-zA-Z]{4}))?(?:-([a-zA-Z]{2}|[0-9]{3}))?(-.*)?$");return!e||e.length<1||!i(e[4])?null:e[0]}function u(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}e.isValidLanguageSubTag=function(t){if(!t)return!1;var e=s(t);return!!e&&e===t},e.extractLanguageSubtag=s,e.guid=function(){return(u()+u()+"-"+u()+"-4"+u().substr(0,3)+"-"+u()+"-"+u()+u()+u()).toLowerCase()},e.makeArrayFromObjectValuesSortedByKeyString=function(t){var e=Object.keys(t);e.sort();var n=[];for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];n.push(t[i])}return n},e.stringToDate=function(t){if(!o(t))return null;var e=t?new Date(t):null;return r(e)?e:null},e.overrideValues=function(t,e){if(!e)return e;var n=e;if(t)for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n},e.isUtcDatetimeString=function(t){return!!o(t)&&/^(\d{4}\-\d\d\-\d\dT\d\d:\d\d:\d\d(\.\d\d\d)?Z)$/.test(t)},e.dateToShortUtcString=function(t){if(!r(t))return null;function e(t){return t<10?"0"+t:t.toString()}return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"},e.fyShuffle=function(t){if(!i(t)){if(0===t.length||1===t.length)return t;for(var e=t.length-1;e>0;){var n=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[n],t[n]=r,e--}return t}},e.isValidUserId=function(t){return!!o(t)&&/^([a-z]{1,2}):\w+/.test(t)},e.safeParseObject=function(t,e){try{var n=!t||"{"!==t[0]&&"["!==t[0]?void 0:JSON.parse(t);return null!=n?n:e}catch(t){}return e}},function(t,e,n){"use strict";var r,i,o;n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return o})),function(t){t[t.None=0]="None",t[t.Css=1]="Css",t[t.Strings=2]="Strings"}(r||(r={})),function(t){t[t.Undefined=0]="Undefined",t[t.MinorWithoutParentalConsent=1]="MinorWithoutParentalConsent",t[t.MinorWithParentalConsent=2]="MinorWithParentalConsent",t[t.Adult=3]="Adult",t[t.NotAdult=4]="NotAdult",t[t.MinorNoParentalConsentRequired=5]="MinorNoParentalConsentRequired"}(i||(i={})),function(t){t[t.MSA=0]="MSA",t[t.AAD=1]="AAD",t[t.Unauthenticated=2]="Unauthenticated"}(o||(o={}))},function(t,e,n){"use strict";n.d(e,"e",(function(){return i})),n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"d",(function(){return s}));var r,i="customervoice";!function(t){t[t.Smile=0]="Smile",t[t.Frown=1]="Frown",t[t.Idea=2]="Idea",t[t.Bug=3]="Bug",t[t.IdeaRedirect=4]="IdeaRedirect"}(r||(r={}));var o=function(){function t(){}return t.WebSurfacesIntLink="https://content.growth.office.net/mirrored/resources/programmablesurfaces/int/officewebsurfaces.core.min.js",t.WebSurfacesProdLink="https://content.growth.office.net/mirrored/resources/programmablesurfaces/prod/officewebsurfaces.core.min.js",t}(),a=function(){function t(){}return t.TMSAppID="4c4f550b-42b2-4a16-93f9-fdb9e01bb6ed",t.TULIPSAppID="05c88d91-956e-46b4-91b0-77a33cc21a4d",t}(),s="Web SDK v"},function(t,e,n){"use strict";var r;!function(t){!function(t){t[t.FloodgateSettings=0]="FloodgateSettings",t[t.SurveyActivationStats=1]="SurveyActivationStats",t[t.SurveyEventActivityStats=2]="SurveyEventActivityStats",t[t.CampaignDefinitions=3]="CampaignDefinitions",t[t.CampaignStates=4]="CampaignStates",t[t.GovernedChannelStates=5]="GovernedChannelStates",t[t.TmsCache_MessageMetadata=6]="TmsCache_MessageMetadata",t[t.TmsCache_UserGovernance=7]="TmsCache_UserGovernance",t[t.TmsCache_CampaignContent=8]="TmsCache_CampaignContent",t[t.Tms_DynamicSettings=9]="Tms_DynamicSettings",t[t.LogLevelSettings=10]="LogLevelSettings",t[t.UserFacts=11]="UserFacts",t[t.DebugOverrides=12]="DebugOverrides"}(t.FileType||(t.FileType={}))}(r||(r={})),t.exports=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ISurveyInfo=e.ISurveyComponent=e.ISurvey=e.IFloodgateSettingIdMap=e.IFloodgateStorageProvider=e.IActivityListener=void 0;var r=n(19);e.ISurveyInfo=r;var i=n(36);e.IActivityListener=i;var o=n(37);e.IFloodgateSettingIdMap=o;var a=n(6);e.IFloodgateStorageProvider=a;var s=n(10);e.ISurvey=s;var u=n(11);e.ISurveyComponent=u;var c=n(13);Object.defineProperty(e,"CampaignDefinition",{enumerable:!0,get:function(){return c.CampaignDefinition}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TelemetryEvent=void 0;var r=function(){function t(){}var e,n,r,i,o,a,s,u,c,l,p,d,g,h,f,v,y,m,S,T,C,E,_,A,I,b,w,O,F,D,L,N,P,U,M,R;return t.CampaignState=((e=function(){}).Deserialize=((n=function(){}).Failed="FloodgateCore_CampaignState_Deserialize_Failed",n),e),t.FileBasedCampaignStateProvider=((r=function(){}).Load=((i=function(){}).Failed="FloodgateCore_FileBasedCampaignStateProvider_Load_Failed",i),r),t.HostBasedCampaignStateProvider=((o=function(){}).GetStatesFromHost=((a=function(){}).Failed="FloodgateCore_HostBasedCampaignStateProvider_GetStatesFromHost_Failed",a),o),t.Floodgate=((s=function(){}).Initialize=((u=function(){}).Failed="FloodgateCore_Floodgate_Initialize_Failed",u),s.Start=((c=function(){}).Failed="FloodgateCore_Floodgate_Start_Failed",c.Warning="FloodgateCore_Floodgate_Start_Warning",c.SurveysDisabled="FloodgateCore_Floodgate_Start_SurveysDisabled",c),s.UserFactsLoad=((l=function(){}).Failed="FloodgateCore_Floodgate_UserFactsLoad_Failed",l),s.UserFactsSpecDeserialization=((p=function(){}).Failed="FloodgateCore_Floodgate_UserFactsSpecDeserialization_Failed",p),s.UserFactsSpecIsAMatch=((d=function(){}).Failed="FloodgateCore_Floodgate_UserFactsSpecIsAMatch_Failed",d.Mismatch="FloodgateCore_Floodgate_UserFactsSpecIsAMatch_Mismatch",d.Summary="FloodgateCore_Floodgate_UserFactsSpecIsAMatch_Summary",d),s),t.FloodgateEngine=((g=function(){}).Make=((h=function(){}).Failed="FloodgateCore_FloodgateEngine_Make_Failed",h),g.Common=((f=function(){}).Error="FloodgateCore_FloodgateEngine_Common_Error",f),g.Start=((v=function(){}).Failed="FloodgateCore_FloodgateEngine_Start_Failed",v),g.StartAsync=((y=function(){}).Failed="FloodgateCore_FloodgateEngine_StartAsync_Failed",y.Stopped="FloodgateCore_FloodgateEngine_StartAsync_Stopped",y),g.OnSurveyActivated=((m=function(){}).ActivationStatsSuppressedSurvey="FloodgateCore_FloodgateEngine_OnSurveyActivated_ActivationStatsSuppressedSurvey",m.ClosedChannelType="FloodgateCore_FloodgateEngine_OnSurveyActivated_ClosedChannelType",m.SurveyNotDefined="FloodgateCore_FloodgateEngine_OnSurveyActivated_SurveyNotDefined",m.SessionSuppressedSurvey="FloodgateCore_FloodgateEngine_OnSurveyActivated_SessionSuppressedSurvey",m.ActivationExpiredSurvey="FloodgateCore_FloodgateEngine_OnSurveyActivated_ActivationExpiredSurvey",m.ActivationIrrelevantSurvey="FloodgateCore_FloodgateEngine_OnSurveyActivated_ActivationIrrelevantSurvey",m.Error="FloodgateCore_FloodgateEngine_OnSurveyActivated_Error",m),g.CheckGovernanceServiceAndActivateSurvey=((S=function(){}).GovernanceServiceForceToDisplay="FloodgateCore_FloodgateEngine_GovernanceService_GovernanceServiceForceToDisplay",S.GovernanceServiceClientCompleted="FloodgateCore_FloodgateEngine_GovernanceService_GovernanceServiceClientCompleted",S),g),t.GovernedChannelState=((T=function(){}).Deserialize=((C=function(){}).Failed="FloodgateCore_GovernedChannelState_Deserialize_Failed",C),T),t.FileBasedGovernedChannelStateProvider=((E=function(){}).Load=((_=function(){}).Failed="FloodgateCore_FileBasedGovernedChannelStateProvider_Load_Failed",_),E),t.HostBasedGovernedChannelStateProvider=((A=function(){}).GetStatesFromHost=((I=function(){}).Failed="FloodgateCore_HostBasedGovernedChannelStateProvider_GetStatesFromHost_Failed",I),A),t.SurveyStatCollectionActivation=((b=function(){}).FromJson=((w=function(){}).Failed="FloodgateCore_SurveyStatCollectionActivation_FromJson_Failed",w),b.ToJson=((O=function(){}).Failed="FloodgateCore_SurveyStatCollectionActivation_ToJson_Failed",O),b),t.HostBasedSurveyActivationStatsProvider=((F=function(){}).GetSurveyStatsFromHost=((D=function(){}).Failed="FloodgateCore_HostBasedSurveyActivationStatsProvider_GetSurveyStatsFromHost_Failed",D),F),t.SurveyStatCollectionEventActivity=((L=function(){}).FromJson=((N=function(){}).Failed="FloodgateCore_SurveyStatCollectionEventActivity_FromJson_Failed",N),L.ToJson=((P=function(){}).Failed="FloodgateCore_SurveyStatCollectionEventActivity_ToJson_Failed",P),L),t.SurveyActivity=((U=function(){}).LogActivity=((M=function(){}).EventsReprocessed="FloodgateCore_SurveyActivity_LogActivity_EventsReprocessed",M.SurveysReprocessed="FloodgateCore_SurveyActivity_LogActivity_SurveysReprocessed",M),U.SetActivityTrackingContracts=((R=function(){}).DuplicateSurveyID="FloodgateCore_SurveyActivity_SetActivityTrackingContracts_DuplicateSurveyID",R),U),t}();e.TelemetryEvent=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GovernedChannel=e.GovernedChannelType=void 0;var r,i=n(3);!function(t){t[t.Standard=0]="Standard",t[t.Urgent=1]="Urgent",t[t.Banner=2]="Banner",t[t.TeachingMessage=3]="TeachingMessage"}(e.GovernedChannelType||(e.GovernedChannelType={})),function(t){t.getDefault=function(){return t.Standard}}(r=e.GovernedChannelType||(e.GovernedChannelType={}));var o=function(){function t(t,e,n,o){if(!i.isEnumValue(t,r))throw new Error("type is not a valid GovernedChannelType");if(!e)throw new Error("name must not be null or empty");if(n<0)throw new Error("cooldownSeconds must not be negative");this.type=t,this.name=e,this.cooldownSeconds=n,this.setCooldownStartTime(o)}return t.prototype.setCooldownStartTime=function(t){this.cooldownStartTime=t,i.isNOU(this.cooldownStartTime)?this.cooldownEndTime=i.getDistantPast():this.cooldownEndTime=i.addSecondsWithoutOverflow(this.cooldownStartTime,this.cooldownSeconds)},t.prototype.isOpen=function(){return this.isOpenAtDate(new Date)},t.prototype.isOpenAtDate=function(t){return!!t&&t>this.cooldownEndTime},t.prototype.getType=function(){return this.type},t.prototype.getName=function(){return this.name},t.prototype.getCooldownSeconds=function(){return this.cooldownSeconds},t.prototype.getCooldownStartTime=function(){return this.cooldownStartTime},t.prototype.getCooldownEndTime=function(){return this.cooldownEndTime},t}();e.GovernedChannel=o},function(t,e,n){"use strict";var r;!function(t){!function(t){t[t.Feedback=0]="Feedback",t[t.Nps=1]="Nps",t[t.Psat=2]="Psat",t[t.Bps=3]="Bps",t[t.Fps=4]="Fps",t[t.Nlqs=5]="Nlqs",t[t.Intercept=6]="Intercept",t[t.GenericMessagingSurface=12]="GenericMessagingSurface"}(t.Type||(t.Type={})),t.DOM_FEEDBACKSURVEY_TAGNAME="FeedbackSurvey",t.DOM_NPS_TAGNAME="Nps",t.DOM_PSAT_TAGNAME="Psat",t.DOM_BPS_TAGNAME="Bps",t.DOM_FPS_TAGNAME="Fps",t.DOM_NLQS_TAGNAME="Nlqs",t.DOM_INTERCEPT_TAGNAME="Intercept",t.LAUNCHER_TYPE_DEFAULT="survey"}(r||(r={})),t.exports=r},function(t,e,n){"use strict";var r;!function(t){t.DOM_PROMPT_TAGNAME="Prompt",t.DOM_COMMENT_TAGNAME="Comment",t.DOM_RATING_TAGNAME="Rating",t.DOM_CVSURVEY_TAGNAME="CVSurvey",t.DOM_MULTIPLECHOICE_TAGNAME="MultipleChoice",t.DOM_INTERCEPT_TAGNAME="Intercept",t.JSON_INTERCEPT_KEYNAME="intercept",t.JSON_INTERCEPTURL_KEYNAME="url",t.JSON_PROMPT_KEYNAME="prompt",t.JSON_PROMPTYESTEXT_KEYNAME="yesButtonText",t.JSON_PROMPTNOTEXT_KEYNAME="noButtonText",t.JSON_COMMENT_KEYNAME="comment",t.JSON_RATING_KEYNAME="rating",t.JSON_CVSURVEY_KEYNAME="cvSurvey",t.JSON_CVSURVEYFORMID_KEYNAME="formId",t.JSON_CVSURVEYTHEME_KEYNAME="theme",t.JSON_RATINGOPTIONS_KEYNAME="options",t.JSON_CVSURVEYPRODUCTNAME_KEYNAME="productName",t.JSON_CVSURVEYUIHOST_KEYNAME="uiHost",t.JSON_CVSURVEYPLATFORM_KEYNAME="platform",t.JSON_TITLE_KEYNAME="title",t.JSON_QUESTION_KEYNAME="question",t.JSON_MULTIPLECHOICE_KEYNAME="multipleChoice",t.JSON_APPLICATION_KEYNAME="application",t.JSON_EXTENDEDMANIFESTDATA_KEYNAME="extendedManifestData",t.JSON_SURVEYSTRINGS_KEYNAME="surveyStrings",t.JSON_SURVEYSPECIFICDATA_KEYNAME="surveySpecificData"}(r||(r={})),t.exports=r},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.FloodgateEngine=void 0;var o=n(6),a=n(13),s=n(38),u=n(25),c=n(8),l=n(51),p=n(9),d=n(29),g=n(18),h=n(24),f=n(26),v=n(30),y=o.FileType,m=n(54),S=n(55),T=n(3),C=function(){function t(){}return t.prototype.log_TriggerMet=function(t,e,n,r,i){},t.prototype.log_UserSelected=function(t,e,n,r){},t.prototype.log_CampaignLoad_Failed=function(t){},t.prototype.log_Error=function(t,e){},t.prototype.log_Event=function(t,e){},t.prototype.log_LocalError=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n]},t}(),E={run:function(t){},shouldAcceptActivity:function(t){return!0}},_={},A=function(){function t(e,n,r,i,o,a,s,u,c){if(this.initializationStatus=0,this.candidateSurveys={},this.launchedSurveys={},this.launchedLaunchers=[],this.surveyEventSent=[],this.staleTriggeredSurveysQueue=[],!e)throw new Error("surveyClient must not be null");if(!n)throw new Error("activityListener must not be null");if(!r)throw new Error("launcherFactory must not be null");if(!i)throw new Error("onSurveyActivatedCallback must not be null");if(!o)throw new Error("storage must not be null");if(!a)throw new Error("governor must not be null");if(!u)throw new Error("transporterFactory must not be null");this.surveyClient=e,this.activityListener=n,this.launcherFactory=r,this.onSurveyActivatedCallback=i,this.storage=o,this.governor=a,this.surveyActivationStatsProvider=s,this.governanceServiceClient=c,t.transporterFactory=u,this.loggedFirstStart=!1,this.setPendingSurveys(null),this.activityListener.clearSurveys();var l=this;this.activityListener.setCallback({run:function(t,e){l.onSurveyActivated(t,e)},shouldAcceptActivity:function(t){return l.shouldAcceptActivity(t)}})}return t.setTelemetryLogger=function(e){if(!e)throw new Error("telemetryLogger must not be null");t.telemetryLogger=e},t.getTelemetryLogger=function(){return t.telemetryLogger},t.getTransportFactory=function(){return t.transporterFactory},t.make=function(e,n,r,i,o,l,p,v,y,m,S){try{var T=d.GovernedChannelStateProviderFactory.make(i,o),C=f.SurveyActivationStatsProviderFactory.make(i,o),_=u.CampaignStateProviderFactory.make(i,o);return y.push(new a.FileSystemCampaignDefinitionProvider(i)),new t(new s.CampaignManager(_,y,l,p,e,new Date,m),new h(E,this.getTelemetryLogger),n,r,i,new g.Governor(T),C,v,S)}catch(t){this.telemetryLogger.log_Event(c.TelemetryEvent.FloodgateEngine.Make.Failed,{ErrorMessage:t&&t.toString(),ErrorDetails:t&&t.stack})}},t.prototype.mergeAndSave=function(){this.saveSettings(),this.saveSurveyActivationHistory(),this.saveSurveyEventActivityHistory(),this.surveyClient.saveCurrentState(),this.governor.saveChannelStates()},t.prototype.start=function(){if(2!==this.initializationStatus&&3!==this.initializationStatus)try{this.setInitializationStatus(2),this.loadSettingsAndPriorEventCounts();var e=this.getAvailableChannelTypes();this.surveyClient.refreshSurveyDefinitions(e),this.setPendingSurveysAndStartFloodgate(),this.setInitializationStatus(3)}catch(e){this.setInitializationStatus(1),t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.Start.Failed,{ErrorMessage:e&&e.toString(),ErrorDetails:e&&e.stack})}},t.prototype.startAsync=function(){if(2===this.initializationStatus||3===this.initializationStatus)return Promise.resolve();try{this.setInitializationStatus(2),this.loadSettingsAndPriorEventCounts();var e=this.getAvailableChannelTypes(),n=this;return new Promise((function(r,i){n.surveyClient.refreshSurveyDefinitionsAsync(e).then((function(){4===n.initializationStatus?(n.setInitializationStatus(3),n.stop(),t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.StartAsync.Stopped,{ErrorMessage:"Stopped because of a pending stop() call"})):n.setPendingSurveysAndStartFloodgate(),r()})).catch((function(e){n.setInitializationStatus(1),t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.StartAsync.Failed,{ErrorMessage:"Survey refresh error "+(e&&e.message)}),i(e)}))}))}catch(e){return this.setInitializationStatus(1),t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.StartAsync.Failed,{ErrorMessage:e&&e.toString(),ErrorDetails:e&&e.stack}),Promise.resolve()}},t.prototype.stop=function(){3===this.initializationStatus&&(this.mergeAndSave(),this.setPendingSurveys(null),this.updateActivityListenerWithCurrentSurveyDefinitions()),this.setInitializationStatus(4)},t.prototype.getActivityListener=function(){return this.activityListener},t.prototype.setInitializationStatus=function(t){this.initializationStatus=t},t.prototype.saveSettings=function(){this.storage.fileLock(y.FloodgateSettings);try{this.writeString(y.FloodgateSettings,l.FloodgateSettings.toJson(this.floodgateSettings))}finally{this.storage.fileUnlock(y.FloodgateSettings)}},t.prototype.loadSettingsAndPriorEventCounts=function(){try{this.previousSurveyActivationStats=this.surveyActivationStatsProvider.load(),this.previousSurveyEventActivityStats=v.SurveyStatCollectionEventActivity.fromJson(this.readString(y.SurveyEventActivityStats));var e=this.previousSurveyEventActivityStats.getStats();for(var n in e)e.hasOwnProperty(n)&&this.surveyEventSent.push(n);this.floodgateSettings=l.FloodgateSettings.fromJson(this.readString(y.FloodgateSettings))}catch(e){t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.Common.Error,{ErrorMessage:"Error loading prior settings/events "+(e&&e.toString())})}},t.prototype.getAvailableChannelTypes=function(){var t=this.governor.getAvailableChannelData(),e=[];return t.forEach((function(t){t&&e.push(t.getType())})),e},t.prototype.setPendingSurveysAndStartFloodgate=function(){this.setPendingSurveys(this.surveyClient.getAppSurveys()),this.updateActivityListenerWithCurrentSurveyDefinitions(),this.setInitializationStatus(3),this.loggedFirstStart||(this.loggedFirstStart=!0,this.getActivityListener().logActivity(h.FloodgateStartActivityName))},t.prototype.updateSurveyActivationStats=function(t){var e=t.getSurveyInfo(),n=e.getId(),r=this.previousSurveyActivationStats.getStats()[n]||new f.SurveyActivationStats;r.Type=t.getType(),r.ExpirationTimeUtc=e.getExpirationTimeUtc(),r.ActivationTimeUtc=new Date,r.SurveyLaunchCount++,this.previousSurveyActivationStats.addStats(n,r),_.hasOwnProperty(n)||(_[n]=0),_[n]++},t.prototype.saveSurveyActivationHistory=function(){this.storage.fileLock(y.SurveyActivationStats);try{var t=this.surveyActivationStatsProvider.load(),e=this.previousSurveyActivationStats.getStats(),n=new f.SurveyStatCollectionActivation;for(var r in this.launchedSurveys)if(this.launchedSurveys.hasOwnProperty(r)){var i=this.launchedSurveys[r].getSurveyInfo().getId(),o=e[i];n.addStats(i,o)}t.accumulate(n),this.surveyActivationStatsProvider.save(t),this.previousSurveyActivationStats=t}finally{this.storage.fileUnlock(y.SurveyActivationStats)}},t.prototype.saveSurveyEventActivityHistory=function(){this.storage.fileLock(y.SurveyEventActivityStats);try{var t=v.SurveyStatCollectionEventActivity.fromJson(this.readString(y.SurveyEventActivityStats)),e=new Date,n=new v.SurveyStatCollectionEventActivity,r=function(t){if(i.candidateSurveys.hasOwnProperty(t)){var r=new v.SurveyEventActivityStats,o=i.candidateSurveys[t];if(!o.getSurveyInfo().isActiveForDate(e))return"continue";r.ExpirationTimeUtc=o.getSurveyInfo().getExpirationTimeUtc();var a=o.getSurveyInfo().getActivationEvent().getTrackingSet(),s=[],u=[];a.getList().forEach((function(t){t&&(t.getIsAggregate()?s.push(t.getActivity()):u.push(t.getActivity()))})),r.Counts=new Array(s.length);for(var c=0;c<s.length;c++)r.Counts[c]=i.activityListener.moveSessionCountIntoBaseCount(s[c],o.getSurveyInfo().getId());for(var l=0,p=u;l<p.length;l++){var d=p[l];i.activityListener.saveSessionTrackingActivity(d)}n.addStats(o.getSurveyInfo().getId(),r)}},i=this;for(var o in this.candidateSurveys)r(o);t.accumulate(n),this.writeString(y.SurveyEventActivityStats,v.SurveyStatCollectionEventActivity.toJson(t)),this.previousSurveyEventActivityStats=t}finally{this.storage.fileUnlock(y.SurveyEventActivityStats)}},t.prototype.setPendingSurveys=function(t){if(this.candidateSurveys={},t)for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];this.launcherFactory.AcceptsSurvey(n)&&(this.candidateSurveys[e]=n)}},t.prototype.getCurrentSurveyDefinitions=function(){var e=this,n=new Array,r=this.getAllCampaignDefinitionIDs(),i=this.getAllCandidateCampaignDefinitionIDs(),o=this.surveyClient.getCampaignDefinitions(),a=function(t){if(S.isBusinessCriticalSurvey(t))return!0;var n=e.previousSurveyActivationStats.getBySurveyId(t.getId());return!(!S.isMultiLaunchSurvey(t)||S.hasSurveyReachedMaxLaunches(t,n)||S.hasSurveyReachedMaxLaunchesPerSession(t,_))||!(n||!t.isActiveForDate(new Date))};for(var s in this.candidateSurveys)if(this.candidateSurveys.hasOwnProperty(s)){var u=this.candidateSurveys[s],c=u.getSurveyInfo();if(!o[null==c?void 0:c.getBackEndId()]||!a(c))continue;if(this.surveyEventSent.indexOf(s)<0){this.surveyEventSent.push(s);var l=this.getAdditionalSurveyInfoForTelemetry(u,null,r,i);t.telemetryLogger.log_UserSelected(c.getBackEndId(),c.getId(),u.getType(),JSON.stringify(l))}n.push(u)}return n},t.prototype.getAdditionalSurveyInfoForTelemetry=function(t,e,n,r){var i,o,a,s,u=this.surveyClient.getCampaignDefinitions()[t.getCampaignId()];i=u.nominationScheme.percentageNumerator,o=u.nominationScheme.percentageDenominator,a=u.nominationScheme.nominationPeriod.asTimeIntervalSeconds(),a=T.isNOU(a)?-1:a,s=u.nominationScheme.cooldownPeriod.asTimeIntervalSeconds(),s=T.isNOU(s)?-1:s;var c=t.getSurveyInfo();return{allCampaignDefinitionIDs:n,allCandidateCampaignDefinitionIDs:r,channelType:c.getGovernedChannelType(),contextCount:e?e.length:void 0,cooldownPeriodNumber:s,nominationPeriodNumber:a,percentageDenominator:o,percentageNumerator:i,surveyLauncherType:t.getLauncherType(),businessLevel:c.getBusinessLevel(),maxLaunches:c.getMaxLaunches(),maxLaunchesPerSession:c.getMaxLaunchesPerSession()}},t.prototype.getAllCandidateCampaignDefinitionIDs=function(){var t=[];for(var e in this.candidateSurveys)if(this.candidateSurveys.hasOwnProperty(e)){var n=this.candidateSurveys[e];t.push(n.getSurveyInfo().getBackEndId())}return t},t.prototype.getAllCampaignDefinitionIDs=function(){var t=this.surveyClient.getCampaignDefinitions(),e=[];for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=t[n];e.push(r.campaignId)}return e},t.prototype.updateActivityListenerWithCurrentSurveyDefinitions=function(){for(var t=[],e=0,n=this.getCurrentSurveyDefinitions();e<n.length;e++){var r=n[e].getSurveyInfo(),i=new m.ActivityTrackingContract(r.getId(),r.getActivationEvent().getTrackingSet());t.push(i)}this.activityListener.SetActivityTrackingContracts(t,this.previousSurveyEventActivityStats)},t.prototype.setCriticalPendingSurveysAndUpdateActivityListener=function(){var t={};for(var e in this.candidateSurveys)if(this.candidateSurveys.hasOwnProperty(e)){var n=this.candidateSurveys[e];S.isCriticalSurvey(n.getSurveyInfo())&&(t[e]=n)}Object.keys(t).length>0&&(this.setPendingSurveys(t),this.updateActivityListenerWithCurrentSurveyDefinitions())},t.prototype.shouldAcceptActivity=function(t){return 3===this.initializationStatus||t===h.FloodgateStartActivityName},t.prototype.onSurveyActivated=function(e,n){for(var r,i=0,o=this.getCurrentSurveyDefinitions();i<o.length;i++){var a=o[i];if(a.getSurveyInfo().getId()===e){r=a;break}}if(T.isNOU(r))t.getTelemetryLogger().log_Error(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.SurveyNotDefined,"Survey is not defined in the current survey definitions.");else try{var s=r.getSurveyInfo().getGovernedChannelType();this.governanceServiceClient.isEnabled(s)?(this.staleTriggeredSurveysQueue.push(r),1===this.staleTriggeredSurveysQueue.length&&this.checkGovernanceServiceAndActivateSurvey(r,s,n)):this.activateSurvey(r,s,n)}catch(e){t.telemetryLogger.log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.Error,{ErrorMessage:"Error activating survey "+(e&&e.toString()),ErrorDetails:e&&e.stack})}},t.prototype.activateSurvey=function(e,n,r){var i=!1;if(this.candidateSurveys[e.getSurveyInfo().getId()])if(e.getSurveyInfo().isActiveForDate(new Date)){if(this.governor.refreshChannelData(),S.isCriticalSurvey(e.getSurveyInfo()))i=!0;else if(this.governor.isChannelOpen(n)){if(this.surveyActivationStatsProvider.load().getBySurveyId(e.getSurveyInfo().getId()))t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.ActivationStatsSuppressedSurvey,{CampaignId:e.getSurveyInfo().getBackEndId(),SurveyId:e.getSurveyInfo().getId()});else if(0===Object.keys(this.launchedSurveys).length)i=!0;else{var o=Object.values(this.launchedSurveys)[0];T.isNOU(o)||t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.SessionSuppressedSurvey,{CampaignId:o.getSurveyInfo().getBackEndId(),SurveyId:o.getSurveyInfo().getId()})}}else t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.ClosedChannelType,{ClosedChannelType:p.GovernedChannelType[n]});i&&(this.launchedSurveys[e.getSurveyInfo().getId()]=e)}else t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.ActivationExpiredSurvey,{CampaignId:e.getSurveyInfo().getBackEndId(),SurveyId:e.getSurveyInfo().getId()});else t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.ActivationIrrelevantSurvey,{CampaignId:e.getSurveyInfo().getBackEndId(),SurveyId:e.getSurveyInfo().getId()});if(this.updateSurveyActivationStats(e),this.mergeAndSave(),this.activityListener.clearSurveys(),this.staleTriggeredSurveysQueue=[],i){var a=e.getSurveyInfo().getActivationEvent().getTrackingSet().getActivityTrackingInfo(this.activityListener,e.getSurveyInfo().getId()),s=this.getAdditionalSurveyInfoForTelemetry(e,r,this.getAllCampaignDefinitionIDs(),this.getAllCandidateCampaignDefinitionIDs());s.governanceServiceClientState=this.governanceServiceClient.getClientState(),t.telemetryLogger.log_TriggerMet(e.getSurveyInfo().getBackEndId(),e.getSurveyInfo().getId(),e.getType(),a,JSON.stringify(s)),this.governor.startChannelCooldown(n);var u=e.getSurveyInfo(),l=!0;if(S.isBusinessCriticalSurvey(u))l=!1;else if(S.isMultiLaunchSurvey(u)){var d=this.previousSurveyActivationStats.getBySurveyId(u.getId());l=S.hasSurveyReachedMaxLaunches(u,d)}this.surveyClient.onSurveyActivated(u,l),this.launchLauncher(e,r),this.setCriticalPendingSurveysAndUpdateActivityListener()}},t.prototype.checkGovernanceServiceAndActivateSurvey=function(e,n,o){return r(this,void 0,void 0,(function(){var r,a,s,u,l,p;return i(this,(function(i){switch(i.label){case 0:return r=this.surveyClient.getCampaignDefinitions()[e.getCampaignId()],a=r.nominationScheme.cooldownPeriod.asTimeIntervalSeconds(),s=g.Governor.GetChannelCoolDown(n),[4,this.governanceServiceClient.checkGovernancePermitAsync(e,a,s,n)];case 1:return u=i.sent(),l=!1,t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.CheckGovernanceServiceAndActivateSurvey.GovernanceServiceClientCompleted,{Message:JSON.stringify(this.createGorvernanceResponseTelemetry(u))}),3!==this.initializationStatus?[2]:(u.error?this.governanceServiceClient.shouldForceDisplay()&&(l=!0,t.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.CheckGovernanceServiceAndActivateSurvey.GovernanceServiceForceToDisplay,{ErrorMessage:u.errorMessage})):u.permission?l=!0:(p=u.lastTriggerSurvey,this.governor.startChannelCooldown(n,p.lastTriggerSurveyTime),this.clearSurveyWithChannel(n)),l?(this.activateSurvey(e,n,o),[2]):this.staleTriggeredSurveysQueue.length<=1?(this.staleTriggeredSurveysQueue=[],[2]):(this.staleTriggeredSurveysQueue.shift(),this.checkGovernanceServiceAndActivateSurvey(this.staleTriggeredSurveysQueue[0],n,o),[2]))}}))}))},t.prototype.readString=function(t){return this.storage.read(t)},t.prototype.writeString=function(t,e){this.storage.write(t,e)},t.prototype.launchLauncher=function(t,e){var n=this.launcherFactory.makeSurveyLauncher(t);n&&(this.launchedLaunchers.push(n),this.onSurveyActivatedCallback.onSurveyActivated(n,t,{contextInfo:e}))},t.prototype.clearSurveyWithChannel=function(t){var e={};for(var n in this.candidateSurveys)if(this.candidateSurveys.hasOwnProperty(n)){var r=this.candidateSurveys[n];r.getSurveyInfo().getGovernedChannelType()!==t&&(e[n]=r)}this.candidateSurveys=e,this.activityListener.UpdateActivityTrackingContracts(this.candidateSurveys)},t.prototype.createGorvernanceResponseTelemetry=function(t){return{FloodgateEngineStatus:this.initializationStatus.toString(),GovernanceServiceResult:t,StaleTriggeredSurveysQueueCount:this.staleTriggeredSurveysQueue.length-1}},t.telemetryLogger=new C,t}();e.FloodgateEngine=A},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.FileSystemCampaignDefinitionProvider=e.FilterValidCampaignDefinitions=e.CampaignDefinition=e.CampaignSurveyTemplateIntercept=e.CampaignSurveyTemplateGenericMessagingSurface=e.CampaignSurveyTemplateNps11PointStatic=e.CampaignSurveyTemplateNps5PointStatic=e.CampaignSurveyTemplateNps=e.CampaignSurveyTemplateNlqs=e.CampaignSurveyTemplateFps=e.CampaignSurveyTemplate=e.CampaignSurveyMetadata=e.CampaignSurveyContentComment=e.CampaignSurveyContentRating=e.CampaignSurveyContentIntercept=e.CampaignSurveyContentPrompt=e.CampaignSurveyContentCVSurvey=e.CampaignSurveyContentMultipleChoice=e.CampaignSurveyContent=e.CampaignSurveyEventCountedActivitySequence=e.CampaignSurveyEventCountedActivity=e.CampaignSurveyEvent=e.CampaignNominationSchemeRatioPercentage=e.CampaignNominationScheme=e.CampaignDistributionRamp=e.CampaignDistribution=e.CampaignAdditionalDataRequested=e.CampaignDurationSingleBuildChange=e.CampaignDurationTimeInterval=e.CampaignDuration=e.CampaignScopeUserFactAll=e.CampaignScopeUserFactAny=e.CampaignScopeEnvironmentCrossProduct=e.CampaignScopeAny=e.CampaignScope=e.CampaignLanguageRangeLanguageSubtag=e.CampaignLanguageRange=void 0;var o=n(6),a=n(8),s=n(12),u=n(9),c=n(3),l=n(56),p=c.getDistantFuture,d=c.isBoolean,g=c.isNOU,h=c.isNumber,f=c.isString,v=c.isUtcDatetimeString,y=c.stringToDate,m=function(){function t(){}return t.deserialize=function(t){var e;return t&&0===t.Type&&(e=S.deserialize(t)),void 0===e?null:e},t.prototype.validate=function(){return!0},t}();e.CampaignLanguageRange=m;var S=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return t&&(n.languageSubTag=t.Value),n.validate()?n:null},e.prototype.isInRange=function(t){if(g(t))return!1;var e=c.extractLanguageSubtag(t);return!g(e)&&e.toLocaleUpperCase()===this.languageSubTag.toLocaleUpperCase()},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&(!(g(this.languageSubTag)||!f(this.languageSubTag))&&!!c.isValidLanguageSubTag(this.languageSubTag))},e}(m);e.CampaignLanguageRangeLanguageSubtag=S;var T=function(){function t(){}return t.deserialize=function(t){var e;if(g(t))return null;switch(t.Type){case 0:e=C.deserialize(t);break;case 1:e=E.deserialize(t);break;case 2:e=_.deserialize(t);break;case 3:e=A.deserialize(t)}return void 0===e?null:e},t.prototype.validate=function(){return!0},t}();e.CampaignScope=T;var C=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){return new e},e.prototype.isInScope=function(){return!0},e.prototype.validate=function(){return!!t.prototype.validate.call(this)},e}(T);e.CampaignScopeAny=C;var E=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e,r=[];if(g(t))return null;for(var i in t.Languages)if(t.Languages.hasOwnProperty(i)){var o=t.Languages[i];o&&r.push(m.deserialize(o))}return 0===r.length&&(r=null),n.languageRanges=r,n.validate()?n:null},e.prototype.setEnvironmentProvider=function(t){this.environmentProvider=t},e.prototype.isInScope=function(){if(g(this.languageRanges))return!0;if(g(this.environmentProvider)||!this.environmentProvider.getLanguage())return!1;var t=this.environmentProvider.getLanguage();for(var e in this.languageRanges){if(this.languageRanges.hasOwnProperty(e))if(this.languageRanges[e].isInRange(t))return!0}return!1},e.prototype.validate=function(){if(!t.prototype.validate.call(this))return!1;if(this.languageRanges)for(var e in this.languageRanges)if(this.languageRanges.hasOwnProperty(e)&&!this.languageRanges[e])return!1;return!0},e}(T);e.CampaignScopeEnvironmentCrossProduct=E;var _=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return n.userFacts=l.deserializeUserFacts(t),n.validate()?n:null},e.prototype.setUserFactsProvider=function(t){this.userFactsProvider=t},e.prototype.isInScope=function(){var t=this;return!!g(this.userFacts)||!!this.userFactsProvider&&this.userFacts.some((function(e){var n=t.userFactsProvider.getUserFact(e.getName());return e.isAMatch(n)}))},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&l.validateUserFacts(this.userFacts)},e}(T);e.CampaignScopeUserFactAny=_;var A=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return n.userFacts=l.deserializeUserFacts(t),n.validate()?n:null},e.prototype.setUserFactsProvider=function(t){this.userFactsProvider=t},e.prototype.isInScope=function(){var t=this;if(g(this.userFacts))return!0;if(!this.userFactsProvider)return!1;var e=this.userFacts.filter((function(e){var n=t.userFactsProvider.getUserFact(e.getName());return!e.isAMatch(n)}));if(e.length>0){var n=e.map((function(t){return t.getName()}));return s.FloodgateEngine.getTelemetryLogger().log_Event(a.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Summary,{Count:e.length,Message:n.toString()}),!1}return!0},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&l.validateUserFacts(this.userFacts)},e}(T);e.CampaignScopeUserFactAll=A;var I=function(){function t(){}return t.deserialize=function(t){var e;if(g(t))return null;switch(t.Type){case 0:e=b.deserialize(t);break;case 1:e=w.deserialize(t)}return void 0===e?null:e},t.prototype.validate=function(){return!0},t}();e.CampaignDuration=I;var b=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return t&&(n.intervalSeconds=t.IntervalSeconds),n.validate()?n:null},e.prototype.asTimeIntervalSeconds=function(){return this.intervalSeconds},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&!!h(this.intervalSeconds)},e}(I);e.CampaignDurationTimeInterval=b;var w=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){return new e},e.prototype.asTimeIntervalSeconds=function(){return null},e}(I);e.CampaignDurationSingleBuildChange=w;var O=function(){function t(){}return t.deserialize=function(e){var n=new t;if(!g(e)){n.additionalData=[];for(var r=0,i=e;r<i.length;r++){"EmailAddress"===i[r]&&n.additionalData.push(0)}}return n.validate()?n:null},t.prototype.validate=function(){return!g(this.additionalData)},t}();e.CampaignAdditionalDataRequested=O;var F=function(){function t(){}return t.deserialize=function(t){var e;return t&&0===t.Type&&(e=D.deserialize(t)),void 0===e?null:e},t.prototype.validate=function(){return!0},t}();e.CampaignDistribution=F;var D=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return t&&(n.maxDelaySeconds=t.MaxDelaySeconds,n.chunks=t.Chunks),n.validate()?n:null},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&(!(!h(this.maxDelaySeconds)||this.maxDelaySeconds<0)&&!(!h(this.chunks)||this.chunks<0))},e}(F);e.CampaignDistributionRamp=D;var L=function(){function t(){}return t.deserialize=function(t){var e;return t&&0===t.Type&&(e=N.deserialize(t)),void 0===e?null:e},t.prototype.getActiveSurveyTimeIntervalSeconds=function(){var t=this.nominationPeriod.asTimeIntervalSeconds();return h(t)?t:this.fallbackSurveyDurationSeconds},t.prototype.calculateSurveyStartTimeFromDate=function(t){return t||new Date},t.prototype.calculateSurveyExpirationTimeFromSurveyStartTime=function(t){return t=t||new Date,c.addSecondsWithoutOverflow(t,this.getActiveSurveyTimeIntervalSeconds())},t.prototype.getCampaignCooldown=function(t){return t?this.cooldownPeriod:this.nominationPeriod},t.prototype.validate=function(){return!g(this.nominationPeriod)&&(g(this.cooldownPeriod)&&(this.cooldownPeriod=this.nominationPeriod),!(!h(this.nominationPeriod.asTimeIntervalSeconds())&&(!h(this.fallbackSurveyDurationSeconds)||this.fallbackSurveyDurationSeconds<=0)))},t}();e.CampaignNominationScheme=L;var N=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return g(t)?null:(t.DistributionModel&&(n.distributionModel=F.deserialize(t.DistributionModel)),t.CooldownPeriod&&(n.cooldownPeriod=I.deserialize(t.CooldownPeriod)),t.NominationPeriod&&(n.nominationPeriod=I.deserialize(t.NominationPeriod)),n.fallbackSurveyDurationSeconds=t.FallbackSurveyDurationSeconds,n.percentageDenominator=t.PercentageDenominator,n.percentageNumerator=t.PercentageNumerator,n.validate()?n:null)},e.prototype.evaluateNominationRules=function(){var t=Math.random();return Math.floor(t*this.percentageDenominator)<this.percentageNumerator},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&(!(!h(this.percentageDenominator)||!h(this.percentageNumerator))&&(!(this.percentageDenominator<=0||this.percentageNumerator<0)&&!(this.percentageNumerator>this.percentageDenominator)))},e}(L);e.CampaignNominationSchemeRatioPercentage=N;var P=function(){function t(){}return t.deserialize=function(t){var e;if(g(t))return null;switch(t.Type){case 0:e=U.deserialize(t);break;case 1:e=M.deserialize(t)}return void 0===e?null:e},t.prototype.validate=function(){return!0},t}();e.CampaignSurveyEvent=P;var U=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return g(t)?null:(n.activity=t.Activity,n.count=t.Count,n.isAggregate=t.IsAggregate,n.validate()?n:null)},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&(!(g(this.activity)||!f(this.activity))&&(!(!h(this.count)||this.count<=0)&&!!d(this.isAggregate)))},e}(P);e.CampaignSurveyEventCountedActivity=U;var M=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e,r=[];if(g(t))return null;for(var i in t.Sequence)if(t.Sequence.hasOwnProperty(i)){var o=t.Sequence[i];o&&r.push(U.deserialize(o))}return 0===r.length&&(r=null),n.sequence=r,n.validate()?n:null},e.prototype.validate=function(){if(!t.prototype.validate.call(this))return!1;if(g(this.sequence))return!1;for(var e in this.sequence)if(this.sequence.hasOwnProperty(e)&&!this.sequence[e])return!1;return!0},e}(P);e.CampaignSurveyEventCountedActivitySequence=M;var R=function(){function t(){}return t.deserialize=function(e,n){var r=new t;return g(e)?null:(r.prompt=x.deserialize(e.Prompt),r.rating=V.deserialize(e.Rating),r.comment=j.deserialize(e.Question),r.multipleChoice=B.deserialize(e.MultipleChoice),r.intercept=G.deserialize(e.Intercept),r.cvSurvey=k.deserialize(e.CVSurveyParams),r.validate(n)?r:null)},t.prototype.validate=function(t){return!g(this.intercept)||!g(this.prompt)&&(t?!g(this.rating)||!g(this.multipleChoice)||!g(this.comment):!g(this.rating)&&!g(this.comment))},t}();e.CampaignSurveyContent=R;var B=function(){function t(){}return t.deserialize=function(e){var n=new t;return g(e)?null:(n.question=e.Question,n.availableOptions=e.AvailableOptions,n.minNumberOfSelectedOptions=e.MinNumberOfSelectedOptions,n.maxNumberOfSelectedOptions=e.MaxNumberOfSelectedOptions,n.validate()?n:null)},t.prototype.validate=function(){if(g(this.question)||!f(this.question)||g(this.availableOptions)||!Array.isArray(this.availableOptions)||this.availableOptions.length<2||g(this.minNumberOfSelectedOptions)||!h(this.minNumberOfSelectedOptions)||g(this.maxNumberOfSelectedOptions)||!h(this.maxNumberOfSelectedOptions))return!1;for(var t in this.availableOptions)if(this.availableOptions.hasOwnProperty(t)&&!f(this.availableOptions[t]))return!1;return!0},t}();e.CampaignSurveyContentMultipleChoice=B;var k=function(){function t(){}return t.deserialize=function(e){var n=new t;return g(e)?null:(n.customerVoiceFormId=e.CustomerVoiceFormId,n.validate()?n:null)},t.prototype.validate=function(){return!g(this.customerVoiceFormId)&&f(this.customerVoiceFormId)},t}();e.CampaignSurveyContentCVSurvey=k;var x=function(){function t(){}return t.deserialize=function(e){var n=new t;return g(e)?null:(n.title=e.Title,n.question=e.Question,n.yesLabel=e.YesLabel,n.noLabel=e.NoLabel,n.validate()?n:null)},t.prototype.validate=function(){return!(g(this.title)||!f(this.title)||g(this.question)||!f(this.question)||g(this.yesLabel)||!f(this.yesLabel)||g(this.noLabel)||!f(this.noLabel))},t}();e.CampaignSurveyContentPrompt=x;var G=function(){function t(){}return t.deserialize=function(e){var n=new t;return g(e)?null:(n.title=e.Title,n.question=e.Question,n.url=e.Url,n.validate()?n:null)},t.prototype.validate=function(){return!(g(this.title)||!f(this.title)||g(this.question)||!f(this.question)||g(this.url)||!f(this.url))},t}();e.CampaignSurveyContentIntercept=G;var V=function(){function t(){}return t.deserialize=function(e){var n=new t;return g(e)?null:(n.isZeroBased=e.IsZeroBased,n.question=e.Question,n.ratingValuesAscending=e.RatingValuesAscending,n.validate()?n:null)},t.prototype.validate=function(){if(g(this.question)||!f(this.question)||g(this.ratingValuesAscending)||!Array.isArray(this.ratingValuesAscending)||this.ratingValuesAscending.length<2||this.ratingValuesAscending.length>11)return!1;if(g(this.isZeroBased))this.isZeroBased=!1;else if(!d(this.isZeroBased))return!1;for(var t in this.ratingValuesAscending)if(this.ratingValuesAscending.hasOwnProperty(t)&&!f(this.ratingValuesAscending[t]))return!1;return!0},t}();e.CampaignSurveyContentRating=V;var j=function(){function t(){}return t.deserialize=function(e){var n=new t;return g(e)?null:(n.question=e.Question,n.validate()?n:null)},t.prototype.validate=function(){return!(g(this.question)||!f(this.question))},t}();e.CampaignSurveyContentComment=j;var z=function(){function t(){}return t.deserialize=function(e){if(g(e))return null;var n=new t;return n.contentMetadata=e.ContentMetadata,n.validate()?n:null},t.prototype.validate=function(){return!(g(this.contentMetadata)||!c.isObject(this.contentMetadata))},t}();e.CampaignSurveyMetadata=z;var q=function(){function t(){}return t.deserialize=function(t){var e;if(g(t))return null;switch(t.Type){case 0:e=Y.deserialize(t);break;case 1:e=K.deserialize(t);break;case 2:e=H.deserialize(t);break;case 3:e=W.deserialize(t);break;case 4:e=J.deserialize(t);break;case 22:e=Q.deserialize(t);break;case 5:e=Z.deserialize(t)}return g(e)?null:e},t.prototype.validate=function(){return!g(this.activationEvent)},t}();e.CampaignSurveyTemplate=q;var H=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return g(t)?null:(n.activationEvent=P.deserialize(t.ActivationEvent),n.content=R.deserialize(t.Content,!0),n.validate()?n:null)},e.prototype.validate=function(){return!(!t.prototype.validate.call(this)||g(this.content))},e}(q);e.CampaignSurveyTemplateFps=H;var W=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return g(t)?null:(n.activationEvent=P.deserialize(t.ActivationEvent),n.content=R.deserialize(t.Content),n.validate()?n:null)},e.prototype.validate=function(){return!(!t.prototype.validate.call(this)||g(this.content))},e}(q);e.CampaignSurveyTemplateNlqs=W;var J=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return g(t)?null:(n.activationEvent=P.deserialize(t.ActivationEvent),n.content=R.deserialize(t.Content),n.validate()?n:null)},e.prototype.validate=function(){return!(!t.prototype.validate.call(this)||g(this.content))},e}(q);e.CampaignSurveyTemplateNps=J;var Y=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return g(t)?null:(n.activationEvent=P.deserialize(t.ActivationEvent),n.validate()?n:null)},e.prototype.validate=function(){return!!t.prototype.validate.call(this)},e}(q);e.CampaignSurveyTemplateNps5PointStatic=Y;var K=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return g(t)?null:(n.activationEvent=P.deserialize(t.ActivationEvent),n.validate()?n:null)},e.prototype.validate=function(){return!!t.prototype.validate.call(this)},e}(q);e.CampaignSurveyTemplateNps11PointStatic=K;var Q=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){if(g(t))return null;var n=new e;return n.activationEvent=P.deserialize(t.ActivationEvent),n.metadata=z.deserialize(t.Metadata),n.maxLaunches=t.MaxLaunches,n.maxLaunchesPerSession=t.MaxLaunchesPerSession,n.preferredLaunchType=t.PreferredLaunchType,n.validate()?n:null},e.prototype.validate=function(){return!(!t.prototype.validate.call(this)||g(this.metadata))&&(!g(this.maxLaunches)&&(!h(this.maxLaunches)||this.maxLaunches<=0)||!g(this.maxLaunchesPerSession)&&(!h(this.maxLaunchesPerSession)||this.maxLaunchesPerSession<=0)?(s.FloodgateEngine.getTelemetryLogger().log_LocalError("Invalid Multi Launch settings",this.maxLaunches,this.maxLaunchesPerSession),!1):h(this.maxLaunches)&&h(this.maxLaunchesPerSession)&&this.maxLaunchesPerSession>this.maxLaunches?(s.FloodgateEngine.getTelemetryLogger().log_LocalError("Invalid Multi launch settings",this.maxLaunches,this.maxLaunchesPerSession),!1):!(!g(this.preferredLaunchType)&&!f(this.preferredLaunchType))||(s.FloodgateEngine.getTelemetryLogger().log_LocalError("Invalid launcher type",this.preferredLaunchType),!1))},e}(q);e.CampaignSurveyTemplateGenericMessagingSurface=Q;var Z=function(t){function e(){return t.call(this)||this}return i(e,t),e.deserialize=function(t){var n=new e;return g(t)?null:(n.activationEvent=P.deserialize(t.ActivationEvent),n.content=R.deserialize(t.Content),n.validate()?n:null)},e.prototype.validate=function(){return!(!t.prototype.validate.call(this)||g(this.content))},e}(q);e.CampaignSurveyTemplateIntercept=Z;var X=function(){function t(){}return t.deserialize=function(e){var n=new t;if(g(e))return null;n.campaignId=e.CampaignId,n.governedChannelType=e.GovernedChannelType,n.startTime=e.StartTimeUtc,n.endTime=e.EndTimeUtc,n.launcherType=e.LauncherType,n.primaryPriority=e.PrimaryPriority,n.tags=e.Tags;var r=O.deserialize(e.AdditionalDataRequested);return n.additionalDataRequested=r?r.additionalData:[],e.SurveyTemplate&&(n.surveyTemplate=q.deserialize(e.SurveyTemplate)),e.NominationScheme&&(n.nominationScheme=L.deserialize(e.NominationScheme)),e.Scope&&(n.scope=T.deserialize(e.Scope)),g(e.BusinessLevel)||(n.businessLevel=e.BusinessLevel),n.validate()?n:(s.FloodgateEngine.getTelemetryLogger().log_LocalError("Invalid definition",e),null)},t.prototype.validate=function(){var t,e;if(g(this.scope)&&(this.scope=new C),g(this.campaignId)||!f(this.campaignId))return!1;if(!h(this.governedChannelType)||!c.isEnumValue(this.governedChannelType,u.GovernedChannelType))return!1;if(g(this.nominationScheme))return!1;if(g(this.surveyTemplate))return!1;if(!g(this.launcherType)&&!f(this.launcherType))return!1;if("customervoice"===this.launcherType&&g(null===(e=null===(t=this.surveyTemplate.content)||void 0===t?void 0:t.cvSurvey)||void 0===e?void 0:e.customerVoiceFormId))return!1;if(!g(this.primaryPriority)&&!h(this.primaryPriority))return!1;if(this.tags&&!Array.isArray(this.tags))return!1;if(g(this.startTime))this.startTime=p();else{if(!v(this.startTime))return!1;this.startTime=y(this.startTime)}if(g(this.endTime)||"string"==typeof this.endTime&&""===this.endTime)this.endTime=p();else{if(!v(this.endTime))return!1;this.endTime=y(this.endTime)}return!0},t}();function $(t){var e=[];if(g(t))return{result:e,error:"Empty"};if(!Array.isArray(t))return{result:e,error:"Not an array"};for(var n=[],r=0;r<t.length;r++){var i=t[r];if(i){var o=X.deserialize(i);o?e.push(o):n.push(r)}else n.push(r)}return{result:e,error:n.length>0?"Invalid campaign definitions at indexes: "+n.toString():void 0}}e.CampaignDefinition=X,e.FilterValidCampaignDefinitions=$;var tt=function(){function t(t){if(g(t))throw new Error("storage must not be null");this.storage=t}return t.prototype.load=function(){var t,e=this.storage.read(o.FileType.CampaignDefinitions);if(g(e))return[];try{t=JSON.parse(e)}catch(t){return s.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed(t.toString()),[]}return $(t).result},t.prototype.loadAsync=function(){var t=this.load();return new Promise((function(e,n){e(t)}))},t}();e.FileSystemCampaignDefinitionProvider=tt},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GovernanceServiceClientState=e.GovernanceServiceSurveyType=void 0,function(t){t[t.Unknown=0]="Unknown",t[t.Feedback=1]="Feedback",t[t.Nps=2]="Nps",t[t.Psat=4]="Psat",t[t.Bps=6]="Bps",t[t.Fps=8]="Fps",t[t.Nlqs=18]="Nlqs",t[t.GenericMessagingSurface=22]="GenericMessagingSurface",t[t.Intercept=24]="Intercept"}(e.GovernanceServiceSurveyType||(e.GovernanceServiceSurveyType={})),function(t){t[t.Disabled=0]="Disabled",t[t.InitializationFailed=1]="InitializationFailed",t[t.Enabled=2]="Enabled"}(e.GovernanceServiceClientState||(e.GovernanceServiceClientState={}))},function(t,e,n){"use strict";var r=n(10),i=n(9),o=n(19),a=n(3),s=a.getDistantFuture,u=a.getDistantPast,c=a.isNOU,l=a.isDate,p=function(){function t(t){if(c(t))throw new Error("data must not be null");if(c(t.id)||""===t.id)throw new Error("data.id must not be null or empty");if(c(t.governedChannelType)&&(t.governedChannelType=i.GovernedChannelType.getDefault()),c(t.expirationTimeUtc)||""===t.expirationTimeUtc)throw new Error("data.expirationTimeUtc must not be null or empty");if(c(t.activationEvent))throw new Error("data.activationEvent must not be null");(c(t.backEndIdentifier)||""===t.backEndIdentifier)&&(t.backEndIdentifier=t.id),c(t.launcherType)&&(t.launcherType=r.LAUNCHER_TYPE_DEFAULT),this.data=t}return t.prototype.getId=function(){return this.data.id},t.prototype.getBackEndId=function(){return this.data.backEndIdentifier},t.prototype.getGovernedChannelType=function(){return this.data.governedChannelType},t.prototype.getRawStartTimeUtc=function(){return this.data.startTimeUtc},t.prototype.getStartTimeUtc=function(){if(c(this.data.startTimeUtc))return u();var t=new Date(this.data.startTimeUtc);return l(t)?t:s()},t.prototype.getExpirationTimeUtc=function(){if(c(this.data.expirationTimeUtc))return u();var t=new Date(this.data.expirationTimeUtc);return l(t)?t:u()},t.prototype.getRawExpirationTimeUtc=function(){return this.data.expirationTimeUtc},t.prototype.isActiveForDate=function(t){return!c(t)&&(t>=this.getStartTimeUtc()&&t<=this.getExpirationTimeUtc())},t.prototype.getActivationEvent=function(){return this.data.activationEvent},t.prototype.getPreferredLaunchType=function(){return this.data.preferredLaunchType},t.prototype.isAdditionalDataRequested=function(t){if(c(this.data.additionalDataRequested))return!1;for(var e=0,n=this.data.additionalDataRequested;e<n.length;e++){if(n[e]===t)return!0}return!1},t.prototype.getLauncherType=function(){return this.data.launcherType},t.prototype.getMetadata=function(){return this.data.metadata},t.prototype.getBusinessLevel=function(){return this.data.businessLevel},t.prototype.getMaxLaunches=function(){return this.data.maxLaunches},t.prototype.getMaxLaunchesPerSession=function(){return this.data.maxLaunchesPerSession},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(o.DOM_TYPE_TAGNAME);e.appendChild(t.createTextNode(o.DOM_TYPE_VALUE));var n=t.createElement(o.DOM_ID_TAGNAME);return n.appendChild(t.createTextNode(this.getBackEndId())),[e,n]},t.prototype.getJsonElements=function(){var t={};t[o.JSON_ID_KEYNAME]=this.getBackEndId();var e={};return e[o.JSON_SURVEY_KEYNAME]=t,e},t}();!function(t){var e=function(){this.preferredLaunchType="Default"};t.SurveyDataSourceData=e}(p||(p={})),t.exports=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Survey=void 0;var r=n(10),i=n(12),o=n(3),a=function(){function t(){}return t.prototype.getCampaignId=function(){return this.getSurveyInfo().getBackEndId()},t.prototype.getLauncherType=function(){return this.getSurveyInfo().getLauncherType()},t.prototype.getClientFeedbackId=function(){return this.clientFeedbackId},t.prototype.submit=function(){var t=r.Type[this.getType()],e=i.FloodgateEngine.getTransportFactory().makeTransporter(t);e.setManifestValues(this.getJsonElements()),this.clientFeedbackId=e.getClientFeedbackId(),e.submit()},t.prototype.getPreGeneratedClientFeedbackId=function(){return this.clientFeedbackId?this.clientFeedbackId:this.clientFeedbackId=o.guid()},t}();e.Survey=a},function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.SchemaObject=void 0;var i=function(){function t(e){t.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_SchemaObject"},t.getBaseTypes=function(){return[]},t.getTypeNameFor=function(t){return t&&t.H_?t.H_.T_:void 0},t.getBaseTypesFor=function(t){return t&&t.H_&&t.H_.B_?t.H_.B_:[]},t.getAllTypesFor=function(e){var n=t.getTypeNameFor(e);return n?r([n],t.getBaseTypesFor(e),!0):[]},t.matchesTypesFor=function(e,n){if(!Array.isArray(n)||0===n.length)return!0;for(var r=t.getTypeNameFor(e),i=t.getBaseTypesFor(e),o=0,a=n;o<a.length;o++){var s=a[o];if(s===r)return!0;if(i.indexOf(s)>=0)return!0}return!1},t.assign=function(t,e,n){if(n)for(var r=0,i=Object.keys(n);r<i.length;r++){var o=i[r];e[o]=n[o]}return e.H_=t.H_,e},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.SchemaObject=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Governor=e.DEFAULT_TEACHING_MESSAGE_COOLDOWN=void 0;var r=n(9),i=n(29),o=n(3).isNOU;e.DEFAULT_TEACHING_MESSAGE_COOLDOWN=15;var a=function(t,e){this.name=t,this.cooldownSeconds=e},s=function(){function t(t){if(this.channels=[],!t)throw new Error("channelStateProvider must not be null");this.channelStateProvider=t,this.loadChannels()}return t.GetChannelCoolDown=function(e){var n=t.defaultChannelData[e];return n?n.cooldownSeconds:0},t.SetDefaultChannelCoolDown=function(e,n){var r=t.defaultChannelData[e];r&&(r.cooldownSeconds=n)},t.prototype.refreshChannelData=function(){this.loadChannels()},t.prototype.getAvailableChannelData=function(){var t=[];for(var e in this.channels)if(this.channels.hasOwnProperty(e)){var n=this.channels[e];n.isOpen()&&t.push(n)}return t},t.prototype.isChannelOpen=function(t){if(o(t))throw new Error("type must not be null");return this.channels[t].isOpen()},t.prototype.startChannelCooldown=function(t,e){if(o(t))throw new Error("type must not be null");e=e||new Date,this.channels[t].setCooldownStartTime(e),this.saveChannelStates()},t.prototype.saveChannelStates=function(){var t=[];for(var e in this.channels)if(this.channels.hasOwnProperty(e)){var n=this.channels[e],r=new i.GovernedChannelState(n.getType(),n.getCooldownStartTime());t.push(r)}this.channelStateProvider.save(t)},t.prototype.loadChannels=function(){for(var e in this.loadChannelStatesFromProvider(),r.GovernedChannelType)if(r.GovernedChannelType.hasOwnProperty(e)){var n=Number(e);if(isNaN(n)||this.channels[n])continue;var i=t.defaultChannelData[n],o=new r.GovernedChannel(n,i.name,i.cooldownSeconds,null);this.channels[n]=o}},t.prototype.loadChannelStatesFromProvider=function(){this.channels=[];var e=this.channelStateProvider.load();for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],o=i.getType(),a=t.defaultChannelData[o],s=new r.GovernedChannel(o,a.name,a.cooldownSeconds,i.getCooldownStartTime());this.channels[s.getType()]=s}},t.minute=60,t.hour=60*t.minute,t.day=24*t.hour,t.defaultChannelData=[new a(r.GovernedChannelType[r.GovernedChannelType.Standard],14*t.day),new a(r.GovernedChannelType[r.GovernedChannelType.Urgent],0),new a(r.GovernedChannelType[r.GovernedChannelType.Banner],15*t.day),new a(r.GovernedChannelType[r.GovernedChannelType.TeachingMessage],e.DEFAULT_TEACHING_MESSAGE_COOLDOWN*t.day)],t}();e.Governor=s},function(t,e,n){"use strict";var r;!function(t){!function(t){t[t.None=0]="None",t[t.Critical=1]="Critical"}(t.BusinessLevel||(t.BusinessLevel={})),t.DOM_TYPE_TAGNAME="Type",t.DOM_TYPE_VALUE="Survey",t.DOM_ID_TAGNAME="SurveyID",t.JSON_SURVEY_KEYNAME="survey",t.JSON_ID_KEYNAME="surveyId"}(r||(r={})),t.exports=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MergeAndUpdateSurveyActivationStats=e.MergeAndUpdateCampaignStates=e.MergeAndUpdateGovernedChannelStates=e.makeSettingItemValue=e.extractSettingItemValueSubString=e.ItemCollection=void 0;var r=n(26),i=function(){function t(){this.items={},this.itemCount=0}return t.prototype.add=function(t,e){this.items[t]||this.itemCount++,this.items[t]=e},t.prototype.find=function(t){return this.items[t]},t.prototype.remove=function(t){var e=this.items[t];return e&&(delete this.items[t],this.itemCount--),e},t.prototype.count=function(){return this.itemCount},t}();e.ItemCollection=i,e.extractSettingItemValueSubString=function(t){if(!t)return t;var e=t.indexOf(o)+o.length,n=t.indexOf(a);return e<0||n<0?t:t.substring(e,n)},e.makeSettingItemValue=function(t){return t?o+t+a:o+a},e.MergeAndUpdateGovernedChannelStates=function(t,e){var n=new i;if(!t&&!e)return n;if(!t)return n.add(0,e),n;if(!e)return n.add(0,t),n.add(1,t),n;var r=[],o=[];return t&&t.forEach((function(t){for(var n,i=-1,a=0;a<e.length;a++)if((n=e[a]).getType()===t.getType()){i=a;break}if(-1===i)return r.push(t),void o.push(t);t.getCooldownStartTime()>n.getCooldownStartTime()?(r.push(t),o.push(t)):r.push(n),e.splice(i,1)})),e&&e.forEach((function(t){r.push(t)})),n.add(0,r),o.length>0&&n.add(1,o),n},e.MergeAndUpdateCampaignStates=function(t,e){var n=new i;if(!t&&!e)return n;if(!t)return n.add(0,e),n;if(!e)return n.add(0,t),n.add(1,t),n;var r=[],o=[];return t&&t.forEach((function(t){for(var n,i=new Date,a=-1,s=0;s<e.length;s++)if((n=e[s]).CampaignId===t.CampaignId){a=s;break}return-1===a?(r.push(t),void o.push(t)):n.LastCooldownEndTimeUtc>i?(r.push(n),void e.splice(a,1)):t.LastCooldownEndTimeUtc>i?(r.push(t),o.push(t),void e.splice(a,1)):(t.getCooldownStartDate()>n.getCooldownStartDate()||t.getCooldownStartDate()===n.getCooldownStartDate()&&t.LastNominationTimeUtc>n.LastNominationTimeUtc?(r.push(t),o.push(t)):r.push(n),void e.splice(a,1))})),e&&e.forEach((function(t){r.push(t)})),n.add(0,r),o.length>0&&n.add(1,o),n},e.MergeAndUpdateSurveyActivationStats=function(t,e){var n=new i;if(!t&&!e)return n;if(!t)return n.add(0,e),n;if(!e)return n.add(0,t),n.add(1,t),n;var o=new r.SurveyStatCollectionActivation,a=new r.SurveyStatCollectionActivation,s=t.getStats(),u=e.getStats();for(var c in s)if(s.hasOwnProperty(c)){var l=u[c];if(!l){o.addStats(c,s[c]),a.addStats(c,s[c]);continue}s[c].ActivationTimeUtc>l.ActivationTimeUtc?(o.addStats(c,s[c]),a.addStats(c,s[c])):o.addStats(c,u[c]),delete u[c]}for(var c in u)u.hasOwnProperty(c)&&o.addStats(c,u[c]);n.add(0,o);var p=a.getStats();for(var d in p)if(p.hasOwnProperty(d)){n.add(1,a);break}return n};var o="<data>",a="</data>"},function(t,e,n){"use strict";var r=n(11),i=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.question)throw new Error("data.question must not be null or empty");this.data=t,this.userComment=""}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getType=function(){return"Comment"},t.prototype.getQuestion=function(){return this.data.question},t.prototype.setSubmittedText=function(t){this.userComment=t},t.prototype.getSubmittedText=function(){return this.userComment},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(r.DOM_COMMENT_TAGNAME);return e.appendChild(t.createTextNode(this.getSubmittedText())),[e]},t.prototype.getJsonElements=function(){var t={};return t[r.JSON_COMMENT_KEYNAME]=this.getSubmittedText(),t},t.prototype.getComponentJson=function(){var t;return(t={})[r.JSON_QUESTION_KEYNAME]=this.getQuestion(),t},t}();!function(t){var e=function(){};t.CommentComponentData=e}(i||(i={})),t.exports=i},function(t,e,n){"use strict";var r=n(11),i=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.question)throw new Error("data.question must not be null or empty");if(!t.title)throw new Error("data.title must not be null or empty");if(!t.yesButtonLabel)throw new Error("data.yesButtonLabel must not be null or empty");if(!t.noButtonLabel)throw new Error("data.noButtonLabel must not be null or empty");this.data=t,this.selectedButton=0}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getType=function(){return"Prompt"},t.prototype.getTitle=function(){return this.data.title},t.prototype.getQuestion=function(){return this.data.question},t.prototype.getYesButtonText=function(){return this.data.yesButtonLabel},t.prototype.getNoButtonText=function(){return this.data.noButtonLabel},t.prototype.setButtonSelected=function(t){t&&(this.selectedButton=t)},t.prototype.getButtonSelected=function(){return this.selectedButton},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(r.DOM_PROMPT_TAGNAME);return e.appendChild(t.createTextNode(this.promptButtonToString(this.getButtonSelected()))),[e]},t.prototype.getJsonElements=function(){var t={};return t[r.JSON_PROMPT_KEYNAME]=this.promptButtonToString(this.getButtonSelected()),t},t.prototype.getComponentJson=function(){var t;return(t={})[r.JSON_TITLE_KEYNAME]=this.getTitle(),t[r.JSON_QUESTION_KEYNAME]=this.getQuestion(),t[r.JSON_PROMPTYESTEXT_KEYNAME]=this.getYesButtonText(),t[r.JSON_PROMPTNOTEXT_KEYNAME]=this.getNoButtonText(),t},t.prototype.promptButtonToString=function(t){switch(t){case 0:return"Unselected";case 1:return"Yes";case 2:return"No";default:return"Unknown"}},t}();!function(t){var e=function(){};t.PromptComponentData=e}(i||(i={})),t.exports=i},function(t,e,n){"use strict";var r=n(11),i=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.question)throw new Error("data.question must not be null or empty");if(!t.ratingValuesAscending||t.ratingValuesAscending.length<2)throw new Error("data.ratingValuesAscending must not be null or have less than two choices");t.ratingValuesAscending.forEach((function(t){if(!t)throw new Error("rating values must not contain null or empty")})),this.data=t,this.selectedIndex=-1}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getType=function(){return"Rating"},t.prototype.getQuestion=function(){return this.data.question},t.prototype.getRatingValuesAscending=function(){return this.data.ratingValuesAscending},t.prototype.getSelectedRating=function(){return this.isRatingIndexValid(this.selectedIndex)?this.data.ratingValuesAscending[this.selectedIndex]:""},t.prototype.setSelectedRatingIndex=function(t){this.isRatingIndexValid(t)?this.selectedIndex=t:this.selectedIndex=-1},t.prototype.getSelectedRatingIndex=function(){return this.selectedIndex},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(r.DOM_RATING_TAGNAME);return this.isRatingIndexValid(this.getSelectedRatingIndex())?e.appendChild(t.createTextNode(this.getNormalizedRatingScore().toFixed(6))):e.appendChild(t.createTextNode("Not rated")),[e]},t.prototype.getJsonElements=function(){var t={};return this.isRatingIndexValid(this.getSelectedRatingIndex())?t[r.JSON_RATING_KEYNAME]=this.getNormalizedRatingScore():t[r.JSON_RATING_KEYNAME]="Not rated",t},t.prototype.getComponentJson=function(){var t;return(t={})[r.JSON_QUESTION_KEYNAME]=this.getQuestion(),t[r.JSON_RATINGOPTIONS_KEYNAME]=this.getRatingValuesAscending(),t},t.prototype.getNormalizedRatingScore=function(){return this.isRatingIndexValid(this.getSelectedRatingIndex())?this.data.isZeroBased?this.selectedIndex/(this.data.ratingValuesAscending.length-1):(this.selectedIndex+1)/this.data.ratingValuesAscending.length:-1},t.prototype.isRatingIndexValid=function(t){return t>=0&&t<this.data.ratingValuesAscending.length},t}();!function(t){var e=function(){};t.RatingComponentData=e}(i||(i={})),t.exports=i},function(t,e,n){"use strict";var r=n(52),i=n(8),o=n(53),a=n(30),s=n(3),u=[],c=0,l={},p=function(){function t(t,e){if(this.activityContext={},!t)throw new Error("callback must not be null");this.trackedActivityMap={},this.callback=t,this.loggerCallback=e}return t.resetSessionActivity=function(){l={}},t.prototype.logActivity=function(t,e,n){void 0===e&&(e=1),this.logActivity_private(t,0,e,null,n)},t.prototype.logActivityStartTime=function(t,e){this.logActivity_private(t,1,0,e,null)},t.prototype.logActivityStopTime=function(t,e){this.logActivity_private(t,2,0,e,null)},t.prototype.SetActivityTrackingContracts=function(t,e){void 0===e&&(e=new a.SurveyStatCollectionEventActivity);var n=0;if(t&&0!==t.length&&e){for(var s={},u=[],c=0,p=t;c<p.length;c++){var d=p[c],g=d.trackingSet;if(-1===u.indexOf(d.surveyId)){u.push(d.surveyId);for(var h=e.getBySurveyId(d.surveyId),f=[g.getList().length],v=new Array(g.getList().length),y=0,m=0,S=0,T=g.getList();S<T.length;S++){var C=T[S];if(f[m]=0,C.getIsAggregate()&&h&&y<h.Counts.length&&(f[m]=h.Counts[y++]),l[C.getActivity()])for(var E=0,_=l[C.getActivity()];E<_.length;E++){var A=_[E];if(A.surveyId===d.surveyId){v[m]=A;break}}m++}var I=new r(g);I.initCounts(f,v,!1);for(var b=0,w=I.generateActivityIndexList();b<w.length;b++){var O=w[b],F=new o.IndexedTracker;F.index=O.index,F.surveyId=d.surveyId,F.tracker=I,s[O.activity]||(s[O.activity]=[]),s[O.activity].push(F)}}else n++}if(n>0){var D=this.loggerCallback&&this.loggerCallback();D&&D.log_Error(i.TelemetryEvent.SurveyActivity.SetActivityTrackingContracts.DuplicateSurveyID,"Duplicate surveyId passed in activityTrackingContracts. Duplicate count: "+n)}this.copyObject(this.trackedActivityMap,s)}},t.prototype.clearSurveys=function(){var t=this;Object.getOwnPropertyNames(this.trackedActivityMap).forEach((function(e){delete t.trackedActivityMap[e]}))},t.prototype.saveSessionTrackingActivity=function(t){l[t]=this.trackedActivityMap[t]},t.prototype.getCount=function(t,e){var n=this.getIndexedTracker(t,e);return n?n.tracker.getCount(n.index):0},t.prototype.getSessionCount=function(t,e){var n=this.getIndexedTracker(t,e);return n?n.tracker.getSessionCount(n.index):0},t.prototype.moveSessionCountIntoBaseCount=function(t,e){var n=this.getIndexedTracker(t,e);return n?n.tracker.moveSessionCountIntoBaseCount(n.index):0},t.prototype.getSurveyIds=function(t){if(!s.isNOU(t)){var e=this.trackedActivityMap[t];if(e)return e.map((function(t){return t.surveyId}))}},t.prototype.setCallback=function(t){this.callback=t},t.prototype.UpdateActivityTrackingContracts=function(t){if(s.isNOU(t)||0===Object.keys(t).length)this.clearSurveys();else for(var e in this.trackedActivityMap)if(this.trackedActivityMap.hasOwnProperty(e))for(var n=this.trackedActivityMap[e],r=n.length-1;r>=0;--r)t.hasOwnProperty(n[r].surveyId)||n.splice(r,1)},t.prototype.getIndexedTracker=function(t,e){var n=this.trackedActivityMap[t];if(n){for(var r,i=0,o=n;i<o.length;i++){var a=o[i];if(a.surveyId===e){r=a;break}}return r}},t.prototype.resetQueuedActivities=function(){u=[]},t.prototype.logActivity_private=function(e,n,r,o,a){var s=this;if(this.callback&&!this.callback.shouldAcceptActivity(e)&&(c++,u.length<t.MaxPendingActivitiesQueueSize&&u.push({activityName:e,logType:n,increment:r,timestamp:o})),e===t.FloodgateStartActivityName){if(c>0){var l=u.slice(0,25).map((function(t){return t.activityName})),p=this.loggerCallback&&this.loggerCallback();p&&p.log_Event(i.TelemetryEvent.SurveyActivity.LogActivity.EventsReprocessed,{ActivityNames:JSON.stringify(l),Count:u.length,Dropped:c-u.length},.05),u.map((function(t){return s.logActivity_core(t.activityName,t.logType,t.increment,t.timestamp,a)}))}c=0,this.resetQueuedActivities()}this.logActivity_core(e,n,r,o,a)},t.prototype.logActivity_core=function(t,e,n,r,i){var o=this.trackedActivityMap[t];if(o&&0!==o.length){var a=[];if(o.length>1){a=new Array(o.length);for(var u=0;u<a.length;u++)a[u]=u;a=s.fyShuffle(a)}else a.push(0);for(var c=0,l=a;c<l.length;c++){var p=o[l[c]];switch(e){case 1:p.tracker.startTime(p.index,r);continue;case 2:n=p.tracker.stopTime(p.index,r);case 0:break;default:continue}if(i){var d=p.surveyId;this.activityContext[d]=this.activityContext[d]||[],this.activityContext[d].push({activityName:t,context:i})}if(2===p.tracker.incrementActivity(p.index,n)){this.executeCallback(p.surveyId);break}}}},t.prototype.executeCallback=function(t){this.callback.run(t,this.activityContext[t])},t.prototype.copyObject=function(t,e){Object.keys(e).forEach((function(n){t[n]=e[n]}))},t.FloodgateStartActivityName="FloodgateFirstStart",t.MaxPendingActivitiesQueueSize=100,t}();t.exports=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FileBasedCampaignStateProvider=e.HostBasedCampaignStateProvider=e.CampaignStateProviderFactory=e.CampaignState=void 0;var r=n(6),i=n(8),o=n(12),a=n(20),s=n(3),u=r.FileType,c=s.getDistantPast,l=s.isBoolean,p=s.isDate,d=s.isNOU,g=s.isString,h=s.isUtcDatetimeString,f=s.stringToDate,v=function(){function t(t,e,n,r,i,o,a,s,u,c,l,p){if(this.CampaignId=t,this.LastNominationTimeUtc=e,this.LastNominationBuildNumber=n,this.DeleteAfterSecondsWhenStale=r,this.ForceCandidacy=i,this.IsCandidate=o,this.DidCandidateTriggerSurvey=a,this.LastSurveyActivatedTimeUtc=s,this.LastSurveyId=u,this.LastSurveyStartTimeUtc=c,this.LastSurveyExpirationTimeUtc=l,this.LastCooldownEndTimeUtc=p,!this.validate())throw new Error("Constructor arguments are not valid")}return t.deserialize=function(e){var n;if(!e)return null;try{n=new t(e.CampaignId,e.LastNominationTimeUtc,e.LastNominationBuildNumber,e.DeleteAfterSecondsWhenStale,!1,e.IsCandidate,e.DidCandidateTriggerSurvey,e.LastSurveyActivatedTimeUtc,e.LastSurveyId,e.LastSurveyStartTimeUtc,e.LastSurveyExpirationTimeUtc,e.LastCooldownEndTimeUtc)}catch(t){return o.FloodgateEngine.getTelemetryLogger().log_Event(i.TelemetryEvent.CampaignState.Deserialize.Failed,{ErrorMessage:t.toString()}),null}return n},t.prototype.validate=function(){if(!this.CampaignId||!g(this.CampaignId))return!1;if(d(this.LastNominationBuildNumber)||!g(this.LastNominationBuildNumber))return!1;if(!s.isNumber(this.DeleteAfterSecondsWhenStale)||this.DeleteAfterSecondsWhenStale<0)return!1;if(!l(this.IsCandidate)||!l(this.DidCandidateTriggerSurvey))return!1;if(this.IsCandidate){if(d(this.LastSurveyStartTimeUtc)||d(this.LastSurveyExpirationTimeUtc))return!1;if(!g(this.LastSurveyId))return!1}if(this.DidCandidateTriggerSurvey&&d(this.LastSurveyActivatedTimeUtc))return!1;if(d(this.LastSurveyId))this.LastSurveyId="";else if(!g(this.LastSurveyId))return!1;if(h(this.LastNominationTimeUtc))this.LastNominationTimeUtc=f(this.LastNominationTimeUtc);else if(!p(this.LastNominationTimeUtc))return!1;if(d(this.LastSurveyActivatedTimeUtc))this.LastSurveyActivatedTimeUtc=c();else if(h(this.LastSurveyActivatedTimeUtc))this.LastSurveyActivatedTimeUtc=f(this.LastSurveyActivatedTimeUtc);else if(!p(this.LastSurveyActivatedTimeUtc))return!1;if(d(this.LastSurveyStartTimeUtc))this.LastSurveyStartTimeUtc=c();else if(h(this.LastSurveyStartTimeUtc))this.LastSurveyStartTimeUtc=f(this.LastSurveyStartTimeUtc);else if(!p(this.LastSurveyStartTimeUtc))return!1;if(d(this.LastSurveyExpirationTimeUtc))this.LastSurveyExpirationTimeUtc=c();else if(h(this.LastSurveyExpirationTimeUtc))this.LastSurveyExpirationTimeUtc=f(this.LastSurveyExpirationTimeUtc);else if(!p(this.LastSurveyExpirationTimeUtc))return!1;if(d(this.LastCooldownEndTimeUtc))this.LastCooldownEndTimeUtc=c();else if(h(this.LastCooldownEndTimeUtc))this.LastCooldownEndTimeUtc=f(this.LastCooldownEndTimeUtc);else if(!p(this.LastCooldownEndTimeUtc))return!1;return!0},t.prototype.markCurrentSurveyTakenOnDate=function(t,e,n){this.DidCandidateTriggerSurvey=n,this.LastSurveyActivatedTimeUtc=null!=t?t:new Date,this.LastCooldownEndTimeUtc=s.addSecondsWithoutOverflow(this.LastSurveyActivatedTimeUtc,e)},t.prototype.getCooldownStartDate=function(){return this.IsCandidate?this.DidCandidateTriggerSurvey?this.LastSurveyActivatedTimeUtc:this.LastSurveyStartTimeUtc:this.LastNominationTimeUtc},t}();e.CampaignState=v;var y=function(){function t(){}return t.make=function(t,e){return e?new S(t,e):new T(t)},t}();e.CampaignStateProviderFactory=y;var m=function(){},S=function(){function t(t,e){if(!e)throw new Error("host-based storage must not be null");this.hostBasedStorage=e,t&&(this.fileBasedStateProvider=new T(t))}return t.prototype.load=function(){var t,e=this.getStatesFromHost();return this.fileBasedStateProvider&&(t=this.fileBasedStateProvider.load()),a.MergeAndUpdateCampaignStates(t,e).find(0)},t.prototype.save=function(t){var e=this;if(t){var n=this.getStatesFromHost(),r=a.MergeAndUpdateCampaignStates(t,n),i=r.find(1),o=r.find(0);i&&i.forEach((function(t){var n=a.makeSettingItemValue(JSON.stringify(t));e.hostBasedStorage.upsertSettingItem(u[u.CampaignStates],t.CampaignId,n)})),this.fileBasedStateProvider&&this.fileBasedStateProvider.save(o)}},t.prototype.getStatesFromHost=function(){var t=[],e=this.hostBasedStorage.readSettingList(u[u.CampaignStates]);for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],s=a.extractSettingItemValueSubString(r),c={};try{c=JSON.parse(s);var l=v.deserialize(c);l&&t.push(l)}catch(t){o.FloodgateEngine.getTelemetryLogger().log_Event(i.TelemetryEvent.HostBasedCampaignStateProvider.GetStatesFromHost.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+t.toString()+".  Input:"+s})}}return t},t}();e.HostBasedCampaignStateProvider=S;var T=function(){function t(t){if(!t)throw new Error("storage must not be null");this.storage=t}return t.prototype.load=function(){var t,e=this.storage.read(u.CampaignStates);if(!e)return[];try{t=JSON.parse(e);var n=[];return t&&t.CampaignStates&&t.CampaignStates.forEach((function(t){var e=v.deserialize(t);e&&n.push(e)})),n}catch(t){return o.FloodgateEngine.getTelemetryLogger().log_Event(i.TelemetryEvent.FileBasedCampaignStateProvider.Load.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+t.toString()+".  Input:"+e}),[]}},t.prototype.save=function(t){if(t){var e=new m;e.CampaignStates=t;var n=JSON.stringify(e);this.storage.write(u.CampaignStates,n)}},t}();e.FileBasedCampaignStateProvider=T},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.SurveyActivationStats=e.FileBasedSurveyActivationStatsProvider=e.HostBasedSurveyActivationStatsProvider=e.SurveyActivationStatsProviderFactory=e.SurveyStatCollectionActivation=void 0;var o=n(6),a=o.FileType,s=n(10),u=n(8),c=n(12),l=n(20),p=n(27),d=n(3),g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.fromJson=function(t){var n,r=new e;if(!t)return c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.SurveyStatCollectionActivation.FromJson.Failed,{ErrorMessage:"Input json is null or empty."}),r;try{n=JSON.parse(t)}catch(t){return c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.SurveyStatCollectionActivation.FromJson.Failed,{ErrorMessage:"Json parsing failed. "+t.toString()}),r}return r.deserialize(n)?r:new e},e.toJson=function(t){return t||(c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.SurveyStatCollectionActivation.ToJson.Failed,{ErrorMessage:"Input json is null or empty."}),t=new e),JSON.stringify(t)},e.prototype.accumulate=function(t){if(t){var e=t.getStats();for(var n in e)e.hasOwnProperty(n)&&this.addStats(n,e[n])}},e.prototype.deserialize=function(t){var e=t.Surveys,n=new Date;for(var r in e)if(e.hasOwnProperty(r)){var i=new y;i.deserialize(e[r])&&i.ExpirationTimeUtc>n&&this.addStats(r,i)}return this.validate()},e.prototype.validate=function(){return d.isObject(this.getStats())},e}(p.SurveyStatCollection);e.SurveyStatCollectionActivation=g;var h=function(){function t(){}return t.make=function(t,e){return e?new f(t,e):new v(t)},t}();e.SurveyActivationStatsProviderFactory=h;var f=function(){function t(t,e){if(!e)throw new Error("host-based storage must not be null");this.hostBasedStorage=e,t&&(this.fileBasedStorageProvider=new v(t))}return t.prototype.load=function(){var t=this.getSurveyStatsFromHost(),e=new g;return this.fileBasedStorageProvider&&(e=this.fileBasedStorageProvider.load()),l.MergeAndUpdateSurveyActivationStats(e,t).find(0)},t.prototype.save=function(t){if(t){var e=this.getSurveyStatsFromHost(),n=l.MergeAndUpdateSurveyActivationStats(t,e),r=n.find(1),i=n.find(0);if(r){var o=r.getStats();for(var s in o)if(o.hasOwnProperty(s)){var u=l.makeSettingItemValue(JSON.stringify(o[s]));this.hostBasedStorage.upsertSettingItem(a[a.SurveyActivationStats],s,u)}}this.fileBasedStorageProvider&&this.fileBasedStorageProvider.save(i)}},t.prototype.getSurveyStatsFromHost=function(){var t=new g,e=this.hostBasedStorage.readSettingList(a[a.SurveyActivationStats]),n=new Date;for(var r in e)if(e.hasOwnProperty(r)){var i=l.extractSettingItemValueSubString(e[r]),o=new y;try{var s=JSON.parse(i);o.deserialize(s)}catch(t){c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.HostBasedSurveyActivationStatsProvider.GetSurveyStatsFromHost.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+t.toString()+".  Input:"+i})}o.ExpirationTimeUtc<=n?this.hostBasedStorage.deleteSettingItem(a[a.SurveyActivationStats],r):t.addStats(r,o)}return t},t}();e.HostBasedSurveyActivationStatsProvider=f;var v=function(){function t(t){if(!t)throw new Error("storage must not be null");this.storage=t}return t.prototype.load=function(){var t=this.storage.read(o.FileType.SurveyActivationStats);return t?g.fromJson(t):new g},t.prototype.save=function(t){if(t){var e=g.toJson(t);this.storage.write(o.FileType.SurveyActivationStats,e)}},t}();e.FileBasedSurveyActivationStatsProvider=v;var y=function(){function t(){this.SurveyLaunchCount=0,this.SurveyLaunchCountPerSession=0}return t.prototype.deserialize=function(t){var e,n;return this.ActivationTimeUtc=t.ActivationTimeUtc,this.ExpirationTimeUtc=t.ExpirationTimeUtc,this.Type=t.Type,this.SurveyLaunchCount=null!==(e=t.SurveyLaunchCount)&&void 0!==e?e:0,this.SurveyLaunchCountPerSession=null!==(n=t.SurveyLaunchCountPerSession)&&void 0!==n?n:0,this.validate()},t.prototype.validate=function(){return!!d.isUtcDatetimeString(this.ActivationTimeUtc)&&(this.ActivationTimeUtc=d.stringToDate(this.ActivationTimeUtc),!!d.isUtcDatetimeString(this.ExpirationTimeUtc)&&(this.ExpirationTimeUtc=d.stringToDate(this.ExpirationTimeUtc),!(!d.isNumber(this.SurveyLaunchCount)||!d.isNumber(this.SurveyLaunchCountPerSession))&&d.isEnumValue(this.Type,s.Type)))},t}();e.SurveyActivationStats=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SurveyStatCollection=void 0;var r=function(){function t(){this.Surveys={},this.Surveys={}}return t.prototype.addStats=function(t,e){this.Surveys[t]=e},t.prototype.getBySurveyId=function(t){return this.Surveys[t]},t.prototype.getStats=function(){return this.Surveys},t}();e.SurveyStatCollection=r},function(t,e,n){"use strict";var r=n(11),i=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.customerVoiceFormId)throw new Error("data.formID must not be null or empty");this.data=t}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getType=function(){return"CVSurvey"},t.prototype.getFormId=function(){return this.data.customerVoiceFormId},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");return[t.createElement(r.DOM_CVSURVEY_TAGNAME)]},t.prototype.getJsonElements=function(){var t={};return t[r.JSON_CVSURVEY_KEYNAME]=this.getFormId(),t},t.prototype.getComponentJson=function(){var t;return(t={})[r.JSON_CVSURVEYFORMID_KEYNAME]=this.getFormId(),t},t}();!function(t){var e=function(){};t.CVSurveyComponentData=e}(i||(i={})),t.exports=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FileBasedGovernedChannelStateProvider=e.HostBasedGovernedChannelStateProvider=e.GovernedChannelStateProviderFactory=e.GovernedChannelState=void 0;var r=n(6),i=n(8),o=n(12),a=n(9),s=n(20),u=n(3),c=r.FileType,l=function(){function t(t,e){if(this.ChannelType=t,this.CooldownStartTimeUtc=e,!this.validate())throw new Error("Constructor arguments are not valid")}return t.deserialize=function(e){var n;if(!e)return null;try{n=new t(e.ChannelType,e.CooldownStartTimeUtc)}catch(t){return o.FloodgateEngine.getTelemetryLogger().log_Event(i.TelemetryEvent.GovernedChannelState.Deserialize.Failed,{ErrorMessage:t.toString()}),null}return n},t.prototype.validate=function(){return!!u.isEnumValue(this.ChannelType,a.GovernedChannelType)&&(u.isUtcDatetimeString(this.CooldownStartTimeUtc)?this.CooldownStartTimeUtc=u.stringToDate(this.CooldownStartTimeUtc):!u.isNOU(this.CooldownStartTimeUtc)&&u.isDate(this.CooldownStartTimeUtc)||(this.CooldownStartTimeUtc=u.getDistantPast()),!0)},t.prototype.getType=function(){return this.ChannelType},t.prototype.getCooldownStartTime=function(){return this.CooldownStartTimeUtc},t}();e.GovernedChannelState=l;var p=function(){function t(){}return t.make=function(t,e){return e?new g(t,e):new h(t)},t}();e.GovernedChannelStateProviderFactory=p;var d=function(){},g=function(){function t(t,e){if(!e)throw new Error("host-based storage must not be null");this.hostBasedStorage=e,t&&(this.fileBasedStateProvider=new h(t))}return t.prototype.load=function(){var t,e=this.getStatesFromHost();return this.fileBasedStateProvider&&(t=this.fileBasedStateProvider.load()),s.MergeAndUpdateGovernedChannelStates(t,e).find(0)},t.prototype.save=function(t){var e=this;if(t){var n=this.getStatesFromHost(),r=s.MergeAndUpdateGovernedChannelStates(t,n),i=r.find(1),o=r.find(0);i&&i.forEach((function(t){var n=s.makeSettingItemValue(JSON.stringify(t));e.hostBasedStorage.upsertSettingItem(c[c.GovernedChannelStates],String(t.getType()),n)})),this.fileBasedStateProvider&&this.fileBasedStateProvider.save(o)}},t.prototype.getStatesFromHost=function(){var t=[],e=this.hostBasedStorage.readSettingList(c[c.GovernedChannelStates]);for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],a=s.extractSettingItemValueSubString(r),u={};try{u=JSON.parse(a);var p=l.deserialize(u);p&&t.push(p)}catch(t){o.FloodgateEngine.getTelemetryLogger().log_Event(i.TelemetryEvent.HostBasedGovernedChannelStateProvider.GetStatesFromHost.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+t.toString()+".  Input:"+a})}}return t},t}();e.HostBasedGovernedChannelStateProvider=g;var h=function(){function t(t){if(!t)throw new Error("storage must not be null");this.storage=t}return t.prototype.load=function(){var t,e=this.storage.read(c.GovernedChannelStates);if(!e)return[];try{t=JSON.parse(e);var n=[];return t&&t.ChannelStates&&t.ChannelStates.forEach((function(t){var e=l.deserialize(t);e&&n.push(e)})),n}catch(t){return o.FloodgateEngine.getTelemetryLogger().log_Event(i.TelemetryEvent.FileBasedGovernedChannelStateProvider.Load.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+t.toString()+".  Input:"+e}),[]}},t.prototype.save=function(t){if(t){var e=new d;e.ChannelStates=t;var n=JSON.stringify(e);this.storage.write(c.GovernedChannelStates,n)}},t}();e.FileBasedGovernedChannelStateProvider=h},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.SurveyEventActivityStats=e.SurveyStatCollectionEventActivity=void 0;var o=n(8),a=n(12),s=n(27),u=n(3),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.fromJson=function(t){var n,r=new e;if(!t)return r;try{n=JSON.parse(t)}catch(t){return a.FloodgateEngine.getTelemetryLogger().log_Event(o.TelemetryEvent.SurveyStatCollectionEventActivity.FromJson.Failed,{ErrorMessage:"Json parsing failed. "+t.toString()}),r}return r.deserialize(n)?r:new e},e.toJson=function(t){return t||(a.FloodgateEngine.getTelemetryLogger().log_Event(o.TelemetryEvent.SurveyStatCollectionEventActivity.ToJson.Failed,{ErrorMessage:"Input json is null or empty."}),t=new e),JSON.stringify(t)},e.prototype.accumulate=function(t){if(t){var e=t.getStats();for(var n in e)if(e.hasOwnProperty(n)){var r=this.getBySurveyId(n);if(r||((r=new l).Counts=[],this.addStats(n,r)),r.ExpirationTimeUtc=e[n].ExpirationTimeUtc,r.Counts.length<e[n].Counts.length){var i=r.Counts.slice();r.Counts=i}for(var o=0;o<e[n].Counts.length;o++)r.Counts[o]||(r.Counts[o]=0),r.Counts[o]+=e[n].Counts[o]}}},e.prototype.deserialize=function(t){var e=t.Surveys,n=new Date;for(var r in e)if(e.hasOwnProperty(r)){var i=new l;i.deserialize(e[r])&&i.ExpirationTimeUtc>n&&this.addStats(r,i)}return this.validate()},e.prototype.validate=function(){return u.isObject(this.getStats())},e}(s.SurveyStatCollection);e.SurveyStatCollectionEventActivity=c;var l=function(){function t(){}return t.prototype.deserialize=function(t){return this.ExpirationTimeUtc=t.ExpirationTimeUtc,this.Counts=t.Counts,this.validate()},t.prototype.validate=function(){if(!this.Counts)return!1;for(var t=0;t<this.Counts.length;t++){var e=this.Counts[t];if(!u.isNumber(e))return!1;e<0&&(this.Counts[t]=0)}return!!u.isUtcDatetimeString(this.ExpirationTimeUtc)&&(this.ExpirationTimeUtc=u.stringToDate(this.ExpirationTimeUtc),!0)},t}();e.SurveyEventActivityStats=l},function(t,e){},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=["af","am","ar","as","az","be","bg","bn-BD","bn-IN","bs","ca","ca-Es-VALENCIA","chr-Cher","cs","cy","da","de","el","en-GB","es","es-MX","et","eu","fa","fi","fil","fr","fr-CA","ga","gd","gl","gu","ha-Latn-NG","he","hi","hr","hu","hy","id","is","it","ja","ka","kk","km-KH","kn","ko","kok","ky","lb","lo","lt","lv","mi","mk","ml","mn","mr","ms","mt","nb-NO","ne","nl","nn-NO","or","pa","pl","prs","pt-BR","pt-PT","quz","ro","ru","sd","si","sk","sl","sq","sr-Cyrl-BA","sr-Cyrl-RS","sr-Latn-RS","sv","sw","ta","te","th","tk","tr","tt","ug","uk","ur","uz-Latn-UZ","vi","zh-Hans","zh-Hant"],i={"ZH-CN":"zh-Hans","ZH-HK":"zh-Hant","ZH-MO":"zh-Hant","ZH-SG":"zh-Hans","ZH-TW":"zh-Hant"};function o(t){var e=t.toLocaleUpperCase();if(e in i)return i[e];for(var n=0,o=r;n<o.length;n++){if((c=o[n]).toUpperCase()===e)return c}for(var a=e.split("-")[0],s=0,u=r;s<u.length;s++){var c;if((c=u[s]).toUpperCase()===a)return c}return"en"}},function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),e.ItemChanges=e.ItemOperation=void 0,i(n(59),e);var o=n(60);Object.defineProperty(e,"ItemOperation",{enumerable:!0,get:function(){return o.ItemOperation}}),Object.defineProperty(e,"ItemChanges",{enumerable:!0,get:function(){return o.ItemChanges}}),i(n(61),e),i(n(62),e),i(n(63),e),i(n(64),e),i(n(65),e),i(n(17),e),i(n(66),e),i(n(67),e)},function(t,e,n){"use strict";t.exports=n(35).polyfill()},function(t,e,n){t.exports=function(){"use strict";function t(t){return"function"==typeof t}var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=0,r=void 0,i=void 0,o=function(t,e){d[n]=t,d[n+1]=e,2===(n+=2)&&(i?i(g):m())},a="undefined"!=typeof window?window:void 0,s=a||{},u=s.MutationObserver||s.WebKitMutationObserver,c="undefined"==typeof self&&"[object process]"==={}.toString.call(Object({})),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var t=setTimeout;return function(){return t(g,1)}}var d=new Array(1e3);function g(){for(var t=0;t<n;t+=2)(0,d[t])(d[t+1]),d[t]=void 0,d[t+1]=void 0;n=0}var h,f,v,y,m=void 0;function S(t,e){var n=this,r=new this.constructor(E);void 0===r[C]&&N(r);var i=n._state;if(i){var a=arguments[i-1];o((function(){return D(i,r,a,n._result)}))}else O(n,r,t,e);return r}function T(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(E);return A(e,t),e}c?m=function(){return Object({}).nextTick(g)}:u?(f=0,v=new u(g),y=document.createTextNode(""),v.observe(y,{characterData:!0}),m=function(){y.data=f=++f%2}):l?((h=new MessageChannel).port1.onmessage=g,m=function(){return h.port2.postMessage(0)}):m=void 0===a?function(){try{var t=Function("return this")().require("vertx");return void 0!==(r=t.runOnLoop||t.runOnContext)?function(){r(g)}:p()}catch(t){return p()}}():p();var C=Math.random().toString(36).substring(2);function E(){}function _(e,n,r){n.constructor===e.constructor&&r===S&&n.constructor.resolve===T?function(t,e){1===e._state?b(t,e._result):2===e._state?w(t,e._result):O(e,void 0,(function(e){return A(t,e)}),(function(e){return w(t,e)}))}(e,n):void 0===r?b(e,n):t(r)?function(t,e,n){o((function(t){var r=!1,i=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(n,e,(function(n){r||(r=!0,e!==n?A(t,n):b(t,n))}),(function(e){r||(r=!0,w(t,e))}),t._label);!r&&i&&(r=!0,w(t,i))}),t)}(e,n,r):b(e,n)}function A(t,e){if(t===e)w(t,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(r=e),null===r||"object"!==i&&"function"!==i)b(t,e);else{var n=void 0;try{n=e.then}catch(e){return void w(t,e)}_(t,e,n)}var r,i}function I(t){t._onerror&&t._onerror(t._result),F(t)}function b(t,e){void 0===t._state&&(t._result=e,t._state=1,0!==t._subscribers.length&&o(F,t))}function w(t,e){void 0===t._state&&(t._state=2,t._result=e,o(I,t))}function O(t,e,n,r){var i=t._subscribers,a=i.length;t._onerror=null,i[a]=e,i[a+1]=n,i[a+2]=r,0===a&&t._state&&o(F,t)}function F(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,a=0;a<e.length;a+=3)r=e[a],i=e[a+n],r?D(n,r,i,o):i(o);t._subscribers.length=0}}function D(e,n,r,i){var o=t(r),a=void 0,s=void 0,u=!0;if(o){try{a=r(i)}catch(t){u=!1,s=t}if(n===a)return void w(n,new TypeError("A promises callback cannot return that same promise."))}else a=i;void 0!==n._state||(o&&u?A(n,a):!1===u?w(n,s):1===e?b(n,a):2===e&&w(n,a))}var L=0;function N(t){t[C]=L++,t._state=void 0,t._result=void 0,t._subscribers=[]}var P=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(E),this.promise[C]||N(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?b(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&b(this.promise,this._result))):w(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;void 0===this._state&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===T){var i=void 0,o=void 0,a=!1;try{i=t.then}catch(t){a=!0,o=t}if(i===S&&void 0!==t._state)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(n===U){var s=new n(E);a?w(s,o):_(s,t,i),this._willSettleAt(s,e)}else this._willSettleAt(new n((function(e){return e(t)})),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;void 0===r._state&&(this._remaining--,2===t?w(r,n):this._result[e]=n),0===this._remaining&&b(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;O(t,void 0,(function(t){return n._settledAt(1,e,t)}),(function(t){return n._settledAt(2,e,t)}))},t}(),U=function(){function e(t){this[C]=L++,this._result=this._state=void 0,this._subscribers=[],E!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e((function(e){A(t,e)}),(function(e){w(t,e)}))}catch(e){w(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):this.then(e,e)},e}();return U.prototype.then=S,U.all=function(t){return new P(this,t).promise},U.race=function(t){var n=this;return e(t)?new n((function(e,r){for(var i=t.length,o=0;o<i;o++)n.resolve(t[o]).then(e,r)})):new n((function(t,e){return e(new TypeError("You must pass an array to race."))}))},U.resolve=T,U.reject=function(t){var e=new this(E);return w(e,t),e},U._setScheduler=function(t){i=t},U._setAsap=function(t){o=t},U._asap=o,U.polyfill=function(){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=U},U.Promise=U,U}()},function(t,e,n){"use strict";var r;!function(t){var e=function(){function t(){}return t.AppLaunch="AppLaunch",t.AppUsageTime="AppUsageTime",t.AppResume="AppResume",t}();t.ActivityName=e}(r||(r={})),t.exports=r},function(t,e,n){"use strict";var r;!function(t){t.RoamingSettingIdMap={CampaignStates:1258,GovernedChannelStates:1257,SurveyActivationStats:1259}}(r||(r={})),t.exports=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CampaignManager=void 0;var r=n(12),i=n(3),o=n(13),a=n(25),s=n(39),u=n(8),c=n(19),l=i.getDistantFuture,p=i.getDistantPast,d=i.isArray,g=i.isNOU,h=function(){function t(t,e,n,r,i,o,a){if(!t)throw new Error("stateProvider must not be null");if(!d(e))throw new Error("definitionProviders is either null or not an array type");if(!n)throw new Error("stringProvider must not be null");if(g(i))throw new Error("currentBuildNumber must not be null");this.campaignStates={},this.campaignDefinitions={},this.userFacts=[],this.stateProvider=t,this.definitionProviders=e,this.stringProvider=n,this.userFactsProvider=a,this.environmentProvider=r,this.currentBuildNumber=i,o=o||new Date}return t.isStateUpForNomination=function(e,n,r,i){if(!e||!n)return!1;if(r=r||new Date,e.ForceCandidacy)return!0;var o=n.nominationScheme.getCampaignCooldown(e.IsCandidate&&e.DidCandidateTriggerSurvey);return!!o&&(!!t.hasBuildChangeDurationElapsed(o,e.LastNominationBuildNumber,i)||t.hasTimeIntervalDurationElapsed(o,e.getCooldownStartDate(),r))},t.isDateInRange=function(t,e,n){return t=t||new Date,e=e||p(),n=n||l(),e.getTime()<=t.getTime()&&n.getTime()>=t.getTime()},t.hasTimeIntervalDurationElapsed=function(t,e,n){if(g(t)||!(t instanceof o.CampaignDurationTimeInterval))return!1;if(!e||!n)return!1;var r=i.addSecondsWithoutOverflow(e,t.intervalSeconds);return n.getTime()>=r.getTime()},t.hasBuildChangeDurationElapsed=function(t,e,n){return!g(t)&&t instanceof o.CampaignDurationSingleBuildChange&&(g(e)||g(n)?null===e!=(null===n):!(e===n))},t.isCampaignInScope=function(e,n,r,i){return!!e&&(n=n||new Date,!!t.isDateInRangeWithDefinition(n,e)&&!(e.scope&&((e.scope instanceof o.CampaignScopeUserFactAny||e.scope instanceof o.CampaignScopeUserFactAll)&&e.scope.setUserFactsProvider(i),e.scope instanceof o.CampaignScopeEnvironmentCrossProduct&&e.scope.setEnvironmentProvider(r),!e.scope.isInScope())))},t.isDateInRangeWithDefinition=function(e,n){return!!n&&(e=e||new Date,t.isDateInRange(e,n.startTime?n.startTime:l(),n.endTime))},t.prototype.getActiveSurveys=function(){var t={},e=this.getPrioritizedCampaigns();for(var n in this.campaignStates)if(this.campaignStates.hasOwnProperty(n)){var r=this.campaignStates[n];if(!r.IsCandidate)continue;var i=e[r.CampaignId];if(!i)continue;var o=s.CampaignSurveyFactory.makeSurvey(r,i,this.stringProvider);if(!o)continue;t[o.getSurveyInfo().getId()]=o}return t},t.prototype.onCampaignSurveyActivated=function(t,e,n){var r=this.campaignStates[t];if(r){e=e||new Date;var i=this.campaignDefinitions[t].nominationScheme.cooldownPeriod.asTimeIntervalSeconds();r.markCurrentSurveyTakenOnDate(e,i,n),this.saveCurrentState()}},t.prototype.getCampaignStates=function(){return this.campaignStates},t.prototype.getCampaignDefinitions=function(){return this.campaignDefinitions},t.prototype.getUserFacts=function(){return this.userFacts},t.prototype.onSurveyActivated=function(t,e){t&&this.onCampaignSurveyActivated(t.getBackEndId(),new Date,e)},t.prototype.refreshSurveyDefinitions=function(t,e){this.refreshSurveyDefinitionsPrivate(t,e||new Date)},t.prototype.refreshSurveyDefinitionsAsync=function(t,e){var n=this;return new Promise((function(r,i){n.refreshSurveyDefinitionsPrivateAsync(t,e||new Date).then((function(){r()})).catch((function(t){i(t)}))}))},t.prototype.getAppSurveys=function(){return this.getActiveSurveys()},t.prototype.saveCurrentState=function(){var t=i.makeArrayFromObjectValuesSortedByKeyString(this.campaignStates);this.stateProvider.save(t)},t.prototype.refreshSurveyDefinitionsPrivate=function(t,e){this.campaignStates={},this.campaignDefinitions={},this.userFacts=[],this.loadAndFilterCampaignData(e,t),this.evaluateCampaigns(e)},t.prototype.refreshSurveyDefinitionsPrivateAsync=function(t,e){this.campaignStates={},this.campaignDefinitions={},this.userFacts=[];var n=this;return new Promise((function(r,i){n.loadAndFilterCampaignDataAsync(e,t).then((function(){n.evaluateCampaigns(e),r()})).catch((function(t){i(t)}))}))},t.prototype.loadAndFilterCampaignDataAsync=function(t,e){t=t||new Date;for(var n=[],i=[],o=this.userFactsProvider&&this.userFactsProvider.loadAsync(),a=0,s=Object.keys(this.definitionProviders);a<s.length;a++){var c=s[a],l=this.definitionProviders[c],p=l&&l.loadAsync();g(p)||(p=p.catch((function(){r.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed("Failed to load from campaign definition provider"),Promise.resolve()})),i.push(p))}var h=this;return new Promise((function(a,s){Promise.all(i).then((function(i){for(var s=0,c=Object.keys(i);s<c.length;s++){var l=i[c[s]];d(l)&&(n=n.concat(l))}var p=function(r){h.userFacts=r||[],h.FilterCampaignData(t,e,n),a()};g(o)?p():o.then((function(t){p(t)})).catch((function(){r.FloodgateEngine.getTelemetryLogger().log_Error(u.TelemetryEvent.Floodgate.UserFactsLoad.Failed,"Failed to load from user facts provider"),p()}))})).catch((function(t){r.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed("Failed to load from campaign definition provider")}))}))},t.prototype.loadAndFilterCampaignData=function(t,e){t=t||new Date;for(var n=[],i=0,o=Object.keys(this.definitionProviders);i<o.length;i++){var a=o[i];try{var s=this.definitionProviders[a]&&this.definitionProviders[a].load();d(s)&&(n=n.concat(s))}catch(t){r.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed("Failed to load from campaign definition provider. "+t.toString())}}try{this.userFacts=this.userFactsProvider&&this.userFactsProvider.load()||[]}catch(t){r.FloodgateEngine.getTelemetryLogger().log_Error(u.TelemetryEvent.Floodgate.UserFactsLoad.Failed,"Failed to load from user facts provider. "+t)}this.FilterCampaignData(t,e,n)},t.prototype.FilterCampaignData=function(e,n,r){var o={};for(var a in r)if(r.hasOwnProperty(a)){if(o[(p=r[a]).campaignId]=p,n&&n.indexOf(p.governedChannelType)<0&&p.businessLevel!==c.BusinessLevel.Critical)continue;if(!t.isCampaignInScope(p,e,this.environmentProvider,this.userFactsProvider))continue;this.campaignDefinitions[p.campaignId]=p}var s=this.stateProvider.load(),u=[];for(var a in s)if(s.hasOwnProperty(a)){var l=s[a];this.campaignDefinitions.hasOwnProperty(l.CampaignId)||u.push(l),this.campaignStates[l.CampaignId]=l}for(var a in u)if(u.hasOwnProperty(a)){if(!(l=u[a]))continue;var p,d=!1;(p=o[l.CampaignId])?t.isStateUpForNomination(l,p,e,this.currentBuildNumber)&&(d=!0):l.LastNominationTimeUtc.getTime()<=i.subtractSecondsWithoutOverflow(e,l.DeleteAfterSecondsWhenStale).getTime()&&(d=!0),d&&delete this.campaignStates[l.CampaignId]}},t.prototype.getPrioritizedCampaigns=function(){var t=this,e={},n={};return Object.keys(this.campaignDefinitions||[]).forEach((function(r){var i=t.campaignDefinitions[r];e[r]=i,(i.tags&&i.tags.length>0?i.tags:[""]).forEach((function(t){var e=t+"_"+i.governedChannelType;n[e]=n[e]||[],n[e].push(i)}))})),Object.keys(n).forEach((function(t){var r=n[t];if(!(r.length<=1)){var i=r.reduce((function(t,e){return(e.primaryPriority||0)<(t.primaryPriority||0)?e:t}),r[0]).primaryPriority;g(i)||r.forEach((function(t){var n=t.primaryPriority;!g(t.primaryPriority)&&n>i&&delete e[t.campaignId]}))}})),e},t.prototype.evaluateCampaigns=function(e){for(var n in e=e||new Date,this.campaignDefinitions)if(this.campaignDefinitions.hasOwnProperty(n)){var r=this.campaignDefinitions[n],o=this.campaignStates[r.campaignId];if(!o||t.isStateUpForNomination(o,r,e,this.currentBuildNumber)){var s=o?o.LastSurveyId:"",u=o?o.LastSurveyStartTimeUtc:p(),c=o?o.LastSurveyExpirationTimeUtc:p(),l=o?o.LastSurveyActivatedTimeUtc:p(),d=o?o.LastCooldownEndTimeUtc:p(),g=o&&o.ForceCandidacy||r.nominationScheme.evaluateNominationRules();g&&(s=i.guid(),u=r.nominationScheme.calculateSurveyStartTimeFromDate(e),c=r.nominationScheme.calculateSurveyExpirationTimeFromSurveyStartTime(u));var h=new a.CampaignState(r.campaignId,e,this.currentBuildNumber,r.nominationScheme.getActiveSurveyTimeIntervalSeconds(),!1,g,!1,l,s,u,c,d);this.campaignStates[h.CampaignId]=h}}},t}();e.CampaignManager=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CampaignSurveyFactory=void 0;var r=n(10),i=n(40),o=n(43),a=n(44),s=n(46),u=n(47),c=n(49),l=n(50),p=n(15),d=n(3),g=n(13),h=d.dateToShortUtcString,f=d.isNOU,v=function(){function t(){}return t.makeSurvey=function(e,n,r){if(!(e&&n&&n.surveyTemplate&&r))return null;var i=t.makeSurveyDataSourceData(e,n),o=n.surveyTemplate;return o instanceof g.CampaignSurveyTemplateNps5PointStatic?l.make5Point(i,r):o instanceof g.CampaignSurveyTemplateNps11PointStatic?l.make11Point(i,r):o instanceof g.CampaignSurveyTemplateFps?a.makeFps(i,r,o):o instanceof g.CampaignSurveyTemplateNlqs?c.makeNlqs(i,r,o):o instanceof g.CampaignSurveyTemplateNps?l.makeCustom(i,r,o):o instanceof g.CampaignSurveyTemplateGenericMessagingSurface?s.makeCustom(i):o instanceof g.CampaignSurveyTemplateIntercept?u.makeIntercept(i,r,o):null},t.makeSurveyDataSourceData=function(e,n){if(!e||!n||!n.surveyTemplate)return null;var i=n.surveyTemplate,o=new p.SurveyDataSourceData;return o.activationEvent=t.makeEvent(e,i.activationEvent),o.metadata=t.makeMetadata(i.metadata),o.id=e.LastSurveyId,o.backEndIdentifier=e.CampaignId,o.expirationTimeUtc=h(e.LastSurveyExpirationTimeUtc),o.governedChannelType=n.governedChannelType,o.startTimeUtc=h(e.LastSurveyStartTimeUtc),o.additionalDataRequested=n.additionalDataRequested||[],o.launcherType=n.launcherType||r.LAUNCHER_TYPE_DEFAULT,o.preferredLaunchType=n.surveyTemplate.preferredLaunchType||"Default",o.businessLevel=n.businessLevel,f(i.maxLaunches)||(o.maxLaunches=i.maxLaunches),f(i.maxLaunchesPerSession)||(o.maxLaunchesPerSession=i.maxLaunchesPerSession),o},t.makeCountedActivityEventData=function(t){if(!t)return null;var e=new i.CountedActivityEventData;return e.activity=t.activity,e.count=t.count,e.isAggregate=t.isAggregate,e},t.makeCountedActivityEvent=function(e,n){if(!e||!n)return null;var r=t.makeCountedActivityEventData(n);return r?new i.CountedActivityEvent(r):null},t.makeCountedActivitySequenceEvent=function(e,n){if(!e||!n)return null;var r=new i.CountedActivitySequenceEventData;r.sequence=[];for(var o=0,a=n.sequence;o<a.length;o++){var s=a[o],u=t.makeCountedActivityEventData(s);if(!u)return null;r.sequence.push(u)}return new i.CountedActivitySequenceEvent(r)},t.makeEvent=function(e,n){return n instanceof g.CampaignSurveyEventCountedActivity?t.makeCountedActivityEvent(e,n):n instanceof g.CampaignSurveyEventCountedActivitySequence?t.makeCountedActivitySequenceEvent(e,n):null},t.makeMetadata=function(t){if(f(t)||f(t.contentMetadata))return null;var e=new o.Metadata;return e.contentMetadata=t.contentMetadata,new o.SurveyMetadata(e)},t}();e.CampaignSurveyFactory=v},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CountedActivitySequenceEventData=e.CountedActivitySequenceEvent=e.CountedActivityEventData=e.CountedActivityEvent=void 0;var r=n(41),i=n(42),o=function(){function t(t){if(!t)throw new Error("data must not be null");if(t.count<=0)throw new Error("count must be greater than 0");if(!t.activity||0===t.activity.length)throw new Error("activity must not be null or an empty string");this.data=t}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getActivity=function(){return this.data.activity},t.prototype.getCount=function(){return this.data.count},t.prototype.isAggregate=function(){return this.data.isAggregate},t.prototype.getType=function(){return"CountedActivity"},t.prototype.getTrackingSet=function(){var t=new Array;return t.push(new r.ActivityTrackingData(this.data.activity,this.data.count,this.data.isAggregate)),new i.ActivityTrackingSet(!1,t)},t}();e.CountedActivityEvent=o;var a=function(){};e.CountedActivityEventData=a;var s=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.sequence)throw new Error("data.sequence must not be null");if(0===t.sequence.length)throw new Error("data.sequence size must be greater than 0");this.data=[];for(var e=0,n=t.sequence;e<n.length;e++){var r=n[e];this.data.push(new o(r))}}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getSequence=function(){return this.data},t.prototype.getType=function(){return"CountedActivitySequence"},t.prototype.getTrackingSet=function(){for(var t=new Array,e=0,n=this.data;e<n.length;e++){var o=n[e];t.push(new r.ActivityTrackingData(o.getActivity(),o.getCount(),o.isAggregate()))}return new i.ActivityTrackingSet(!0,t)},t}();e.CountedActivitySequenceEvent=s;var u=function(){function t(){}return t.prototype.CountedActivitySequenceEventData=function(){},t}();e.CountedActivitySequenceEventData=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ActivityTrackingData=void 0;var r=function(){function t(t,e,n){this.activity=t,this.count=e,this.isAggregate=n}return t.prototype.getActivity=function(){return this.activity},t.prototype.getCount=function(){return this.count},t.prototype.setCount=function(t){this.count=t},t.prototype.getIsAggregate=function(){return this.isAggregate},t}();e.ActivityTrackingData=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ActivityTrackingSet=void 0;var r=n(3),i=function(){function t(t,e){this.isOrdered=t,this.list=e}return t.prototype.getIsOrdered=function(){return this.isOrdered},t.prototype.getList=function(){return this.list},t.prototype.getActivityTrackingInfo=function(t,e){var n;if(0===this.list.length)return n={Activities:[],IsListOrdered:this.isOrdered},JSON.stringify(n);for(var i=0,o=this.list;i<o.length;i++){var a=o[i],s=t.getCount(a.getActivity(),e),u={Activity:a.getActivity(),ActualCount:s,Count:a.getCount(),IsAggregate:a.getIsAggregate(),IsDiscrete:s%1==0};r.isNOU(n)?n={Activities:[u],IsListOrdered:this.isOrdered}:n.Activities.push(u)}return JSON.stringify(n)},t}();e.ActivityTrackingSet=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=e.SurveyMetadata=void 0;var r=n(3),i=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.contentMetadata)throw new Error("content metadata must not be null");if(!r.isObject(t.contentMetadata))throw new Error("content metadata must be of object type");this.data=t}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getContentMetadata=function(){return this.data.contentMetadata},t}();e.SurveyMetadata=i;var o=function(){};e.Metadata=o},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=n(10),a=n(11),s=n(21),u=n(28),c=n(45),l=n(22),p=n(23),d=n(3),g=n(16),h=n(15),f=d.isNOU,v=function(t){function e(e){var n=t.call(this)||this;if(f(e))throw new Error("data must not be null");return n.surveyInfo=new h(e.baseData),n.prompt=new l(e.promptData),n.question=e.commentData?new s(e.commentData):null,n.rating=e.ratingData?new p(e.ratingData):null,n.multipleChoice=e.multipleChoiceData?new c(e.multipleChoiceData):null,n.cvSurvey=e.cvSurveyData?new u(e.cvSurveyData):null,n}return i(e,t),e.make=function(t){try{return new e(t)}catch(t){return null}},e.makeFps=function(t,n,r){if(f(t)||f(n)||f(r))return null;var i=[],o=[],a=r.content;if(f(a)||f(a.prompt)||f(a.rating)&&f(a.multipleChoice)&&f(a.comment))return null;var d=new e.FpsSurveyData;if(d.baseData=t,d.promptData=new l.PromptComponentData,d.promptData.title=n.getCustomString(a.prompt.title),d.promptData.question=n.getCustomString(a.prompt.question),d.promptData.yesButtonLabel=n.getCustomString(a.prompt.yesLabel),d.promptData.noButtonLabel=n.getCustomString(a.prompt.noLabel),f(d.promptData.title)||f(d.promptData.question)||f(d.promptData.yesButtonLabel)||f(d.promptData.noButtonLabel))return null;if(a.rating){d.ratingData=new p.RatingComponentData,d.ratingData.question=n.getCustomString(a.rating.question),d.ratingData.isZeroBased=a.rating.isZeroBased;for(var g=0,h=a.rating.ratingValuesAscending;g<h.length;g++){var v=h[g],y=n.getCustomString(v);if(f(y))return null;i.push(y)}if(d.ratingData.ratingValuesAscending=i,f(d.ratingData.question)||f(d.ratingData.ratingValuesAscending))return null}if(a.multipleChoice){d.multipleChoiceData=new c.MultipleChoiceComponentData,d.multipleChoiceData.question=n.getCustomString(a.multipleChoice.question),d.multipleChoiceData.minNumberOfSelectedOptions=a.multipleChoice.minNumberOfSelectedOptions,d.multipleChoiceData.maxNumberOfSelectedOptions=a.multipleChoice.maxNumberOfSelectedOptions;for(var m=0,S=a.multipleChoice.availableOptions;m<S.length;m++){v=S[m],y=n.getCustomString(v);if(f(y))return null;o.push(y)}if(d.multipleChoiceData.availableOptions=o,f(d.multipleChoiceData.question)||f(d.multipleChoiceData.availableOptions))return null}return a.comment&&(d.commentData=new s.CommentComponentData,d.commentData.question=n.getCustomString(a.comment.question),f(d.commentData.question))||a.cvSurvey&&(d.cvSurveyData=new u.CVSurveyComponentData,d.cvSurveyData.customerVoiceFormId=a.cvSurvey.customerVoiceFormId,f(d.cvSurveyData.customerVoiceFormId))?null:this.make(d)},e.prototype.getType=function(){return o.Type.Fps},e.prototype.getSurveyInfo=function(){return this.surveyInfo},e.prototype.getCommentComponent=function(){return this.question},e.prototype.getPromptComponent=function(){return this.prompt},e.prototype.getRatingComponent=function(){return this.rating},e.prototype.getMultipleChoiceComponent=function(){return this.multipleChoice},e.prototype.getCVSurveyComponent=function(){return this.cvSurvey},e.prototype.getComponent=function(t){switch(t){case"Comment":return this.getCommentComponent();case"Prompt":return this.getPromptComponent();case"Rating":return this.getRatingComponent();case"MultipleChoice":return this.getMultipleChoiceComponent();case"CVSurvey":return this.getCVSurveyComponent();default:return null}},e.prototype.getDomElements=function(t){if(f(t))throw new Error("Document must not be null");var e=t.createElement(o.DOM_FPS_TAGNAME);return this.getSurveyInfo().getDomElements(t).forEach((function(t){f(t)||e.appendChild(t)})),this.getCommentComponent().getDomElements(t).forEach((function(t){f(t)||e.appendChild(t)})),this.getRatingComponent()&&this.getRatingComponent().getDomElements(t).forEach((function(t){f(t)||e.appendChild(t)})),this.getMultipleChoiceComponent()&&this.getMultipleChoiceComponent().getDomElements(t).forEach((function(t){f(t)||e.appendChild(t)})),[e]},e.prototype.getJsonElements=function(){var t,e={};return(e=d.overrideValues(this.getSurveyInfo().getJsonElements(),e))[a.JSON_APPLICATION_KEYNAME]={},e[a.JSON_APPLICATION_KEYNAME][a.JSON_EXTENDEDMANIFESTDATA_KEYNAME]=JSON.stringify(((t={})[a.JSON_SURVEYSTRINGS_KEYNAME]=this.makeSurveyStrings(),t[a.JSON_SURVEYSPECIFICDATA_KEYNAME]=this.makeResponseString(),t)),e},e.prototype.makeResponseString=function(){var t={};return this.question&&(t[a.JSON_COMMENT_KEYNAME]=[this.getCommentComponent().getSubmittedText()]),this.multipleChoice&&(t[a.JSON_MULTIPLECHOICE_KEYNAME]=[this.getMultipleChoiceComponent().getOptionSelectedStates()]),this.rating&&(t[a.JSON_RATING_KEYNAME]=[{numberOfOptions:this.getRatingComponent().getRatingValuesAscending().length,selectedRating:this.getRatingComponent().getSelectedRatingIndex()}]),JSON.stringify(t)},e.prototype.makeSurveyStrings=function(){var t={};return this.prompt&&(t[a.JSON_PROMPT_KEYNAME]=this.prompt.getComponentJson()),this.rating&&(t[a.JSON_RATING_KEYNAME]=[this.rating.getComponentJson()]),this.question&&(t[a.JSON_COMMENT_KEYNAME]=[this.question.getComponentJson()]),this.multipleChoice&&(t[a.JSON_MULTIPLECHOICE_KEYNAME]=[this.multipleChoice.getComponentJson()]),JSON.stringify(t)},e}(g.Survey);!function(t){var e=function(){};t.FpsSurveyData=e}(v||(v={})),t.exports=v},function(t,e,n){"use strict";var r=n(11),i=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.question)throw new Error("data.question must not be null or empty");if(!t.availableOptions||t.availableOptions.length<2)throw new Error("data.availableOptions must not be null or have less than two choices");t.availableOptions.forEach((function(t){if(!t)throw new Error("Option values must not contain null or empty")})),this.data=t,this.optionStates=new Array(t.availableOptions.length);for(var e=0;e<this.optionStates.length;e++)this.optionStates[e]=!1}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getType=function(){return"MultipleChoice"},t.prototype.getQuestion=function(){return this.data.question},t.prototype.getAvailableOptions=function(){return this.data.availableOptions},t.prototype.getOptionSelectedStates=function(){return this.optionStates},t.prototype.getMinNumberofSelectedOptions=function(){return this.data.minNumberOfSelectedOptions},t.prototype.getMaxNumberofSelectedOptions=function(){return this.data.maxNumberOfSelectedOptions},t.prototype.setOptionSelectedStates=function(t){for(var e=0;e<t.length;e++)this.optionStates[e]=t[e]},t.prototype.ValidateMinNumberofSelectedOptions=function(){var t=0;return this.optionStates.forEach((function(e){e&&t++})),t>=this.getMinNumberofSelectedOptions()},t.prototype.ValidateMaxNumberofSelectedOptions=function(){var t=0;return this.optionStates.forEach((function(e){e&&t++})),t<=this.getMaxNumberofSelectedOptions()},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(r.DOM_MULTIPLECHOICE_TAGNAME);return e.appendChild(t.createTextNode(this.getOptionSelectedStates().toString())),[e]},t.prototype.getJsonElements=function(){var t={};return t[r.JSON_MULTIPLECHOICE_KEYNAME]=this.getOptionSelectedStates().toString(),t},t.prototype.getComponentJson=function(){var t;return(t={})[r.JSON_QUESTION_KEYNAME]=this.getQuestion(),t[r.JSON_RATINGOPTIONS_KEYNAME]=this.getAvailableOptions(),t},t}();!function(t){var e=function(){};t.MultipleChoiceComponentData=e}(i||(i={})),t.exports=i},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=n(10),a=n(3),s=n(16),u=n(15),c=a.isNOU,l=function(t){function e(e){var n=t.call(this)||this;if(!e)throw new Error("data must not be null");if(n.surveyInfo=new u(e.baseData),c(n.surveyInfo.getMetadata()))throw new Error("metadata must not be null");return n}return i(e,t),e.make=function(t){try{return new e(t)}catch(t){return null}},e.makeCustom=function(t){if(c(t))return null;var n=new e.GenericMessagingSurfaceSurveyData;return n.baseData=t,this.make(n)},e.prototype.getType=function(){return o.Type.GenericMessagingSurface},e.prototype.getSurveyInfo=function(){return this.surveyInfo},e.prototype.getComponent=function(t){return null},e.prototype.getDomElements=function(t){return[]},e.prototype.getJsonElements=function(){return{}},e}(s.Survey);!function(t){var e=function(){};t.GenericMessagingSurfaceSurveyData=e}(l||(l={})),t.exports=l},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=n(10),a=n(48),s=n(3),u=n(16),c=n(15),l=s.isNOU,p=function(t){function e(e){var n=t.call(this)||this;if(l(e))throw new Error("data must not be null");return n.surveyInfo=new c(e.baseData),n.intercept=new a(e.interceptData),n}return i(e,t),e.make=function(t){try{return new e(t)}catch(t){return null}},e.makeIntercept=function(t,n,r){if(l(t)||l(n)||l(r))return null;var i=r.content;if(l(i)||l(i.intercept))return null;var o=new e.InterceptSurveyData;return o.baseData=t,o.interceptData=new a.InterceptComponentData,o.interceptData.title=n.getCustomString(i.intercept.title),o.interceptData.question=n.getCustomString(i.intercept.question),o.interceptData.url=n.getCustomString(i.intercept.url),l(o.interceptData.title)||l(o.interceptData.question)||l(o.interceptData.url)?null:this.make(o)},e.prototype.getType=function(){return o.Type.Intercept},e.prototype.getSurveyInfo=function(){return this.surveyInfo},e.prototype.getInterceptComponent=function(){return this.intercept},e.prototype.getComponent=function(t){return"Intercept"===t?this.getInterceptComponent():null},e.prototype.getDomElements=function(t){return[]},e.prototype.getJsonElements=function(){return{}},e}(u.Survey);!function(t){var e=function(){};t.InterceptSurveyData=e}(p||(p={})),t.exports=p},function(t,e,n){"use strict";var r=n(11),i=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.question)throw new Error("data.question must not be null or empty");if(!t.title)throw new Error("data.title must not be null or empty");if(!t.url)throw new Error("data.url must not be null or empty");this.data=t}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getType=function(){return"Intercept"},t.prototype.getTitle=function(){return this.data.title},t.prototype.getQuestion=function(){return this.data.question},t.prototype.getUrl=function(){return this.data.url},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");return[t.createElement(r.DOM_INTERCEPT_TAGNAME)]},t.prototype.getJsonElements=function(){var t;return(t={})[r.JSON_INTERCEPT_KEYNAME]="",t},t.prototype.getComponentJson=function(){var t;return(t={})[r.JSON_TITLE_KEYNAME]=this.getTitle(),t[r.JSON_QUESTION_KEYNAME]=this.getQuestion(),t[r.JSON_INTERCEPTURL_KEYNAME]=this.getUrl(),t},t}();!function(t){var e=function(){};t.InterceptComponentData=e}(i||(i={})),t.exports=i},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=n(10),a=n(21),s=n(22),u=n(23),c=n(3),l=n(16),p=n(15),d=c.isNOU,g=c.overrideValues,h=function(t){function e(e){var n=t.call(this)||this;if(d(e))throw new Error("data must not be null");return n.surveyInfo=new p(e.baseData),n.prompt=new s(e.promptData),n.question=new a(e.commentData),n.rating=new u(e.ratingData),n}return i(e,t),e.make=function(t){try{return new e(t)}catch(t){return null}},e.makeNlqs=function(t,n,r){if(d(t)||d(n)||d(r))return null;var i=[],o=r.content;if(d(o)||d(o.comment)||d(o.prompt)||d(o.rating))return null;var c=new e.NlqsSurveyData;c.baseData=t,c.promptData=new s.PromptComponentData,c.ratingData=new u.RatingComponentData,c.commentData=new a.CommentComponentData,c.promptData.title=n.getCustomString(o.prompt.title),c.promptData.question=n.getCustomString(o.prompt.question),c.promptData.yesButtonLabel=n.getCustomString(o.prompt.yesLabel),c.promptData.noButtonLabel=n.getCustomString(o.prompt.noLabel),c.ratingData.question=n.getCustomString(o.rating.question),c.ratingData.isZeroBased=o.rating.isZeroBased,c.commentData.question=n.getCustomString(o.comment.question);for(var l=0,p=o.rating.ratingValuesAscending;l<p.length;l++){var g=p[l],h=n.getCustomString(g);if(d(h))return null;i.push(h)}return c.ratingData.ratingValuesAscending=i,d(c.ratingData.question)||d(c.commentData.question)||d(c.promptData.title)||d(c.promptData.question)||d(c.promptData.yesButtonLabel)||d(c.promptData.noButtonLabel)||d(c.ratingData.ratingValuesAscending)?null:this.make(c)},e.prototype.getType=function(){return o.Type.Nlqs},e.prototype.getSurveyInfo=function(){return this.surveyInfo},e.prototype.getCommentComponent=function(){return this.question},e.prototype.getPromptComponent=function(){return this.prompt},e.prototype.getRatingComponent=function(){return this.rating},e.prototype.getComponent=function(t){switch(t){case"Comment":return this.getCommentComponent();case"Prompt":return this.getPromptComponent();case"Rating":return this.getRatingComponent();default:return null}},e.prototype.getDomElements=function(t){if(d(t))throw new Error("Document must not be null");var e=t.createElement(o.DOM_NLQS_TAGNAME);return this.getSurveyInfo().getDomElements(t).forEach((function(t){d(t)||e.appendChild(t)})),this.getCommentComponent().getDomElements(t).forEach((function(t){d(t)||e.appendChild(t)})),this.getRatingComponent().getDomElements(t).forEach((function(t){d(t)||e.appendChild(t)})),[e]},e.prototype.getJsonElements=function(){var t={};return t=g(this.getSurveyInfo().getJsonElements(),t),t=g(this.getCommentComponent().getJsonElements(),t),t=g(this.getRatingComponent().getJsonElements(),t)},e}(l.Survey);!function(t){var e=function(){};t.NlqsSurveyData=e}(h||(h={})),t.exports=h},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=n(10),a=n(11),s=n(21),u=n(28),c=n(22),l=n(23),p=n(3),d=n(16),g=n(15),h=p.isNOU,f=p.overrideValues,v=function(t){function e(e){var n=t.call(this)||this;if(!e)throw new Error("data must not be null");return n.surveyInfo=new g(e.baseData),n.prompt=new c(e.promptData),n.question=new s(e.commentData),n.rating=new l(e.ratingData),n.cvSurvey=e.cvSurveyData?new u(e.cvSurveyData):null,n}return i(e,t),e.make=function(t){try{return new e(t)}catch(t){return null}},e.makeCustom=function(t,n,r){if(h(t)||h(n)||h(r))return null;var i=[],o=r.content;if(h(o)||h(o.comment)||h(o.prompt)||h(o.rating))return null;var a=new e.NpsSurveyData;a.baseData=t,a.promptData=new c.PromptComponentData,a.ratingData=new l.RatingComponentData,a.commentData=new s.CommentComponentData,a.promptData.title=n.getCustomString(o.prompt.title),a.promptData.question=n.getCustomString(o.prompt.question),a.promptData.yesButtonLabel=n.getCustomString(o.prompt.yesLabel),a.promptData.noButtonLabel=n.getCustomString(o.prompt.noLabel),a.ratingData.question=n.getCustomString(o.rating.question),a.ratingData.isZeroBased=o.rating.isZeroBased,a.commentData.question=n.getCustomString(o.comment.question);for(var p=0,d=o.rating.ratingValuesAscending;p<d.length;p++){var g=d[p],f=n.getCustomString(g);if(h(f))return null;i.push(f)}return a.ratingData.ratingValuesAscending=i,h(a.ratingData.question)||h(a.commentData.question)||h(a.promptData.title)||h(a.promptData.question)||h(a.promptData.yesButtonLabel)||h(a.promptData.noButtonLabel)||h(a.ratingData.ratingValuesAscending)||o.cvSurvey&&(a.cvSurveyData=new u.CVSurveyComponentData,a.cvSurveyData.customerVoiceFormId=o.cvSurvey.customerVoiceFormId,h(a.cvSurveyData.customerVoiceFormId))?null:this.make(a)},e.make5Point=function(t,n){if(!t||!n)return null;var r=new e.NpsSurveyData;r.baseData=t,r.ratingData=new l.RatingComponentData,r.ratingData.isZeroBased=!1,r.commentData=new s.CommentComponentData,r.promptData=new c.PromptComponentData,r.ratingData.question=n.loadStringResource(4),r.commentData.question=n.loadStringResource(21),r.promptData.title=n.loadStringResource(0),r.promptData.question=n.loadStringResource(1),r.promptData.yesButtonLabel=n.loadStringResource(2),r.promptData.noButtonLabel=n.loadStringResource(3);var i=new Array(5);return i[0]=n.loadStringResource(16),i[1]=n.loadStringResource(17),i[2]=n.loadStringResource(18),i[3]=n.loadStringResource(19),i[4]=n.loadStringResource(20),r.ratingData.question&&r.commentData.question&&r.promptData.title&&r.promptData.question&&r.promptData.yesButtonLabel&&r.promptData.noButtonLabel&&i[0]&&i[1]&&i[2]&&i[3]&&i[4]?(r.ratingData.ratingValuesAscending=i,this.make(r)):null},e.make11Point=function(t,n){if(!t||!n)return null;var r=new e.NpsSurveyData;r.baseData=t,r.ratingData=new l.RatingComponentData,r.ratingData.isZeroBased=!0,r.commentData=new s.CommentComponentData,r.promptData=new c.PromptComponentData,r.ratingData.question=n.loadStringResource(4),r.commentData.question=n.loadStringResource(21),r.promptData.title=n.loadStringResource(0),r.promptData.question=n.loadStringResource(1),r.promptData.yesButtonLabel=n.loadStringResource(2),r.promptData.noButtonLabel=n.loadStringResource(3);var i=new Array(11);return i[0]=n.loadStringResource(5),i[1]=n.loadStringResource(6),i[2]=n.loadStringResource(7),i[3]=n.loadStringResource(8),i[4]=n.loadStringResource(9),i[5]=n.loadStringResource(10),i[6]=n.loadStringResource(11),i[7]=n.loadStringResource(12),i[8]=n.loadStringResource(13),i[9]=n.loadStringResource(14),i[10]=n.loadStringResource(15),r.ratingData.question&&r.commentData.question&&r.promptData.title&&r.promptData.question&&r.promptData.yesButtonLabel&&r.promptData.noButtonLabel&&i[0]&&i[1]&&i[2]&&i[3]&&i[4]&&i[5]&&i[6]&&i[7]&&i[8]&&i[9]&&i[10]?(r.ratingData.ratingValuesAscending=i,this.make(r)):null},e.prototype.getType=function(){return o.Type.Nps},e.prototype.getSurveyInfo=function(){return this.surveyInfo},e.prototype.getCommentComponent=function(){return this.question},e.prototype.getPromptComponent=function(){return this.prompt},e.prototype.getRatingComponent=function(){return this.rating},e.prototype.getCVSurveyComponent=function(){return this.cvSurvey},e.prototype.getComponent=function(t){switch(t){case"Comment":return this.getCommentComponent();case"Prompt":return this.getPromptComponent();case"Rating":return this.getRatingComponent();case"CVSurvey":return this.getCVSurveyComponent();default:return null}},e.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(o.DOM_NPS_TAGNAME);return this.getSurveyInfo().getDomElements(t).forEach((function(t){t&&e.appendChild(t)})),this.getCommentComponent().getDomElements(t).forEach((function(t){t&&e.appendChild(t)})),this.getRatingComponent().getDomElements(t).forEach((function(t){t&&e.appendChild(t)})),[e]},e.prototype.getJsonElements=function(){var t,e={};return e=f(this.getSurveyInfo().getJsonElements(),e),e=f(this.getCommentComponent().getJsonElements(),e),(e=f(this.getRatingComponent().getJsonElements(),e))[a.JSON_APPLICATION_KEYNAME]={},e[a.JSON_APPLICATION_KEYNAME][a.JSON_EXTENDEDMANIFESTDATA_KEYNAME]=JSON.stringify(((t={})[a.JSON_SURVEYSTRINGS_KEYNAME]=this.makeSurveyStrings(),t)),e},e.prototype.makeSurveyStrings=function(){var t={};return this.prompt&&(t[a.JSON_PROMPT_KEYNAME]=this.prompt.getComponentJson()),this.rating&&(t[a.JSON_RATING_KEYNAME]=[this.rating.getComponentJson()]),this.question&&(t[a.JSON_COMMENT_KEYNAME]=[this.question.getComponentJson()]),JSON.stringify(t)},e}(d.Survey);!function(t){var e=function(){};t.NpsSurveyData=e}(v||(v={})),t.exports=v},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FloodgateSettings=void 0;var r=function(){function t(){}return t.toJson=function(t){return JSON.stringify(t)},t.fromJson=function(t){return JSON.parse(t)},t}();e.FloodgateSettings=r},function(t,e,n){"use strict";var r=function(){function t(t){if(!t)throw new Error("trackingSet must not be null");if(t.getList().length>32)throw new Error("trackingSet list size must be less than 32");this.isOrdered=t.getIsOrdered(),this.trackedActivities=t.getList(),this.currentIndex=0,this.activationMask=0,this.currentActivationFlags=0,this.isActivationByInitPending=!1,this.currentCounts=new Array(this.trackedActivities.length),this.currentStartTimes=new Array(this.trackedActivities.length),this.currentSessionCounts=new Array(this.trackedActivities.length);for(var e=0;e<this.trackedActivities.length;e++)this.currentCounts[e]=0,this.currentSessionCounts[e]=0;for(e=0;e<this.trackedActivities.length;e++)this.activationMask|=1<<e,this.trackedActivities[e].getCount()<1&&this.trackedActivities[e].setCount(1)}return t.prototype.getCount=function(t){return this.isValidIndex(t)?this.currentCounts[t]:0},t.prototype.getSessionCount=function(t){return this.isValidIndex(t)?this.currentSessionCounts[t]:0},t.prototype.getStartTime=function(t){return this.isValidIndex(t)?this.currentStartTimes[t]:null},t.prototype.moveSessionCountIntoBaseCount=function(t){if(!this.isValidIndex(t))return 0;var e=this.currentSessionCounts[t];return this.currentSessionCounts[t]=0,e},t.prototype.initCounts=function(t,e,n){void 0===n&&(n=!1);for(var r=0;r<this.trackedActivities.length&&!(this.isOrdered&&r>this.currentIndex);r++)r<e.length&&e[r]&&(this.currentSessionCounts[r]=this.currentCounts[r]=e[r].tracker.getSessionCount(e[r].index),this.currentStartTimes[r]=e[r].tracker.getStartTime(e[r].index)),this.trackedActivities[r].getIsAggregate()&&r<t.length&&(this.currentCounts[r]+=t[r]),this.hasCountCrossedThreshold(r)&&this.finishActivityAtIndex(r);this.isActivated()&&!n&&(this.isActivationByInitPending=!0)},t.prototype.generateActivityIndexList=function(){for(var e=new Array,n=0;n<this.trackedActivities.length;n++){var r=new t.ActivityIndex;r.activity=this.trackedActivities[n].getActivity(),r.index=n,e.push(r)}return e},t.prototype.incrementActivity=function(t,e){if(!this.isValidIndex(t))return 0;if(e<0)throw new Error("increment must be non-negative");if(this.isOrdered&&t>this.currentIndex)return 0;var n=!this.hasCountCrossedThreshold(t);return this.currentCounts[t]+=e,this.currentSessionCounts[t]+=e,this.isActivationByInitPending?this.isPermittedIndexForActivationByInit(t)?this.commitActivation():0:n&&this.hasCountCrossedThreshold(t)?(this.finishActivityAtIndex(t),this.isActivated()?this.commitActivation():1):0},t.prototype.startTime=function(t,e){this.isValidIndex(t)&&(this.currentStartTimes[t]=e||new Date)},t.prototype.stopTime=function(t,e){if(!this.isValidIndex(t))return 0;var n=this.currentStartTimes[t];if(this.currentStartTimes[t]=null,!n)return 0;if(n>(e=e||new Date))return 0;var r=(e.getTime()-n.getTime())/1e3;return r%1==0&&(r+=.001),r},t.prototype.isValidIndex=function(t){return t<this.trackedActivities.length},t.prototype.isActivated=function(){return(this.currentActivationFlags&this.activationMask)===this.activationMask},t.prototype.finishActivityAtIndex=function(t){if(!this.isValidIndex(t))throw new Error("Index is not valid");this.currentActivationFlags|=1<<t,t+1<this.trackedActivities.length&&(this.currentIndex=t+1)},t.prototype.hasCountCrossedThreshold=function(t){if(!this.isValidIndex(t))throw new Error("Index is not valid");return this.currentCounts[t]>=this.trackedActivities[t].getCount()},t.prototype.isPermittedIndexForActivationByInit=function(t){return!this.isOrdered||t+1===this.currentCounts.length},t.prototype.commitActivation=function(){return this.isActivationByInitPending=!1,2},t}();!function(t){var e=function(){};t.ActivityIndex=e}(r||(r={})),t.exports=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IndexedTracker=void 0;var r=function(){};e.IndexedTracker=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ActivityTrackingContract=void 0;var r=function(t,e){this.surveyId=t,this.trackingSet=e};e.ActivityTrackingContract=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasSurveyReachedMaxLaunches=e.hasSurveyReachedMaxLaunchesPerSession=e.isCriticalSurvey=e.isBusinessCriticalSurvey=e.isMultiLaunchSurvey=void 0;var r=n(7),i=n(3);function o(t){var e=null==t?void 0:t.getMaxLaunches();return i.isNumber(e)&&e>1}function a(t){var e=null==t?void 0:t.getBusinessLevel();return!i.isNOU(e)&&e===r.ISurveyInfo.BusinessLevel.Critical}e.isMultiLaunchSurvey=o,e.isBusinessCriticalSurvey=a,e.isCriticalSurvey=function(t){return o(t)||a(t)},e.hasSurveyReachedMaxLaunchesPerSession=function(t,e){var n;return!o(t)||!i.isNumber(t.getMaxLaunchesPerSession())||(null!==(n=e[t.getId()])&&void 0!==n?n:0)>=t.getMaxLaunchesPerSession()},e.hasSurveyReachedMaxLaunches=function(t,e){return!o(t)||((null==e?void 0:e.SurveyLaunchCount)||0)>=t.getMaxLaunches()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.validateUserFacts=e.deserializeUserFacts=void 0;var r=n(57);e.deserializeUserFacts=function(t){var e=[];for(var n in t.UserFacts)if(t.UserFacts.hasOwnProperty(n)){var i=t.UserFacts[n];i&&e.push(r.UserFact.deserialize(i))}return 0===e.length&&(e=null),e},e.validateUserFacts=function(t){if(t)for(var e in t)if(t.hasOwnProperty(e)&&!t[e])return!1;return!0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UserFact=void 0;var r=n(8),i=n(12),o=n(3),a=o.isNOU,s=o.isNumber,u=o.isArray,c=[0,1,2,3,4,5],l=function(){function t(t){this.input=t}return t.deserialize=function(e){return this.validate(e)?new t(e):null},t.validate=function(t){if(!t)return i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Input is null or undefined for user fact"),!1;if(!t.Value&&t.Values&&(t.Value=t.Values),a(t.Name)||a(t.Type)||a(t.Value))return i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Either of the required parameters Name: "+t.Name+", Type: "+t.Type+" or Value: "+t.Value+" are not provided for the user fact"),!1;if(!this.validateUserFactType(t.Type))return i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Invalid UserFactType value "+t.Type+" is provided for user fact"),!1;if(6===t.Type)return i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Unsupported UserFactType value "+t.Type+" is provided for user fact"),!1;if(t.LatencyType&&!this.validateLatencyType(t.LatencyType))return i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Invalid LatencyType value "+t.LatencyType+" is provided for user fact of type "+t.Type),!1;if(t.LatencyType&&0!==t.LatencyType&&a(t.LatencyDurationInSeconds))return i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"LatencyDurationInSeconds value "+t.LatencyDurationInSeconds+" is not provided for user fact of type "+t.Type),!1;if(t.LatencyDurationInSeconds&&!s(t.LatencyDurationInSeconds))return i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Invalid LatencyDurationInSeconds value "+t.LatencyDurationInSeconds+" is provided for user fact of type "+t.Type),!1;if(1===t.Type&&a(t.IntervalType))return i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Required parameter intervalType is not provided for user fact of type "+t.Type),!1;var e=this.getComparatorTypes(t.Type);return!(t.Comparator&&!function(t,e){return-1!==e.indexOf(t)}(t.Comparator,e))||(i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,"Unsupported comparator type for user fact of type "+t.Type),!1)},t.getComparatorTypes=function(t){switch(t){case 0:return[0,1];case 4:return[0,1,6,7,8,9];case 5:return[6,7,8,9];case 1:case 2:case 3:case 6:return c}return c},t.validateLatencyType=function(t){return 0===t||3===t||1===t||2===t},t.validateUserFactType=function(t){return 0===t||2===t||3===t||4===t||1===t||5===t||6===t},t.prototype.isAMatch=function(t){if(!t||!t.userFactValue)return!1;if(!this.isLatencyAcceptable(t))return!1;try{var e=this.getType();return 0===e?function(t,e,n){var r=JSON.parse(e.userFactValue.toLowerCase());return p(!!t,!!r,n)}(this.getValue(),t,this.getComparator()):2===e?function(t,e,n){var r=Date.parse(e.userFactValue);if(!g(r,e.userFactValue,e.userFactName))return!1;var i=Date.parse(t);if(!g(i,t,null,2))return!1;return p(i,r,n)}(this.getValue(),t,this.getComparator()):3===e?function(t,e,n){var r=parseInt(e.userFactValue,10);if(!g(r,e.userFactValue,e.userFactName))return!1;return p(t,r,n)}(this.getValue(),t,this.getComparator()):4===e?function(t,e,n){return p(t.toLowerCase(),e.userFactValue.toLowerCase(),n)}(this.getValue(),t,this.getComparator()):1===e?function(t,e,n,o){var a=Date.parse(e.userFactValue);if(!g(a,e.userFactValue,e.userFactName))return!1;var s=Date.now(),u=0===o?s-a:a-s;if(u<0)return i.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Mismatch,{ErrorMessage:"Interval type not acceptable - { Spec: "+t+', Name: "'+e.userFactName+'" }',TimeMilliseconds:u,Type:""+o}),!1;return p(864e5*t,u,n)}(this.getValue(),t,this.getComparator(),this.getIntervalType()):5===e?function(t,e,n){return p(t,e.userFactValue,n)}(this.getValue(),t,this.getComparator()):(i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,"Unsupported type of user fact was provided "+e),!1)}catch(t){return i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,t),!1}},t.prototype.getType=function(){return this.input.Type},t.prototype.getName=function(){return this.input.Name},t.prototype.getValue=function(){return this.input.Value},t.prototype.getComparator=function(){return this.input.Comparator||0},t.prototype.getLatencyType=function(){return this.input.LatencyType||0},t.prototype.getLatencyDurationInSeconds=function(){return this.input.LatencyDurationInSeconds},t.prototype.getIntervalType=function(){return this.input.IntervalType},t.prototype.isLatencyAcceptable=function(t){var e=this.getType();return!(!a(this.getLatencyDurationInSeconds())&&!function(t,e,n){var r;switch(t){case 0:break;case 1:r=n.sourceDateTime;break;case 2:r=n.storageDateTime;break;case 3:r=n.clientIngestionDateTime}if(!a(r)){var i=Date.parse(r);return Date.now()-i<=1e3*e}return!0}(this.getLatencyType(),this.getLatencyDurationInSeconds(),t))||(i.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Mismatch,{ErrorMessage:'Latency duration not acceptable - { Name: "'+t.userFactName+'" }',TimeMilliseconds:this.getLatencyDurationInSeconds(),Type:""+e}),!1)},t}();function p(t,e,n){switch(n){case 0:return e===t;case 1:return e!==t;case 2:return e>t;case 3:return e>=t;case 4:return e<t;case 5:return e<=t;case 6:return d(t,e);case 7:return!d(t,e);case 8:return d(e,t);case 9:return!d(e,t)}}function d(t,e){if("string"==typeof e){var n=e.toLowerCase();if("string"==typeof t)return-1!==t.toLowerCase().indexOf(n);if(u(t))return t.some((function(t){return t&&t.toString().toLowerCase()===n}))}return!!u(t)&&-1!==t.indexOf(e)}function g(t,e,n,o){if(!s(t)){var a="User fact "+n+" has invalid value "+e;return o&&(a="Invalid value "+e+" was provided for user fact of type "+o),i.FloodgateEngine.getTelemetryLogger().log_Error(r.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,a),!1}return!0}e.UserFact=l},function(t,e,n){var r;r=function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=15)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){this.low=0,this.high=0,this.low=parseInt(t,10),this.low<0&&(this.high=-1)}return t.prototype.Equals=function(e){var n=new t(e);return this.low===n.low&&this.high===n.high},t}();e.Int64=r;var i=function(){function t(t){this.low=0,this.high=0,this.low=parseInt(t,10)}return t.prototype.Equals=function(e){var n=new t(e);return this.low===n.low&&this.high===n.high},t}();e.UInt64=i;var o=function(){function t(){}return t.ToByte=function(t){return this.ToUInt8(t)},t.ToInt16=function(t){return 32767&t|(32768&t)<<16>>16},t.ToInt32=function(t){return 2147483647&t|2147483648&t},t.ToUInt8=function(t){return 255&t},t.ToUInt32=function(t){return 4294967295&t},t}();e.Number=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.NotSet=0]="NotSet",t[t.DistinguishedName=1]="DistinguishedName",t[t.GenericData=2]="GenericData",t[t.IPV4Address=3]="IPV4Address",t[t.IPv6Address=4]="IPv6Address",t[t.MailSubject=5]="MailSubject",t[t.PhoneNumber=6]="PhoneNumber",t[t.QueryString=7]="QueryString",t[t.SipAddress=8]="SipAddress",t[t.SmtpAddress=9]="SmtpAddress",t[t.Identity=10]="Identity",t[t.Uri=11]="Uri",t[t.Fqdn=12]="Fqdn",t[t.IPV4AddressLegacy=13]="IPV4AddressLegacy"}(e.AWTPiiKind||(e.AWTPiiKind={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(9),i=n(1),o=n(3),a=function(){function t(){}return t.getPayloadBlob=function(t,e){var n=new r.IO.MemoryStream,i=new r.CompactBinaryProtocolWriter(n);return i.WriteFieldBegin(r.BondDataType.BT_MAP,3),i.WriteMapContainerBegin(e,r.BondDataType.BT_STRING,r.BondDataType.BT_LIST),Object.keys(t).forEach((function(e){i.WriteString(e);var n=t[e];i.WriteContainerBegin(1,r.BondDataType.BT_STRUCT),i.WriteFieldBegin(r.BondDataType.BT_STRING,2),i.WriteString("act_default_source"),i.WriteFieldBegin(r.BondDataType.BT_STRING,5),i.WriteString(o.newGuid()),i.WriteFieldBegin(r.BondDataType.BT_INT64,6),i.WriteInt64(o.numberToBondInt64(Date.now())),i.WriteFieldBegin(r.BondDataType.BT_LIST,8),i.WriteContainerBegin(n.length,r.BondDataType.BT_STRUCT);for(var a=0;a<n.length;++a)i.WriteBlob(n[a]);i.WriteStructEnd(!1)})),i.WriteStructEnd(!1),n.GetBuffer()},t.getEventBlob=function(t){var e=new r.IO.MemoryStream,n=new r.CompactBinaryProtocolWriter(e);n.WriteFieldBegin(r.BondDataType.BT_STRING,1),n.WriteString(t.id),n.WriteFieldBegin(r.BondDataType.BT_INT64,3),n.WriteInt64(o.numberToBondInt64(t.timestamp)),n.WriteFieldBegin(r.BondDataType.BT_STRING,5),n.WriteString(t.type),n.WriteFieldBegin(r.BondDataType.BT_STRING,6),n.WriteString(t.name);var a=[],s=[];return Object.keys(t.properties).forEach((function(e){t.properties[e].pii===i.AWTPiiKind.NotSet?a.push(e):s.push(e)})),a.length&&(n.WriteFieldBegin(r.BondDataType.BT_MAP,13),n.WriteMapContainerBegin(a.length,r.BondDataType.BT_STRING,r.BondDataType.BT_STRING),a.forEach((function(e){n.WriteString(e),n.WriteString(t.properties[e].value)}))),s.length&&(n.WriteFieldBegin(r.BondDataType.BT_MAP,30),n.WriteMapContainerBegin(s.length,r.BondDataType.BT_STRING,r.BondDataType.BT_STRUCT),s.forEach((function(e){n.WriteString(e),n.WriteFieldBegin(r.BondDataType.BT_INT32,1),n.WriteInt32(1),n.WriteFieldBegin(r.BondDataType.BT_INT32,2),n.WriteInt32(t.properties[e].pii),n.WriteFieldBegin(r.BondDataType.BT_STRING,3),n.WriteString(t.properties[e].value),n.WriteStructEnd(!1)}))),n.WriteStructEnd(!1),e.GetBuffer()},t.base64Encode=function(t){return r.Encoding.Base64.GetString(t)},t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=/[xy]/g;e.numberToBondInt64=function(t){var e=new r.Int64("0");return e.low=4294967295&t,e.high=Math.floor(t/4294967296),e},e.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(i,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},e.isPii=function(t){return!isNaN(t)&&null!==t&&t>=0&&t<=13}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Version="1.2.2",e.FullVersionString="AWT-Web-CJS-"+e.Version},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1);e.AWTPiiKind=r.AWTPiiKind;var i=n(13);e.AWT=i.default,e.AWT_COLLECTOR_URL_UNITED_STATES="https://us.pipe.aria.microsoft.com/Collector/3.0/",e.AWT_COLLECTOR_URL_GERMANY="https://de.pipe.aria.microsoft.com/Collector/3.0/",e.AWT_COLLECTOR_URL_JAPAN="https://jp.pipe.aria.microsoft.com/Collector/3.0/",e.AWT_COLLECTOR_URL_AUSTRALIA="https://au.pipe.aria.microsoft.com/Collector/3.0/",e.AWT_COLLECTOR_URL_EUROPE="https://eu.pipe.aria.microsoft.com/Collector/3.0/"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.BT_STOP=0]="BT_STOP",t[t.BT_STOP_BASE=1]="BT_STOP_BASE",t[t.BT_UINT8=3]="BT_UINT8",t[t.BT_UINT32=5]="BT_UINT32",t[t.BT_UINT64=6]="BT_UINT64",t[t.BT_STRING=9]="BT_STRING",t[t.BT_STRUCT=10]="BT_STRUCT",t[t.BT_LIST=11]="BT_LIST",t[t.BT_MAP=13]="BT_MAP",t[t.BT_INT32=16]="BT_INT32",t[t.BT_INT64=17]="BT_INT64",t[t.BT_UNAVAILABLE=127]="BT_UNAVAILABLE"}(e.BondDataType||(e.BondDataType={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=function(){function t(){}return t.GetBytes=function(t){for(var e=[],n=0;n<t.length;++n){var r=t.charCodeAt(n);r<128?e.push(r):r<2048?e.push(192|r>>6,128|63&r):r<55296||r>=57344?e.push(224|r>>12,128|r>>6&63,128|63&r):(r=65536+((1023&r)<<10|1023&t.charCodeAt(++n)),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return e},t}();e.Utf8=i;var o=function(){function t(){}return t.GetString=function(t){for(var e,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[],i=t.length%3,o=0,a=t.length-i;o<a;o+=3){var s=(t[o]<<16)+(t[o+1]<<8)+t[o+2];r.push([n.charAt((e=s)>>18&63),n.charAt(e>>12&63),n.charAt(e>>6&63),n.charAt(63&e)].join(""))}switch(i){case 1:s=t[t.length-1],r.push(n.charAt(s>>2)),r.push(n.charAt(s<<4&63)),r.push("==");break;case 2:var u=(t[t.length-2]<<8)+t[t.length-1];r.push(n.charAt(u>>10)),r.push(n.charAt(u>>4&63)),r.push(n.charAt(u<<2&63)),r.push("=")}return r.join("")},t}();e.Base64=o;var a=function(){function t(){}return t.GetBytes=function(t){for(var e=[];4294967168&t;)e.push(127&t|128),t>>>=7;return e.push(127&t),e},t}();e.Varint=a;var s=function(){function t(){}return t.GetBytes=function(t){for(var e=t.low,n=t.high,r=[];n||4294967168&e;)r.push(127&e|128),e=(127&n)<<25|e>>>7,n>>>=7;return r.push(127&e),r},t}();e.Varint64=s;var u=function(){function t(){}return t.EncodeZigzag32=function(t){return(t=r.Number.ToInt32(t))<<1^t>>31},t.EncodeZigzag64=function(t){var e=t.low,n=t.high,i=n<<1|e>>>31,o=e<<1;2147483648&n&&(i=~i,o=~o);var a=new r.UInt64("0");return a.low=o,a.high=i,a},t}();e.Zigzag=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=function(){function t(){this._buffer=[]}return t.prototype.WriteByte=function(t){this._buffer.push(r.Number.ToByte(t))},t.prototype.Write=function(t,e,n){for(;n--;)this.WriteByte(t[e++])},t.prototype.GetBuffer=function(){return this._buffer},t}();e.MemoryStream=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6);e.BondDataType=r.BondDataType;var i=n(7);e.Encoding=i;var o=n(8);e.IO=o;var a=n(0);e.Int64=a.Int64,e.UInt64=a.UInt64,e.Number=a.Number;var s=function(){function t(t){this._stream=t}return t.prototype.WriteBlob=function(t){this._stream.Write(t,0,t.length)},t.prototype.WriteContainerBegin=function(t,e){this.WriteUInt8(e),this.WriteUInt32(t)},t.prototype.WriteMapContainerBegin=function(t,e,n){this.WriteUInt8(e),this.WriteUInt8(n),this.WriteUInt32(t)},t.prototype.WriteFieldBegin=function(t,e){e<=5?this._stream.WriteByte(t|e<<5):e<=255?(this._stream.WriteByte(192|t),this._stream.WriteByte(e)):(this._stream.WriteByte(224|t),this._stream.WriteByte(e),this._stream.WriteByte(e>>8))},t.prototype.WriteInt32=function(t){t=i.Zigzag.EncodeZigzag32(t),this.WriteUInt32(t)},t.prototype.WriteInt64=function(t){this.WriteUInt64(i.Zigzag.EncodeZigzag64(t))},t.prototype.WriteString=function(t){if(""===t)this.WriteUInt32(0);else{var e=i.Utf8.GetBytes(t);this.WriteUInt32(e.length),this._stream.Write(e,0,e.length)}},t.prototype.WriteStructEnd=function(t){this.WriteUInt8(t?r.BondDataType.BT_STOP_BASE:r.BondDataType.BT_STOP)},t.prototype.WriteUInt32=function(t){var e=i.Varint.GetBytes(a.Number.ToUInt32(t));this._stream.Write(e,0,e.length)},t.prototype.WriteUInt64=function(t){var e=i.Varint64.GetBytes(t);this._stream.Write(e,0,e.length)},t.prototype.WriteUInt8=function(t){this._stream.WriteByte(a.Number.ToUInt8(t))},t}();e.CompactBinaryProtocolWriter=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this._killedTokenDictionary={}}return t.prototype.setKillSwitchTenants=function(t,e){var n=this;if(t&&e)try{var r=t.split(",");if("this-request-only"===e)return r;var i=1e3*parseInt(e,10);r.forEach((function(t){n._killedTokenDictionary[t]=Date.now()+i}))}catch(t){return[]}return[]},t.prototype.isTenantKilled=function(t){return void 0!==this._killedTokenDictionary[t]&&this._killedTokenDictionary[t]>Date.now()||(delete this._killedTokenDictionary[t],!1)},t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=function(){function t(t,e){this._maxRequestSize=t,this._outboundQueue=e,this._currentBatch={},this._currentBatchSize=0}return t.prototype.addEventToBatch=function(t){var e=r.default.getEventBlob(t);e.length>this._maxRequestSize||(this._currentBatchSize+e.length>this._maxRequestSize?this.flushBatch():(void 0===this._currentBatch[t.tenantToken]&&(this._currentBatch[t.tenantToken]=[]),this._currentBatch[t.tenantToken].push(e),this._currentBatchSize+=e.length))},t.prototype.flushBatch=function(){this._currentBatchSize>0&&(this._outboundQueue.push(this._currentBatch),this._currentBatch={},this._currentBatchSize=0)},t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.shouldRetryForStatus=function(t){return!(t>=300&&t<500&&408!==t||501===t||505===t)},t.getMillisToBackoffForRetry=function(t){var e,n=Math.floor(1200*Math.random())+2400;return e=Math.pow(4,t)*n,Math.min(e,12e4)},t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(14),o=n(3),a=n(4),s=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,u=/\./g,c=/^[a-zA-Z0-9](([a-zA-Z0-9|_|\.]){0,98}[a-zA-Z0-9])?$/,l=function(){function t(){}return t.initialize=function(t,e){if(void 0===e&&(e={}),this._isInitialized)throw"Already Initialized";this._defaultTenantToken=t,this._overrideValuesFromConfig(e),i.default.initialize(this._config),this._isInitialized=!0},t.flush=function(t){this._isInitialized&&!this._isDestroyed&&i.default.flush(t)},t.flushAndTeardown=function(){this._isInitialized&&!this._isDestroyed&&(this._isDestroyed=!0,i.default.flushAndTeardown())},t.setContext=function(t,e,n){void 0===n&&(n="allTkns"),null!==(e=this._sanitizeProperty(t,e))&&(this._contextProperties[n]||(this._contextProperties[n]={}),this._contextProperties[n][t]=e)},t.logEvent=function(t){var e=this;if(this._isInitialized){if(!t.name||!t.properties)return;t.name=t.name.toLowerCase(),t.name.replace(u,"_");var n="";if(t.type?(t.type.toLowerCase(),n="custom."):t.type="custom",!s.test(t.name)||!s.test(t.type))return;if(t.type=n+t.type,isNaN(t.timestamp)&&(t.timestamp=(new Date).getTime()),t.tenantToken||(t.tenantToken=this._defaultTenantToken),t.id=o.newGuid(),Object.keys(t.properties).forEach((function(n){t.properties[n]=e._sanitizeProperty(n,t.properties[n]),null===t.properties[n]&&delete t.properties[n]})),this._addContextIfAbsent(t,t.tenantToken),this._addContextIfAbsent(t,"allTkns"),0===Object.keys(t.properties).length)return;this._setDefaultProperty(t,"EventInfo.InitId",this._getInitId(t.tenantToken)),this._setDefaultProperty(t,"EventInfo.Sequence",this._getSequenceId(t.tenantToken)),this._setDefaultProperty(t,"EventInfo.SdkVersion",a.FullVersionString),this._setDefaultProperty(t,"EventInfo.Name",t.name),this._setDefaultProperty(t,"EventInfo.Time",new Date(t.timestamp).toISOString()),i.default.sendEvent(t)}},t._overrideValuesFromConfig=function(t){t.collectorUrl&&(this._config.collectorUrl=t.collectorUrl),t.sendingTimer>1e3&&(this._config.sendingTimer=t.sendingTimer)},t._getInitId=function(t){return void 0===this._initIdMap[t]&&(this._initIdMap[t]=o.newGuid()),this._initIdMap[t]},t._getSequenceId=function(t){return void 0===this._sequenceIdMap[t]&&(this._sequenceIdMap[t]=0),(++this._sequenceIdMap[t]).toString()},t._setDefaultProperty=function(t,e,n){t.properties[e]={value:n,pii:r.AWTPiiKind.NotSet}},t._addContextIfAbsent=function(t,e){if(this._contextProperties[e]){var n=this._contextProperties[e];Object.keys(n).forEach((function(e){t.properties[e]||(t.properties[e]=n[e])}))}},t._sanitizeProperty=function(t,e){return"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e||(e={value:e}),c.test(t)&&null!=e&&null!==e.value&&void 0!==e.value&&""!==e.value?(void 0===e.pii&&(e.pii=r.AWTPiiKind.NotSet),e.value=e.value.toString(),o.isPii(e.pii)?e:null):null},t._isInitialized=!1,t._isDestroyed=!1,t._contextProperties={},t._sequenceIdMap={},t._initIdMap={},t._config={collectorUrl:"https://browser.pipe.aria.microsoft.com/Collector/3.0/",sendingTimer:1e3},t}();e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(11),i=n(2),o=n(12),a=n(10),s=n(4),u=function(){function t(){}return t.initialize=function(t){this._inboundQueues.push([]),this._recordBatcher=new r.default(2936012,this._outboundQueue),this._newEventsAllowed=!0,"undefined"==typeof Uint8Array&&(this._urlString+="&content-encoding=base64"),this._sendingTimer=t.sendingTimer,this._urlString=t.collectorUrl+this._urlString+"&x-apikey="},t.sendEvent=function(t){var e=this;this._newEventsAllowed&&(this._inboundQueues[this._inboundQueues.length-1].push(t),!this._running&&this._timeout<0&&!this._isCurrentlyFlushing&&(this._timeout=setTimeout((function(){return e._batchAndSendEvents(!1)}),this._sendingTimer)))},t.flushAndTeardown=function(){this._newEventsAllowed=!1,this._batchAndSendEvents(!0)},t.flush=function(t){this._inboundQueues.push([]),this._isCurrentlyFlushing?this._flushQueue.push(t):(this._isCurrentlyFlushing=!0,this._flush(t))},t._batchAndSendEvents=function(t){for(this._running=!0;this._inboundQueues[0].length>0&&this._outboundQueue.length<1;)this._recordBatcher.addEventToBatch(this._inboundQueues[0].pop());0===this._outboundQueue.length&&this._recordBatcher.flushBatch(),this._sendRequest(this._outboundQueue.pop(),0,t)},t._retryRequestIfNeeded=function(t,e,n,r,i){var a=this,s=!0;t&&void 0!==t.status&&(this._killSwitch.setKillSwitchTenants(t.getResponseHeader("kill-tokens"),t.getResponseHeader("kill-duration-seconds")).forEach((function(t){delete e[t],n--})),(!o.default.shouldRetryForStatus(t.status)||n<=0)&&(s=!1)),s&&i<4?setTimeout((function(){return a._sendRequest(e,i+1,!1)}),o.default.getMillisToBackoffForRetry(i)):this._handleRequestFinished(null)},t._sendRequest=function(t,e,n){var r=this;try{var o=new XMLHttpRequest,a=0,s="";if(Object.keys(t).forEach((function(e){r._killSwitch.isTenantKilled(e)?delete t[e]:(s.length>0&&(s+=","),s+=e,a++)})),o.open("POST",this._urlString+s,!n),n||(o.ontimeout=function(){r._retryRequestIfNeeded(o,t,a,s,e)},o.onerror=function(){r._retryRequestIfNeeded(o,t,a,s,e)},o.onload=function(){r._handleRequestFinished(o)}),a>0){var u=i.default.getPayloadBlob(t,a);"undefined"==typeof Uint8Array?o.send(i.default.base64Encode(u)):o.send(new Uint8Array(u))}else n&&this._handleRequestFinished(null)}catch(t){this._handleRequestFinished(null)}},t._handleRequestFinished=function(t){var e=this;t&&this._killSwitch.setKillSwitchTenants(t.getResponseHeader("kill-tokens"),t.getResponseHeader("kill-duration-seconds")),this._inboundQueues[0].length>0?this._timeout=setTimeout((function(){return e._batchAndSendEvents(!1)}),this._sendingTimer):(this._timeout=-1,this._running=!1)},t._flush=function(t){var e=this;this._running||(this._timeout>-1&&(clearTimeout(this._timeout),this._timeout=-1),this._inboundQueues[0].length>0&&this._batchAndSendEvents(!1)),this._checkPrimaryInboundQueueEmpty((function(){e._inboundQueues.shift(),null!=t&&t(),e._flushQueue.length>0?setTimeout((function(){return e._flush(e._flushQueue.shift())}),e._sendingTimer):(e._isCurrentlyFlushing=!1,e._inboundQueues[0].length>0&&(e._timeout=setTimeout((function(){return e._batchAndSendEvents(!1)}),e._sendingTimer)))}))},t._checkPrimaryInboundQueueEmpty=function(t){var e=this;0===this._inboundQueues[0].length?this._checkOutboundQueueEmptyAndSent(t):setTimeout((function(){return e._checkPrimaryInboundQueueEmpty(t)}),250)},t._checkOutboundQueueEmptyAndSent=function(t){var e=this;this._running?setTimeout((function(){return e._checkOutboundQueueEmptyAndSent(t)}),250):t()},t._outboundQueue=[],t._inboundQueues=[],t._newEventsAllowed=!1,t._killSwitch=new a.default,t._isCurrentlyFlushing=!1,t._flushQueue=[],t._running=!1,t._timeout=-1,t._urlString="?qsp=true&content-type=application%2Fbond-compact-binary&client-id=NO_AUTH&sdk-version="+s.FullVersionString,t}();e.default=u},function(t,e,n){t.exports=n(5)}])},t.exports=r()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationState=void 0,function(t){t[t.Undefined=0]="Undefined",t[t.Created=10]="Created",t[t.Sent=20]="Sent",t[t.Duplicated=30]="Duplicated",t[t.Seen=40]="Seen",t[t.Tried=50]="Tried",t[t.Kept=60]="Kept",t[t.Rejected=70]="Rejected"}(e.AnnotationState||(e.AnnotationState={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ItemChanges=e.ItemOperation=void 0,function(t){t[t.None=0]="None",t[t.Added=1]="Added",t[t.Updated=2]="Updated",t[t.Deleted=3]="Deleted"}(e.ItemOperation||(e.ItemOperation={})),function(t){t[t.ContentChanged=0]="ContentChanged",t[t.ContentWasEmpty=1]="ContentWasEmpty",t[t.FormattingChanged=2]="FormattingChanged"}(e.ItemChanges||(e.ItemChanges={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GridConstants=e.OpenType=e.BlobRefType=void 0,function(t){t[t.None=0]="None",t[t.HttpsGetDownloadUrl=1]="HttpsGetDownloadUrl",t[t.AlCodedLocation=2]="AlCodedLocation"}(e.BlobRefType||(e.BlobRefType={})),function(t){t[t.NewDocument=0]="NewDocument",t[t.EditDocument=1]="EditDocument",t[t.ViewOnlyDocument=2]="ViewOnlyDocument"}(e.OpenType||(e.OpenType={}));var r=function(){function t(){}return t.lowerIndexBound=1,t.maxNumberOfRows=1048576,t.maxNumberOfColumns=16384,t.firstColumnName="A",t.lastColumnName="XFD",t}();e.GridConstants=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BinaryClassificationAnnotation=e.Annotation=void 0;var r=n(17),i=function(){function t(e){r.SchemaObject.assign(t,this,e)}return Object.defineProperty(t.prototype,"metadata",{get:function(){return this.M_},set:function(t){this.M_=t},enumerable:!1,configurable:!0}),t.getTypeName=function(){return"AugLoop_Core_Annotation"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.Annotation=i;var o=function(){function t(e){r.SchemaObject.assign(t,this,e)}return Object.defineProperty(t.prototype,"metadata",{get:function(){return this.M_},set:function(t){this.M_=t},enumerable:!1,configurable:!0}),t.getTypeName=function(){return"AugLoop_Core_BinaryClassificationAnnotation"},t.getBaseTypes=function(){return["AugLoop_Core_Annotation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.BinaryClassificationAnnotation=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SignalOperation=e.MicroSyncOperation=e.DeltaUpdateOperation=e.VisibilityOperation=e.FocusOperation=e.PurgeOperation=e.DeleteOperation=e.UpdateOperation=e.UpdateAnnotationMetaDataOperation=e.MoveOperation=e.AddOperation=e.OperationWithSiblingContext=e.Operation=e.ItemChangesDelta=e.ItemDelta=void 0;var r=n(17),i=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_ItemDelta"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.ItemDelta=i;var o=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_ItemChangesDelta"},t.getBaseTypes=function(){return["AugLoop_Core_ItemDelta"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.ItemChangesDelta=o;var a=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_Operation"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.Operation=a;var s=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_OperationWithSiblingContext"},t.getBaseTypes=function(){return["AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.OperationWithSiblingContext=s;var u=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_AddOperation"},t.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.AddOperation=u;var c=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_MoveOperation"},t.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.MoveOperation=c;var l=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"},t.getBaseTypes=function(){return["AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.UpdateAnnotationMetaDataOperation=l;var p=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_UpdateOperation"},t.getBaseTypes=function(){return["AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.UpdateOperation=p;var d=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_DeleteOperation"},t.getBaseTypes=function(){return["AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.DeleteOperation=d;var g=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_PurgeOperation"},t.getBaseTypes=function(){return["AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.PurgeOperation=g;var h=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_FocusOperation"},t.getBaseTypes=function(){return["AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.FocusOperation=h;var f=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_VisibilityOperation"},t.getBaseTypes=function(){return["AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.VisibilityOperation=f;var v=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_DeltaUpdateOperation"},t.getBaseTypes=function(){return["AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.DeltaUpdateOperation=v;var y=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_MicroSyncOperation"},t.getBaseTypes=function(){return["AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.MicroSyncOperation=y;var m=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Signals_SignalOperation"},t.getBaseTypes=function(){return["AugLoop_Core_Operation"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.SignalOperation=m},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Signal=void 0;var r=n(17),i=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Signals_Signal"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.Signal=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TenantContextHolder=e.UserContextHolder=e.ContextHolder=e.DynamicContext=e.GridNeighborhoodContext=e.GridCell=e.SubDocument=e.Document=e.Session=e.TileGroup=e.Binary=e.Blob=void 0;var r=n(17),i=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_Blob"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.Blob=i;var o=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_Binary"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.Binary=o;var a=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_TileGroup"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.TileGroup=a;var s=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_Session"},t.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.Session=s;var u=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_Document"},t.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.Document=u;var c=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_SubDocument"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.SubDocument=c;var l=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_GridCell"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.GridCell=l;var p=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_GridNeighborhoodContext"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.GridNeighborhoodContext=p;var d=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_DynamicContext"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.DynamicContext=d;var g=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_ContextHolder"},t.getBaseTypes=function(){return[]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.ContextHolder=g;var h=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_UserContextHolder"},t.getBaseTypes=function(){return["AugLoop_Core_ContextHolder"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.UserContextHolder=h;var f=function(){function t(e){r.SchemaObject.assign(t,this,e)}return t.getTypeName=function(){return"AugLoop_Core_TenantContextHolder"},t.getBaseTypes=function(){return["AugLoop_Core_ContextHolder"]},t.typeGuard=function(e){return r.SchemaObject.matchesTypesFor(e,[t.getTypeName()])},t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()},t}();e.TenantContextHolder=f},function(t,e,n){"use strict";n.r(e),n.d(e,"getEngineStartPromise",(function(){return De})),n.d(e,"resetEngine",(function(){return Ue})),n.d(e,"setEngineStartPromise",(function(){return Fe})),n.d(e,"start",(function(){return Ne})),n.d(e,"startInternal",(function(){return Le})),n.d(e,"stop",(function(){return Pe})),n.d(e,"initialize",(function(){return ke})),n.d(e,"reset",(function(){return xe}));n(34);var r=n(1),i=window,o=i.OfficeBrowserFeedback=i.OfficeBrowserFeedback||{},a=o.floodgate=o.floodgate||{};function s(){return i}function u(){return i}var c=function(){function t(t,e){if(!t)throw new Error("name must not be null");if(!e)throw new Error("version must not be null");this.name=t,this.version=e}return t.prototype.getName=function(){return this.name},t.prototype.getPlatform=function(){return t.PLATFORM},t.prototype.getVersion=function(){return this.version},t.PLATFORM="Web",t}(),l=function(){function t(t){if(!t)throw new Error("id must not be null");this.id=t}return t.prototype.getId=function(){return this.id},t}(),p=function(){function t(t,e,n,r){this.id=t,this.locale=e,this.sessionId=n,this.version=r}return t.prototype.getId=function(){return this.id},t.prototype.getLocale=function(){return this.locale},t.prototype.getSessionId=function(){return this.sessionId},t.prototype.getVersion=function(){return this.version},t}(),d=function(){function t(e,n,r,i){if(!e)throw new Error("name must not be null");if(!n)throw new Error("sessionId must not be null");if(!r&&0!==r||r<0)throw new Error("sequence must not be negative");this.name=e,this.id=n+t.ID_DELIMITER+r,this.sequence=r,this.sampleRate=i}return t.prototype.getName=function(){return this.name},t.prototype.getId=function(){return this.id},t.prototype.getSource=function(){return t.SOURCE},t.prototype.getSchemaVersion=function(){return t.SCHEMA_VERSION},t.prototype.getSequence=function(){return this.sequence},t.prototype.getSampleRate=function(){return this.sampleRate},t.ID_DELIMITER=".",t.SOURCE="MsoThin",t.SCHEMA_VERSION=1,t}(),g=function(){function t(t){this.audienceGroup=t}return t.prototype.getAudienceGroup=function(){return this.audienceGroup},t}(),h=function(){function t(t,e){this.name=t,this.version=e}return t.prototype.getName=function(){return this.name},t.prototype.getVersion=function(){return this.version},t}(),f=function(){function t(t){this.id=t}return t.prototype.getId=function(){return this.id},t}(),v=function(){function t(t,e){this.tenantId=e,this.primaryIdentityHash=t?t.trim():t,this.primaryIdentitySpace=this.generatePrimaryIdentitySpace()}return t.prototype.getTenantId=function(){return this.tenantId},t.prototype.getPrimaryIdentityHash=function(){return this.primaryIdentityHash},t.prototype.getPrimaryIdentitySpace=function(){return this.primaryIdentitySpace},t.prototype.generatePrimaryIdentitySpace=function(){if(this.primaryIdentityHash){if(this.primaryIdentityHash.startsWith("a:"))return"UserObjectId";if(this.primaryIdentityHash.startsWith("p:"))return"MsaPuid";if(this.primaryIdentityHash.startsWith("ap:"))return"OrgIdPuid"}},t}(),y=n(0),m=n(58);function S(){return m.AWT}var T,C=function(){function t(t,e,n,r,i,o,a,s,u){if(!t)throw new Error("tenantToken must not be null");if(!e)throw new Error("namespace must not be null");if(!n)throw new Error("app must not be null");if(!r)throw new Error("session must not be null");S().initialize(t),this.namespace=e,this.oesApp=n,this.oesSession=r,this.oesHost=i,this.oesRelease=o,this.oesBrowser=a,this.oesDevice=s,this.oesUser=u,this.sequence=1}return t.setApp=function(t,e){t["App.Name"]=e.getName(),t["App.Platform"]=e.getPlatform(),t["App.Version"]=e.getVersion()},t.setSession=function(t,e){t["Session.Id"]=e.getId()},t.setHost=function(t,e){e&&(t["Host.Id"]=e.getId(),t["Host.SessionId2"]=e.getSessionId(),t["Host.Version"]=e.getVersion(),t["Host.Locale"]=e.getLocale())},t.setEvent=function(t,e){t["Event.Name"]=e.getName(),t["Event.Id"]=e.getId(),t["Event.Source"]=e.getSource(),t["Event.SchemaVersion"]=e.getSchemaVersion(),t["Event.Sequence"]=e.getSequence(),t["Event.SampleRate"]=e.getSampleRate()},t.setRelease=function(t,e){e&&(t["Release.AudienceGroup"]=e.getAudienceGroup())},t.setBrowser=function(t,e){e&&(t["Browser.Name"]=e.getName(),t["Browser.Version"]=e.getVersion())},t.setDevice=function(t,e){e&&(t["Device.Id"]=e.getId())},t.setUser=function(t,e){e&&(t["User.PrimaryIdentityHash"]=e.getPrimaryIdentityHash(),t["User.PrimaryIdentitySpace"]=e.getPrimaryIdentitySpace(),t["User.TenantId"]=e.getTenantId())},t.prototype.logEvent=function(e,n,r){if(void 0===r&&(r=1),!e)throw new Error("eventName must not be null");var i=new d(this.namespace+t.EVENT_NAME_DELIMITER+e,this.oesSession.getId(),this.sequence,r),o={};if(null!=n)for(var a in n)n.hasOwnProperty(a)&&(o[t.CUSTOM_PROPERTIES_FIELD_PREFIX+a]=n[a]);t.setApp(o,this.oesApp),t.setSession(o,this.oesSession),t.setHost(o,this.oesHost),t.setRelease(o,this.oesRelease),t.setEvent(o,i),t.setBrowser(o,this.oesBrowser),t.setDevice(o,this.oesDevice),t.setUser(o,this.oesUser),S().logEvent({name:i.getName(),properties:o}),this.sequence++},t.EVENT_NAME_DELIMITER="_",t.CUSTOM_PROPERTIES_FIELD_PREFIX="Data.",t}(),E=function(){function t(){}return t.create=function(t,e,n,r,i,o,a,s,u){return new C(t,e,n,r,i,o,a,s,u)},t}(),_=n(7),A=_.IFloodgateStorageProvider.FileType,I=((T={})[A.CampaignDefinitions]="obf-CampaignDefinitions",T[A.CampaignStates]="obf-CampaignStates",T[A.FloodgateSettings]="obf-FloodgateSettings",T[A.GovernedChannelStates]="obf-GovernedChannelStates",T[A.SurveyActivationStats]="obf-SurveyActivationStats",T[A.SurveyEventActivityStats]="obf-SurveyEventActivityStats",T[A.TmsCache_CampaignContent]="obf-TmsCampaignContent",T[A.TmsCache_MessageMetadata]="obf-TmsMessageMetadata",T[A.TmsCache_UserGovernance]="obf-TmsUserGovernance",T[A.Tms_DynamicSettings]="obf-TmsDynamicSettings",T[A.LogLevelSettings]="obf-LogLevelSettings",T[A.UserFacts]="obf-UserFacts",T[A.DebugOverrides]="obf-DebugOverrides",T),b=function(){function t(){}return t.isStorageAvailable=function(){try{var t="__storage_test__";return u().localStorage.setItem(t,t),u().localStorage.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==u().localStorage.length}},t.safeReadObject=function(t,e){if(void 0===e&&(e=void 0),!(t in A))return e;try{var n=I[t],r=u().localStorage.getItem(n),i=!r||"{"!==r[0]&&"["!==r[0]?r:JSON.parse(r);return null!=i?i:e}catch(t){}return e},t.prototype.fileLock=function(t){},t.prototype.fileUnlock=function(t){},t.prototype.read=function(t){if(!(t in A))return"";var e,n=I[t];try{e=u().localStorage.getItem(n)}catch(t){return B().logEvent(O.SURVEY_FLOODGATE_FILEREAD_FAILED,2,{ErrorMessage:t.toString(),FileName:n}),""}return e},t.prototype.write=function(t,e){if(t in A){var n=I[t];try{u().localStorage.setItem(n,e)}catch(t){return void B().logEvent(O.SURVEY_FLOODGATE_FILEWRITE_FAILED,2,{ErrorMessage:t.toString(),FileName:n})}}},t}(),w=n(6),O=function(){function t(){}var e,n,r,i,o,a,s,u,c,l,p,d,g,h,f,v,y,m,S,T,C,E,_,A,I,b,w,O,F,D,L,N,P,U,M,R,B,k,x,G,V;return t.InApp=((e=function(){}).UI=((n=function(){}).Picker=((r=function(){}).Shown=((i=function(){}).VALUE={name:"InApp_UI_Picker_Shown"},i),r),n.Form=((o=function(){}).Shown=((a=function(){}).VALUE={name:"InApp_UI_Form_Shown"},a),o.Submit=((s=function(){}).VALUE={name:"InApp_UI_Form_Submit"},s),o),n),e),t.SURVEY_FLOODGATE_CAMPAIGNLOAD_FAILED={name:"Survey_Floodgate_CampaignLoad_Failed"},t.SURVEY_FLOODGATE_FILEREAD_FAILED={name:"Survey_Floodgate_FileRead_Failed"},t.SURVEY_FLOODGATE_FILEWRITE_FAILED={name:"Survey_Floodgate_FileWrite_Failed"},t.SURVEY_FLOODGATE_TRIGGERMET={name:"Survey_Floodgate_TriggerMet"},t.SURVEY_FLOODGATE_USERSELECTED={name:"Survey_Floodgate_UserSelected"},t.SURVEY_UI_FORM_SHOWN={name:"Survey_UI_Form_Shown"},t.SURVEY_UI_FORM_SUBMIT={name:"Survey_UI_Form_Submit"},t.SURVEY_UI_FORM_SECONDARY_SUBMIT={name:"Survey_UI_Form_Secondary_Submit"},t.SURVEY_UI_FORM_SUBMIT_ERROR={name:"Survey_UI_Form_Submit_Error"},t.SURVEY_UI_FORM_USERCLOSED={name:"Survey_UI_Form_UserClosed"},t.SURVEY_UI_FORM_NO_RETURN_TYPE={name:"Survey_UI_Form_No_Return_Type"},t.SURVEY_UI_PROMPT_AUTODISMISSED={name:"Survey_UI_Prompt_AutoDismissed"},t.SURVEY_UI_PROMPT_SHOWN={name:"Survey_UI_Prompt_Shown"},t.SURVEY_UI_PROMPT_USERCLOSED={name:"Survey_UI_Prompt_UserClosed"},t.SURVEY_UI_PROMPT_CLICKED={name:"Survey_UI_Prompt_Clicked"},t.SURVEY_UI_REDIRECTIONFAILURE={name:"Survey_UI_RedirectionFailure"},t.GOVERNANCE_SERVICEFAILURE={name:"Gorvenance_ServiceFailure"},t.GOVERNANCE_SERVICERESULT={name:"Gorvenance_ServiceResult"},t.DYNAMICTRANSPORT_POST_ERROR={name:"DynamicTransport_Post_Error"},t.FEEDBACK_SURVEYSDISABLED_AADC={name:"Feedback_SurveysDisabled_AADC"},t.SURVEY_UI_DISABLED_AADC={name:"Survey_UI_Prevented_AADC"},t.PERSONALIZER_SERVICEREWARDRESULT={name:"Personalizer_ServiceRewardResult"},t.PERSONALIZER_CLIENTFAILURE={name:"Personalizer_ClientFailure"},t.Shared=((u=function(){}).Upload=((c=function(){}).Failed=((l=function(){}).VALUE={name:"Shared_Upload_Failed"},l),c.Prevented=((p=function(){}).VALUE={name:"Shared_Upload_Prevented_AADC"},p),c),u.Screenshot=((d=function(){}).Render=((g=function(){}).Failed=((h=function(){}).VALUE={name:"Shared_Screenshot_Render_Failed"},h),g.Success=((f=function(){}).VALUE={name:"Shared_Screenshot_Render_Success"},f),g),d.GetContent=((v=function(){}).Failed=((y=function(){}).DefaultImage=((m=function(){}).Returned=((S=function(){}).VALUE={name:"Shared_Screenshot_GetContent_Failed_DefaultImage_Returned"},S),m),y),v),d),u),t.WebSurfaces=((T=function(){}).Common=((C=function(){}).Error=((E=function(){}).VALUE={name:"WebSurfaces_Common_Error"},E),C.Info=((_=function(){}).VALUE={name:"WebSurfaces_Common_Info"},_),C),T.Messaging=((A=function(){}).Requests=((I=function(){}).VALUE={name:"WebSurfaces_Messaging_Requests"},I),A),T),t.UserFacts=((b=function(){}).Common=((w=function(){}).Error=((O=function(){}).VALUE={name:"UserFacts_Common_Error"},O),w.Info=((F=function(){}).VALUE={name:"UserFacts_Common_Info"},F),w),b.LocalFact=((D=function(){}).Error=((L=function(){}).VALUE={name:"UserFacts_LocalFact_Error"},L),D),b.Messaging=((N=function(){}).Requests=((P=function(){}).VALUE={name:"UserFacts_Messaging_Requests"},P),N),b.AugLoop=((U=function(){}).Requests=((M=function(){}).VALUE={name:"UserFacts_AugLoop_Requests"},M),U.Error=((R=function(){}).VALUE={name:"UserFacts_AugLoop_Error"},R),U),b.Provider=((B=function(){}).Info=((k=function(){}).VALUE={name:"UserFacts_Provider_Summary"},k),B),b),t.Common=((x=function(){}).Error=((G=function(){}).VALUE={name:"Common_Error"},G),x.Info=((V=function(){}).VALUE={name:"Common_Info"},V),x),t}(),F=y.i,D=function(){function t(t){this.useLocalStorage=!1,this.cachedItems={},this.initialize(t)}return t.prototype.setContentItem=function(t,e,n){var r=this.createItem(t,e,n);return this.setItem(r),r},t.prototype.getItemContent=function(t){var e=this.getItem(t);return e&&e.content},t.prototype.has=function(t){return t in this.cachedItems},t.prototype.isItemExpired=function(t){var e=this.getItem(t);return!e||!e.expiryDate||e.expiryDate<new Date},t.prototype.createItem=function(t,e,n){return{contentType:t,content:e,expiryDate:new Date(Date.now()+n),lastRetrievedDate:new Date}},t.prototype.setItem=function(t){this.cachedItems[t.contentType]=t,this.updateItemInLocalStorage(t)},t.prototype.getItem=function(t){return this.cachedItems[t]},t.prototype.initialize=function(t){this.cachedItems={},b.isStorageAvailable()&&(this.floodgateStorage=new b,this.useLocalStorage=!0,this.initCachedItemsFromLocalStorage(t))},t.prototype.initCachedItemsFromLocalStorage=function(t){if(this.useLocalStorage&&!F(t))for(var e=0,n=t;e<n.length;e++){var r=n[e],i=this.floodgateStorage.read(this.mapContentTypeToFloodgateProviderKey(r));if(!F(i)){var o=this.parseObjectFromCache(i);F(o)||(o.expiryDate="string"==typeof o.expiryDate?new Date(o.expiryDate):o.expiryDate,this.cachedItems[o.contentType]=o)}}},t.prototype.updateItemInLocalStorage=function(t){this.useLocalStorage&&this.floodgateStorage.write(this.mapContentTypeToFloodgateProviderKey(t.contentType),JSON.stringify(t))},t.prototype.parseObjectFromCache=function(t){try{return JSON.parse(t)}catch(t){return null}},t.prototype.mapContentTypeToFloodgateProviderKey=function(t){switch(t){case"CampaignContent":return w.FileType.TmsCache_CampaignContent;case"MessageMetadata":return w.FileType.TmsCache_MessageMetadata;case"UserGovernance":return w.FileType.TmsCache_UserGovernance;case"DynamicSettings":return w.FileType.Tms_DynamicSettings;case"LogLevelSettings":return w.FileType.LogLevelSettings;case"UserFacts":return w.FileType.UserFacts;default:throw new Error("Unmapped ContentType in TmsCache")}},t}(),L=y.i,N=null;function P(t,e){try{if(!N&&b.isStorageAvailable()&&(N=new D(["DynamicSettings"])),!N)return e;var n=N.getItemContent("DynamicSettings");if(!L(n)&&n.hasOwnProperty(t)&&!L(n[t])){var r=n[t];if("number"==typeof e&&"number"!=typeof r){if("string"==typeof r){var i=-1===r.indexOf(".")?parseInt(r,10):parseFloat(r);return isNaN(i)?e:i}return e}return r}}catch(e){B().logEvent(O.Common.Error.VALUE,2,{ErrorMessage:"Error reading dynamic setting "+(e&&e.message),Type:t})}return e}var U,M,R=y.i;function B(){return U}var k=function(){function t(t,e,n){if(this.SAMPLING_RESULT=Math.random(),!t)throw new Error("telemetryLogger must not be null");this.telemetryLogger=t,this.eventSampling=e,this.initOptionsCommon=n}return t.prototype.logEvent=function(e,n,r,i){if(!e)throw new Error("eventId must not be null");var o=t.DEFAULT_SAMPLE_RATE;if(this.isEventSampled(e.name)?o=this.getEventSamplingRate(e.name):void 0!==i&&(o=i),R(n)||0===n){if(0===M){this.isConsoleLogEnabled&&console&&console.log("Floodgate event: ",t.EVENT_NAME,"logSeverity must not be null or none"),this.telemetryLogger.logEvent(t.EVENT_NAME,{ErrorMessage:"logSeverity must not be null or none"},o)}return!1}return(r=r||{})[t.EVENT_ID]=e.name,(this.isLoggingEnabled(n,o)||this.isEventTelemetryEnabled(e.name))&&this.telemetryLogger.logEvent(t.EVENT_NAME,r,o),this.isConsoleLogEnabled&&console&&console.log("Floodgate event: ",t.EVENT_NAME,n,r),!0},t.prototype.logLocal=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.isLoggingEnabled(t)&&this.isConsoleLogEnabled&&console&&console.log("LPP FG: ",t,e)},t.prototype.getUserSamplingRate=function(){return this.SAMPLING_RESULT},t.prototype.isEventTelemetryEnabled=function(t){var e,n,r,i;try{if(!this.dynamicLogSettings)return!1;var o=null===(n=null===(e=this.initOptionsCommon)||void 0===e?void 0:e.appId)||void 0===n?void 0:n.toString(),a=null===(i=null===(r=this.initOptionsCommon)||void 0===r?void 0:r.originalLocale)||void 0===i?void 0:i.toLowerCase(),s="content_"+t,u=this.dynamicLogSettings[s+"_"+o+"_"+a]||this.dynamicLogSettings[s+"_"+o]||this.dynamicLogSettings[s+"_"+a]||this.dynamicLogSettings[s];return null==u?void 0:u.isEnabled}catch(t){this.isConsoleLogEnabled&&console.log("FG: Error checking for dynamic log settings: ",t)}return!1},t.prototype.isLoggingEnabled=function(t,e){if(void 0===e&&(e=1),R(this.logLevel)){var n=this.getCurrentLogLevel();this.logLevel=R(n)?2:n}return t<=this.logLevel&&this.SAMPLING_RESULT<=e&&0!==e},t.prototype.getCurrentLogLevel=function(){try{var t="undefined"!=typeof URLSearchParams&&new URLSearchParams(window.location.search)||void 0,e=t&&t.get("obfconsolelog");if(!e){var n="undefined"!=typeof document&&document.referrer;e=n&&-1!==n.indexOf("obfconsolelog")}e&&(this.isConsoleLogEnabled=!0);var r=t&&t.get("obfloglevel");if(!R(r))return this.isConsoleLogEnabled=!0,parseInt(r,10);if(b.isStorageAvailable()){var i=(new b).read(w.FileType.LogLevelSettings);i||(i=P("LogLevelSettings",""));var o=i&&this.parseObject(i);if(o){this.dynamicLogSettings=o;var a=o.content;if(this.initOptionsCommon){var s=this.initOptionsCommon.appId&&this.initOptionsCommon.appId.toString(),u=this.initOptionsCommon.originalLocale&&this.initOptionsCommon.originalLocale.toLowerCase();a=o["content_"+s+"_"+u]||o["content_"+s]||o["content_"+u]||o.content}if(a)return a.consoleLog&&(this.isConsoleLogEnabled=!0),a.logLevel}}}catch(t){return void(this.isConsoleLogEnabled&&console.log("Error while getting the current log level: ",t))}return null},t.prototype.parseObject=function(t){try{return JSON.parse(t)}catch(t){return this.isConsoleLogEnabled&&console.log("Error while parsing the json string for log level: ",t),null}},t.prototype.getEventSamplingRate=function(t){var e=1;return this.eventSampling.event&&t in this.eventSampling.event&&(e=this.eventSampling.event[t]),e},t.prototype.isEventSampled=function(t){return!(!this.eventSampling.event||!(t in this.eventSampling.event))},t.EVENT_NAME="SDK",t.EVENT_ID="EventId",t.DEFAULT_SAMPLE_RATE=1,t}(),x=function(){function t(){}return t.getTenantToken=function(e){return 0===e?t.TENANT_TOKEN_PRODUCTION:t.TENANT_TOKEN_PRE_PRODUCTION},t.TENANT_TOKEN_PRODUCTION="d79e824386c4441cb8c1d4ae15690526-bd443309-5494-444a-aba9-0af9eef99f84-7360",t.TENANT_TOKEN_PRE_PRODUCTION="2bf6a2ffddca4a80a892a0b182132961-625cb102-8b0c-480e-af53-92e48695d08d-7736",t}(),G=!1,V=!1;function j(){if(!G){if(!s().OfficeBrowserFeedback.initOptions)throw new Error("Window.OfficeBrowserFeedback.initOptions not set");var t,e,n,i,o,a,u;s().OfficeBrowserFeedback.sdkVersion="0.0.0",r.get().setCommonInitOptions(s().OfficeBrowserFeedback.initOptions),V=r.get().isFeedbackSurveyEnabledByAADC(),t=r.get().getCommonInitOptions(),e="OfficeFeedbackSDK",n="0.0.0",i=r.get().getSdkSessionId(),o=r.get().getEventSampling(),a=t.telemetryGroup?t.telemetryGroup:{},u=t.webGroup?t.webGroup:{},U=new k(E.create(x.getTenantToken(t.environment),"Office_Feedback",new c(e,n),new l(i),new p(t.appId.toString(),t.originalLocale,t.sessionId,t.build),new g(a.audienceGroup),new h(u.browser,u.browserVersion),new f(a.deviceId),new v(a.loggableUserId?a.loggableUserId:t.cid,a.tenantId)),o,t),M=t.environment,G=!0,V||B().logEvent(O.FEEDBACK_SURVEYSDISABLED_AADC,1,{Data:JSON.stringify({ageGroup:r.get().getCommonInitOptions().ageGroup,authenticationType:r.get().getCommonInitOptions().authenticationType})})}}!function(t){o.isFeedbackSurveyEnabledByAADC=t}((function(){return V}));var z=n(2),q=function(t,e){return(q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var H=function(){return(H=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function W(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function J(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Y=n(5);var K="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==K&&K,Q="URLSearchParams"in K,Z="Symbol"in K&&"iterator"in Symbol,X="FileReader"in K&&"Blob"in K&&function(){try{return new Blob,!0}catch(t){return!1}}(),$="FormData"in K,tt="ArrayBuffer"in K;if(tt)var et=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],nt=ArrayBuffer.isView||function(t){return t&&et.indexOf(Object.prototype.toString.call(t))>-1};function rt(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||""===t)throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function it(t){return"string"!=typeof t&&(t=String(t)),t}function ot(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return Z&&(e[Symbol.iterator]=function(){return e}),e}function at(t){this.map={},t instanceof at?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function st(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function ut(t){return new Promise((function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function ct(t){var e=new FileReader,n=ut(e);return e.readAsArrayBuffer(t),n}function lt(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function pt(){return this.bodyUsed=!1,this._initBody=function(t){var e;this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:X&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:$&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:Q&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():tt&&X&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=lt(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):tt&&(ArrayBuffer.prototype.isPrototypeOf(t)||nt(t))?this._bodyArrayBuffer=lt(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Q&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},X&&(this.blob=function(){var t=st(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=st(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(ct)}),this.text=function(){var t,e,n,r=st(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=ut(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},$&&(this.formData=function(){return this.text().then(ht)}),this.json=function(){return this.text().then(JSON.parse)},this}at.prototype.append=function(t,e){t=rt(t),e=it(e);var n=this.map[t];this.map[t]=n?n+", "+e:e},at.prototype.delete=function(t){delete this.map[rt(t)]},at.prototype.get=function(t){return t=rt(t),this.has(t)?this.map[t]:null},at.prototype.has=function(t){return this.map.hasOwnProperty(rt(t))},at.prototype.set=function(t,e){this.map[rt(t)]=it(e)},at.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},at.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),ot(t)},at.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),ot(t)},at.prototype.entries=function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),ot(t)},Z&&(at.prototype[Symbol.iterator]=at.prototype.entries);var dt=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function gt(t,e){if(!(this instanceof gt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var n,r,i=(e=e||{}).body;if(t instanceof gt){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new at(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new at(e.headers)),this.method=(n=e.method||this.method||"GET",r=n.toUpperCase(),dt.indexOf(r)>-1?r:n),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==e.cache&&"no-cache"!==e.cache)){var o=/([?&])_=[^&]*/;if(o.test(this.url))this.url=this.url.replace(o,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function ht(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}})),e}function ft(t,e){if(!(this instanceof ft))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===e.statusText?"":""+e.statusText,this.headers=new at(e.headers),this.url=e.url||"",this._initBody(t)}gt.prototype.clone=function(){return new gt(this,{body:this._bodyInit})},pt.call(gt.prototype),pt.call(ft.prototype),ft.prototype.clone=function(){return new ft(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new at(this.headers),url:this.url})},ft.error=function(){var t=new ft(null,{status:0,statusText:""});return t.type="error",t};var vt=[301,302,303,307,308];ft.redirect=function(t,e){if(-1===vt.indexOf(e))throw new RangeError("Invalid status code");return new ft(null,{status:e,headers:{location:t}})};var yt=K.DOMException;try{new yt}catch(t){(yt=function(t,e){this.message=t,this.name=e;var n=Error(t);this.stack=n.stack}).prototype=Object.create(Error.prototype),yt.prototype.constructor=yt}function mt(t,e){return new Promise((function(n,r){var i=new gt(t,e);if(i.signal&&i.signal.aborted)return r(new yt("Aborted","AbortError"));var o=new XMLHttpRequest;function a(){o.abort()}o.onload=function(){var t,e,r={status:o.status,statusText:o.statusText,headers:(t=o.getAllResponseHeaders()||"",e=new at,t.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(t){return 0===t.indexOf("\n")?t.substr(1,t.length):t})).forEach((function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}})),e)};r.url="responseURL"in o?o.responseURL:r.headers.get("X-Request-URL");var i="response"in o?o.response:o.responseText;setTimeout((function(){n(new ft(i,r))}),0)},o.onerror=function(){setTimeout((function(){r(new TypeError("Network request failed"))}),0)},o.ontimeout=function(){setTimeout((function(){r(new TypeError("Network request failed"))}),0)},o.onabort=function(){setTimeout((function(){r(new yt("Aborted","AbortError"))}),0)},o.open(i.method,function(t){try{return""===t&&K.location.href?K.location.href:t}catch(e){return t}}(i.url),!0),"include"===i.credentials?o.withCredentials=!0:"omit"===i.credentials&&(o.withCredentials=!1),"responseType"in o&&(X?o.responseType="blob":tt&&i.headers.get("Content-Type")&&-1!==i.headers.get("Content-Type").indexOf("application/octet-stream")&&(o.responseType="arraybuffer")),!e||"object"!=typeof e.headers||e.headers instanceof at?i.headers.forEach((function(t,e){o.setRequestHeader(e,t)})):Object.getOwnPropertyNames(e.headers).forEach((function(t){o.setRequestHeader(t,it(e.headers[t]))})),i.signal&&(i.signal.addEventListener("abort",a),o.onreadystatechange=function(){4===o.readyState&&i.signal.removeEventListener("abort",a)}),o.send(void 0===i._bodyInit?null:i._bodyInit)}))}mt.polyfill=!0,K.fetch||(K.fetch=mt,K.Headers=at,K.Request=gt,K.Response=ft);var St=y.i,Tt=function(){function t(t){this.sessionId=t}return t.prototype.sendGetRequest=function(t,e,n,r){return W(this,void 0,void 0,(function(){var i;return J(this,(function(o){return i={method:"GET",headers:this.createHeaders(e)},[2,n?this.timeoutFetch(t,i,null!=r?r:5e3):fetch(t,i)]}))}))},t.prototype.sendPostRequest=function(t,e,n,r,i){return W(this,void 0,void 0,(function(){var o;return J(this,(function(a){return o={method:"POST",headers:this.createHeaders(n),body:e},[2,r?this.timeoutFetch(t,o,null!=i?i:5e3):fetch(t,o)]}))}))},t.prototype.createHeaders=function(t){var e="undefined"!=typeof Headers&&new Headers;return e&&(St(t)||e.append("Authorization","Bearer "+t),e.append("X-CorrelationId",y.h()),this.sessionId&&e.append("X-UserSessionId",this.sessionId)),e},t.prototype.timeoutFetch=function(t,e,n){return void 0===e&&(e={}),new Promise((function(r,i){fetch(t,e).then(r,i),setTimeout((function(){return i(new Error("Service request timed out"))}),n)}))},t}();function Ct(t,e){void 0===e&&(e=!0);var n="";for(var r in t||[])if(t.hasOwnProperty(r)){var i=t[r];if(null!=i&&"object"!=typeof i)n+=(n?"&":"")+(r+"="+(e?encodeURIComponent(i):i))}return n}var Et=n(33);function _t(t){return new Promise((function(e){setTimeout(e,t)}))}function At(t,e){var n=t&&t[e];return n||Object.getOwnPropertyDescriptor(t,e)?n:void 0}function It(t,e){if(!t)return Promise.resolve(null);var n=At(t,e);return n?Promise.resolve(n):new Promise((function(n,r){var i;Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return i},set:function(t){n(i=t)}})}))}function bt(t,e,n,r){return void 0===r&&(r=100),W(this,void 0,void 0,(function(){var i;return J(this,(function(o){switch(o.label){case 0:return(i=At(t,e))||0===n?[2,i]:[4,_t(r)];case 1:return o.sent(),[2,bt(t,e,n-1,r)]}}))}))}function wt(t,e){return new Promise((function(n,r){t.activateAnnotation(e,{callback:function(t){try{var r=(t&&t.items?t.items:[]).filter((function(t){return e===Et.SchemaObject.getTypeNameFor(t.body)}));n(r&&r[0]&&r[0].body)}catch(t){n({error:t})}}})}))}function Ot(t){return void 0===t&&(t=100),W(this,void 0,void 0,(function(){var e,n,r;return J(this,(function(i){switch(i.label){case 0:return(e=At(window,"augLoop"))?[3,7]:(n=P("TulipsAugLoopPackageDelayLoad",-1))>0?[4,_t(n)]:[3,2];case 1:return i.sent(),e=At(window,"augLoop"),[3,7];case 2:return r=P("TulipsAugLoopLoadRetryTimes",5),[4,bt(window,"augLoop",r,t)];case 3:return(e=i.sent())?[3,5]:[4,It(window,"augLoop")];case 4:e=i.sent(),i.label=5;case 5:return t>0?[4,_t(t)]:[3,7];case 6:i.sent(),i.label=7;case 7:return[2,e]}}))}))}function Ft(t,e,n){return void 0===n&&(n=100),W(this,void 0,void 0,(function(){var r,i,o;return J(this,(function(a){switch(a.label){case 0:return(i=e)?[4,e()]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return(r=i)?[3,5]:[4,Ot(n)];case 3:if(!a.sent())throw new Error("Unable to get AL runtime");if(!(o=window.augLoop.ALFactoryGlobal.getAugLoopRuntimeManager().getSession()))throw new Error("Unable to get AL session promise");return[4,o];case 4:if(!(r=a.sent()))throw new Error("Unable to get AL session");a.label=5;case 5:return[2,wt(r,t)]}}))}))}var Dt=function(){};var Lt,Nt,Pt=function(){function t(t,e,n,r,i,o,a,s,u,c,l,p,d,g,h){var f,v;this.locale="en-us",this.country="US",this.locale=r,this.country=i,this.authTokenCallback=a,this.augLoopCallback=s,this.app=t,this.platform=e,this.version=n,this.sessionId=o,this.campaignFlights=u,this.campaignParameters=c,this.ageGroup=l,this.authenticationType=p,this.messagingServiceSettings=g;var y=d&&-1!==["dogfood","edog","int","microsoft"].indexOf(d.toLowerCase()),m=y?null===(f=this.messagingServiceSettings)||void 0===f?void 0:f.messagingServiceIntUrl:null===(v=this.messagingServiceSettings)||void 0===v?void 0:v.messagingServiceProdUrl,S=y?"https://messaging.officeppe.com/lifecycle/":"https://messaging.office.com/lifecycle/";this.tmsBaseUrlPrefix=m||S,this.tmsgCache=this.tmsgCache||h||new D(["MessageMetadata","UserGovernance","CampaignContent","DynamicSettings","LogLevelSettings","UserFacts"])}return t.prototype.getContent=function(t){return W(this,void 0,void 0,(function(){return J(this,(function(e){switch(e.label){case 0:return this.tmsgCache.isItemExpired(t)?[4,this.refreshItemsInCacheFromTmsService([t])]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2,this.retrieveCacheItemAndCreateContentResponse(t)]}}))}))},t.prototype.getMultipleContents=function(t){return W(this,void 0,void 0,(function(){var e,n,r,i,o,a;return J(this,(function(s){switch(s.label){case 0:return[4,this.refreshItemsInCacheFromTmsService(t)];case 1:for(s.sent(),e=new Array,n=new Array,r=0,i=t;r<i.length;r++)o=i[r],a=this.createCachedContentResponse(o),e.push(a);return this.refreshItemsInCacheFromTmsService(n),[2,e]}}))}))},t.prototype.getUserFactsContent=function(t){return W(this,void 0,void 0,(function(){return J(this,(function(e){switch(e.label){case 0:return[4,this.refreshItemsInCacheFromTulipsService(t)];case 1:return e.sent(),[2,this.retrieveCacheItemAndCreateContentResponse(t)]}}))}))},t.prototype.sendBeaconRequestToService=function(t,e,n,r,i,o,a,s){return W(this,void 0,void 0,(function(){var u,c,l,p,d,g,h,f,v;return J(this,(function(y){switch(y.label){case 0:return this.sessionId=a,this.authTokenCallback=s,u=P("TmsAppId",Y.c.TMSAppID),[4,this.getAuthToken(u)];case 1:return c=y.sent(),l=void 0,c?[3,4]:(p=this.authTokenCallback.getUserPuid)?[4,this.authTokenCallback.getUserPuid()]:[3,3];case 2:p=y.sent(),y.label=3;case 3:l=p,y.label=4;case 4:d=+new Date,y.label=5;case 5:return y.trys.push([5,7,,8]),g={app:t,country:o,locale:i,platform:n,puid:l,version:r},h=JSON.stringify({actionName:e.actionName,actionUrl:e.actionUrl}),[4,this.sendRequest(g,c,"TmsActionUrl",this.tmsBaseUrlPrefix+"SetCampaignAction?",h,"POST")];case 6:return(f=y.sent())&&200===f.status?[2,!0]:(B().logEvent(O.WebSurfaces.Common.Error.VALUE,2,this.createTelemetryData(d,f,"Beacon"+e.actionName)),[2,!1]);case 7:return v=y.sent(),B().logEvent(O.WebSurfaces.Common.Error.VALUE,2,H({ErrorMessage:"Error fetching from TMS SetCampaignAction endpoint"+(v&&v.message?": "+v.message:"")},this.createTelemetryData(d,null,"Beacon"+e.actionName))),[2,!1];case 8:return[2]}}))}))},t.prototype.getCachedContent=function(t){return this.tmsgCache.getItemContent(t)},t.prototype.getAugLoopUserFactsContent=function(t){return W(this,void 0,void 0,(function(){return J(this,(function(e){switch(e.label){case 0:return this.tmsgCache.isItemExpired("UserFacts")?[4,this.refreshUserFactsInCacheFromAugLoop()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2,this.retrieveCacheItemAndCreateContentResponse(t)]}}))}))},t.prototype.refreshUserFactsInCacheFromAugLoop=function(){return W(this,void 0,void 0,(function(){var t,e,n,r,i,o,a,s;return J(this,(function(u){switch(u.label){case 0:if(!this.tmsgCache.isItemExpired("UserFacts"))return t=this.tmsgCache.getItemContent("UserFacts"),B().logEvent(O.UserFacts.AugLoop.Requests.VALUE,3,{Count:t?t.length:-1,Type:"AugLoopUserFactsCached",Flights:this.campaignFlights}),[2,t];e=+new Date,u.label=1;case 1:return u.trys.push([1,3,,4]),r=P("TulipsAugLoopAnnotationName","AugLoop_User_UserLifecycleFactsAnnotation"),i=this.augLoopCallback.getRuntimeSession,[4,Ft(r,i)];case 2:return(o=u.sent())&&o.userFacts?(n=this.addClientIngestionTimeAndNormalizeKeysInArray(o.userFacts),this.tmsgCache.setContentItem("UserFacts",n,864e5),B().logEvent(O.UserFacts.AugLoop.Requests.VALUE,3,H({Count:n?n.length:-1},this.createTelemetryData(e,null,"AugLoopUserFacts")))):(a=o&&o.error,B().logEvent(O.UserFacts.AugLoop.Error.VALUE,2,H({ErrorMessage:"Error getting augloop facts "+(a&&a.toString())},this.createTelemetryData(e,null,"AugLoopUserFacts")))),[3,4];case 3:return s=u.sent(),B().logEvent(O.UserFacts.AugLoop.Error.VALUE,2,H({ErrorMessage:"Error getting facts "+(s&&s.message)},this.createTelemetryData(e,null,"AugLoopUserFacts"))),[3,4];case 4:return[2,n]}}))}))},t.prototype.createTelemetryData=function(t,e,n){var r=e||{},i=r.headers,o=r.status,a=r.statusText,s=i&&i.get("X-UserSessionId"),u=i&&i.get("X-CorrelationId");return{Type:n,TimeMilliseconds:+new Date-t,SessionId:s||this.sessionId,CorrelationId:u||void 0,HttpStatusCode:o||void 0,HttpStatusText:a||void 0,Flights:this.campaignFlights}},t.prototype.sendRequest=function(t,e,n,r,i,o){this.tmsgTransport=this.tmsgTransport||new Tt(this.sessionId);var a=Ct(t),s=P(n,r);return"POST"===o?this.tmsgTransport.sendPostRequest(s+a,i,e):this.tmsgTransport.sendGetRequest(s+a,e)},t.prototype.retrieveCacheItemAndCreateContentResponse=function(t){var e=this.createCachedContentResponse(t);return this.tmsgCache.isItemExpired(t)&&("UserFacts"===t?this.refreshItemsInCacheFromTulipsService(t):this.refreshItemsInCacheFromTmsService([t])),e},t.prototype.createCachedContentResponse=function(t){var e=new Dt;return e.content=this.tmsgCache.getItemContent(t),e.contentType=t,e},t.prototype.getAuthToken=function(t){return W(this,void 0,void 0,(function(){var e,n,r,i,o,a=this;return J(this,(function(s){switch(s.label){case 0:if(!this.authTokenCallback||!this.authTokenCallback.getAuthToken)return[2,null];e=+new Date,n=function(){return+new Date-e},r=function(e){return void 0===e&&(e=void 0),{ErrorMessage:e,SessionId:a.sessionId,TimeMilliseconds:n(),Type:t}},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.authTokenCallback.getAuthToken(t)];case 2:return i=s.sent(),B().logEvent(O.WebSurfaces.Common.Info.VALUE,3,r()),[2,i];case 3:return o=s.sent(),B().logEvent(O.WebSurfaces.Common.Error.VALUE,2,r("Error getting token "+(o&&o.message?": "+o.message:""))),[3,4];case 4:return[2,null]}}))}))},t.prototype.refreshItemsInCacheFromTmsService=function(t){return W(this,void 0,void 0,(function(){var e,n,r,i,o,a,s,u,c,l,p,d,g,h,f,v;return J(this,(function(y){switch(y.label){case 0:if(0===t.length)return[2];for(e=new Array,n=0,r=t;n<r.length;n++)i=r[n],this.tmsgCache.isItemExpired(i)&&e.push(i);return 0===e.length?[2]:(-1===t.indexOf("DynamicSettings")&&t.push("DynamicSettings"),o=P("TmsAppId",Y.c.TMSAppID),[4,this.getAuthToken(o)]);case 1:return a=y.sent(),s=void 0,a?[3,4]:(u=this.authTokenCallback.getUserPuid)?[4,this.authTokenCallback.getUserPuid()]:[3,3];case 2:u=y.sent(),y.label=3;case 3:s=u,y.label=4;case 4:c=+new Date,y.label=5;case 5:return y.trys.push([5,10,,11]),l=document&&(document.documentElement||document.getElementsByTagName("body")[0]),p={pageWidth:window.innerWidth||l.clientWidth,pageHeight:window.innerHeight||l.clientHeight,screenWidth:screen?screen.width:void 0,screenHeight:screen?screen.height:void 0,colorDepth:screen?screen.colorDepth:void 0},d=b.safeReadObject(w.FileType.DebugOverrides,{}),g=d.replaceTmsQueryParams||H(H({country:this.country,locale:this.locale,app:this.app,platform:this.platform,version:this.version,campaignParams:Ct(p)+"&more=true&"+(this.campaignParameters||""),contentType:t.join(";"),puid:s,OFC_FLIGHTS:this.campaignFlights},d.addTmsQueryParams||{}),{ageGroup:this.ageGroup,authenticationType:this.authenticationType}),[4,this.sendRequest(g,a,"TmsServiceUrl",this.tmsBaseUrlPrefix+"CampaignMetadataAggregator?")];case 6:return 200!==(h=y.sent()).status?[3,8]:[4,h.json()];case 7:return f=y.sent(),-1!==t.indexOf("MessageMetadata")&&void 0!==f.MessageMetadata&&this.tmsgCache.setContentItem("MessageMetadata",f.MessageMetadata,P("TmsMessageMetadataExpiry",144e5)),-1!==t.indexOf("UserGovernance")&&void 0!==f.UserGovernanceRules&&this.tmsgCache.setContentItem("UserGovernance",f.UserGovernanceRules,P("TmsUserGovernanceRulesExpiry",144e5)),-1!==t.indexOf("CampaignContent")&&void 0!==f.CampaignContent&&this.tmsgCache.setContentItem("CampaignContent",f.CampaignContent,P("TmsCampaignContentExpiry",144e5)),void 0!==f.DynamicSettings&&this.tmsgCache.setContentItem("DynamicSettings",f.DynamicSettings,P("TmsDynamicSettingsExpiry",144e5)),void 0!==f.LogLevelSettings&&this.tmsgCache.setContentItem("LogLevelSettings",f.LogLevelSettings,P("TmsLogLevelSettingsExpiry",144e5)),B().logEvent(O.WebSurfaces.Messaging.Requests.VALUE,3,this.createTelemetryData(c,h,t.join(";"))),[3,9];case 8:B().logEvent(O.WebSurfaces.Common.Error.VALUE,2,this.createTelemetryData(c,h,t.join(";"))),y.label=9;case 9:return[3,11];case 10:return v=y.sent(),B().logEvent(O.WebSurfaces.Common.Error.VALUE,2,H({ErrorMessage:"Error fetching from TMS"+(v&&v.message?": "+v.message:"")},this.createTelemetryData(c,null,t.join(";")))),[3,11];case 11:return[2]}}))}))},t.prototype.refreshItemsInCacheFromTulipsService=function(t){return W(this,void 0,void 0,(function(){var e,n,r,i,o,a,s;return J(this,(function(u){switch(u.label){case 0:return this.tmsgCache.isItemExpired(t)?(e=P("TulipsAppId",Y.c.TULIPSAppID),[4,this.getAuthToken(e)]):[2];case 1:if(!(n=u.sent()))return[2];r=+new Date,u.label=2;case 2:return u.trys.push([2,7,,8]),[4,this.sendRequest({},n,"TulipsServiceUrl","https://substrate.office.com/OfficePersonalizationUserLifecycle/api/facts")];case 3:return 200!==(i=u.sent()).status&&204!==i.status?[3,5]:[4,i.json()];case 4:return o=u.sent(),-1!==t.indexOf("UserFacts")&&void 0!==o&&(a=this.addClientIngestionTimeAndNormalizeKeys(o),this.tmsgCache.setContentItem("UserFacts",a,864e5)),B().logEvent(O.UserFacts.Messaging.Requests.VALUE,3,this.createTelemetryData(r,i,t)),[3,6];case 5:B().logEvent(O.UserFacts.Common.Error.VALUE,2,this.createTelemetryData(r,i,t)),u.label=6;case 6:return[3,8];case 7:return s=u.sent(),B().logEvent(O.UserFacts.Common.Error.VALUE,2,H({ErrorMessage:"Error fetching from TULIPS"+(s&&s.message?": "+s.message:"")},this.createTelemetryData(r,null,t))),[3,8];case 8:return[2]}}))}))},t.prototype.addClientIngestionTimeAndNormalizeKeys=function(t){var e=this,n=new Date(Date.now()).toISOString();return t.map((function(t){var r=e.normalizeKeys(t);return r.clientIngestionDateTime=n,r}))},t.prototype.addClientIngestionTimeAndNormalizeKeysInArray=function(t){var e=this,n=new Date(Date.now()).toISOString();return t.map((function(t){var r=e.normalizeKeys(t);return r.clientIngestionDateTime=n,r}))},t.prototype.normalizeKeys=function(t){for(var e={},n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];e[i.charAt(0).toLowerCase()+i.substring(1)]=t[i]}return e},t}(),Ut=function(){function t(){var t,e;this.configuration=r.get();var n=this.configuration&&this.configuration.getFloodgateInitOptions(),i=this.configuration&&this.configuration.getCommonInitOptions(),o=n&&n.authTokenCallback;if(o&&(o.getAuthToken||o.getUserPuid)||this.isAugLoopEnabled()){var a=this.configuration.getCommonInitOptions();this.tmsgClient=new Pt(a.appId.toString(),"Web",a.build,a.originalLocale,this.extractCountryFromLocale(a.originalLocale),this.configuration.getSdkSessionId(),n.authTokenCallback,n.augLoopCallback,n.campaignFlights,n.campaignQueryParameters,i.ageGroup,i.authenticationType,(null===(t=i.telemetryGroup)||void 0===t?void 0:t.audienceGroup)||(null===(e=i.telemetryGroup)||void 0===e?void 0:e.audience),n.messagingServiceSettings)}}return t.prototype.getCampaignDefinitions=function(){var t,e=(t=b.safeReadObject(w.FileType.DebugOverrides,{}))&&t.tmsResponse&&t.tmsResponse.CampaignContent&&{contentType:"CampaignContent",content:t.tmsResponse.CampaignContent};return e&&e.content?Promise.resolve(e.content):this.tmsgClient?this.tmsgClient.getContent("CampaignContent").then((function(t){return t.content})):Promise.resolve(null)},t.prototype.getCachedCampaignDefinitions=function(){var t;return null===(t=this.tmsgClient)||void 0===t?void 0:t.getCachedContent("CampaignContent")},t.prototype.getUserGovernanceRules=function(){return this.tmsgClient?this.tmsgClient.getContent("UserGovernance").then((function(t){return t.content})):Promise.resolve(null)},t.prototype.getMessageMetadata=function(){return this.tmsgClient?this.tmsgClient.getContent("MessageMetadata").then((function(t){return t.content})):Promise.resolve(null)},t.prototype.getUserFacts=function(){var t,e=this,n=(t=b.safeReadObject(w.FileType.DebugOverrides,{}))&&t.userFactsResponse&&{contentType:"UserFacts",content:t.userFactsResponse};if(n&&n.content)return Promise.resolve(n.content);if(!this.tmsgClient)return Promise.resolve(null);if(this.isAugLoopEnabled()){var r=P("TulipsLoadTimeout",1e3);return Object(y.a)(r,this.getAugLoopUserFacts()).then((function(t){return t})).catch((function(){return e.getSubstrateUserFacts()}))}return this.getSubstrateUserFacts()},t.prototype.getCachedUserFacts=function(){var t;return null===(t=this.tmsgClient)||void 0===t?void 0:t.getCachedContent("UserFacts")},t.prototype.setCampaignAction=function(t){if(this.tmsgClient){var e=this.configuration.getCommonInitOptions(),n=this.configuration.getFloodgateInitOptions();return this.tmsgClient.sendBeaconRequestToService(e.appId.toString(),t,"Web",e.build,e.originalLocale,this.extractCountryFromLocale(e.originalLocale),this.configuration.getSdkSessionId(),n.authTokenCallback)}},t.prototype.extractCountryFromLocale=function(t){if(t){var e=t.split("-");return 2===e.length?e[1]:void 0}},t.prototype.getSubstrateUserFacts=function(){return this.tmsgClient?this.tmsgClient.getUserFactsContent("UserFacts").then((function(t){return t.content})):Promise.resolve(null)},t.prototype.getAugLoopUserFacts=function(){return this.tmsgClient?this.tmsgClient.getAugLoopUserFactsContent("UserFacts").then((function(t){return t.content})):Promise.resolve(null)},t.prototype.isAugLoopEnabled=function(){var t,e,n;return null===(n=null===(e=null===(t=this.configuration)||void 0===t?void 0:t.getFloodgateInitOptions())||void 0===e?void 0:e.augLoopCallback)||void 0===n?void 0:n.isEnabled},t}();function Mt(){return Lt||(Lt=new Ut),Lt}function Rt(){var t,e,n,i,o,a,s,u,c,l,p;Nt||(s=r.get().getCommonInitOptions(),u=(null===(n=s.telemetryGroup)||void 0===n?void 0:n.audienceGroup)||(null===(i=s.telemetryGroup)||void 0===i?void 0:i.audience),c=u&&-1!==["dogfood","edog","int","microsoft"].indexOf(u.toLowerCase()),l=c?null===(o=s.webSurfacesSettings)||void 0===o?void 0:o.webSurfacesIntUrl:null===(a=s.webSurfacesSettings)||void 0===a?void 0:a.webSurfacesProdUrl,p=c?Y.a.WebSurfacesIntLink:Y.a.WebSurfacesProdLink,t=l||P(c?"WebSurfacesIntLink":"WebSurfacesProdLink",p),void 0===(e=null)&&(e=window.origin),Nt=new Promise((function(n,r){var i=document.createElement("script");i.async=!0,i.readyState?i.onreadystatechange=function(){"loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,n())}:i.onload=function(){n()},i.onerror=function(){r()},i.src=t,e&&"null"!==e&&(i.crossOrigin="anonymous");var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(i,o)})))}var Bt=function(){function t(){}return t.prototype.makeSurveyLauncher=function(t){return this.AcceptsSurvey(t)?new kt(t):null},t.prototype.AcceptsSurvey=function(e){return!Object(y.i)(e)&&e.getType()===_.ISurvey.Type.GenericMessagingSurface&&e.getLauncherType().toLocaleLowerCase()===t.LAUNCHER_TYPE},t.LAUNCHER_TYPE="coachingux",t}(),kt=function(){function t(t){var e;this.survey=t,!Nt&&t&&t.getSurveyInfo&&(null===(e=t.getSurveyInfo())||void 0===e?void 0:e.getBusinessLevel())===_.ISurveyInfo.BusinessLevel.Critical&&setTimeout(Rt,1e3)}return t.prototype.launch=function(t){var e=this,n=this.survey&&this.survey.getSurveyInfo(),i=n&&n.getMetadata(),o=i&&i.getContentMetadata();if(o){var a=new Date,s=function(){var t=u();return t&&t.OfficeWebSurfaces},c=function(r){var i=s();r&&i.Initialize(r),i.RemoveSurface();var a=H(H({},o),{surfaceContext:{surveyForm:e.survey,surveyParams:t}});i.RenderSurface(a,null,n.getBackEndId())},l=function(t){B().logEvent(O.WebSurfaces.Common.Error.VALUE,1,{ErrorMessage:"Error loading websurfaces"+(t&&t.message?": "+t.message:""),TimeMilliseconds:Date.now()-+a})};try{if(s())return void c();Rt(),Nt.then((function(){var t=r.get().getCommonInitOptions(),e=r.get().getFloodgateInitOptions(),i=e&&e.onSurveyActivatedCallback,o=H(H(H({},t),e),{beaconCallback:function(t){if(t)return Mt().setCampaignAction(t)},surfaceInitTime:a,surfaceId:n.getBackEndId(),logSessionId:r.get().getSdkSessionId(),logSettings:P("LogLevelSettings",void 0),renderer:i,renderCallback:i&&i.onTeachingCampaignRender});c(o)})).catch((function(t){l(t)}))}catch(t){l(t)}}},t}(),xt=function(){function t(t){if(this.showPrompt=!0,this.showEmailRequest=!1,!t)throw Error("survey must not be null");if(this.survey=t,t.getType()===_.ISurvey.Type.Intercept){this.isIntercept=!0;var e=t.getComponent("Intercept");if(!e)throw Error("intercept component must not be null");this.intercept=e}else{this.isIntercept=!1;var n=t.getComponent("Prompt"),r=t.getComponent("Comment"),i=t.getComponent("Rating"),o=t.getComponent("CVSurvey");if(!n)throw Error("prompt component must not be null");if(this.prompt=n,this.showEmailRequest=t.getSurveyInfo().isAdditionalDataRequested(0),!r)throw Error("comment component must not be null");if(this.comment=r,!i)throw Error("rating component must not be null");if(this.rating=i,o&&(this.cvSurvey=o,this.getLauncherType()===Y.e&&!this.getCVSurveyFormId()))throw Error("CvSurveyId should not be null")}}return t.prototype.getLauncherType=function(){return this.isIntercept?void 0:this.survey.getLauncherType()},t.prototype.getCVSurveyFormId=function(){return this.isIntercept?void 0:this.cvSurvey.getFormId()},t.prototype.getPreGeneratedClientFeedbackId=function(){return this.survey.getPreGeneratedClientFeedbackId()},t.prototype.getPromptQuestion=function(){return this.isIntercept?void 0:this.prompt.getQuestion()},t.prototype.getTitle=function(){return this.isIntercept?void 0:this.prompt.getTitle()},t.prototype.getPromptYesButtonText=function(){return this.isIntercept?void 0:this.prompt.getYesButtonText()},t.prototype.getPromptNoButtonText=function(){return this.isIntercept?void 0:this.prompt.getNoButtonText()},t.prototype.getRatingValuesAscending=function(){return this.isIntercept?void 0:this.rating.getRatingValuesAscending()},t.prototype.getRatingQuestion=function(){return this.isIntercept?void 0:this.rating.getQuestion()},t.prototype.getCommentQuestion=function(){return this.isIntercept?void 0:this.comment.getQuestion()},t.prototype.getInterceptTitle=function(){return this.isIntercept?this.intercept.getTitle():void 0},t.prototype.getInterceptQuestion=function(){return this.isIntercept?this.intercept.getQuestion():void 0},t.prototype.getInterceptUrl=function(){return this.isIntercept?this.intercept.getUrl():void 0},t.prototype.setValues=function(t,e){this.isIntercept||(this.rating.setSelectedRatingIndex(t),this.comment.setSubmittedText(e))},t.prototype.getJsonElements=function(){return this.survey.getJsonElements()},t.prototype.getSurveyType=function(){return this.survey.getType()},t.prototype.getCampaignId=function(){return this.survey.getSurveyInfo().getBackEndId()},t.prototype.getId=function(){return this.survey.getSurveyInfo().getId()},t.prototype.getGoverenedChannelType=function(){return this.survey.getSurveyInfo().getGovernedChannelType()},t}(),Gt=z.Utils.isNOU,Vt=function(){function t(){}return t.prototype.makeSurveyLauncher=function(t){return this.AcceptsSurvey(t)?new jt(t):null},t.prototype.AcceptsSurvey=function(t){return!Gt(t)&&t.getType()!==z.Api.ISurvey.Type.GenericMessagingSurface},t.LAUNCHER_TYPE=z.Api.ISurvey.LAUNCHER_TYPE_DEFAULT,t}(),jt=function(){function t(t){this.survey=t}return t.prototype.launch=function(){s().OfficeBrowserFeedback.floodgate.showSurvey(new xt(this.survey))},t}(),zt=z.Utils.isNOU,qt=function(){function t(t,e){this.rudeSurveyLauncherFactory=t,this.coachingUXLauncherFactory=e}return t.make=function(){return new t(new Vt,new Bt)},t.prototype.makeSurveyLauncher=function(t){if(zt(t))return null;switch(t.getLauncherType().toLocaleLowerCase()){case Bt.LAUNCHER_TYPE:return this.makeGenericMessagingSurfaceLauncher(t);case Vt.LAUNCHER_TYPE:default:return this.makeRudeSurveyLauncher(t)}},t.prototype.AcceptsSurvey=function(t){if(zt(t))return!1;switch(t.getType()){case z.Api.ISurvey.Type.GenericMessagingSurface:return!zt(this.coachingUXLauncherFactory)&&this.coachingUXLauncherFactory.AcceptsSurvey(t);default:return r.get().checkIfSurveysEnabled()&&!zt(this.rudeSurveyLauncherFactory)&&this.rudeSurveyLauncherFactory.AcceptsSurvey(t)}},t.prototype.makeGenericMessagingSurfaceLauncher=function(t){return zt(this.coachingUXLauncherFactory)?null:this.coachingUXLauncherFactory.makeSurveyLauncher(t)},t.prototype.makeRudeSurveyLauncher=function(t){return zt(this.rudeSurveyLauncherFactory)?null:this.rudeSurveyLauncherFactory.makeSurveyLauncher(t)},t}();function Ht(t,e,n,i){if(void 0===e)return Promise.reject(new Error("Manifest cannot be undefined"));var o,a,s,u,c,l,p,d=new FormData;return d.append("Manifest",e),n&&d.append("Screenshot",n),i&&d.append("Diagnostics",i),o="POST",a=t?"https://petrol.office.microsoft.com/v1/feedback":"https://petrol-int.office.microsoft.com/v1/feedback",s=d,u=2,c=function(t,e,n){200!==t.status&&n(new Error("Non-200 response with status code: "+t.status+", response: "+t.responseText)),e()},l=function(t,e){return new Promise((function(n,r){var i=new XMLHttpRequest;i.open(o,a,!0),i.timeout=e,i.onload=function(){c(i,n,r)},i.ontimeout=function(){t>0?l(t-1,2*e).then(n,r):r(new Error("Request to '"+a+"' timed out. timeout: "+i.timeout))},i.onerror=function(){t>0?l(t-1,e).then(n,r):r(new Error("Request to '"+a+"' errored. "+i.status+" - "+i.statusText+" : "+i.responseText))},i.send(s)}))},p=r.get().getCommonInitOptions().petrolTimeout?r.get().getCommonInitOptions().petrolTimeout:8e3,l(u,p)}var Wt=function(){function t(t){this.screenshot=t}return t.prototype.getContent=function(){var t;try{t=this.screenshot.toDataURL("image/jpeg").split(",")[1]}catch(e){B().logEvent(O.Shared.Screenshot.GetContent.Failed.DefaultImage.Returned.VALUE,2,{ErrorMessage:e.toString()}),t="iVBORw0KGgoAAAANSUhEUgAAAN0AAAA+AQMAAACV2ox1AAAABGdBTUEAALGPC/xhBQAAAAZQTFRFAAAA////pdmf3QAAAAlwSFlzAAAOwgAADsIBFShKgAAAAjtJREFUSMfV1M1rE0EUAHDBa5r8A9vkL6giFiI0JH+Ih9KLx8TaukkJugShHgrJzYvkVPQkUqgwSePLEELaU+zBg8JKVvSQQNydlsadwCQzziRZ82ETxYMfc3gD8+MxjzcfV8T80f0vkQ8i68tAPSMSQ0PkI6QDpEPkZBHy1Wp1/zjni2lrZq2T2uikDG17A54Hr0vsvwXIl3WXt02zeIHQBSq3DxHk7VO55zIFgLLrcmaaQBGiqCwQArBVQTbNZODNBB5Ee2EEr5eGiDG4k5mcqcy+Ksh+N8K2+bRI1Z68fRMVoV+XmcFwpQJZGohpkds1WtjppGLaq51a2b8yp310UW9/H8VfRj68CIKRsWCFPCCEM419S4bSAOmPmdb3TBrQ4lmnt9n4/Hiv5fTunsOzXbJfLR2rU3Fd5ugOe9mw0lvNOCNxyDdIHkpHCv0S3a+MS0yT+4wkAKx1gBJeVxeMRhSeNZpXJfY+zqAVl+g0mCFRJMgs6oy9+MCMrWZaJJwiWFjuWcIShf+Wk2W9e59OHu21WPdsswZNLKs9wV77mJiaMVbBQ+/1jGZDofFLuOBU/jzG6OQKnkLOZ5EvwolMX2Q19TAX9MWyy/aNarewfZptechdLn8B3TatB/YXB2j4MKw3jTHKX4AO0CbqaSddMokHUbr0PpSXmFG4O4WIu86asCVihfoM6nUmse5gGkbJOyThVesX4UI0d00LBYMr55VuIZl8MkY1uOiTy9v3c+ShuXj5+NdQdL8B+5gmw8WZuREAAAAASUVORK5CYII="}for(var e=atob(t),n=[],r=0;r<e.length;r++)n.push(e.charCodeAt(r));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})},t}(),Jt=function(){function t(t,e,n,r,i,o,a,u){this.manifestData={appId:e,application:o,clientFeedbackId:i,manifestType:t,source:"Client",submitTime:n,telemetry:a,type:Yt(r),web:u,sdkVersion:Y.d+(void 0!==s().OfficeBrowserFeedback.sdkVersion?s().OfficeBrowserFeedback.sdkVersion:"0.0.0")}}return t.prototype.getExtendedManifestData=function(){return this.manifestData.application.extendedManifestData},t.prototype.setComment=function(t){this.manifestData.comment=t},t.prototype.setEmail=function(t){this.manifestData.email=t},t.prototype.setCategory=function(t){this.manifestData.telemetry=this.manifestData.telemetry||{},this.manifestData.telemetry.featureArea=t},t.prototype.setAppData=function(t){this.manifestData.application=this.manifestData.application||{},this.manifestData.application.appData=t},t.prototype.setExtendedManifestData=function(t){this.manifestData.application=this.manifestData.application||{},this.manifestData.application.extendedManifestData=t},t.prototype.setClientFeedbackId=function(t){this.manifestData.clientFeedbackId=t},t.prototype.getClientFeedbackId=function(){return this.manifestData.clientFeedbackId},t.prototype.setComplianceInformation=function(t,e,n,r,i,o){this.manifestData.complianceChecks={authenticationType:t,ageGroup:e,policyAllowFeedback:n,policyAllowSurvey:r,policyAllowScreenshot:i,policyAllowContact:o}},t.prototype.setValues=function(t){if(t)for(var e in t)t.hasOwnProperty(e)&&(this.manifestData.hasOwnProperty(e)?this.manifestData[e]=y.j(t[e],this.manifestData[e]):this.manifestData[e]=t[e])},t.prototype.getContent=function(){return new Blob([JSON.stringify(this.manifestData)],{type:"application/json"})},t}();function Yt(t){return"Survey"===t?t:Y.b[t]}var Kt,Qt=function(){function t(t,e,n,i,o,a,s){var u,c,l,p,d,g,h,f;this.clientFeedbackId=y.h(),this.manifest=new Jt(e,n,(new Date).toISOString(),i,this.clientFeedbackId,H({},o),H({},a),H({},s)),this.environment=t,this.manifest.setComplianceInformation(r.AuthenticationType[null!==(c=null===(u=r.get().getCommonInitOptions())||void 0===u?void 0:u.authenticationType)&&void 0!==c?c:r.AuthenticationType.Unauthenticated],r.AgeGroup[null!==(p=null===(l=r.get().getCommonInitOptions())||void 0===l?void 0:l.ageGroup)&&void 0!==p?p:r.AgeGroup.Undefined],this.ocpsEnumToString(null===(d=r.get().getInAppFeedbackInitOptions())||void 0===d?void 0:d.sendFeedbackPolicyValue),this.ocpsBooleanToString(null===(g=r.get().getFloodgateInitOptions())||void 0===g?void 0:g.surveyEnabled),this.ocpsEnumToString(null===(h=r.get().getCommonInitOptions())||void 0===h?void 0:h.screenshotPolicyValue),this.ocpsEnumToString(null===(f=r.get().getCommonInitOptions())||void 0===f?void 0:f.emailPolicyValue))}return t.prototype.getClientFeedbackId=function(){return this.clientFeedbackId},t.prototype.getExtendedManifestData=function(){return this.manifest.getExtendedManifestData()},t.prototype.setComment=function(t){this.manifest.setComment(t)},t.prototype.setEmail=function(t){this.manifest.setEmail(t)},t.prototype.setCategory=function(t){this.manifest.setCategory(t)},t.prototype.setAppData=function(t){this.manifest.setAppData(t)},t.prototype.setExtendedManifestData=function(t){this.manifest.setExtendedManifestData(t)},t.prototype.setScreenshot=function(t){this.screenshot=new Wt(t)},t.prototype.setClientFeedbackId=function(t){this.manifest.setClientFeedbackId(t)},t.prototype.getManifest=function(){return this.manifest},t.prototype.setManifestValues=function(t){this.manifest.setValues(t)},t.prototype.submit=function(){if(!r.get().isFeedbackSurveyEnabledByAADC())return B().logEvent(O.Shared.Upload.Prevented.VALUE,2,{Data:JSON.stringify({ageGroup:r.get().getCommonInitOptions().ageGroup,authenticationType:r.get().getCommonInitOptions().authenticationType})}),Promise.resolve();var t=this.manifest.getContent(),e=void 0,n=this.clientFeedbackId;return this.screenshot&&(e=this.screenshot.getContent()),Ht(0===this.environment,t,e).catch((function(t){r.get().setFeedbackSubmitted(!1),r.get().getCommonInitOptions().onError("Payload submission failed: "+t.message+". ClientFeedbackId: "+n),B().logEvent(O.Shared.Upload.Failed.VALUE,2,{ErrorMessage:t.message,ClientFeedbackId:n})}))},t.prototype.ocpsBooleanToString=function(t){return void 0===t?"Not Configured":t?"Enabled":"Disabled"},t.prototype.ocpsEnumToString=function(t){if(!t)return"Not Configured";switch(t){case 2:return"Disabled";case 1:return"Enabled";default:return"Not Configured"}},t}(),Zt=function(){function t(){}return t.prototype.makeTransporter=function(t){return new Qt(r.get().getCommonInitOptions().environment,t,r.get().getCommonInitOptions().appId,"Survey",r.get().getCommonInitOptions().applicationGroup,r.get().getCommonInitOptions().telemetryGroup,r.get().getCommonInitOptions().webGroup)},t}(),Xt=function(){function t(){}return t.prototype.getLanguage=function(){return r.get().getCommonInitOptions().originalLocale},t}();var $t,te=function(){function t(){}return t.prototype.loadStringResource=function(t){var e=Kt;switch(t){case 5:return e.Floodgate.Nps.Rating.Points11Value0;case 6:return e.Floodgate.Nps.Rating.Points11Value1;case 7:return e.Floodgate.Nps.Rating.Points11Value2;case 8:return e.Floodgate.Nps.Rating.Points11Value3;case 9:return e.Floodgate.Nps.Rating.Points11Value4;case 10:return e.Floodgate.Nps.Rating.Points11Value5;case 11:return e.Floodgate.Nps.Rating.Points11Value6;case 12:return e.Floodgate.Nps.Rating.Points11Value7;case 13:return e.Floodgate.Nps.Rating.Points11Value8;case 14:return e.Floodgate.Nps.Rating.Points11Value9;case 15:return e.Floodgate.Nps.Rating.Points11Value10;case 16:return e.Floodgate.Nps.Rating.Points5Value1;case 17:return e.Floodgate.Nps.Rating.Points5Value2;case 18:return e.Floodgate.Nps.Rating.Points5Value3;case 19:return e.Floodgate.Nps.Rating.Points5Value4;case 20:return e.Floodgate.Nps.Rating.Points5Value5;case 4:return e.Floodgate.Nps.Rating.Question;case 21:return e.Floodgate.Nps.Comment.Question;case 3:return e.Floodgate.Nps.Prompt.No;case 1:return e.Floodgate.Nps.Prompt.Question;case 0:return e.Floodgate.Nps.Prompt.Title;case 2:return e.Floodgate.Nps.Prompt.Yes;default:return""}},t.prototype.getCustomString=function(t){return r.get().getFloodgateInitOptions().uIStringGetter(t)},t}(),ee=n(13),ne=function(){function t(){this.loadAsyncTriggered=!1,this.campaignDefinitions=[]}return t.prototype.load=function(){return this.loadAsyncTriggered||(this.loadAsync(),this.loadAsyncTriggered=!0),this.campaignDefinitions||[]},t.prototype.loadAsync=function(){var t=this,e=Mt().getCampaignDefinitions();e.then((function(e){t.loadCampaignDefinitions(e),t.loadAsyncTriggered=!0}));var n=P("TmsLoadTimeout",1e3),r=Object(y.a)(n,e);return new Promise((function(e,n){r.then((function(n){t.loadCampaignDefinitions(n),t.loadAsyncTriggered=!0,e(t.campaignDefinitions)})).catch((function(n){t.campaignDefinitions.length<=0&&t.loadCampaignDefinitions(Mt().getCachedCampaignDefinitions()),e(t.campaignDefinitions)})).catch((function(n){e(t.campaignDefinitions)}))}))},t.prototype.loadCampaignDefinitions=function(t){var e=t&&t.campaigns;e&&(this.campaignDefinitions=Object(ee.FilterValidCampaignDefinitions)(e).result)},t}();function re(){try{var t=document&&(document.documentElement||document.getElementsByTagName("body")[0]);return{pageWidth:(null===window||void 0===window?void 0:window.innerWidth)||(null==t?void 0:t.clientWidth),pageHeight:(null===window||void 0===window?void 0:window.innerHeight)||(null==t?void 0:t.clientHeight),pageTop:(null===window||void 0===window?void 0:window.pageYOffset)||(null==t?void 0:t.scrollTop),pageLeft:(null===window||void 0===window?void 0:window.pageXOffset)||(null==t?void 0:t.scrollLeft),screenWidth:screen?screen.width:0,screenHeight:screen?screen.height:0,colorDepth:screen?screen.colorDepth:0,userAgent:null===navigator||void 0===navigator?void 0:navigator.userAgent}}catch(t){return null}}function ie(t,e){if(!t)return null;var n=t[e];if(!n){var r=e.toLowerCase();n=t[Object.keys(t).find((function(t){return t.toLowerCase()===r}))]}if(z.Utils.isNOU(n))return null;if(!z.Utils.isArray(n)&&(z.Utils.isObject(n)||z.Utils.isFunction(n)))return null;var i=(new Date).toISOString();return{userFactType:"Local",userFactName:e,userFactValue:n.toString(),sourceDateTime:i,storageDateTime:i,clientIngestionDateTime:i}}function oe(t){try{if(!$t){var e=r.get().getCommonInitOptions();$t=[e,null==e?void 0:e.applicationSettings,null==e?void 0:e.telemetryGroup,null==e?void 0:e.applicationGroup,null==e?void 0:e.webGroup,r.get().getFloodgateInitOptions(),r.get(),re(),{userConsentGroup:r.get().getUserConsentGroup(),feedbackEnabledByAADC:r.get().isFeedbackSurveyEnabledByAADC()}]}var n=$t.reduce((function(e,n){return e||ie(n,t)}),null);return n||(n=function(t){var e=t&&t.split("__");if(!e||e.length<=1)return null;var n=null,r=e[0],i=e.pop();if(i&&1===e.length&&(n=ie(window[r]||window,i)),!n&&i&&e.length>1){"window"===r&&e.shift();var o=e.reduce((function(t,e){return t&&t[e]}),window);o&&(n=ie(o,i))}return n&&(n.userFactName=t),n}(t)),n}catch(e){return B().logEvent(O.UserFacts.LocalFact.Error.VALUE,2,{ErrorMessage:"Error getting local fact - "+t+" "+(e&&e.message?": "+e.message:"")+" "}),null}}var ae=function(){function t(){this.loadAsyncTriggered=!1,this.userFacts=[],this.nameAndUserFactMap={}}return t.prototype.load=function(){return this.loadAsyncTriggered||(this.loadAsync(),this.loadAsyncTriggered=!0),this.userFacts||[]},t.prototype.loadAsync=function(){var t=this,e=Mt().getUserFacts().then((function(e){t.loadUserFacts(e)})),n=P("TulipsLoadTimeout",1e3);return Object(y.a)(n,e).then((function(){return t.userFacts})).catch((function(){return(!t.userFacts||t.userFacts.length<=0)&&t.loadUserFacts(Mt().getCachedUserFacts()),t.userFacts})).catch((function(){return t.userFacts}))},t.prototype.getUserFact=function(t){var e=this.nameAndUserFactMap[t];return e||this.nameAndUserFactMap.hasOwnProperty(t)?e:e=this.nameAndUserFactMap[t]=oe(t)},t.prototype.loadUserFacts=function(t){var e=this;t&&(this.userFacts=t||[],this.userFacts.map((function(t){e.nameAndUserFactMap[t.userFactName]=t})),this.loadAsyncTriggered=!0,this.logUserFactInfo(this.userFacts))},t.prototype.logUserFactInfo=function(t){if(t&&!(t.length<=0)){var e=P("TulipsIngestionTimeInterval",864e5);if(!(e<=0)){var n;try{var r=Date.now(),i=function(t){var n=Date.parse(t);return!!isNaN(n)||r-n>e},o={Count:t.length,RefreshTime:e,IngestionTime:t[0].clientIngestionDateTime,SourcesExpired:t.filter((function(t){return t&&i(t.sourceDateTime)})).length||void 0,StoragesExpired:t.filter((function(t){return t&&i(t.storageDateTime)})).length||void 0,IngestionsExpired:t.filter((function(t){return t&&i(t.clientIngestionDateTime)})).length||void 0};n={Message:"UserFacts",Data:JSON.stringify(o)}}catch(t){n={ErrorMessage:"Error getting UserFact info"}}B().logEvent(O.UserFacts.Provider.Info.VALUE,3,n)}}},t}(),se=n(8),ue=n(18),ce=n(9),le=n(24),pe=n.n(le),de=n(3),ge=function(t){function e(e){var n=t.call(this)||this;return n.simpleRequestEnabled=!1,n.simpleRequestEnabled=null!=e&&e,n}return function(t,e){function n(){this.constructor=t}q(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.postRequestWithRetry=function(t,e,n,r){var i=this;return new Promise((function(o,a){i.sendPostRequest(t,e,void 0,!0,r).then(o).catch((function(s){if(B().logEvent(O.DYNAMICTRANSPORT_POST_ERROR,2,{ErrorMessage:s.toString(),TimeMilliseconds:r,Count:n,CorrelationId:i.requestId}),n<=1)return a(s);i.postRequestWithRetry(t,e,n-1,r).then(o).catch(a)}))}))},e.prototype.createHeaders=function(t){var e="undefined"!=typeof Headers&&new Headers;return e&&(this.simpleRequestEnabled?this.createSimpleHeaders(e):this.createNormalHeaders(e),Object(de.isNOU)(t)||e.append("Authorization","Bearer "+t)),e},e.prototype.createNormalHeaders=function(t){this.requestId=Object(de.guid)(),t.append("X-Request-ID",this.requestId),t.append("Content-Type","application/json")},e.prototype.createSimpleHeaders=function(t){t.append("Content-Type","text/plain")},e}(Tt),he=n(14),fe=new(function(){function t(){this.personalizerEnabled=!1,this.dynamicTransport=new ge,this.personalizerSurveyInformationMap={}}return t.prototype.setup=function(t){this.personalizerEnabled=t.getFloodgateInitOptions().governanceServiceEnabled&&t.getFloodgateInitOptions().personalizerEnabled,this.personalizerEnabled&&(this.isProduction=0===t.getCommonInitOptions().environment,this.retryLimit=t.getFloodgateInitOptions().governanceServiceConfig.retry,this.timeout=t.getFloodgateInitOptions().governanceServiceConfig.timeout,this.requestUrl=this.isProduction?"https://oness.microsoft.com/api/v1.0/Reward":"https://onessppe.microsoft.com/api/v1.0/Reward")},t.prototype.setEventIdAndOverrideValueForSurveyId=function(t,e,n,r,i){if(!this.personalizerEnabled||z.Utils.isNOU(t)||z.Utils.isNOU(r))return!1;if(0!==e)return!1;var o=this.validateAndGetAutoDismissTime(n);return!z.Utils.isNOU(o)&&(this.personalizerSurveyInformationMap[r]={eventId:t,recommendedAutoDismissValue:o,userAction:void 0},!0)},t.prototype.getOverrideValueForSurveyId=function(t,e){if(this.personalizerEnabled&&!z.Utils.isNOU(e)&&this.infoExistsForSurveyId(e)&&0===t)return this.personalizerSurveyInformationMap[e].recommendedAutoDismissValue},t.prototype.logUserActionForSurveyAsync=function(t,e,n){return W(this,void 0,void 0,(function(){var r,i,o,a,s,u;return J(this,(function(c){switch(c.label){case 0:if(!z.Utils.isNOU(t)&&this.infoExistsForSurveyId(e)&&(this.personalizerSurveyInformationMap[e].userAction=t),r={error:!1},i=this.getValidatedActionPayloadForSurveyId(e),z.Utils.isNOU(i))return r.error=!0,r.errorMessage="Action Payload validation failed.",B().logEvent(O.PERSONALIZER_CLIENTFAILURE,1,{Message:"(PersonalizerClient.logUserActionForSurveyAsync) Error logging personalizer user action: "+r.errorMessage,CampaignId:n,SurveyId:e}),[2,r];c.label=1;case 1:return c.trys.push([1,3,,4]),a=performance.now(),[4,this.dynamicTransport.postRequestWithRetry(this.requestUrl,JSON.stringify(i),this.retryLimit,this.timeout)];case 2:return o=c.sent(),s=performance.now(),B().logEvent(O.PERSONALIZER_SERVICEREWARDRESULT,1,{TimeMilliseconds:s-a,HttpStatusCode:o.status,HttpStatusText:o.statusText,AdditionalSurveyInfo:this.buildConfigTelemetryString(),CorrelationId:this.dynamicTransport.requestId,CampaignId:n,PersonalizerUserAction:i.UserAction,PersonalizerEventId:i.EventId,SurveyId:e}),o.ok||(r.error=!0,r.errorMessage="Server Error, status: "+o.status+", status text: "+o.statusText),[2,r];case 3:return u=c.sent(),r.error=!0,r.errorMessage="Error: "+u.toString()+", Error stack: "+u.stack,B().logEvent(O.PERSONALIZER_CLIENTFAILURE,1,{Message:"(PersonalizerClient.logUserActionForSurveyAsync) Error logging personalizer user action: "+r.errorMessage,CampaignId:n,SurveyId:e,PersonalizerUserAction:i.UserAction,PersonalizerEventId:i.EventId}),[2,r];case 4:return[2]}}))}))},t.prototype.getEventIdForSurveyId=function(t){if(this.infoExistsForSurveyId(t))return this.personalizerSurveyInformationMap[t].eventId},t.prototype.isEnabled=function(t,e,n){return t===_.ISurvey.Type.Fps&&e!==Y.e&&"customux"!==e&&n===ce.GovernedChannelType.Standard&&this.personalizerEnabled},t.prototype.getValidatedActionPayloadForSurveyId=function(t){if(this.infoExistsForSurveyId(t)){var e=this.personalizerSurveyInformationMap[t];if(!z.Utils.isNOU(e.eventId)&&!(z.Utils.isNOU(e.userAction)||2!==e.userAction&&0!==e.userAction&&1!==e.userAction))return{UserAction:e.userAction,EventId:e.eventId}}},t.prototype.validateAndGetAutoDismissTime=function(t){if(!z.Utils.isNOU(t)&&"string"==typeof t)switch(parseInt(t,10)){case 0:return 0;case 7:return 1;case 14:return 2;case 21:return 3;case 28:return 4;case 60:return 5;case 90:return 6;case 120:return 7;case 150:return 8;default:return}},t.prototype.infoExistsForSurveyId=function(t){return!z.Utils.isNOU(t)&&!z.Utils.isNOU(this.personalizerSurveyInformationMap[t])},t.prototype.buildConfigTelemetryString=function(){var t={retry:this.retryLimit,timeout:this.timeout};return JSON.stringify(t)},t}());function ve(){return fe}var ye=new(function(){function t(){this.personalizerClient=ve(),this.governanceServiceEnabled=!1,this.forceServicelessSurveyDisplay=!1,this.lastSurveyFailedSync=void 0,this.clientState=he.GovernanceServiceClientState.Disabled}return t.prototype.setup=function(t){if(this.governanceServiceEnabled=t.getFloodgateInitOptions().governanceServiceEnabled,this.governanceServiceEnabled){if(this.clientInfo={applicationId:t.getCommonInitOptions().appId.toString(),sessionId:t.getCommonInitOptions().sessionId,version:t.getCommonInitOptions().build,surveyPlatform:1,hostPlatform:6,tenantId:t.getCommonInitOptions().telemetryGroup.tenantId,deviceId:t.getCommonInitOptions().telemetryGroup.deviceId,audience:t.getCommonInitOptions().telemetryGroup.audience},this.userId=t.getCommonInitOptions().telemetryGroup.loggableUserId,Object(de.isNOU)(this.clientInfo.sessionId))return void(this.clientState=he.GovernanceServiceClientState.InitializationFailed);if(Object(de.isNOU)(this.clientInfo.version))return void(this.clientState=he.GovernanceServiceClientState.InitializationFailed);if(!Object(de.isValidUserId)(this.userId))return void(this.clientState=he.GovernanceServiceClientState.InitializationFailed);this.forceServicelessSurveyDisplay=t.getFloodgateInitOptions().governanceServiceConfig.forceServicelessSurveyDisplay,this.retryLimit=t.getFloodgateInitOptions().governanceServiceConfig.retry,this.timeout=t.getFloodgateInitOptions().governanceServiceConfig.timeout,this.simpleRequestEnabled=t.getFloodgateInitOptions().governanceServiceConfig.simpleRequestEnabled,this.isProduction=0===t.getCommonInitOptions().environment,this.clientState=he.GovernanceServiceClientState.Enabled,this.dynamicTransport=new ge(this.simpleRequestEnabled)}},t.prototype.isEnabled=function(t){return this.clientState===he.GovernanceServiceClientState.Enabled&&this.governanceServiceEnabled&&t===ce.GovernedChannelType.Standard},t.prototype.shouldForceDisplay=function(){return this.forceServicelessSurveyDisplay},t.prototype.getClientInfo=function(){return this.clientInfo},t.prototype.getClientState=function(){return this.clientState},t.prototype.getLastSurveyFailedSync=function(){return this.lastSurveyFailedSync},t.prototype.checkGovernancePermitAsync=function(t,e,n,r){return W(this,void 0,void 0,(function(){var i,o,a,s,u,c,l,p,d,g;return J(this,(function(h){switch(h.label){case 0:i=(this.isProduction?"https://oness.microsoft.com/api/v1.0/UserSurvey":"https://onessppe.microsoft.com/api/v1.0/UserSurvey")+(this.simpleRequestEnabled?"/SimpleRequest":""),o=this.buildSurveyInfo(t,e,r),a=this.buildBodyRequest(o,n),s={permission:!1,error:!1},h.label=1;case 1:return h.trys.push([1,4,,5]),l=performance.now(),[4,this.dynamicTransport.postRequestWithRetry(i,a,this.retryLimit,this.timeout)];case 2:return u=h.sent(),c=performance.now()-l,p=void 0,u.ok?[4,u.text()]:(this.lastSurveyFailedSync=o,s.errorMessage="Server Error, status: "+u.status+", status text: "+u.statusText,s.error=!0,B().logEvent(O.GOVERNANCE_SERVICERESULT,1,{TimeMilliseconds:c,HttpStatusCode:u.status,HttpStatusText:u.statusText,AdditionalSurveyInfo:this.buildConfigTelemetryString(),CorrelationId:this.dynamicTransport.requestId,GovernanceRequestBody:a,GovernanceResponseText:p,CampaignId:t.getCampaignId(),SurveyId:t.getSurveyInfo().getId()}),[2,s]);case 3:return p=h.sent(),B().logEvent(O.GOVERNANCE_SERVICERESULT,1,{TimeMilliseconds:c,HttpStatusCode:u.status,HttpStatusText:u.statusText,AdditionalSurveyInfo:this.buildConfigTelemetryString(),CorrelationId:this.dynamicTransport.requestId,GovernanceRequestBody:a,GovernanceResponseText:p,CampaignId:t.getCampaignId(),SurveyId:t.getSurveyInfo().getId()}),(d=JSON.parse(p)).lastTriggerSurveyTime=Object(de.stringToDate)(new Date(d.lastTriggerSurveyTime).toISOString()),Object(de.isNumber)(d.timeUntilNextSurveyAllowed)&&Object(de.isDate)(d.lastTriggerSurveyTime)?(0===d.timeUntilNextSurveyAllowed&&(s.permission=!0,this.personalizerClient.isEnabled(t.getType(),t.getLauncherType(),t.getSurveyInfo().getGovernedChannelType())&&this.personalizerClient.setEventIdAndOverrideValueForSurveyId(this.dynamicTransport.requestId,0,d.actionId,t.getSurveyInfo().getId(),t.getCampaignId())),s.lastTriggerSurvey=d,this.lastSurveyFailedSync=void 0):(s.errorMessage="Service Response is not formatted correctly: "+p,s.error=!0,this.lastSurveyFailedSync=o),[3,5];case 4:return g=h.sent(),this.lastSurveyFailedSync=o,B().logEvent(O.GOVERNANCE_SERVICEFAILURE,2,{ErrorMessage:g.toString(),AdditionalSurveyInfo:this.buildConfigTelemetryString(),CorrelationId:this.dynamicTransport.requestId,HttpStatusCode:null==u?void 0:u.status,HttpStatusText:null==u?void 0:u.statusText,GovernanceRequestBody:a}),s.error=!0,s.errorMessage="Error: "+g.toString()+", Error stack: "+g.stack,[3,5];case 5:return[2,s]}}))}))},t.prototype.buildSurveyInfo=function(t,e,n){var r=_.ISurvey.Type[t.getType()],i=he.GovernanceServiceSurveyType[r],o=new Date,a=this.personalizerClient.isEnabled(t.getType(),t.getLauncherType(),t.getSurveyInfo().getGovernedChannelType());return{surveyId:t.getCampaignId(),surveyTriggerTime:o,surveyType:i,surveyLevelCooldown:e,surveyChannel:n,localOffsetTime:o.getTimezoneOffset(),personalizerEnabled:a}},t.prototype.buildBodyRequest=function(t,e){var n={userId:this.userId,userLevelCooldown:e,survey:t,client:this.clientInfo};return this.simpleRequestEnabled&&(this.dynamicTransport.requestId=Object(y.h)(),n.requestId=this.dynamicTransport.requestId),JSON.stringify(n)},t.prototype.buildConfigTelemetryString=function(){var t={retry:this.retryLimit,timeout:this.timeout,simpleRequestEnabled:this.simpleRequestEnabled};return JSON.stringify(t)},t}());function me(){return ye}var Se,Te,Ce,Ee,_e,Ae=!1,Ie=0,be=null,we=null,Oe=null;function Fe(t){be=t}function De(){return be}function Le(t,e){if(void 0===e&&(e=null),be)return be;Ie++;var n=new Promise((function(n,i){var o=function(t,e){var n=z.FloodgateEngine.getTelemetryLogger();n&&n.log_Event(se.TelemetryEvent.Floodgate.Start.Failed,{Count:Ie,ErrorMessage:t,ErrorDetails:e&&e.stack}),i(t)};try{var a=r.get().getCommonInitOptions();if(!a)return void o("Invalid floodgate common init options, state: "+Ae);var s=r.get().getFloodgateInitOptions();if(!s){var u=z.FloodgateEngine.getTelemetryLogger();u&&u.log_Event(se.TelemetryEvent.Floodgate.Start.Warning,{Count:Ie,ErrorMessage:"Invalid floodgate init options, state: "+Ae}),r.get().setFloodgateInitOptions({}),s=r.get().getFloodgateInitOptions()}if(!e&&!we)s&&s.authTokenCallback&&(we=new ne,Oe=new ae);var c=P("TeachingMessageCooldown",ue.Governor.GetChannelCoolDown(ce.GovernedChannelType.TeachingMessage));if(ue.Governor.SetDefaultChannelCoolDown(ce.GovernedChannelType.TeachingMessage,c),!(Se=e||z.FloodgateEngine.make(a.build||"",qt.make(),s.onSurveyActivatedCallback,new b,s.settingStorageCallback,Te||new te,new Xt,new Zt,[we],Oe,me())))return Fe(null),void o("Failed to create floodgate engine");if(t||Ie>1)Se.start(),n();else{var l=Se.startAsync();if(!l)return Fe(null),void o("Failed to get floodgate engine");l.then((function(){n()})).catch((function(t){Fe(null),o("Failed to start floodgate engine",t)}))}}catch(t){Fe(null),o("Failed to load floodgate engine: "+(t&&t.toString()),t)}}));return Fe(n),n.catch((function(t){Fe(null)})),n}function Ne(t){return void 0===t&&(t=!1),Le(t)}function Pe(){Se&&Se.stop(),Fe(null)}function Ue(){Ie=0,be=null,Se=null,we=null,Oe=null}Ce=function(){return Se},a.getEngine=Ce,Ee=Ne,a.start=Ee,_e=Pe,a.stop=_e;var Me,Re=function(){function t(){}return t.prototype.log_TriggerMet=function(t,e,n,r,i){B().logEvent(O.SURVEY_FLOODGATE_TRIGGERMET,1,{CampaignId:t,SurveyId:e,SurveyType:n,SurveyActivityInfo:r,AdditionalSurveyInfo:i})},t.prototype.log_UserSelected=function(t,e,n,r){B().logEvent(O.SURVEY_FLOODGATE_USERSELECTED,1,{CampaignId:t,SurveyId:e,SurveyType:n,AdditionalSurveyInfo:r})},t.prototype.log_CampaignLoad_Failed=function(t){B().logEvent(O.SURVEY_FLOODGATE_CAMPAIGNLOAD_FAILED,2,{ErrorMessage:t})},t.prototype.log_Error=function(t,e){var n={name:t};B().logEvent(n,2,{ErrorMessage:e})},t.prototype.log_Event=function(t,e,n){var r={name:t};B().logEvent(r,1,e,n)},t.prototype.log_LocalError=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.log_Local(2,t,e)},t.prototype.log_Local=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];B().logLocal(t,n)},t}(),Be=function(){function t(){}return t.prototype.loadStringResource=function(t){return"na"},t.prototype.getCustomString=function(t){return"na"},t}();function ke(){return new Promise((function(t,e){var n=function(t){var n=z.FloodgateEngine.getTelemetryLogger();n&&n.log_Event(se.TelemetryEvent.Floodgate.Initialize.Failed,{ErrorMessage:t}),e(t)};if(Ae)t();else{try{j()}catch(t){return void n("CommonApp initialization failed: {"+t+"}")}z.FloodgateEngine.setTelemetryLogger(new Re);try{i=new Be,Te=i,function(){if(!b.isStorageAvailable())throw new Error("window.localStorage is not available.");s().OfficeBrowserFeedback.floodgate=s().OfficeBrowserFeedback.floodgate||{};var t=s().OfficeBrowserFeedback.floodgate.initOptions;if(void 0!==(t=t||{}).campaignDefinitions){var e=Object(ee.FilterValidCampaignDefinitions)(t.campaignDefinitions);if(e.error)throw new Error("floodgate.initOptions.campaignDefinitions error: "+e.error);(new b).write(_.IFloodgateStorageProvider.FileType.CampaignDefinitions,JSON.stringify(t.campaignDefinitions))}var n=r.get();if(n.setFloodgateInitOptions(t),pe.a.resetSessionActivity(),ve().setup(n),me().setup(n),Ae=!0,!n.getFloodgateInitOptions().surveyEnabled){var i=z.FloodgateEngine.getTelemetryLogger();i&&i.log_Event(se.TelemetryEvent.Floodgate.Start.SurveysDisabled,{Count:Ie,Message:"Floodgate initialized with surveys disabled (surveyEnabled is false)"})}}()}catch(t){return void n("CommonFloodgate initialization failed: {"+t+"}")}var i;t()}}))}function xe(){G=!1,Ae=!1,Ue()}Me=ke,a.initialize=Me}]);
//# sourceMappingURL=officebrowserfeedback_floodgate_bare.min.js.map