!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=66)}([function(e,t,n){"use strict";n.r(t),n.d(t,"guid",(function(){return r})),n.d(t,"overrideValues",(function(){return o})),n.d(t,"isNOU",(function(){return a})),n.d(t,"isBoolean",(function(){return s})),n.d(t,"isInteger",(function(){return p})),n.d(t,"expectObject",(function(){return g})),n.d(t,"expectNumber",(function(){return h})),n.d(t,"expectString",(function(){return v})),n.d(t,"expectBoolean",(function(){return m})),n.d(t,"expectGuid",(function(){return f})),n.d(t,"expectArray",(function(){return y})),n.d(t,"expectEnum",(function(){return S})),n.d(t,"createTimeoutPromise",(function(){return T})),n.d(t,"checkCssSelectorToBeSet",(function(){return C}));var i=n(2);const{guid:r,overrideValues:o,isNOU:a,isBoolean:s,isString:u,isObject:c,isEnumValue:l}=i.Utils;function d(e){return"number"==typeof e}function p(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function g(e,t){if(!c(e))throw t+" is not an object: "+e}function h(e,t){if(!d(e))throw t+" is not a number: "+e}function v(e,t){if(!u(e))throw t+" is not a string: "+e}function m(e,t){if(!s(e))throw t+" is not a boolean: "+e}function f(e,t){if(!function(e){return u(e)&&/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e)}(e))throw t+" is not a guid: "+e}function y(e,t){if(!Array.isArray(e))throw t+" is not an array: "+e}function S(e,t,n){if(!d(e)||!l(e,t))throw n+" is not an enum: "+e}function T(e,t){const n=new Promise((t,n)=>{const i=setTimeout(()=>{clearTimeout(i),n("Timed out in "+e+"ms.")},e)});return Promise.race([t,n])}function C(e){try{for(let t=0;t<document.styleSheets.length;t++){const n=document.styleSheets[t];for(let t=0;t<n.rules.length;t++){const i=n.rules[t];if(!a(i.selectorText)&&i.selectorText.includes(e))return!0}}}catch(e){}return!1}},function(e,t,n){"use strict";n.d(t,"get",(function(){return u}));var i=n(0),r=(n(5),n(32)),o=n(4);n.d(t,"AgeGroup",(function(){return o.a})),n.d(t,"AuthenticationType",(function(){return o.b}));n(31);class a{constructor(){this.feedbackSubmitted=!1}static validateCategoryOptions(e){if(!e)return{show:!1};if(i.expectBoolean(e.show,"categories.show"),e.customCategories){i.expectArray(e.customCategories,"categories.customCategories");for(let t of e.customCategories)if(i.expectString(t,"custom category '"+t+"'"),t.length>20)throw"custom category '"+t+"' too long, max 20 characters."}return e}getFeedbackSubmitted(){return this.feedbackSubmitted}setFeedbackSubmitted(e){this.feedbackSubmitted=e}getCommonInitOptions(){return this.commonInitOptions}getInAppFeedbackInitOptions(){return this.inAppFeedbackInitOptions}getInAppFeedbackLaunchOptions(){return this.inAppFeedbackLaunchOptions}getFloodgateInitOptions(){return this.floodgateInitOptions}getFloodgateSurvey(){return this.floodgateSurvey}getSdkSessionId(){return this.sdkSessionId||(this.sdkSessionId=i.guid()),this.sdkSessionId}getEventSampling(){return this.eventSampling}setCommonInitOptions(e){i.expectObject(e,"passedInitOptions");let t={appId:e.appId,applicationGroup:e.applicationGroup||{},build:e.build,cid:e.cid,environment:e.environment,intlFilename:e.intlFilename,intlUrl:e.intlUrl,webSurfacesResourceBaseUrl:e.webSurfacesResourceBaseUrl,locale:e.locale,onError:e.onError,originalLocale:e.locale,primaryColour:e.primaryColour,secondaryColour:e.secondaryColour,sessionId:e.sessionId,stylesUrl:e.stylesUrl,telemetryGroup:e.telemetryGroup||{},userEmail:e.userEmail,webGroup:e.webGroup||{},eventSampling:e.eventSampling,petrolTimeout:e.petrolTimeout,isCommercialHost:e.isCommercialHost,customResourcesSetExternally:e.customResourcesSetExternally,emailPolicyValue:e.emailPolicyValue,screenshotPolicyValue:e.screenshotPolicyValue,ageGroup:e.ageGroup,authenticationType:e.authenticationType,applicationSettings:e.applicationSettings,webSurfacesSettings:e.webSurfacesSettings};if(i.expectNumber(t.appId,"initOptions.appId"),!(t.appId%1==0&&t.appId>0))throw"initOptions.appId is not a positive integer: "+t.appId;const n=o.c.Strings|o.c.Css;if(void 0===t.customResourcesSetExternally)t.customResourcesSetExternally=o.c.None;else if("number"!=typeof t.customResourcesSetExternally||(t.customResourcesSetExternally|n)!==n)throw"initOptions.customResourcesSetExternally has an invalid value: "+t.customResourcesSetExternally;if((t.customResourcesSetExternally&o.c.Css)!==o.c.Css&&i.expectString(t.stylesUrl,"initOptions.stylesUrl"),(t.customResourcesSetExternally&o.c.Strings)!==o.c.Strings&&i.expectString(t.intlUrl,"initOptions.intlUrl"),void 0!==t.intlFilename?i.expectString(t.intlFilename,"initOptions.intlFilename"):t.intlFilename="officebrowserfeedbackstrings.js",i.expectNumber(t.environment,"initOptions.environment"),1!==t.environment&&0!==t.environment)throw"initOptions.environment has a bad value: "+t.environment;if(void 0!==t.userEmail?i.expectString(t.userEmail,"initOptions.userEmail"):t.userEmail="",void 0!==t.sessionId?i.expectString(t.sessionId,"initOptions.sessionId"):t.sessionId="00000000-0000-0000-0000-000000000000",t.telemetryGroup.processSessionId=t.sessionId,void 0!==t.cid&&(i.expectString(t.cid,"initOptions.cid"),t.applicationGroup.extendedManifestData=JSON.stringify({cid:t.cid})),void 0!==t.build){i.expectString(t.build,"initOptions.build"),new RegExp("^[0-9]{1,9}(\\.[0-9]{1,9})?(\\.[0-9]{1,9})?(\\.[0-9]{1,9})?$").test(t.build)||(t.build="0.0.0.0")}else t.build="0.0.0.0";t.telemetryGroup.officeBuild=t.build;let a=new RegExp("^#[0-9a-f]{3}([0-9a-f]{3})?$","i");if(void 0!==t.primaryColour&&(a.test(t.primaryColour)||(t.primaryColour=void 0)),void 0!==t.secondaryColour&&(a.test(t.secondaryColour)||(t.secondaryColour=void 0)),void 0!==t.locale?(i.expectString(t.locale,"initOptions.locale"),t.locale=r.a(t.locale)):t.locale="en",void 0===t.onError&&(t.onError=e=>{}),void 0!==t.petrolTimeout&&i.expectNumber(t.petrolTimeout,"initOptions.petrolTimeout"),void 0!==t.authenticationType?i.expectEnum(t.authenticationType,o.b,"initOptions.authenticationType"):t.authenticationType=o.b.Unauthenticated,void 0!==t.ageGroup?i.expectEnum(t.ageGroup,o.a,"initOptions.ageGroup"):t.ageGroup=o.a.Undefined,this.eventSampling=this.parseEventSamplingOption(t.eventSampling),this.commonInitOptions=t,this.commonPolicyAllowAADC=this.determineAADCPolicy(t.authenticationType,t.ageGroup),void 0===t.isCommercialHost||null==t.isCommercialHost?t.isCommercialHost=!1:i.expectBoolean(t.isCommercialHost,"initOptions.isCommercialHost"),void 0===t.emailPolicyValue)t.emailPolicyValue=0;else if("number"!=typeof t.emailPolicyValue||0!==t.emailPolicyValue&&1!==t.emailPolicyValue&&2!==t.emailPolicyValue)throw"initOptions.emailPolicyValue has an invalid value: "+t.emailPolicyValue;if(void 0===t.screenshotPolicyValue)t.screenshotPolicyValue=0;else if("number"!=typeof t.screenshotPolicyValue||0!==t.screenshotPolicyValue&&1!==t.screenshotPolicyValue&&2!==t.screenshotPolicyValue)throw"initOptions.screenshotPolicyValue has an invalid value: "+t.screenshotPolicyValue}setInAppFeedbackInitOptions(e){i.expectObject(e,"passedInitOptions");let t={bugForm:e.bugForm,onDismiss:e.onDismiss,screenshot:e.screenshot,showEmailAddress:e.showEmailAddress,userEmail:e.userEmail,transitionEnabled:e.transitionEnabled,isShowThanks:e.isShowThanks,sendFeedbackPolicyValue:e.sendFeedbackPolicyValue,feedbackForumUrl:void 0!==e.feedbackForumUrl?e.feedbackForumUrl:void 0,myFeedbackForumUrl:void 0!==e.myFeedbackForumUrl?e.myFeedbackForumUrl:void 0};if(void 0===t.onDismiss&&(t.onDismiss=function(e){}),void 0!==t.bugForm?i.expectBoolean(t.bugForm,"initOptions.bugForm"):t.bugForm=!1,void 0!==t.userEmail&&i.expectString(t.userEmail,"initOptions.userEmail"),void 0!==t.screenshot?i.expectBoolean(t.screenshot,"initOptions.screenshot"):t.screenshot=!0,void 0!==t.showEmailAddress?i.expectBoolean(t.showEmailAddress,"initOptions.showEmailAddress"):t.showEmailAddress=!0,void 0!==t.feedbackForumUrl?i.expectString(t.feedbackForumUrl,"initOptions.feedbackForumUrl"):t.feedbackForumUrl=void 0,void 0!==t.isShowThanks?i.expectBoolean(t.isShowThanks,"initOptions.isShowThanks"):t.isShowThanks=!0,void 0!==t.myFeedbackForumUrl?i.expectString(t.myFeedbackForumUrl,"initOptions.myFeedbackForumUrl"):t.myFeedbackForumUrl=void 0,void 0===t.transitionEnabled&&(t.transitionEnabled=!0),void 0===t.sendFeedbackPolicyValue)t.sendFeedbackPolicyValue=0;else if("number"!=typeof t.sendFeedbackPolicyValue||0!==t.sendFeedbackPolicyValue&&1!==t.sendFeedbackPolicyValue&&2!==t.sendFeedbackPolicyValue)throw"initOptions.sendFeedbackPolicyValue has an invalid value: "+t.sendFeedbackPolicyValue;this.inAppFeedbackInitOptions=t}setInAppFeedbackLaunchOptions(e){if(!this.commonInitOptions)throw"commonInitOptions not set";e||(e={}),this.commonInitOptions.applicationGroup=i.overrideValues(e.applicationGroup,this.commonInitOptions.applicationGroup),this.commonInitOptions.telemetryGroup=i.overrideValues(e.telemetryGroup,this.commonInitOptions.telemetryGroup),this.commonInitOptions.webGroup=i.overrideValues(e.webGroup,this.commonInitOptions.webGroup),e.categories=a.validateCategoryOptions(e.categories),this.inAppFeedbackLaunchOptions=e}setFloodgateInitOptions(e){i.expectObject(e,"passedInitOptions");let t={autoDismiss:e.autoDismiss,campaignDefinitions:e.campaignDefinitions,campaignFlights:e.campaignFlights,campaignQueryParameters:e.campaignQueryParameters,onDismiss:e.onDismiss,onSurveyActivatedCallback:e.onSurveyActivatedCallback,settingStorageCallback:e.settingStorageCallback,uIStringGetter:e.uIStringGetter,authTokenCallback:e.authTokenCallback,surveyEnabled:e.surveyEnabled,showEmailAddress:e.showEmailAddress,augLoopCallback:e.augLoopCallback,customerVoiceSurveyParams:e.customerVoiceSurveyParams,governanceServiceEnabled:e.governanceServiceEnabled,governanceServiceConfig:e.governanceServiceConfig,personalizerEnabled:e.personalizerEnabled,messagingServiceSettings:e.messagingServiceSettings};if(void 0===t.autoDismiss&&(t.autoDismiss=0),void 0===t.onDismiss&&(t.onDismiss=(e,t)=>{}),void 0===t.onSurveyActivatedCallback){let e={onSurveyActivated(e,t,n){e.launch()}};t.onSurveyActivatedCallback=e}void 0===t.uIStringGetter&&(t.uIStringGetter=e=>e),void 0===t.surveyEnabled?t.surveyEnabled=!0:i.expectBoolean(t.surveyEnabled,"surveyEnabled"),void 0!==t.showEmailAddress?i.expectBoolean(t.showEmailAddress,"initOptionsFloodgate.showEmailAddress"):t.showEmailAddress=!0,void 0!==t.governanceServiceEnabled?i.expectBoolean(t.governanceServiceEnabled,"initOptionsFloodgate.governanceServiceEnable"):t.governanceServiceEnabled=!1,t.governanceServiceEnabled&&(t.governanceServiceConfig=this.parseGovernanceServiceConfig(void 0!==t.governanceServiceConfig?t.governanceServiceConfig:{})),void 0===t.customerVoiceSurveyParams&&(t.customerVoiceSurveyParams={cvFlights:"",isCVSurveyEnabled:!1,productName:"",uiHost:""}),void 0!==t.personalizerEnabled?i.expectBoolean(t.personalizerEnabled,"initOptionsFloodgate.personalizerEnabled"):t.personalizerEnabled=!1,this.floodgateInitOptions=t}setFloodgateSurvey(e){this.floodgateSurvey=e}checkIfSurveysEnabled(){return(!this.floodgateInitOptions||this.floodgateInitOptions.surveyEnabled)&&this.commonPolicyAllowAADC}isFeedbackSurveyEnabledByAADC(){return this.commonPolicyAllowAADC}getCVSurveyFlights(){return this.floodgateInitOptions&&this.floodgateInitOptions.customerVoiceSurveyParams?this.floodgateInitOptions.customerVoiceSurveyParams.cvFlights:""}isCVSurveyEnabled(){return!(!this.floodgateInitOptions||!this.floodgateInitOptions.customerVoiceSurveyParams)&&this.floodgateInitOptions.customerVoiceSurveyParams.isCVSurveyEnabled}getProductName(){return this.floodgateInitOptions&&this.floodgateInitOptions.customerVoiceSurveyParams?this.floodgateInitOptions.customerVoiceSurveyParams.productName:""}getUIHost(){return this.floodgateInitOptions&&this.floodgateInitOptions.customerVoiceSurveyParams?this.floodgateInitOptions.customerVoiceSurveyParams.uiHost:""}determineAADCPolicy(e,t){return e===o.b.Unauthenticated||e===o.b.AAD||t!==o.a.MinorWithParentalConsent&&t!==o.a.MinorWithoutParentalConsent}getUserConsentGroup(){const e=this.commonInitOptions.authenticationType;if(e===o.b.Unauthenticated||e===o.b.AAD)return 1;switch(this.commonInitOptions.ageGroup){case o.a.Undefined:return 1;case o.a.MinorWithoutParentalConsent:case o.a.MinorWithParentalConsent:return 3;case o.a.Adult:return 1;case o.a.NotAdult:return 2;case o.a.MinorNoParentalConsentRequired:return 1;default:return 3}return 3}parseEventSamplingOption(e){let t={event:{}};if(void 0!==e)for(const n in e)if(e.hasOwnProperty(n))switch(e[n].type){case"Event":let r=e[n].sampleRate;if(i.expectNumber(r,"initOption.EventSampling.SampleRate"),i.expectString(e[n].name,"initOption.EventSampling.Name"),r<0||r>1)throw"initOption.EventSampling."+e[n].name+".SampleRate is out of range";t.event[e[n].name]=r;break;default:throw"initOption.EventSampling.Type value is not recognized"}return t}parseGovernanceServiceConfig(e){var t,n,i,r;return{forceServicelessSurveyDisplay:null!==(t=e.forceServicelessSurveyDisplay)&&void 0!==t&&t,retry:null!==(n=e.retry)&&void 0!==n?n:1,timeout:null!==(i=e.timeout)&&void 0!==i?i:1e3,simpleRequestEnabled:null!==(r=e.simpleRequestEnabled)&&void 0!==r&&r}}}let s=new a;function u(){return s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=t.Api=void 0;var i=n(7);t.Api=i;var r=n(3);t.Utils=r;var o=n(12);Object.defineProperty(t,"FloodgateEngine",{enumerable:!0,get:function(){return o.FloodgateEngine}})},function(e,t,n){"use strict";function i(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())}function r(e){return null==e}function o(e){return"string"==typeof e}function a(e,n){if(!e)return null;if(n<0)return n=-n,this.addSecondsWithoutOverflow(e,n);var i=e.getTime()-1e3*n;return i>t.MIN_DATE_MILLISECONDS?new Date(i):new Date(t.MIN_DATE_MILLISECONDS)}Object.defineProperty(t,"__esModule",{value:!0}),t.safeParseObject=t.isValidUserId=t.fyShuffle=t.dateToShortUtcString=t.isUtcDatetimeString=t.overrideValues=t.stringToDate=t.makeArrayFromObjectValuesSortedByKeyString=t.guid=t.extractLanguageSubtag=t.isValidLanguageSubTag=t.subtractSecondsWithoutOverflow=t.addSecondsWithoutOverflow=t.MIN_DATE_MILLISECONDS=t.MAX_DATE_MILLISECONDS=t.getDistantFuture=t.getDistantPast=t.isBoolean=t.isString=t.isArray=t.isFunction=t.isObject=t.isNOU=t.isNumber=t.isEnumValue=t.isDate=t.timeAdd=void 0,t.timeAdd=function(e,t,n){switch(t.toLowerCase()){case"h":case"hour":return new Date(e.getTime()+36e5*n);case"m":case"minute":return new Date(e.getTime()+6e4*n);case"s":case"second":return new Date(e.getTime()+1e3*n);default:throw new Error("Invalid interval value of "+t)}},t.isDate=i,t.isEnumValue=function(e,t){return e in t},t.isNumber=function(e){return null!==e&&!isNaN(e)&&isFinite(e)},t.isNOU=r,t.isObject=function(e){return null!=e&&"object"==typeof e},t.isFunction=function(e){return null!=e&&"function"==typeof e},t.isArray=function(e){return null!=e&&Array.isArray(e)},t.isString=o,t.isBoolean=function(e){return"boolean"==typeof e},t.getDistantPast=function(){return new Date(-116444736e5)},t.getDistantFuture=function(){return new Date(640922112e5)},t.MAX_DATE_MILLISECONDS=864e13,t.MIN_DATE_MILLISECONDS=-864e13,t.addSecondsWithoutOverflow=function(e,n){if(!e)return null;if(n<0)return a(e,-1*n);var i=e.getTime()+1e3*n;return i<t.MAX_DATE_MILLISECONDS?new Date(i):new Date(t.MAX_DATE_MILLISECONDS)},t.subtractSecondsWithoutOverflow=a;function s(e){if(!e)return null;var t=e.match("^((?:[a-zA-Z]{2,3}(?:-[a-zA-Z]{3}){0,3})|(?:[a-zA-Z]{4,8}))(?:-([a-zA-Z]{4}))?(?:-([a-zA-Z]{2}|[0-9]{3}))?(-.*)?$");return!t||t.length<1||!r(t[4])?null:t[0]}function u(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}t.isValidLanguageSubTag=function(e){if(!e)return!1;var t=s(e);return!!t&&t===e},t.extractLanguageSubtag=s,t.guid=function(){return(u()+u()+"-"+u()+"-4"+u().substr(0,3)+"-"+u()+"-"+u()+u()+u()).toLowerCase()},t.makeArrayFromObjectValuesSortedByKeyString=function(e){var t=Object.keys(e);t.sort();var n=[];for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];n.push(e[r])}return n},t.stringToDate=function(e){if(!o(e))return null;var t=e?new Date(e):null;return i(t)?t:null},t.overrideValues=function(e,t){if(!t)return t;var n=t;if(e)for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n},t.isUtcDatetimeString=function(e){return!!o(e)&&/^(\d{4}\-\d\d\-\d\dT\d\d:\d\d:\d\d(\.\d\d\d)?Z)$/.test(e)},t.dateToShortUtcString=function(e){if(!i(e))return null;function t(e){return e<10?"0"+e:e.toString()}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"},t.fyShuffle=function(e){if(!r(e)){if(0===e.length||1===e.length)return e;for(var t=e.length-1;t>0;){var n=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[n],e[n]=i,t--}return e}},t.isValidUserId=function(e){return!!o(e)&&/^([a-z]{1,2}):\w+/.test(e)},t.safeParseObject=function(e,t){try{var n=!e||"{"!==e[0]&&"["!==e[0]?void 0:JSON.parse(e);return null!=n?n:t}catch(e){}return t}},function(e,t,n){"use strict";var i,r,o;n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),function(e){e[e.None=0]="None",e[e.Css=1]="Css",e[e.Strings=2]="Strings"}(i||(i={})),function(e){e[e.Undefined=0]="Undefined",e[e.MinorWithoutParentalConsent=1]="MinorWithoutParentalConsent",e[e.MinorWithParentalConsent=2]="MinorWithParentalConsent",e[e.Adult=3]="Adult",e[e.NotAdult=4]="NotAdult",e[e.MinorNoParentalConsentRequired=5]="MinorNoParentalConsentRequired"}(r||(r={})),function(e){e[e.MSA=0]="MSA",e[e.AAD=1]="AAD",e[e.Unauthenticated=2]="Unauthenticated"}(o||(o={}))},function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return s}));const i="customervoice";var r;!function(e){e[e.Smile=0]="Smile",e[e.Frown=1]="Frown",e[e.Idea=2]="Idea",e[e.Bug=3]="Bug",e[e.IdeaRedirect=4]="IdeaRedirect"}(r||(r={}));class o{}o.WebSurfacesIntLink="https://content.growth.office.net/mirrored/resources/programmablesurfaces/int/officewebsurfaces.core.min.js",o.WebSurfacesProdLink="https://content.growth.office.net/mirrored/resources/programmablesurfaces/prod/officewebsurfaces.core.min.js";class a{}a.TMSAppID="4c4f550b-42b2-4a16-93f9-fdb9e01bb6ed",a.TULIPSAppID="05c88d91-956e-46b4-91b0-77a33cc21a4d";const s="Web SDK v"},function(e,t,n){"use strict";var i;!function(e){!function(e){e[e.FloodgateSettings=0]="FloodgateSettings",e[e.SurveyActivationStats=1]="SurveyActivationStats",e[e.SurveyEventActivityStats=2]="SurveyEventActivityStats",e[e.CampaignDefinitions=3]="CampaignDefinitions",e[e.CampaignStates=4]="CampaignStates",e[e.GovernedChannelStates=5]="GovernedChannelStates",e[e.TmsCache_MessageMetadata=6]="TmsCache_MessageMetadata",e[e.TmsCache_UserGovernance=7]="TmsCache_UserGovernance",e[e.TmsCache_CampaignContent=8]="TmsCache_CampaignContent",e[e.Tms_DynamicSettings=9]="Tms_DynamicSettings",e[e.LogLevelSettings=10]="LogLevelSettings",e[e.UserFacts=11]="UserFacts",e[e.DebugOverrides=12]="DebugOverrides"}(e.FileType||(e.FileType={}))}(i||(i={})),e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ISurveyInfo=t.ISurveyComponent=t.ISurvey=t.IFloodgateSettingIdMap=t.IFloodgateStorageProvider=t.IActivityListener=void 0;var i=n(19);t.ISurveyInfo=i;var r=n(34);t.IActivityListener=r;var o=n(35);t.IFloodgateSettingIdMap=o;var a=n(6);t.IFloodgateStorageProvider=a;var s=n(10);t.ISurvey=s;var u=n(11);t.ISurveyComponent=u;var c=n(13);Object.defineProperty(t,"CampaignDefinition",{enumerable:!0,get:function(){return c.CampaignDefinition}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryEvent=void 0;var i=function(){function e(){}var t,n,i,r,o,a,s,u,c,l,d,p,g,h,v,m,f,y,S,T,C,E,A,_,I,b,O,F,w,D,L,N,P,U,M,R;return e.CampaignState=((t=function(){}).Deserialize=((n=function(){}).Failed="FloodgateCore_CampaignState_Deserialize_Failed",n),t),e.FileBasedCampaignStateProvider=((i=function(){}).Load=((r=function(){}).Failed="FloodgateCore_FileBasedCampaignStateProvider_Load_Failed",r),i),e.HostBasedCampaignStateProvider=((o=function(){}).GetStatesFromHost=((a=function(){}).Failed="FloodgateCore_HostBasedCampaignStateProvider_GetStatesFromHost_Failed",a),o),e.Floodgate=((s=function(){}).Initialize=((u=function(){}).Failed="FloodgateCore_Floodgate_Initialize_Failed",u),s.Start=((c=function(){}).Failed="FloodgateCore_Floodgate_Start_Failed",c.Warning="FloodgateCore_Floodgate_Start_Warning",c.SurveysDisabled="FloodgateCore_Floodgate_Start_SurveysDisabled",c),s.UserFactsLoad=((l=function(){}).Failed="FloodgateCore_Floodgate_UserFactsLoad_Failed",l),s.UserFactsSpecDeserialization=((d=function(){}).Failed="FloodgateCore_Floodgate_UserFactsSpecDeserialization_Failed",d),s.UserFactsSpecIsAMatch=((p=function(){}).Failed="FloodgateCore_Floodgate_UserFactsSpecIsAMatch_Failed",p.Mismatch="FloodgateCore_Floodgate_UserFactsSpecIsAMatch_Mismatch",p.Summary="FloodgateCore_Floodgate_UserFactsSpecIsAMatch_Summary",p),s),e.FloodgateEngine=((g=function(){}).Make=((h=function(){}).Failed="FloodgateCore_FloodgateEngine_Make_Failed",h),g.Common=((v=function(){}).Error="FloodgateCore_FloodgateEngine_Common_Error",v),g.Start=((m=function(){}).Failed="FloodgateCore_FloodgateEngine_Start_Failed",m),g.StartAsync=((f=function(){}).Failed="FloodgateCore_FloodgateEngine_StartAsync_Failed",f.Stopped="FloodgateCore_FloodgateEngine_StartAsync_Stopped",f),g.OnSurveyActivated=((y=function(){}).ActivationStatsSuppressedSurvey="FloodgateCore_FloodgateEngine_OnSurveyActivated_ActivationStatsSuppressedSurvey",y.ClosedChannelType="FloodgateCore_FloodgateEngine_OnSurveyActivated_ClosedChannelType",y.SurveyNotDefined="FloodgateCore_FloodgateEngine_OnSurveyActivated_SurveyNotDefined",y.SessionSuppressedSurvey="FloodgateCore_FloodgateEngine_OnSurveyActivated_SessionSuppressedSurvey",y.ActivationExpiredSurvey="FloodgateCore_FloodgateEngine_OnSurveyActivated_ActivationExpiredSurvey",y.ActivationIrrelevantSurvey="FloodgateCore_FloodgateEngine_OnSurveyActivated_ActivationIrrelevantSurvey",y.Error="FloodgateCore_FloodgateEngine_OnSurveyActivated_Error",y),g.CheckGovernanceServiceAndActivateSurvey=((S=function(){}).GovernanceServiceForceToDisplay="FloodgateCore_FloodgateEngine_GovernanceService_GovernanceServiceForceToDisplay",S.GovernanceServiceClientCompleted="FloodgateCore_FloodgateEngine_GovernanceService_GovernanceServiceClientCompleted",S),g),e.GovernedChannelState=((T=function(){}).Deserialize=((C=function(){}).Failed="FloodgateCore_GovernedChannelState_Deserialize_Failed",C),T),e.FileBasedGovernedChannelStateProvider=((E=function(){}).Load=((A=function(){}).Failed="FloodgateCore_FileBasedGovernedChannelStateProvider_Load_Failed",A),E),e.HostBasedGovernedChannelStateProvider=((_=function(){}).GetStatesFromHost=((I=function(){}).Failed="FloodgateCore_HostBasedGovernedChannelStateProvider_GetStatesFromHost_Failed",I),_),e.SurveyStatCollectionActivation=((b=function(){}).FromJson=((O=function(){}).Failed="FloodgateCore_SurveyStatCollectionActivation_FromJson_Failed",O),b.ToJson=((F=function(){}).Failed="FloodgateCore_SurveyStatCollectionActivation_ToJson_Failed",F),b),e.HostBasedSurveyActivationStatsProvider=((w=function(){}).GetSurveyStatsFromHost=((D=function(){}).Failed="FloodgateCore_HostBasedSurveyActivationStatsProvider_GetSurveyStatsFromHost_Failed",D),w),e.SurveyStatCollectionEventActivity=((L=function(){}).FromJson=((N=function(){}).Failed="FloodgateCore_SurveyStatCollectionEventActivity_FromJson_Failed",N),L.ToJson=((P=function(){}).Failed="FloodgateCore_SurveyStatCollectionEventActivity_ToJson_Failed",P),L),e.SurveyActivity=((U=function(){}).LogActivity=((M=function(){}).EventsReprocessed="FloodgateCore_SurveyActivity_LogActivity_EventsReprocessed",M.SurveysReprocessed="FloodgateCore_SurveyActivity_LogActivity_SurveysReprocessed",M),U.SetActivityTrackingContracts=((R=function(){}).DuplicateSurveyID="FloodgateCore_SurveyActivity_SetActivityTrackingContracts_DuplicateSurveyID",R),U),e}();t.TelemetryEvent=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GovernedChannel=t.GovernedChannelType=void 0;var i,r=n(3);!function(e){e[e.Standard=0]="Standard",e[e.Urgent=1]="Urgent",e[e.Banner=2]="Banner",e[e.TeachingMessage=3]="TeachingMessage"}(t.GovernedChannelType||(t.GovernedChannelType={})),function(e){e.getDefault=function(){return e.Standard}}(i=t.GovernedChannelType||(t.GovernedChannelType={}));var o=function(){function e(e,t,n,o){if(!r.isEnumValue(e,i))throw new Error("type is not a valid GovernedChannelType");if(!t)throw new Error("name must not be null or empty");if(n<0)throw new Error("cooldownSeconds must not be negative");this.type=e,this.name=t,this.cooldownSeconds=n,this.setCooldownStartTime(o)}return e.prototype.setCooldownStartTime=function(e){this.cooldownStartTime=e,r.isNOU(this.cooldownStartTime)?this.cooldownEndTime=r.getDistantPast():this.cooldownEndTime=r.addSecondsWithoutOverflow(this.cooldownStartTime,this.cooldownSeconds)},e.prototype.isOpen=function(){return this.isOpenAtDate(new Date)},e.prototype.isOpenAtDate=function(e){return!!e&&e>this.cooldownEndTime},e.prototype.getType=function(){return this.type},e.prototype.getName=function(){return this.name},e.prototype.getCooldownSeconds=function(){return this.cooldownSeconds},e.prototype.getCooldownStartTime=function(){return this.cooldownStartTime},e.prototype.getCooldownEndTime=function(){return this.cooldownEndTime},e}();t.GovernedChannel=o},function(e,t,n){"use strict";var i;!function(e){!function(e){e[e.Feedback=0]="Feedback",e[e.Nps=1]="Nps",e[e.Psat=2]="Psat",e[e.Bps=3]="Bps",e[e.Fps=4]="Fps",e[e.Nlqs=5]="Nlqs",e[e.Intercept=6]="Intercept",e[e.GenericMessagingSurface=12]="GenericMessagingSurface"}(e.Type||(e.Type={})),e.DOM_FEEDBACKSURVEY_TAGNAME="FeedbackSurvey",e.DOM_NPS_TAGNAME="Nps",e.DOM_PSAT_TAGNAME="Psat",e.DOM_BPS_TAGNAME="Bps",e.DOM_FPS_TAGNAME="Fps",e.DOM_NLQS_TAGNAME="Nlqs",e.DOM_INTERCEPT_TAGNAME="Intercept",e.LAUNCHER_TYPE_DEFAULT="survey"}(i||(i={})),e.exports=i},function(e,t,n){"use strict";var i;!function(e){e.DOM_PROMPT_TAGNAME="Prompt",e.DOM_COMMENT_TAGNAME="Comment",e.DOM_RATING_TAGNAME="Rating",e.DOM_CVSURVEY_TAGNAME="CVSurvey",e.DOM_MULTIPLECHOICE_TAGNAME="MultipleChoice",e.DOM_INTERCEPT_TAGNAME="Intercept",e.JSON_INTERCEPT_KEYNAME="intercept",e.JSON_INTERCEPTURL_KEYNAME="url",e.JSON_PROMPT_KEYNAME="prompt",e.JSON_PROMPTYESTEXT_KEYNAME="yesButtonText",e.JSON_PROMPTNOTEXT_KEYNAME="noButtonText",e.JSON_COMMENT_KEYNAME="comment",e.JSON_RATING_KEYNAME="rating",e.JSON_CVSURVEY_KEYNAME="cvSurvey",e.JSON_CVSURVEYFORMID_KEYNAME="formId",e.JSON_CVSURVEYTHEME_KEYNAME="theme",e.JSON_RATINGOPTIONS_KEYNAME="options",e.JSON_CVSURVEYPRODUCTNAME_KEYNAME="productName",e.JSON_CVSURVEYUIHOST_KEYNAME="uiHost",e.JSON_CVSURVEYPLATFORM_KEYNAME="platform",e.JSON_TITLE_KEYNAME="title",e.JSON_QUESTION_KEYNAME="question",e.JSON_MULTIPLECHOICE_KEYNAME="multipleChoice",e.JSON_APPLICATION_KEYNAME="application",e.JSON_EXTENDEDMANIFESTDATA_KEYNAME="extendedManifestData",e.JSON_SURVEYSTRINGS_KEYNAME="surveyStrings",e.JSON_SURVEYSPECIFICDATA_KEYNAME="surveySpecificData"}(i||(i={})),e.exports=i},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.FloodgateEngine=void 0;var o=n(6),a=n(13),s=n(36),u=n(25),c=n(8),l=n(49),d=n(9),p=n(29),g=n(18),h=n(24),v=n(26),m=n(30),f=o.FileType,y=n(52),S=n(53),T=n(3),C=function(){function e(){}return e.prototype.log_TriggerMet=function(e,t,n,i,r){},e.prototype.log_UserSelected=function(e,t,n,i){},e.prototype.log_CampaignLoad_Failed=function(e){},e.prototype.log_Error=function(e,t){},e.prototype.log_Event=function(e,t){},e.prototype.log_LocalError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},e}(),E={run:function(e){},shouldAcceptActivity:function(e){return!0}},A={},_=function(){function e(t,n,i,r,o,a,s,u,c){if(this.initializationStatus=0,this.candidateSurveys={},this.launchedSurveys={},this.launchedLaunchers=[],this.surveyEventSent=[],this.staleTriggeredSurveysQueue=[],!t)throw new Error("surveyClient must not be null");if(!n)throw new Error("activityListener must not be null");if(!i)throw new Error("launcherFactory must not be null");if(!r)throw new Error("onSurveyActivatedCallback must not be null");if(!o)throw new Error("storage must not be null");if(!a)throw new Error("governor must not be null");if(!u)throw new Error("transporterFactory must not be null");this.surveyClient=t,this.activityListener=n,this.launcherFactory=i,this.onSurveyActivatedCallback=r,this.storage=o,this.governor=a,this.surveyActivationStatsProvider=s,this.governanceServiceClient=c,e.transporterFactory=u,this.loggedFirstStart=!1,this.setPendingSurveys(null),this.activityListener.clearSurveys();var l=this;this.activityListener.setCallback({run:function(e,t){l.onSurveyActivated(e,t)},shouldAcceptActivity:function(e){return l.shouldAcceptActivity(e)}})}return e.setTelemetryLogger=function(t){if(!t)throw new Error("telemetryLogger must not be null");e.telemetryLogger=t},e.getTelemetryLogger=function(){return e.telemetryLogger},e.getTransportFactory=function(){return e.transporterFactory},e.make=function(t,n,i,r,o,l,d,m,f,y,S){try{var T=p.GovernedChannelStateProviderFactory.make(r,o),C=v.SurveyActivationStatsProviderFactory.make(r,o),A=u.CampaignStateProviderFactory.make(r,o);return f.push(new a.FileSystemCampaignDefinitionProvider(r)),new e(new s.CampaignManager(A,f,l,d,t,new Date,y),new h(E,this.getTelemetryLogger),n,i,r,new g.Governor(T),C,m,S)}catch(e){this.telemetryLogger.log_Event(c.TelemetryEvent.FloodgateEngine.Make.Failed,{ErrorMessage:e&&e.toString(),ErrorDetails:e&&e.stack})}},e.prototype.mergeAndSave=function(){this.saveSettings(),this.saveSurveyActivationHistory(),this.saveSurveyEventActivityHistory(),this.surveyClient.saveCurrentState(),this.governor.saveChannelStates()},e.prototype.start=function(){if(2!==this.initializationStatus&&3!==this.initializationStatus)try{this.setInitializationStatus(2),this.loadSettingsAndPriorEventCounts();var t=this.getAvailableChannelTypes();this.surveyClient.refreshSurveyDefinitions(t),this.setPendingSurveysAndStartFloodgate(),this.setInitializationStatus(3)}catch(t){this.setInitializationStatus(1),e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.Start.Failed,{ErrorMessage:t&&t.toString(),ErrorDetails:t&&t.stack})}},e.prototype.startAsync=function(){if(2===this.initializationStatus||3===this.initializationStatus)return Promise.resolve();try{this.setInitializationStatus(2),this.loadSettingsAndPriorEventCounts();var t=this.getAvailableChannelTypes(),n=this;return new Promise((function(i,r){n.surveyClient.refreshSurveyDefinitionsAsync(t).then((function(){4===n.initializationStatus?(n.setInitializationStatus(3),n.stop(),e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.StartAsync.Stopped,{ErrorMessage:"Stopped because of a pending stop() call"})):n.setPendingSurveysAndStartFloodgate(),i()})).catch((function(t){n.setInitializationStatus(1),e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.StartAsync.Failed,{ErrorMessage:"Survey refresh error "+(t&&t.message)}),r(t)}))}))}catch(t){return this.setInitializationStatus(1),e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.StartAsync.Failed,{ErrorMessage:t&&t.toString(),ErrorDetails:t&&t.stack}),Promise.resolve()}},e.prototype.stop=function(){3===this.initializationStatus&&(this.mergeAndSave(),this.setPendingSurveys(null),this.updateActivityListenerWithCurrentSurveyDefinitions()),this.setInitializationStatus(4)},e.prototype.getActivityListener=function(){return this.activityListener},e.prototype.setInitializationStatus=function(e){this.initializationStatus=e},e.prototype.saveSettings=function(){this.storage.fileLock(f.FloodgateSettings);try{this.writeString(f.FloodgateSettings,l.FloodgateSettings.toJson(this.floodgateSettings))}finally{this.storage.fileUnlock(f.FloodgateSettings)}},e.prototype.loadSettingsAndPriorEventCounts=function(){try{this.previousSurveyActivationStats=this.surveyActivationStatsProvider.load(),this.previousSurveyEventActivityStats=m.SurveyStatCollectionEventActivity.fromJson(this.readString(f.SurveyEventActivityStats));var t=this.previousSurveyEventActivityStats.getStats();for(var n in t)t.hasOwnProperty(n)&&this.surveyEventSent.push(n);this.floodgateSettings=l.FloodgateSettings.fromJson(this.readString(f.FloodgateSettings))}catch(t){e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.Common.Error,{ErrorMessage:"Error loading prior settings/events "+(t&&t.toString())})}},e.prototype.getAvailableChannelTypes=function(){var e=this.governor.getAvailableChannelData(),t=[];return e.forEach((function(e){e&&t.push(e.getType())})),t},e.prototype.setPendingSurveysAndStartFloodgate=function(){this.setPendingSurveys(this.surveyClient.getAppSurveys()),this.updateActivityListenerWithCurrentSurveyDefinitions(),this.setInitializationStatus(3),this.loggedFirstStart||(this.loggedFirstStart=!0,this.getActivityListener().logActivity(h.FloodgateStartActivityName))},e.prototype.updateSurveyActivationStats=function(e){var t=e.getSurveyInfo(),n=t.getId(),i=this.previousSurveyActivationStats.getStats()[n]||new v.SurveyActivationStats;i.Type=e.getType(),i.ExpirationTimeUtc=t.getExpirationTimeUtc(),i.ActivationTimeUtc=new Date,i.SurveyLaunchCount++,this.previousSurveyActivationStats.addStats(n,i),A.hasOwnProperty(n)||(A[n]=0),A[n]++},e.prototype.saveSurveyActivationHistory=function(){this.storage.fileLock(f.SurveyActivationStats);try{var e=this.surveyActivationStatsProvider.load(),t=this.previousSurveyActivationStats.getStats(),n=new v.SurveyStatCollectionActivation;for(var i in this.launchedSurveys)if(this.launchedSurveys.hasOwnProperty(i)){var r=this.launchedSurveys[i].getSurveyInfo().getId(),o=t[r];n.addStats(r,o)}e.accumulate(n),this.surveyActivationStatsProvider.save(e),this.previousSurveyActivationStats=e}finally{this.storage.fileUnlock(f.SurveyActivationStats)}},e.prototype.saveSurveyEventActivityHistory=function(){this.storage.fileLock(f.SurveyEventActivityStats);try{var e=m.SurveyStatCollectionEventActivity.fromJson(this.readString(f.SurveyEventActivityStats)),t=new Date,n=new m.SurveyStatCollectionEventActivity,i=function(e){if(r.candidateSurveys.hasOwnProperty(e)){var i=new m.SurveyEventActivityStats,o=r.candidateSurveys[e];if(!o.getSurveyInfo().isActiveForDate(t))return"continue";i.ExpirationTimeUtc=o.getSurveyInfo().getExpirationTimeUtc();var a=o.getSurveyInfo().getActivationEvent().getTrackingSet(),s=[],u=[];a.getList().forEach((function(e){e&&(e.getIsAggregate()?s.push(e.getActivity()):u.push(e.getActivity()))})),i.Counts=new Array(s.length);for(var c=0;c<s.length;c++)i.Counts[c]=r.activityListener.moveSessionCountIntoBaseCount(s[c],o.getSurveyInfo().getId());for(var l=0,d=u;l<d.length;l++){var p=d[l];r.activityListener.saveSessionTrackingActivity(p)}n.addStats(o.getSurveyInfo().getId(),i)}},r=this;for(var o in this.candidateSurveys)i(o);e.accumulate(n),this.writeString(f.SurveyEventActivityStats,m.SurveyStatCollectionEventActivity.toJson(e)),this.previousSurveyEventActivityStats=e}finally{this.storage.fileUnlock(f.SurveyEventActivityStats)}},e.prototype.setPendingSurveys=function(e){if(this.candidateSurveys={},e)for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this.launcherFactory.AcceptsSurvey(n)&&(this.candidateSurveys[t]=n)}},e.prototype.getCurrentSurveyDefinitions=function(){var t=this,n=new Array,i=this.getAllCampaignDefinitionIDs(),r=this.getAllCandidateCampaignDefinitionIDs(),o=this.surveyClient.getCampaignDefinitions(),a=function(e){if(S.isBusinessCriticalSurvey(e))return!0;var n=t.previousSurveyActivationStats.getBySurveyId(e.getId());return!(!S.isMultiLaunchSurvey(e)||S.hasSurveyReachedMaxLaunches(e,n)||S.hasSurveyReachedMaxLaunchesPerSession(e,A))||!(n||!e.isActiveForDate(new Date))};for(var s in this.candidateSurveys)if(this.candidateSurveys.hasOwnProperty(s)){var u=this.candidateSurveys[s],c=u.getSurveyInfo();if(!o[null==c?void 0:c.getBackEndId()]||!a(c))continue;if(this.surveyEventSent.indexOf(s)<0){this.surveyEventSent.push(s);var l=this.getAdditionalSurveyInfoForTelemetry(u,null,i,r);e.telemetryLogger.log_UserSelected(c.getBackEndId(),c.getId(),u.getType(),JSON.stringify(l))}n.push(u)}return n},e.prototype.getAdditionalSurveyInfoForTelemetry=function(e,t,n,i){var r,o,a,s,u=this.surveyClient.getCampaignDefinitions()[e.getCampaignId()];r=u.nominationScheme.percentageNumerator,o=u.nominationScheme.percentageDenominator,a=u.nominationScheme.nominationPeriod.asTimeIntervalSeconds(),a=T.isNOU(a)?-1:a,s=u.nominationScheme.cooldownPeriod.asTimeIntervalSeconds(),s=T.isNOU(s)?-1:s;var c=e.getSurveyInfo();return{allCampaignDefinitionIDs:n,allCandidateCampaignDefinitionIDs:i,channelType:c.getGovernedChannelType(),contextCount:t?t.length:void 0,cooldownPeriodNumber:s,nominationPeriodNumber:a,percentageDenominator:o,percentageNumerator:r,surveyLauncherType:e.getLauncherType(),businessLevel:c.getBusinessLevel(),maxLaunches:c.getMaxLaunches(),maxLaunchesPerSession:c.getMaxLaunchesPerSession()}},e.prototype.getAllCandidateCampaignDefinitionIDs=function(){var e=[];for(var t in this.candidateSurveys)if(this.candidateSurveys.hasOwnProperty(t)){var n=this.candidateSurveys[t];e.push(n.getSurveyInfo().getBackEndId())}return e},e.prototype.getAllCampaignDefinitionIDs=function(){var e=this.surveyClient.getCampaignDefinitions(),t=[];for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=e[n];t.push(i.campaignId)}return t},e.prototype.updateActivityListenerWithCurrentSurveyDefinitions=function(){for(var e=[],t=0,n=this.getCurrentSurveyDefinitions();t<n.length;t++){var i=n[t].getSurveyInfo(),r=new y.ActivityTrackingContract(i.getId(),i.getActivationEvent().getTrackingSet());e.push(r)}this.activityListener.SetActivityTrackingContracts(e,this.previousSurveyEventActivityStats)},e.prototype.setCriticalPendingSurveysAndUpdateActivityListener=function(){var e={};for(var t in this.candidateSurveys)if(this.candidateSurveys.hasOwnProperty(t)){var n=this.candidateSurveys[t];S.isCriticalSurvey(n.getSurveyInfo())&&(e[t]=n)}Object.keys(e).length>0&&(this.setPendingSurveys(e),this.updateActivityListenerWithCurrentSurveyDefinitions())},e.prototype.shouldAcceptActivity=function(e){return 3===this.initializationStatus||e===h.FloodgateStartActivityName},e.prototype.onSurveyActivated=function(t,n){for(var i,r=0,o=this.getCurrentSurveyDefinitions();r<o.length;r++){var a=o[r];if(a.getSurveyInfo().getId()===t){i=a;break}}if(T.isNOU(i))e.getTelemetryLogger().log_Error(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.SurveyNotDefined,"Survey is not defined in the current survey definitions.");else try{var s=i.getSurveyInfo().getGovernedChannelType();this.governanceServiceClient.isEnabled(s)?(this.staleTriggeredSurveysQueue.push(i),1===this.staleTriggeredSurveysQueue.length&&this.checkGovernanceServiceAndActivateSurvey(i,s,n)):this.activateSurvey(i,s,n)}catch(t){e.telemetryLogger.log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.Error,{ErrorMessage:"Error activating survey "+(t&&t.toString()),ErrorDetails:t&&t.stack})}},e.prototype.activateSurvey=function(t,n,i){var r=!1;if(this.candidateSurveys[t.getSurveyInfo().getId()])if(t.getSurveyInfo().isActiveForDate(new Date)){if(this.governor.refreshChannelData(),S.isCriticalSurvey(t.getSurveyInfo()))r=!0;else if(this.governor.isChannelOpen(n)){if(this.surveyActivationStatsProvider.load().getBySurveyId(t.getSurveyInfo().getId()))e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.ActivationStatsSuppressedSurvey,{CampaignId:t.getSurveyInfo().getBackEndId(),SurveyId:t.getSurveyInfo().getId()});else if(0===Object.keys(this.launchedSurveys).length)r=!0;else{var o=Object.values(this.launchedSurveys)[0];T.isNOU(o)||e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.SessionSuppressedSurvey,{CampaignId:o.getSurveyInfo().getBackEndId(),SurveyId:o.getSurveyInfo().getId()})}}else e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.ClosedChannelType,{ClosedChannelType:d.GovernedChannelType[n]});r&&(this.launchedSurveys[t.getSurveyInfo().getId()]=t)}else e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.ActivationExpiredSurvey,{CampaignId:t.getSurveyInfo().getBackEndId(),SurveyId:t.getSurveyInfo().getId()});else e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.OnSurveyActivated.ActivationIrrelevantSurvey,{CampaignId:t.getSurveyInfo().getBackEndId(),SurveyId:t.getSurveyInfo().getId()});if(this.updateSurveyActivationStats(t),this.mergeAndSave(),this.activityListener.clearSurveys(),this.staleTriggeredSurveysQueue=[],r){var a=t.getSurveyInfo().getActivationEvent().getTrackingSet().getActivityTrackingInfo(this.activityListener,t.getSurveyInfo().getId()),s=this.getAdditionalSurveyInfoForTelemetry(t,i,this.getAllCampaignDefinitionIDs(),this.getAllCandidateCampaignDefinitionIDs());s.governanceServiceClientState=this.governanceServiceClient.getClientState(),e.telemetryLogger.log_TriggerMet(t.getSurveyInfo().getBackEndId(),t.getSurveyInfo().getId(),t.getType(),a,JSON.stringify(s)),this.governor.startChannelCooldown(n);var u=t.getSurveyInfo(),l=!0;if(S.isBusinessCriticalSurvey(u))l=!1;else if(S.isMultiLaunchSurvey(u)){var p=this.previousSurveyActivationStats.getBySurveyId(u.getId());l=S.hasSurveyReachedMaxLaunches(u,p)}this.surveyClient.onSurveyActivated(u,l),this.launchLauncher(t,i),this.setCriticalPendingSurveysAndUpdateActivityListener()}},e.prototype.checkGovernanceServiceAndActivateSurvey=function(t,n,o){return i(this,void 0,void 0,(function(){var i,a,s,u,l,d;return r(this,(function(r){switch(r.label){case 0:return i=this.surveyClient.getCampaignDefinitions()[t.getCampaignId()],a=i.nominationScheme.cooldownPeriod.asTimeIntervalSeconds(),s=g.Governor.GetChannelCoolDown(n),[4,this.governanceServiceClient.checkGovernancePermitAsync(t,a,s,n)];case 1:return u=r.sent(),l=!1,e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.CheckGovernanceServiceAndActivateSurvey.GovernanceServiceClientCompleted,{Message:JSON.stringify(this.createGorvernanceResponseTelemetry(u))}),3!==this.initializationStatus?[2]:(u.error?this.governanceServiceClient.shouldForceDisplay()&&(l=!0,e.getTelemetryLogger().log_Event(c.TelemetryEvent.FloodgateEngine.CheckGovernanceServiceAndActivateSurvey.GovernanceServiceForceToDisplay,{ErrorMessage:u.errorMessage})):u.permission?l=!0:(d=u.lastTriggerSurvey,this.governor.startChannelCooldown(n,d.lastTriggerSurveyTime),this.clearSurveyWithChannel(n)),l?(this.activateSurvey(t,n,o),[2]):this.staleTriggeredSurveysQueue.length<=1?(this.staleTriggeredSurveysQueue=[],[2]):(this.staleTriggeredSurveysQueue.shift(),this.checkGovernanceServiceAndActivateSurvey(this.staleTriggeredSurveysQueue[0],n,o),[2]))}}))}))},e.prototype.readString=function(e){return this.storage.read(e)},e.prototype.writeString=function(e,t){this.storage.write(e,t)},e.prototype.launchLauncher=function(e,t){var n=this.launcherFactory.makeSurveyLauncher(e);n&&(this.launchedLaunchers.push(n),this.onSurveyActivatedCallback.onSurveyActivated(n,e,{contextInfo:t}))},e.prototype.clearSurveyWithChannel=function(e){var t={};for(var n in this.candidateSurveys)if(this.candidateSurveys.hasOwnProperty(n)){var i=this.candidateSurveys[n];i.getSurveyInfo().getGovernedChannelType()!==e&&(t[n]=i)}this.candidateSurveys=t,this.activityListener.UpdateActivityTrackingContracts(this.candidateSurveys)},e.prototype.createGorvernanceResponseTelemetry=function(e){return{FloodgateEngineStatus:this.initializationStatus.toString(),GovernanceServiceResult:e,StaleTriggeredSurveysQueueCount:this.staleTriggeredSurveysQueue.length-1}},e.telemetryLogger=new C,e}();t.FloodgateEngine=_},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.FileSystemCampaignDefinitionProvider=t.FilterValidCampaignDefinitions=t.CampaignDefinition=t.CampaignSurveyTemplateIntercept=t.CampaignSurveyTemplateGenericMessagingSurface=t.CampaignSurveyTemplateNps11PointStatic=t.CampaignSurveyTemplateNps5PointStatic=t.CampaignSurveyTemplateNps=t.CampaignSurveyTemplateNlqs=t.CampaignSurveyTemplateFps=t.CampaignSurveyTemplate=t.CampaignSurveyMetadata=t.CampaignSurveyContentComment=t.CampaignSurveyContentRating=t.CampaignSurveyContentIntercept=t.CampaignSurveyContentPrompt=t.CampaignSurveyContentCVSurvey=t.CampaignSurveyContentMultipleChoice=t.CampaignSurveyContent=t.CampaignSurveyEventCountedActivitySequence=t.CampaignSurveyEventCountedActivity=t.CampaignSurveyEvent=t.CampaignNominationSchemeRatioPercentage=t.CampaignNominationScheme=t.CampaignDistributionRamp=t.CampaignDistribution=t.CampaignAdditionalDataRequested=t.CampaignDurationSingleBuildChange=t.CampaignDurationTimeInterval=t.CampaignDuration=t.CampaignScopeUserFactAll=t.CampaignScopeUserFactAny=t.CampaignScopeEnvironmentCrossProduct=t.CampaignScopeAny=t.CampaignScope=t.CampaignLanguageRangeLanguageSubtag=t.CampaignLanguageRange=void 0;var o=n(6),a=n(8),s=n(12),u=n(9),c=n(3),l=n(54),d=c.getDistantFuture,p=c.isBoolean,g=c.isNOU,h=c.isNumber,v=c.isString,m=c.isUtcDatetimeString,f=c.stringToDate,y=function(){function e(){}return e.deserialize=function(e){var t;return e&&0===e.Type&&(t=S.deserialize(e)),void 0===t?null:t},e.prototype.validate=function(){return!0},e}();t.CampaignLanguageRange=y;var S=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return e&&(n.languageSubTag=e.Value),n.validate()?n:null},t.prototype.isInRange=function(e){if(g(e))return!1;var t=c.extractLanguageSubtag(e);return!g(t)&&t.toLocaleUpperCase()===this.languageSubTag.toLocaleUpperCase()},t.prototype.validate=function(){return!!e.prototype.validate.call(this)&&(!(g(this.languageSubTag)||!v(this.languageSubTag))&&!!c.isValidLanguageSubTag(this.languageSubTag))},t}(y);t.CampaignLanguageRangeLanguageSubtag=S;var T=function(){function e(){}return e.deserialize=function(e){var t;if(g(e))return null;switch(e.Type){case 0:t=C.deserialize(e);break;case 1:t=E.deserialize(e);break;case 2:t=A.deserialize(e);break;case 3:t=_.deserialize(e)}return void 0===t?null:t},e.prototype.validate=function(){return!0},e}();t.CampaignScope=T;var C=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){return new t},t.prototype.isInScope=function(){return!0},t.prototype.validate=function(){return!!e.prototype.validate.call(this)},t}(T);t.CampaignScopeAny=C;var E=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t,i=[];if(g(e))return null;for(var r in e.Languages)if(e.Languages.hasOwnProperty(r)){var o=e.Languages[r];o&&i.push(y.deserialize(o))}return 0===i.length&&(i=null),n.languageRanges=i,n.validate()?n:null},t.prototype.setEnvironmentProvider=function(e){this.environmentProvider=e},t.prototype.isInScope=function(){if(g(this.languageRanges))return!0;if(g(this.environmentProvider)||!this.environmentProvider.getLanguage())return!1;var e=this.environmentProvider.getLanguage();for(var t in this.languageRanges){if(this.languageRanges.hasOwnProperty(t))if(this.languageRanges[t].isInRange(e))return!0}return!1},t.prototype.validate=function(){if(!e.prototype.validate.call(this))return!1;if(this.languageRanges)for(var t in this.languageRanges)if(this.languageRanges.hasOwnProperty(t)&&!this.languageRanges[t])return!1;return!0},t}(T);t.CampaignScopeEnvironmentCrossProduct=E;var A=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return n.userFacts=l.deserializeUserFacts(e),n.validate()?n:null},t.prototype.setUserFactsProvider=function(e){this.userFactsProvider=e},t.prototype.isInScope=function(){var e=this;return!!g(this.userFacts)||!!this.userFactsProvider&&this.userFacts.some((function(t){var n=e.userFactsProvider.getUserFact(t.getName());return t.isAMatch(n)}))},t.prototype.validate=function(){return!!e.prototype.validate.call(this)&&l.validateUserFacts(this.userFacts)},t}(T);t.CampaignScopeUserFactAny=A;var _=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return n.userFacts=l.deserializeUserFacts(e),n.validate()?n:null},t.prototype.setUserFactsProvider=function(e){this.userFactsProvider=e},t.prototype.isInScope=function(){var e=this;if(g(this.userFacts))return!0;if(!this.userFactsProvider)return!1;var t=this.userFacts.filter((function(t){var n=e.userFactsProvider.getUserFact(t.getName());return!t.isAMatch(n)}));if(t.length>0){var n=t.map((function(e){return e.getName()}));return s.FloodgateEngine.getTelemetryLogger().log_Event(a.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Summary,{Count:t.length,Message:n.toString()}),!1}return!0},t.prototype.validate=function(){return!!e.prototype.validate.call(this)&&l.validateUserFacts(this.userFacts)},t}(T);t.CampaignScopeUserFactAll=_;var I=function(){function e(){}return e.deserialize=function(e){var t;if(g(e))return null;switch(e.Type){case 0:t=b.deserialize(e);break;case 1:t=O.deserialize(e)}return void 0===t?null:t},e.prototype.validate=function(){return!0},e}();t.CampaignDuration=I;var b=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return e&&(n.intervalSeconds=e.IntervalSeconds),n.validate()?n:null},t.prototype.asTimeIntervalSeconds=function(){return this.intervalSeconds},t.prototype.validate=function(){return!!e.prototype.validate.call(this)&&!!h(this.intervalSeconds)},t}(I);t.CampaignDurationTimeInterval=b;var O=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){return new t},t.prototype.asTimeIntervalSeconds=function(){return null},t}(I);t.CampaignDurationSingleBuildChange=O;var F=function(){function e(){}return e.deserialize=function(t){var n=new e;if(!g(t)){n.additionalData=[];for(var i=0,r=t;i<r.length;i++){"EmailAddress"===r[i]&&n.additionalData.push(0)}}return n.validate()?n:null},e.prototype.validate=function(){return!g(this.additionalData)},e}();t.CampaignAdditionalDataRequested=F;var w=function(){function e(){}return e.deserialize=function(e){var t;return e&&0===e.Type&&(t=D.deserialize(e)),void 0===t?null:t},e.prototype.validate=function(){return!0},e}();t.CampaignDistribution=w;var D=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return e&&(n.maxDelaySeconds=e.MaxDelaySeconds,n.chunks=e.Chunks),n.validate()?n:null},t.prototype.validate=function(){return!!e.prototype.validate.call(this)&&(!(!h(this.maxDelaySeconds)||this.maxDelaySeconds<0)&&!(!h(this.chunks)||this.chunks<0))},t}(w);t.CampaignDistributionRamp=D;var L=function(){function e(){}return e.deserialize=function(e){var t;return e&&0===e.Type&&(t=N.deserialize(e)),void 0===t?null:t},e.prototype.getActiveSurveyTimeIntervalSeconds=function(){var e=this.nominationPeriod.asTimeIntervalSeconds();return h(e)?e:this.fallbackSurveyDurationSeconds},e.prototype.calculateSurveyStartTimeFromDate=function(e){return e||new Date},e.prototype.calculateSurveyExpirationTimeFromSurveyStartTime=function(e){return e=e||new Date,c.addSecondsWithoutOverflow(e,this.getActiveSurveyTimeIntervalSeconds())},e.prototype.getCampaignCooldown=function(e){return e?this.cooldownPeriod:this.nominationPeriod},e.prototype.validate=function(){return!g(this.nominationPeriod)&&(g(this.cooldownPeriod)&&(this.cooldownPeriod=this.nominationPeriod),!(!h(this.nominationPeriod.asTimeIntervalSeconds())&&(!h(this.fallbackSurveyDurationSeconds)||this.fallbackSurveyDurationSeconds<=0)))},e}();t.CampaignNominationScheme=L;var N=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return g(e)?null:(e.DistributionModel&&(n.distributionModel=w.deserialize(e.DistributionModel)),e.CooldownPeriod&&(n.cooldownPeriod=I.deserialize(e.CooldownPeriod)),e.NominationPeriod&&(n.nominationPeriod=I.deserialize(e.NominationPeriod)),n.fallbackSurveyDurationSeconds=e.FallbackSurveyDurationSeconds,n.percentageDenominator=e.PercentageDenominator,n.percentageNumerator=e.PercentageNumerator,n.validate()?n:null)},t.prototype.evaluateNominationRules=function(){var e=Math.random();return Math.floor(e*this.percentageDenominator)<this.percentageNumerator},t.prototype.validate=function(){return!!e.prototype.validate.call(this)&&(!(!h(this.percentageDenominator)||!h(this.percentageNumerator))&&(!(this.percentageDenominator<=0||this.percentageNumerator<0)&&!(this.percentageNumerator>this.percentageDenominator)))},t}(L);t.CampaignNominationSchemeRatioPercentage=N;var P=function(){function e(){}return e.deserialize=function(e){var t;if(g(e))return null;switch(e.Type){case 0:t=U.deserialize(e);break;case 1:t=M.deserialize(e)}return void 0===t?null:t},e.prototype.validate=function(){return!0},e}();t.CampaignSurveyEvent=P;var U=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return g(e)?null:(n.activity=e.Activity,n.count=e.Count,n.isAggregate=e.IsAggregate,n.validate()?n:null)},t.prototype.validate=function(){return!!e.prototype.validate.call(this)&&(!(g(this.activity)||!v(this.activity))&&(!(!h(this.count)||this.count<=0)&&!!p(this.isAggregate)))},t}(P);t.CampaignSurveyEventCountedActivity=U;var M=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t,i=[];if(g(e))return null;for(var r in e.Sequence)if(e.Sequence.hasOwnProperty(r)){var o=e.Sequence[r];o&&i.push(U.deserialize(o))}return 0===i.length&&(i=null),n.sequence=i,n.validate()?n:null},t.prototype.validate=function(){if(!e.prototype.validate.call(this))return!1;if(g(this.sequence))return!1;for(var t in this.sequence)if(this.sequence.hasOwnProperty(t)&&!this.sequence[t])return!1;return!0},t}(P);t.CampaignSurveyEventCountedActivitySequence=M;var R=function(){function e(){}return e.deserialize=function(t,n){var i=new e;return g(t)?null:(i.prompt=x.deserialize(t.Prompt),i.rating=V.deserialize(t.Rating),i.comment=z.deserialize(t.Question),i.multipleChoice=B.deserialize(t.MultipleChoice),i.intercept=G.deserialize(t.Intercept),i.cvSurvey=k.deserialize(t.CVSurveyParams),i.validate(n)?i:null)},e.prototype.validate=function(e){return!g(this.intercept)||!g(this.prompt)&&(e?!g(this.rating)||!g(this.multipleChoice)||!g(this.comment):!g(this.rating)&&!g(this.comment))},e}();t.CampaignSurveyContent=R;var B=function(){function e(){}return e.deserialize=function(t){var n=new e;return g(t)?null:(n.question=t.Question,n.availableOptions=t.AvailableOptions,n.minNumberOfSelectedOptions=t.MinNumberOfSelectedOptions,n.maxNumberOfSelectedOptions=t.MaxNumberOfSelectedOptions,n.validate()?n:null)},e.prototype.validate=function(){if(g(this.question)||!v(this.question)||g(this.availableOptions)||!Array.isArray(this.availableOptions)||this.availableOptions.length<2||g(this.minNumberOfSelectedOptions)||!h(this.minNumberOfSelectedOptions)||g(this.maxNumberOfSelectedOptions)||!h(this.maxNumberOfSelectedOptions))return!1;for(var e in this.availableOptions)if(this.availableOptions.hasOwnProperty(e)&&!v(this.availableOptions[e]))return!1;return!0},e}();t.CampaignSurveyContentMultipleChoice=B;var k=function(){function e(){}return e.deserialize=function(t){var n=new e;return g(t)?null:(n.customerVoiceFormId=t.CustomerVoiceFormId,n.validate()?n:null)},e.prototype.validate=function(){return!g(this.customerVoiceFormId)&&v(this.customerVoiceFormId)},e}();t.CampaignSurveyContentCVSurvey=k;var x=function(){function e(){}return e.deserialize=function(t){var n=new e;return g(t)?null:(n.title=t.Title,n.question=t.Question,n.yesLabel=t.YesLabel,n.noLabel=t.NoLabel,n.validate()?n:null)},e.prototype.validate=function(){return!(g(this.title)||!v(this.title)||g(this.question)||!v(this.question)||g(this.yesLabel)||!v(this.yesLabel)||g(this.noLabel)||!v(this.noLabel))},e}();t.CampaignSurveyContentPrompt=x;var G=function(){function e(){}return e.deserialize=function(t){var n=new e;return g(t)?null:(n.title=t.Title,n.question=t.Question,n.url=t.Url,n.validate()?n:null)},e.prototype.validate=function(){return!(g(this.title)||!v(this.title)||g(this.question)||!v(this.question)||g(this.url)||!v(this.url))},e}();t.CampaignSurveyContentIntercept=G;var V=function(){function e(){}return e.deserialize=function(t){var n=new e;return g(t)?null:(n.isZeroBased=t.IsZeroBased,n.question=t.Question,n.ratingValuesAscending=t.RatingValuesAscending,n.validate()?n:null)},e.prototype.validate=function(){if(g(this.question)||!v(this.question)||g(this.ratingValuesAscending)||!Array.isArray(this.ratingValuesAscending)||this.ratingValuesAscending.length<2||this.ratingValuesAscending.length>11)return!1;if(g(this.isZeroBased))this.isZeroBased=!1;else if(!p(this.isZeroBased))return!1;for(var e in this.ratingValuesAscending)if(this.ratingValuesAscending.hasOwnProperty(e)&&!v(this.ratingValuesAscending[e]))return!1;return!0},e}();t.CampaignSurveyContentRating=V;var z=function(){function e(){}return e.deserialize=function(t){var n=new e;return g(t)?null:(n.question=t.Question,n.validate()?n:null)},e.prototype.validate=function(){return!(g(this.question)||!v(this.question))},e}();t.CampaignSurveyContentComment=z;var j=function(){function e(){}return e.deserialize=function(t){if(g(t))return null;var n=new e;return n.contentMetadata=t.ContentMetadata,n.validate()?n:null},e.prototype.validate=function(){return!(g(this.contentMetadata)||!c.isObject(this.contentMetadata))},e}();t.CampaignSurveyMetadata=j;var q=function(){function e(){}return e.deserialize=function(e){var t;if(g(e))return null;switch(e.Type){case 0:t=Y.deserialize(e);break;case 1:t=K.deserialize(e);break;case 2:t=H.deserialize(e);break;case 3:t=W.deserialize(e);break;case 4:t=J.deserialize(e);break;case 22:t=Q.deserialize(e);break;case 5:t=Z.deserialize(e)}return g(t)?null:t},e.prototype.validate=function(){return!g(this.activationEvent)},e}();t.CampaignSurveyTemplate=q;var H=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return g(e)?null:(n.activationEvent=P.deserialize(e.ActivationEvent),n.content=R.deserialize(e.Content,!0),n.validate()?n:null)},t.prototype.validate=function(){return!(!e.prototype.validate.call(this)||g(this.content))},t}(q);t.CampaignSurveyTemplateFps=H;var W=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return g(e)?null:(n.activationEvent=P.deserialize(e.ActivationEvent),n.content=R.deserialize(e.Content),n.validate()?n:null)},t.prototype.validate=function(){return!(!e.prototype.validate.call(this)||g(this.content))},t}(q);t.CampaignSurveyTemplateNlqs=W;var J=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return g(e)?null:(n.activationEvent=P.deserialize(e.ActivationEvent),n.content=R.deserialize(e.Content),n.validate()?n:null)},t.prototype.validate=function(){return!(!e.prototype.validate.call(this)||g(this.content))},t}(q);t.CampaignSurveyTemplateNps=J;var Y=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return g(e)?null:(n.activationEvent=P.deserialize(e.ActivationEvent),n.validate()?n:null)},t.prototype.validate=function(){return!!e.prototype.validate.call(this)},t}(q);t.CampaignSurveyTemplateNps5PointStatic=Y;var K=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return g(e)?null:(n.activationEvent=P.deserialize(e.ActivationEvent),n.validate()?n:null)},t.prototype.validate=function(){return!!e.prototype.validate.call(this)},t}(q);t.CampaignSurveyTemplateNps11PointStatic=K;var Q=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){if(g(e))return null;var n=new t;return n.activationEvent=P.deserialize(e.ActivationEvent),n.metadata=j.deserialize(e.Metadata),n.maxLaunches=e.MaxLaunches,n.maxLaunchesPerSession=e.MaxLaunchesPerSession,n.preferredLaunchType=e.PreferredLaunchType,n.validate()?n:null},t.prototype.validate=function(){return!(!e.prototype.validate.call(this)||g(this.metadata))&&(!g(this.maxLaunches)&&(!h(this.maxLaunches)||this.maxLaunches<=0)||!g(this.maxLaunchesPerSession)&&(!h(this.maxLaunchesPerSession)||this.maxLaunchesPerSession<=0)?(s.FloodgateEngine.getTelemetryLogger().log_LocalError("Invalid Multi Launch settings",this.maxLaunches,this.maxLaunchesPerSession),!1):h(this.maxLaunches)&&h(this.maxLaunchesPerSession)&&this.maxLaunchesPerSession>this.maxLaunches?(s.FloodgateEngine.getTelemetryLogger().log_LocalError("Invalid Multi launch settings",this.maxLaunches,this.maxLaunchesPerSession),!1):!(!g(this.preferredLaunchType)&&!v(this.preferredLaunchType))||(s.FloodgateEngine.getTelemetryLogger().log_LocalError("Invalid launcher type",this.preferredLaunchType),!1))},t}(q);t.CampaignSurveyTemplateGenericMessagingSurface=Q;var Z=function(e){function t(){return e.call(this)||this}return r(t,e),t.deserialize=function(e){var n=new t;return g(e)?null:(n.activationEvent=P.deserialize(e.ActivationEvent),n.content=R.deserialize(e.Content),n.validate()?n:null)},t.prototype.validate=function(){return!(!e.prototype.validate.call(this)||g(this.content))},t}(q);t.CampaignSurveyTemplateIntercept=Z;var X=function(){function e(){}return e.deserialize=function(t){var n=new e;if(g(t))return null;n.campaignId=t.CampaignId,n.governedChannelType=t.GovernedChannelType,n.startTime=t.StartTimeUtc,n.endTime=t.EndTimeUtc,n.launcherType=t.LauncherType,n.primaryPriority=t.PrimaryPriority,n.tags=t.Tags;var i=F.deserialize(t.AdditionalDataRequested);return n.additionalDataRequested=i?i.additionalData:[],t.SurveyTemplate&&(n.surveyTemplate=q.deserialize(t.SurveyTemplate)),t.NominationScheme&&(n.nominationScheme=L.deserialize(t.NominationScheme)),t.Scope&&(n.scope=T.deserialize(t.Scope)),g(t.BusinessLevel)||(n.businessLevel=t.BusinessLevel),n.validate()?n:(s.FloodgateEngine.getTelemetryLogger().log_LocalError("Invalid definition",t),null)},e.prototype.validate=function(){var e,t;if(g(this.scope)&&(this.scope=new C),g(this.campaignId)||!v(this.campaignId))return!1;if(!h(this.governedChannelType)||!c.isEnumValue(this.governedChannelType,u.GovernedChannelType))return!1;if(g(this.nominationScheme))return!1;if(g(this.surveyTemplate))return!1;if(!g(this.launcherType)&&!v(this.launcherType))return!1;if("customervoice"===this.launcherType&&g(null===(t=null===(e=this.surveyTemplate.content)||void 0===e?void 0:e.cvSurvey)||void 0===t?void 0:t.customerVoiceFormId))return!1;if(!g(this.primaryPriority)&&!h(this.primaryPriority))return!1;if(this.tags&&!Array.isArray(this.tags))return!1;if(g(this.startTime))this.startTime=d();else{if(!m(this.startTime))return!1;this.startTime=f(this.startTime)}if(g(this.endTime)||"string"==typeof this.endTime&&""===this.endTime)this.endTime=d();else{if(!m(this.endTime))return!1;this.endTime=f(this.endTime)}return!0},e}();function $(e){var t=[];if(g(e))return{result:t,error:"Empty"};if(!Array.isArray(e))return{result:t,error:"Not an array"};for(var n=[],i=0;i<e.length;i++){var r=e[i];if(r){var o=X.deserialize(r);o?t.push(o):n.push(i)}else n.push(i)}return{result:t,error:n.length>0?"Invalid campaign definitions at indexes: "+n.toString():void 0}}t.CampaignDefinition=X,t.FilterValidCampaignDefinitions=$;var ee=function(){function e(e){if(g(e))throw new Error("storage must not be null");this.storage=e}return e.prototype.load=function(){var e,t=this.storage.read(o.FileType.CampaignDefinitions);if(g(t))return[];try{e=JSON.parse(t)}catch(e){return s.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed(e.toString()),[]}return $(e).result},e.prototype.loadAsync=function(){var e=this.load();return new Promise((function(t,n){t(e)}))},e}();t.FileSystemCampaignDefinitionProvider=ee},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GovernanceServiceClientState=t.GovernanceServiceSurveyType=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Feedback=1]="Feedback",e[e.Nps=2]="Nps",e[e.Psat=4]="Psat",e[e.Bps=6]="Bps",e[e.Fps=8]="Fps",e[e.Nlqs=18]="Nlqs",e[e.GenericMessagingSurface=22]="GenericMessagingSurface",e[e.Intercept=24]="Intercept"}(t.GovernanceServiceSurveyType||(t.GovernanceServiceSurveyType={})),function(e){e[e.Disabled=0]="Disabled",e[e.InitializationFailed=1]="InitializationFailed",e[e.Enabled=2]="Enabled"}(t.GovernanceServiceClientState||(t.GovernanceServiceClientState={}))},function(e,t,n){"use strict";var i=n(10),r=n(9),o=n(19),a=n(3),s=a.getDistantFuture,u=a.getDistantPast,c=a.isNOU,l=a.isDate,d=function(){function e(e){if(c(e))throw new Error("data must not be null");if(c(e.id)||""===e.id)throw new Error("data.id must not be null or empty");if(c(e.governedChannelType)&&(e.governedChannelType=r.GovernedChannelType.getDefault()),c(e.expirationTimeUtc)||""===e.expirationTimeUtc)throw new Error("data.expirationTimeUtc must not be null or empty");if(c(e.activationEvent))throw new Error("data.activationEvent must not be null");(c(e.backEndIdentifier)||""===e.backEndIdentifier)&&(e.backEndIdentifier=e.id),c(e.launcherType)&&(e.launcherType=i.LAUNCHER_TYPE_DEFAULT),this.data=e}return e.prototype.getId=function(){return this.data.id},e.prototype.getBackEndId=function(){return this.data.backEndIdentifier},e.prototype.getGovernedChannelType=function(){return this.data.governedChannelType},e.prototype.getRawStartTimeUtc=function(){return this.data.startTimeUtc},e.prototype.getStartTimeUtc=function(){if(c(this.data.startTimeUtc))return u();var e=new Date(this.data.startTimeUtc);return l(e)?e:s()},e.prototype.getExpirationTimeUtc=function(){if(c(this.data.expirationTimeUtc))return u();var e=new Date(this.data.expirationTimeUtc);return l(e)?e:u()},e.prototype.getRawExpirationTimeUtc=function(){return this.data.expirationTimeUtc},e.prototype.isActiveForDate=function(e){return!c(e)&&(e>=this.getStartTimeUtc()&&e<=this.getExpirationTimeUtc())},e.prototype.getActivationEvent=function(){return this.data.activationEvent},e.prototype.getPreferredLaunchType=function(){return this.data.preferredLaunchType},e.prototype.isAdditionalDataRequested=function(e){if(c(this.data.additionalDataRequested))return!1;for(var t=0,n=this.data.additionalDataRequested;t<n.length;t++){if(n[t]===e)return!0}return!1},e.prototype.getLauncherType=function(){return this.data.launcherType},e.prototype.getMetadata=function(){return this.data.metadata},e.prototype.getBusinessLevel=function(){return this.data.businessLevel},e.prototype.getMaxLaunches=function(){return this.data.maxLaunches},e.prototype.getMaxLaunchesPerSession=function(){return this.data.maxLaunchesPerSession},e.prototype.getDomElements=function(e){if(!e)throw new Error("Document must not be null");var t=e.createElement(o.DOM_TYPE_TAGNAME);t.appendChild(e.createTextNode(o.DOM_TYPE_VALUE));var n=e.createElement(o.DOM_ID_TAGNAME);return n.appendChild(e.createTextNode(this.getBackEndId())),[t,n]},e.prototype.getJsonElements=function(){var e={};e[o.JSON_ID_KEYNAME]=this.getBackEndId();var t={};return t[o.JSON_SURVEY_KEYNAME]=e,t},e}();!function(e){var t=function(){this.preferredLaunchType="Default"};e.SurveyDataSourceData=t}(d||(d={})),e.exports=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Survey=void 0;var i=n(10),r=n(12),o=n(3),a=function(){function e(){}return e.prototype.getCampaignId=function(){return this.getSurveyInfo().getBackEndId()},e.prototype.getLauncherType=function(){return this.getSurveyInfo().getLauncherType()},e.prototype.getClientFeedbackId=function(){return this.clientFeedbackId},e.prototype.submit=function(){var e=i.Type[this.getType()],t=r.FloodgateEngine.getTransportFactory().makeTransporter(e);t.setManifestValues(this.getJsonElements()),this.clientFeedbackId=t.getClientFeedbackId(),t.submit()},e.prototype.getPreGeneratedClientFeedbackId=function(){return this.clientFeedbackId?this.clientFeedbackId:this.clientFeedbackId=o.guid()},e}();t.Survey=a},function(e,t,n){"use strict";var i=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaObject=void 0;var r=function(){function e(t){e.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_SchemaObject"},e.getBaseTypes=function(){return[]},e.getTypeNameFor=function(e){return e&&e.H_?e.H_.T_:void 0},e.getBaseTypesFor=function(e){return e&&e.H_&&e.H_.B_?e.H_.B_:[]},e.getAllTypesFor=function(t){var n=e.getTypeNameFor(t);return n?i([n],e.getBaseTypesFor(t),!0):[]},e.matchesTypesFor=function(t,n){if(!Array.isArray(n)||0===n.length)return!0;for(var i=e.getTypeNameFor(t),r=e.getBaseTypesFor(t),o=0,a=n;o<a.length;o++){var s=a[o];if(s===i)return!0;if(r.indexOf(s)>=0)return!0}return!1},e.assign=function(e,t,n){if(n)for(var i=0,r=Object.keys(n);i<r.length;i++){var o=r[i];t[o]=n[o]}return t.H_=e.H_,t},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SchemaObject=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Governor=t.DEFAULT_TEACHING_MESSAGE_COOLDOWN=void 0;var i=n(9),r=n(29),o=n(3).isNOU;t.DEFAULT_TEACHING_MESSAGE_COOLDOWN=15;var a=function(e,t){this.name=e,this.cooldownSeconds=t},s=function(){function e(e){if(this.channels=[],!e)throw new Error("channelStateProvider must not be null");this.channelStateProvider=e,this.loadChannels()}return e.GetChannelCoolDown=function(t){var n=e.defaultChannelData[t];return n?n.cooldownSeconds:0},e.SetDefaultChannelCoolDown=function(t,n){var i=e.defaultChannelData[t];i&&(i.cooldownSeconds=n)},e.prototype.refreshChannelData=function(){this.loadChannels()},e.prototype.getAvailableChannelData=function(){var e=[];for(var t in this.channels)if(this.channels.hasOwnProperty(t)){var n=this.channels[t];n.isOpen()&&e.push(n)}return e},e.prototype.isChannelOpen=function(e){if(o(e))throw new Error("type must not be null");return this.channels[e].isOpen()},e.prototype.startChannelCooldown=function(e,t){if(o(e))throw new Error("type must not be null");t=t||new Date,this.channels[e].setCooldownStartTime(t),this.saveChannelStates()},e.prototype.saveChannelStates=function(){var e=[];for(var t in this.channels)if(this.channels.hasOwnProperty(t)){var n=this.channels[t],i=new r.GovernedChannelState(n.getType(),n.getCooldownStartTime());e.push(i)}this.channelStateProvider.save(e)},e.prototype.loadChannels=function(){for(var t in this.loadChannelStatesFromProvider(),i.GovernedChannelType)if(i.GovernedChannelType.hasOwnProperty(t)){var n=Number(t);if(isNaN(n)||this.channels[n])continue;var r=e.defaultChannelData[n],o=new i.GovernedChannel(n,r.name,r.cooldownSeconds,null);this.channels[n]=o}},e.prototype.loadChannelStatesFromProvider=function(){this.channels=[];var t=this.channelStateProvider.load();for(var n in t)if(t.hasOwnProperty(n)){var r=t[n],o=r.getType(),a=e.defaultChannelData[o],s=new i.GovernedChannel(o,a.name,a.cooldownSeconds,r.getCooldownStartTime());this.channels[s.getType()]=s}},e.minute=60,e.hour=60*e.minute,e.day=24*e.hour,e.defaultChannelData=[new a(i.GovernedChannelType[i.GovernedChannelType.Standard],14*e.day),new a(i.GovernedChannelType[i.GovernedChannelType.Urgent],0),new a(i.GovernedChannelType[i.GovernedChannelType.Banner],15*e.day),new a(i.GovernedChannelType[i.GovernedChannelType.TeachingMessage],t.DEFAULT_TEACHING_MESSAGE_COOLDOWN*e.day)],e}();t.Governor=s},function(e,t,n){"use strict";var i;!function(e){!function(e){e[e.None=0]="None",e[e.Critical=1]="Critical"}(e.BusinessLevel||(e.BusinessLevel={})),e.DOM_TYPE_TAGNAME="Type",e.DOM_TYPE_VALUE="Survey",e.DOM_ID_TAGNAME="SurveyID",e.JSON_SURVEY_KEYNAME="survey",e.JSON_ID_KEYNAME="surveyId"}(i||(i={})),e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MergeAndUpdateSurveyActivationStats=t.MergeAndUpdateCampaignStates=t.MergeAndUpdateGovernedChannelStates=t.makeSettingItemValue=t.extractSettingItemValueSubString=t.ItemCollection=void 0;var i=n(26),r=function(){function e(){this.items={},this.itemCount=0}return e.prototype.add=function(e,t){this.items[e]||this.itemCount++,this.items[e]=t},e.prototype.find=function(e){return this.items[e]},e.prototype.remove=function(e){var t=this.items[e];return t&&(delete this.items[e],this.itemCount--),t},e.prototype.count=function(){return this.itemCount},e}();t.ItemCollection=r,t.extractSettingItemValueSubString=function(e){if(!e)return e;var t=e.indexOf(o)+o.length,n=e.indexOf(a);return t<0||n<0?e:e.substring(t,n)},t.makeSettingItemValue=function(e){return e?o+e+a:o+a},t.MergeAndUpdateGovernedChannelStates=function(e,t){var n=new r;if(!e&&!t)return n;if(!e)return n.add(0,t),n;if(!t)return n.add(0,e),n.add(1,e),n;var i=[],o=[];return e&&e.forEach((function(e){for(var n,r=-1,a=0;a<t.length;a++)if((n=t[a]).getType()===e.getType()){r=a;break}if(-1===r)return i.push(e),void o.push(e);e.getCooldownStartTime()>n.getCooldownStartTime()?(i.push(e),o.push(e)):i.push(n),t.splice(r,1)})),t&&t.forEach((function(e){i.push(e)})),n.add(0,i),o.length>0&&n.add(1,o),n},t.MergeAndUpdateCampaignStates=function(e,t){var n=new r;if(!e&&!t)return n;if(!e)return n.add(0,t),n;if(!t)return n.add(0,e),n.add(1,e),n;var i=[],o=[];return e&&e.forEach((function(e){for(var n,r=new Date,a=-1,s=0;s<t.length;s++)if((n=t[s]).CampaignId===e.CampaignId){a=s;break}return-1===a?(i.push(e),void o.push(e)):n.LastCooldownEndTimeUtc>r?(i.push(n),void t.splice(a,1)):e.LastCooldownEndTimeUtc>r?(i.push(e),o.push(e),void t.splice(a,1)):(e.getCooldownStartDate()>n.getCooldownStartDate()||e.getCooldownStartDate()===n.getCooldownStartDate()&&e.LastNominationTimeUtc>n.LastNominationTimeUtc?(i.push(e),o.push(e)):i.push(n),void t.splice(a,1))})),t&&t.forEach((function(e){i.push(e)})),n.add(0,i),o.length>0&&n.add(1,o),n},t.MergeAndUpdateSurveyActivationStats=function(e,t){var n=new r;if(!e&&!t)return n;if(!e)return n.add(0,t),n;if(!t)return n.add(0,e),n.add(1,e),n;var o=new i.SurveyStatCollectionActivation,a=new i.SurveyStatCollectionActivation,s=e.getStats(),u=t.getStats();for(var c in s)if(s.hasOwnProperty(c)){var l=u[c];if(!l){o.addStats(c,s[c]),a.addStats(c,s[c]);continue}s[c].ActivationTimeUtc>l.ActivationTimeUtc?(o.addStats(c,s[c]),a.addStats(c,s[c])):o.addStats(c,u[c]),delete u[c]}for(var c in u)u.hasOwnProperty(c)&&o.addStats(c,u[c]);n.add(0,o);var d=a.getStats();for(var p in d)if(d.hasOwnProperty(p)){n.add(1,a);break}return n};var o="<data>",a="</data>"},function(e,t,n){"use strict";var i=n(11),r=function(){function e(e){if(!e)throw new Error("data must not be null");if(!e.question)throw new Error("data.question must not be null or empty");this.data=e,this.userComment=""}return e.make=function(t){try{return new e(t)}catch(e){return null}},e.prototype.getType=function(){return"Comment"},e.prototype.getQuestion=function(){return this.data.question},e.prototype.setSubmittedText=function(e){this.userComment=e},e.prototype.getSubmittedText=function(){return this.userComment},e.prototype.getDomElements=function(e){if(!e)throw new Error("Document must not be null");var t=e.createElement(i.DOM_COMMENT_TAGNAME);return t.appendChild(e.createTextNode(this.getSubmittedText())),[t]},e.prototype.getJsonElements=function(){var e={};return e[i.JSON_COMMENT_KEYNAME]=this.getSubmittedText(),e},e.prototype.getComponentJson=function(){var e;return(e={})[i.JSON_QUESTION_KEYNAME]=this.getQuestion(),e},e}();!function(e){var t=function(){};e.CommentComponentData=t}(r||(r={})),e.exports=r},function(e,t,n){"use strict";var i=n(11),r=function(){function e(e){if(!e)throw new Error("data must not be null");if(!e.question)throw new Error("data.question must not be null or empty");if(!e.title)throw new Error("data.title must not be null or empty");if(!e.yesButtonLabel)throw new Error("data.yesButtonLabel must not be null or empty");if(!e.noButtonLabel)throw new Error("data.noButtonLabel must not be null or empty");this.data=e,this.selectedButton=0}return e.make=function(t){try{return new e(t)}catch(e){return null}},e.prototype.getType=function(){return"Prompt"},e.prototype.getTitle=function(){return this.data.title},e.prototype.getQuestion=function(){return this.data.question},e.prototype.getYesButtonText=function(){return this.data.yesButtonLabel},e.prototype.getNoButtonText=function(){return this.data.noButtonLabel},e.prototype.setButtonSelected=function(e){e&&(this.selectedButton=e)},e.prototype.getButtonSelected=function(){return this.selectedButton},e.prototype.getDomElements=function(e){if(!e)throw new Error("Document must not be null");var t=e.createElement(i.DOM_PROMPT_TAGNAME);return t.appendChild(e.createTextNode(this.promptButtonToString(this.getButtonSelected()))),[t]},e.prototype.getJsonElements=function(){var e={};return e[i.JSON_PROMPT_KEYNAME]=this.promptButtonToString(this.getButtonSelected()),e},e.prototype.getComponentJson=function(){var e;return(e={})[i.JSON_TITLE_KEYNAME]=this.getTitle(),e[i.JSON_QUESTION_KEYNAME]=this.getQuestion(),e[i.JSON_PROMPTYESTEXT_KEYNAME]=this.getYesButtonText(),e[i.JSON_PROMPTNOTEXT_KEYNAME]=this.getNoButtonText(),e},e.prototype.promptButtonToString=function(e){switch(e){case 0:return"Unselected";case 1:return"Yes";case 2:return"No";default:return"Unknown"}},e}();!function(e){var t=function(){};e.PromptComponentData=t}(r||(r={})),e.exports=r},function(e,t,n){"use strict";var i=n(11),r=function(){function e(e){if(!e)throw new Error("data must not be null");if(!e.question)throw new Error("data.question must not be null or empty");if(!e.ratingValuesAscending||e.ratingValuesAscending.length<2)throw new Error("data.ratingValuesAscending must not be null or have less than two choices");e.ratingValuesAscending.forEach((function(e){if(!e)throw new Error("rating values must not contain null or empty")})),this.data=e,this.selectedIndex=-1}return e.make=function(t){try{return new e(t)}catch(e){return null}},e.prototype.getType=function(){return"Rating"},e.prototype.getQuestion=function(){return this.data.question},e.prototype.getRatingValuesAscending=function(){return this.data.ratingValuesAscending},e.prototype.getSelectedRating=function(){return this.isRatingIndexValid(this.selectedIndex)?this.data.ratingValuesAscending[this.selectedIndex]:""},e.prototype.setSelectedRatingIndex=function(e){this.isRatingIndexValid(e)?this.selectedIndex=e:this.selectedIndex=-1},e.prototype.getSelectedRatingIndex=function(){return this.selectedIndex},e.prototype.getDomElements=function(e){if(!e)throw new Error("Document must not be null");var t=e.createElement(i.DOM_RATING_TAGNAME);return this.isRatingIndexValid(this.getSelectedRatingIndex())?t.appendChild(e.createTextNode(this.getNormalizedRatingScore().toFixed(6))):t.appendChild(e.createTextNode("Not rated")),[t]},e.prototype.getJsonElements=function(){var e={};return this.isRatingIndexValid(this.getSelectedRatingIndex())?e[i.JSON_RATING_KEYNAME]=this.getNormalizedRatingScore():e[i.JSON_RATING_KEYNAME]="Not rated",e},e.prototype.getComponentJson=function(){var e;return(e={})[i.JSON_QUESTION_KEYNAME]=this.getQuestion(),e[i.JSON_RATINGOPTIONS_KEYNAME]=this.getRatingValuesAscending(),e},e.prototype.getNormalizedRatingScore=function(){return this.isRatingIndexValid(this.getSelectedRatingIndex())?this.data.isZeroBased?this.selectedIndex/(this.data.ratingValuesAscending.length-1):(this.selectedIndex+1)/this.data.ratingValuesAscending.length:-1},e.prototype.isRatingIndexValid=function(e){return e>=0&&e<this.data.ratingValuesAscending.length},e}();!function(e){var t=function(){};e.RatingComponentData=t}(r||(r={})),e.exports=r},function(e,t,n){"use strict";var i=n(50),r=n(8),o=n(51),a=n(30),s=n(3),u=[],c=0,l={},d=function(){function e(e,t){if(this.activityContext={},!e)throw new Error("callback must not be null");this.trackedActivityMap={},this.callback=e,this.loggerCallback=t}return e.resetSessionActivity=function(){l={}},e.prototype.logActivity=function(e,t,n){void 0===t&&(t=1),this.logActivity_private(e,0,t,null,n)},e.prototype.logActivityStartTime=function(e,t){this.logActivity_private(e,1,0,t,null)},e.prototype.logActivityStopTime=function(e,t){this.logActivity_private(e,2,0,t,null)},e.prototype.SetActivityTrackingContracts=function(e,t){void 0===t&&(t=new a.SurveyStatCollectionEventActivity);var n=0;if(e&&0!==e.length&&t){for(var s={},u=[],c=0,d=e;c<d.length;c++){var p=d[c],g=p.trackingSet;if(-1===u.indexOf(p.surveyId)){u.push(p.surveyId);for(var h=t.getBySurveyId(p.surveyId),v=[g.getList().length],m=new Array(g.getList().length),f=0,y=0,S=0,T=g.getList();S<T.length;S++){var C=T[S];if(v[y]=0,C.getIsAggregate()&&h&&f<h.Counts.length&&(v[y]=h.Counts[f++]),l[C.getActivity()])for(var E=0,A=l[C.getActivity()];E<A.length;E++){var _=A[E];if(_.surveyId===p.surveyId){m[y]=_;break}}y++}var I=new i(g);I.initCounts(v,m,!1);for(var b=0,O=I.generateActivityIndexList();b<O.length;b++){var F=O[b],w=new o.IndexedTracker;w.index=F.index,w.surveyId=p.surveyId,w.tracker=I,s[F.activity]||(s[F.activity]=[]),s[F.activity].push(w)}}else n++}if(n>0){var D=this.loggerCallback&&this.loggerCallback();D&&D.log_Error(r.TelemetryEvent.SurveyActivity.SetActivityTrackingContracts.DuplicateSurveyID,"Duplicate surveyId passed in activityTrackingContracts. Duplicate count: "+n)}this.copyObject(this.trackedActivityMap,s)}},e.prototype.clearSurveys=function(){var e=this;Object.getOwnPropertyNames(this.trackedActivityMap).forEach((function(t){delete e.trackedActivityMap[t]}))},e.prototype.saveSessionTrackingActivity=function(e){l[e]=this.trackedActivityMap[e]},e.prototype.getCount=function(e,t){var n=this.getIndexedTracker(e,t);return n?n.tracker.getCount(n.index):0},e.prototype.getSessionCount=function(e,t){var n=this.getIndexedTracker(e,t);return n?n.tracker.getSessionCount(n.index):0},e.prototype.moveSessionCountIntoBaseCount=function(e,t){var n=this.getIndexedTracker(e,t);return n?n.tracker.moveSessionCountIntoBaseCount(n.index):0},e.prototype.getSurveyIds=function(e){if(!s.isNOU(e)){var t=this.trackedActivityMap[e];if(t)return t.map((function(e){return e.surveyId}))}},e.prototype.setCallback=function(e){this.callback=e},e.prototype.UpdateActivityTrackingContracts=function(e){if(s.isNOU(e)||0===Object.keys(e).length)this.clearSurveys();else for(var t in this.trackedActivityMap)if(this.trackedActivityMap.hasOwnProperty(t))for(var n=this.trackedActivityMap[t],i=n.length-1;i>=0;--i)e.hasOwnProperty(n[i].surveyId)||n.splice(i,1)},e.prototype.getIndexedTracker=function(e,t){var n=this.trackedActivityMap[e];if(n){for(var i,r=0,o=n;r<o.length;r++){var a=o[r];if(a.surveyId===t){i=a;break}}return i}},e.prototype.resetQueuedActivities=function(){u=[]},e.prototype.logActivity_private=function(t,n,i,o,a){var s=this;if(this.callback&&!this.callback.shouldAcceptActivity(t)&&(c++,u.length<e.MaxPendingActivitiesQueueSize&&u.push({activityName:t,logType:n,increment:i,timestamp:o})),t===e.FloodgateStartActivityName){if(c>0){var l=u.slice(0,25).map((function(e){return e.activityName})),d=this.loggerCallback&&this.loggerCallback();d&&d.log_Event(r.TelemetryEvent.SurveyActivity.LogActivity.EventsReprocessed,{ActivityNames:JSON.stringify(l),Count:u.length,Dropped:c-u.length},.05),u.map((function(e){return s.logActivity_core(e.activityName,e.logType,e.increment,e.timestamp,a)}))}c=0,this.resetQueuedActivities()}this.logActivity_core(t,n,i,o,a)},e.prototype.logActivity_core=function(e,t,n,i,r){var o=this.trackedActivityMap[e];if(o&&0!==o.length){var a=[];if(o.length>1){a=new Array(o.length);for(var u=0;u<a.length;u++)a[u]=u;a=s.fyShuffle(a)}else a.push(0);for(var c=0,l=a;c<l.length;c++){var d=o[l[c]];switch(t){case 1:d.tracker.startTime(d.index,i);continue;case 2:n=d.tracker.stopTime(d.index,i);case 0:break;default:continue}if(r){var p=d.surveyId;this.activityContext[p]=this.activityContext[p]||[],this.activityContext[p].push({activityName:e,context:r})}if(2===d.tracker.incrementActivity(d.index,n)){this.executeCallback(d.surveyId);break}}}},e.prototype.executeCallback=function(e){this.callback.run(e,this.activityContext[e])},e.prototype.copyObject=function(e,t){Object.keys(t).forEach((function(n){e[n]=t[n]}))},e.FloodgateStartActivityName="FloodgateFirstStart",e.MaxPendingActivitiesQueueSize=100,e}();e.exports=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileBasedCampaignStateProvider=t.HostBasedCampaignStateProvider=t.CampaignStateProviderFactory=t.CampaignState=void 0;var i=n(6),r=n(8),o=n(12),a=n(20),s=n(3),u=i.FileType,c=s.getDistantPast,l=s.isBoolean,d=s.isDate,p=s.isNOU,g=s.isString,h=s.isUtcDatetimeString,v=s.stringToDate,m=function(){function e(e,t,n,i,r,o,a,s,u,c,l,d){if(this.CampaignId=e,this.LastNominationTimeUtc=t,this.LastNominationBuildNumber=n,this.DeleteAfterSecondsWhenStale=i,this.ForceCandidacy=r,this.IsCandidate=o,this.DidCandidateTriggerSurvey=a,this.LastSurveyActivatedTimeUtc=s,this.LastSurveyId=u,this.LastSurveyStartTimeUtc=c,this.LastSurveyExpirationTimeUtc=l,this.LastCooldownEndTimeUtc=d,!this.validate())throw new Error("Constructor arguments are not valid")}return e.deserialize=function(t){var n;if(!t)return null;try{n=new e(t.CampaignId,t.LastNominationTimeUtc,t.LastNominationBuildNumber,t.DeleteAfterSecondsWhenStale,!1,t.IsCandidate,t.DidCandidateTriggerSurvey,t.LastSurveyActivatedTimeUtc,t.LastSurveyId,t.LastSurveyStartTimeUtc,t.LastSurveyExpirationTimeUtc,t.LastCooldownEndTimeUtc)}catch(e){return o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.CampaignState.Deserialize.Failed,{ErrorMessage:e.toString()}),null}return n},e.prototype.validate=function(){if(!this.CampaignId||!g(this.CampaignId))return!1;if(p(this.LastNominationBuildNumber)||!g(this.LastNominationBuildNumber))return!1;if(!s.isNumber(this.DeleteAfterSecondsWhenStale)||this.DeleteAfterSecondsWhenStale<0)return!1;if(!l(this.IsCandidate)||!l(this.DidCandidateTriggerSurvey))return!1;if(this.IsCandidate){if(p(this.LastSurveyStartTimeUtc)||p(this.LastSurveyExpirationTimeUtc))return!1;if(!g(this.LastSurveyId))return!1}if(this.DidCandidateTriggerSurvey&&p(this.LastSurveyActivatedTimeUtc))return!1;if(p(this.LastSurveyId))this.LastSurveyId="";else if(!g(this.LastSurveyId))return!1;if(h(this.LastNominationTimeUtc))this.LastNominationTimeUtc=v(this.LastNominationTimeUtc);else if(!d(this.LastNominationTimeUtc))return!1;if(p(this.LastSurveyActivatedTimeUtc))this.LastSurveyActivatedTimeUtc=c();else if(h(this.LastSurveyActivatedTimeUtc))this.LastSurveyActivatedTimeUtc=v(this.LastSurveyActivatedTimeUtc);else if(!d(this.LastSurveyActivatedTimeUtc))return!1;if(p(this.LastSurveyStartTimeUtc))this.LastSurveyStartTimeUtc=c();else if(h(this.LastSurveyStartTimeUtc))this.LastSurveyStartTimeUtc=v(this.LastSurveyStartTimeUtc);else if(!d(this.LastSurveyStartTimeUtc))return!1;if(p(this.LastSurveyExpirationTimeUtc))this.LastSurveyExpirationTimeUtc=c();else if(h(this.LastSurveyExpirationTimeUtc))this.LastSurveyExpirationTimeUtc=v(this.LastSurveyExpirationTimeUtc);else if(!d(this.LastSurveyExpirationTimeUtc))return!1;if(p(this.LastCooldownEndTimeUtc))this.LastCooldownEndTimeUtc=c();else if(h(this.LastCooldownEndTimeUtc))this.LastCooldownEndTimeUtc=v(this.LastCooldownEndTimeUtc);else if(!d(this.LastCooldownEndTimeUtc))return!1;return!0},e.prototype.markCurrentSurveyTakenOnDate=function(e,t,n){this.DidCandidateTriggerSurvey=n,this.LastSurveyActivatedTimeUtc=null!=e?e:new Date,this.LastCooldownEndTimeUtc=s.addSecondsWithoutOverflow(this.LastSurveyActivatedTimeUtc,t)},e.prototype.getCooldownStartDate=function(){return this.IsCandidate?this.DidCandidateTriggerSurvey?this.LastSurveyActivatedTimeUtc:this.LastSurveyStartTimeUtc:this.LastNominationTimeUtc},e}();t.CampaignState=m;var f=function(){function e(){}return e.make=function(e,t){return t?new S(e,t):new T(e)},e}();t.CampaignStateProviderFactory=f;var y=function(){},S=function(){function e(e,t){if(!t)throw new Error("host-based storage must not be null");this.hostBasedStorage=t,e&&(this.fileBasedStateProvider=new T(e))}return e.prototype.load=function(){var e,t=this.getStatesFromHost();return this.fileBasedStateProvider&&(e=this.fileBasedStateProvider.load()),a.MergeAndUpdateCampaignStates(e,t).find(0)},e.prototype.save=function(e){var t=this;if(e){var n=this.getStatesFromHost(),i=a.MergeAndUpdateCampaignStates(e,n),r=i.find(1),o=i.find(0);r&&r.forEach((function(e){var n=a.makeSettingItemValue(JSON.stringify(e));t.hostBasedStorage.upsertSettingItem(u[u.CampaignStates],e.CampaignId,n)})),this.fileBasedStateProvider&&this.fileBasedStateProvider.save(o)}},e.prototype.getStatesFromHost=function(){var e=[],t=this.hostBasedStorage.readSettingList(u[u.CampaignStates]);for(var n in t)if(t.hasOwnProperty(n)){var i=t[n],s=a.extractSettingItemValueSubString(i),c={};try{c=JSON.parse(s);var l=m.deserialize(c);l&&e.push(l)}catch(e){o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.HostBasedCampaignStateProvider.GetStatesFromHost.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+e.toString()+".  Input:"+s})}}return e},e}();t.HostBasedCampaignStateProvider=S;var T=function(){function e(e){if(!e)throw new Error("storage must not be null");this.storage=e}return e.prototype.load=function(){var e,t=this.storage.read(u.CampaignStates);if(!t)return[];try{e=JSON.parse(t);var n=[];return e&&e.CampaignStates&&e.CampaignStates.forEach((function(e){var t=m.deserialize(e);t&&n.push(t)})),n}catch(e){return o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.FileBasedCampaignStateProvider.Load.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+e.toString()+".  Input:"+t}),[]}},e.prototype.save=function(e){if(e){var t=new y;t.CampaignStates=e;var n=JSON.stringify(t);this.storage.write(u.CampaignStates,n)}},e}();t.FileBasedCampaignStateProvider=T},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SurveyActivationStats=t.FileBasedSurveyActivationStatsProvider=t.HostBasedSurveyActivationStatsProvider=t.SurveyActivationStatsProviderFactory=t.SurveyStatCollectionActivation=void 0;var o=n(6),a=o.FileType,s=n(10),u=n(8),c=n(12),l=n(20),d=n(27),p=n(3),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromJson=function(e){var n,i=new t;if(!e)return c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.SurveyStatCollectionActivation.FromJson.Failed,{ErrorMessage:"Input json is null or empty."}),i;try{n=JSON.parse(e)}catch(e){return c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.SurveyStatCollectionActivation.FromJson.Failed,{ErrorMessage:"Json parsing failed. "+e.toString()}),i}return i.deserialize(n)?i:new t},t.toJson=function(e){return e||(c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.SurveyStatCollectionActivation.ToJson.Failed,{ErrorMessage:"Input json is null or empty."}),e=new t),JSON.stringify(e)},t.prototype.accumulate=function(e){if(e){var t=e.getStats();for(var n in t)t.hasOwnProperty(n)&&this.addStats(n,t[n])}},t.prototype.deserialize=function(e){var t=e.Surveys,n=new Date;for(var i in t)if(t.hasOwnProperty(i)){var r=new f;r.deserialize(t[i])&&r.ExpirationTimeUtc>n&&this.addStats(i,r)}return this.validate()},t.prototype.validate=function(){return p.isObject(this.getStats())},t}(d.SurveyStatCollection);t.SurveyStatCollectionActivation=g;var h=function(){function e(){}return e.make=function(e,t){return t?new v(e,t):new m(e)},e}();t.SurveyActivationStatsProviderFactory=h;var v=function(){function e(e,t){if(!t)throw new Error("host-based storage must not be null");this.hostBasedStorage=t,e&&(this.fileBasedStorageProvider=new m(e))}return e.prototype.load=function(){var e=this.getSurveyStatsFromHost(),t=new g;return this.fileBasedStorageProvider&&(t=this.fileBasedStorageProvider.load()),l.MergeAndUpdateSurveyActivationStats(t,e).find(0)},e.prototype.save=function(e){if(e){var t=this.getSurveyStatsFromHost(),n=l.MergeAndUpdateSurveyActivationStats(e,t),i=n.find(1),r=n.find(0);if(i){var o=i.getStats();for(var s in o)if(o.hasOwnProperty(s)){var u=l.makeSettingItemValue(JSON.stringify(o[s]));this.hostBasedStorage.upsertSettingItem(a[a.SurveyActivationStats],s,u)}}this.fileBasedStorageProvider&&this.fileBasedStorageProvider.save(r)}},e.prototype.getSurveyStatsFromHost=function(){var e=new g,t=this.hostBasedStorage.readSettingList(a[a.SurveyActivationStats]),n=new Date;for(var i in t)if(t.hasOwnProperty(i)){var r=l.extractSettingItemValueSubString(t[i]),o=new f;try{var s=JSON.parse(r);o.deserialize(s)}catch(e){c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.HostBasedSurveyActivationStatsProvider.GetSurveyStatsFromHost.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+e.toString()+".  Input:"+r})}o.ExpirationTimeUtc<=n?this.hostBasedStorage.deleteSettingItem(a[a.SurveyActivationStats],i):e.addStats(i,o)}return e},e}();t.HostBasedSurveyActivationStatsProvider=v;var m=function(){function e(e){if(!e)throw new Error("storage must not be null");this.storage=e}return e.prototype.load=function(){var e=this.storage.read(o.FileType.SurveyActivationStats);return e?g.fromJson(e):new g},e.prototype.save=function(e){if(e){var t=g.toJson(e);this.storage.write(o.FileType.SurveyActivationStats,t)}},e}();t.FileBasedSurveyActivationStatsProvider=m;var f=function(){function e(){this.SurveyLaunchCount=0,this.SurveyLaunchCountPerSession=0}return e.prototype.deserialize=function(e){var t,n;return this.ActivationTimeUtc=e.ActivationTimeUtc,this.ExpirationTimeUtc=e.ExpirationTimeUtc,this.Type=e.Type,this.SurveyLaunchCount=null!==(t=e.SurveyLaunchCount)&&void 0!==t?t:0,this.SurveyLaunchCountPerSession=null!==(n=e.SurveyLaunchCountPerSession)&&void 0!==n?n:0,this.validate()},e.prototype.validate=function(){return!!p.isUtcDatetimeString(this.ActivationTimeUtc)&&(this.ActivationTimeUtc=p.stringToDate(this.ActivationTimeUtc),!!p.isUtcDatetimeString(this.ExpirationTimeUtc)&&(this.ExpirationTimeUtc=p.stringToDate(this.ExpirationTimeUtc),!(!p.isNumber(this.SurveyLaunchCount)||!p.isNumber(this.SurveyLaunchCountPerSession))&&p.isEnumValue(this.Type,s.Type)))},e}();t.SurveyActivationStats=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SurveyStatCollection=void 0;var i=function(){function e(){this.Surveys={},this.Surveys={}}return e.prototype.addStats=function(e,t){this.Surveys[e]=t},e.prototype.getBySurveyId=function(e){return this.Surveys[e]},e.prototype.getStats=function(){return this.Surveys},e}();t.SurveyStatCollection=i},function(e,t,n){"use strict";var i=n(11),r=function(){function e(e){if(!e)throw new Error("data must not be null");if(!e.customerVoiceFormId)throw new Error("data.formID must not be null or empty");this.data=e}return e.make=function(t){try{return new e(t)}catch(e){return null}},e.prototype.getType=function(){return"CVSurvey"},e.prototype.getFormId=function(){return this.data.customerVoiceFormId},e.prototype.getDomElements=function(e){if(!e)throw new Error("Document must not be null");return[e.createElement(i.DOM_CVSURVEY_TAGNAME)]},e.prototype.getJsonElements=function(){var e={};return e[i.JSON_CVSURVEY_KEYNAME]=this.getFormId(),e},e.prototype.getComponentJson=function(){var e;return(e={})[i.JSON_CVSURVEYFORMID_KEYNAME]=this.getFormId(),e},e}();!function(e){var t=function(){};e.CVSurveyComponentData=t}(r||(r={})),e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileBasedGovernedChannelStateProvider=t.HostBasedGovernedChannelStateProvider=t.GovernedChannelStateProviderFactory=t.GovernedChannelState=void 0;var i=n(6),r=n(8),o=n(12),a=n(9),s=n(20),u=n(3),c=i.FileType,l=function(){function e(e,t){if(this.ChannelType=e,this.CooldownStartTimeUtc=t,!this.validate())throw new Error("Constructor arguments are not valid")}return e.deserialize=function(t){var n;if(!t)return null;try{n=new e(t.ChannelType,t.CooldownStartTimeUtc)}catch(e){return o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.GovernedChannelState.Deserialize.Failed,{ErrorMessage:e.toString()}),null}return n},e.prototype.validate=function(){return!!u.isEnumValue(this.ChannelType,a.GovernedChannelType)&&(u.isUtcDatetimeString(this.CooldownStartTimeUtc)?this.CooldownStartTimeUtc=u.stringToDate(this.CooldownStartTimeUtc):!u.isNOU(this.CooldownStartTimeUtc)&&u.isDate(this.CooldownStartTimeUtc)||(this.CooldownStartTimeUtc=u.getDistantPast()),!0)},e.prototype.getType=function(){return this.ChannelType},e.prototype.getCooldownStartTime=function(){return this.CooldownStartTimeUtc},e}();t.GovernedChannelState=l;var d=function(){function e(){}return e.make=function(e,t){return t?new g(e,t):new h(e)},e}();t.GovernedChannelStateProviderFactory=d;var p=function(){},g=function(){function e(e,t){if(!t)throw new Error("host-based storage must not be null");this.hostBasedStorage=t,e&&(this.fileBasedStateProvider=new h(e))}return e.prototype.load=function(){var e,t=this.getStatesFromHost();return this.fileBasedStateProvider&&(e=this.fileBasedStateProvider.load()),s.MergeAndUpdateGovernedChannelStates(e,t).find(0)},e.prototype.save=function(e){var t=this;if(e){var n=this.getStatesFromHost(),i=s.MergeAndUpdateGovernedChannelStates(e,n),r=i.find(1),o=i.find(0);r&&r.forEach((function(e){var n=s.makeSettingItemValue(JSON.stringify(e));t.hostBasedStorage.upsertSettingItem(c[c.GovernedChannelStates],String(e.getType()),n)})),this.fileBasedStateProvider&&this.fileBasedStateProvider.save(o)}},e.prototype.getStatesFromHost=function(){var e=[],t=this.hostBasedStorage.readSettingList(c[c.GovernedChannelStates]);for(var n in t)if(t.hasOwnProperty(n)){var i=t[n],a=s.extractSettingItemValueSubString(i),u={};try{u=JSON.parse(a);var d=l.deserialize(u);d&&e.push(d)}catch(e){o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.HostBasedGovernedChannelStateProvider.GetStatesFromHost.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+e.toString()+".  Input:"+a})}}return e},e}();t.HostBasedGovernedChannelStateProvider=g;var h=function(){function e(e){if(!e)throw new Error("storage must not be null");this.storage=e}return e.prototype.load=function(){var e,t=this.storage.read(c.GovernedChannelStates);if(!t)return[];try{e=JSON.parse(t);var n=[];return e&&e.ChannelStates&&e.ChannelStates.forEach((function(e){var t=l.deserialize(e);t&&n.push(t)})),n}catch(e){return o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.FileBasedGovernedChannelStateProvider.Load.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+e.toString()+".  Input:"+t}),[]}},e.prototype.save=function(e){if(e){var t=new p;t.ChannelStates=e;var n=JSON.stringify(t);this.storage.write(c.GovernedChannelStates,n)}},e}();t.FileBasedGovernedChannelStateProvider=h},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SurveyEventActivityStats=t.SurveyStatCollectionEventActivity=void 0;var o=n(8),a=n(12),s=n(27),u=n(3),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromJson=function(e){var n,i=new t;if(!e)return i;try{n=JSON.parse(e)}catch(e){return a.FloodgateEngine.getTelemetryLogger().log_Event(o.TelemetryEvent.SurveyStatCollectionEventActivity.FromJson.Failed,{ErrorMessage:"Json parsing failed. "+e.toString()}),i}return i.deserialize(n)?i:new t},t.toJson=function(e){return e||(a.FloodgateEngine.getTelemetryLogger().log_Event(o.TelemetryEvent.SurveyStatCollectionEventActivity.ToJson.Failed,{ErrorMessage:"Input json is null or empty."}),e=new t),JSON.stringify(e)},t.prototype.accumulate=function(e){if(e){var t=e.getStats();for(var n in t)if(t.hasOwnProperty(n)){var i=this.getBySurveyId(n);if(i||((i=new l).Counts=[],this.addStats(n,i)),i.ExpirationTimeUtc=t[n].ExpirationTimeUtc,i.Counts.length<t[n].Counts.length){var r=i.Counts.slice();i.Counts=r}for(var o=0;o<t[n].Counts.length;o++)i.Counts[o]||(i.Counts[o]=0),i.Counts[o]+=t[n].Counts[o]}}},t.prototype.deserialize=function(e){var t=e.Surveys,n=new Date;for(var i in t)if(t.hasOwnProperty(i)){var r=new l;r.deserialize(t[i])&&r.ExpirationTimeUtc>n&&this.addStats(i,r)}return this.validate()},t.prototype.validate=function(){return u.isObject(this.getStats())},t}(s.SurveyStatCollection);t.SurveyStatCollectionEventActivity=c;var l=function(){function e(){}return e.prototype.deserialize=function(e){return this.ExpirationTimeUtc=e.ExpirationTimeUtc,this.Counts=e.Counts,this.validate()},e.prototype.validate=function(){if(!this.Counts)return!1;for(var e=0;e<this.Counts.length;e++){var t=this.Counts[e];if(!u.isNumber(t))return!1;t<0&&(this.Counts[e]=0)}return!!u.isUtcDatetimeString(this.ExpirationTimeUtc)&&(this.ExpirationTimeUtc=u.stringToDate(this.ExpirationTimeUtc),!0)},e}();t.SurveyEventActivityStats=l},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));let i=["af","am","ar","as","az","be","bg","bn-BD","bn-IN","bs","ca","ca-Es-VALENCIA","chr-Cher","cs","cy","da","de","el","en-GB","es","es-MX","et","eu","fa","fi","fil","fr","fr-CA","ga","gd","gl","gu","ha-Latn-NG","he","hi","hr","hu","hy","id","is","it","ja","ka","kk","km-KH","kn","ko","kok","ky","lb","lo","lt","lv","mi","mk","ml","mn","mr","ms","mt","nb-NO","ne","nl","nn-NO","or","pa","pl","prs","pt-BR","pt-PT","quz","ro","ru","sd","si","sk","sl","sq","sr-Cyrl-BA","sr-Cyrl-RS","sr-Latn-RS","sv","sw","ta","te","th","tk","tr","tt","ug","uk","ur","uz-Latn-UZ","vi","zh-Hans","zh-Hant"];const r={"ZH-CN":"zh-Hans","ZH-HK":"zh-Hant","ZH-MO":"zh-Hant","ZH-SG":"zh-Hans","ZH-TW":"zh-Hant"};function o(e){let t=e.toLocaleUpperCase();if(t in r)return r[t];for(let e of i)if(e.toUpperCase()===t)return e;let n=t.split("-")[0];for(let e of i)if(e.toUpperCase()===n)return e;return"en"}},function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.ItemChanges=t.ItemOperation=void 0,r(n(57),t);var o=n(58);Object.defineProperty(t,"ItemOperation",{enumerable:!0,get:function(){return o.ItemOperation}}),Object.defineProperty(t,"ItemChanges",{enumerable:!0,get:function(){return o.ItemChanges}}),r(n(59),t),r(n(60),t),r(n(61),t),r(n(62),t),r(n(63),t),r(n(17),t),r(n(64),t),r(n(65),t)},function(e,t,n){"use strict";var i;!function(e){var t=function(){function e(){}return e.AppLaunch="AppLaunch",e.AppUsageTime="AppUsageTime",e.AppResume="AppResume",e}();e.ActivityName=t}(i||(i={})),e.exports=i},function(e,t,n){"use strict";var i;!function(e){e.RoamingSettingIdMap={CampaignStates:1258,GovernedChannelStates:1257,SurveyActivationStats:1259}}(i||(i={})),e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CampaignManager=void 0;var i=n(12),r=n(3),o=n(13),a=n(25),s=n(37),u=n(8),c=n(19),l=r.getDistantFuture,d=r.getDistantPast,p=r.isArray,g=r.isNOU,h=function(){function e(e,t,n,i,r,o,a){if(!e)throw new Error("stateProvider must not be null");if(!p(t))throw new Error("definitionProviders is either null or not an array type");if(!n)throw new Error("stringProvider must not be null");if(g(r))throw new Error("currentBuildNumber must not be null");this.campaignStates={},this.campaignDefinitions={},this.userFacts=[],this.stateProvider=e,this.definitionProviders=t,this.stringProvider=n,this.userFactsProvider=a,this.environmentProvider=i,this.currentBuildNumber=r,o=o||new Date}return e.isStateUpForNomination=function(t,n,i,r){if(!t||!n)return!1;if(i=i||new Date,t.ForceCandidacy)return!0;var o=n.nominationScheme.getCampaignCooldown(t.IsCandidate&&t.DidCandidateTriggerSurvey);return!!o&&(!!e.hasBuildChangeDurationElapsed(o,t.LastNominationBuildNumber,r)||e.hasTimeIntervalDurationElapsed(o,t.getCooldownStartDate(),i))},e.isDateInRange=function(e,t,n){return e=e||new Date,t=t||d(),n=n||l(),t.getTime()<=e.getTime()&&n.getTime()>=e.getTime()},e.hasTimeIntervalDurationElapsed=function(e,t,n){if(g(e)||!(e instanceof o.CampaignDurationTimeInterval))return!1;if(!t||!n)return!1;var i=r.addSecondsWithoutOverflow(t,e.intervalSeconds);return n.getTime()>=i.getTime()},e.hasBuildChangeDurationElapsed=function(e,t,n){return!g(e)&&e instanceof o.CampaignDurationSingleBuildChange&&(g(t)||g(n)?null===t!=(null===n):!(t===n))},e.isCampaignInScope=function(t,n,i,r){return!!t&&(n=n||new Date,!!e.isDateInRangeWithDefinition(n,t)&&!(t.scope&&((t.scope instanceof o.CampaignScopeUserFactAny||t.scope instanceof o.CampaignScopeUserFactAll)&&t.scope.setUserFactsProvider(r),t.scope instanceof o.CampaignScopeEnvironmentCrossProduct&&t.scope.setEnvironmentProvider(i),!t.scope.isInScope())))},e.isDateInRangeWithDefinition=function(t,n){return!!n&&(t=t||new Date,e.isDateInRange(t,n.startTime?n.startTime:l(),n.endTime))},e.prototype.getActiveSurveys=function(){var e={},t=this.getPrioritizedCampaigns();for(var n in this.campaignStates)if(this.campaignStates.hasOwnProperty(n)){var i=this.campaignStates[n];if(!i.IsCandidate)continue;var r=t[i.CampaignId];if(!r)continue;var o=s.CampaignSurveyFactory.makeSurvey(i,r,this.stringProvider);if(!o)continue;e[o.getSurveyInfo().getId()]=o}return e},e.prototype.onCampaignSurveyActivated=function(e,t,n){var i=this.campaignStates[e];if(i){t=t||new Date;var r=this.campaignDefinitions[e].nominationScheme.cooldownPeriod.asTimeIntervalSeconds();i.markCurrentSurveyTakenOnDate(t,r,n),this.saveCurrentState()}},e.prototype.getCampaignStates=function(){return this.campaignStates},e.prototype.getCampaignDefinitions=function(){return this.campaignDefinitions},e.prototype.getUserFacts=function(){return this.userFacts},e.prototype.onSurveyActivated=function(e,t){e&&this.onCampaignSurveyActivated(e.getBackEndId(),new Date,t)},e.prototype.refreshSurveyDefinitions=function(e,t){this.refreshSurveyDefinitionsPrivate(e,t||new Date)},e.prototype.refreshSurveyDefinitionsAsync=function(e,t){var n=this;return new Promise((function(i,r){n.refreshSurveyDefinitionsPrivateAsync(e,t||new Date).then((function(){i()})).catch((function(e){r(e)}))}))},e.prototype.getAppSurveys=function(){return this.getActiveSurveys()},e.prototype.saveCurrentState=function(){var e=r.makeArrayFromObjectValuesSortedByKeyString(this.campaignStates);this.stateProvider.save(e)},e.prototype.refreshSurveyDefinitionsPrivate=function(e,t){this.campaignStates={},this.campaignDefinitions={},this.userFacts=[],this.loadAndFilterCampaignData(t,e),this.evaluateCampaigns(t)},e.prototype.refreshSurveyDefinitionsPrivateAsync=function(e,t){this.campaignStates={},this.campaignDefinitions={},this.userFacts=[];var n=this;return new Promise((function(i,r){n.loadAndFilterCampaignDataAsync(t,e).then((function(){n.evaluateCampaigns(t),i()})).catch((function(e){r(e)}))}))},e.prototype.loadAndFilterCampaignDataAsync=function(e,t){e=e||new Date;for(var n=[],r=[],o=this.userFactsProvider&&this.userFactsProvider.loadAsync(),a=0,s=Object.keys(this.definitionProviders);a<s.length;a++){var c=s[a],l=this.definitionProviders[c],d=l&&l.loadAsync();g(d)||(d=d.catch((function(){i.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed("Failed to load from campaign definition provider"),Promise.resolve()})),r.push(d))}var h=this;return new Promise((function(a,s){Promise.all(r).then((function(r){for(var s=0,c=Object.keys(r);s<c.length;s++){var l=r[c[s]];p(l)&&(n=n.concat(l))}var d=function(i){h.userFacts=i||[],h.FilterCampaignData(e,t,n),a()};g(o)?d():o.then((function(e){d(e)})).catch((function(){i.FloodgateEngine.getTelemetryLogger().log_Error(u.TelemetryEvent.Floodgate.UserFactsLoad.Failed,"Failed to load from user facts provider"),d()}))})).catch((function(e){i.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed("Failed to load from campaign definition provider")}))}))},e.prototype.loadAndFilterCampaignData=function(e,t){e=e||new Date;for(var n=[],r=0,o=Object.keys(this.definitionProviders);r<o.length;r++){var a=o[r];try{var s=this.definitionProviders[a]&&this.definitionProviders[a].load();p(s)&&(n=n.concat(s))}catch(e){i.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed("Failed to load from campaign definition provider. "+e.toString())}}try{this.userFacts=this.userFactsProvider&&this.userFactsProvider.load()||[]}catch(e){i.FloodgateEngine.getTelemetryLogger().log_Error(u.TelemetryEvent.Floodgate.UserFactsLoad.Failed,"Failed to load from user facts provider. "+e)}this.FilterCampaignData(e,t,n)},e.prototype.FilterCampaignData=function(t,n,i){var o={};for(var a in i)if(i.hasOwnProperty(a)){if(o[(d=i[a]).campaignId]=d,n&&n.indexOf(d.governedChannelType)<0&&d.businessLevel!==c.BusinessLevel.Critical)continue;if(!e.isCampaignInScope(d,t,this.environmentProvider,this.userFactsProvider))continue;this.campaignDefinitions[d.campaignId]=d}var s=this.stateProvider.load(),u=[];for(var a in s)if(s.hasOwnProperty(a)){var l=s[a];this.campaignDefinitions.hasOwnProperty(l.CampaignId)||u.push(l),this.campaignStates[l.CampaignId]=l}for(var a in u)if(u.hasOwnProperty(a)){if(!(l=u[a]))continue;var d,p=!1;(d=o[l.CampaignId])?e.isStateUpForNomination(l,d,t,this.currentBuildNumber)&&(p=!0):l.LastNominationTimeUtc.getTime()<=r.subtractSecondsWithoutOverflow(t,l.DeleteAfterSecondsWhenStale).getTime()&&(p=!0),p&&delete this.campaignStates[l.CampaignId]}},e.prototype.getPrioritizedCampaigns=function(){var e=this,t={},n={};return Object.keys(this.campaignDefinitions||[]).forEach((function(i){var r=e.campaignDefinitions[i];t[i]=r,(r.tags&&r.tags.length>0?r.tags:[""]).forEach((function(e){var t=e+"_"+r.governedChannelType;n[t]=n[t]||[],n[t].push(r)}))})),Object.keys(n).forEach((function(e){var i=n[e];if(!(i.length<=1)){var r=i.reduce((function(e,t){return(t.primaryPriority||0)<(e.primaryPriority||0)?t:e}),i[0]).primaryPriority;g(r)||i.forEach((function(e){var n=e.primaryPriority;!g(e.primaryPriority)&&n>r&&delete t[e.campaignId]}))}})),t},e.prototype.evaluateCampaigns=function(t){for(var n in t=t||new Date,this.campaignDefinitions)if(this.campaignDefinitions.hasOwnProperty(n)){var i=this.campaignDefinitions[n],o=this.campaignStates[i.campaignId];if(!o||e.isStateUpForNomination(o,i,t,this.currentBuildNumber)){var s=o?o.LastSurveyId:"",u=o?o.LastSurveyStartTimeUtc:d(),c=o?o.LastSurveyExpirationTimeUtc:d(),l=o?o.LastSurveyActivatedTimeUtc:d(),p=o?o.LastCooldownEndTimeUtc:d(),g=o&&o.ForceCandidacy||i.nominationScheme.evaluateNominationRules();g&&(s=r.guid(),u=i.nominationScheme.calculateSurveyStartTimeFromDate(t),c=i.nominationScheme.calculateSurveyExpirationTimeFromSurveyStartTime(u));var h=new a.CampaignState(i.campaignId,t,this.currentBuildNumber,i.nominationScheme.getActiveSurveyTimeIntervalSeconds(),!1,g,!1,l,s,u,c,p);this.campaignStates[h.CampaignId]=h}}},e}();t.CampaignManager=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CampaignSurveyFactory=void 0;var i=n(10),r=n(38),o=n(41),a=n(42),s=n(44),u=n(45),c=n(47),l=n(48),d=n(15),p=n(3),g=n(13),h=p.dateToShortUtcString,v=p.isNOU,m=function(){function e(){}return e.makeSurvey=function(t,n,i){if(!(t&&n&&n.surveyTemplate&&i))return null;var r=e.makeSurveyDataSourceData(t,n),o=n.surveyTemplate;return o instanceof g.CampaignSurveyTemplateNps5PointStatic?l.make5Point(r,i):o instanceof g.CampaignSurveyTemplateNps11PointStatic?l.make11Point(r,i):o instanceof g.CampaignSurveyTemplateFps?a.makeFps(r,i,o):o instanceof g.CampaignSurveyTemplateNlqs?c.makeNlqs(r,i,o):o instanceof g.CampaignSurveyTemplateNps?l.makeCustom(r,i,o):o instanceof g.CampaignSurveyTemplateGenericMessagingSurface?s.makeCustom(r):o instanceof g.CampaignSurveyTemplateIntercept?u.makeIntercept(r,i,o):null},e.makeSurveyDataSourceData=function(t,n){if(!t||!n||!n.surveyTemplate)return null;var r=n.surveyTemplate,o=new d.SurveyDataSourceData;return o.activationEvent=e.makeEvent(t,r.activationEvent),o.metadata=e.makeMetadata(r.metadata),o.id=t.LastSurveyId,o.backEndIdentifier=t.CampaignId,o.expirationTimeUtc=h(t.LastSurveyExpirationTimeUtc),o.governedChannelType=n.governedChannelType,o.startTimeUtc=h(t.LastSurveyStartTimeUtc),o.additionalDataRequested=n.additionalDataRequested||[],o.launcherType=n.launcherType||i.LAUNCHER_TYPE_DEFAULT,o.preferredLaunchType=n.surveyTemplate.preferredLaunchType||"Default",o.businessLevel=n.businessLevel,v(r.maxLaunches)||(o.maxLaunches=r.maxLaunches),v(r.maxLaunchesPerSession)||(o.maxLaunchesPerSession=r.maxLaunchesPerSession),o},e.makeCountedActivityEventData=function(e){if(!e)return null;var t=new r.CountedActivityEventData;return t.activity=e.activity,t.count=e.count,t.isAggregate=e.isAggregate,t},e.makeCountedActivityEvent=function(t,n){if(!t||!n)return null;var i=e.makeCountedActivityEventData(n);return i?new r.CountedActivityEvent(i):null},e.makeCountedActivitySequenceEvent=function(t,n){if(!t||!n)return null;var i=new r.CountedActivitySequenceEventData;i.sequence=[];for(var o=0,a=n.sequence;o<a.length;o++){var s=a[o],u=e.makeCountedActivityEventData(s);if(!u)return null;i.sequence.push(u)}return new r.CountedActivitySequenceEvent(i)},e.makeEvent=function(t,n){return n instanceof g.CampaignSurveyEventCountedActivity?e.makeCountedActivityEvent(t,n):n instanceof g.CampaignSurveyEventCountedActivitySequence?e.makeCountedActivitySequenceEvent(t,n):null},e.makeMetadata=function(e){if(v(e)||v(e.contentMetadata))return null;var t=new o.Metadata;return t.contentMetadata=e.contentMetadata,new o.SurveyMetadata(t)},e}();t.CampaignSurveyFactory=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CountedActivitySequenceEventData=t.CountedActivitySequenceEvent=t.CountedActivityEventData=t.CountedActivityEvent=void 0;var i=n(39),r=n(40),o=function(){function e(e){if(!e)throw new Error("data must not be null");if(e.count<=0)throw new Error("count must be greater than 0");if(!e.activity||0===e.activity.length)throw new Error("activity must not be null or an empty string");this.data=e}return e.make=function(t){try{return new e(t)}catch(e){return null}},e.prototype.getActivity=function(){return this.data.activity},e.prototype.getCount=function(){return this.data.count},e.prototype.isAggregate=function(){return this.data.isAggregate},e.prototype.getType=function(){return"CountedActivity"},e.prototype.getTrackingSet=function(){var e=new Array;return e.push(new i.ActivityTrackingData(this.data.activity,this.data.count,this.data.isAggregate)),new r.ActivityTrackingSet(!1,e)},e}();t.CountedActivityEvent=o;var a=function(){};t.CountedActivityEventData=a;var s=function(){function e(e){if(!e)throw new Error("data must not be null");if(!e.sequence)throw new Error("data.sequence must not be null");if(0===e.sequence.length)throw new Error("data.sequence size must be greater than 0");this.data=[];for(var t=0,n=e.sequence;t<n.length;t++){var i=n[t];this.data.push(new o(i))}}return e.make=function(t){try{return new e(t)}catch(e){return null}},e.prototype.getSequence=function(){return this.data},e.prototype.getType=function(){return"CountedActivitySequence"},e.prototype.getTrackingSet=function(){for(var e=new Array,t=0,n=this.data;t<n.length;t++){var o=n[t];e.push(new i.ActivityTrackingData(o.getActivity(),o.getCount(),o.isAggregate()))}return new r.ActivityTrackingSet(!0,e)},e}();t.CountedActivitySequenceEvent=s;var u=function(){function e(){}return e.prototype.CountedActivitySequenceEventData=function(){},e}();t.CountedActivitySequenceEventData=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActivityTrackingData=void 0;var i=function(){function e(e,t,n){this.activity=e,this.count=t,this.isAggregate=n}return e.prototype.getActivity=function(){return this.activity},e.prototype.getCount=function(){return this.count},e.prototype.setCount=function(e){this.count=e},e.prototype.getIsAggregate=function(){return this.isAggregate},e}();t.ActivityTrackingData=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActivityTrackingSet=void 0;var i=n(3),r=function(){function e(e,t){this.isOrdered=e,this.list=t}return e.prototype.getIsOrdered=function(){return this.isOrdered},e.prototype.getList=function(){return this.list},e.prototype.getActivityTrackingInfo=function(e,t){var n;if(0===this.list.length)return n={Activities:[],IsListOrdered:this.isOrdered},JSON.stringify(n);for(var r=0,o=this.list;r<o.length;r++){var a=o[r],s=e.getCount(a.getActivity(),t),u={Activity:a.getActivity(),ActualCount:s,Count:a.getCount(),IsAggregate:a.getIsAggregate(),IsDiscrete:s%1==0};i.isNOU(n)?n={Activities:[u],IsListOrdered:this.isOrdered}:n.Activities.push(u)}return JSON.stringify(n)},e}();t.ActivityTrackingSet=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=t.SurveyMetadata=void 0;var i=n(3),r=function(){function e(e){if(!e)throw new Error("data must not be null");if(!e.contentMetadata)throw new Error("content metadata must not be null");if(!i.isObject(e.contentMetadata))throw new Error("content metadata must be of object type");this.data=e}return e.make=function(t){try{return new e(t)}catch(e){return null}},e.prototype.getContentMetadata=function(){return this.data.contentMetadata},e}();t.SurveyMetadata=r;var o=function(){};t.Metadata=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=n(10),a=n(11),s=n(21),u=n(28),c=n(43),l=n(22),d=n(23),p=n(3),g=n(16),h=n(15),v=p.isNOU,m=function(e){function t(t){var n=e.call(this)||this;if(v(t))throw new Error("data must not be null");return n.surveyInfo=new h(t.baseData),n.prompt=new l(t.promptData),n.question=t.commentData?new s(t.commentData):null,n.rating=t.ratingData?new d(t.ratingData):null,n.multipleChoice=t.multipleChoiceData?new c(t.multipleChoiceData):null,n.cvSurvey=t.cvSurveyData?new u(t.cvSurveyData):null,n}return r(t,e),t.make=function(e){try{return new t(e)}catch(e){return null}},t.makeFps=function(e,n,i){if(v(e)||v(n)||v(i))return null;var r=[],o=[],a=i.content;if(v(a)||v(a.prompt)||v(a.rating)&&v(a.multipleChoice)&&v(a.comment))return null;var p=new t.FpsSurveyData;if(p.baseData=e,p.promptData=new l.PromptComponentData,p.promptData.title=n.getCustomString(a.prompt.title),p.promptData.question=n.getCustomString(a.prompt.question),p.promptData.yesButtonLabel=n.getCustomString(a.prompt.yesLabel),p.promptData.noButtonLabel=n.getCustomString(a.prompt.noLabel),v(p.promptData.title)||v(p.promptData.question)||v(p.promptData.yesButtonLabel)||v(p.promptData.noButtonLabel))return null;if(a.rating){p.ratingData=new d.RatingComponentData,p.ratingData.question=n.getCustomString(a.rating.question),p.ratingData.isZeroBased=a.rating.isZeroBased;for(var g=0,h=a.rating.ratingValuesAscending;g<h.length;g++){var m=h[g],f=n.getCustomString(m);if(v(f))return null;r.push(f)}if(p.ratingData.ratingValuesAscending=r,v(p.ratingData.question)||v(p.ratingData.ratingValuesAscending))return null}if(a.multipleChoice){p.multipleChoiceData=new c.MultipleChoiceComponentData,p.multipleChoiceData.question=n.getCustomString(a.multipleChoice.question),p.multipleChoiceData.minNumberOfSelectedOptions=a.multipleChoice.minNumberOfSelectedOptions,p.multipleChoiceData.maxNumberOfSelectedOptions=a.multipleChoice.maxNumberOfSelectedOptions;for(var y=0,S=a.multipleChoice.availableOptions;y<S.length;y++){m=S[y],f=n.getCustomString(m);if(v(f))return null;o.push(f)}if(p.multipleChoiceData.availableOptions=o,v(p.multipleChoiceData.question)||v(p.multipleChoiceData.availableOptions))return null}return a.comment&&(p.commentData=new s.CommentComponentData,p.commentData.question=n.getCustomString(a.comment.question),v(p.commentData.question))||a.cvSurvey&&(p.cvSurveyData=new u.CVSurveyComponentData,p.cvSurveyData.customerVoiceFormId=a.cvSurvey.customerVoiceFormId,v(p.cvSurveyData.customerVoiceFormId))?null:this.make(p)},t.prototype.getType=function(){return o.Type.Fps},t.prototype.getSurveyInfo=function(){return this.surveyInfo},t.prototype.getCommentComponent=function(){return this.question},t.prototype.getPromptComponent=function(){return this.prompt},t.prototype.getRatingComponent=function(){return this.rating},t.prototype.getMultipleChoiceComponent=function(){return this.multipleChoice},t.prototype.getCVSurveyComponent=function(){return this.cvSurvey},t.prototype.getComponent=function(e){switch(e){case"Comment":return this.getCommentComponent();case"Prompt":return this.getPromptComponent();case"Rating":return this.getRatingComponent();case"MultipleChoice":return this.getMultipleChoiceComponent();case"CVSurvey":return this.getCVSurveyComponent();default:return null}},t.prototype.getDomElements=function(e){if(v(e))throw new Error("Document must not be null");var t=e.createElement(o.DOM_FPS_TAGNAME);return this.getSurveyInfo().getDomElements(e).forEach((function(e){v(e)||t.appendChild(e)})),this.getCommentComponent().getDomElements(e).forEach((function(e){v(e)||t.appendChild(e)})),this.getRatingComponent()&&this.getRatingComponent().getDomElements(e).forEach((function(e){v(e)||t.appendChild(e)})),this.getMultipleChoiceComponent()&&this.getMultipleChoiceComponent().getDomElements(e).forEach((function(e){v(e)||t.appendChild(e)})),[t]},t.prototype.getJsonElements=function(){var e,t={};return(t=p.overrideValues(this.getSurveyInfo().getJsonElements(),t))[a.JSON_APPLICATION_KEYNAME]={},t[a.JSON_APPLICATION_KEYNAME][a.JSON_EXTENDEDMANIFESTDATA_KEYNAME]=JSON.stringify(((e={})[a.JSON_SURVEYSTRINGS_KEYNAME]=this.makeSurveyStrings(),e[a.JSON_SURVEYSPECIFICDATA_KEYNAME]=this.makeResponseString(),e)),t},t.prototype.makeResponseString=function(){var e={};return this.question&&(e[a.JSON_COMMENT_KEYNAME]=[this.getCommentComponent().getSubmittedText()]),this.multipleChoice&&(e[a.JSON_MULTIPLECHOICE_KEYNAME]=[this.getMultipleChoiceComponent().getOptionSelectedStates()]),this.rating&&(e[a.JSON_RATING_KEYNAME]=[{numberOfOptions:this.getRatingComponent().getRatingValuesAscending().length,selectedRating:this.getRatingComponent().getSelectedRatingIndex()}]),JSON.stringify(e)},t.prototype.makeSurveyStrings=function(){var e={};return this.prompt&&(e[a.JSON_PROMPT_KEYNAME]=this.prompt.getComponentJson()),this.rating&&(e[a.JSON_RATING_KEYNAME]=[this.rating.getComponentJson()]),this.question&&(e[a.JSON_COMMENT_KEYNAME]=[this.question.getComponentJson()]),this.multipleChoice&&(e[a.JSON_MULTIPLECHOICE_KEYNAME]=[this.multipleChoice.getComponentJson()]),JSON.stringify(e)},t}(g.Survey);!function(e){var t=function(){};e.FpsSurveyData=t}(m||(m={})),e.exports=m},function(e,t,n){"use strict";var i=n(11),r=function(){function e(e){if(!e)throw new Error("data must not be null");if(!e.question)throw new Error("data.question must not be null or empty");if(!e.availableOptions||e.availableOptions.length<2)throw new Error("data.availableOptions must not be null or have less than two choices");e.availableOptions.forEach((function(e){if(!e)throw new Error("Option values must not contain null or empty")})),this.data=e,this.optionStates=new Array(e.availableOptions.length);for(var t=0;t<this.optionStates.length;t++)this.optionStates[t]=!1}return e.make=function(t){try{return new e(t)}catch(e){return null}},e.prototype.getType=function(){return"MultipleChoice"},e.prototype.getQuestion=function(){return this.data.question},e.prototype.getAvailableOptions=function(){return this.data.availableOptions},e.prototype.getOptionSelectedStates=function(){return this.optionStates},e.prototype.getMinNumberofSelectedOptions=function(){return this.data.minNumberOfSelectedOptions},e.prototype.getMaxNumberofSelectedOptions=function(){return this.data.maxNumberOfSelectedOptions},e.prototype.setOptionSelectedStates=function(e){for(var t=0;t<e.length;t++)this.optionStates[t]=e[t]},e.prototype.ValidateMinNumberofSelectedOptions=function(){var e=0;return this.optionStates.forEach((function(t){t&&e++})),e>=this.getMinNumberofSelectedOptions()},e.prototype.ValidateMaxNumberofSelectedOptions=function(){var e=0;return this.optionStates.forEach((function(t){t&&e++})),e<=this.getMaxNumberofSelectedOptions()},e.prototype.getDomElements=function(e){if(!e)throw new Error("Document must not be null");var t=e.createElement(i.DOM_MULTIPLECHOICE_TAGNAME);return t.appendChild(e.createTextNode(this.getOptionSelectedStates().toString())),[t]},e.prototype.getJsonElements=function(){var e={};return e[i.JSON_MULTIPLECHOICE_KEYNAME]=this.getOptionSelectedStates().toString(),e},e.prototype.getComponentJson=function(){var e;return(e={})[i.JSON_QUESTION_KEYNAME]=this.getQuestion(),e[i.JSON_RATINGOPTIONS_KEYNAME]=this.getAvailableOptions(),e},e}();!function(e){var t=function(){};e.MultipleChoiceComponentData=t}(r||(r={})),e.exports=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=n(10),a=n(3),s=n(16),u=n(15),c=a.isNOU,l=function(e){function t(t){var n=e.call(this)||this;if(!t)throw new Error("data must not be null");if(n.surveyInfo=new u(t.baseData),c(n.surveyInfo.getMetadata()))throw new Error("metadata must not be null");return n}return r(t,e),t.make=function(e){try{return new t(e)}catch(e){return null}},t.makeCustom=function(e){if(c(e))return null;var n=new t.GenericMessagingSurfaceSurveyData;return n.baseData=e,this.make(n)},t.prototype.getType=function(){return o.Type.GenericMessagingSurface},t.prototype.getSurveyInfo=function(){return this.surveyInfo},t.prototype.getComponent=function(e){return null},t.prototype.getDomElements=function(e){return[]},t.prototype.getJsonElements=function(){return{}},t}(s.Survey);!function(e){var t=function(){};e.GenericMessagingSurfaceSurveyData=t}(l||(l={})),e.exports=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=n(10),a=n(46),s=n(3),u=n(16),c=n(15),l=s.isNOU,d=function(e){function t(t){var n=e.call(this)||this;if(l(t))throw new Error("data must not be null");return n.surveyInfo=new c(t.baseData),n.intercept=new a(t.interceptData),n}return r(t,e),t.make=function(e){try{return new t(e)}catch(e){return null}},t.makeIntercept=function(e,n,i){if(l(e)||l(n)||l(i))return null;var r=i.content;if(l(r)||l(r.intercept))return null;var o=new t.InterceptSurveyData;return o.baseData=e,o.interceptData=new a.InterceptComponentData,o.interceptData.title=n.getCustomString(r.intercept.title),o.interceptData.question=n.getCustomString(r.intercept.question),o.interceptData.url=n.getCustomString(r.intercept.url),l(o.interceptData.title)||l(o.interceptData.question)||l(o.interceptData.url)?null:this.make(o)},t.prototype.getType=function(){return o.Type.Intercept},t.prototype.getSurveyInfo=function(){return this.surveyInfo},t.prototype.getInterceptComponent=function(){return this.intercept},t.prototype.getComponent=function(e){return"Intercept"===e?this.getInterceptComponent():null},t.prototype.getDomElements=function(e){return[]},t.prototype.getJsonElements=function(){return{}},t}(u.Survey);!function(e){var t=function(){};e.InterceptSurveyData=t}(d||(d={})),e.exports=d},function(e,t,n){"use strict";var i=n(11),r=function(){function e(e){if(!e)throw new Error("data must not be null");if(!e.question)throw new Error("data.question must not be null or empty");if(!e.title)throw new Error("data.title must not be null or empty");if(!e.url)throw new Error("data.url must not be null or empty");this.data=e}return e.make=function(t){try{return new e(t)}catch(e){return null}},e.prototype.getType=function(){return"Intercept"},e.prototype.getTitle=function(){return this.data.title},e.prototype.getQuestion=function(){return this.data.question},e.prototype.getUrl=function(){return this.data.url},e.prototype.getDomElements=function(e){if(!e)throw new Error("Document must not be null");return[e.createElement(i.DOM_INTERCEPT_TAGNAME)]},e.prototype.getJsonElements=function(){var e;return(e={})[i.JSON_INTERCEPT_KEYNAME]="",e},e.prototype.getComponentJson=function(){var e;return(e={})[i.JSON_TITLE_KEYNAME]=this.getTitle(),e[i.JSON_QUESTION_KEYNAME]=this.getQuestion(),e[i.JSON_INTERCEPTURL_KEYNAME]=this.getUrl(),e},e}();!function(e){var t=function(){};e.InterceptComponentData=t}(r||(r={})),e.exports=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=n(10),a=n(21),s=n(22),u=n(23),c=n(3),l=n(16),d=n(15),p=c.isNOU,g=c.overrideValues,h=function(e){function t(t){var n=e.call(this)||this;if(p(t))throw new Error("data must not be null");return n.surveyInfo=new d(t.baseData),n.prompt=new s(t.promptData),n.question=new a(t.commentData),n.rating=new u(t.ratingData),n}return r(t,e),t.make=function(e){try{return new t(e)}catch(e){return null}},t.makeNlqs=function(e,n,i){if(p(e)||p(n)||p(i))return null;var r=[],o=i.content;if(p(o)||p(o.comment)||p(o.prompt)||p(o.rating))return null;var c=new t.NlqsSurveyData;c.baseData=e,c.promptData=new s.PromptComponentData,c.ratingData=new u.RatingComponentData,c.commentData=new a.CommentComponentData,c.promptData.title=n.getCustomString(o.prompt.title),c.promptData.question=n.getCustomString(o.prompt.question),c.promptData.yesButtonLabel=n.getCustomString(o.prompt.yesLabel),c.promptData.noButtonLabel=n.getCustomString(o.prompt.noLabel),c.ratingData.question=n.getCustomString(o.rating.question),c.ratingData.isZeroBased=o.rating.isZeroBased,c.commentData.question=n.getCustomString(o.comment.question);for(var l=0,d=o.rating.ratingValuesAscending;l<d.length;l++){var g=d[l],h=n.getCustomString(g);if(p(h))return null;r.push(h)}return c.ratingData.ratingValuesAscending=r,p(c.ratingData.question)||p(c.commentData.question)||p(c.promptData.title)||p(c.promptData.question)||p(c.promptData.yesButtonLabel)||p(c.promptData.noButtonLabel)||p(c.ratingData.ratingValuesAscending)?null:this.make(c)},t.prototype.getType=function(){return o.Type.Nlqs},t.prototype.getSurveyInfo=function(){return this.surveyInfo},t.prototype.getCommentComponent=function(){return this.question},t.prototype.getPromptComponent=function(){return this.prompt},t.prototype.getRatingComponent=function(){return this.rating},t.prototype.getComponent=function(e){switch(e){case"Comment":return this.getCommentComponent();case"Prompt":return this.getPromptComponent();case"Rating":return this.getRatingComponent();default:return null}},t.prototype.getDomElements=function(e){if(p(e))throw new Error("Document must not be null");var t=e.createElement(o.DOM_NLQS_TAGNAME);return this.getSurveyInfo().getDomElements(e).forEach((function(e){p(e)||t.appendChild(e)})),this.getCommentComponent().getDomElements(e).forEach((function(e){p(e)||t.appendChild(e)})),this.getRatingComponent().getDomElements(e).forEach((function(e){p(e)||t.appendChild(e)})),[t]},t.prototype.getJsonElements=function(){var e={};return e=g(this.getSurveyInfo().getJsonElements(),e),e=g(this.getCommentComponent().getJsonElements(),e),e=g(this.getRatingComponent().getJsonElements(),e)},t}(l.Survey);!function(e){var t=function(){};e.NlqsSurveyData=t}(h||(h={})),e.exports=h},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=n(10),a=n(11),s=n(21),u=n(28),c=n(22),l=n(23),d=n(3),p=n(16),g=n(15),h=d.isNOU,v=d.overrideValues,m=function(e){function t(t){var n=e.call(this)||this;if(!t)throw new Error("data must not be null");return n.surveyInfo=new g(t.baseData),n.prompt=new c(t.promptData),n.question=new s(t.commentData),n.rating=new l(t.ratingData),n.cvSurvey=t.cvSurveyData?new u(t.cvSurveyData):null,n}return r(t,e),t.make=function(e){try{return new t(e)}catch(e){return null}},t.makeCustom=function(e,n,i){if(h(e)||h(n)||h(i))return null;var r=[],o=i.content;if(h(o)||h(o.comment)||h(o.prompt)||h(o.rating))return null;var a=new t.NpsSurveyData;a.baseData=e,a.promptData=new c.PromptComponentData,a.ratingData=new l.RatingComponentData,a.commentData=new s.CommentComponentData,a.promptData.title=n.getCustomString(o.prompt.title),a.promptData.question=n.getCustomString(o.prompt.question),a.promptData.yesButtonLabel=n.getCustomString(o.prompt.yesLabel),a.promptData.noButtonLabel=n.getCustomString(o.prompt.noLabel),a.ratingData.question=n.getCustomString(o.rating.question),a.ratingData.isZeroBased=o.rating.isZeroBased,a.commentData.question=n.getCustomString(o.comment.question);for(var d=0,p=o.rating.ratingValuesAscending;d<p.length;d++){var g=p[d],v=n.getCustomString(g);if(h(v))return null;r.push(v)}return a.ratingData.ratingValuesAscending=r,h(a.ratingData.question)||h(a.commentData.question)||h(a.promptData.title)||h(a.promptData.question)||h(a.promptData.yesButtonLabel)||h(a.promptData.noButtonLabel)||h(a.ratingData.ratingValuesAscending)||o.cvSurvey&&(a.cvSurveyData=new u.CVSurveyComponentData,a.cvSurveyData.customerVoiceFormId=o.cvSurvey.customerVoiceFormId,h(a.cvSurveyData.customerVoiceFormId))?null:this.make(a)},t.make5Point=function(e,n){if(!e||!n)return null;var i=new t.NpsSurveyData;i.baseData=e,i.ratingData=new l.RatingComponentData,i.ratingData.isZeroBased=!1,i.commentData=new s.CommentComponentData,i.promptData=new c.PromptComponentData,i.ratingData.question=n.loadStringResource(4),i.commentData.question=n.loadStringResource(21),i.promptData.title=n.loadStringResource(0),i.promptData.question=n.loadStringResource(1),i.promptData.yesButtonLabel=n.loadStringResource(2),i.promptData.noButtonLabel=n.loadStringResource(3);var r=new Array(5);return r[0]=n.loadStringResource(16),r[1]=n.loadStringResource(17),r[2]=n.loadStringResource(18),r[3]=n.loadStringResource(19),r[4]=n.loadStringResource(20),i.ratingData.question&&i.commentData.question&&i.promptData.title&&i.promptData.question&&i.promptData.yesButtonLabel&&i.promptData.noButtonLabel&&r[0]&&r[1]&&r[2]&&r[3]&&r[4]?(i.ratingData.ratingValuesAscending=r,this.make(i)):null},t.make11Point=function(e,n){if(!e||!n)return null;var i=new t.NpsSurveyData;i.baseData=e,i.ratingData=new l.RatingComponentData,i.ratingData.isZeroBased=!0,i.commentData=new s.CommentComponentData,i.promptData=new c.PromptComponentData,i.ratingData.question=n.loadStringResource(4),i.commentData.question=n.loadStringResource(21),i.promptData.title=n.loadStringResource(0),i.promptData.question=n.loadStringResource(1),i.promptData.yesButtonLabel=n.loadStringResource(2),i.promptData.noButtonLabel=n.loadStringResource(3);var r=new Array(11);return r[0]=n.loadStringResource(5),r[1]=n.loadStringResource(6),r[2]=n.loadStringResource(7),r[3]=n.loadStringResource(8),r[4]=n.loadStringResource(9),r[5]=n.loadStringResource(10),r[6]=n.loadStringResource(11),r[7]=n.loadStringResource(12),r[8]=n.loadStringResource(13),r[9]=n.loadStringResource(14),r[10]=n.loadStringResource(15),i.ratingData.question&&i.commentData.question&&i.promptData.title&&i.promptData.question&&i.promptData.yesButtonLabel&&i.promptData.noButtonLabel&&r[0]&&r[1]&&r[2]&&r[3]&&r[4]&&r[5]&&r[6]&&r[7]&&r[8]&&r[9]&&r[10]?(i.ratingData.ratingValuesAscending=r,this.make(i)):null},t.prototype.getType=function(){return o.Type.Nps},t.prototype.getSurveyInfo=function(){return this.surveyInfo},t.prototype.getCommentComponent=function(){return this.question},t.prototype.getPromptComponent=function(){return this.prompt},t.prototype.getRatingComponent=function(){return this.rating},t.prototype.getCVSurveyComponent=function(){return this.cvSurvey},t.prototype.getComponent=function(e){switch(e){case"Comment":return this.getCommentComponent();case"Prompt":return this.getPromptComponent();case"Rating":return this.getRatingComponent();case"CVSurvey":return this.getCVSurveyComponent();default:return null}},t.prototype.getDomElements=function(e){if(!e)throw new Error("Document must not be null");var t=e.createElement(o.DOM_NPS_TAGNAME);return this.getSurveyInfo().getDomElements(e).forEach((function(e){e&&t.appendChild(e)})),this.getCommentComponent().getDomElements(e).forEach((function(e){e&&t.appendChild(e)})),this.getRatingComponent().getDomElements(e).forEach((function(e){e&&t.appendChild(e)})),[t]},t.prototype.getJsonElements=function(){var e,t={};return t=v(this.getSurveyInfo().getJsonElements(),t),t=v(this.getCommentComponent().getJsonElements(),t),(t=v(this.getRatingComponent().getJsonElements(),t))[a.JSON_APPLICATION_KEYNAME]={},t[a.JSON_APPLICATION_KEYNAME][a.JSON_EXTENDEDMANIFESTDATA_KEYNAME]=JSON.stringify(((e={})[a.JSON_SURVEYSTRINGS_KEYNAME]=this.makeSurveyStrings(),e)),t},t.prototype.makeSurveyStrings=function(){var e={};return this.prompt&&(e[a.JSON_PROMPT_KEYNAME]=this.prompt.getComponentJson()),this.rating&&(e[a.JSON_RATING_KEYNAME]=[this.rating.getComponentJson()]),this.question&&(e[a.JSON_COMMENT_KEYNAME]=[this.question.getComponentJson()]),JSON.stringify(e)},t}(p.Survey);!function(e){var t=function(){};e.NpsSurveyData=t}(m||(m={})),e.exports=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FloodgateSettings=void 0;var i=function(){function e(){}return e.toJson=function(e){return JSON.stringify(e)},e.fromJson=function(e){return JSON.parse(e)},e}();t.FloodgateSettings=i},function(e,t,n){"use strict";var i=function(){function e(e){if(!e)throw new Error("trackingSet must not be null");if(e.getList().length>32)throw new Error("trackingSet list size must be less than 32");this.isOrdered=e.getIsOrdered(),this.trackedActivities=e.getList(),this.currentIndex=0,this.activationMask=0,this.currentActivationFlags=0,this.isActivationByInitPending=!1,this.currentCounts=new Array(this.trackedActivities.length),this.currentStartTimes=new Array(this.trackedActivities.length),this.currentSessionCounts=new Array(this.trackedActivities.length);for(var t=0;t<this.trackedActivities.length;t++)this.currentCounts[t]=0,this.currentSessionCounts[t]=0;for(t=0;t<this.trackedActivities.length;t++)this.activationMask|=1<<t,this.trackedActivities[t].getCount()<1&&this.trackedActivities[t].setCount(1)}return e.prototype.getCount=function(e){return this.isValidIndex(e)?this.currentCounts[e]:0},e.prototype.getSessionCount=function(e){return this.isValidIndex(e)?this.currentSessionCounts[e]:0},e.prototype.getStartTime=function(e){return this.isValidIndex(e)?this.currentStartTimes[e]:null},e.prototype.moveSessionCountIntoBaseCount=function(e){if(!this.isValidIndex(e))return 0;var t=this.currentSessionCounts[e];return this.currentSessionCounts[e]=0,t},e.prototype.initCounts=function(e,t,n){void 0===n&&(n=!1);for(var i=0;i<this.trackedActivities.length&&!(this.isOrdered&&i>this.currentIndex);i++)i<t.length&&t[i]&&(this.currentSessionCounts[i]=this.currentCounts[i]=t[i].tracker.getSessionCount(t[i].index),this.currentStartTimes[i]=t[i].tracker.getStartTime(t[i].index)),this.trackedActivities[i].getIsAggregate()&&i<e.length&&(this.currentCounts[i]+=e[i]),this.hasCountCrossedThreshold(i)&&this.finishActivityAtIndex(i);this.isActivated()&&!n&&(this.isActivationByInitPending=!0)},e.prototype.generateActivityIndexList=function(){for(var t=new Array,n=0;n<this.trackedActivities.length;n++){var i=new e.ActivityIndex;i.activity=this.trackedActivities[n].getActivity(),i.index=n,t.push(i)}return t},e.prototype.incrementActivity=function(e,t){if(!this.isValidIndex(e))return 0;if(t<0)throw new Error("increment must be non-negative");if(this.isOrdered&&e>this.currentIndex)return 0;var n=!this.hasCountCrossedThreshold(e);return this.currentCounts[e]+=t,this.currentSessionCounts[e]+=t,this.isActivationByInitPending?this.isPermittedIndexForActivationByInit(e)?this.commitActivation():0:n&&this.hasCountCrossedThreshold(e)?(this.finishActivityAtIndex(e),this.isActivated()?this.commitActivation():1):0},e.prototype.startTime=function(e,t){this.isValidIndex(e)&&(this.currentStartTimes[e]=t||new Date)},e.prototype.stopTime=function(e,t){if(!this.isValidIndex(e))return 0;var n=this.currentStartTimes[e];if(this.currentStartTimes[e]=null,!n)return 0;if(n>(t=t||new Date))return 0;var i=(t.getTime()-n.getTime())/1e3;return i%1==0&&(i+=.001),i},e.prototype.isValidIndex=function(e){return e<this.trackedActivities.length},e.prototype.isActivated=function(){return(this.currentActivationFlags&this.activationMask)===this.activationMask},e.prototype.finishActivityAtIndex=function(e){if(!this.isValidIndex(e))throw new Error("Index is not valid");this.currentActivationFlags|=1<<e,e+1<this.trackedActivities.length&&(this.currentIndex=e+1)},e.prototype.hasCountCrossedThreshold=function(e){if(!this.isValidIndex(e))throw new Error("Index is not valid");return this.currentCounts[e]>=this.trackedActivities[e].getCount()},e.prototype.isPermittedIndexForActivationByInit=function(e){return!this.isOrdered||e+1===this.currentCounts.length},e.prototype.commitActivation=function(){return this.isActivationByInitPending=!1,2},e}();!function(e){var t=function(){};e.ActivityIndex=t}(i||(i={})),e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedTracker=void 0;var i=function(){};t.IndexedTracker=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActivityTrackingContract=void 0;var i=function(e,t){this.surveyId=e,this.trackingSet=t};t.ActivityTrackingContract=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasSurveyReachedMaxLaunches=t.hasSurveyReachedMaxLaunchesPerSession=t.isCriticalSurvey=t.isBusinessCriticalSurvey=t.isMultiLaunchSurvey=void 0;var i=n(7),r=n(3);function o(e){var t=null==e?void 0:e.getMaxLaunches();return r.isNumber(t)&&t>1}function a(e){var t=null==e?void 0:e.getBusinessLevel();return!r.isNOU(t)&&t===i.ISurveyInfo.BusinessLevel.Critical}t.isMultiLaunchSurvey=o,t.isBusinessCriticalSurvey=a,t.isCriticalSurvey=function(e){return o(e)||a(e)},t.hasSurveyReachedMaxLaunchesPerSession=function(e,t){var n;return!o(e)||!r.isNumber(e.getMaxLaunchesPerSession())||(null!==(n=t[e.getId()])&&void 0!==n?n:0)>=e.getMaxLaunchesPerSession()},t.hasSurveyReachedMaxLaunches=function(e,t){return!o(e)||((null==t?void 0:t.SurveyLaunchCount)||0)>=e.getMaxLaunches()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateUserFacts=t.deserializeUserFacts=void 0;var i=n(55);t.deserializeUserFacts=function(e){var t=[];for(var n in e.UserFacts)if(e.UserFacts.hasOwnProperty(n)){var r=e.UserFacts[n];r&&t.push(i.UserFact.deserialize(r))}return 0===t.length&&(t=null),t},t.validateUserFacts=function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)&&!e[t])return!1;return!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserFact=void 0;var i=n(8),r=n(12),o=n(3),a=o.isNOU,s=o.isNumber,u=o.isArray,c=[0,1,2,3,4,5],l=function(){function e(e){this.input=e}return e.deserialize=function(t){return this.validate(t)?new e(t):null},e.validate=function(e){if(!e)return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Input is null or undefined for user fact"),!1;if(!e.Value&&e.Values&&(e.Value=e.Values),a(e.Name)||a(e.Type)||a(e.Value))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Either of the required parameters Name: "+e.Name+", Type: "+e.Type+" or Value: "+e.Value+" are not provided for the user fact"),!1;if(!this.validateUserFactType(e.Type))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Invalid UserFactType value "+e.Type+" is provided for user fact"),!1;if(6===e.Type)return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Unsupported UserFactType value "+e.Type+" is provided for user fact"),!1;if(e.LatencyType&&!this.validateLatencyType(e.LatencyType))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Invalid LatencyType value "+e.LatencyType+" is provided for user fact of type "+e.Type),!1;if(e.LatencyType&&0!==e.LatencyType&&a(e.LatencyDurationInSeconds))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"LatencyDurationInSeconds value "+e.LatencyDurationInSeconds+" is not provided for user fact of type "+e.Type),!1;if(e.LatencyDurationInSeconds&&!s(e.LatencyDurationInSeconds))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Invalid LatencyDurationInSeconds value "+e.LatencyDurationInSeconds+" is provided for user fact of type "+e.Type),!1;if(1===e.Type&&a(e.IntervalType))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Required parameter intervalType is not provided for user fact of type "+e.Type),!1;var t=this.getComparatorTypes(e.Type);return!(e.Comparator&&!function(e,t){return-1!==t.indexOf(e)}(e.Comparator,t))||(r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,"Unsupported comparator type for user fact of type "+e.Type),!1)},e.getComparatorTypes=function(e){switch(e){case 0:return[0,1];case 4:return[0,1,6,7,8,9];case 5:return[6,7,8,9];case 1:case 2:case 3:case 6:return c}return c},e.validateLatencyType=function(e){return 0===e||3===e||1===e||2===e},e.validateUserFactType=function(e){return 0===e||2===e||3===e||4===e||1===e||5===e||6===e},e.prototype.isAMatch=function(e){if(!e||!e.userFactValue)return!1;if(!this.isLatencyAcceptable(e))return!1;try{var t=this.getType();return 0===t?function(e,t,n){var i=JSON.parse(t.userFactValue.toLowerCase());return d(!!e,!!i,n)}(this.getValue(),e,this.getComparator()):2===t?function(e,t,n){var i=Date.parse(t.userFactValue);if(!g(i,t.userFactValue,t.userFactName))return!1;var r=Date.parse(e);if(!g(r,e,null,2))return!1;return d(r,i,n)}(this.getValue(),e,this.getComparator()):3===t?function(e,t,n){var i=parseInt(t.userFactValue,10);if(!g(i,t.userFactValue,t.userFactName))return!1;return d(e,i,n)}(this.getValue(),e,this.getComparator()):4===t?function(e,t,n){return d(e.toLowerCase(),t.userFactValue.toLowerCase(),n)}(this.getValue(),e,this.getComparator()):1===t?function(e,t,n,o){var a=Date.parse(t.userFactValue);if(!g(a,t.userFactValue,t.userFactName))return!1;var s=Date.now(),u=0===o?s-a:a-s;if(u<0)return r.FloodgateEngine.getTelemetryLogger().log_Event(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Mismatch,{ErrorMessage:"Interval type not acceptable - { Spec: "+e+', Name: "'+t.userFactName+'" }',TimeMilliseconds:u,Type:""+o}),!1;return d(864e5*e,u,n)}(this.getValue(),e,this.getComparator(),this.getIntervalType()):5===t?function(e,t,n){return d(e,t.userFactValue,n)}(this.getValue(),e,this.getComparator()):(r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,"Unsupported type of user fact was provided "+t),!1)}catch(e){return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,e),!1}},e.prototype.getType=function(){return this.input.Type},e.prototype.getName=function(){return this.input.Name},e.prototype.getValue=function(){return this.input.Value},e.prototype.getComparator=function(){return this.input.Comparator||0},e.prototype.getLatencyType=function(){return this.input.LatencyType||0},e.prototype.getLatencyDurationInSeconds=function(){return this.input.LatencyDurationInSeconds},e.prototype.getIntervalType=function(){return this.input.IntervalType},e.prototype.isLatencyAcceptable=function(e){var t=this.getType();return!(!a(this.getLatencyDurationInSeconds())&&!function(e,t,n){var i;switch(e){case 0:break;case 1:i=n.sourceDateTime;break;case 2:i=n.storageDateTime;break;case 3:i=n.clientIngestionDateTime}if(!a(i)){var r=Date.parse(i);return Date.now()-r<=1e3*t}return!0}(this.getLatencyType(),this.getLatencyDurationInSeconds(),e))||(r.FloodgateEngine.getTelemetryLogger().log_Event(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Mismatch,{ErrorMessage:'Latency duration not acceptable - { Name: "'+e.userFactName+'" }',TimeMilliseconds:this.getLatencyDurationInSeconds(),Type:""+t}),!1)},e}();function d(e,t,n){switch(n){case 0:return t===e;case 1:return t!==e;case 2:return t>e;case 3:return t>=e;case 4:return t<e;case 5:return t<=e;case 6:return p(e,t);case 7:return!p(e,t);case 8:return p(t,e);case 9:return!p(t,e)}}function p(e,t){if("string"==typeof t){var n=t.toLowerCase();if("string"==typeof e)return-1!==e.toLowerCase().indexOf(n);if(u(e))return e.some((function(e){return e&&e.toString().toLowerCase()===n}))}return!!u(e)&&-1!==e.indexOf(t)}function g(e,t,n,o){if(!s(e)){var a="User fact "+n+" has invalid value "+t;return o&&(a="Invalid value "+t+" was provided for user fact of type "+o),r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,a),!1}return!0}t.UserFact=l},function(e,t,n){var i;i=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e,10),this.low<0&&(this.high=-1)}return e.prototype.Equals=function(t){var n=new e(t);return this.low===n.low&&this.high===n.high},e}();t.Int64=i;var r=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e,10)}return e.prototype.Equals=function(t){var n=new e(t);return this.low===n.low&&this.high===n.high},e}();t.UInt64=r;var o=function(){function e(){}return e.ToByte=function(e){return this.ToUInt8(e)},e.ToInt16=function(e){return 32767&e|(32768&e)<<16>>16},e.ToInt32=function(e){return 2147483647&e|2147483648&e},e.ToUInt8=function(e){return 255&e},e.ToUInt32=function(e){return 4294967295&e},e}();t.Number=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NotSet=0]="NotSet",e[e.DistinguishedName=1]="DistinguishedName",e[e.GenericData=2]="GenericData",e[e.IPV4Address=3]="IPV4Address",e[e.IPv6Address=4]="IPv6Address",e[e.MailSubject=5]="MailSubject",e[e.PhoneNumber=6]="PhoneNumber",e[e.QueryString=7]="QueryString",e[e.SipAddress=8]="SipAddress",e[e.SmtpAddress=9]="SmtpAddress",e[e.Identity=10]="Identity",e[e.Uri=11]="Uri",e[e.Fqdn=12]="Fqdn",e[e.IPV4AddressLegacy=13]="IPV4AddressLegacy"}(t.AWTPiiKind||(t.AWTPiiKind={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(1),o=n(3),a=function(){function e(){}return e.getPayloadBlob=function(e,t){var n=new i.IO.MemoryStream,r=new i.CompactBinaryProtocolWriter(n);return r.WriteFieldBegin(i.BondDataType.BT_MAP,3),r.WriteMapContainerBegin(t,i.BondDataType.BT_STRING,i.BondDataType.BT_LIST),Object.keys(e).forEach((function(t){r.WriteString(t);var n=e[t];r.WriteContainerBegin(1,i.BondDataType.BT_STRUCT),r.WriteFieldBegin(i.BondDataType.BT_STRING,2),r.WriteString("act_default_source"),r.WriteFieldBegin(i.BondDataType.BT_STRING,5),r.WriteString(o.newGuid()),r.WriteFieldBegin(i.BondDataType.BT_INT64,6),r.WriteInt64(o.numberToBondInt64(Date.now())),r.WriteFieldBegin(i.BondDataType.BT_LIST,8),r.WriteContainerBegin(n.length,i.BondDataType.BT_STRUCT);for(var a=0;a<n.length;++a)r.WriteBlob(n[a]);r.WriteStructEnd(!1)})),r.WriteStructEnd(!1),n.GetBuffer()},e.getEventBlob=function(e){var t=new i.IO.MemoryStream,n=new i.CompactBinaryProtocolWriter(t);n.WriteFieldBegin(i.BondDataType.BT_STRING,1),n.WriteString(e.id),n.WriteFieldBegin(i.BondDataType.BT_INT64,3),n.WriteInt64(o.numberToBondInt64(e.timestamp)),n.WriteFieldBegin(i.BondDataType.BT_STRING,5),n.WriteString(e.type),n.WriteFieldBegin(i.BondDataType.BT_STRING,6),n.WriteString(e.name);var a=[],s=[];return Object.keys(e.properties).forEach((function(t){e.properties[t].pii===r.AWTPiiKind.NotSet?a.push(t):s.push(t)})),a.length&&(n.WriteFieldBegin(i.BondDataType.BT_MAP,13),n.WriteMapContainerBegin(a.length,i.BondDataType.BT_STRING,i.BondDataType.BT_STRING),a.forEach((function(t){n.WriteString(t),n.WriteString(e.properties[t].value)}))),s.length&&(n.WriteFieldBegin(i.BondDataType.BT_MAP,30),n.WriteMapContainerBegin(s.length,i.BondDataType.BT_STRING,i.BondDataType.BT_STRUCT),s.forEach((function(t){n.WriteString(t),n.WriteFieldBegin(i.BondDataType.BT_INT32,1),n.WriteInt32(1),n.WriteFieldBegin(i.BondDataType.BT_INT32,2),n.WriteInt32(e.properties[t].pii),n.WriteFieldBegin(i.BondDataType.BT_STRING,3),n.WriteString(e.properties[t].value),n.WriteStructEnd(!1)}))),n.WriteStructEnd(!1),t.GetBuffer()},e.base64Encode=function(e){return i.Encoding.Base64.GetString(e)},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=/[xy]/g;t.numberToBondInt64=function(e){var t=new i.Int64("0");return t.low=4294967295&e,t.high=Math.floor(e/4294967296),t},t.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(r,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},t.isPii=function(e){return!isNaN(e)&&null!==e&&e>=0&&e<=13}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Version="1.2.2",t.FullVersionString="AWT-Web-CJS-"+t.Version},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);t.AWTPiiKind=i.AWTPiiKind;var r=n(13);t.AWT=r.default,t.AWT_COLLECTOR_URL_UNITED_STATES="https://us.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_GERMANY="https://de.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_JAPAN="https://jp.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_AUSTRALIA="https://au.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_EUROPE="https://eu.pipe.aria.microsoft.com/Collector/3.0/"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.BT_STOP=0]="BT_STOP",e[e.BT_STOP_BASE=1]="BT_STOP_BASE",e[e.BT_UINT8=3]="BT_UINT8",e[e.BT_UINT32=5]="BT_UINT32",e[e.BT_UINT64=6]="BT_UINT64",e[e.BT_STRING=9]="BT_STRING",e[e.BT_STRUCT=10]="BT_STRUCT",e[e.BT_LIST=11]="BT_LIST",e[e.BT_MAP=13]="BT_MAP",e[e.BT_INT32=16]="BT_INT32",e[e.BT_INT64=17]="BT_INT64",e[e.BT_UNAVAILABLE=127]="BT_UNAVAILABLE"}(t.BondDataType||(t.BondDataType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(){}return e.GetBytes=function(e){for(var t=[],n=0;n<e.length;++n){var i=e.charCodeAt(n);i<128?t.push(i):i<2048?t.push(192|i>>6,128|63&i):i<55296||i>=57344?t.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++n)),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return t},e}();t.Utf8=r;var o=function(){function e(){}return e.GetString=function(e){for(var t,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[],r=e.length%3,o=0,a=e.length-r;o<a;o+=3){var s=(e[o]<<16)+(e[o+1]<<8)+e[o+2];i.push([n.charAt((t=s)>>18&63),n.charAt(t>>12&63),n.charAt(t>>6&63),n.charAt(63&t)].join(""))}switch(r){case 1:s=e[e.length-1],i.push(n.charAt(s>>2)),i.push(n.charAt(s<<4&63)),i.push("==");break;case 2:var u=(e[e.length-2]<<8)+e[e.length-1];i.push(n.charAt(u>>10)),i.push(n.charAt(u>>4&63)),i.push(n.charAt(u<<2&63)),i.push("=")}return i.join("")},e}();t.Base64=o;var a=function(){function e(){}return e.GetBytes=function(e){for(var t=[];4294967168&e;)t.push(127&e|128),e>>>=7;return t.push(127&e),t},e}();t.Varint=a;var s=function(){function e(){}return e.GetBytes=function(e){for(var t=e.low,n=e.high,i=[];n||4294967168&t;)i.push(127&t|128),t=(127&n)<<25|t>>>7,n>>>=7;return i.push(127&t),i},e}();t.Varint64=s;var u=function(){function e(){}return e.EncodeZigzag32=function(e){return(e=i.Number.ToInt32(e))<<1^e>>31},e.EncodeZigzag64=function(e){var t=e.low,n=e.high,r=n<<1|t>>>31,o=t<<1;2147483648&n&&(r=~r,o=~o);var a=new i.UInt64("0");return a.low=o,a.high=r,a},e}();t.Zigzag=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(){this._buffer=[]}return e.prototype.WriteByte=function(e){this._buffer.push(i.Number.ToByte(e))},e.prototype.Write=function(e,t,n){for(;n--;)this.WriteByte(e[t++])},e.prototype.GetBuffer=function(){return this._buffer},e}();t.MemoryStream=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6);t.BondDataType=i.BondDataType;var r=n(7);t.Encoding=r;var o=n(8);t.IO=o;var a=n(0);t.Int64=a.Int64,t.UInt64=a.UInt64,t.Number=a.Number;var s=function(){function e(e){this._stream=e}return e.prototype.WriteBlob=function(e){this._stream.Write(e,0,e.length)},e.prototype.WriteContainerBegin=function(e,t){this.WriteUInt8(t),this.WriteUInt32(e)},e.prototype.WriteMapContainerBegin=function(e,t,n){this.WriteUInt8(t),this.WriteUInt8(n),this.WriteUInt32(e)},e.prototype.WriteFieldBegin=function(e,t){t<=5?this._stream.WriteByte(e|t<<5):t<=255?(this._stream.WriteByte(192|e),this._stream.WriteByte(t)):(this._stream.WriteByte(224|e),this._stream.WriteByte(t),this._stream.WriteByte(t>>8))},e.prototype.WriteInt32=function(e){e=r.Zigzag.EncodeZigzag32(e),this.WriteUInt32(e)},e.prototype.WriteInt64=function(e){this.WriteUInt64(r.Zigzag.EncodeZigzag64(e))},e.prototype.WriteString=function(e){if(""===e)this.WriteUInt32(0);else{var t=r.Utf8.GetBytes(e);this.WriteUInt32(t.length),this._stream.Write(t,0,t.length)}},e.prototype.WriteStructEnd=function(e){this.WriteUInt8(e?i.BondDataType.BT_STOP_BASE:i.BondDataType.BT_STOP)},e.prototype.WriteUInt32=function(e){var t=r.Varint.GetBytes(a.Number.ToUInt32(e));this._stream.Write(t,0,t.length)},e.prototype.WriteUInt64=function(e){var t=r.Varint64.GetBytes(e);this._stream.Write(t,0,t.length)},e.prototype.WriteUInt8=function(e){this._stream.WriteByte(a.Number.ToUInt8(e))},e}();t.CompactBinaryProtocolWriter=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._killedTokenDictionary={}}return e.prototype.setKillSwitchTenants=function(e,t){var n=this;if(e&&t)try{var i=e.split(",");if("this-request-only"===t)return i;var r=1e3*parseInt(t,10);i.forEach((function(e){n._killedTokenDictionary[e]=Date.now()+r}))}catch(e){return[]}return[]},e.prototype.isTenantKilled=function(e){return void 0!==this._killedTokenDictionary[e]&&this._killedTokenDictionary[e]>Date.now()||(delete this._killedTokenDictionary[e],!1)},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(e,t){this._maxRequestSize=e,this._outboundQueue=t,this._currentBatch={},this._currentBatchSize=0}return e.prototype.addEventToBatch=function(e){var t=i.default.getEventBlob(e);t.length>this._maxRequestSize||(this._currentBatchSize+t.length>this._maxRequestSize?this.flushBatch():(void 0===this._currentBatch[e.tenantToken]&&(this._currentBatch[e.tenantToken]=[]),this._currentBatch[e.tenantToken].push(t),this._currentBatchSize+=t.length))},e.prototype.flushBatch=function(){this._currentBatchSize>0&&(this._outboundQueue.push(this._currentBatch),this._currentBatch={},this._currentBatchSize=0)},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.shouldRetryForStatus=function(e){return!(e>=300&&e<500&&408!==e||501===e||505===e)},e.getMillisToBackoffForRetry=function(e){var t,n=Math.floor(1200*Math.random())+2400;return t=Math.pow(4,e)*n,Math.min(t,12e4)},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(14),o=n(3),a=n(4),s=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,u=/\./g,c=/^[a-zA-Z0-9](([a-zA-Z0-9|_|\.]){0,98}[a-zA-Z0-9])?$/,l=function(){function e(){}return e.initialize=function(e,t){if(void 0===t&&(t={}),this._isInitialized)throw"Already Initialized";this._defaultTenantToken=e,this._overrideValuesFromConfig(t),r.default.initialize(this._config),this._isInitialized=!0},e.flush=function(e){this._isInitialized&&!this._isDestroyed&&r.default.flush(e)},e.flushAndTeardown=function(){this._isInitialized&&!this._isDestroyed&&(this._isDestroyed=!0,r.default.flushAndTeardown())},e.setContext=function(e,t,n){void 0===n&&(n="allTkns"),null!==(t=this._sanitizeProperty(e,t))&&(this._contextProperties[n]||(this._contextProperties[n]={}),this._contextProperties[n][e]=t)},e.logEvent=function(e){var t=this;if(this._isInitialized){if(!e.name||!e.properties)return;e.name=e.name.toLowerCase(),e.name.replace(u,"_");var n="";if(e.type?(e.type.toLowerCase(),n="custom."):e.type="custom",!s.test(e.name)||!s.test(e.type))return;if(e.type=n+e.type,isNaN(e.timestamp)&&(e.timestamp=(new Date).getTime()),e.tenantToken||(e.tenantToken=this._defaultTenantToken),e.id=o.newGuid(),Object.keys(e.properties).forEach((function(n){e.properties[n]=t._sanitizeProperty(n,e.properties[n]),null===e.properties[n]&&delete e.properties[n]})),this._addContextIfAbsent(e,e.tenantToken),this._addContextIfAbsent(e,"allTkns"),0===Object.keys(e.properties).length)return;this._setDefaultProperty(e,"EventInfo.InitId",this._getInitId(e.tenantToken)),this._setDefaultProperty(e,"EventInfo.Sequence",this._getSequenceId(e.tenantToken)),this._setDefaultProperty(e,"EventInfo.SdkVersion",a.FullVersionString),this._setDefaultProperty(e,"EventInfo.Name",e.name),this._setDefaultProperty(e,"EventInfo.Time",new Date(e.timestamp).toISOString()),r.default.sendEvent(e)}},e._overrideValuesFromConfig=function(e){e.collectorUrl&&(this._config.collectorUrl=e.collectorUrl),e.sendingTimer>1e3&&(this._config.sendingTimer=e.sendingTimer)},e._getInitId=function(e){return void 0===this._initIdMap[e]&&(this._initIdMap[e]=o.newGuid()),this._initIdMap[e]},e._getSequenceId=function(e){return void 0===this._sequenceIdMap[e]&&(this._sequenceIdMap[e]=0),(++this._sequenceIdMap[e]).toString()},e._setDefaultProperty=function(e,t,n){e.properties[t]={value:n,pii:i.AWTPiiKind.NotSet}},e._addContextIfAbsent=function(e,t){if(this._contextProperties[t]){var n=this._contextProperties[t];Object.keys(n).forEach((function(t){e.properties[t]||(e.properties[t]=n[t])}))}},e._sanitizeProperty=function(e,t){return"string"!=typeof t&&"number"!=typeof t&&"boolean"!=typeof t||(t={value:t}),c.test(e)&&null!=t&&null!==t.value&&void 0!==t.value&&""!==t.value?(void 0===t.pii&&(t.pii=i.AWTPiiKind.NotSet),t.value=t.value.toString(),o.isPii(t.pii)?t:null):null},e._isInitialized=!1,e._isDestroyed=!1,e._contextProperties={},e._sequenceIdMap={},e._initIdMap={},e._config={collectorUrl:"https://browser.pipe.aria.microsoft.com/Collector/3.0/",sendingTimer:1e3},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),r=n(2),o=n(12),a=n(10),s=n(4),u=function(){function e(){}return e.initialize=function(e){this._inboundQueues.push([]),this._recordBatcher=new i.default(2936012,this._outboundQueue),this._newEventsAllowed=!0,"undefined"==typeof Uint8Array&&(this._urlString+="&content-encoding=base64"),this._sendingTimer=e.sendingTimer,this._urlString=e.collectorUrl+this._urlString+"&x-apikey="},e.sendEvent=function(e){var t=this;this._newEventsAllowed&&(this._inboundQueues[this._inboundQueues.length-1].push(e),!this._running&&this._timeout<0&&!this._isCurrentlyFlushing&&(this._timeout=setTimeout((function(){return t._batchAndSendEvents(!1)}),this._sendingTimer)))},e.flushAndTeardown=function(){this._newEventsAllowed=!1,this._batchAndSendEvents(!0)},e.flush=function(e){this._inboundQueues.push([]),this._isCurrentlyFlushing?this._flushQueue.push(e):(this._isCurrentlyFlushing=!0,this._flush(e))},e._batchAndSendEvents=function(e){for(this._running=!0;this._inboundQueues[0].length>0&&this._outboundQueue.length<1;)this._recordBatcher.addEventToBatch(this._inboundQueues[0].pop());0===this._outboundQueue.length&&this._recordBatcher.flushBatch(),this._sendRequest(this._outboundQueue.pop(),0,e)},e._retryRequestIfNeeded=function(e,t,n,i,r){var a=this,s=!0;e&&void 0!==e.status&&(this._killSwitch.setKillSwitchTenants(e.getResponseHeader("kill-tokens"),e.getResponseHeader("kill-duration-seconds")).forEach((function(e){delete t[e],n--})),(!o.default.shouldRetryForStatus(e.status)||n<=0)&&(s=!1)),s&&r<4?setTimeout((function(){return a._sendRequest(t,r+1,!1)}),o.default.getMillisToBackoffForRetry(r)):this._handleRequestFinished(null)},e._sendRequest=function(e,t,n){var i=this;try{var o=new XMLHttpRequest,a=0,s="";if(Object.keys(e).forEach((function(t){i._killSwitch.isTenantKilled(t)?delete e[t]:(s.length>0&&(s+=","),s+=t,a++)})),o.open("POST",this._urlString+s,!n),n||(o.ontimeout=function(){i._retryRequestIfNeeded(o,e,a,s,t)},o.onerror=function(){i._retryRequestIfNeeded(o,e,a,s,t)},o.onload=function(){i._handleRequestFinished(o)}),a>0){var u=r.default.getPayloadBlob(e,a);"undefined"==typeof Uint8Array?o.send(r.default.base64Encode(u)):o.send(new Uint8Array(u))}else n&&this._handleRequestFinished(null)}catch(e){this._handleRequestFinished(null)}},e._handleRequestFinished=function(e){var t=this;e&&this._killSwitch.setKillSwitchTenants(e.getResponseHeader("kill-tokens"),e.getResponseHeader("kill-duration-seconds")),this._inboundQueues[0].length>0?this._timeout=setTimeout((function(){return t._batchAndSendEvents(!1)}),this._sendingTimer):(this._timeout=-1,this._running=!1)},e._flush=function(e){var t=this;this._running||(this._timeout>-1&&(clearTimeout(this._timeout),this._timeout=-1),this._inboundQueues[0].length>0&&this._batchAndSendEvents(!1)),this._checkPrimaryInboundQueueEmpty((function(){t._inboundQueues.shift(),null!=e&&e(),t._flushQueue.length>0?setTimeout((function(){return t._flush(t._flushQueue.shift())}),t._sendingTimer):(t._isCurrentlyFlushing=!1,t._inboundQueues[0].length>0&&(t._timeout=setTimeout((function(){return t._batchAndSendEvents(!1)}),t._sendingTimer)))}))},e._checkPrimaryInboundQueueEmpty=function(e){var t=this;0===this._inboundQueues[0].length?this._checkOutboundQueueEmptyAndSent(e):setTimeout((function(){return t._checkPrimaryInboundQueueEmpty(e)}),250)},e._checkOutboundQueueEmptyAndSent=function(e){var t=this;this._running?setTimeout((function(){return t._checkOutboundQueueEmptyAndSent(e)}),250):e()},e._outboundQueue=[],e._inboundQueues=[],e._newEventsAllowed=!1,e._killSwitch=new a.default,e._isCurrentlyFlushing=!1,e._flushQueue=[],e._running=!1,e._timeout=-1,e._urlString="?qsp=true&content-type=application%2Fbond-compact-binary&client-id=NO_AUTH&sdk-version="+s.FullVersionString,e}();t.default=u},function(e,t,n){e.exports=n(5)}])},e.exports=i()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationState=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Created=10]="Created",e[e.Sent=20]="Sent",e[e.Duplicated=30]="Duplicated",e[e.Seen=40]="Seen",e[e.Tried=50]="Tried",e[e.Kept=60]="Kept",e[e.Rejected=70]="Rejected"}(t.AnnotationState||(t.AnnotationState={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ItemChanges=t.ItemOperation=void 0,function(e){e[e.None=0]="None",e[e.Added=1]="Added",e[e.Updated=2]="Updated",e[e.Deleted=3]="Deleted"}(t.ItemOperation||(t.ItemOperation={})),function(e){e[e.ContentChanged=0]="ContentChanged",e[e.ContentWasEmpty=1]="ContentWasEmpty",e[e.FormattingChanged=2]="FormattingChanged"}(t.ItemChanges||(t.ItemChanges={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GridConstants=t.OpenType=t.BlobRefType=void 0,function(e){e[e.None=0]="None",e[e.HttpsGetDownloadUrl=1]="HttpsGetDownloadUrl",e[e.AlCodedLocation=2]="AlCodedLocation"}(t.BlobRefType||(t.BlobRefType={})),function(e){e[e.NewDocument=0]="NewDocument",e[e.EditDocument=1]="EditDocument",e[e.ViewOnlyDocument=2]="ViewOnlyDocument"}(t.OpenType||(t.OpenType={}));var i=function(){function e(){}return e.lowerIndexBound=1,e.maxNumberOfRows=1048576,e.maxNumberOfColumns=16384,e.firstColumnName="A",e.lastColumnName="XFD",e}();t.GridConstants=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryClassificationAnnotation=t.Annotation=void 0;var i=n(17),r=function(){function e(t){i.SchemaObject.assign(e,this,t)}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.M_},set:function(e){this.M_=e},enumerable:!1,configurable:!0}),e.getTypeName=function(){return"AugLoop_Core_Annotation"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Annotation=r;var o=function(){function e(t){i.SchemaObject.assign(e,this,t)}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.M_},set:function(e){this.M_=e},enumerable:!1,configurable:!0}),e.getTypeName=function(){return"AugLoop_Core_BinaryClassificationAnnotation"},e.getBaseTypes=function(){return["AugLoop_Core_Annotation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.BinaryClassificationAnnotation=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignalOperation=t.MicroSyncOperation=t.DeltaUpdateOperation=t.VisibilityOperation=t.FocusOperation=t.PurgeOperation=t.DeleteOperation=t.UpdateOperation=t.UpdateAnnotationMetaDataOperation=t.MoveOperation=t.AddOperation=t.OperationWithSiblingContext=t.Operation=t.ItemChangesDelta=t.ItemDelta=void 0;var i=n(17),r=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ItemDelta"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ItemDelta=r;var o=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ItemChangesDelta"},e.getBaseTypes=function(){return["AugLoop_Core_ItemDelta"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ItemChangesDelta=o;var a=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Operation"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Operation=a;var s=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_OperationWithSiblingContext"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.OperationWithSiblingContext=s;var u=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_AddOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AddOperation=u;var c=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MoveOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.MoveOperation=c;var l=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UpdateAnnotationMetaDataOperation=l;var d=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UpdateOperation=d;var p=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeleteOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DeleteOperation=p;var g=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_PurgeOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.PurgeOperation=g;var h=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_FocusOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.FocusOperation=h;var v=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_VisibilityOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.VisibilityOperation=v;var m=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeltaUpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DeltaUpdateOperation=m;var f=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MicroSyncOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.MicroSyncOperation=f;var y=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_SignalOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SignalOperation=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Signal=void 0;var i=n(17),r=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_Signal"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Signal=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TenantContextHolder=t.UserContextHolder=t.ContextHolder=t.DynamicContext=t.GridNeighborhoodContext=t.GridCell=t.SubDocument=t.Document=t.Session=t.TileGroup=t.Binary=t.Blob=void 0;var i=n(17),r=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Blob"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Blob=r;var o=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Binary"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Binary=o;var a=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_TileGroup"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TileGroup=a;var s=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Session"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Session=s;var u=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Document"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Document=u;var c=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_SubDocument"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SubDocument=c;var l=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridCell"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.GridCell=l;var d=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridNeighborhoodContext"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.GridNeighborhoodContext=d;var p=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DynamicContext"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DynamicContext=p;var g=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ContextHolder"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ContextHolder=g;var h=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UserContextHolder"},e.getBaseTypes=function(){return["AugLoop_Core_ContextHolder"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UserContextHolder=h;var v=function(){function e(t){i.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_TenantContextHolder"},e.getBaseTypes=function(){return["AugLoop_Core_ContextHolder"]},e.typeGuard=function(t){return i.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TenantContextHolder=v},function(e,t,n){"use strict";n.r(t),n.d(t,"getEngineStartPromise",(function(){return Rt})),n.d(t,"resetEngine",(function(){return Gt})),n.d(t,"setEngineStartPromise",(function(){return Mt})),n.d(t,"start",(function(){return kt})),n.d(t,"startInternal",(function(){return Bt})),n.d(t,"stop",(function(){return xt})),n.d(t,"initialize",(function(){return Jt})),n.d(t,"reset",(function(){return Yt}));var i=n(1);const r=window,o=r.OfficeBrowserFeedback=r.OfficeBrowserFeedback||{},a=o.floodgate=o.floodgate||{};function s(){return r}function u(){return r}class c{constructor(e,t){if(!e)throw new Error("name must not be null");if(!t)throw new Error("version must not be null");this.name=e,this.version=t}getName(){return this.name}getPlatform(){return c.PLATFORM}getVersion(){return this.version}}c.PLATFORM="Web";class l{constructor(e){if(!e)throw new Error("id must not be null");this.id=e}getId(){return this.id}}class d{constructor(e,t,n,i){this.id=e,this.locale=t,this.sessionId=n,this.version=i}getId(){return this.id}getLocale(){return this.locale}getSessionId(){return this.sessionId}getVersion(){return this.version}}class p{constructor(e,t,n,i){if(!e)throw new Error("name must not be null");if(!t)throw new Error("sessionId must not be null");if(!n&&0!==n||n<0)throw new Error("sequence must not be negative");this.name=e,this.id=t+p.ID_DELIMITER+n,this.sequence=n,this.sampleRate=i}getName(){return this.name}getId(){return this.id}getSource(){return p.SOURCE}getSchemaVersion(){return p.SCHEMA_VERSION}getSequence(){return this.sequence}getSampleRate(){return this.sampleRate}}p.ID_DELIMITER=".",p.SOURCE="MsoThin",p.SCHEMA_VERSION=1;class g{constructor(e){this.audienceGroup=e}getAudienceGroup(){return this.audienceGroup}}class h{constructor(e,t){this.name=e,this.version=t}getName(){return this.name}getVersion(){return this.version}}class v{constructor(e){this.id=e}getId(){return this.id}}class m{constructor(e,t){this.tenantId=t,this.primaryIdentityHash=e?e.trim():e,this.primaryIdentitySpace=this.generatePrimaryIdentitySpace()}getTenantId(){return this.tenantId}getPrimaryIdentityHash(){return this.primaryIdentityHash}getPrimaryIdentitySpace(){return this.primaryIdentitySpace}generatePrimaryIdentitySpace(){if(this.primaryIdentityHash){if(this.primaryIdentityHash.startsWith("a:"))return"UserObjectId";if(this.primaryIdentityHash.startsWith("p:"))return"MsaPuid";if(this.primaryIdentityHash.startsWith("ap:"))return"OrgIdPuid"}}}var f=n(0);let y=n(56);function S(){return y.AWT}class T{constructor(e,t,n,i,r,o,a,s,u){if(!e)throw new Error("tenantToken must not be null");if(!t)throw new Error("namespace must not be null");if(!n)throw new Error("app must not be null");if(!i)throw new Error("session must not be null");S().initialize(e),this.namespace=t,this.oesApp=n,this.oesSession=i,this.oesHost=r,this.oesRelease=o,this.oesBrowser=a,this.oesDevice=s,this.oesUser=u,this.sequence=1}static setApp(e,t){e["App.Name"]=t.getName(),e["App.Platform"]=t.getPlatform(),e["App.Version"]=t.getVersion()}static setSession(e,t){e["Session.Id"]=t.getId()}static setHost(e,t){t&&(e["Host.Id"]=t.getId(),e["Host.SessionId2"]=t.getSessionId(),e["Host.Version"]=t.getVersion(),e["Host.Locale"]=t.getLocale())}static setEvent(e,t){e["Event.Name"]=t.getName(),e["Event.Id"]=t.getId(),e["Event.Source"]=t.getSource(),e["Event.SchemaVersion"]=t.getSchemaVersion(),e["Event.Sequence"]=t.getSequence(),e["Event.SampleRate"]=t.getSampleRate()}static setRelease(e,t){t&&(e["Release.AudienceGroup"]=t.getAudienceGroup())}static setBrowser(e,t){t&&(e["Browser.Name"]=t.getName(),e["Browser.Version"]=t.getVersion())}static setDevice(e,t){t&&(e["Device.Id"]=t.getId())}static setUser(e,t){t&&(e["User.PrimaryIdentityHash"]=t.getPrimaryIdentityHash(),e["User.PrimaryIdentitySpace"]=t.getPrimaryIdentitySpace(),e["User.TenantId"]=t.getTenantId())}logEvent(e,t,n=1){if(!e)throw new Error("eventName must not be null");let i=new p(this.namespace+T.EVENT_NAME_DELIMITER+e,this.oesSession.getId(),this.sequence,n),r={};if(null!=t)for(const e in t)t.hasOwnProperty(e)&&(r[T.CUSTOM_PROPERTIES_FIELD_PREFIX+e]=t[e]);T.setApp(r,this.oesApp),T.setSession(r,this.oesSession),T.setHost(r,this.oesHost),T.setRelease(r,this.oesRelease),T.setEvent(r,i),T.setBrowser(r,this.oesBrowser),T.setDevice(r,this.oesDevice),T.setUser(r,this.oesUser),S().logEvent({name:i.getName(),properties:r}),this.sequence++}}T.EVENT_NAME_DELIMITER="_",T.CUSTOM_PROPERTIES_FIELD_PREFIX="Data.";var C=n(7),E=C.IFloodgateStorageProvider.FileType;const A={[E.CampaignDefinitions]:"obf-CampaignDefinitions",[E.CampaignStates]:"obf-CampaignStates",[E.FloodgateSettings]:"obf-FloodgateSettings",[E.GovernedChannelStates]:"obf-GovernedChannelStates",[E.SurveyActivationStats]:"obf-SurveyActivationStats",[E.SurveyEventActivityStats]:"obf-SurveyEventActivityStats",[E.TmsCache_CampaignContent]:"obf-TmsCampaignContent",[E.TmsCache_MessageMetadata]:"obf-TmsMessageMetadata",[E.TmsCache_UserGovernance]:"obf-TmsUserGovernance",[E.Tms_DynamicSettings]:"obf-TmsDynamicSettings",[E.LogLevelSettings]:"obf-LogLevelSettings",[E.UserFacts]:"obf-UserFacts",[E.DebugOverrides]:"obf-DebugOverrides"};class _{static isStorageAvailable(){try{let e="__storage_test__";return u().localStorage.setItem(e,e),u().localStorage.removeItem(e),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==u().localStorage.length}}static safeReadObject(e,t){if(!(e in E))return t;try{let n=A[e];const i=u().localStorage.getItem(n),r=!i||"{"!==i[0]&&"["!==i[0]?i:JSON.parse(i);return null!=r?r:t}catch(e){}return t}fileLock(e){}fileUnlock(e){}read(e){if(!(e in E))return"";let t,n=A[e];try{t=u().localStorage.getItem(n)}catch(e){return Ae().logEvent(ge.SURVEY_FLOODGATE_FILEREAD_FAILED,2,{ErrorMessage:e.toString(),FileName:n}),""}return t}write(e,t){if(!(e in E))return;let n=A[e];try{u().localStorage.setItem(n,t)}catch(e){return void Ae().logEvent(ge.SURVEY_FLOODGATE_FILEWRITE_FAILED,2,{ErrorMessage:e.toString(),FileName:n})}}}var I,b,O,F,w,D,L,N,P,U,M,R,B,k,x,G,V,z,j,q,H,W,J,Y,K,Q,Z,X,$,ee,te,ne,ie,re,oe,ae,se,ue,ce,le,de,pe=n(6);class ge{}ge.InApp=((I=class{}).UI=((b=class{}).Picker=((O=class{}).Shown=((F=class{}).VALUE={name:"InApp_UI_Picker_Shown"},F),O),b.Form=((w=class{}).Shown=((D=class{}).VALUE={name:"InApp_UI_Form_Shown"},D),w.Submit=((L=class{}).VALUE={name:"InApp_UI_Form_Submit"},L),w),b),I),ge.SURVEY_FLOODGATE_CAMPAIGNLOAD_FAILED={name:"Survey_Floodgate_CampaignLoad_Failed"},ge.SURVEY_FLOODGATE_FILEREAD_FAILED={name:"Survey_Floodgate_FileRead_Failed"},ge.SURVEY_FLOODGATE_FILEWRITE_FAILED={name:"Survey_Floodgate_FileWrite_Failed"},ge.SURVEY_FLOODGATE_TRIGGERMET={name:"Survey_Floodgate_TriggerMet"},ge.SURVEY_FLOODGATE_USERSELECTED={name:"Survey_Floodgate_UserSelected"},ge.SURVEY_UI_FORM_SHOWN={name:"Survey_UI_Form_Shown"},ge.SURVEY_UI_FORM_SUBMIT={name:"Survey_UI_Form_Submit"},ge.SURVEY_UI_FORM_SECONDARY_SUBMIT={name:"Survey_UI_Form_Secondary_Submit"},ge.SURVEY_UI_FORM_SUBMIT_ERROR={name:"Survey_UI_Form_Submit_Error"},ge.SURVEY_UI_FORM_USERCLOSED={name:"Survey_UI_Form_UserClosed"},ge.SURVEY_UI_FORM_NO_RETURN_TYPE={name:"Survey_UI_Form_No_Return_Type"},ge.SURVEY_UI_PROMPT_AUTODISMISSED={name:"Survey_UI_Prompt_AutoDismissed"},ge.SURVEY_UI_PROMPT_SHOWN={name:"Survey_UI_Prompt_Shown"},ge.SURVEY_UI_PROMPT_USERCLOSED={name:"Survey_UI_Prompt_UserClosed"},ge.SURVEY_UI_PROMPT_CLICKED={name:"Survey_UI_Prompt_Clicked"},ge.SURVEY_UI_REDIRECTIONFAILURE={name:"Survey_UI_RedirectionFailure"},ge.GOVERNANCE_SERVICEFAILURE={name:"Gorvenance_ServiceFailure"},ge.GOVERNANCE_SERVICERESULT={name:"Gorvenance_ServiceResult"},ge.DYNAMICTRANSPORT_POST_ERROR={name:"DynamicTransport_Post_Error"},ge.FEEDBACK_SURVEYSDISABLED_AADC={name:"Feedback_SurveysDisabled_AADC"},ge.SURVEY_UI_DISABLED_AADC={name:"Survey_UI_Prevented_AADC"},ge.PERSONALIZER_SERVICEREWARDRESULT={name:"Personalizer_ServiceRewardResult"},ge.PERSONALIZER_CLIENTFAILURE={name:"Personalizer_ClientFailure"},ge.Shared=((N=class{}).Upload=((P=class{}).Failed=((U=class{}).VALUE={name:"Shared_Upload_Failed"},U),P.Prevented=((M=class{}).VALUE={name:"Shared_Upload_Prevented_AADC"},M),P),N.Screenshot=((R=class{}).Render=((B=class{}).Failed=((k=class{}).VALUE={name:"Shared_Screenshot_Render_Failed"},k),B.Success=((x=class{}).VALUE={name:"Shared_Screenshot_Render_Success"},x),B),R.GetContent=((G=class{}).Failed=((V=class{}).DefaultImage=((z=class{}).Returned=((j=class{}).VALUE={name:"Shared_Screenshot_GetContent_Failed_DefaultImage_Returned"},j),z),V),G),R),N),ge.WebSurfaces=((q=class{}).Common=((H=class{}).Error=((W=class{}).VALUE={name:"WebSurfaces_Common_Error"},W),H.Info=((J=class{}).VALUE={name:"WebSurfaces_Common_Info"},J),H),q.Messaging=((Y=class{}).Requests=((K=class{}).VALUE={name:"WebSurfaces_Messaging_Requests"},K),Y),q),ge.UserFacts=((Q=class{}).Common=((Z=class{}).Error=((X=class{}).VALUE={name:"UserFacts_Common_Error"},X),Z.Info=(($=class{}).VALUE={name:"UserFacts_Common_Info"},$),Z),Q.LocalFact=((ee=class{}).Error=((te=class{}).VALUE={name:"UserFacts_LocalFact_Error"},te),ee),Q.Messaging=((ne=class{}).Requests=((ie=class{}).VALUE={name:"UserFacts_Messaging_Requests"},ie),ne),Q.AugLoop=((re=class{}).Requests=((oe=class{}).VALUE={name:"UserFacts_AugLoop_Requests"},oe),re.Error=((ae=class{}).VALUE={name:"UserFacts_AugLoop_Error"},ae),re),Q.Provider=((se=class{}).Info=((ue=class{}).VALUE={name:"UserFacts_Provider_Summary"},ue),se),Q),ge.Common=((ce=class{}).Error=((le=class{}).VALUE={name:"Common_Error"},le),ce.Info=((de=class{}).VALUE={name:"Common_Info"},de),ce);const{isNOU:he}=f;class ve{constructor(e){this.useLocalStorage=!1,this.cachedItems={},this.initialize(e)}setContentItem(e,t,n){const i=this.createItem(e,t,n);return this.setItem(i),i}getItemContent(e){const t=this.getItem(e);return t&&t.content}has(e){return e in this.cachedItems}isItemExpired(e){const t=this.getItem(e);return!t||!t.expiryDate||t.expiryDate<new Date}createItem(e,t,n){return{contentType:e,content:t,expiryDate:new Date(Date.now()+n),lastRetrievedDate:new Date}}setItem(e){this.cachedItems[e.contentType]=e,this.updateItemInLocalStorage(e)}getItem(e){return this.cachedItems[e]}initialize(e){this.cachedItems={},_.isStorageAvailable()&&(this.floodgateStorage=new _,this.useLocalStorage=!0,this.initCachedItemsFromLocalStorage(e))}initCachedItemsFromLocalStorage(e){if(this.useLocalStorage&&!he(e))for(let t of e){let e=this.floodgateStorage.read(this.mapContentTypeToFloodgateProviderKey(t));if(!he(e)){const t=this.parseObjectFromCache(e);he(t)||(t.expiryDate="string"==typeof t.expiryDate?new Date(t.expiryDate):t.expiryDate,this.cachedItems[t.contentType]=t)}}}updateItemInLocalStorage(e){this.useLocalStorage&&this.floodgateStorage.write(this.mapContentTypeToFloodgateProviderKey(e.contentType),JSON.stringify(e))}parseObjectFromCache(e){try{return JSON.parse(e)}catch(e){return null}}mapContentTypeToFloodgateProviderKey(e){switch(e){case"CampaignContent":return pe.FileType.TmsCache_CampaignContent;case"MessageMetadata":return pe.FileType.TmsCache_MessageMetadata;case"UserGovernance":return pe.FileType.TmsCache_UserGovernance;case"DynamicSettings":return pe.FileType.Tms_DynamicSettings;case"LogLevelSettings":return pe.FileType.LogLevelSettings;case"UserFacts":return pe.FileType.UserFacts;default:throw new Error("Unmapped ContentType in TmsCache")}}}const{isNOU:me}=f;let fe=null;function ye(e,t){try{if(!fe&&_.isStorageAvailable()&&(fe=new ve(["DynamicSettings"])),!fe)return t;const n=fe.getItemContent("DynamicSettings");if(!me(n)&&n.hasOwnProperty(e)&&!me(n[e])){const i=n[e];if("number"==typeof t&&"number"!=typeof i){if("string"==typeof i){const e=-1===i.indexOf(".")?parseInt(i,10):parseFloat(i);return isNaN(e)?t:e}return t}return i}}catch(t){Ae().logEvent(ge.Common.Error.VALUE,2,{ErrorMessage:"Error reading dynamic setting "+(t&&t.message),Type:e})}return t}const{isNOU:Se}=f;let Te,Ce;function Ee(e,t,n,i,r){const o=e.telemetryGroup?e.telemetryGroup:{},a=e.webGroup?e.webGroup:{};Te=new _e(class{static create(e,t,n,i,r,o,a,s,u){return new T(e,t,n,i,r,o,a,s,u)}}.create(Ie.getTenantToken(e.environment),"Office_Feedback",new c(t,n),new l(i),new d(e.appId.toString(),e.originalLocale,e.sessionId,e.build),new g(o.audienceGroup),new h(a.browser,a.browserVersion),new v(o.deviceId),new m(o.loggableUserId?o.loggableUserId:e.cid,o.tenantId)),r,e),Ce=e.environment}function Ae(){return Te}class _e{constructor(e,t,n){if(this.SAMPLING_RESULT=Math.random(),!e)throw new Error("telemetryLogger must not be null");this.telemetryLogger=e,this.eventSampling=t,this.initOptionsCommon=n}logEvent(e,t,n,i){if(!e)throw new Error("eventId must not be null");let r=_e.DEFAULT_SAMPLE_RATE;if(this.isEventSampled(e.name)?r=this.getEventSamplingRate(e.name):void 0!==i&&(r=i),Se(t)||0===t){if(0===Ce){const e="logSeverity must not be null or none";this.isConsoleLogEnabled&&console&&console.log("Floodgate event: ",_e.EVENT_NAME,e),this.telemetryLogger.logEvent(_e.EVENT_NAME,{ErrorMessage:e},r)}return!1}return(n=n||{})[_e.EVENT_ID]=e.name,(this.isLoggingEnabled(t,r)||this.isEventTelemetryEnabled(e.name))&&this.telemetryLogger.logEvent(_e.EVENT_NAME,n,r),this.isConsoleLogEnabled&&console&&console.log("Floodgate event: ",_e.EVENT_NAME,t,n),!0}logLocal(e,...t){this.isLoggingEnabled(e)&&this.isConsoleLogEnabled&&console&&console.log("LPP FG: ",e,t)}getUserSamplingRate(){return this.SAMPLING_RESULT}isEventTelemetryEnabled(e){var t,n,i,r;try{if(!this.dynamicLogSettings)return!1;const o=null===(n=null===(t=this.initOptionsCommon)||void 0===t?void 0:t.appId)||void 0===n?void 0:n.toString(),a=null===(r=null===(i=this.initOptionsCommon)||void 0===i?void 0:i.originalLocale)||void 0===r?void 0:r.toLowerCase(),s="content_"+e,u=this.dynamicLogSettings[`${s}_${o}_${a}`]||this.dynamicLogSettings[`${s}_${o}`]||this.dynamicLogSettings[`${s}_${a}`]||this.dynamicLogSettings[s];return null==u?void 0:u.isEnabled}catch(e){this.isConsoleLogEnabled&&console.log("FG: Error checking for dynamic log settings: ",e)}return!1}isLoggingEnabled(e,t=1){if(Se(this.logLevel)){const e=this.getCurrentLogLevel();this.logLevel=Se(e)?2:e}return e<=this.logLevel&&this.SAMPLING_RESULT<=t&&0!==t}getCurrentLogLevel(){try{const e="undefined"!=typeof URLSearchParams&&new URLSearchParams(window.location.search)||void 0;let t=e&&e.get("obfconsolelog");if(!t){const e="undefined"!=typeof document&&document.referrer;t=e&&-1!==e.indexOf("obfconsolelog")}t&&(this.isConsoleLogEnabled=!0);const n=e&&e.get("obfloglevel");if(!Se(n))return this.isConsoleLogEnabled=!0,parseInt(n,10);if(_.isStorageAvailable()){let e=(new _).read(pe.FileType.LogLevelSettings);e||(e=ye("LogLevelSettings",""));const t=e&&this.parseObject(e);if(t){this.dynamicLogSettings=t;let e=t.content;if(this.initOptionsCommon){const n=this.initOptionsCommon.appId&&this.initOptionsCommon.appId.toString(),i=this.initOptionsCommon.originalLocale&&this.initOptionsCommon.originalLocale.toLowerCase();e=t[`content_${n}_${i}`]||t["content_"+n]||t["content_"+i]||t.content}if(e)return e.consoleLog&&(this.isConsoleLogEnabled=!0),e.logLevel}}}catch(e){return void(this.isConsoleLogEnabled&&console.log("Error while getting the current log level: ",e))}return null}parseObject(e){try{return JSON.parse(e)}catch(e){return this.isConsoleLogEnabled&&console.log("Error while parsing the json string for log level: ",e),null}}getEventSamplingRate(e){let t=1;return this.eventSampling.event&&e in this.eventSampling.event&&(t=this.eventSampling.event[e]),t}isEventSampled(e){return!(!this.eventSampling.event||!(e in this.eventSampling.event))}}_e.EVENT_NAME="SDK",_e.EVENT_ID="EventId",_e.DEFAULT_SAMPLE_RATE=1;class Ie{static getTenantToken(e){return 0===e?Ie.TENANT_TOKEN_PRODUCTION:Ie.TENANT_TOKEN_PRE_PRODUCTION}}Ie.TENANT_TOKEN_PRODUCTION="d79e824386c4441cb8c1d4ae15690526-bd443309-5494-444a-aba9-0af9eef99f84-7360",Ie.TENANT_TOKEN_PRE_PRODUCTION="2bf6a2ffddca4a80a892a0b182132961-625cb102-8b0c-480e-af53-92e48695d08d-7736";let be=!1,Oe=!1;!function(e){o.isFeedbackSurveyEnabledByAADC=e}((function(){return Oe}));var Fe=n(2),we=n(5);function De(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((i=i.apply(e,t||[])).next())}))}const{isNOU:Le}=f;class Ne{constructor(e){this.sessionId=e}sendGetRequest(e,t,n,i){return De(this,void 0,void 0,(function*(){const r={method:"GET",headers:this.createHeaders(t)};return n?this.timeoutFetch(e,r,null!=i?i:5e3):fetch(e,r)}))}sendPostRequest(e,t,n,i,r){return De(this,void 0,void 0,(function*(){const o={method:"POST",headers:this.createHeaders(n),body:t};return i?this.timeoutFetch(e,o,null!=r?r:5e3):fetch(e,o)}))}createHeaders(e){const t="undefined"!=typeof Headers&&new Headers;return t&&(Le(e)||t.append("Authorization","Bearer "+e),t.append("X-CorrelationId",f.guid()),this.sessionId&&t.append("X-UserSessionId",this.sessionId)),t}timeoutFetch(e,t={},n){return new Promise((i,r)=>{fetch(e,t).then(i,r),setTimeout(()=>r(new Error("Service request timed out")),n)})}}function Pe(e,t=!0){let n="";for(const i in e||[])if(e.hasOwnProperty(i)){const r=e[i];if(null!=r&&"object"!=typeof r){n+=(n?"&":"")+`${i}=${t?encodeURIComponent(r):r}`}}return n}var Ue=n(33);function Me(e){return new Promise(t=>{setTimeout(t,e)})}function Re(e,t){const n=e&&e[t];return n||Object.getOwnPropertyDescriptor(e,t)?n:void 0}function Be(e=100){return De(this,void 0,void 0,(function*(){let t=Re(window,"augLoop");if(!t){const n=ye("TulipsAugLoopPackageDelayLoad",-1);if(n>0)yield Me(n),t=Re(window,"augLoop");else{const n=ye("TulipsAugLoopLoadRetryTimes",5);t=yield function e(t,n,i,r=100){return De(this,void 0,void 0,(function*(){const o=Re(t,n);return o||0===i?o:(yield Me(r),e(t,n,i-1,r))}))}(window,"augLoop",n,e),t||(t=yield function(e,t){if(!e)return Promise.resolve(null);const n=Re(e,t);return n?Promise.resolve(n):new Promise((n,i)=>{let r;Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:()=>r,set:e=>{r=e,n(r)}})})}(window,"augLoop")),e>0&&(yield Me(e))}}return t}))}function ke(e,t,n=100){return De(this,void 0,void 0,(function*(){let i=t&&(yield t());if(!i){if(!(yield Be(n)))throw new Error("Unable to get AL runtime");const e=window.augLoop.ALFactoryGlobal.getAugLoopRuntimeManager().getSession();if(!e)throw new Error("Unable to get AL session promise");if(i=yield e,!i)throw new Error("Unable to get AL session")}return function(e,t){return new Promise((n,i)=>{e.activateAnnotation(t,{callback:e=>{try{const i=(e&&e.items?e.items:[]).filter(e=>t===Ue.SchemaObject.getTypeNameFor(e.body));n(i&&i[0]&&i[0].body)}catch(e){n({error:e})}}})})}(i,e)}))}class xe{}class Ge{constructor(e,t,n,i,r,o,a,s,u,c,l,d,p,g,h){var v,m;this.locale="en-us",this.country="US",this.locale=i,this.country=r,this.authTokenCallback=a,this.augLoopCallback=s,this.app=e,this.platform=t,this.version=n,this.sessionId=o,this.campaignFlights=u,this.campaignParameters=c,this.ageGroup=l,this.authenticationType=d,this.messagingServiceSettings=g;const f=p&&-1!==["dogfood","edog","int","microsoft"].indexOf(p.toLowerCase()),y=f?null===(v=this.messagingServiceSettings)||void 0===v?void 0:v.messagingServiceIntUrl:null===(m=this.messagingServiceSettings)||void 0===m?void 0:m.messagingServiceProdUrl,S=f?"https://messaging.officeppe.com/lifecycle/":"https://messaging.office.com/lifecycle/";this.tmsBaseUrlPrefix=y||S,this.tmsgCache=this.tmsgCache||h||new ve(["MessageMetadata","UserGovernance","CampaignContent","DynamicSettings","LogLevelSettings","UserFacts"])}getContent(e){return De(this,void 0,void 0,(function*(){this.tmsgCache.isItemExpired(e)&&(yield this.refreshItemsInCacheFromTmsService([e]));return this.retrieveCacheItemAndCreateContentResponse(e)}))}getMultipleContents(e){return De(this,void 0,void 0,(function*(){yield this.refreshItemsInCacheFromTmsService(e);const t=new Array,n=new Array;for(let n of e){const e=this.createCachedContentResponse(n);t.push(e)}return this.refreshItemsInCacheFromTmsService(n),t}))}getUserFactsContent(e){return De(this,void 0,void 0,(function*(){yield this.refreshItemsInCacheFromTulipsService(e);return this.retrieveCacheItemAndCreateContentResponse(e)}))}sendBeaconRequestToService(e,t,n,i,r,o,a,s){return De(this,void 0,void 0,(function*(){this.sessionId=a,this.authTokenCallback=s;const u=ye("TmsAppId",we.c.TMSAppID),c=yield this.getAuthToken(u);let l=void 0;c||(l=this.authTokenCallback.getUserPuid&&(yield this.authTokenCallback.getUserPuid()));const d=+new Date;try{const a={app:e,country:o,locale:r,platform:n,puid:l,version:i},s=JSON.stringify({actionName:t.actionName,actionUrl:t.actionUrl}),u=yield this.sendRequest(a,c,"TmsActionUrl",this.tmsBaseUrlPrefix+"SetCampaignAction?",s,"POST");return!(!u||200!==u.status)||(Ae().logEvent(ge.WebSurfaces.Common.Error.VALUE,2,this.createTelemetryData(d,u,"Beacon"+t.actionName)),!1)}catch(e){return Ae().logEvent(ge.WebSurfaces.Common.Error.VALUE,2,Object.assign({ErrorMessage:"Error fetching from TMS SetCampaignAction endpoint"+(e&&e.message?": "+e.message:"")},this.createTelemetryData(d,null,"Beacon"+t.actionName))),!1}}))}getCachedContent(e){return this.tmsgCache.getItemContent(e)}getAugLoopUserFactsContent(e){return De(this,void 0,void 0,(function*(){this.tmsgCache.isItemExpired("UserFacts")&&(yield this.refreshUserFactsInCacheFromAugLoop());return this.retrieveCacheItemAndCreateContentResponse(e)}))}refreshUserFactsInCacheFromAugLoop(){return De(this,void 0,void 0,(function*(){if(!this.tmsgCache.isItemExpired("UserFacts")){const e=this.tmsgCache.getItemContent("UserFacts");return Ae().logEvent(ge.UserFacts.AugLoop.Requests.VALUE,3,{Count:e?e.length:-1,Type:"AugLoopUserFactsCached",Flights:this.campaignFlights}),e}const e=+new Date;let t;try{const n=ye("TulipsAugLoopAnnotationName","AugLoop_User_UserLifecycleFactsAnnotation"),i=this.augLoopCallback.getRuntimeSession,r=yield ke(n,i);if(r&&r.userFacts)t=this.addClientIngestionTimeAndNormalizeKeysInArray(r.userFacts),this.tmsgCache.setContentItem("UserFacts",t,864e5),Ae().logEvent(ge.UserFacts.AugLoop.Requests.VALUE,3,Object.assign({Count:t?t.length:-1},this.createTelemetryData(e,null,"AugLoopUserFacts")));else{const t=r&&r.error;Ae().logEvent(ge.UserFacts.AugLoop.Error.VALUE,2,Object.assign({ErrorMessage:"Error getting augloop facts "+(t&&t.toString())},this.createTelemetryData(e,null,"AugLoopUserFacts")))}}catch(t){Ae().logEvent(ge.UserFacts.AugLoop.Error.VALUE,2,Object.assign({ErrorMessage:"Error getting facts "+(t&&t.message)},this.createTelemetryData(e,null,"AugLoopUserFacts")))}return t}))}createTelemetryData(e,t,n){const{headers:i,status:r,statusText:o}=t||{},a=i&&i.get("X-UserSessionId"),s=i&&i.get("X-CorrelationId");return{Type:n,TimeMilliseconds:+new Date-e,SessionId:a||this.sessionId,CorrelationId:s||void 0,HttpStatusCode:r||void 0,HttpStatusText:o||void 0,Flights:this.campaignFlights}}sendRequest(e,t,n,i,r,o){this.tmsgTransport=this.tmsgTransport||new Ne(this.sessionId);const a=Pe(e),s=ye(n,i);return"POST"===o?this.tmsgTransport.sendPostRequest(s+a,r,t):this.tmsgTransport.sendGetRequest(s+a,t)}retrieveCacheItemAndCreateContentResponse(e){const t=this.createCachedContentResponse(e);return this.tmsgCache.isItemExpired(e)&&("UserFacts"===e?this.refreshItemsInCacheFromTulipsService(e):this.refreshItemsInCacheFromTmsService([e])),t}createCachedContentResponse(e){const t=new xe;return t.content=this.tmsgCache.getItemContent(e),t.contentType=e,t}getAuthToken(e){return De(this,void 0,void 0,(function*(){if(!this.authTokenCallback||!this.authTokenCallback.getAuthToken)return null;const t=+new Date,n=n=>({ErrorMessage:n,SessionId:this.sessionId,TimeMilliseconds:+new Date-t,Type:e});try{const t=yield this.authTokenCallback.getAuthToken(e);return Ae().logEvent(ge.WebSurfaces.Common.Info.VALUE,3,n()),t}catch(e){Ae().logEvent(ge.WebSurfaces.Common.Error.VALUE,2,n("Error getting token "+(e&&e.message?": "+e.message:"")))}return null}))}refreshItemsInCacheFromTmsService(e){return De(this,void 0,void 0,(function*(){if(0===e.length)return;const t=new Array;for(let n of e)this.tmsgCache.isItemExpired(n)&&t.push(n);if(0===t.length)return;-1===e.indexOf("DynamicSettings")&&e.push("DynamicSettings");const n=ye("TmsAppId",we.c.TMSAppID),i=yield this.getAuthToken(n);let r=void 0;i||(r=this.authTokenCallback.getUserPuid&&(yield this.authTokenCallback.getUserPuid()));const o=+new Date;try{const t=document&&(document.documentElement||document.getElementsByTagName("body")[0]),n={pageWidth:window.innerWidth||t.clientWidth,pageHeight:window.innerHeight||t.clientHeight,screenWidth:screen?screen.width:void 0,screenHeight:screen?screen.height:void 0,colorDepth:screen?screen.colorDepth:void 0},a=_.safeReadObject(pe.FileType.DebugOverrides,{}),s=a.replaceTmsQueryParams||Object.assign(Object.assign({country:this.country,locale:this.locale,app:this.app,platform:this.platform,version:this.version,campaignParams:Pe(n)+"&more=true&"+(this.campaignParameters||""),contentType:e.join(";"),puid:r,OFC_FLIGHTS:this.campaignFlights},a.addTmsQueryParams||{}),{ageGroup:this.ageGroup,authenticationType:this.authenticationType}),u=yield this.sendRequest(s,i,"TmsServiceUrl",this.tmsBaseUrlPrefix+"CampaignMetadataAggregator?");if(200===u.status){const t=yield u.json();-1!==e.indexOf("MessageMetadata")&&void 0!==t.MessageMetadata&&this.tmsgCache.setContentItem("MessageMetadata",t.MessageMetadata,ye("TmsMessageMetadataExpiry",144e5)),-1!==e.indexOf("UserGovernance")&&void 0!==t.UserGovernanceRules&&this.tmsgCache.setContentItem("UserGovernance",t.UserGovernanceRules,ye("TmsUserGovernanceRulesExpiry",144e5)),-1!==e.indexOf("CampaignContent")&&void 0!==t.CampaignContent&&this.tmsgCache.setContentItem("CampaignContent",t.CampaignContent,ye("TmsCampaignContentExpiry",144e5)),void 0!==t.DynamicSettings&&this.tmsgCache.setContentItem("DynamicSettings",t.DynamicSettings,ye("TmsDynamicSettingsExpiry",144e5)),void 0!==t.LogLevelSettings&&this.tmsgCache.setContentItem("LogLevelSettings",t.LogLevelSettings,ye("TmsLogLevelSettingsExpiry",144e5)),Ae().logEvent(ge.WebSurfaces.Messaging.Requests.VALUE,3,this.createTelemetryData(o,u,e.join(";")))}else Ae().logEvent(ge.WebSurfaces.Common.Error.VALUE,2,this.createTelemetryData(o,u,e.join(";")))}catch(t){Ae().logEvent(ge.WebSurfaces.Common.Error.VALUE,2,Object.assign({ErrorMessage:"Error fetching from TMS"+(t&&t.message?": "+t.message:"")},this.createTelemetryData(o,null,e.join(";"))))}}))}refreshItemsInCacheFromTulipsService(e){return De(this,void 0,void 0,(function*(){if(!this.tmsgCache.isItemExpired(e))return;const t=ye("TulipsAppId",we.c.TULIPSAppID),n=yield this.getAuthToken(t);if(!n)return;const i=+new Date;try{const t=yield this.sendRequest({},n,"TulipsServiceUrl","https://substrate.office.com/OfficePersonalizationUserLifecycle/api/facts");if(200===t.status||204===t.status){const n=yield t.json();if(-1!==e.indexOf("UserFacts")&&void 0!==n){const e=this.addClientIngestionTimeAndNormalizeKeys(n);this.tmsgCache.setContentItem("UserFacts",e,864e5)}Ae().logEvent(ge.UserFacts.Messaging.Requests.VALUE,3,this.createTelemetryData(i,t,e))}else Ae().logEvent(ge.UserFacts.Common.Error.VALUE,2,this.createTelemetryData(i,t,e))}catch(t){Ae().logEvent(ge.UserFacts.Common.Error.VALUE,2,Object.assign({ErrorMessage:"Error fetching from TULIPS"+(t&&t.message?": "+t.message:"")},this.createTelemetryData(i,null,e)))}}))}addClientIngestionTimeAndNormalizeKeys(e){const t=new Date(Date.now()).toISOString();return e.map(e=>{const n=this.normalizeKeys(e);return n.clientIngestionDateTime=t,n})}addClientIngestionTimeAndNormalizeKeysInArray(e){const t=new Date(Date.now()).toISOString();return e.map(e=>{const n=this.normalizeKeys(e);return n.clientIngestionDateTime=t,n})}normalizeKeys(e){const t={};for(const n of Object.keys(e)){t[n.charAt(0).toLowerCase()+n.substring(1)]=e[n]}return t}}class Ve{constructor(){var e,t;this.configuration=i.get();const n=this.configuration&&this.configuration.getFloodgateInitOptions(),r=this.configuration&&this.configuration.getCommonInitOptions(),o=n&&n.authTokenCallback;if(o&&(o.getAuthToken||o.getUserPuid)||this.isAugLoopEnabled()){const i=this.configuration.getCommonInitOptions();this.tmsgClient=new Ge(i.appId.toString(),"Web",i.build,i.originalLocale,this.extractCountryFromLocale(i.originalLocale),this.configuration.getSdkSessionId(),n.authTokenCallback,n.augLoopCallback,n.campaignFlights,n.campaignQueryParameters,r.ageGroup,r.authenticationType,(null===(e=r.telemetryGroup)||void 0===e?void 0:e.audienceGroup)||(null===(t=r.telemetryGroup)||void 0===t?void 0:t.audience),n.messagingServiceSettings)}}getCampaignDefinitions(){const e=function(){const e=_.safeReadObject(pe.FileType.DebugOverrides,{});return e&&e.tmsResponse&&e.tmsResponse.CampaignContent&&{contentType:"CampaignContent",content:e.tmsResponse.CampaignContent}}();return e&&e.content?Promise.resolve(e.content):this.tmsgClient?this.tmsgClient.getContent("CampaignContent").then(({content:e})=>e):Promise.resolve(null)}getCachedCampaignDefinitions(){var e;return null===(e=this.tmsgClient)||void 0===e?void 0:e.getCachedContent("CampaignContent")}getUserGovernanceRules(){return this.tmsgClient?this.tmsgClient.getContent("UserGovernance").then(({content:e})=>e):Promise.resolve(null)}getMessageMetadata(){return this.tmsgClient?this.tmsgClient.getContent("MessageMetadata").then(({content:e})=>e):Promise.resolve(null)}getUserFacts(){const e=function(){const e=_.safeReadObject(pe.FileType.DebugOverrides,{});return e&&e.userFactsResponse&&{contentType:"UserFacts",content:e.userFactsResponse}}();if(e&&e.content)return Promise.resolve(e.content);if(!this.tmsgClient)return Promise.resolve(null);if(this.isAugLoopEnabled()){const e=ye("TulipsLoadTimeout",1e3);return Object(f.createTimeoutPromise)(e,this.getAugLoopUserFacts()).then(e=>e).catch(()=>this.getSubstrateUserFacts())}return this.getSubstrateUserFacts()}getCachedUserFacts(){var e;return null===(e=this.tmsgClient)||void 0===e?void 0:e.getCachedContent("UserFacts")}setCampaignAction(e){if(!this.tmsgClient)return;const t=this.configuration.getCommonInitOptions(),n=this.configuration.getFloodgateInitOptions();return this.tmsgClient.sendBeaconRequestToService(t.appId.toString(),e,"Web",t.build,t.originalLocale,this.extractCountryFromLocale(t.originalLocale),this.configuration.getSdkSessionId(),n.authTokenCallback)}extractCountryFromLocale(e){if(!e)return;const t=e.split("-");return 2===t.length?t[1]:void 0}getSubstrateUserFacts(){return this.tmsgClient?this.tmsgClient.getUserFactsContent("UserFacts").then(({content:e})=>e):Promise.resolve(null)}getAugLoopUserFacts(){return this.tmsgClient?this.tmsgClient.getAugLoopUserFactsContent("UserFacts").then(({content:e})=>e):Promise.resolve(null)}isAugLoopEnabled(){var e,t,n;return null===(n=null===(t=null===(e=this.configuration)||void 0===e?void 0:e.getFloodgateInitOptions())||void 0===t?void 0:t.augLoopCallback)||void 0===n?void 0:n.isEnabled}}let ze,je;function qe(){return ze||(ze=new Ve),ze}function He(){je||(je=function(e,t=window.origin){return new Promise((n,i)=>{const r=document.createElement("script");r.async=!0,r.readyState?r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||(r.onreadystatechange=null,n())}:r.onload=function(){n()},r.onerror=function(){i()},r.src=e,t&&"null"!==t&&(r.crossOrigin="anonymous");const o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(r,o)})}(function(){var e,t,n,r;const o=i.get().getCommonInitOptions(),a=(null===(e=o.telemetryGroup)||void 0===e?void 0:e.audienceGroup)||(null===(t=o.telemetryGroup)||void 0===t?void 0:t.audience),s=a&&-1!==["dogfood","edog","int","microsoft"].indexOf(a.toLowerCase()),u=s?null===(n=o.webSurfacesSettings)||void 0===n?void 0:n.webSurfacesIntUrl:null===(r=o.webSurfacesSettings)||void 0===r?void 0:r.webSurfacesProdUrl,c=s?we.a.WebSurfacesIntLink:we.a.WebSurfacesProdLink;return u||ye(s?"WebSurfacesIntLink":"WebSurfacesProdLink",c)}(),null))}class We{makeSurveyLauncher(e){return this.AcceptsSurvey(e)?new Je(e):null}AcceptsSurvey(e){return!Object(f.isNOU)(e)&&e.getType()===C.ISurvey.Type.GenericMessagingSurface&&e.getLauncherType().toLocaleLowerCase()===We.LAUNCHER_TYPE}}We.LAUNCHER_TYPE="coachingux";class Je{constructor(e){var t;this.survey=e,!je&&e&&e.getSurveyInfo&&(null===(t=e.getSurveyInfo())||void 0===t?void 0:t.getBusinessLevel())===C.ISurveyInfo.BusinessLevel.Critical&&setTimeout(He,1e3)}launch(e){const t=this.survey&&this.survey.getSurveyInfo(),n=t&&t.getMetadata(),r=n&&n.getContentMetadata();if(!r)return;const o=new Date,a=()=>{const e=u();return e&&e.OfficeWebSurfaces},s=n=>{const i=a();n&&i.Initialize(n),i.RemoveSurface();const o=Object.assign(Object.assign({},r),{surfaceContext:{surveyForm:this.survey,surveyParams:e}});i.RenderSurface(o,null,t.getBackEndId())},c=e=>{Ae().logEvent(ge.WebSurfaces.Common.Error.VALUE,1,{ErrorMessage:"Error loading websurfaces"+(e&&e.message?": "+e.message:""),TimeMilliseconds:Date.now()-+o})};try{if(a())return void s();He(),je.then(()=>{const e=i.get().getCommonInitOptions(),n=i.get().getFloodgateInitOptions(),r=n&&n.onSurveyActivatedCallback,a=Object.assign(Object.assign(Object.assign({},e),n),{beaconCallback:e=>{if(e)return qe().setCampaignAction(e)},surfaceInitTime:o,surfaceId:t.getBackEndId(),logSessionId:i.get().getSdkSessionId(),logSettings:ye("LogLevelSettings",void 0),renderer:r,renderCallback:r&&r.onTeachingCampaignRender});s(a)}).catch(e=>{c(e)})}catch(e){c(e)}}}class Ye{constructor(e){if(this.showPrompt=!0,this.showEmailRequest=!1,!e)throw Error("survey must not be null");if(this.survey=e,e.getType()===C.ISurvey.Type.Intercept){this.isIntercept=!0;let t=e.getComponent("Intercept");if(!t)throw Error("intercept component must not be null");this.intercept=t}else{this.isIntercept=!1;let t=e.getComponent("Prompt"),n=e.getComponent("Comment"),i=e.getComponent("Rating"),r=e.getComponent("CVSurvey");if(!t)throw Error("prompt component must not be null");if(this.prompt=t,this.showEmailRequest=e.getSurveyInfo().isAdditionalDataRequested(0),!n)throw Error("comment component must not be null");if(this.comment=n,!i)throw Error("rating component must not be null");if(this.rating=i,r&&(this.cvSurvey=r,this.getLauncherType()===we.e&&!this.getCVSurveyFormId()))throw Error("CvSurveyId should not be null")}}getLauncherType(){return this.isIntercept?void 0:this.survey.getLauncherType()}getCVSurveyFormId(){return this.isIntercept?void 0:this.cvSurvey.getFormId()}getPreGeneratedClientFeedbackId(){return this.survey.getPreGeneratedClientFeedbackId()}getPromptQuestion(){return this.isIntercept?void 0:this.prompt.getQuestion()}getTitle(){return this.isIntercept?void 0:this.prompt.getTitle()}getPromptYesButtonText(){return this.isIntercept?void 0:this.prompt.getYesButtonText()}getPromptNoButtonText(){return this.isIntercept?void 0:this.prompt.getNoButtonText()}getRatingValuesAscending(){return this.isIntercept?void 0:this.rating.getRatingValuesAscending()}getRatingQuestion(){return this.isIntercept?void 0:this.rating.getQuestion()}getCommentQuestion(){return this.isIntercept?void 0:this.comment.getQuestion()}getInterceptTitle(){return this.isIntercept?this.intercept.getTitle():void 0}getInterceptQuestion(){return this.isIntercept?this.intercept.getQuestion():void 0}getInterceptUrl(){return this.isIntercept?this.intercept.getUrl():void 0}setValues(e,t){this.isIntercept||(this.rating.setSelectedRatingIndex(e),this.comment.setSubmittedText(t))}getJsonElements(){return this.survey.getJsonElements()}getSurveyType(){return this.survey.getType()}getCampaignId(){return this.survey.getSurveyInfo().getBackEndId()}getId(){return this.survey.getSurveyInfo().getId()}getGoverenedChannelType(){return this.survey.getSurveyInfo().getGovernedChannelType()}}const{isNOU:Ke}=Fe.Utils;class Qe{makeSurveyLauncher(e){return this.AcceptsSurvey(e)?new Ze(e):null}AcceptsSurvey(e){return!Ke(e)&&e.getType()!==Fe.Api.ISurvey.Type.GenericMessagingSurface}}Qe.LAUNCHER_TYPE=Fe.Api.ISurvey.LAUNCHER_TYPE_DEFAULT;class Ze{constructor(e){this.survey=e}launch(){s().OfficeBrowserFeedback.floodgate.showSurvey(new Ye(this.survey))}}const{isNOU:Xe}=Fe.Utils;class $e{constructor(e,t){this.rudeSurveyLauncherFactory=e,this.coachingUXLauncherFactory=t}static make(){return new $e(new Qe,new We)}makeSurveyLauncher(e){if(Xe(e))return null;switch(e.getLauncherType().toLocaleLowerCase()){case We.LAUNCHER_TYPE:return this.makeGenericMessagingSurfaceLauncher(e);case Qe.LAUNCHER_TYPE:default:return this.makeRudeSurveyLauncher(e)}}AcceptsSurvey(e){if(Xe(e))return!1;switch(e.getType()){case Fe.Api.ISurvey.Type.GenericMessagingSurface:return!Xe(this.coachingUXLauncherFactory)&&this.coachingUXLauncherFactory.AcceptsSurvey(e);default:return i.get().checkIfSurveysEnabled()&&!Xe(this.rudeSurveyLauncherFactory)&&this.rudeSurveyLauncherFactory.AcceptsSurvey(e)}}makeGenericMessagingSurfaceLauncher(e){return Xe(this.coachingUXLauncherFactory)?null:this.coachingUXLauncherFactory.makeSurveyLauncher(e)}makeRudeSurveyLauncher(e){return Xe(this.rudeSurveyLauncherFactory)?null:this.rudeSurveyLauncherFactory.makeSurveyLauncher(e)}}function et(e,t,n,r){if(void 0===t)return Promise.reject(new Error("Manifest cannot be undefined"));let o=new FormData;return o.append("Manifest",t),n&&o.append("Screenshot",n),r&&o.append("Diagnostics",r),function(e,t,n,r,o){let a=(i,r)=>new Promise((s,u)=>{let c=new XMLHttpRequest;c.open(e,t,!0),c.timeout=r,c.onload=()=>{o(c,s,u)},c.ontimeout=()=>{i>0?a(i-1,2*r).then(s,u):u(new Error(`Request to '${t}' timed out. timeout: ${c.timeout}`))},c.onerror=()=>{i>0?a(i-1,r).then(s,u):u(new Error(`Request to '${t}' errored. ${c.status} - ${c.statusText} : ${c.responseText}`))},c.send(n)});const s=i.get().getCommonInitOptions().petrolTimeout?i.get().getCommonInitOptions().petrolTimeout:8e3;return a(r,s)}("POST",e?"https://petrol.office.microsoft.com/v1/feedback":"https://petrol-int.office.microsoft.com/v1/feedback",o,2,(function(e,t,n){200!==e.status&&n(new Error("Non-200 response with status code: "+e.status+", response: "+e.responseText)),t()}))}class tt{constructor(e){this.screenshot=e}getContent(){let e;try{e=this.screenshot.toDataURL("image/jpeg").split(",")[1]}catch(t){Ae().logEvent(ge.Shared.Screenshot.GetContent.Failed.DefaultImage.Returned.VALUE,2,{ErrorMessage:t.toString()}),e="iVBORw0KGgoAAAANSUhEUgAAAN0AAAA+AQMAAACV2ox1AAAABGdBTUEAALGPC/xhBQAAAAZQTFRFAAAA////pdmf3QAAAAlwSFlzAAAOwgAADsIBFShKgAAAAjtJREFUSMfV1M1rE0EUAHDBa5r8A9vkL6giFiI0JH+Ih9KLx8TaukkJugShHgrJzYvkVPQkUqgwSePLEELaU+zBg8JKVvSQQNydlsadwCQzziRZ82ETxYMfc3gD8+MxjzcfV8T80f0vkQ8i68tAPSMSQ0PkI6QDpEPkZBHy1Wp1/zjni2lrZq2T2uikDG17A54Hr0vsvwXIl3WXt02zeIHQBSq3DxHk7VO55zIFgLLrcmaaQBGiqCwQArBVQTbNZODNBB5Ee2EEr5eGiDG4k5mcqcy+Ksh+N8K2+bRI1Z68fRMVoV+XmcFwpQJZGohpkds1WtjppGLaq51a2b8yp310UW9/H8VfRj68CIKRsWCFPCCEM419S4bSAOmPmdb3TBrQ4lmnt9n4/Hiv5fTunsOzXbJfLR2rU3Fd5ugOe9mw0lvNOCNxyDdIHkpHCv0S3a+MS0yT+4wkAKx1gBJeVxeMRhSeNZpXJfY+zqAVl+g0mCFRJMgs6oy9+MCMrWZaJJwiWFjuWcIShf+Wk2W9e59OHu21WPdsswZNLKs9wV77mJiaMVbBQ+/1jGZDofFLuOBU/jzG6OQKnkLOZ5EvwolMX2Q19TAX9MWyy/aNarewfZptechdLn8B3TatB/YXB2j4MKw3jTHKX4AO0CbqaSddMokHUbr0PpSXmFG4O4WIu86asCVihfoM6nUmse5gGkbJOyThVesX4UI0d00LBYMr55VuIZl8MkY1uOiTy9v3c+ShuXj5+NdQdL8B+5gmw8WZuREAAAAASUVORK5CYII="}let t=atob(e),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})}}class nt{constructor(e,t,n,i,r,o,a,u){this.manifestData={appId:t,application:o,clientFeedbackId:r,manifestType:e,source:"Client",submitTime:n,telemetry:a,type:it(i),web:u,sdkVersion:we.d+(void 0!==s().OfficeBrowserFeedback.sdkVersion?s().OfficeBrowserFeedback.sdkVersion:"0.0.0")}}getExtendedManifestData(){return this.manifestData.application.extendedManifestData}setComment(e){this.manifestData.comment=e}setEmail(e){this.manifestData.email=e}setCategory(e){this.manifestData.telemetry=this.manifestData.telemetry||{},this.manifestData.telemetry.featureArea=e}setAppData(e){this.manifestData.application=this.manifestData.application||{},this.manifestData.application.appData=e}setExtendedManifestData(e){this.manifestData.application=this.manifestData.application||{},this.manifestData.application.extendedManifestData=e}setClientFeedbackId(e){this.manifestData.clientFeedbackId=e}getClientFeedbackId(){return this.manifestData.clientFeedbackId}setComplianceInformation(e,t,n,i,r,o){this.manifestData.complianceChecks={authenticationType:e,ageGroup:t,policyAllowFeedback:n,policyAllowSurvey:i,policyAllowScreenshot:r,policyAllowContact:o}}setValues(e){if(e)for(let t in e)e.hasOwnProperty(t)&&(this.manifestData.hasOwnProperty(t)?this.manifestData[t]=f.overrideValues(e[t],this.manifestData[t]):this.manifestData[t]=e[t])}getContent(){return new Blob([JSON.stringify(this.manifestData)],{type:"application/json"})}}function it(e){return"Survey"===e?e:we.b[e]}class rt{constructor(e,t,n,r,o,a,s){var u,c,l,d,p,g,h,v;this.clientFeedbackId=f.guid(),this.manifest=new nt(t,n,(new Date).toISOString(),r,this.clientFeedbackId,Object.assign({},o),Object.assign({},a),Object.assign({},s)),this.environment=e,this.manifest.setComplianceInformation(i.AuthenticationType[null!==(c=null===(u=i.get().getCommonInitOptions())||void 0===u?void 0:u.authenticationType)&&void 0!==c?c:i.AuthenticationType.Unauthenticated],i.AgeGroup[null!==(d=null===(l=i.get().getCommonInitOptions())||void 0===l?void 0:l.ageGroup)&&void 0!==d?d:i.AgeGroup.Undefined],this.ocpsEnumToString(null===(p=i.get().getInAppFeedbackInitOptions())||void 0===p?void 0:p.sendFeedbackPolicyValue),this.ocpsBooleanToString(null===(g=i.get().getFloodgateInitOptions())||void 0===g?void 0:g.surveyEnabled),this.ocpsEnumToString(null===(h=i.get().getCommonInitOptions())||void 0===h?void 0:h.screenshotPolicyValue),this.ocpsEnumToString(null===(v=i.get().getCommonInitOptions())||void 0===v?void 0:v.emailPolicyValue))}getClientFeedbackId(){return this.clientFeedbackId}getExtendedManifestData(){return this.manifest.getExtendedManifestData()}setComment(e){this.manifest.setComment(e)}setEmail(e){this.manifest.setEmail(e)}setCategory(e){this.manifest.setCategory(e)}setAppData(e){this.manifest.setAppData(e)}setExtendedManifestData(e){this.manifest.setExtendedManifestData(e)}setScreenshot(e){this.screenshot=new tt(e)}setClientFeedbackId(e){this.manifest.setClientFeedbackId(e)}getManifest(){return this.manifest}setManifestValues(e){this.manifest.setValues(e)}submit(){if(!i.get().isFeedbackSurveyEnabledByAADC())return Ae().logEvent(ge.Shared.Upload.Prevented.VALUE,2,{Data:JSON.stringify({ageGroup:i.get().getCommonInitOptions().ageGroup,authenticationType:i.get().getCommonInitOptions().authenticationType})}),Promise.resolve();let e=this.manifest.getContent(),t=void 0;const n=this.clientFeedbackId;return this.screenshot&&(t=this.screenshot.getContent()),et(0===this.environment,e,t).catch((function(e){i.get().setFeedbackSubmitted(!1),i.get().getCommonInitOptions().onError("Payload submission failed: "+e.message+". ClientFeedbackId: "+n),Ae().logEvent(ge.Shared.Upload.Failed.VALUE,2,{ErrorMessage:e.message,ClientFeedbackId:n})}))}ocpsBooleanToString(e){return void 0===e?"Not Configured":e?"Enabled":"Disabled"}ocpsEnumToString(e){if(!e)return"Not Configured";switch(e){case 2:return"Disabled";case 1:return"Enabled";default:return"Not Configured"}}}class ot{makeTransporter(e){return new rt(i.get().getCommonInitOptions().environment,e,i.get().getCommonInitOptions().appId,"Survey",i.get().getCommonInitOptions().applicationGroup,i.get().getCommonInitOptions().telemetryGroup,i.get().getCommonInitOptions().webGroup)}}class at{getLanguage(){return i.get().getCommonInitOptions().originalLocale}}let st;class ut{loadStringResource(e){let t=st;switch(e){case 5:return t.Floodgate.Nps.Rating.Points11Value0;case 6:return t.Floodgate.Nps.Rating.Points11Value1;case 7:return t.Floodgate.Nps.Rating.Points11Value2;case 8:return t.Floodgate.Nps.Rating.Points11Value3;case 9:return t.Floodgate.Nps.Rating.Points11Value4;case 10:return t.Floodgate.Nps.Rating.Points11Value5;case 11:return t.Floodgate.Nps.Rating.Points11Value6;case 12:return t.Floodgate.Nps.Rating.Points11Value7;case 13:return t.Floodgate.Nps.Rating.Points11Value8;case 14:return t.Floodgate.Nps.Rating.Points11Value9;case 15:return t.Floodgate.Nps.Rating.Points11Value10;case 16:return t.Floodgate.Nps.Rating.Points5Value1;case 17:return t.Floodgate.Nps.Rating.Points5Value2;case 18:return t.Floodgate.Nps.Rating.Points5Value3;case 19:return t.Floodgate.Nps.Rating.Points5Value4;case 20:return t.Floodgate.Nps.Rating.Points5Value5;case 4:return t.Floodgate.Nps.Rating.Question;case 21:return t.Floodgate.Nps.Comment.Question;case 3:return t.Floodgate.Nps.Prompt.No;case 1:return t.Floodgate.Nps.Prompt.Question;case 0:return t.Floodgate.Nps.Prompt.Title;case 2:return t.Floodgate.Nps.Prompt.Yes;default:return""}}getCustomString(e){return i.get().getFloodgateInitOptions().uIStringGetter(e)}}var ct=n(13);class lt{constructor(){this.loadAsyncTriggered=!1,this.campaignDefinitions=[]}load(){return this.loadAsyncTriggered||(this.loadAsync(),this.loadAsyncTriggered=!0),this.campaignDefinitions||[]}loadAsync(){const e=this,t=qe().getCampaignDefinitions();t.then(t=>{e.loadCampaignDefinitions(t),e.loadAsyncTriggered=!0});const n=ye("TmsLoadTimeout",1e3),i=Object(f.createTimeoutPromise)(n,t);return new Promise((t,n)=>{i.then((function(n){e.loadCampaignDefinitions(n),e.loadAsyncTriggered=!0,t(e.campaignDefinitions)})).catch((function(n){e.campaignDefinitions.length<=0&&e.loadCampaignDefinitions(qe().getCachedCampaignDefinitions()),t(e.campaignDefinitions)})).catch((function(n){t(e.campaignDefinitions)}))})}loadCampaignDefinitions(e){const t=e&&e.campaigns;t&&(this.campaignDefinitions=Object(ct.FilterValidCampaignDefinitions)(t).result)}}function dt(){try{const e=document&&(document.documentElement||document.getElementsByTagName("body")[0]);return{pageWidth:(null===window||void 0===window?void 0:window.innerWidth)||(null==e?void 0:e.clientWidth),pageHeight:(null===window||void 0===window?void 0:window.innerHeight)||(null==e?void 0:e.clientHeight),pageTop:(null===window||void 0===window?void 0:window.pageYOffset)||(null==e?void 0:e.scrollTop),pageLeft:(null===window||void 0===window?void 0:window.pageXOffset)||(null==e?void 0:e.scrollLeft),screenWidth:screen?screen.width:0,screenHeight:screen?screen.height:0,colorDepth:screen?screen.colorDepth:0,userAgent:null===navigator||void 0===navigator?void 0:navigator.userAgent}}catch(e){return null}}function pt(e,t){if(!e)return null;let n=e[t];if(!n){const i=t.toLowerCase();n=e[Object.keys(e).find(e=>e.toLowerCase()===i)]}if(Fe.Utils.isNOU(n))return null;if(!Fe.Utils.isArray(n)&&(Fe.Utils.isObject(n)||Fe.Utils.isFunction(n)))return null;const i=(new Date).toISOString();return{userFactType:"Local",userFactName:t,userFactValue:n.toString(),sourceDateTime:i,storageDateTime:i,clientIngestionDateTime:i}}let gt;function ht(e){try{if(!gt){const e=i.get().getCommonInitOptions();gt=[e,null==e?void 0:e.applicationSettings,null==e?void 0:e.telemetryGroup,null==e?void 0:e.applicationGroup,null==e?void 0:e.webGroup,i.get().getFloodgateInitOptions(),i.get(),dt(),{userConsentGroup:i.get().getUserConsentGroup(),feedbackEnabledByAADC:i.get().isFeedbackSurveyEnabledByAADC()}]}let t=gt.reduce((t,n)=>t||pt(n,e),null);return t||(t=function(e){const t=e&&e.split("__");if(!t||t.length<=1)return null;let n=null;const i=t[0],r=t.pop();if(r&&1===t.length&&(n=pt(window[i]||window,r)),!n&&r&&t.length>1){"window"===i&&t.shift();const e=t.reduce((e,t)=>e&&e[t],window);e&&(n=pt(e,r))}return n&&(n.userFactName=e),n}(e)),t}catch(t){return Ae().logEvent(ge.UserFacts.LocalFact.Error.VALUE,2,{ErrorMessage:`Error getting local fact - ${e} ${t&&t.message?": "+t.message:""} `}),null}}class vt{constructor(){this.loadAsyncTriggered=!1,this.userFacts=[],this.nameAndUserFactMap={}}load(){return this.loadAsyncTriggered||(this.loadAsync(),this.loadAsyncTriggered=!0),this.userFacts||[]}loadAsync(){const e=qe().getUserFacts().then(e=>{this.loadUserFacts(e)}),t=ye("TulipsLoadTimeout",1e3);return Object(f.createTimeoutPromise)(t,e).then(()=>this.userFacts).catch(()=>((!this.userFacts||this.userFacts.length<=0)&&this.loadUserFacts(qe().getCachedUserFacts()),this.userFacts)).catch(()=>this.userFacts)}getUserFact(e){let t=this.nameAndUserFactMap[e];return t||this.nameAndUserFactMap.hasOwnProperty(e)||(t=this.nameAndUserFactMap[e]=ht(e)),t}loadUserFacts(e){e&&(this.userFacts=e||[],this.userFacts.map(e=>{this.nameAndUserFactMap[e.userFactName]=e}),this.loadAsyncTriggered=!0,this.logUserFactInfo(this.userFacts))}logUserFactInfo(e){if(!e||e.length<=0)return;const t=ye("TulipsIngestionTimeInterval",864e5);if(t<=0)return;let n;try{const i=Date.now(),r=e=>{const n=Date.parse(e);return!!isNaN(n)||i-n>t},o={Count:e.length,RefreshTime:t,IngestionTime:e[0].clientIngestionDateTime,SourcesExpired:e.filter(e=>e&&r(e.sourceDateTime)).length||void 0,StoragesExpired:e.filter(e=>e&&r(e.storageDateTime)).length||void 0,IngestionsExpired:e.filter(e=>e&&r(e.clientIngestionDateTime)).length||void 0};n={Message:"UserFacts",Data:JSON.stringify(o)}}catch(e){n={ErrorMessage:"Error getting UserFact info"}}Ae().logEvent(ge.UserFacts.Provider.Info.VALUE,3,n)}}var mt=n(8),ft=n(18),yt=n(9),St=n(24),Tt=n.n(St),Ct=n(3);class Et extends Ne{constructor(e){super(),this.simpleRequestEnabled=!1,this.simpleRequestEnabled=null!=e&&e}postRequestWithRetry(e,t,n,i){const r=this;return new Promise((function(o,a){r.sendPostRequest(e,t,void 0,!0,i).then(o).catch((function(s){if(Ae().logEvent(ge.DYNAMICTRANSPORT_POST_ERROR,2,{ErrorMessage:s.toString(),TimeMilliseconds:i,Count:n,CorrelationId:r.requestId}),n<=1)return a(s);r.postRequestWithRetry(e,t,n-1,i).then(o).catch(a)}))}))}createHeaders(e){const t="undefined"!=typeof Headers&&new Headers;return t&&(this.simpleRequestEnabled?this.createSimpleHeaders(t):this.createNormalHeaders(t),Object(Ct.isNOU)(e)||t.append("Authorization","Bearer "+e)),t}createNormalHeaders(e){this.requestId=Object(Ct.guid)(),e.append("X-Request-ID",this.requestId),e.append("Content-Type","application/json")}createSimpleHeaders(e){e.append("Content-Type","text/plain")}}var At=n(14);const _t=new class{constructor(){this.personalizerEnabled=!1,this.dynamicTransport=new Et,this.personalizerSurveyInformationMap={}}setup(e){this.personalizerEnabled=e.getFloodgateInitOptions().governanceServiceEnabled&&e.getFloodgateInitOptions().personalizerEnabled,this.personalizerEnabled&&(this.isProduction=0===e.getCommonInitOptions().environment,this.retryLimit=e.getFloodgateInitOptions().governanceServiceConfig.retry,this.timeout=e.getFloodgateInitOptions().governanceServiceConfig.timeout,this.requestUrl=this.isProduction?"https://oness.microsoft.com/api/v1.0/Reward":"https://onessppe.microsoft.com/api/v1.0/Reward")}setEventIdAndOverrideValueForSurveyId(e,t,n,i,r){if(!this.personalizerEnabled||Fe.Utils.isNOU(e)||Fe.Utils.isNOU(i))return!1;if(0!==t)return!1;const o=this.validateAndGetAutoDismissTime(n);return!Fe.Utils.isNOU(o)&&(this.personalizerSurveyInformationMap[i]={eventId:e,recommendedAutoDismissValue:o,userAction:void 0},!0)}getOverrideValueForSurveyId(e,t){if(this.personalizerEnabled&&!Fe.Utils.isNOU(t)&&this.infoExistsForSurveyId(t)&&0===e)return this.personalizerSurveyInformationMap[t].recommendedAutoDismissValue}logUserActionForSurveyAsync(e,t,n){return De(this,void 0,void 0,(function*(){!Fe.Utils.isNOU(e)&&this.infoExistsForSurveyId(t)&&(this.personalizerSurveyInformationMap[t].userAction=e);const i={error:!1},r=this.getValidatedActionPayloadForSurveyId(t);if(Fe.Utils.isNOU(r))return i.error=!0,i.errorMessage="Action Payload validation failed.",Ae().logEvent(ge.PERSONALIZER_CLIENTFAILURE,1,{Message:"(PersonalizerClient.logUserActionForSurveyAsync) Error logging personalizer user action: "+i.errorMessage,CampaignId:n,SurveyId:t}),i;let o;try{const e=performance.now();o=yield this.dynamicTransport.postRequestWithRetry(this.requestUrl,JSON.stringify(r),this.retryLimit,this.timeout);const a=performance.now();return Ae().logEvent(ge.PERSONALIZER_SERVICEREWARDRESULT,1,{TimeMilliseconds:a-e,HttpStatusCode:o.status,HttpStatusText:o.statusText,AdditionalSurveyInfo:this.buildConfigTelemetryString(),CorrelationId:this.dynamicTransport.requestId,CampaignId:n,PersonalizerUserAction:r.UserAction,PersonalizerEventId:r.EventId,SurveyId:t}),o.ok||(i.error=!0,i.errorMessage=`Server Error, status: ${o.status}, status text: ${o.statusText}`),i}catch(e){return i.error=!0,i.errorMessage=`Error: ${e.toString()}, Error stack: ${e.stack}`,Ae().logEvent(ge.PERSONALIZER_CLIENTFAILURE,1,{Message:"(PersonalizerClient.logUserActionForSurveyAsync) Error logging personalizer user action: "+i.errorMessage,CampaignId:n,SurveyId:t,PersonalizerUserAction:r.UserAction,PersonalizerEventId:r.EventId}),i}}))}getEventIdForSurveyId(e){if(this.infoExistsForSurveyId(e))return this.personalizerSurveyInformationMap[e].eventId}isEnabled(e,t,n){return e===C.ISurvey.Type.Fps&&t!==we.e&&"customux"!==t&&n===yt.GovernedChannelType.Standard&&this.personalizerEnabled}getValidatedActionPayloadForSurveyId(e){if(!this.infoExistsForSurveyId(e))return;const t=this.personalizerSurveyInformationMap[e];return Fe.Utils.isNOU(t.eventId)||Fe.Utils.isNOU(t.userAction)||2!==t.userAction&&0!==t.userAction&&1!==t.userAction?void 0:{UserAction:t.userAction,EventId:t.eventId}}validateAndGetAutoDismissTime(e){if(Fe.Utils.isNOU(e)||"string"!=typeof e)return;switch(parseInt(e,10)){case 0:return 0;case 7:return 1;case 14:return 2;case 21:return 3;case 28:return 4;case 60:return 5;case 90:return 6;case 120:return 7;case 150:return 8;default:return}}infoExistsForSurveyId(e){return!Fe.Utils.isNOU(e)&&!Fe.Utils.isNOU(this.personalizerSurveyInformationMap[e])}buildConfigTelemetryString(){const e={retry:this.retryLimit,timeout:this.timeout};return JSON.stringify(e)}};function It(){return _t}const bt=new class{constructor(){this.personalizerClient=It(),this.governanceServiceEnabled=!1,this.forceServicelessSurveyDisplay=!1,this.lastSurveyFailedSync=void 0,this.clientState=At.GovernanceServiceClientState.Disabled}setup(e){if(this.governanceServiceEnabled=e.getFloodgateInitOptions().governanceServiceEnabled,this.governanceServiceEnabled){if(this.clientInfo={applicationId:e.getCommonInitOptions().appId.toString(),sessionId:e.getCommonInitOptions().sessionId,version:e.getCommonInitOptions().build,surveyPlatform:1,hostPlatform:6,tenantId:e.getCommonInitOptions().telemetryGroup.tenantId,deviceId:e.getCommonInitOptions().telemetryGroup.deviceId,audience:e.getCommonInitOptions().telemetryGroup.audience},this.userId=e.getCommonInitOptions().telemetryGroup.loggableUserId,Object(Ct.isNOU)(this.clientInfo.sessionId))return void(this.clientState=At.GovernanceServiceClientState.InitializationFailed);if(Object(Ct.isNOU)(this.clientInfo.version))return void(this.clientState=At.GovernanceServiceClientState.InitializationFailed);if(!Object(Ct.isValidUserId)(this.userId))return void(this.clientState=At.GovernanceServiceClientState.InitializationFailed);this.forceServicelessSurveyDisplay=e.getFloodgateInitOptions().governanceServiceConfig.forceServicelessSurveyDisplay,this.retryLimit=e.getFloodgateInitOptions().governanceServiceConfig.retry,this.timeout=e.getFloodgateInitOptions().governanceServiceConfig.timeout,this.simpleRequestEnabled=e.getFloodgateInitOptions().governanceServiceConfig.simpleRequestEnabled,this.isProduction=0===e.getCommonInitOptions().environment,this.clientState=At.GovernanceServiceClientState.Enabled,this.dynamicTransport=new Et(this.simpleRequestEnabled)}}isEnabled(e){return this.clientState===At.GovernanceServiceClientState.Enabled&&this.governanceServiceEnabled&&e===yt.GovernedChannelType.Standard}shouldForceDisplay(){return this.forceServicelessSurveyDisplay}getClientInfo(){return this.clientInfo}getClientState(){return this.clientState}getLastSurveyFailedSync(){return this.lastSurveyFailedSync}checkGovernancePermitAsync(e,t,n,i){return De(this,void 0,void 0,(function*(){const r=(this.isProduction?"https://oness.microsoft.com/api/v1.0/UserSurvey":"https://onessppe.microsoft.com/api/v1.0/UserSurvey")+(this.simpleRequestEnabled?"/SimpleRequest":""),o=this.buildSurveyInfo(e,t,i),a=this.buildBodyRequest(o,n),s={permission:!1,error:!1};let u,c;try{const t=performance.now();let n;if(u=yield this.dynamicTransport.postRequestWithRetry(r,a,this.retryLimit,this.timeout),c=performance.now()-t,!u.ok)return this.lastSurveyFailedSync=o,s.errorMessage=`Server Error, status: ${u.status}, status text: ${u.statusText}`,s.error=!0,Ae().logEvent(ge.GOVERNANCE_SERVICERESULT,1,{TimeMilliseconds:c,HttpStatusCode:u.status,HttpStatusText:u.statusText,AdditionalSurveyInfo:this.buildConfigTelemetryString(),CorrelationId:this.dynamicTransport.requestId,GovernanceRequestBody:a,GovernanceResponseText:n,CampaignId:e.getCampaignId(),SurveyId:e.getSurveyInfo().getId()}),s;n=yield u.text(),Ae().logEvent(ge.GOVERNANCE_SERVICERESULT,1,{TimeMilliseconds:c,HttpStatusCode:u.status,HttpStatusText:u.statusText,AdditionalSurveyInfo:this.buildConfigTelemetryString(),CorrelationId:this.dynamicTransport.requestId,GovernanceRequestBody:a,GovernanceResponseText:n,CampaignId:e.getCampaignId(),SurveyId:e.getSurveyInfo().getId()});const i=JSON.parse(n);i.lastTriggerSurveyTime=Object(Ct.stringToDate)(new Date(i.lastTriggerSurveyTime).toISOString()),Object(Ct.isNumber)(i.timeUntilNextSurveyAllowed)&&Object(Ct.isDate)(i.lastTriggerSurveyTime)?(0===i.timeUntilNextSurveyAllowed&&(s.permission=!0,this.personalizerClient.isEnabled(e.getType(),e.getLauncherType(),e.getSurveyInfo().getGovernedChannelType())&&this.personalizerClient.setEventIdAndOverrideValueForSurveyId(this.dynamicTransport.requestId,0,i.actionId,e.getSurveyInfo().getId(),e.getCampaignId())),s.lastTriggerSurvey=i,this.lastSurveyFailedSync=void 0):(s.errorMessage="Service Response is not formatted correctly: "+n,s.error=!0,this.lastSurveyFailedSync=o)}catch(e){this.lastSurveyFailedSync=o,Ae().logEvent(ge.GOVERNANCE_SERVICEFAILURE,2,{ErrorMessage:e.toString(),AdditionalSurveyInfo:this.buildConfigTelemetryString(),CorrelationId:this.dynamicTransport.requestId,HttpStatusCode:null==u?void 0:u.status,HttpStatusText:null==u?void 0:u.statusText,GovernanceRequestBody:a}),s.error=!0,s.errorMessage=`Error: ${e.toString()}, Error stack: ${e.stack}`}return s}))}buildSurveyInfo(e,t,n){const i=C.ISurvey.Type[e.getType()],r=At.GovernanceServiceSurveyType[i],o=new Date,a=this.personalizerClient.isEnabled(e.getType(),e.getLauncherType(),e.getSurveyInfo().getGovernedChannelType());return{surveyId:e.getCampaignId(),surveyTriggerTime:o,surveyType:r,surveyLevelCooldown:t,surveyChannel:n,localOffsetTime:o.getTimezoneOffset(),personalizerEnabled:a}}buildBodyRequest(e,t){const n={userId:this.userId,userLevelCooldown:t,survey:e,client:this.clientInfo};return this.simpleRequestEnabled&&(this.dynamicTransport.requestId=Object(f.guid)(),n.requestId=this.dynamicTransport.requestId),JSON.stringify(n)}buildConfigTelemetryString(){const e={retry:this.retryLimit,timeout:this.timeout,simpleRequestEnabled:this.simpleRequestEnabled};return JSON.stringify(e)}};function Ot(){return bt}let Ft,wt,Dt=!1,Lt=0,Nt=null,Pt=null,Ut=null;function Mt(e){Nt=e}function Rt(){return Nt}function Bt(e,t=null){if(Nt)return Nt;Lt++;const n=new Promise((n,r)=>{const o=(e,t)=>{const n=Fe.FloodgateEngine.getTelemetryLogger();n&&n.log_Event(mt.TelemetryEvent.Floodgate.Start.Failed,{Count:Lt,ErrorMessage:e,ErrorDetails:t&&t.stack}),r(e)};try{const r=i.get().getCommonInitOptions();if(!r)return void o("Invalid floodgate common init options, state: "+Dt);let a=i.get().getFloodgateInitOptions();if(!a){const e=Fe.FloodgateEngine.getTelemetryLogger();e&&e.log_Event(mt.TelemetryEvent.Floodgate.Start.Warning,{Count:Lt,ErrorMessage:"Invalid floodgate init options, state: "+Dt}),i.get().setFloodgateInitOptions({}),a=i.get().getFloodgateInitOptions()}if(!t&&!Pt){a&&a.authTokenCallback&&(Pt=new lt,Ut=new vt)}const s=ye("TeachingMessageCooldown",ft.Governor.GetChannelCoolDown(yt.GovernedChannelType.TeachingMessage));if(ft.Governor.SetDefaultChannelCoolDown(yt.GovernedChannelType.TeachingMessage,s),Ft=t||Fe.FloodgateEngine.make(r.build||"",$e.make(),a.onSurveyActivatedCallback,new _,a.settingStorageCallback,wt||new ut,new at,new ot,[Pt],Ut,Ot()),!Ft)return Mt(null),void o("Failed to create floodgate engine");if(e||Lt>1)Ft.start(),n();else{const e=Ft.startAsync();if(!e)return Mt(null),void o("Failed to get floodgate engine");e.then((function(){n()})).catch((function(e){Mt(null),o("Failed to start floodgate engine",e)}))}}catch(e){Mt(null),o("Failed to load floodgate engine: "+(e&&e.toString()),e)}});return Mt(n),n.catch(e=>{Mt(null)}),n}function kt(e=!1){return Bt(e)}function xt(){Ft&&Ft.stop(),Mt(null)}function Gt(){Lt=0,Nt=null,Ft=null,Pt=null,Ut=null}var Vt,zt,jt,qt;Vt=function(){return Ft},a.getEngine=Vt,zt=kt,a.start=zt,jt=xt,a.stop=jt;class Ht{log_TriggerMet(e,t,n,i,r){Ae().logEvent(ge.SURVEY_FLOODGATE_TRIGGERMET,1,{CampaignId:e,SurveyId:t,SurveyType:n,SurveyActivityInfo:i,AdditionalSurveyInfo:r})}log_UserSelected(e,t,n,i){Ae().logEvent(ge.SURVEY_FLOODGATE_USERSELECTED,1,{CampaignId:e,SurveyId:t,SurveyType:n,AdditionalSurveyInfo:i})}log_CampaignLoad_Failed(e){Ae().logEvent(ge.SURVEY_FLOODGATE_CAMPAIGNLOAD_FAILED,2,{ErrorMessage:e})}log_Error(e,t){const n={name:e};Ae().logEvent(n,2,{ErrorMessage:t})}log_Event(e,t,n){const i={name:e};Ae().logEvent(i,1,t,n)}log_LocalError(e,...t){this.log_Local(2,e,t)}log_Local(e,t,...n){Ae().logLocal(e,n)}}class Wt{loadStringResource(e){return"na"}getCustomString(e){return"na"}}function Jt(){return new Promise((e,t)=>{const n=e=>{const n=Fe.FloodgateEngine.getTelemetryLogger();n&&n.log_Event(mt.TelemetryEvent.Floodgate.Initialize.Failed,{ErrorMessage:e}),t(e)};if(Dt)e();else{try{!function(){if(!be){if(!s().OfficeBrowserFeedback.initOptions)throw new Error("Window.OfficeBrowserFeedback.initOptions not set");s().OfficeBrowserFeedback.sdkVersion="0.0.0",i.get().setCommonInitOptions(s().OfficeBrowserFeedback.initOptions),Oe=i.get().isFeedbackSurveyEnabledByAADC(),Ee(i.get().getCommonInitOptions(),"OfficeFeedbackSDK","0.0.0",i.get().getSdkSessionId(),i.get().getEventSampling()),be=!0,Oe||Ae().logEvent(ge.FEEDBACK_SURVEYSDISABLED_AADC,1,{Data:JSON.stringify({ageGroup:i.get().getCommonInitOptions().ageGroup,authenticationType:i.get().getCommonInitOptions().authenticationType})})}}()}catch(e){return void n("CommonApp initialization failed: {"+e+"}")}Fe.FloodgateEngine.setTelemetryLogger(new Ht);try{r=new Wt,wt=r,function(){if(!_.isStorageAvailable())throw new Error("window.localStorage is not available.");s().OfficeBrowserFeedback.floodgate=s().OfficeBrowserFeedback.floodgate||{};let e=s().OfficeBrowserFeedback.floodgate.initOptions;if(e=e||{},void 0!==e.campaignDefinitions){const t=Object(ct.FilterValidCampaignDefinitions)(e.campaignDefinitions);if(t.error)throw new Error("floodgate.initOptions.campaignDefinitions error: "+t.error);(new _).write(C.IFloodgateStorageProvider.FileType.CampaignDefinitions,JSON.stringify(e.campaignDefinitions))}const t=i.get();if(t.setFloodgateInitOptions(e),Tt.a.resetSessionActivity(),It().setup(t),Ot().setup(t),Dt=!0,!t.getFloodgateInitOptions().surveyEnabled){const e=Fe.FloodgateEngine.getTelemetryLogger();e&&e.log_Event(mt.TelemetryEvent.Floodgate.Start.SurveysDisabled,{Count:Lt,Message:"Floodgate initialized with surveys disabled (surveyEnabled is false)"})}}()}catch(e){return void n("CommonFloodgate initialization failed: {"+e+"}")}var r;e()}})}function Yt(){be=!1,Dt=!1,Gt()}qt=Jt,a.initialize=qt}]);
//# sourceMappingURL=officebrowserfeedback_floodgate_bare.es6.min.js.map