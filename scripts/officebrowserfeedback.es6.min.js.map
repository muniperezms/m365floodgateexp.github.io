{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./scripts/app/Configuration/Configuration.ts","webpack:///./scripts/app/Utils.ts","webpack:///./scripts/app/Constants.ts","webpack:///./scripts/app/Configuration/IInitOptions.ts","webpack:///src/Utils.ts","webpack:///src/Api/IFloodgateStorageProvider.ts","webpack:///src/Api/ISurvey.ts","webpack:///src/Api/ISurveyComponent.ts","webpack:///src/Constants.ts","webpack:///src/FloodgateEngine.ts","webpack:///src/Surveys/SurveyDataSource.ts","webpack:///src/Surveys/Survey.ts","webpack:///src/GovernedChannel.ts","webpack:///src/Campaign/CampaignDefinitionProvider.ts","webpack:///src/Api/Api.ts","webpack:///src/ISurveyInfo.ts","webpack:///src/StateProviderHelpers.ts","webpack:///src/SurveyComponents/CommentComponent.ts","webpack:///src/SurveyComponents/PromptComponent.ts","webpack:///src/SurveyComponents/RatingComponent.ts","webpack:///src/Campaign/CampaignStateProvider.ts","webpack:///src/SurveyStatCollectionActivation.ts","webpack:///src/SurveyStatCollection.ts","webpack:///src/SurveyComponents/CVSurveyComponent.ts","webpack:///src/GovernedChannelStateProvider.ts","webpack:///src/SurveyStatCollectionEventActivity.ts","webpack:///./scripts/app/thirdparty/html2canvas/html2canvas.js","webpack:///index.ts","webpack:///./scripts/app/Localization.ts","webpack:///src/Api/IActivityListener.ts","webpack:///src/Api/IFloodgateSettingIdMap.ts","webpack:///src/Campaign/CampaignManager.ts","webpack:///src/Campaign/CampaignSurveyFactory.ts","webpack:///src/SurveyEvents.ts","webpack:///src/ActivityTrackingData.ts","webpack:///src/ActivityTrackingSet.ts","webpack:///src/SurveyMetadata.ts","webpack:///src/Surveys/FpsSurvey.ts","webpack:///src/SurveyComponents/MultipleChoiceComponent.ts","webpack:///src/Surveys/GenericMessagingSurfaceSurvey.ts","webpack:///src/Surveys/InterceptSurvey.ts","webpack:///src/SurveyComponents/InterceptComponent.ts","webpack:///src/Surveys/NlqsSurvey.ts","webpack:///src/Surveys/NpsSurvey.ts","webpack:///src/FloodgateSettings.ts","webpack:///src/Governor.ts","webpack:///src/SurveyActivityListener.ts","webpack:///src/ActivityTracker.ts","webpack:///src/IndexedTracker.ts","webpack:///src/ActivityTrackingContract.ts","webpack:///src/GovernanceUtils.ts","webpack:///src/UserFact/UserFactHelper.ts","webpack:///src/UserFact/UserFact.ts","webpack:///./scripts/app/thirdparty/aria-webjs-compact-sdk-1.2.2.js","webpack:///./scripts/app/Version.ts","webpack:///./scripts/app/Window/Window.ts","webpack:///./scripts/app/Logging/Telemetry/Contracts.ts","webpack:///./scripts/app/Logging/Telemetry/Aria.ts","webpack:///./scripts/app/Logging/Telemetry/AriaTelemetryLogger.ts","webpack:///./scripts/app/FloodgateCore/FloodgateStorageProvider.ts","webpack:///./scripts/app/Logging/Constants.ts","webpack:///./scripts/app/TargetedMessaging/TargetedMessagingCache.ts","webpack:///./scripts/app/Configuration/DynamicConfiguration.ts","webpack:///./scripts/app/Logging/Logging.ts","webpack:///./scripts/app/Logging/Telemetry/TelemetryLoggerFactory.ts","webpack:///./scripts/app/CommonApp.ts","webpack:///./scripts/app/UIStrings/UIStrings.ts","webpack:///./scripts/app/UI/UiConstants.ts","webpack:///./scripts/app/Screenshot.ts","webpack:///./scripts/app/CommonUI.ts","webpack:///./scripts/app/Window/DomUtils.ts","webpack:///./scripts/app/Theme.ts","webpack:///./scripts/app/Transport/Petrol.ts","webpack:///./scripts/app/Transport/Files/Screenshot.ts","webpack:///./scripts/app/Transport/Files/Manifest.ts","webpack:///./scripts/app/Transport/Transport.ts","webpack:///./scripts/app/UI/Utils.ts","webpack:///./scripts/app/UI/SpinnerControl.ts","webpack:///./scripts/app/UI/BellyBand/TabFocus.ts","webpack:///./scripts/app/UI/BellyBand/Events.ts","webpack:///./scripts/app/UI/BellyBand/FormTemplates/FormTemplateType.ts","webpack:///./scripts/app/UI/CategoriesDropdown.ts","webpack:///./scripts/app/UI/RatingControl.ts","webpack:///./scripts/app/UI/BellyBand/FormTemplates/BasicFormTemplate.ts","webpack:///./scripts/app/UI/BellyBand/FormTemplates/SingleFormTemplate.ts","webpack:///./scripts/app/UI/BellyBand/Layout.ts","webpack:///./scripts/app/UI/Renderer.ts","webpack:///./scripts/app/UI/BellyBand/PanelTemplates/ThanksPanelTemplate.ts","webpack:///./scripts/app/UI/BellyBand/FormTemplates/FeedbackPortalIdeaTemplate.ts","webpack:///./scripts/app/UI/BellyBand/BellyBand.ts","webpack:///./scripts/app/WindowProperties.ts","webpack:///./scripts/app/App_InAppFeedback.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Configuration","feedbackSubmitted","categories","show","customCategories","customCategory","length","this","commonInitOptions","inAppFeedbackInitOptions","inAppFeedbackLaunchOptions","floodgateInitOptions","floodgateSurvey","sdkSessionId","eventSampling","passedInitOptions","initOptions","appId","applicationGroup","build","cid","environment","intlFilename","intlUrl","webSurfacesResourceBaseUrl","locale","onError","originalLocale","primaryColour","secondaryColour","sessionId","stylesUrl","telemetryGroup","userEmail","webGroup","petrolTimeout","isCommercialHost","customResourcesSetExternally","emailPolicyValue","screenshotPolicyValue","ageGroup","authenticationType","applicationSettings","webSurfacesSettings","expectedValues","Strings","Css","undefined","None","processSessionId","extendedManifestData","JSON","stringify","RegExp","test","officeBuild","hexColourRegex","err","Unauthenticated","Undefined","parseEventSamplingOption","commonPolicyAllowAADC","determineAADCPolicy","bugForm","onDismiss","screenshot","showEmailAddress","transitionEnabled","isShowThanks","sendFeedbackPolicyValue","feedbackForumUrl","myFeedbackForumUrl","submitted","launchOptions","validateCategoryOptions","autoDismiss","campaignDefinitions","campaignFlights","campaignQueryParameters","onSurveyActivatedCallback","settingStorageCallback","uIStringGetter","authTokenCallback","surveyEnabled","augLoopCallback","customerVoiceSurveyParams","governanceServiceEnabled","governanceServiceConfig","personalizerEnabled","messagingServiceSettings","campaignId","defaultOnSurveyActivatedCallback","launcher","survey","surveyParams","launch","str","parseGovernanceServiceConfig","cvFlights","isCVSurveyEnabled","productName","uiHost","AAD","MinorWithParentalConsent","MinorWithoutParentalConsent","Adult","NotAdult","MinorNoParentalConsentRequired","samplingOptions","eventInitSampling","event","index","type","sampleRate","config","forceServicelessSurveyDisplay","retry","timeout","simpleRequestEnabled","configuration","validateFeedbackType","feedbackType","Smile","Frown","Bug","guid","overrideValues","isNOU","isBoolean","isString","isObject","isEnumValue","isNumber","isInteger","isFinite","Math","floor","expectObject","expectNumber","expectString","expectBoolean","expectGuid","isGuid","expectArray","Array","isArray","expectEnum","enumType","createTimeoutPromise","ms","promise","Promise","resolve","reject","id","setTimeout","clearTimeout","race","checkCssSelectorToBeSet","cssSelector","sheetIndex","document","styleSheets","currentStyleSheet","rulesIndex","rules","currentRule","selectorText","includes","error","FeedbackType","DynamicScriptUrls","WebSurfacesIntLink","WebSurfacesProdLink","GUIDs","TMSAppID","TULIPSAppID","SDK_VERSION_PREFIX","CustomResources","AgeGroup","AuthenticationType","isDate","input","toString","isNaN","getTime","subtractSecondsWithoutOverflow","date","seconds","addSecondsWithoutOverflow","milliseconds","MIN_DATE_MILLISECONDS","Date","interval","units","toLowerCase","Error","MAX_DATE_MILLISECONDS","extractLanguageSubtag","language","matches","match","randomHex4","random","substring","subTag","extractedSubTag","substr","keys","sort","values","push","newDate","sourceObject","targetobject","result","field","pad","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","arrIn","lastNonShuffledElement","pickIndex","temp","serializedValue","defaultValue","parsedObject","parse","e","IFloodgateStorageProvider","FileType","ISurvey","Type","DOM_FEEDBACKSURVEY_TAGNAME","DOM_NPS_TAGNAME","DOM_PSAT_TAGNAME","DOM_BPS_TAGNAME","DOM_FPS_TAGNAME","DOM_NLQS_TAGNAME","DOM_INTERCEPT_TAGNAME","LAUNCHER_TYPE_DEFAULT","ISurveyComponent","DOM_PROMPT_TAGNAME","DOM_COMMENT_TAGNAME","DOM_RATING_TAGNAME","DOM_CVSURVEY_TAGNAME","DOM_MULTIPLECHOICE_TAGNAME","JSON_INTERCEPT_KEYNAME","JSON_INTERCEPTURL_KEYNAME","JSON_PROMPT_KEYNAME","JSON_PROMPTYESTEXT_KEYNAME","JSON_PROMPTNOTEXT_KEYNAME","JSON_COMMENT_KEYNAME","JSON_RATING_KEYNAME","JSON_CVSURVEY_KEYNAME","JSON_CVSURVEYFORMID_KEYNAME","JSON_CVSURVEYTHEME_KEYNAME","JSON_RATINGOPTIONS_KEYNAME","JSON_CVSURVEYPRODUCTNAME_KEYNAME","JSON_CVSURVEYUIHOST_KEYNAME","JSON_CVSURVEYPLATFORM_KEYNAME","JSON_TITLE_KEYNAME","JSON_QUESTION_KEYNAME","JSON_MULTIPLECHOICE_KEYNAME","JSON_APPLICATION_KEYNAME","JSON_EXTENDEDMANIFESTDATA_KEYNAME","JSON_SURVEYSTRINGS_KEYNAME","JSON_SURVEYSPECIFICDATA_KEYNAME","CampaignState","Deserialize","Failed","FileBasedCampaignStateProvider","Load","HostBasedCampaignStateProvider","GetStatesFromHost","Floodgate","Initialize","Start","Warning","SurveysDisabled","UserFactsLoad","UserFactsSpecDeserialization","UserFactsSpecIsAMatch","Mismatch","Summary","FloodgateEngine","Make","Common","StartAsync","Stopped","OnSurveyActivated","ActivationStatsSuppressedSurvey","ClosedChannelType","SurveyNotDefined","SessionSuppressedSurvey","ActivationExpiredSurvey","ActivationIrrelevantSurvey","CheckGovernanceServiceAndActivateSurvey","GovernanceServiceForceToDisplay","GovernanceServiceClientCompleted","GovernedChannelState","FileBasedGovernedChannelStateProvider","HostBasedGovernedChannelStateProvider","SurveyStatCollectionActivation","FromJson","ToJson","HostBasedSurveyActivationStatsProvider","GetSurveyStatsFromHost","SurveyStatCollectionEventActivity","SurveyActivity","LogActivity","EventsReprocessed","SurveysReprocessed","SetActivityTrackingContracts","DuplicateSurveyID","TelemetryEvent","log_TriggerMet","surveyId","surveyType","surveyActivityInfo","additionalSurveyInfo","log_UserSelected","log_CampaignLoad_Failed","errorMessage","log_Error","eventId","log_Event","properties","log_LocalError","message","defaultSurveyActivityListener","run","shouldAcceptActivity","activityName","globalSessionSurveyActivationCounts","surveyClient","activityListener","launcherFactory","storage","governor","surveyActivationStatsProvider","transporterFactory","governanceServiceClient","initializationStatus","candidateSurveys","launchedSurveys","launchedLaunchers","surveyEventSent","staleTriggeredSurveysQueue","loggedFirstStart","setPendingSurveys","clearSurveys","thisObj","setCallback","contextInfo","onSurveyActivated","setTelemetryLogger","telemetryLogger","getTelemetryLogger","getTransportFactory","make","buildVersion","fileBasedStorageProvider","hostBasedStorageProvider","stringProvider","environmentProvider","campaignDefinitionProviders","userFactsProvider","governedChannelStateProvider","GovernedChannelStateProviderFactory","SurveyActivationStatsProviderFactory","campaignStateProvider","CampaignStateProviderFactory","FileSystemCampaignDefinitionProvider","CampaignManager","SurveyActivityListener","Governor","ErrorMessage","ErrorDetails","stack","mergeAndSave","saveSettings","saveSurveyActivationHistory","saveSurveyEventActivityHistory","saveCurrentState","saveChannelStates","start","setInitializationStatus","loadSettingsAndPriorEventCounts","channelTypes","getAvailableChannelTypes","refreshSurveyDefinitions","setPendingSurveysAndStartFloodgate","startAsync","refreshSurveyDefinitionsAsync","then","stop","catch","updateActivityListenerWithCurrentSurveyDefinitions","getActivityListener","status","fileLock","FloodgateSettings","writeString","toJson","floodgateSettings","fileUnlock","previousSurveyActivationStats","load","previousSurveyEventActivityStats","fromJson","readString","SurveyEventActivityStats","stats","getStats","channels","getAvailableChannelData","forEach","channel","getType","getAppSurveys","logActivity","FloodgateStartActivityName","updateSurveyActivationStats","surveyInfo","getSurveyInfo","getId","SurveyActivationStats","ExpirationTimeUtc","getExpirationTimeUtc","ActivationTimeUtc","SurveyLaunchCount","addStats","statCollection","previousStats","updateCollection","accumulate","save","now","isActiveForDate","allActivities","getActivationEvent","getTrackingSet","getList","data","getIsAggregate","getActivity","Counts","moveSessionCountIntoBaseCount","activity","saveSessionTrackingActivity","pendingSurveys","AcceptsSurvey","getCurrentSurveyDefinitions","surveyList","allCampaignDefinitionIDs","getAllCampaignDefinitionIDs","allCandidateCampaignDefinitionIDs","getAllCandidateCampaignDefinitionIDs","allCampaignDefinitions","getCampaignDefinitions","isSurveyAllowed","isBusinessCriticalSurvey","surveyActivationStats","getBySurveyId","isMultiLaunchSurvey","hasSurveyReachedMaxLaunches","hasSurveyReachedMaxLaunchesPerSession","getBackEndId","indexOf","getAdditionalSurveyInfoForTelemetry","percentageNumerator","percentageDenominator","nominationPeriodNumber","cooldownPeriodNumber","correspondingCampaignDefinition","getCampaignId","nominationScheme","nominationPeriod","asTimeIntervalSeconds","cooldownPeriod","channelType","getGovernedChannelType","contextCount","surveyLauncherType","getLauncherType","businessLevel","getBusinessLevel","maxLaunches","getMaxLaunches","maxLaunchesPerSession","getMaxLaunchesPerSession","candidateSurvey","definitionsKey","definition","trackingContractList","trackingContract","ActivityTrackingContract","setCriticalPendingSurveysAndUpdateActivityListener","activeSurveys","isCriticalSurvey","tempSurvey","governedChannelType","isEnabled","checkGovernanceServiceAndActivateSurvey","activateSurvey","launchSurvey","refreshChannelData","isChannelOpen","CampaignId","SurveyId","triggeredSurvey","GovernedChannelType","activityTrackingString","getActivityTrackingInfo","governanceServiceClientState","getClientState","startChannelCooldown","isSurveyComplete","launchLauncher","campaignDefinition","campaignCooldown","channelCooldown","GetChannelCoolDown","checkGovernancePermitAsync","serviceResult","Message","createGorvernanceResponseTelemetry","shouldForceDisplay","permission","lastSurveyTriggerInfo","lastTriggerSurvey","lastTriggerSurveyTime","clearSurveyWithChannel","shift","fileType","read","write","makeSurveyLauncher","UpdateActivityTrackingContracts","FloodgateEngineStatus","GovernanceServiceResult","StaleTriggeredSurveysQueueCount","DefaultFloodgateTelemetryLogger","getDistantFuture","Utils","getDistantPast","getDefault","expirationTimeUtc","activationEvent","backEndIdentifier","launcherType","getRawStartTimeUtc","startTimeUtc","getStartTimeUtc","parsed","getRawExpirationTimeUtc","getPreferredLaunchType","preferredLaunchType","isAdditionalDataRequested","additionalDataToCheck","additionalDataRequested","getMetadata","metadata","getDomElements","doc","typeElement","createElement","ISurveyInfo","DOM_TYPE_TAGNAME","appendChild","createTextNode","DOM_TYPE_VALUE","idElement","DOM_ID_TAGNAME","getJsonElements","surveyObject","JSON_ID_KEYNAME","JSON_SURVEY_KEYNAME","SurveyDataSource","SurveyDataSourceData","getClientFeedbackId","clientFeedbackId","submit","transporter","makeTransporter","setManifestValues","getPreGeneratedClientFeedbackId","Survey","Standard","cooldownSeconds","cooldownStartTime","setCooldownStartTime","cooldownEndTime","isOpen","isOpenAtDate","getName","getCooldownSeconds","getCooldownStartTime","getCooldownEndTime","GovernedChannel","isUtcDatetimeString","stringToDate","deserialize","CampaignLanguageRangeLanguageSubtag","validate","CampaignLanguageRange","languageSubTag","Value","isInRange","extractedLanguageSubTag","toLocaleUpperCase","isValidLanguageSubTag","CampaignScopeAny","CampaignScopeEnvironmentCrossProduct","CampaignScopeUserFactAny","CampaignScopeUserFactAll","CampaignScope","isInScope","languageRanges","Languages","readRange","setEnvironmentProvider","getLanguage","userFacts","deserializeUserFacts","setUserFactsProvider","some","userFact","rawUserFact","getUserFact","isAMatch","validateUserFacts","mismatchedFacts","filter","mismatchedNames","map","Count","CampaignDurationTimeInterval","CampaignDurationSingleBuildChange","CampaignDuration","intervalSeconds","IntervalSeconds","CampaignAdditionalDataRequested","additionalData","CampaignDistributionRamp","CampaignDistribution","maxDelaySeconds","MaxDelaySeconds","chunks","Chunks","CampaignNominationSchemeRatioPercentage","getActiveSurveyTimeIntervalSeconds","nominationTimIntervalSeconds","fallbackSurveyDurationSeconds","calculateSurveyStartTimeFromDate","soonestStartTime","calculateSurveyExpirationTimeFromSurveyStartTime","surveyStartTime","getCampaignCooldown","didUserActivateSurvey","CampaignNominationScheme","DistributionModel","distributionModel","CooldownPeriod","NominationPeriod","FallbackSurveyDurationSeconds","PercentageDenominator","PercentageNumerator","evaluateNominationRules","rand","CampaignSurveyEventCountedActivity","CampaignSurveyEventCountedActivitySequence","CampaignSurveyEvent","Activity","count","isAggregate","IsAggregate","sequence","Sequence","readActivity","optionalComponents","CampaignSurveyContent","prompt","CampaignSurveyContentPrompt","Prompt","rating","CampaignSurveyContentRating","Rating","comment","CampaignSurveyContentComment","Question","multipleChoice","CampaignSurveyContentMultipleChoice","MultipleChoice","intercept","CampaignSurveyContentIntercept","Intercept","cvSurvey","CampaignSurveyContentCVSurvey","CVSurveyParams","question","availableOptions","AvailableOptions","minNumberOfSelectedOptions","MinNumberOfSelectedOptions","maxNumberOfSelectedOptions","MaxNumberOfSelectedOptions","customerVoiceFormId","CustomerVoiceFormId","title","Title","yesLabel","YesLabel","noLabel","NoLabel","url","Url","isZeroBased","IsZeroBased","ratingValuesAscending","RatingValuesAscending","CampaignSurveyMetadata","contentMetadata","ContentMetadata","CampaignSurveyTemplateNps5PointStatic","CampaignSurveyTemplateNps11PointStatic","CampaignSurveyTemplateFps","CampaignSurveyTemplateNlqs","CampaignSurveyTemplateNps","CampaignSurveyTemplateGenericMessagingSurface","CampaignSurveyTemplateIntercept","CampaignSurveyTemplate","ActivationEvent","content","Content","Metadata","MaxLaunches","MaxLaunchesPerSession","PreferredLaunchType","CampaignDefinition","startTime","StartTimeUtc","endTime","EndTimeUtc","LauncherType","primaryPriority","PrimaryPriority","tags","Tags","AdditionalDataRequested","SurveyTemplate","surveyTemplate","NominationScheme","Scope","scope","BusinessLevel","FilterValidCampaignDefinitions","badIndexes","newDefinition","readDefinitions","definitionString","CampaignDefinitions","loadAsync","definitions","IActivityListener","IFloodgateSettingIdMap","items","itemCount","add","find","remove","item","ItemCollection","itemValue","beginPos","SETTING_DATA_OPEN_TAG","endPos","SETTING_DATA_CLOSE_TAG","previousStates","currentStates","stateCollections","mergedStates","toBeUpdatedStates","previousState","currentState","pos","splice","current","LastCooldownEndTimeUtc","getCooldownStartDate","LastNominationTimeUtc","currentStats","statsCollections","mergedStats","toBeUpdatedStats","previousStatsDictionary","currentStatsDictionary","currentActivationStats","toBeUpdatedStatsDictionary","toBeUpdated","userComment","CommentComponent","getQuestion","setSubmittedText","getSubmittedText","element","getComponentJson","CommentComponentData","yesButtonLabel","noButtonLabel","selectedButton","PromptComponent","getTitle","getYesButtonText","getNoButtonText","setButtonSelected","selected","getButtonSelected","promptButtonToString","PromptComponentData","selectedIndex","RatingComponent","getRatingValuesAscending","getSelectedRating","isRatingIndexValid","setSelectedRatingIndex","getSelectedRatingIndex","getNormalizedRatingScore","toFixed","RatingComponentData","lastNominationTime","lastNominationBuildNumber","deleteAfterSecondsWhenStale","ForceCandidacy","isCandidate","didCandidateTriggerSurvey","lastSurveyActivatedTime","lastSurveyId","lastSurveyStartTime","lastSurveyExpirationTime","lastCooldownEndTimeUtc","LastNominationBuildNumber","DeleteAfterSecondsWhenStale","IsCandidate","DidCandidateTriggerSurvey","LastSurveyActivatedTimeUtc","LastSurveyId","LastSurveyStartTimeUtc","LastSurveyExpirationTimeUtc","markCurrentSurveyTakenOnDate","fileBasedStorage","hostBasedStorage","fileBasedStateProvider","statesFromFile","statesFromHost","getStatesFromHost","StateProviderHelpers","MergeAndUpdateCampaignStates","campaignStates","StateCollections","state","stateValue","makeSettingItemValue","upsertSettingItem","CampaignStates","states","settings","readSettingList","dataString","extractSettingItemValueSubString","itemObject","newState","fileData","FileData","json","readStats","other","rawStats","Surveys","newStat","SurveyStatCollection","FileBasedSurveyActivationStatsProvider","surveyStatsFromHost","getSurveyStatsFromHost","surveyStatsFromFile","MergeAndUpdateSurveyActivationStats","statsFromHost","statsCollection","itemData","newStats","deleteSettingItem","surveyStatCollectionActivation","SurveyLaunchCountPerSession","CVSurveyComponent","getFormId","CVSurveyComponentData","ChannelType","CooldownStartTimeUtc","MergeAndUpdateGovernedChannelStates","GovernedChannelStates","String","ChannelStates","ourStats","resizedCounts","slice","val","extendStatics","b","setPrototypeOf","__proto__","__extends","__","constructor","__assign","assign","arguments","apply","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","next","rejected","done","__generator","body","f","y","g","_","label","sent","trys","ops","verb","iterator","v","op","TypeError","pop","Bounds","x","w","h","left","top","width","height","fromClientRect","clientRect","parseBounds","node","getBoundingClientRect","toCodePoints","codePoints","charCodeAt","extra","fromCodePoint","_i","codeUnits","codePoint","fromCharCode","chars","lookup","Uint8Array","TokenType","slice16","view","end","Uint16Array","Trie","initialValue","errorValue","highStart","highValueIndex","ix","UTRIE2_DATA_BLOCK_LENGTH","UTRIE2_INDEX_1_OFFSET","UTRIE2_INDEX_2_BLOCK_LENGTH","SP","BA","HY","CL","CP","EX","IN","NS","OP","IS","NU","PO","PR","SY","AL","EB","EM","H2","H3","ID","JL","JV","JT","SA","UnicodeTrie","base64","buffer","encoded1","encoded2","encoded3","encoded4","bufferLength","len","ArrayBuffer","bytes","decode","view32","polyUint32Array","Uint32Array","view16","polyUint16Array","headerLength","ceil","createTrieFromBase64","ALPHABETICS","HARD_LINE_BREAKS","SPACE","PREFIX_POSTFIX","LINE_BREAKS","concat","KOREAN_SYLLABLE_BLOCK","HYPHEN","isAdjacentWithSpaceIgnored","a","currentIndex","classTypes","prev","previousNonSpaceClassType","_lineBreakAtIndex","indicies","forbiddenBreaks","beforeIndex","afterIndex","before","prevIndex","cssFormattedClasses","options","lineBreak","wordBreak","_a","types","classType","codePointsToCharacterClasses","isLetterNumber","letterNumber","Break","required","isDigit","isHex","isWhiteSpace","isNameStartCodePoint","isLowerCaseLetter","isUpperCaseLetter","isLetter","isNonASCIICodePoint","isNameCodePoint","isNonPrintableCodePoint","isValidEscape","c1","c2","isIdentifierStart","c3","isNumberStart","stringToNumber","sign","integers","int","parseInt","fraction","fracd","frac","expsign","exponent","exp","pow","LEFT_PARENTHESIS_TOKEN","RIGHT_PARENTHESIS_TOKEN","COMMA_TOKEN","SUFFIX_MATCH_TOKEN","PREFIX_MATCH_TOKEN","COLUMN_TOKEN","DASH_MATCH_TOKEN","INCLUDE_MATCH_TOKEN","LEFT_CURLY_BRACKET_TOKEN","RIGHT_CURLY_BRACKET_TOKEN","SUBSTRING_MATCH_TOKEN","BAD_URL_TOKEN","BAD_STRING_TOKEN","CDO_TOKEN","CDC_TOKEN","COLON_TOKEN","SEMICOLON_TOKEN","LEFT_SQUARE_BRACKET_TOKEN","RIGHT_SQUARE_BRACKET_TOKEN","WHITESPACE_TOKEN","EOF_TOKEN","Tokenizer","_value","chunk","tokens","token","consumeToken","consumeCodePoint","consumeStringToken","peekCodePoint","flags","consumeName","HASH_TOKEN","reconsumeCodePoint","consumeNumericToken","e1","e2","e3","consumeIdentLikeToken","a1","a2","a3","AT_KEYWORD_TOKEN","u1","u2","consumeUnicodeRangeToken","consumeWhiteSpace","DELIM_TOKEN","unshift","delta","digits","questionMarks","start_1","digit","UNICODE_RANGE_TOKEN","endDigits","consumeUrlToken","FUNCTION_TOKEN","IDENT_TOKEN","URL_TOKEN","stringToken","STRING_TOKEN","consumeBadUrlRemnants","consumeEscapedCodePoint","consumeStringSlice","amount","min","endingCodePoint","consumeNumber","repr","number","unit","DIMENSION_TOKEN","PERCENTAGE_TOKEN","NUMBER_TOKEN","hex","hexCodePoint","isSurrogateCodePoint","Parser","_tokens","tokenizer","parseValue","parseComponentValue","parseValues","parseComponentValues","SyntaxError","reconsumeToken","consumeComponentValue","consumeSimpleBlock","consumeFunction","block","isEndingTokenFor","functionToken","cssFunction","FUNCTION","isDimensionToken","isNumberToken","isIdentToken","isStringToken","isIdentWithValue","nonWhiteSpace","nonFunctionArgSeparator","parseFunctionArgs","args","arg","isLength","isLengthPercentage","parseLengthPercentageTuple","ZERO_LENGTH","FIFTY_PERCENT","HUNDRED_PERCENT","getAbsoluteValueForTuple","tuple","getAbsoluteValue","parent","angle","PI","isAngle","parseNamedSide","ident","join","deg","color","colorFunction","SUPPORTED_COLOR_FUNCTIONS","pack","namedColor","COLORS","toUpperCase","TRANSPARENT","isTransparent","asString","alpha","blue","green","red","round","getTokenColorValue","max","rgb","_b","hue2rgb","t1","t2","hue","PropertyDescriptorParsingType","BACKGROUND_CLIP","hsl","saturation","lightness","hsla","rgba","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN","CSSImageType","CSSRadialShape","CSSRadialExtent","backgroundClip","prefix","LIST","PADDING_BOX","CONTENT_BOX","BORDER_BOX","backgroundColor","TYPE_VALUE","format","parseColorStop","color$1","processColorStops","stops","lineLength","first","last","processStops","previous","stop_1","absoluteValue","gapBegin","stop_2","gapLength","gapValue","calculateGradientDirection","radian","corner","centerX","centerY","atan2","getAngleFromCorner","abs","sin","cos","halfWidth","halfHeight","halfLineLength","yDiff","xDiff","distance","sqrt","findCorner","closest","reduce","stat","cx","cy","optimumDistance","optimumCorner","Infinity","prefixLinearGradient","angle$1","firstToken","colorStop","LINEAR_GRADIENT","isGreenPixel","createForeignObjectSVG","xmlns","svg","createElementNS","foreignObject","setAttributeNS","loadSerializedSVG","img","Image","onload","onerror","src","encodeURIComponent","XMLSerializer","serializeToString","FEATURES","createRange","range","testElement","style","TEST_HEIGHT","display","selectNode","rangeBounds","rangeHeight","removeChild","testRangeBounds","canvas","ctx","getContext","drawImage","toDataURL","testSVG","from","window","fetch","fillStyle","fillRect","greenImageSrc","getImageData","backgroundImage","size","testForeignObject","crossOrigin","XMLHttpRequest","responseType","Logger","enabled","debug","console","info","instances","destroy","getInstance","instance","CacheStorage","_caches","Cache","open","cache","getOrigin","link","_link","href","protocol","hostname","port","isSameOrigin","_origin","setContext","location","_current","attachInstance","detachInstance","_options","_cache","addImage","has","isBlobImage","isRenderable","loadImage","useCORS","useProxy","_this","isInlineImage","SUPPORT_CORS_IMAGES","proxy","SUPPORT_CORS_XHR","allowTaint","isInlineBase64Image","complete","imageTimeout","SUPPORT_RESPONSE_TYPE","xhr","response","reader_1","FileReader","addEventListener","readAsDataURL","timeout_1","ontimeout","send","INLINE_SVG","INLINE_BASE64","INLINE_IMG","SUPPORT_SVG_DRAWING","isSVG","prefixRadialGradient","shape","CIRCLE","FARTHEST_CORNER","position","isColorStop","acc","ELLIPSE","CLOSEST_SIDE","FARTHEST_SIDE","CLOSEST_CORNER","RADIAL_GRADIENT","BACKGROUND_REPEAT","image","image_1","URL","imageFunction","SUPPORTED_IMAGE_FUNCTIONS","isAtPosition_1","isSupportedImage","backgroundOrigin","backgroundPosition","BACKGROUND_SIZE","backgroundRepeat","parseBackgroundRepeat","NO_REPEAT","REPEAT_X","REPEAT_Y","REPEAT","BORDER_STYLE","backgroundSize","isBackgroundSizeInfoToken","borderColorForSide","side","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","borderRadiusForSide","borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius","FLOAT","borderStyleForSide","IDENT_VALUE","NONE","SOLID","borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle","borderWidthForSide","VALUE","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","bit","parseDisplayValue","LINE_BREAK","float","LEFT","RIGHT","INLINE_START","INLINE_END","letterSpacing","LIST_STYLE_POSITION","STRICT","NORMAL","lineHeight","TOKEN_VALUE","listStyleImage","LIST_STYLE_TYPE","listStylePosition","INSIDE","OUTSIDE","OVERFLOW","listStyleType","DISC","SQUARE","DECIMAL","CJK_DECIMAL","DECIMAL_LEADING_ZERO","LOWER_ROMAN","UPPER_ROMAN","LOWER_GREEK","LOWER_ALPHA","UPPER_ALPHA","ARABIC_INDIC","ARMENIAN","BENGALI","CAMBODIAN","CJK_EARTHLY_BRANCH","CJK_HEAVENLY_STEM","CJK_IDEOGRAPHIC","DEVANAGARI","ETHIOPIC_NUMERIC","GEORGIAN","GUJARATI","GURMUKHI","HEBREW","HIRAGANA","HIRAGANA_IROHA","JAPANESE_FORMAL","JAPANESE_INFORMAL","KANNADA","KATAKANA","KATAKANA_IROHA","KHMER","KOREAN_HANGUL_FORMAL","KOREAN_HANJA_FORMAL","KOREAN_HANJA_INFORMAL","LAO","LOWER_ARMENIAN","MALAYALAM","MONGOLIAN","MYANMAR","ORIYA","PERSIAN","SIMP_CHINESE_FORMAL","SIMP_CHINESE_INFORMAL","TAMIL","TELUGU","THAI","TIBETAN","TRAD_CHINESE_FORMAL","TRAD_CHINESE_INFORMAL","UPPER_ARMENIAN","DISCLOSURE_OPEN","DISCLOSURE_CLOSED","marginForSide","marginTop","marginRight","marginBottom","marginLeft","OVERFLOW_WRAP","overflow","HIDDEN","SCROLL","AUTO","VISIBLE","TEXT_ALIGN","overflowWrap","BREAK_WORD","paddingForSide","paddingTop","paddingRight","paddingBottom","paddingLeft","POSITION","textAlign","CENTER","TEXT_TRANSFORM","RELATIVE","ABSOLUTE","FIXED","STICKY","STATIC","textShadow","shadow","offsetX","offsetY","blur","VISIBILITY","textTransform","UPPERCASE","LOWERCASE","CAPITALIZE","transform","transformFunction","SUPPORTED_TRANSFORM_FUNCTIONS","matrix","matrix3d","b1","b2","a4","b4","DEFAULT_VALUE","DEFAULT","transformOrigin","origins","WORD_BREAK","visibility","COLLAPSE","FONT_STYLE","BREAK_ALL","KEEP_ALL","zIndex","auto","order","opacity","textDecorationColor","textDecorationLine","line","fontFamily","isStringToken$1","fontSize","fontWeight","fontVariant","PseudoElementType","fontStyle","OBLIQUE","ITALIC","contains","counterIncrement","increments","filtered","counter","increment","counterReset","resets","reset","quotes","open_1","close_1","close","getQuote","depth","quote","boxShadow","spread","inset","CSSParsedDeclaration","declaration","cssFloat","overflowTuple","overflowX","overflowY","isVisible","isTransformed","isPositioned","isPositionedWithZIndex","isFloating","isInlineLevel","CSSParsedPseudoDeclaration","CSSParsedCounterDeclaration","descriptor","parser","length_1","value_1","ElementContainer","styles","getComputedStyle","textNodes","elements","isHTMLElementNode","bounds","TextBounds","text","getWrapperBounds","ownerDocument","wrapper","cloneNode","parentNode","replaceChild","firstChild","getRangeBounds","offset","setStart","setEnd","breakText","breakWords","bk","breaker","forbiddenBreakpoints","lastEnd","nextIndex","LineBreaker","words","TextContainer","transform$1","textBounds","textList","trim","SUPPORT_RANGE_BOUNDS","replacementNode","splitText","parseTextBounds","replace","capitalize","p1","p2","ImageElementContainer","_super","currentSrc","intrinsicWidth","naturalWidth","intrinsicHeight","naturalHeight","CanvasElementContainer","SVGElementContainer","baseVal","LIElementContainer","OLElementContainer","reversed","CHECKBOX_BORDER_RADIUS","RADIO_BORDER_RADIUS","PASSWORD","InputElementContainer","checked","placeholder","SelectElementContainer","option","TextareaElementContainer","parseColor","IFrameElementContainer","iframe","contentWindow","documentElement","tree","parseTree","documentBackgroundColor","bodyBackgroundColor","LIST_OWNERS","parseNodeTree","root","childNode","nextNode","nextSibling","isTextNode","isElementNode","container","createContainer","createsRealStackingContext","createsStackingContext","tagName","isTextareaElement","isSVGElement","isSelectElement","isImageElement","isCanvasElement","isLIElement","isOLElement","isInputElement","isIFrameElement","isBodyElement","nodeType","Node","TEXT_NODE","ELEMENT_NODE","isStyleElement","isScriptElement","CounterState","counters","getCounterValue","getCounterValues","canReset","entry","counterNames","ROMAN_UPPER","createAdditiveCounter","symbols","fallback","suffix","createCounterText","string","integer","createCounterStyleWithSymbolResolver","codePointRangeLength","isNumeric","resolver","createCounterStyleFromRange","codePointRangeStart","codePointRangeEnd","createCounterStyleFromSymbols","createCJKCounter","numbers","multipliers","negativeSign","tmp","coefficient","appendSuffix","defaultSuffix","cjkSuffix","koreanSuffix","spaceSuffix","CJK_TEN_COEFFICIENTS","CJK_ZEROS","DocumentCloner","scrolledElements","referenceElement","quoteDepth","toIFrame","windowSize","createIFrameContainer","scrollX","defaultView","pageXOffset","scrollY","pageYOffset","cloneWindow","documentClone","iframeLoad","iframeLoader","onclone","restoreNodeScroll","scrollTo","navigator","userAgent","clonedReferenceElement","nodeName","fonts","ready","serializeDoctype","doctype","restoreOwnerScroll","adoptNode","createElementClone","createCanvasClone","createStyleClone","sheet","cssRules","css","rule","cssText","textContent","inlineImages","clonedCanvas","clonedCtx","putImageData","clone","styleBefore","styleAfter","createPseudoHideStyles","resolvePseudoContent","BEFORE","child","hasAttribute","ignoreElements","copyStyles","insertBefore","after","AFTER","copyCSSStyles","scrollTop","scrollLeft","pseudoElt","anonymousReplacedElement","attr","getAttribute","counterStyle","counterState","counterType","delim","counterStates","counterType_1","separator","className","PSEUDO_HIDE_ELEMENT_CLASS_BEFORE","PSEUDO_HIDE_ELEMENT_CLASS_AFTER","PathType","cloneIframeContainer","border","scrolling","setAttribute","onreadystatechange","setInterval","childNodes","readyState","clearInterval","target","setProperty","getPropertyValue","internalSubset","publicId","systemId","createStyles","CORNER","equalPath","Vector","VECTOR","deltaX","deltaY","lerp","BezierCurve","startControl","endControl","BEZIER_CURVE","subdivide","firstHalf","ab","bc","cd","abbc","bccd","dest","reverse","isBezierCurve","path","BoundCurves","tlh","tlv","trh","trv","_c","brh","brv","_d","blh","blv","factors","maxFactor","topWidth","rightHeight","bottomWidth","leftHeight","topLeftBorderBox","getCurvePoints","TOP_LEFT","topRightBorderBox","TOP_RIGHT","bottomRightBorderBox","BOTTOM_RIGHT","bottomLeftBorderBox","BOTTOM_LEFT","topLeftPaddingBox","topRightPaddingBox","bottomRightPaddingBox","bottomLeftPaddingBox","topLeftContentBox","topRightContentBox","bottomRightContentBox","bottomLeftContentBox","r1","r2","kappa","ox","oy","xm","ym","calculateBorderBoxPath","curves","calculatePaddingBoxPath","TransformEffect","ClipEffect","StackingContext","inlineLevel","nonInlineLevel","negativeZIndex","zeroOrAutoZIndexOrTransformedOrOpacity","positiveZIndex","nonPositionedFloats","nonPositionedInlineLevel","ElementPaint","parentStack","effects","borderBox","paddingBox","getParentEffects","parseStackTree","stackingContext","realStackingContext","listItems","treatAsRealStackingContext","paintContainer","listOwnerItems","order_1","index_1","index_2","processListItems","owner","numbering","listValue","createPathFromCurves","outer1","inner1","outer2","inner2","contentBox","calculateBackgroundRendering","intrinsicSize","backgroundPositioningArea","calculateBackgroundPositioningArea","getBackgroundValueForIndex","backgroundPaintingArea","calculateBackgroundPaintingArea","backgroundImageSize","calculateBackgroundSize","sizeWidth","sizeHeight","calculateBackgroundRepeatPath","isAuto","hasIntrinsicValue","intrinsicProportion","second","hasIntrinsicProportion","CONTAIN","COVER","hasIntrinsicWidth","hasIntrinsicHeight","hasIntrinsicDimensions","width_3","height_3","repeat","FontMetrics","_data","_document","parseMetrics","span","margin","padding","verticalAlign","baseline","offsetTop","middle","getMetrics","CanvasRenderer","_activeEffects","scale","fontMetrics","translate","textBaseline","applyEffects","popEffect","effect","applyEffect","isTransformEffect","isClipEffect","clip","restore","renderStack","globalAlpha","renderStackContent","renderNode","paint","renderNodeBackgroundAndBorders","renderNodeContent","renderTextWithLetterSpacing","fillText","letter","measureText","createFontStyle","variant","renderTextNode","font","textShadows","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","renderReplacedElement","box","windowWidth","windowHeight","render","fill","beginPath","arc","isTextInputElement","canvasTextAlign","computeLineHeight","_e","_f","_g","_h","_j","_k","_l","_m","_o","_p","mask","paths","moveTo","lineTo","formatPath","closePath","point","bezierCurveTo","renderRepeat","pattern","resizeImage","renderBackgroundImage","_loop_1","this_1","x0","x1","y0","y1","gradient_1","top_1","rx","ry","radialGradient_1","midX","midY","invF","createPattern","createLinearGradient","addColorStop","background","isRadialGradient","gradient","calculateRadius","createRadialGradient","renderBorder","curvePoints","borderSide","parsePathForBorder","hasBackground","borders","borders_1","calculateBackgroundCurvedPaintingArea","deltaW","deltaH","borderBoxArea","maskOffset","shadowPaintingArea","calculateContentBoxPath","ForeignObjectRenderer","loadSerializedSVG$1","parseColor$1","renderElement","opts","instanceName","resourceOptions","defaultOptions","windowBounds","documentCloner","clonedElement","bgColor","defaultBackgroundColor","renderOptions","scrollWidth","offsetWidth","clientWidth","scrollHeight","offsetHeight","clientHeight","parseDocumentSize","logging","removeContainer","foreignObjectRendering","devicePixelRatio","innerWidth","innerHeight","factory","Api","supportedLocales","localeVariantToSupportedlocaleMap","localeUpperCase","supportedLocale","localePartOne","split","AppLaunch","AppUsageTime","AppResume","ActivityName","RoamingSettingIdMap","stateProvider","definitionProviders","currentBuildNumber","currentDate","isStateUpForNomination","buildNumber","campaignCooldownDuration","hasBuildChangeDurationElapsed","hasTimeIntervalDurationElapsed","isDateInRange","startDate","endDate","duration","startBuild","isCampaignInScope","isDateInRangeWithDefinition","getActiveSurveys","surveys","prioritizedCampaigns","getPrioritizedCampaigns","CampaignSurveyFactory","makeSurvey","onCampaignSurveyActivated","takenDate","getCampaignStates","getUserFacts","refreshSurveyDefinitionsPrivate","refreshSurveyDefinitionsPrivateAsync","errReason","makeArrayFromObjectValuesSortedByKeyString","loadAndFilterCampaignData","evaluateCampaigns","thisCampaignManager","loadAndFilterCampaignDataAsync","loadedDefinitions","promises","userFactsPromise","provider","all","setUserFacts","FilterCampaignData","loadedDefinitionsMap","Critical","loadedStates","staleLoadedStates","shouldRemove","matchingTagCampaigns","tagId","mapKey","maxPriority","cur","currentPriority","dateToShortUtcString","surveyDataSource","makeSurveyDataSourceData","surveyModel","NpsSurvey","make5Point","make11Point","FpsSurvey","makeFps","NlqsSurvey","makeNlqs","makeCustom","GenericMessagingSurfaceSurvey","InterceptSurvey","makeIntercept","surveyData","makeEvent","makeMetadata","makeCountedActivityEventData","eventModel","eventData","CountedActivityEventData","makeCountedActivityEvent","CountedActivityEvent","makeCountedActivitySequenceEvent","sequenceEventData","CountedActivitySequenceEventData","CountedActivitySequenceEvent","metadataModel","SurveyMetadata","getCount","trackingDataList","ActivityTrackingData","ActivityTrackingSet","countedActivityEventData","getSequence","countedActivityEvent","setCount","isOrdered","list","getIsOrdered","activitiesInfoObject","Activities","IsListOrdered","trackingData","actualCount","tempActivities","ActualCount","IsDiscrete","getContentMetadata","baseData","promptData","commentData","ratingData","multipleChoiceData","MultipleChoiceComponent","cvSurveyData","sp","FpsSurveyData","getCustomString","customString","MultipleChoiceComponentData","Fps","getCommentComponent","getPromptComponent","getRatingComponent","getMultipleChoiceComponent","getCVSurveyComponent","getComponent","componentType","makeSurveyStrings","makeResponseString","getOptionSelectedStates","numberOfOptions","selectedRating","actualStrings","optionStates","getAvailableOptions","getMinNumberofSelectedOptions","getMaxNumberofSelectedOptions","setOptionSelectedStates","selectedStates","ValidateMinNumberofSelectedOptions","ValidateMaxNumberofSelectedOptions","GenericMessagingSurfaceSurveyData","GenericMessagingSurface","InterceptComponent","interceptData","InterceptSurveyData","InterceptComponentData","getInterceptComponent","getUrl","NlqsSurveyData","Nlqs","NpsSurveyData","loadStringResource","Nps","DEFAULT_TEACHING_MESSAGE_COOLDOWN","channelStateProvider","loadChannels","channelData","defaultChannelData","SetDefaultChannelCoolDown","channelStates","channelState","loadChannelStatesFromProvider","Number","defaultData","newChannel","minute","hour","day","DefaultChannelData","Urgent","Banner","TeachingMessage","queuedActivities","pendingActivityCount","previousTrackedActivityMap","callback","loggerCallback","activityContext","trackedActivityMap","resetSessionActivity","context","logActivity_private","logActivityStartTime","logActivityStopTime","stopTime","activityTrackingContracts","duplicateCounter","newMap","trackedSurveyIds","activityTrackingContract","trackingSet","baselineStats","baselineCounts","currentIndexedTrackers","currentBaselineIndex","tracker","newTracker","ActivityTracker","initCounts","generateActivityIndexList","activityIndex","indexedTracker","IndexedTracker","copyObject","getOwnPropertyNames","getIndexedTracker","getSessionCount","getSurveyIds","indexedTrackers","resetQueuedActivities","logType","timestamp","MaxPendingActivitiesQueueSize","activityNames","queuedActivity","ActivityNames","Dropped","logActivity_core","indices","fyShuffle","trackerSurveyId","incrementActivity","executeCallback","source","trackedActivities","activationMask","currentActivationFlags","isActivationByInitPending","currentCounts","currentStartTimes","currentSessionCounts","isValidIndex","getStartTime","sessionCount","otherTrackers","wasAlreadyActivatedThisSession","hasCountCrossedThreshold","finishActivityAtIndex","isActivated","indexList","ActivityIndex","startedLessThanThreshold","isPermittedIndexForActivationByInit","commitActivation","diff","UserFacts","userFactInput","UserFact","commonComparatorTypes","rawUserFactSpec","Values","Name","validateUserFactType","LatencyType","validateLatencyType","LatencyDurationInSeconds","IntervalType","supportedComparatorTypes","getComparatorTypes","Comparator","comparator","isComparatorTypeSupported","userFactType","latency","factType","userFactValue","isLatencyAcceptable","userFactSpecValue","rawUserFactValueInBoolean","compareValues","compareBooleanValues","getValue","getComparator","rawUserFactValueInMilliseconds","isAValidNumber","userFactName","userFactSpecValueInMilliseconds","compareDateTimeUTCValues","rawUserFactValueInNumber","compareNumberValues","compareStringValues","intervalType","currentTimeInMilliseconds","currentDateDiff","TimeMilliseconds","compareTimeIntervalValues","getIntervalType","compareListValues","getLatencyType","getLatencyDurationInSeconds","latencyType","latencyDurationInSeconds","userFactTime","sourceDateTime","storageDateTime","clientIngestionDateTime","userFactTimeInMilliseconds","evaluateFactCandidacy","userFactRawValue","isFactValueInTargetItem","userFactTargetValues","specValue","numberValue","rawUserFactName","configurable","Int64","numberStr","low","high","Equals","UInt64","ToByte","ToUInt8","ToInt16","ToInt32","ToUInt32","AWTPiiKind","Bond","Enums_1","AWTBondSerializer","getPayloadBlob","requestDictionary","tokenCount","stream","IO","MemoryStream","writer","CompactBinaryProtocolWriter","WriteFieldBegin","BondDataType","BT_MAP","WriteMapContainerBegin","BT_STRING","BT_LIST","WriteString","dataPackage","WriteContainerBegin","BT_STRUCT","newGuid","BT_INT64","WriteInt64","numberToBondInt64","WriteBlob","WriteStructEnd","GetBuffer","getEventBlob","propsString","piiProps","pii","NotSet","BT_INT32","WriteInt32","base64Encode","Encoding","Base64","GetString","default","microsoft_bond_primitives_1","GuidRegex","bond_value","isPii","Version","FullVersionString","AWT_1","AWT","AWT_COLLECTOR_URL_UNITED_STATES","AWT_COLLECTOR_URL_GERMANY","AWT_COLLECTOR_URL_JAPAN","AWT_COLLECTOR_URL_AUSTRALIA","AWT_COLLECTOR_URL_EUROPE","Utf8","GetBytes","array","char","inArray","num","output","paddingBytes","charAt","temp2","Varint","Varint64","Zigzag","EncodeZigzag32","EncodeZigzag64","tmpH","tmpL","res","_buffer","WriteByte","byte","Write","bond_const_1","_stream","blob","elementType","WriteUInt8","WriteUInt32","keyType","valueType","WriteUInt64","isBase","BT_STOP_BASE","BT_STOP","AWTKillSwitch","_killedTokenDictionary","setKillSwitchTenants","killTokens","killDuration","killedTokens","durationMs_1","ex","isTenantKilled","tenantToken","AWTBondSerializer_1","AWTRecordBatcher","_maxRequestSize","_outboundQueue","_currentBatch","_currentBatchSize","addEventToBatch","serializedEvent","flushBatch","AWTRetryPolicy","shouldRetryForStatus","httpStatusCode","getMillisToBackoffForRetry","retriesSoFar","waitDuration","randomBackoff","BaseBackoff","AWTTransmissionManager_1","EventNameAndTypeRegex","EventNameDotRegex","PropertyNameRegex","initialize","_isInitialized","_defaultTenantToken","_overrideValuesFromConfig","_config","flush","_isDestroyed","flushAndTeardown","_sanitizeProperty","_contextProperties","logEvent","typePrefix","_addContextIfAbsent","_setDefaultProperty","_getInitId","_getSequenceId","toISOString","sendEvent","collectorUrl","sendingTimer","_initIdMap","_sequenceIdMap","context_1","AWTRecordBatcher_1","AWTRetryPolicy_1","AWTKillSwitch_1","AWTTransmissionManager","_inboundQueues","_recordBatcher","_newEventsAllowed","_urlString","_sendingTimer","_running","_timeout","_isCurrentlyFlushing","_batchAndSendEvents","_flushQueue","_flush","isTeardown","_sendRequest","_retryRequestIfNeeded","conn","request","apikey","retryCount","shouldRetry","_killSwitch","getResponseHeader","_handleRequestFinished","conn_1","tokenCount_1","apikey_1","_checkPrimaryInboundQueueEmpty","_checkOutboundQueueEmptyAndSent","officeBrowserFeedback","OfficeBrowserFeedback","floodgate","getGlobal","App","version","PLATFORM","Session","Host","Event","ID_DELIMITER","SOURCE","SCHEMA_VERSION","Release","audienceGroup","Browser","Device","User","primaryIdentityHash","tenantId","primaryIdentitySpace","generatePrimaryIdentitySpace","startsWith","aria","namespace","app","session","host","release","browser","device","user","oesApp","oesSession","oesHost","oesRelease","oesBrowser","oesDevice","oesUser","getPlatform","getVersion","getSessionId","getLocale","getSource","getSchemaVersion","getSampleRate","getAudienceGroup","getPrimaryIdentityHash","getPrimaryIdentitySpace","getTenantId","eventName","customProperties","oesEvent","EVENT_NAME_DELIMITER","ariaProperties","CUSTOM_PROPERTIES_FIELD_PREFIX","setApp","setSession","setHost","setRelease","setEvent","setBrowser","setDevice","setUser","fileTypeToKeyMap","TmsCache_CampaignContent","TmsCache_MessageMetadata","TmsCache_UserGovernance","Tms_DynamicSettings","LogLevelSettings","DebugOverrides","localStorage","setItem","removeItem","DOMException","code","storageKey","getItem","SURVEY_FLOODGATE_FILEREAD_FAILED","FileName","SURVEY_FLOODGATE_FILEWRITE_FAILED","EventIds","InApp","UI","Picker","Shown","Form","Submit","SURVEY_FLOODGATE_CAMPAIGNLOAD_FAILED","SURVEY_FLOODGATE_TRIGGERMET","SURVEY_FLOODGATE_USERSELECTED","SURVEY_UI_FORM_SHOWN","SURVEY_UI_FORM_SUBMIT","SURVEY_UI_FORM_SECONDARY_SUBMIT","SURVEY_UI_FORM_SUBMIT_ERROR","SURVEY_UI_FORM_USERCLOSED","SURVEY_UI_FORM_NO_RETURN_TYPE","SURVEY_UI_PROMPT_AUTODISMISSED","SURVEY_UI_PROMPT_SHOWN","SURVEY_UI_PROMPT_USERCLOSED","SURVEY_UI_PROMPT_CLICKED","SURVEY_UI_REDIRECTIONFAILURE","GOVERNANCE_SERVICEFAILURE","GOVERNANCE_SERVICERESULT","DYNAMICTRANSPORT_POST_ERROR","FEEDBACK_SURVEYSDISABLED_AADC","SURVEY_UI_DISABLED_AADC","PERSONALIZER_SERVICEREWARDRESULT","PERSONALIZER_CLIENTFAILURE","Shared","Upload","Prevented","Screenshot","Render","Success","GetContent","DefaultImage","Returned","WebSurfaces","Info","Messaging","Requests","LocalFact","AugLoop","Provider","useLocalStorage","cachedItems","contentType","expiryTime","cacheItem","createItem","expiryDate","lastRetrievedDate","updateItemInLocalStorage","isStorageAvailable","floodgateStorage","initCachedItemsFromLocalStorage","contentKey","tempStorageItem","mapContentTypeToFloodgateProviderKey","tempCacheItem","parseObjectFromCache","tempItem","dynamicSettingsTmsgCache","logger","env","initOptionsCommon","appName","appVersion","logSessionId","samplingOption","TokenManager","getTenantToken","browserVersion","deviceId","loggableUserId","getLogger","SAMPLING_RESULT","logSeverity","internalSampleRate","DEFAULT_SAMPLE_RATE","isEventSampled","getEventSamplingRate","isConsoleLogEnabled","log","EVENT_NAME","EVENT_ID","isLoggingEnabled","isEventTelemetryEnabled","others","dynamicLogSettings","settingName","overrideSettings","inputLogLevel","logLevel","currentLogLevel","getCurrentLogLevel","urlParams","URLSearchParams","search","consoleLogParam","documentReferrer","referrer","logLevelParam","settingsObj","getItemContent","settingValue","returnValue","parseFloat","getDynamicSetting","parseObject","logSettings","consoleLog","TENANT_TOKEN_PRODUCTION","TENANT_TOKEN_PRE_PRODUCTION","uIStrings","initialized","getUIStrings","isFeedbackSurveyEnabledByAADC","AttributeName","Alt","AriaLabel","AriaSelected","AriaOrientation","AriaExpanded","AriaControls","AriaHasPopups","AriaModal","AriaLabelledBy","AriaDescribedBy","Class","DataHtml2CanvasIgnore","Disabled","Fill","For","Preview","Height","HRef","Id","MaxLength","Placeholder","Points","Rel","Role","Source","Stroke","TabIndex","Target","Transform","ViewBox","Width","xlinkHref","X","Y","AttributeValue","BlankWindow","Button","Dialog","Tab","TabList","TabPanel","Checkbox","Checked","False","Zero","Polite","Radio","ScreenshotPreview","Text","TextAreaMaxLength","True","Unchecked","NoReferrer","AriaOrientationValueVertical","Classes","AriaLiveTemplate","CheckBox","FontTitle","CloseButton","FontSubtitle","FontText","FontSubText","FontSubSubText","Hidden","Link","MarginLeft60px","MarginLeft180px","NarrowLayout","PrivacyStatementLinkDiv","Rtl","Spinner","SpinnerCircle","SubmitButton","CancelButton","TextInput","Visible","RatingGraphic","RatingGraphicFilled","ChoiceGroup","ChoiceGroupIcon","OverallAnchor","OverallAnchorActive","OverallImage","OverallText","SingleLayout","ShowRightBorder","SlideLeft","TextAlignLeft","FormContainer","FormWideContainer","ThanksPanelTitle","ThanksPanelMessage","FormQuestionMiddleText","FormMiddleText","FormCategoriesDropdown","FormComment","FormRatingContainer","FormRatingLabel","FormRating","FormEmailContainer","FormEmailInput","FormEmailTextBox","FormEmailCheckBox","FormEmailLabel","FormBottomContainer","FormSubmitButtonContainer","FormScreenshotContainer","FormScreenshotLabel","FormScreenshotCheckbox","FormScreenshotPreview","TFormEmailCheckbox","TFormEmailLabel","EmailCheckBoxLabel","Toast","ToastZoom","IDs","ColumnSeparatorDiv","OverallAnchorsContainer","OverallFrownAnchor","OverallFrownDiv","OverallFrownImage","OverallFrownText","OverallSmileAnchor","OverallSmileDiv","OverallSmileImage","OverallSmileText","OverallIdeaAnchor","OverallIdeaDiv","OverallIdeaImage","OverallIdeaText","OverallBugAnchor","OverallBugDiv","OverallBugImage","OverallBugText","QuestionLeftText","LeftFormContainer","LeftPanelContainer","MainContainer","MainContentHolder","MiddleFormContainer","OverlayBackground","PrivacyStatementLink","FirstTabbable","LastTabbable","EmailCheckBox","SingleFormContainer","SingleFormQuestionMiddleText","SingleFormCategoriesDropdown","SingleFormComment","SingleFormEmailInput","SingleFormRating","SingleFormScreenshotCheckbox","SingleFormScreenshotPreview","SingleFormSubmitButton","SingleFormCancelButton","SingleFormSubmitButtonSpinner","BasicFormContainer","BasicFormQuestionMiddleText","BasicFormCategoriesDropdown","BasicFormComment","BasicFormEmailInput","BasicFormRating","BasicFormScreenshotCheckbox","BasicFormScreenshotPreview","BasicFormSubmitButton","BasicFormCancelButton","BasicFormSubmitButtonSpinner","ThanksPanelContainer","ThanksPanelCloseButton","ThanksPanelDiscussion","ThanksPanelVerticalContainer","ThanksPanelInnerContainer","ThanksPanelParagraph","FeedbackPortalIdeaContainer","OverallFeedbackPortalIdeaAnchor","ToastContainer","ToastCancel","TPromptContainer","TPromptTitle","TPromptText","TFormContainer","TFormTitle","TFormRating","TFormRatingQuestion","TFormComment","TFormEmailTextBox","TFormEmailCheckBox","TFormSubmitButton","TFormSubmitButtonSpinner","TFormSubmitButtonContainer","Keys","Esc","Anchor","Defs","Div","FieldSet","Img","Input","Label","Legend","Option","Polygon","Select","Span","Svg","TextArea","Use","Roles","Urls","PromptConstants","No","Yes","html2canvas","createScreenshot","domElement","getCommonInitOptions","selector","rel","getElementsByTagName","loadStylesheet","intlFileUrl","pageOrigin","origin","script","async","loadScript","setUiStrings","isProduction","manifest","diagnostics","formData","FormData","append","method","requestBody","maxRetries","onLoad","makeRequest","retries","statusText","responseText","httpTimeout","makeHttpRequest","imgString","blobBin","atob","Blob","manifestType","submitTime","manifestData","application","telemetry","sanitizeType","web","sdkVersion","email","category","featureArea","appData","sendSurveyPolicyValue","complianceChecks","policyAllowFeedback","policyAllowSurvey","policyAllowScreenshot","policyAllowContact","setComplianceInformation","ocpsEnumToString","getInAppFeedbackInitOptions","ocpsBooleanToString","getFloodgateInitOptions","getExtendedManifestData","setComment","setEmail","setCategory","setAppData","setExtendedManifestData","setClientFeedbackId","setValues","Data","manifestContent","getContent","screenshotContent","setFeedbackSubmitted","ClientFeedbackId","policyValue","setElementVisibility","vis","replaceClassesById","deleteElementById","getElementById","addClassById","newClass","oldClassName","newClassName","oldClass","deleteClassById","setAttributeOnHtmlElement","attriName","attriValue","htmlElement","addEventListenerHelper","listener","attachEvent","removeEventListenerHelper","removeEventListener","detachEvent","unregisterListener","getInternetExplorerVersion","rv","ua","exec","$1","isRightToLeft","direction","ScreenshotPreviewByCheckbox","screenshotCheckboxId","screenshotPreviewId","screenshotCheckBox","screenshotCheckBoxSelected","preview","performance","circleObjects","spinnerId","spinner","createCirclesAndArrange","initializeOpacities","fade","circleObject","circle","createCircle","parentSize","j","setOpacity","classList","cycleTabFocus","focusedElement","querySelectorAll","checkVisible","focus","parentElement","useNarrowLayout","selectedFeedbackType","selectedPanelType","setAriaSelectedAttributes","anchorID","dismissAll","keyEventHandler","listenersList","removeListeners","getFeedbackSubmitted","addListener","registerCommon","ON_DISMISS","overlayBackgroundHandler","mainContainerHandler","tabKeyEventHandler","privacyStatementLinkHandler","emailCheckBoxHandler","basicFormInputHandler","singleFormInputHandler","keyCode","which","activeElement","shiftKey","stopPropagation","preventDefault","overallHandler","anchorId","PanelType","formTemplate","mainContentHolderSlideLeft","containerId","onSelect","panelType","overallSmileHandler","overallFrownHandler","overallIdeaHandler","Idea","overallBugHandler","SetVisibilityExceptFor","except","visible","feedbackPanes","children","currentFeedbackPane","submitButtonHandlerFactory","submitButtonId","commentInputId","emailInputId","categoriesDropdownId","commentElement","emailCheckBox","emailElement","isEmailIncluded","categoryElement","IsEmailIncluded","IsScreenshotIncluded","setScreenshot","overallThanksHandler","overallFeedbackPortalIdeaHandler","ScreenshotCheckboxClickHandler","CancelButtonHandler","emailTextBox","disabled","commentEntered","FormTemplateType","generate","attributes","innerText","CategoryPlaceholder","tag","starId","starDefinition","firstStar","secondStar","thirdStar","fourthStar","fifthStar","emptyStars","classes","oneFilledStar","twoFilledStar","threeFilledStar","fourFilledStar","fiveFilledStar","getInAppFeedbackLaunchOptions","SingleForm","brs","CommentPlaceholder","RatingLabel","isEmailEnabled","EmailPlaceholder","isScreenshotEnabled","ScreenshotLabel","ScreenshotImgAltText","PrivacyLabel","PrivacyConsent","PrivacyStatement","Cancel","SmileForm","FrownForm","IdeaForm","BugForm","Basic","Single","generateMultiForms","formTemplates","pushedContainers","generateMultiPanels","panelTemplates","generateOverallAnchors","generateOverallAnchor","IdeaRedirect","overallAnchorID","overallImageID","svgImage","overallTextID","uiString","innerHTML","elementFromJson","schema","attribute","concatClasses","makeLinkText","GetThankYouPageText","thankYouPageText","ThanksPanel","AppreciateText","IInitOptions","MyFeedbackDescription","MyFeedbackLinkText","FeedbackPortalDescription","FeedbackPortalLinkText","primaryColor","Close","ariaLabel","role","FeedbackPortalIdea","createMulti","onClose","FeedbackSubtitle","CloseLabel","useNarrowScreenLayout","FORMTEMPLATES","PANELTEMPLATES","USE_NARROW_LAYOUT","TRANSITIONENABLED","createSingle","userInterface","onMainContainerRender","setCommonInitOptions","getSdkSessionId","getEventSampling","setInAppFeedbackInitOptions","opened","multiFeedback","setInAppFeedbackLaunchOptions","IsBugEnabled","singleFeedback","feedbackTypeEnum","getFeedbackStatus"],"mappings":"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A,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,MAGJy6C,GAAS,CACTjkB,SAAU,CACN,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GAEJx2B,OAAQ,CACJ,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KACA,KACA,KACA,KACA,KACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,MAGJs6C,GAAW,CACX9jB,SAAU,CACN,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GAEJx2B,OAAQ,CACJ,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,MAGJmqD,GAAwB,SAAUp4D,EAAOqpC,EAAKwE,EAAKwqB,EAASC,EAAUC,GACtE,OAAIv4D,EAAQqpC,GAAOrpC,EAAQ6tC,EAChB2qB,GAAkBx4D,EAAOs4D,EAAUC,EAAOl3D,OAAS,GAEtDg3D,EAAQ5zB,SAASoW,QAAO,SAAU4d,EAAQC,EAAS5wD,GACvD,KAAO9H,GAAS04D,GACZ14D,GAAS04D,EACTD,GAAUJ,EAAQpqD,OAA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CA,KACA,KACA,KACA,KACA,KACA,QACA,KACA,QACA,KACA,KACA,KACA,KACA,MACA,KACA,QACA,KACA,KACA,KACA,KACA,aACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,QACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,QACA,KACA,KACA,QACA,KACA,KACA,KACA,MACA,QACA,QACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,aACA,aACA,aACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,aACA,KACA,UACA,WAGD,MAAMC,EAA+D,CACpE,QAAS,UACT,QAAS,UACT,QAAS,UACT,QAAS,UACT,QAAS,WAGH,SAASzpD,EAASxkB,GACxB,IAAIkuE,EAAkBluE,EAAO8kB,oBAG7B,GAAIopD,KAAmBD,EACtB,OAAOA,EAAkCC,GAI1C,IAAK,IAAIC,KAAmBH,EAC3B,GAAIG,EAAgBxjC,gBAAkBujC,EACrC,OAAOC,EAIT,IAAIC,EAAgBF,EAAgBG,MAAM,KAAK,GAE/C,IAAK,IAAIF,KAAmBH,EAC3B,GAAIG,EAAgBxjC,gBAAkByjC,EACrC,OAAOD,EAKT,MAAO,O,6BCrHR,IAAO3/C,GAAP,SAAOA,GAKN,+BAIA,OAHwB,EAAA8/C,UAAY,YACZ,EAAAC,aAAe,eACf,EAAAC,UAAY,YACpC,EAJA,GAAa,EAAAC,aAAY,EAL1B,CAAOjgD,MAAiB,KAYxB,UAASA,G,6BC7BT,IAAOC,GAAP,SAAOA,GAIO,EAAAigD,oBAAsB,CAClC95C,eAAgB,KAChBmC,sBAAuB,KACvBzd,sBAAuB,MAPzB,CAAOmV,MAAsB,KAW7B,UAASA,G,uGCdT,WAIA,OACA,QAIA,QACA,QAGA,OACA,QAEQ9N,EAAqDC,EAAK,iBAAxCC,EAAmCD,EAAK,eAAxBpZ,EAAmBoZ,EAAK,QAAfta,EAAUsa,EAAK,MAiBlE,aAwHC,WAAmB+tD,EAClBC,EACAr5D,EACAC,EACAq5D,EACAC,EA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","file":"officebrowserfeedback.es6.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 55);\n","/**\r\n * Configuration.ts\r\n *\r\n * Module for logic relating to the sdk user configuration\r\n */\r\n\r\nimport * as Utils from \"./../Utils\";\r\nimport * as Constants from \"./../Constants\";\r\nimport * as Localization from \"./../Localization\";\r\nimport { ICategoryOptions } from \"./ICategoryOptions\";\r\nimport * as IInitOptions from \"./IInitOptions\";\r\nimport * as ILaunchOptions from \"./ILaunchOptions\";\r\nimport IUISurvey from \"./../FloodgateCore/UISurvey/IUISurvey\";\r\nimport { IOnSurveyActivatedCallback, ISurveyForm, ISurveyLauncher } from \"@ms-ofb/officefloodgatecore/dist/src/Api/Api\";\r\nimport { ISurveyParams } from \"@ms-ofb/officefloodgatecore/dist/src/Api/IOnSurveyActivatedCallback\";\r\n\r\nexport * from \"./IInitOptions\";\r\nexport * from \"./ILaunchOptions\";\r\n\r\n/**\r\n * Class representing a configuration (user provided options)\r\n */\r\n\r\nexport class Configuration {\r\n\t/**\r\n\t * Validate category options, default \"show\" to false if CategoryOptions is not provided.\r\n\t * @param categories Category options\r\n\t * @returns {ICategoryOptions} the validated CategoryOptions\r\n\t */\r\n\tprivate static validateCategoryOptions(categories?: ICategoryOptions): ICategoryOptions {\r\n\t\tif (!categories) {\r\n\t\t\treturn { show: false };\r\n\t\t}\r\n\r\n\t\tUtils.expectBoolean(categories.show, \"categories.show\");\r\n\t\tif (categories.customCategories) {\r\n\t\t\tUtils.expectArray(categories.customCategories, \"categories.customCategories\");\r\n\r\n\t\t\tfor (let customCategory of categories.customCategories) {\r\n\t\t\t\tUtils.expectString(customCategory, \"custom category '\" + customCategory + \"'\");\r\n\t\t\t\tif (customCategory.length > 20) {\r\n\t\t\t\t\tthrow \"custom category '\" + customCategory + \"' too long, max 20 characters.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn categories;\r\n\t}\r\n\r\n\tprivate commonInitOptions: IInitOptions.IInitOptionsCommon;\r\n\r\n\tprivate inAppFeedbackInitOptions: IInitOptions.IInitOptionsInAppFeedback;\r\n\tprivate inAppFeedbackLaunchOptions: ILaunchOptions.ILaunchOptionsInAppFeedback;\r\n\r\n\tprivate floodgateInitOptions: IInitOptions.IInitOptionsFloodgate;\r\n\tprivate floodgateSurvey: IUISurvey;\r\n\r\n\tprivate sdkSessionId: string;\r\n\r\n\tprivate eventSampling: IInitOptions.ISamplingInitOption;\r\n\r\n\tprivate commonPolicyAllowAADC: boolean;\r\n\r\n\tprivate feedbackSubmitted: boolean = false;\r\n\r\n\tpublic getFeedbackSubmitted(): boolean {\r\n\t\treturn this.feedbackSubmitted;\r\n\t}\r\n\r\n\tpublic setFeedbackSubmitted(value: boolean): void {\r\n\t\tthis.feedbackSubmitted = value;\r\n\t}\r\n\r\n\tpublic getCommonInitOptions(): IInitOptions.IInitOptionsCommon {\r\n\t\treturn this.commonInitOptions;\r\n\t}\r\n\r\n\tpublic getInAppFeedbackInitOptions(): IInitOptions.IInitOptionsInAppFeedback {\r\n\t\treturn this.inAppFeedbackInitOptions;\r\n\t}\r\n\r\n\tpublic getInAppFeedbackLaunchOptions(): ILaunchOptions.ILaunchOptionsInAppFeedback {\r\n\t\treturn this.inAppFeedbackLaunchOptions;\r\n\t}\r\n\r\n\tpublic getFloodgateInitOptions(): IInitOptions.IInitOptionsFloodgate {\r\n\t\treturn this.floodgateInitOptions;\r\n\t}\r\n\r\n\tpublic getFloodgateSurvey(): IUISurvey {\r\n\t\treturn this.floodgateSurvey;\r\n\t}\r\n\r\n\tpublic getSdkSessionId(): string {\r\n\t\tif (!this.sdkSessionId) {\r\n\t\t\tthis.sdkSessionId = Utils.guid();\r\n\t\t}\r\n\r\n\t\treturn this.sdkSessionId;\r\n\t}\r\n\r\n\tpublic getEventSampling(): IInitOptions.ISamplingInitOption {\r\n\t\treturn this.eventSampling;\r\n\t}\r\n\r\n\t/**\r\n\t * Set initOptions for common functionality.\r\n\t */\r\n\tpublic setCommonInitOptions(passedInitOptions: IInitOptions.IInitOptionsCommon) {\r\n\t\tUtils.expectObject(passedInitOptions, \"passedInitOptions\");\r\n\t\tlet initOptions: IInitOptions.IInitOptionsCommon = {\r\n\t\t\tappId: passedInitOptions.appId,\r\n\t\t\tapplicationGroup: passedInitOptions.applicationGroup || {},\r\n\t\t\tbuild: passedInitOptions.build,\r\n\t\t\tcid: passedInitOptions.cid,\r\n\t\t\tenvironment: passedInitOptions.environment,\r\n\t\t\tintlFilename: passedInitOptions.intlFilename,\r\n\t\t\tintlUrl: passedInitOptions.intlUrl,\r\n\t\t\twebSurfacesResourceBaseUrl: passedInitOptions.webSurfacesResourceBaseUrl,\r\n\t\t\tlocale: passedInitOptions.locale,\r\n\t\t\tonError: passedInitOptions.onError,\r\n\t\t\toriginalLocale: passedInitOptions.locale,\r\n\t\t\tprimaryColour: passedInitOptions.primaryColour,\r\n\t\t\tsecondaryColour: passedInitOptions.secondaryColour,\r\n\t\t\tsessionId: passedInitOptions.sessionId,\r\n\t\t\tstylesUrl: passedInitOptions.stylesUrl,\r\n\t\t\ttelemetryGroup: passedInitOptions.telemetryGroup || {},\r\n\t\t\tuserEmail: passedInitOptions.userEmail,\r\n\t\t\twebGroup: passedInitOptions.webGroup || {},\r\n\t\t\teventSampling: passedInitOptions.eventSampling,\r\n\t\t\tpetrolTimeout: passedInitOptions.petrolTimeout,\r\n\t\t\tisCommercialHost: passedInitOptions.isCommercialHost,\r\n\t\t\tcustomResourcesSetExternally: passedInitOptions.customResourcesSetExternally,\r\n\t\t\temailPolicyValue: passedInitOptions.emailPolicyValue,\r\n\t\t\tscreenshotPolicyValue: passedInitOptions.screenshotPolicyValue,\r\n\t\t\tageGroup: passedInitOptions.ageGroup,\r\n\t\t\tauthenticationType: passedInitOptions.authenticationType,\r\n\t\t\tapplicationSettings: passedInitOptions.applicationSettings,\r\n\t\t\twebSurfacesSettings: passedInitOptions.webSurfacesSettings,\r\n\t\t};\r\n\r\n\t\tUtils.expectNumber(initOptions.appId, \"initOptions.appId\");\r\n\t\tif (!(initOptions.appId % 1 === 0 && initOptions.appId > 0)) {\r\n\t\t\tthrow \"initOptions.appId is not a positive integer: \" + initOptions.appId;\r\n\t\t}\r\n\r\n\t\t// tslint:disable-next-line: no-bitwise\r\n\t\tconst expectedValues = IInitOptions.CustomResources.Strings | IInitOptions.CustomResources.Css;\r\n\r\n\t\tif (initOptions.customResourcesSetExternally === undefined) {\r\n\t\t\tinitOptions.customResourcesSetExternally = IInitOptions.CustomResources.None;\r\n\t\t\t// tslint:disable-next-line: no-bitwise\r\n\t\t} else if (typeof (initOptions.customResourcesSetExternally) !== \"number\" ||\r\n\t\t\t// tslint:disable-next-line: no-bitwise\r\n\t\t\t(initOptions.customResourcesSetExternally | expectedValues) !== expectedValues) {\r\n\t\t\tthrow \"initOptions.customResourcesSetExternally has an invalid value: \" + initOptions.customResourcesSetExternally;\r\n\t\t}\r\n\t\t// tslint:disable-next-line: no-bitwise\r\n\t\tif ((initOptions.customResourcesSetExternally & IInitOptions.CustomResources.Css) !== IInitOptions.CustomResources.Css) {\r\n\t\t\tUtils.expectString(initOptions.stylesUrl, \"initOptions.stylesUrl\");\r\n\t\t}\r\n\t\t// tslint:disable-next-line: no-bitwise\r\n\t\tif ((initOptions.customResourcesSetExternally & IInitOptions.CustomResources.Strings) !== IInitOptions.CustomResources.Strings) {\r\n\t\t\tUtils.expectString(initOptions.intlUrl, \"initOptions.intlUrl\");\r\n\t\t}\r\n\r\n\t\tif (initOptions.intlFilename !== undefined) {\r\n\t\t\tUtils.expectString(initOptions.intlFilename, \"initOptions.intlFilename\");\r\n\t\t} else {\r\n\t\t\tinitOptions.intlFilename = \"officebrowserfeedbackstrings.js\";\r\n\t\t}\r\n\r\n\t\tUtils.expectNumber(initOptions.environment, \"initOptions.environment\");\r\n\t\tif (!(initOptions.environment === 1 || initOptions.environment === 0)) {\r\n\t\t\tthrow \"initOptions.environment has a bad value: \" + initOptions.environment;\r\n\t\t}\r\n\r\n\t\tif (initOptions.userEmail !== undefined) {\r\n\t\t\tUtils.expectString(initOptions.userEmail, \"initOptions.userEmail\");\r\n\t\t} else {\r\n\t\t\tinitOptions.userEmail = \"\";\r\n\t\t}\r\n\r\n\t\tif (initOptions.sessionId !== undefined) {\r\n\t\t\tUtils.expectString(initOptions.sessionId, \"initOptions.sessionId\");\r\n\t\t} else {\r\n\t\t\tinitOptions.sessionId = \"00000000-0000-0000-0000-000000000000\";\r\n\t\t}\r\n\r\n\t\t// Copy sessionID over to telemetryGroup\r\n\t\tinitOptions.telemetryGroup.processSessionId = initOptions.sessionId;\r\n\r\n\t\tif (initOptions.cid !== undefined) {\r\n\t\t\tUtils.expectString(initOptions.cid, \"initOptions.cid\");\r\n\r\n\t\t\t// Copy cid over to extendedManifestData of applicationGroup\r\n\t\t\tinitOptions.applicationGroup.extendedManifestData = JSON.stringify({ cid: initOptions.cid });\r\n\t\t}\r\n\r\n\t\tif (initOptions.build !== undefined) {\r\n\t\t\tUtils.expectString(initOptions.build, \"initOptions.build\");\r\n\t\t\tlet buildRegex = \"^[0-9]{1,9}(\\\\.[0-9]{1,9})?(\\\\.[0-9]{1,9})?(\\\\.[0-9]{1,9})?$\";\r\n\t\t\tif (!new RegExp(buildRegex).test(initOptions.build)) {\r\n\t\t\t\tinitOptions.build = \"0.0.0.0\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tinitOptions.build = \"0.0.0.0\";\r\n\t\t}\r\n\t\t// Copy build over to telemetryGroup\r\n\t\tinitOptions.telemetryGroup.officeBuild = initOptions.build;\r\n\r\n\t\tlet hexColourRegex = new RegExp(\"^#[0-9a-f]{3}([0-9a-f]{3})?$\", \"i\");\r\n\t\tif (initOptions.primaryColour !== undefined) {\r\n\t\t\tif (!hexColourRegex.test(initOptions.primaryColour)) {\r\n\t\t\t\tinitOptions.primaryColour = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (initOptions.secondaryColour !== undefined) {\r\n\t\t\tif (!hexColourRegex.test(initOptions.secondaryColour)) {\r\n\t\t\t\tinitOptions.secondaryColour = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (initOptions.locale !== undefined) {\r\n\t\t\tUtils.expectString(initOptions.locale, \"initOptions.locale\");\r\n\t\t\tinitOptions.locale = Localization.validate(initOptions.locale);\r\n\t\t} else {\r\n\t\t\tinitOptions.locale = \"en\";\r\n\t\t}\r\n\r\n\t\tif (initOptions.onError === undefined) {\r\n\t\t\tinitOptions.onError = (err: string) => { return; };\r\n\t\t}\r\n\r\n\t\tif (initOptions.petrolTimeout !== undefined) {\r\n\t\t\tUtils.expectNumber(initOptions.petrolTimeout, \"initOptions.petrolTimeout\");\r\n\t\t}\r\n\r\n\t\tif (initOptions.authenticationType !== undefined) {\r\n\t\t\tUtils.expectEnum(initOptions.authenticationType, IInitOptions.AuthenticationType, \"initOptions.authenticationType\");\r\n\t\t} else {\r\n\t\t\tinitOptions.authenticationType = IInitOptions.AuthenticationType.Unauthenticated;\r\n\t\t}\r\n\r\n\t\t// For AAD or Unauthenticated, ageGroup value is unknown, so it's safe to only parse for MSA\r\n\t\tif (initOptions.ageGroup !== undefined) {\r\n\t\t\tUtils.expectEnum(initOptions.ageGroup, IInitOptions.AgeGroup, \"initOptions.ageGroup\");\r\n\t\t} else {\r\n\t\t\tinitOptions.ageGroup = IInitOptions.AgeGroup.Undefined;\r\n\t\t}\r\n\r\n\t\tthis.eventSampling = this.parseEventSamplingOption(initOptions.eventSampling);\r\n\r\n\t\tthis.commonInitOptions = initOptions;\r\n\t\tthis.commonPolicyAllowAADC = this.determineAADCPolicy(initOptions.authenticationType, initOptions.ageGroup);\r\n\r\n\t\tif (initOptions.isCommercialHost === undefined || initOptions.isCommercialHost == null) {\r\n\t\t\tinitOptions.isCommercialHost = false; // By default privacy consent is not shown. (From SDK's perspective)\r\n\t\t} else {\r\n\t\t\tUtils.expectBoolean(initOptions.isCommercialHost, \"initOptions.isCommercialHost\");\r\n\t\t}\r\n\r\n\t\tif (initOptions.emailPolicyValue === undefined) {\r\n\t\t\tinitOptions.emailPolicyValue = Constants.OCPSValues.NotConfigured;\r\n\t\t} else if (typeof (initOptions.emailPolicyValue) !== \"number\" ||\r\n\t\t\t(initOptions.emailPolicyValue !== Constants.OCPSValues.NotConfigured &&\r\n\t\t\t\tinitOptions.emailPolicyValue !== Constants.OCPSValues.Enabled &&\r\n\t\t\t\tinitOptions.emailPolicyValue !== Constants.OCPSValues.Disabled)) {\r\n\t\t\tthrow \"initOptions.emailPolicyValue has an invalid value: \" + initOptions.emailPolicyValue;\r\n\t\t}\r\n\r\n\t\tif (initOptions.screenshotPolicyValue === undefined) {\r\n\t\t\tinitOptions.screenshotPolicyValue = Constants.OCPSValues.NotConfigured;\r\n\t\t} else if (typeof (initOptions.screenshotPolicyValue) !== \"number\" ||\r\n\t\t\tinitOptions.screenshotPolicyValue !== Constants.OCPSValues.NotConfigured &&\r\n\t\t\tinitOptions.screenshotPolicyValue !== Constants.OCPSValues.Enabled &&\r\n\t\t\tinitOptions.screenshotPolicyValue !== Constants.OCPSValues.Disabled) {\r\n\t\t\tthrow \"initOptions.screenshotPolicyValue has an invalid value: \" + initOptions.screenshotPolicyValue;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Set init options for inAppFeedback\r\n\t */\r\n\tpublic setInAppFeedbackInitOptions(passedInitOptions: IInitOptions.IInitOptionsInAppFeedback) {\r\n\t\tUtils.expectObject(passedInitOptions, \"passedInitOptions\");\r\n\r\n\t\tlet initOptions: IInitOptions.IInitOptionsInAppFeedback = {\r\n\t\t\tbugForm: passedInitOptions.bugForm,\r\n\t\t\tonDismiss: passedInitOptions.onDismiss,\r\n\t\t\tscreenshot: passedInitOptions.screenshot,\r\n\t\t\tshowEmailAddress: passedInitOptions.showEmailAddress,\r\n\t\t\tuserEmail: passedInitOptions.userEmail,\r\n\t\t\ttransitionEnabled: passedInitOptions.transitionEnabled,\r\n\t\t\tisShowThanks: passedInitOptions.isShowThanks,\r\n\t\t\tsendFeedbackPolicyValue: passedInitOptions.sendFeedbackPolicyValue,\r\n\t\t\tfeedbackForumUrl: passedInitOptions.feedbackForumUrl !== undefined ?\r\n\t\t\t\tpassedInitOptions.feedbackForumUrl :\r\n\t\t\t\tundefined,\r\n\t\t\tmyFeedbackForumUrl: passedInitOptions.myFeedbackForumUrl !== undefined ?\r\n\t\t\t\tpassedInitOptions.myFeedbackForumUrl :\r\n\t\t\t\tundefined,\r\n\t\t};\r\n\r\n\t\tif (initOptions.onDismiss === undefined) {\r\n\t\t\tinitOptions.onDismiss = function (submitted: boolean) { return; };\r\n\t\t}\r\n\r\n\t\tif (initOptions.bugForm !== undefined) {\r\n\t\t\tUtils.expectBoolean(initOptions.bugForm, \"initOptions.bugForm\");\r\n\t\t} else {\r\n\t\t\tinitOptions.bugForm = false;\r\n\t\t}\r\n\r\n\t\tif (initOptions.userEmail !== undefined) {\r\n\t\t\tUtils.expectString(initOptions.userEmail, \"initOptions.userEmail\");\r\n\t\t}\r\n\r\n\t\tif (initOptions.screenshot !== undefined) {\r\n\t\t\tUtils.expectBoolean(initOptions.screenshot, \"initOptions.screenshot\");\r\n\t\t} else {\r\n\t\t\tinitOptions.screenshot = true;\r\n\t\t}\r\n\r\n\t\tif (initOptions.showEmailAddress !== undefined) {\r\n\t\t\tUtils.expectBoolean(initOptions.showEmailAddress, \"initOptions.showEmailAddress\");\r\n\t\t} else {\r\n\t\t\tinitOptions.showEmailAddress = true;\r\n\t\t}\r\n\r\n\t\tif (initOptions.feedbackForumUrl !== undefined) {\r\n\t\t\tUtils.expectString(initOptions.feedbackForumUrl, \"initOptions.feedbackForumUrl\");\r\n\t\t} else {\r\n\t\t\tinitOptions.feedbackForumUrl = undefined;\r\n\t\t}\r\n\r\n\t\tif (initOptions.isShowThanks !== undefined) {\r\n\t\t\tUtils.expectBoolean(initOptions.isShowThanks, \"initOptions.isShowThanks\");\r\n\t\t} else {\r\n\t\t\tinitOptions.isShowThanks = true;\r\n\t\t}\r\n\r\n\t\tif (initOptions.myFeedbackForumUrl !== undefined) {\r\n\t\t\tUtils.expectString(initOptions.myFeedbackForumUrl, \"initOptions.myFeedbackForumUrl\");\r\n\t\t} else {\r\n\t\t\tinitOptions.myFeedbackForumUrl = undefined;\r\n\t\t}\r\n\r\n\t\tif (initOptions.transitionEnabled === undefined) {\r\n\t\t\tinitOptions.transitionEnabled = true;\r\n\t\t}\r\n\r\n\t\tif (initOptions.sendFeedbackPolicyValue === undefined) {\r\n\t\t\tinitOptions.sendFeedbackPolicyValue = Constants.OCPSValues.NotConfigured;\r\n\t\t} else if (typeof (initOptions.sendFeedbackPolicyValue) !== \"number\" ||\r\n\t\t\t(initOptions.sendFeedbackPolicyValue !== Constants.OCPSValues.NotConfigured &&\r\n\t\t\t\tinitOptions.sendFeedbackPolicyValue !== Constants.OCPSValues.Enabled &&\r\n\t\t\t\tinitOptions.sendFeedbackPolicyValue !== Constants.OCPSValues.Disabled)) {\r\n\t\t\tthrow \"initOptions.sendFeedbackPolicyValue has an invalid value: \" + initOptions.sendFeedbackPolicyValue;\r\n\t\t}\r\n\r\n\t\tthis.inAppFeedbackInitOptions = initOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Set launch options for inAppFeedback\r\n\t */\r\n\tpublic setInAppFeedbackLaunchOptions(launchOptions?: ILaunchOptions.ILaunchOptionsInAppFeedback) {\r\n\t\tif (!this.commonInitOptions) {\r\n\t\t\tthrow \"commonInitOptions not set\";\r\n\t\t}\r\n\r\n\t\tif (!launchOptions) {\r\n\t\t\tlaunchOptions = {};\r\n\t\t}\r\n\r\n\t\t// Override any setting done in LaunchOptions for the metadataGroups\r\n\t\tthis.commonInitOptions.applicationGroup = Utils.overrideValues(launchOptions.applicationGroup,\r\n\t\t\tthis.commonInitOptions.applicationGroup);\r\n\t\tthis.commonInitOptions.telemetryGroup = Utils.overrideValues(launchOptions.telemetryGroup,\r\n\t\t\tthis.commonInitOptions.telemetryGroup);\r\n\t\tthis.commonInitOptions.webGroup = Utils.overrideValues(launchOptions.webGroup,\r\n\t\t\tthis.commonInitOptions.webGroup);\r\n\r\n\t\tlaunchOptions.categories = Configuration.validateCategoryOptions(launchOptions.categories);\r\n\r\n\t\tthis.inAppFeedbackLaunchOptions = launchOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Set init options for floodgate\r\n\t */\r\n\tpublic setFloodgateInitOptions(passedInitOptions: IInitOptions.IInitOptionsFloodgate) {\r\n\t\tUtils.expectObject(passedInitOptions, \"passedInitOptions\");\r\n\r\n\t\tlet initOptions: IInitOptions.IInitOptionsFloodgate = {\r\n\t\t\tautoDismiss: passedInitOptions.autoDismiss,\r\n\t\t\tcampaignDefinitions: passedInitOptions.campaignDefinitions,\r\n\t\t\tcampaignFlights: passedInitOptions.campaignFlights,\r\n\t\t\tcampaignQueryParameters: passedInitOptions.campaignQueryParameters,\r\n\t\t\tonDismiss: passedInitOptions.onDismiss,\r\n\t\t\tonSurveyActivatedCallback: passedInitOptions.onSurveyActivatedCallback,\r\n\t\t\tsettingStorageCallback: passedInitOptions.settingStorageCallback,\r\n\t\t\tuIStringGetter: passedInitOptions.uIStringGetter,\r\n\t\t\tauthTokenCallback: passedInitOptions.authTokenCallback,\r\n\t\t\tsurveyEnabled: passedInitOptions.surveyEnabled,\r\n\t\t\tshowEmailAddress: passedInitOptions.showEmailAddress,\r\n\t\t\taugLoopCallback: passedInitOptions.augLoopCallback,\r\n\t\t\tcustomerVoiceSurveyParams: passedInitOptions.customerVoiceSurveyParams,\r\n\t\t\tgovernanceServiceEnabled: passedInitOptions.governanceServiceEnabled,\r\n\t\t\tgovernanceServiceConfig: passedInitOptions.governanceServiceConfig,\r\n\t\t\tpersonalizerEnabled: passedInitOptions.personalizerEnabled,\r\n\t\t\tmessagingServiceSettings: passedInitOptions.messagingServiceSettings,\r\n\t\t};\r\n\r\n\t\tif (initOptions.autoDismiss === undefined) {\r\n\t\t\tinitOptions.autoDismiss = Constants.AutoDismissValues.NoAutoDismiss;\r\n\t\t}\r\n\r\n\t\tif (initOptions.onDismiss === undefined) {\r\n\t\t\tinitOptions.onDismiss = (campaignId: string, submitted: boolean) => { return; };\r\n\t\t}\r\n\r\n\t\tif (initOptions.onSurveyActivatedCallback === undefined) {\r\n\t\t\tlet defaultOnSurveyActivatedCallback: IOnSurveyActivatedCallback = {\r\n\t\t\t\tonSurveyActivated(launcher: ISurveyLauncher, survey?: ISurveyForm, surveyParams?: ISurveyParams): void {\r\n\t\t\t\t\tlauncher.launch();\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tinitOptions.onSurveyActivatedCallback = defaultOnSurveyActivatedCallback;\r\n\t\t}\r\n\r\n\t\tif (initOptions.uIStringGetter === undefined) {\r\n\t\t\tinitOptions.uIStringGetter = (str: string) => str; // By default return the string as is.\r\n\t\t}\r\n\r\n\t\tif (initOptions.surveyEnabled === undefined) {\r\n\t\t\tinitOptions.surveyEnabled = true; // By default surveys are enabled. (From SDK's perspective)\r\n\t\t} else {\r\n\t\t\tUtils.expectBoolean(initOptions.surveyEnabled, \"surveyEnabled\");\r\n\t\t}\r\n\r\n\t\tif (initOptions.showEmailAddress !== undefined) {\r\n\t\t\tUtils.expectBoolean(initOptions.showEmailAddress, \"initOptionsFloodgate.showEmailAddress\");\r\n\t\t} else {\r\n\t\t\tinitOptions.showEmailAddress = true;  // By default email field and collection is enabled. (From SDK's perspective)\r\n\t\t}\r\n\r\n\t\tif (initOptions.governanceServiceEnabled !== undefined) {\r\n\t\t\tUtils.expectBoolean(initOptions.governanceServiceEnabled, \"initOptionsFloodgate.governanceServiceEnable\");\r\n\t\t} else {\r\n\t\t\tinitOptions.governanceServiceEnabled = false;  // By default governanceServiceEnable is disabled\r\n\t\t}\r\n\r\n\t\tif (initOptions.governanceServiceEnabled) {\r\n\t\t\tinitOptions.governanceServiceConfig = this.parseGovernanceServiceConfig(\r\n\t\t\t\tinitOptions.governanceServiceConfig !== undefined ?\r\n\t\t\t\t\tinitOptions.governanceServiceConfig :\r\n\t\t\t\t\t{});\r\n\t\t}\r\n\r\n\t\tif (initOptions.customerVoiceSurveyParams === undefined) {\r\n\t\t\tinitOptions.customerVoiceSurveyParams = { cvFlights: \"\", isCVSurveyEnabled: false, productName: \"\", uiHost: \"\" };\r\n\t\t}\r\n\r\n\t\tif (initOptions.personalizerEnabled !== undefined) {\r\n\t\t\tUtils.expectBoolean(initOptions.personalizerEnabled, \"initOptionsFloodgate.personalizerEnabled\");\r\n\t\t} else {\r\n\t\t\tinitOptions.personalizerEnabled = false;  // By default personalizerEnabled is disabled\r\n\t\t}\r\n\r\n\t\tthis.floodgateInitOptions = initOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Set the floodgate survey\r\n\t */\r\n\tpublic setFloodgateSurvey(survey: IUISurvey): void {\r\n\t\tthis.floodgateSurvey = survey;\r\n\t}\r\n\r\n\t// Checks if the surveyEnabled policy is true or false.\r\n\tpublic checkIfSurveysEnabled(): boolean {\r\n\t\t// If no floodgateInitOptions defined, return true for surveyEnabled\r\n\t\tconst policyAllowSurvey = this.floodgateInitOptions ? this.floodgateInitOptions.surveyEnabled : true;\r\n\t\treturn policyAllowSurvey && this.commonPolicyAllowAADC;\r\n\t}\r\n\r\n\t/**\r\n\t * Return the flag the Feedback and Survey enabled by AADC.\r\n\t */\r\n\tpublic isFeedbackSurveyEnabledByAADC(): boolean {\r\n\t\treturn this.commonPolicyAllowAADC;\r\n\t}\r\n\r\n\tpublic getCVSurveyFlights(): string | null {\r\n\t\treturn this.floodgateInitOptions && this.floodgateInitOptions.customerVoiceSurveyParams ?\r\n\t\t\tthis.floodgateInitOptions.customerVoiceSurveyParams.cvFlights : \"\";\r\n\t}\r\n\r\n\tpublic isCVSurveyEnabled(): boolean {\r\n\t\treturn this.floodgateInitOptions && this.floodgateInitOptions.customerVoiceSurveyParams ?\r\n\t\t\tthis.floodgateInitOptions.customerVoiceSurveyParams.isCVSurveyEnabled : false;\r\n\t}\r\n\r\n\tpublic getProductName(): string {\r\n\t\treturn this.floodgateInitOptions && this.floodgateInitOptions.customerVoiceSurveyParams ?\r\n\t\t\tthis.floodgateInitOptions.customerVoiceSurveyParams.productName : \"\";\r\n\t}\r\n\r\n\tpublic getUIHost(): string {\r\n\t\treturn this.floodgateInitOptions && this.floodgateInitOptions.customerVoiceSurveyParams ?\r\n\t\t\tthis.floodgateInitOptions.customerVoiceSurveyParams.uiHost : \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Check AADC rule at once since Configuration cannot be set again.\r\n\t * So that we don't need to repeat the same process over again.\r\n\t */\r\n\tpublic determineAADCPolicy(authenticationType: IInitOptions.AuthenticationType,\r\n\t\tageGroup: IInitOptions.AgeGroup): boolean {\r\n\t\t// Return Based on authentication first\r\n\t\tif (authenticationType === IInitOptions.AuthenticationType.Unauthenticated ||\r\n\t\t\tauthenticationType === IInitOptions.AuthenticationType.AAD) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t// Return based on AgeGroup\r\n\t\treturn ageGroup !== IInitOptions.AgeGroup.MinorWithParentalConsent &&\r\n\t\t\tageGroup !== IInitOptions.AgeGroup.MinorWithoutParentalConsent;\r\n\t}\r\n\r\n\t// Keep implementation in sync with %SRCROOT%\\privacy\\idconsentprovider\\IdentityBasedConsentGroupProvider.cpp\r\n\tpublic getUserConsentGroup(): IInitOptions.UserConsentGroup {\r\n\t\tconst authenticationType = this.commonInitOptions.authenticationType;\r\n\t\tif (authenticationType === IInitOptions.AuthenticationType.Unauthenticated ||\r\n\t\t\tauthenticationType === IInitOptions.AuthenticationType.AAD) {\r\n\t\t\treturn IInitOptions.UserConsentGroup.CanConsent;\r\n\t\t}\r\n\r\n\t\tconst ageGroup = this.commonInitOptions.ageGroup;\r\n\t\tswitch (ageGroup) {\r\n\t\t\tcase IInitOptions.AgeGroup.Undefined:\r\n\t\t\t\treturn IInitOptions.UserConsentGroup.CanConsent;\r\n\t\t\tcase IInitOptions.AgeGroup.MinorWithoutParentalConsent:\r\n\t\t\t\treturn IInitOptions.UserConsentGroup.CannotConsent;\r\n\t\t\tcase IInitOptions.AgeGroup.MinorWithParentalConsent:\r\n\t\t\t\treturn IInitOptions.UserConsentGroup.CannotConsent;\r\n\t\t\tcase IInitOptions.AgeGroup.Adult:\r\n\t\t\t\treturn IInitOptions.UserConsentGroup.CanConsent;\r\n\t\t\tcase IInitOptions.AgeGroup.NotAdult:\r\n\t\t\t\treturn IInitOptions.UserConsentGroup.PartialConsent;\r\n\t\t\tcase IInitOptions.AgeGroup.MinorNoParentalConsentRequired:\r\n\t\t\t\treturn IInitOptions.UserConsentGroup.CanConsent;\r\n\t\t\tdefault:\r\n\t\t\t\treturn IInitOptions.UserConsentGroup.CannotConsent;\r\n\t\t}\r\n\r\n\t\treturn IInitOptions.UserConsentGroup.CannotConsent;\r\n\t}\r\n\r\n\tprivate parseEventSamplingOption(samplingOptions: IInitOptions.ISamplingEvent[]): IInitOptions.ISamplingInitOption {\r\n\t\tlet eventInitSampling: IInitOptions.ISamplingInitOption = { event: {} };\r\n\t\tif (samplingOptions !== undefined) {\r\n\t\t\t// Iterating through init options\r\n\t\t\tfor (const index in samplingOptions) {\r\n\t\t\t\tif (samplingOptions.hasOwnProperty(index)) {\r\n\t\t\t\t\t// Check for correct Type\r\n\t\t\t\t\tswitch (samplingOptions[index].type) {\r\n\t\t\t\t\t\tcase \"Event\":\r\n\t\t\t\t\t\t\t// Parsing the Name and SampleRate\r\n\t\t\t\t\t\t\tlet sampleRate = samplingOptions[index].sampleRate;\r\n\t\t\t\t\t\t\tUtils.expectNumber(sampleRate, \"initOption.EventSampling.SampleRate\");\r\n\t\t\t\t\t\t\tUtils.expectString(samplingOptions[index].name, \"initOption.EventSampling.Name\");\r\n\t\t\t\t\t\t\t// check the range for sampling percentage\r\n\t\t\t\t\t\t\tif (sampleRate < 0 || sampleRate > 1) {\r\n\t\t\t\t\t\t\t\tthrow \"initOption.EventSampling.\" + samplingOptions[index].name + \".SampleRate is out of range\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// finally, save the sampling event\r\n\t\t\t\t\t\t\teventInitSampling.event[samplingOptions[index].name] = sampleRate;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tthrow \"initOption.EventSampling.Type value is not recognized\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn eventInitSampling;\r\n\t}\r\n\r\n\tprivate parseGovernanceServiceConfig(config: IInitOptions.IGovernanceServiceConfig): IInitOptions.IGovernanceServiceConfig {\r\n\t\treturn {\r\n\t\t\t// by default, disable the trigger in failure\r\n\t\t\tforceServicelessSurveyDisplay: config.forceServicelessSurveyDisplay ?? false,\r\n\r\n\t\t\t// by default, no retry\r\n\t\t\tretry: config.retry ?? 1,\r\n\r\n\t\t\t// by default, timeout is 1000 miliseconds\r\n\t\t\ttimeout: config.timeout ?? 1000,\r\n\r\n\t\t\t// simple request is default to false\r\n\t\t\tsimpleRequestEnabled: config.simpleRequestEnabled ?? false,\r\n\t\t};\r\n\t}\r\n}\r\n\r\nlet configuration: Configuration = new Configuration();\r\n\r\n/**\r\n * Get the current configuration\r\n */\r\nexport function get(): Configuration {\r\n\treturn configuration;\r\n}\r\n\r\n/**\r\n * Validate feedbackType\r\n * @param feedbackType feedbackType\r\n * @returns {Constants.FeedbackType} the validated feedbackType\r\n */\r\nexport function validateFeedbackType(feedbackType: string): Constants.FeedbackType {\r\n\tUtils.expectString(feedbackType, \"feedbackType\");\r\n\r\n\tif (feedbackType === Constants.FeedbackType[Constants.FeedbackType.Smile]) {\r\n\t\treturn Constants.FeedbackType.Smile;\r\n\t} else if (feedbackType === Constants.FeedbackType[Constants.FeedbackType.Frown]) {\r\n\t\treturn Constants.FeedbackType.Frown;\r\n\t} else if (feedbackType === Constants.FeedbackType[Constants.FeedbackType.Bug]) {\r\n\t\treturn Constants.FeedbackType.Bug;\r\n\t} else {\r\n\t\tthrow \"feedbackType should be one of Smile, Frown or Bug\";\r\n\t}\r\n}\r\n","/*\r\n * Utils.ts\r\n *\r\n * Module for utility functions\r\n */\r\n\r\nimport { Utils } from \"@ms-ofb/officefloodgatecore\";\r\nconst { guid, overrideValues, isNOU, isBoolean, isString, isObject, isEnumValue } = Utils;\r\nexport { guid, overrideValues, isNOU, isBoolean }\r\n\r\n/**\r\n * Check if given value is a number\r\n * @param {any} value value\r\n */\r\nfunction isNumber(value: any): boolean {\r\n\treturn (typeof value === \"number\");\r\n}\r\n\r\n/**\r\n * Check if given value is an integer\r\n * @param {any} value value\r\n */\r\nexport function isInteger(value: any): boolean {\r\n\treturn typeof value === \"number\" &&\r\n\t\tisFinite(value) &&\r\n\t\tMath.floor(value) === value;\r\n}\r\n\r\n/**\r\n * Check if value is a valid guid\r\n * @param {any} value value\r\n */\r\nfunction isGuid(value: any): boolean {\r\n\treturn (isString(value) &&\r\n\t\t/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(value));\r\n}\r\n\r\n/**\r\n * Throw if not object\r\n */\r\nexport function expectObject(value: any, name: string): void {\r\n\tif (!isObject(value)) {\r\n\t\tthrow name + \" is not an object: \" + value;\r\n\t}\r\n}\r\n\r\n/**\r\n * Throw if not number\r\n */\r\nexport function expectNumber(value: any, name: string): void {\r\n\tif (!isNumber(value)) {\r\n\t\tthrow name + \" is not a number: \" + value;\r\n\t}\r\n}\r\n\r\n/**\r\n * Throw if not string\r\n */\r\nexport function expectString(value: any, name: string): void {\r\n\tif (!isString(value)) {\r\n\t\tthrow name + \" is not a string: \" + value;\r\n\t}\r\n}\r\n\r\n/**\r\n * Throw if not boolean\r\n */\r\nexport function expectBoolean(value: any, name: string): void {\r\n\tif (!isBoolean(value)) {\r\n\t\tthrow name + \" is not a boolean: \" + value;\r\n\t}\r\n}\r\n\r\n/**\r\n * Throw if not guid\r\n */\r\nexport function expectGuid(value: any, name: string): void {\r\n\tif (!isGuid(value)) {\r\n\t\tthrow name + \" is not a guid: \" + value;\r\n\t}\r\n}\r\n\r\n/**\r\n * Throw if not array\r\n */\r\nexport function expectArray(value: any, name: string): void {\r\n\tif (!Array.isArray(value)) {\r\n\t\tthrow name + \" is not an array: \" + value;\r\n\t}\r\n}\r\n\r\n/**\r\n * Throw if not valid enum\r\n * Note: this won't work with const enum\r\n */\r\nexport function expectEnum(value: any, enumType: any, name: string): void {\r\n\tif (!isNumber(value) || !isEnumValue(value, enumType)) {\r\n\t\tthrow name + \" is not an enum: \" + value;\r\n\t}\r\n}\r\n\r\n// Creates a promise that rejects in <ms> milliseconds and\r\n// returns the race between the created timeout promise and the passed in promise\r\nexport function createTimeoutPromise<T>(ms: number, promise: Promise<T>): Promise<T> {\r\n\t// Create a promise that rejects in <ms> milliseconds\r\n\tconst timeout = new Promise((resolve, reject) => {\r\n\t\tconst id = setTimeout(() => {\r\n\t\t\tclearTimeout(id);\r\n\t\t\treject(\"Timed out in \" + ms + \"ms.\");\r\n\t\t}, ms);\r\n\t});\r\n\r\n\t// Returns a race between our timeout and the passed in promise\r\n\treturn Promise.race([promise, timeout]) as Promise<T>;\r\n}\r\n\r\n/**\r\n * Checks to see if a passed CSS selector is set as a rule in one of the document's stylesheets.\r\n * \r\n * @param cssSelector : a Css selector string such as '#obf-TPromptTitle'\r\n */\r\nexport function checkCssSelectorToBeSet (cssSelector: string): boolean {\r\n\r\n\ttry {\r\n\t\tfor (let sheetIndex = 0; sheetIndex < document.styleSheets.length; sheetIndex++) {\r\n\t\t\tconst currentStyleSheet = document.styleSheets[sheetIndex];\r\n\r\n\t\t\tfor (let rulesIndex = 0; rulesIndex < currentStyleSheet.rules.length; rulesIndex++) {\r\n\t\t\t\tconst currentRule = currentStyleSheet.rules[rulesIndex] as CSSStyleRule;\r\n\r\n\t\t\t\tif (!isNOU(currentRule.selectorText) && currentRule.selectorText.includes(cssSelector)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// tslint:disable-next-line: no-empty\r\n\t} catch (error) {}\r\n\r\n\treturn false;\r\n}\r\n","/**\r\n * Constants.ts\r\n *\r\n * A module for non-UI constants.\r\n */\r\n\r\n/**\r\n * Value for the Customer Voice Launcher Type\r\n */\r\nexport const customerVoiceLauncherType = \"customervoice\";\r\n\r\n/**\r\n * Value for the Customer Voice Survey text for adding to App data\r\n */\r\nexport const customerVoiceSurveyUX = \"Customer Voice Survey UX\";\r\n\r\n/**\r\n * Values for types of feedback that go into the json\r\n * Also used to determine the FormTemplate used on each one of the feedback types.\r\n */\r\nexport enum FeedbackType {\r\n\tSmile,\r\n\tFrown,\r\n\tIdea,\r\n\tBug,\r\n\tIdeaRedirect,\r\n}\r\n\r\n/**\r\n * Values for types of panels that go into the json\r\n * Also used to determine the PanelTemplate used on each one of the panel types.\r\n */\r\nexport const enum PanelType {\r\n\tThanks\r\n}\r\n\r\n/**\r\n * Values for the environment\r\n */\r\nexport const enum Environment {\r\n\tProduction,\r\n\tInt\r\n}\r\n\r\n/**\r\n * Values for autodismiss\r\n */\r\nexport const enum AutoDismissValues {\r\n\tNoAutoDismiss,\r\n\tSevenSeconds,\r\n\tFourteenSeconds,\r\n\tTwentyOneSeconds,\r\n\tTwentyEightSeconds,\r\n\tSixtySeconds,\r\n\tNinetySeconds,\r\n\tOneHundredAndTwentySeconds,\r\n\tOneHundredAndFiftySeconds,\r\n}\r\n\r\n/**\r\n * Dynamic scripts\r\n */\r\nexport class DynamicScriptUrls {\r\n\t/**\r\n\t * Link to the Office WebSurfaces UX package\r\n\t */\r\n\t/* tslint:disable:max-line-length */\r\n\tpublic static WebSurfacesIntLink: string = \"https://content.growth.office.net/mirrored/resources/programmablesurfaces/int/officewebsurfaces.core.min.js\";\r\n\tpublic static WebSurfacesProdLink: string = \"https://content.growth.office.net/mirrored/resources/programmablesurfaces/prod/officewebsurfaces.core.min.js\";\r\n}\r\n\r\n/**\r\n * Constant GUIDs\r\n */\r\nexport class GUIDs {\r\n\tpublic static TMSAppID: string = \"4c4f550b-42b2-4a16-93f9-fdb9e01bb6ed\";\r\n\tpublic static TULIPSAppID: string = \"05c88d91-956e-46b4-91b0-77a33cc21a4d\";\r\n}\r\n\r\nexport const enum OCPSValues {\r\n\tNotConfigured = 0,\r\n\tEnabled = 1,\r\n\tDisabled = 2\r\n}\r\n\r\nexport const enum FeedbackStatus {\r\n\tEnabled,\r\n\tDisabledByAdmin,\r\n\tDisabledByAgeGroup\r\n}\r\n\r\n/**\r\n * Prefix for SDK version string\r\n */\r\nexport const SDK_VERSION_PREFIX = \"Web SDK v\";\r\n","import * as Constants from \"./../Constants\";\r\nimport { IOnDismissDelegate } from \"./../IOnDismissDelegate\";\r\nimport { IAugLoopCallback, IFloodgateAuthTokenCallback, IFloodgateSettingStorageCallback, IOnSurveyActivatedCallback }\r\n\tfrom \"@ms-ofb/officefloodgatecore/dist/src/Api/Api\";\r\nimport { CampaignDefinition } from \"@ms-ofb/officefloodgatecore/dist/src/Campaign/CampaignDefinitionProvider\";\r\nimport { IManifestDataApplication, IManifestDataTelemetry, IManifestDataWeb } from \"./../Transport/Transport\";\r\nimport { ISession } from \"@augloop/runtime-client\";\r\nimport { ICVSurveyParams } from \"@ms-ofb/officefloodgatecore/dist/src/Api/ICVSurvey\";\r\n\r\n/**\r\n * Interface for common initialization options\r\n */\r\nexport interface IInitOptionsCommon {\r\n\t// An id uniquely identifying the host app in the OCV world\r\n\tappId: number;\r\n\t// The url at which the styles reside\r\n\tstylesUrl?: string;\r\n\t// The url at which the internationalization files reside\r\n\tintlUrl?: string;\r\n\t// The filename for the internationalization strings, if different than the default filename\r\n\tintlFilename?: string;\r\n\t// Base url where any ux assets reside. Mainly used by coaching ux\r\n\twebSurfacesResourceBaseUrl?: string;\r\n\t// Environment\r\n\tenvironment: Constants.Environment;\r\n\t// A string uniquely identifying the current session\r\n\tsessionId?: string;\r\n\t// cid string which is in-scope for GDPR compliance for export and deletion request\r\n\tcid?: string;\r\n\t// A build version for your app\r\n\tbuild?: string;\r\n\t// The primary colour in hex form #[0-9a-f]{6}\r\n\tprimaryColour?: string;\r\n\t// The secondary colour in hex form #[0-9a-f]{6}\r\n\tsecondaryColour?: string;\r\n\t// The UI locale name of the calling page\r\n\tlocale?: string;\r\n\t// System-Use only\r\n\toriginalLocale?: string;\r\n\t// A callback which will be called when the SDK encounters errors\r\n\tonError?: (err: string) => void;\r\n\t// Application related metadata\r\n\tapplicationGroup?: IManifestDataApplication;\r\n\t// Telemetry related metadata\r\n\ttelemetryGroup?: IManifestDataTelemetry;\r\n\t// Web related metadata\r\n\twebGroup?: IManifestDataWeb;\r\n\t// User Email \r\n\tuserEmail?: string;\r\n\t// The json string to define event sampling\r\n\teventSampling?: ISamplingEvent[];\r\n\t// The timeout for sending response in petrol\r\n\tpetrolTimeout?: number;\r\n\t// check to see if user is consumer/commercial to dynamically display UI\r\n\tisCommercialHost?: boolean;\r\n\t// Option to see if the host will be providing their own resources such as strings or CSS\r\n\tcustomResourcesSetExternally?: CustomResources;\r\n\t// the email policy value from OCPS to determines if the user can see an option to include their email when they submit feedback\r\n\temailPolicyValue?: Constants.OCPSValues;\r\n\t// the screenshot policy value from OCPS to determines if the user can see an option to include their screenshot when they submit feedback\r\n\tscreenshotPolicyValue?: Constants.OCPSValues;\r\n\t// AgeGroup enum which user is classfied as\r\n\tageGroup?: AgeGroup;\r\n\t// Authentication Type of user\r\n\tauthenticationType?: AuthenticationType;\r\n\t// Application settings\r\n\tapplicationSettings?: IApplicationSettings;\r\n\t// Package settings for the new web surfaces urls (after migration of the CDN)\r\n\twebSurfacesSettings?: IWebSurfacesSettings;\r\n}\r\n\r\n/**\r\n * Interface for messaging service settings\r\n */\r\nexport interface IMessagingServiceSettings {\r\n\t// Internal messaging service url\r\n\tmessagingServiceIntUrl?: string;\r\n\t// Production messaging service url \r\n\tmessagingServiceProdUrl?: string;\r\n}\r\n\r\n/**\r\n * Interface for package settings\r\n */\r\nexport interface IWebSurfacesSettings {\r\n\t// Internal web surfaces url\r\n\twebSurfacesIntUrl?: string;\r\n\t// Production web surfaces url \r\n\twebSurfacesProdUrl?: string;\r\n}\r\n\r\n/**\r\n * Interface for host application settings\r\n */\r\nexport interface IApplicationSettings {\r\n\treadonly [key: string]: unknown;\r\n}\r\n\r\n/**\r\n * Interface for inAppFeedback initialization options\r\n */\r\nexport interface IInitOptionsInAppFeedback {\r\n\t// Method called on feedback submission\r\n\tonDismiss?: IOnDismissDelegate;\r\n\t// Bug form toggle\r\n\tbugForm?: boolean;\r\n\t// email enabled\r\n\tshowEmailAddress?: boolean;\r\n\t// User email\r\n\tuserEmail?: string;\r\n\t// Screenshot toggle\r\n\tscreenshot?: boolean;\r\n\t// The switch to show a thank you panel\r\n\tisShowThanks?: boolean;\r\n\t// Flag to enable/disable transistion on the UI.\r\n\ttransitionEnabled?: boolean;\r\n\t// the feedback policy value from OCPS to determines if the user can submit feedback\r\n\tsendFeedbackPolicyValue?: Constants.OCPSValues;\r\n\t// Feedback Forum URL\r\n\tfeedbackForumUrl?: string;\r\n\t// My feedback Forum URL\r\n\tmyFeedbackForumUrl?: string;\r\n}\r\n\r\n/**\r\n * Interface for floodgate initialization options\r\n */\r\nexport interface IInitOptionsFloodgate {\r\n\t// Should the floodgate prompt automatically dismiss if not clicked? Default is false\r\n\tautoDismiss?: Constants.AutoDismissValues;\r\n\r\n\t// Campaign definitions\r\n\tcampaignDefinitions?: CampaignDefinition[];\r\n\r\n\t// Flights for TMS service\r\n\tcampaignFlights?: string;\r\n\r\n\t// Additional query parameters for TMS service\r\n\tcampaignQueryParameters?: string;\r\n\r\n\t// Delegate to be called when the floodgate UI is dismissed, whether on a submission or not\r\n\tonDismiss?: (campiagnId: string, submitted: boolean) => void;\r\n\r\n\t// The callback to be executed when a survey is activated\r\n\tonSurveyActivatedCallback?: IOnSurveyActivatedCallback;\r\n\r\n\t// The callback to be executed when host-based data operations are needed\r\n\tsettingStorageCallback?: IFloodgateSettingStorageCallback;\r\n\r\n\t// Optionally provide a method which will accept the custom strings in Campaign Definitions and return actual\r\n\t// strings that must be displayed. Used for localization.\r\n\tuIStringGetter?: (str: string) => string;\r\n\r\n\t// The callback to be executed when host-based auth token is needed\r\n\tauthTokenCallback?: IFloodgateAuthTokenCallback;\r\n\r\n\t// The boolean option to enforce if surveys are allowed by a policy, such as an OCPS policy for a tenant.\r\n\t// True: Surveys are enabled, floodgate works normally; False: Surveys are disabled\r\n\tsurveyEnabled?: boolean;\r\n\r\n\t// The boolean option to enforce if email address collection in a survey is allowed by a policy, such as an OCPS policy for a tenant.\r\n\t// True: email address collection is enabled, floodgate works normally; False: email address collection is disabled\r\n\tshowEmailAddress?: boolean;\r\n\r\n\t// Interface to enable/disable and pass augLoop host references\r\n\taugLoopCallback?: IAugLoopCallback<ISession>;\r\n\r\n\t// Interface to pass the params for the Customer Voice Survey\r\n\tcustomerVoiceSurveyParams?: ICVSurveyParams;\r\n\r\n\t// The boolean option to enabl the governance service\r\n\tgovernanceServiceEnabled?: boolean;\r\n\r\n\t// configuration for governance service\r\n\tgovernanceServiceConfig?: IGovernanceServiceConfig;\r\n\r\n\t// is personalizer enabled on client side.\r\n\tpersonalizerEnabled?: boolean;\r\n\r\n\t// Messaging service settings for the new base urls (after migration of the CDN)\r\n\tmessagingServiceSettings?: IMessagingServiceSettings;\r\n}\r\n\r\n/**\r\n * Interface for floodgate event sampling options\r\n */\r\nexport interface ISamplingEvent {\r\n\ttype: string;\r\n\tname: string;\r\n\tsampleRate: number;\r\n}\r\n\r\nexport interface ISamplingInitOption {\r\n\tevent?: Record<string, number>;\r\n}\r\n\r\nexport interface IGovernanceServiceConfig {\r\n\t// limit number of retry\r\n\tretry?: number;\r\n\r\n\t// timeout in second\r\n\ttimeout?: number;\r\n\r\n\t// In case of failure call, option to whether continue display survey or fall off\r\n\tforceServicelessSurveyDisplay?: boolean;\r\n\r\n\t// Option to use simple request\r\n\tsimpleRequestEnabled?: boolean;\r\n}\r\n\r\n// bit mask flag: values should be set 0,1,2,4,8,16, etc...\r\n// Example for Css and Strings both, use 3.\r\nexport enum CustomResources {\r\n\tNone = 0,\r\n\tCss = 1,\r\n\tStrings = 2,\r\n}\r\n\r\nexport enum AgeGroup {\r\n\tUndefined, // Unknown age\r\n\tMinorWithoutParentalConsent, // Minor under the age of consent\r\n\tMinorWithParentalConsent, // Minor under age of consent\r\n\tAdult, // Adult\r\n\tNotAdult, // Minor above age of consent\t\r\n\tMinorNoParentalConsentRequired, // Minor above age of consent\r\n}\r\n\r\nexport enum AuthenticationType {\r\n\tMSA,\r\n\tAAD,\r\n\tUnauthenticated\r\n}\r\n\r\n// Taken from %SRCROOT%\\privacy\\options\\public\\UserConsentGroup.h\r\n// Enum that describes the different consent categories of the user.\r\nexport const enum UserConsentGroup {\r\n\t// Unknown consent group, we do not have info to determine this\r\n\tUnknown = 0,\r\n\t// Can give consent to data collection, upsell messages\r\n\tCanConsent = 1,\r\n\t// Can still give consent but is only a limited consent.\r\n\t// As an example, upsell / cross sell should not be shown.\r\n\tPartialConsent = 2,\r\n\t// They cannot provide any form of consent. No consent dialogs / upsell should not be shown.\r\n\tCannotConsent = 3,\r\n};\r\n","/*\r\n * Utils.ts\r\n *\r\n * Module for utility functions\r\n */\r\n\r\n/**\r\n * Add time to a given date\r\n * Example, timeAdd(new Date(), 'minute', 5)  //returns 5 minutes from now\r\n * @param date  Date to start with\r\n * @param interval  One of: hour or h, minute or m, second or s\r\n * @param units  units of the given interval to add\r\n * @return date\r\n */\r\nexport function timeAdd(date: Date, interval: string, units: number): Date {\r\n\tswitch (interval.toLowerCase()) {\r\n\t\tcase \"h\":\r\n\t\tcase \"hour\":\r\n\t\t\treturn new Date(date.getTime() + (units * 3600000));\r\n\t\tcase \"m\":\r\n\t\tcase \"minute\":\r\n\t\t\treturn new Date(date.getTime() + (units * 60000));\r\n\t\tcase \"s\":\r\n\t\tcase \"second\":\r\n\t\t\treturn new Date(date.getTime() + (units * 1000));\r\n\t\tdefault:\r\n\t\t\tthrow new Error(\"Invalid interval value of \" + interval);\r\n\t}\r\n}\r\n\r\n/**\r\n * Check if an input value is a valid date, null or undefined return false.\r\n * @param input  input value\r\n * @return boolean\r\n */\r\nexport function isDate(input: any): boolean {\r\n\tif (Object.prototype.toString.call(input) === \"[object Date]\") {\r\n\t\t// it is a date\r\n\t\tif (!(isNaN(input.getTime()))) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n/**\r\n * Check if an input value is a valid value in the input enum\r\n * @param value  input value\r\n * @param input  input enum\r\n * Returns true if value exists in the enum\r\n */\r\nexport function isEnumValue(value: any, input: any): boolean {\r\n\treturn (value in input);\r\n}\r\n\r\n/**\r\n * Check if an input value is a number\r\n * @param value: input value\r\n */\r\nexport function isNumber(value: any): boolean {\r\n\treturn (value !== null && !isNaN(value) && isFinite(value));\r\n}\r\n\r\n/**\r\n * Check if an input value is null or undefined\r\n * @param value: input value\r\n */\r\nexport function isNOU(value: any): boolean {\r\n\treturn (value === null || value === undefined);\r\n}\r\n\r\n/**\r\n * Check if an input value is an object\r\n * @param value: input value\r\n */\r\nexport function isObject(value: any): boolean {\r\n\treturn (value !== null && value !== undefined && (typeof value === \"object\"));\r\n}\r\n\r\n/**\r\n * Check if an input value is an array\r\n * @param value: input value\r\n */\r\nexport function isFunction(value: any): boolean {\r\n\treturn (value !== null && value !== undefined && (typeof value === \"function\"));\r\n}\r\n\r\n/**\r\n * Check if an input value is an array\r\n * @param value: input value\r\n */\r\nexport function isArray(value: any): boolean {\r\n\treturn (value !== null && value !== undefined && (Array.isArray(value)));\r\n}\r\n\r\n/**\r\n * Check if given value is a string\r\n * @param {any} value value\r\n */\r\nexport function isString(value: any): boolean {\r\n\treturn (typeof value === \"string\");\r\n}\r\n\r\n/**\r\n * Check if value is an object\r\n * @param {any} value value\r\n */\r\nexport function isBoolean(value: any): boolean {\r\n\treturn typeof (value) === \"boolean\";\r\n}\r\n\r\n/**\r\n * Returns a lower temporal boundary\r\n * @return date\r\n */\r\nexport function getDistantPast(): Date {\r\n\t// Corresponds to UTC 1601-01-01T00:00:00Z\r\n\treturn new Date(-11644473600000);\r\n}\r\n\r\n/**\r\n * Get an upper temporal boundary\r\n * @return date\r\n */\r\nexport function getDistantFuture(): Date {\r\n\t// Corresponds to UTC 4001-01-01T00:00:00Z\r\n\treturn new Date(64092211200000);\r\n}\r\n\r\nexport const MAX_DATE_MILLISECONDS: number = 8640000000000000;\r\nexport const MIN_DATE_MILLISECONDS: number = -8640000000000000;\r\n\r\n/**\r\n * Adds seconds to a date, if overflows returns Date(Number.Max_VALUE)\r\n *\r\n * @param date    date to add to\r\n * @param seconds seconds as number\r\n * @return Resulting date\r\n */\r\nexport function addSecondsWithoutOverflow(date: Date, seconds: number): Date {\r\n\tif (!date) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif (seconds < 0) {\r\n\t\treturn subtractSecondsWithoutOverflow(date, -1 * seconds);\r\n\t} else {\r\n\t\tconst milliseconds: number = date.getTime() + seconds * 1000;\r\n\r\n\t\tif (milliseconds < MAX_DATE_MILLISECONDS) {\r\n\t\t\treturn new Date(milliseconds);\r\n\t\t} else {\r\n\t\t\treturn new Date(MAX_DATE_MILLISECONDS);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Subtracts seconds from a date, if overflows returns Date(Number.MIN_VALUE)\r\n *\r\n * @param date   date to subtract from\r\n * @param seconds seconds as number\r\n * @return Resulting date\r\n */\r\nexport function subtractSecondsWithoutOverflow(date: Date, seconds: number): Date {\r\n\tif (!date) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif (seconds < 0) {\r\n\t\tseconds = -seconds;\r\n\t\treturn this.addSecondsWithoutOverflow(date, seconds);\r\n\t}\r\n\r\n\tconst milliseconds: number = date.getTime() - (seconds * 1000);\r\n\r\n\tif (milliseconds > MIN_DATE_MILLISECONDS) {\r\n\t\treturn new Date(milliseconds);\r\n\t} else {\r\n\t\treturn new Date(MIN_DATE_MILLISECONDS);\r\n\t}\r\n}\r\n\r\n// region Language related\r\n\r\n/**\r\n * Effectively un-anchored on the right side because tags can have many more trailing sub-parts than we care to extract\r\n * Refer to https://www.ietf.org/rfc/rfc5646.txt\r\n */\r\nconst LANGUAGE_AND_SCRIPT_TAG_PATTERN: string =\r\n\t\"^\" +\r\n\t// capture 1:language subtag\r\n\t\"(\" +\r\n\t\"(?:[a-zA-Z]{2,3}(?:-[a-zA-Z]{3}){0,3})\" +  // 2-3 Alpha chars, followed by up to three optional extension tags, each of format -AAA, A=Alpha char\r\n\t\"|\" +\r\n\t\"(?:[a-zA-Z]{4,8})\" +                       // 4-Alpha chars (reserved in standard) or 5-8 Alpha chars\r\n\t\")\" +\r\n\t\"(?:\" +\r\n\t\"-\" +\r\n\t// capture 2: optional script subtag (without leading dash), exactly 4 alpha chars\r\n\t\"([a-zA-Z]{4})\" +                           // 4-Alpha chars\r\n\t\")?\" +\r\n\t// capture 3: optional region subtag (without leading dash), exactly 2 alpha chars or 3 digits\r\n\t\"(?:-([a-zA-Z]{2}|[0-9]{3}))?\" +\r\n\t\"(\" +\r\n\t// capture 4: any left-overs, rejecting remainder strings that don't end here or lead with a dash.\r\n\t\"-.*\" +\r\n\t\")?\" +\r\n\t\"$\";\r\n\r\nexport function isValidLanguageSubTag(subTag: string): boolean {\r\n\tif (!subTag) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tconst extractedSubTag: string = extractLanguageSubtag(subTag);\r\n\tif (!extractedSubTag) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn extractedSubTag === subTag;\r\n}\r\n\r\nexport function extractLanguageSubtag(language: string): string {\r\n\tif (!language) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst matches = language.match(LANGUAGE_AND_SCRIPT_TAG_PATTERN);\r\n\tif (!matches || matches.length < 1 || !isNOU(matches[4])) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// return the first capture group which should be the original input if there is a match\r\n\t// For example, \"en-US\" input should return \"en-US\", and \"en\" input should return \"en\".\r\n\treturn matches[0];\r\n}\r\n\r\n// endregion\r\n\r\n/**\r\n * Create guid string\r\n */\r\nexport function guid(): string {\r\n\t// Stitch in '4' in the third group\r\n\treturn (randomHex4() + randomHex4() + \"-\" + randomHex4() + \"-4\" + randomHex4().substr(0, 3) + \"-\" + randomHex4() + \"-\"\r\n\t\t+ randomHex4() + randomHex4() + randomHex4()).toLowerCase();\r\n}\r\n\r\n/**\r\n * Create random Hex4 string\r\n */\r\nfunction randomHex4(): string {\r\n\treturn (Math.floor(((1 + Math.random()) * 0x10000))).toString(16).substring(1);\r\n}\r\n\r\n/**\r\n * Create an array from input object values sorted by object key\r\n * @param Object input object\r\n * @return array\r\n */\r\nexport function makeArrayFromObjectValuesSortedByKeyString(object: object): any[] {\r\n\tconst keys: string[] = Object.keys(object);\r\n\tkeys.sort();\r\n\r\n\tconst values: any[] = [];\r\n\tfor (const id in keys) {\r\n\t\tif (keys.hasOwnProperty(id)) {\r\n\t\t\tconst key: string = keys[id];\r\n\t\t\tvalues.push(object[key]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn values;\r\n}\r\n\r\n/**\r\n * Create a date object from an input string\r\n * @param Object input string\r\n * @return date\r\n */\r\nexport function stringToDate(input: any): Date {\r\n\tif (!isString(input)) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst newDate: Date = input ? new Date(input) : null;\r\n\treturn isDate(newDate) ? newDate : null;\r\n}\r\n\r\n/**\r\n * Takes two objects (source, target) and returns the target object with values in the source added to it.\r\n * It overwrites any source properties which already exist in target.\r\n */\r\nexport function overrideValues<T>(sourceObject: T, targetobject: T): T {\r\n\tif (!targetobject) {\r\n\t\treturn targetobject;\r\n\t}\r\n\r\n\tconst result: T = targetobject;\r\n\r\n\tif (sourceObject) {\r\n\t\tfor (const field in sourceObject) {\r\n\t\t\tif (sourceObject.hasOwnProperty(field)) {\r\n\t\t\t\t(result as any)[field] = (sourceObject as any)[field];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\n/**\r\n * Test a string is in our supported ISO8601 UTC format of \"yyyy-MM-ddTHH:mm:ssZ\" and \"yyyy-MM-ddTHH:mm:ss.fffZ\"\r\n * @param input Input string to be evaluated.\r\n */\r\nexport function isUtcDatetimeString(input: any): boolean {\r\n\tif (!isString(input)) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tconst supportedUtcRegex = /^(\\d{4}\\-\\d\\d\\-\\d\\dT\\d\\d:\\d\\d:\\d\\d(\\.\\d\\d\\d)?Z)$/;\r\n\treturn supportedUtcRegex.test(input);\r\n}\r\n\r\n/**\r\n * Convert a date object to a string in ISO8601 UTC format supported by Floodgate (\"yyyy-MM-ddTHH:mm:ssZ\")\r\n * @param input Input date object\r\n */\r\nexport function dateToShortUtcString(input: Date): string {\r\n\tif (!isDate(input)) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction pad(n: number): string {\r\n\t\treturn (n < 10) ? (\"0\" + n) : n.toString();\r\n\t}\r\n\r\n\treturn input.getUTCFullYear() +\r\n\t\t\"-\" + pad(input.getUTCMonth() + 1) +\r\n\t\t\"-\" + pad(input.getUTCDate()) +\r\n\t\t\"T\" + pad(input.getUTCHours()) +\r\n\t\t\":\" + pad(input.getUTCMinutes()) +\r\n\t\t\":\" + pad(input.getUTCSeconds()) +\r\n\t\t\"Z\";\r\n}\r\n\r\n/*\r\nImplementing the Fisher-Yates Shuffle\r\n(Shuffles in situ)\r\n*/\r\nexport function fyShuffle(arrIn: number[]): number[] | undefined {\r\n\r\n\tif (isNOU(arrIn)) {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\t// If the array is empty or has one element, do nothing.\r\n\tif (arrIn.length === 0 || arrIn.length === 1) {\r\n\t\treturn arrIn;\r\n\t}\r\n\r\n\tlet lastNonShuffledElement = arrIn.length - 1;\r\n\r\n\t// While there is still a non shuffled element.\r\n\twhile (lastNonShuffledElement > 0) {\r\n\r\n\t\t// Pick one of the non shuffled elements (num range [0,lastNonShuffledElement+1))\r\n\t\tconst pickIndex = Math.floor(Math.random() * (lastNonShuffledElement + 1));\r\n\r\n\t\t// And swap it with the last non shuffled element\r\n\t\tconst temp = arrIn[lastNonShuffledElement];\r\n\t\tarrIn[lastNonShuffledElement] = arrIn[pickIndex];\r\n\t\tarrIn[pickIndex] = temp;\r\n\r\n\t\tlastNonShuffledElement--;\r\n\t}\r\n\r\n\treturn arrIn;\r\n}\r\n\r\n/**\r\n * Check if value is an valid user id\r\n * One or two character before colon, a colon, and some word after colon.\r\n * @param {any} value value\r\n */\r\nexport function isValidUserId(value: any): boolean {\r\n\tif (!isString(value)) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tconst supportedUserIdRegex = /^([a-z]{1,2}):\\w+/;\r\n\treturn supportedUserIdRegex.test(value);\r\n}\r\n\r\n/**\r\n * Safely read an object\r\n */\r\nexport function safeParseObject<T>(serializedValue: string, defaultValue?: T): T {\r\n\ttry {\r\n\t\tconst parsedObject = serializedValue && (serializedValue[0] === \"{\" || serializedValue[0] === \"[\")\r\n\t\t\t\t\t\t\t? JSON.parse(serializedValue)\r\n\t\t\t\t\t\t\t: undefined;\r\n\t\treturn parsedObject ?? defaultValue;\r\n\t} catch (e) {\r\n\t\t// ignore\r\n\t}\r\n\r\n\treturn defaultValue;\r\n}\r\n","/**\r\n * Interface for storing and retrieving floodgate-specific data from storage\r\n */\r\ninterface IFloodgateStorageProvider {\r\n\t/**\r\n\t * Lock the file to prevent access from another process.\r\n\t */\r\n\tfileLock(fileType: IFloodgateStorageProvider.FileType): void;\r\n\r\n\t/**\r\n\t * Unlock the file.\r\n\t */\r\n\tfileUnlock(fileType: IFloodgateStorageProvider.FileType): void;\r\n\r\n\t/**\r\n\t * Read the file\r\n\t */\r\n\tread(fileType: IFloodgateStorageProvider.FileType): string;\r\n\r\n\t/**\r\n\t * Write to the file\r\n\t */\r\n\twrite(fileType: IFloodgateStorageProvider.FileType, content: string): void;\r\n}\r\n\r\nmodule IFloodgateStorageProvider {\r\n\t/**\r\n\t * Enum for the files used by floodgate\r\n\t */\r\n\texport enum FileType {\r\n\t\tFloodgateSettings,\r\n\t\tSurveyActivationStats,\r\n\t\tSurveyEventActivityStats,\r\n\t\tCampaignDefinitions,\r\n\t\tCampaignStates,\r\n\t\tGovernedChannelStates,\r\n\t\tTmsCache_MessageMetadata,\r\n\t\tTmsCache_UserGovernance,\r\n\t\tTmsCache_CampaignContent,\r\n\t\tTms_DynamicSettings,\r\n\t\tLogLevelSettings,\r\n\t\tUserFacts,\r\n\t\tDebugOverrides,\r\n\t}\r\n}\r\n\r\nexport = IFloodgateStorageProvider;\r\n","import { ISurveyForm } from \"../Api/ISurveyForm\";\r\nimport * as ISurveyInfo from \"../ISurveyInfo\";\r\nimport { ISurveyDomWriter } from \"./ISurveyDomWriter\";\r\nimport { ISurveyJsonWriter } from \"./ISurveyJsonWriter\";\r\n\r\n/**\r\n * The interface for all Surveys\r\n * A survey has a type, a globally unique id (otherwise opaque, but suitable for correlation with telemetry and for saving stats in the registry),\r\n * an expiration time to aid in cache cleanup, and an activation event to cause this survey to be triggered\r\n */\r\ninterface ISurvey extends ISurveyForm, ISurveyDomWriter, ISurveyJsonWriter {\r\n\t/**\r\n\t * Get the type of this survey.\r\n\t */\r\n\tgetType(): ISurvey.Type;\r\n\r\n\t/**\r\n\t * Get basic root-level information about this survey\r\n\t */\r\n\tgetSurveyInfo(): ISurveyInfo;\r\n}\r\n\r\nmodule ISurvey {\r\n\texport enum Type {\r\n\t\t// A Feedback survey. Contains a single question with a free-form text response\r\n\t\tFeedback = 0,\r\n\t\t// An NPS (net promoter score) survey. Asks user to rate \"whether or not they would recommend this product to family/friends\".\r\n\t\t// Contains a prompt, question, and rating\r\n\t\tNps = 1,\r\n\t\t// A PSAT (product satisfaction) survey. Asks user to rate \"overall, based on their experience, how satisifed are they with this app\"\r\n\t\t// Contains a prompt, question, and rating\r\n\t\tPsat = 2,\r\n\t\t// A BPS (build promotion) survey. Asks user to choose between Yes and No options of promoting the current build to the next audience ring\r\n\t\t// Contains a prompt, question, and rating (Yes/No)\r\n\t\tBps = 3,\r\n\t\t// A FPS (feature promotion) survey. Asks user to rate a given app feature.\r\n\t\t// Contains a prompt, question, and rating\r\n\t\tFps = 4,\r\n\t\t// A NLQS (net language quality score) survey. Asks user to rate the language quality.\r\n\t\t// Contains a prompt, question, and rating\r\n\t\tNlqs = 5,\r\n\t\t// An intercept survey. Asks user if they want to talk to a Microsoft engineer to give feedback.\r\n\t\t// User can dismiss it or click on it to go to the intercept website, where the experience continues.\r\n\t\tIntercept = 6,\r\n\t\t// A Generic surface survey that uses content metadata to render a surface.\r\n\t\t// As of 4th Feb 2019 there are 11 types defined in Mso hence giving a value of 12.\r\n\t\tGenericMessagingSurface = 12,\r\n\t}\r\n\r\n\texport const DOM_FEEDBACKSURVEY_TAGNAME = \"FeedbackSurvey\";\r\n\texport const DOM_NPS_TAGNAME = \"Nps\";\r\n\texport const DOM_PSAT_TAGNAME = \"Psat\";\r\n\texport const DOM_BPS_TAGNAME = \"Bps\";\r\n\texport const DOM_FPS_TAGNAME = \"Fps\";\r\n\texport const DOM_NLQS_TAGNAME = \"Nlqs\";\r\n\texport const DOM_INTERCEPT_TAGNAME = \"Intercept\";\r\n\r\n\t// If the launcher type is null or undefined in campaign definition then this value will be used as default\r\n\texport const LAUNCHER_TYPE_DEFAULT = \"survey\";\r\n}\r\n\r\nexport = ISurvey;\r\n","/**\r\n * Base interface for a SurveyComponent (i.e. a question/widget to show the user\r\n * in a survey form, and that typically requires a response value of some kind)\r\n */\r\ninterface ISurveyComponent {\r\n\tgetType(): ISurveyComponent.Type;\r\n}\r\n\r\nmodule ISurveyComponent {\r\n\texport const enum Type {\r\n\t\t// A quick pop-up requesting participation in a survey\r\n\t\tPrompt = \"Prompt\",\r\n\r\n\t\t// A question paired with a free-form text response\r\n\t\tComment = \"Comment\",\r\n\r\n\t\t// A question asking for a selection from a list of allowed values with numeric meaning\r\n\t\tRating = \"Rating\",\r\n\r\n\t\t// Information needed to pass into CVSurvey\r\n\t\tCVSurvey = \"CVSurvey\",\r\n\r\n\t\t// A question asking for one or more selections from a list of allowed values\r\n\t\tMultipleChoice = \"MultipleChoice\",\r\n\r\n\t\t// A pop-up dialog requesting participation in an Intercept session\r\n\t\tIntercept = \"Intercept\",\r\n\t}\r\n\r\n\texport const DOM_PROMPT_TAGNAME = \"Prompt\";\r\n\texport const DOM_COMMENT_TAGNAME = \"Comment\";\r\n\texport const DOM_RATING_TAGNAME = \"Rating\";\r\n\texport const DOM_CVSURVEY_TAGNAME = \"CVSurvey\";\r\n\texport const DOM_MULTIPLECHOICE_TAGNAME = \"MultipleChoice\";\r\n\texport const DOM_INTERCEPT_TAGNAME = \"Intercept\";\r\n\texport const JSON_INTERCEPT_KEYNAME = \"intercept\";\r\n\texport const JSON_INTERCEPTURL_KEYNAME = \"url\";\r\n\texport const JSON_PROMPT_KEYNAME = \"prompt\";\r\n\texport const JSON_PROMPTYESTEXT_KEYNAME = \"yesButtonText\";\r\n\texport const JSON_PROMPTNOTEXT_KEYNAME = \"noButtonText\";\r\n\texport const JSON_COMMENT_KEYNAME = \"comment\";\r\n\texport const JSON_RATING_KEYNAME = \"rating\";\r\n\texport const JSON_CVSURVEY_KEYNAME = \"cvSurvey\";\r\n\texport const JSON_CVSURVEYFORMID_KEYNAME = \"formId\";\r\n\texport const JSON_CVSURVEYTHEME_KEYNAME = \"theme\";\r\n\texport const JSON_RATINGOPTIONS_KEYNAME = \"options\";\r\n\texport const JSON_CVSURVEYPRODUCTNAME_KEYNAME = \"productName\";\r\n\texport const JSON_CVSURVEYUIHOST_KEYNAME = \"uiHost\";\r\n\texport const JSON_CVSURVEYPLATFORM_KEYNAME = \"platform\";\r\n\texport const JSON_TITLE_KEYNAME = \"title\";\r\n\texport const JSON_QUESTION_KEYNAME = \"question\";\r\n\texport const JSON_MULTIPLECHOICE_KEYNAME = \"multipleChoice\";\r\n\texport const JSON_APPLICATION_KEYNAME = \"application\";\r\n\texport const JSON_EXTENDEDMANIFESTDATA_KEYNAME = \"extendedManifestData\";\r\n\texport const JSON_SURVEYSTRINGS_KEYNAME = \"surveyStrings\";\r\n\texport const JSON_SURVEYSPECIFICDATA_KEYNAME = \"surveySpecificData\";\r\n}\r\n\r\nexport = ISurveyComponent;\r\n","/**\r\n * Constants.ts\r\n *\r\n * A module for all the constants.\r\n */\r\n\r\n/**\r\n * Telemetry events\r\n */\r\nexport class TelemetryEvent {\r\n\tpublic static CampaignState = class {\r\n\t\tpublic static Deserialize = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_CampaignState_Deserialize_Failed\";\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static FileBasedCampaignStateProvider = class {\r\n\t\tpublic static Load = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_FileBasedCampaignStateProvider_Load_Failed\";\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static HostBasedCampaignStateProvider = class {\r\n\t\tpublic static GetStatesFromHost = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_HostBasedCampaignStateProvider_GetStatesFromHost_Failed\";\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static Floodgate = class {\r\n\t\tpublic static Initialize = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_Floodgate_Initialize_Failed\";\r\n\t\t};\r\n\r\n\t\tpublic static Start = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_Floodgate_Start_Failed\";\r\n\t\t\tpublic static Warning: string = \"FloodgateCore_Floodgate_Start_Warning\";\r\n\t\t\tpublic static SurveysDisabled: string = \"FloodgateCore_Floodgate_Start_SurveysDisabled\";\r\n\t\t};\r\n\r\n\t\tpublic static UserFactsLoad = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_Floodgate_UserFactsLoad_Failed\";\r\n\t\t};\r\n\r\n\t\tpublic static UserFactsSpecDeserialization = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_Floodgate_UserFactsSpecDeserialization_Failed\";\r\n\t\t};\r\n\r\n\t\tpublic static UserFactsSpecIsAMatch = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_Floodgate_UserFactsSpecIsAMatch_Failed\";\r\n\t\t\tpublic static Mismatch: string = \"FloodgateCore_Floodgate_UserFactsSpecIsAMatch_Mismatch\";\r\n\t\t\tpublic static Summary: string = \"FloodgateCore_Floodgate_UserFactsSpecIsAMatch_Summary\";\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static FloodgateEngine = class {\r\n\t\tpublic static Make = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_FloodgateEngine_Make_Failed\";\r\n\t\t};\r\n\r\n\t\tpublic static Common = class {\r\n\t\t\tpublic static Error: string = \"FloodgateCore_FloodgateEngine_Common_Error\";\r\n\t\t};\r\n\r\n\t\tpublic static Start = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_FloodgateEngine_Start_Failed\";\r\n\t\t};\r\n\r\n\t\tpublic static StartAsync = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_FloodgateEngine_StartAsync_Failed\";\r\n\t\t\tpublic static Stopped: string = \"FloodgateCore_FloodgateEngine_StartAsync_Stopped\";\r\n\t\t};\r\n\r\n\t\tpublic static OnSurveyActivated = class {\r\n\t\t\tpublic static ActivationStatsSuppressedSurvey: string = \"FloodgateCore_FloodgateEngine_OnSurveyActivated_ActivationStatsSuppressedSurvey\";\r\n\t\t\tpublic static ClosedChannelType: string = \"FloodgateCore_FloodgateEngine_OnSurveyActivated_ClosedChannelType\";\r\n\t\t\tpublic static SurveyNotDefined: string = \"FloodgateCore_FloodgateEngine_OnSurveyActivated_SurveyNotDefined\";\r\n\t\t\tpublic static SessionSuppressedSurvey: string = \"FloodgateCore_FloodgateEngine_OnSurveyActivated_SessionSuppressedSurvey\";\r\n\t\t\tpublic static ActivationExpiredSurvey: string = \"FloodgateCore_FloodgateEngine_OnSurveyActivated_ActivationExpiredSurvey\";\r\n\t\t\tpublic static ActivationIrrelevantSurvey: string = \"FloodgateCore_FloodgateEngine_OnSurveyActivated_ActivationIrrelevantSurvey\";\r\n\t\t\tpublic static Error: string = \"FloodgateCore_FloodgateEngine_OnSurveyActivated_Error\";\r\n\t\t};\r\n\r\n\t\tpublic static CheckGovernanceServiceAndActivateSurvey = class {\r\n\t\t\tpublic static GovernanceServiceForceToDisplay: string = \"FloodgateCore_FloodgateEngine_GovernanceService_GovernanceServiceForceToDisplay\";\r\n\t\t\tpublic static GovernanceServiceClientCompleted: string = \"FloodgateCore_FloodgateEngine_GovernanceService_GovernanceServiceClientCompleted\";\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static GovernedChannelState = class {\r\n\t\tpublic static Deserialize = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_GovernedChannelState_Deserialize_Failed\";\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static FileBasedGovernedChannelStateProvider = class {\r\n\t\tpublic static Load = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_FileBasedGovernedChannelStateProvider_Load_Failed\";\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static HostBasedGovernedChannelStateProvider = class {\r\n\t\tpublic static GetStatesFromHost = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_HostBasedGovernedChannelStateProvider_GetStatesFromHost_Failed\";\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static SurveyStatCollectionActivation = class {\r\n\t\tpublic static FromJson = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_SurveyStatCollectionActivation_FromJson_Failed\";\r\n\t\t};\r\n\r\n\t\tpublic static ToJson = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_SurveyStatCollectionActivation_ToJson_Failed\";\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static HostBasedSurveyActivationStatsProvider = class {\r\n\t\tpublic static GetSurveyStatsFromHost = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_HostBasedSurveyActivationStatsProvider_GetSurveyStatsFromHost_Failed\";\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static SurveyStatCollectionEventActivity = class {\r\n\t\tpublic static FromJson = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_SurveyStatCollectionEventActivity_FromJson_Failed\";\r\n\t\t};\r\n\r\n\t\tpublic static ToJson = class {\r\n\t\t\tpublic static Failed: string = \"FloodgateCore_SurveyStatCollectionEventActivity_ToJson_Failed\";\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static SurveyActivity = class {\r\n\t\tpublic static LogActivity = class {\r\n\t\t\tpublic static EventsReprocessed: string = \"FloodgateCore_SurveyActivity_LogActivity_EventsReprocessed\";\r\n\t\t\tpublic static SurveysReprocessed: string = \"FloodgateCore_SurveyActivity_LogActivity_SurveysReprocessed\";\r\n\t\t};\r\n\r\n\t\tpublic static SetActivityTrackingContracts = class {\r\n\t\t\tpublic static DuplicateSurveyID: string = \"FloodgateCore_SurveyActivity_SetActivityTrackingContracts_DuplicateSurveyID\";\r\n\t\t};\r\n\t};\r\n}\r\n","import { ActivityTrackingSet } from \"./ActivityTrackingSet\";\r\nimport { ISurveyInfo, IUserFactProvider } from \"./Api/Api\";\r\nimport * as IActivityListener from \"./Api/IActivityListener\";\r\nimport { IFloodgateEnvironmentProvider } from \"./Api/IFloodgateEnvironmentProvider\";\r\nimport { IFloodgateSettingStorageCallback } from \"./Api/IFloodgateSettingStorageCallback\";\r\nimport * as IFloodgateStorageProvider from \"./Api/IFloodgateStorageProvider\";\r\nimport * as IFloodgateStringProvider from \"./Api/IFloodgateStringProvider\";\r\nimport { IFloodgateTelemetryLogger } from \"./Api/IFloodgateTelemetryLogger\";\r\nimport { GovernanceServiceClientState, IGovernanceServiceClient, IGovernanceServiceResult, IGovernanceSurveyInfo, IGovernanceSurveyResponse } from \"./Api/IGovernanceServiceClient\";\r\nimport { IContextData, IOnSurveyActivatedCallback } from \"./Api/IOnSurveyActivatedCallback\";\r\nimport * as ISurvey from \"./Api/ISurvey\";\r\nimport { ISurveyLauncher } from \"./Api/ISurveyLauncher\";\r\nimport { ISurveyLauncherFactory } from \"./Api/ISurveyLauncherFactory\";\r\nimport { ITelemetryProperties } from \"./Api/ITelemetryProperties\";\r\nimport { ITransporterFactory } from \"./Api/ITransporterFactory\";\r\nimport { CampaignDefinition,\r\n\t\tCampaignNominationSchemeRatioPercentage,\r\n\t\tFileSystemCampaignDefinitionProvider,\r\n\t\tICampaignDefinitionProvider } from \"./Campaign/CampaignDefinitionProvider\";\r\nimport { CampaignManager } from \"./Campaign/CampaignManager\";\r\nimport { CampaignStateProviderFactory, ICampaignStateProvider } from \"./Campaign/CampaignStateProvider\";\r\nimport { IDictionary } from \"./Common\";\r\nimport { TelemetryEvent } from \"./Constants\";\r\nimport { FloodgateSettings } from \"./FloodgateSettings\";\r\nimport { GovernedChannelType, IGovernedChannelData } from \"./GovernedChannel\";\r\nimport { GovernedChannelStateProviderFactory, IGovernedChannelStateProvider } from \"./GovernedChannelStateProvider\";\r\nimport { Governor, IGovernor } from \"./Governor\";\r\nimport { ISurveyClient } from \"./ISurveyClient\";\r\nimport * as SurveyActivityListener from \"./SurveyActivityListener\";\r\nimport { ISurveyActivationStatsProvider, SurveyActivationStats, SurveyActivationStatsProviderFactory,\r\n\tSurveyStatCollectionActivation } from \"./SurveyStatCollectionActivation\";\r\nimport { SurveyEventActivityStats, SurveyStatCollectionEventActivity } from \"./SurveyStatCollectionEventActivity\";\r\n\r\nimport FileType = IFloodgateStorageProvider.FileType;\r\nimport { ActivityTrackingContract } from \"./ActivityTrackingContract\";\r\nimport { hasSurveyReachedMaxLaunches, hasSurveyReachedMaxLaunchesPerSession, isBusinessCriticalSurvey, isCriticalSurvey, isMultiLaunchSurvey } from \"./GovernanceUtils\";\r\nimport { isNOU } from \"./Utils\";\r\n\r\n// Telemetry logger with no-op logger\r\nclass DefaultFloodgateTelemetryLogger implements IFloodgateTelemetryLogger {\r\n\t// @Override\r\n\tpublic log_TriggerMet(campaignId: string, surveyId: string, surveyType: ISurvey.Type, surveyActivityInfo: string,\r\n\t\tadditionalSurveyInfo: string): void {}\r\n\r\n\t// @Override\r\n\tpublic log_UserSelected(campaignId: string, surveyId: string, surveyType: ISurvey.Type,\r\n\t\tadditionalSurveyInfo: string): void {}\r\n\r\n\t// @Override\r\n\tpublic log_CampaignLoad_Failed(errorMessage: string): void {}\r\n\r\n\t// @Override\r\n\tpublic log_Error(eventId: string, errorMessage: string): void {}\r\n\r\n\t// @Override\r\n\tpublic log_Event(eventId: string, properties: ITelemetryProperties): void {}\r\n\r\n\t// @Override\r\n\tpublic log_LocalError(message: string, ...data: any[]): void {}\r\n}\r\n\r\nexport const enum InitializationStatus {\r\n\tNone = 0,\r\n\tError,\r\n\tInitializing,\r\n\tStarted,\r\n\tStopped,\r\n}\r\n\r\nconst defaultSurveyActivityListener: SurveyActivityListener.IActivityListenerCallback = {\r\n\trun(survey) {\r\n\t},\r\n\tshouldAcceptActivity(activityName) {\r\n\t\treturn true;\r\n\t},\r\n};\r\n\r\nconst globalSessionSurveyActivationCounts: IDictionary<number> = {};\r\n\r\n/**\r\n * Floodgate Engine class.  The main wiring hub and the brains responsible for\r\n * linking together the survey definitions, governance, activity tracking, and\r\n * survey launchers.  Only one-instance-at-a-time of these should be created\r\n * per app session.\r\n */\r\nexport class FloodgateEngine {\r\n\tpublic static setTelemetryLogger(telemetryLogger: IFloodgateTelemetryLogger): void {\r\n\t\tif (!telemetryLogger) {\r\n\t\t\tthrow new Error(\"telemetryLogger must not be null\");\r\n\t\t}\r\n\r\n\t\tFloodgateEngine.telemetryLogger = telemetryLogger;\r\n\t}\r\n\r\n\tpublic static getTelemetryLogger(): IFloodgateTelemetryLogger {\r\n\t\treturn FloodgateEngine.telemetryLogger;\r\n\t}\r\n\r\n\tpublic static getTransportFactory(): ITransporterFactory {\r\n\t\treturn FloodgateEngine.transporterFactory;\r\n\t}\r\n\r\n\tpublic static make(\r\n\t\tbuildVersion: string,\r\n\t\tlauncherFactory: ISurveyLauncherFactory,\r\n\t\tonSurveyActivatedCallback: IOnSurveyActivatedCallback,\r\n\t\tfileBasedStorageProvider: IFloodgateStorageProvider,\r\n\t\thostBasedStorageProvider: IFloodgateSettingStorageCallback,\r\n\t\tstringProvider: IFloodgateStringProvider,\r\n\t\tenvironmentProvider: IFloodgateEnvironmentProvider,\r\n\t\ttransporterFactory: ITransporterFactory,\r\n\t\tcampaignDefinitionProviders: ICampaignDefinitionProvider[],\r\n\t\tuserFactsProvider: IUserFactProvider,\r\n\t\tgovernanceServiceClient: IGovernanceServiceClient): FloodgateEngine {\r\n\r\n\t\ttry {\r\n\t\t\tconst governedChannelStateProvider: IGovernedChannelStateProvider\r\n\t\t\t\t= GovernedChannelStateProviderFactory.make(fileBasedStorageProvider, hostBasedStorageProvider);\r\n\r\n\t\t\tconst surveyActivationStatsProvider: ISurveyActivationStatsProvider\r\n\t\t\t\t= SurveyActivationStatsProviderFactory.make(fileBasedStorageProvider, hostBasedStorageProvider);\r\n\r\n\t\t\tconst campaignStateProvider: ICampaignStateProvider\r\n\t\t\t\t= CampaignStateProviderFactory.make(fileBasedStorageProvider, hostBasedStorageProvider);\r\n\r\n\t\t\tcampaignDefinitionProviders.push(new FileSystemCampaignDefinitionProvider(fileBasedStorageProvider));\r\n\r\n\t\t\treturn new FloodgateEngine(\r\n\t\t\t\tnew CampaignManager(\r\n\t\t\t\t\tcampaignStateProvider,\r\n\t\t\t\t\tcampaignDefinitionProviders,\r\n\t\t\t\t\tstringProvider,\r\n\t\t\t\t\tenvironmentProvider,\r\n\t\t\t\t\tbuildVersion,\r\n\t\t\t\t\tnew Date(),\r\n\t\t\t\t\tuserFactsProvider,\r\n\t\t\t\t),\r\n\t\t\t\tnew SurveyActivityListener(\r\n\t\t\t\t\tdefaultSurveyActivityListener,\r\n\t\t\t\t\tthis.getTelemetryLogger,\r\n\t\t\t\t),\r\n\t\t\t\tlauncherFactory,\r\n\t\t\t\tonSurveyActivatedCallback,\r\n\t\t\t\tfileBasedStorageProvider,\r\n\t\t\t\tnew Governor(\r\n\t\t\t\t\tgovernedChannelStateProvider,\r\n\t\t\t\t),\r\n\t\t\t\tsurveyActivationStatsProvider,\r\n\t\t\t\ttransporterFactory,\r\n\t\t\t\tgovernanceServiceClient,\r\n\t\t\t);\r\n\t\t} catch (e) {\r\n\t\t\tthis.telemetryLogger.log_Event(TelemetryEvent.FloodgateEngine.Make.Failed,\r\n\t\t\t\t{ ErrorMessage: e && e.toString(), ErrorDetails: e && e.stack });\r\n\t\t}\r\n\t}\r\n\r\n\t// Initialize telemetry logger with no-op logger\r\n\tprivate static telemetryLogger: IFloodgateTelemetryLogger = new DefaultFloodgateTelemetryLogger();\r\n\tprivate static transporterFactory: ITransporterFactory;\r\n\r\n\tprivate surveyClient: ISurveyClient;\r\n\tprivate activityListener: SurveyActivityListener;\r\n\tprivate onSurveyActivatedCallback: IOnSurveyActivatedCallback;\r\n\tprivate launcherFactory: ISurveyLauncherFactory;\r\n\tprivate storage: IFloodgateStorageProvider;\r\n\tprivate governor: IGovernor;\r\n\tprivate initializationStatus: InitializationStatus = InitializationStatus.None;\r\n\tprivate loggedFirstStart: boolean;\r\n\r\n\tprivate floodgateSettings: FloodgateSettings;\r\n\tprivate previousSurveyActivationStats: SurveyStatCollectionActivation;\r\n\tprivate previousSurveyEventActivityStats: SurveyStatCollectionEventActivity;\r\n\r\n\tprivate candidateSurveys: IDictionary<ISurvey> = {};\r\n\tprivate launchedSurveys: IDictionary<ISurvey> = {};\r\n\tprivate launchedLaunchers: ISurveyLauncher[] = [];\r\n\tprivate surveyEventSent: string[] = [];\r\n\r\n\tprivate surveyActivationStatsProvider: ISurveyActivationStatsProvider;\r\n\r\n\tprivate governanceServiceClient: IGovernanceServiceClient;\r\n\tprivate staleTriggeredSurveysQueue: ISurvey[] = [];\r\n\r\n\tpublic constructor(surveyClient: ISurveyClient, activityListener: SurveyActivityListener, launcherFactory: ISurveyLauncherFactory,\r\n\t\tonSurveyActivatedCallback: IOnSurveyActivatedCallback, storage: IFloodgateStorageProvider, governor: IGovernor,\r\n\t\tsurveyActivationStatsProvider: ISurveyActivationStatsProvider, transporterFactory: ITransporterFactory,\r\n\t\tgovernanceServiceClient: IGovernanceServiceClient) {\r\n\r\n\t\tif (!surveyClient) {\r\n\t\t\tthrow new Error(\"surveyClient must not be null\");\r\n\t\t}\r\n\t\tif (!activityListener) {\r\n\t\t\tthrow new Error(\"activityListener must not be null\");\r\n\t\t}\r\n\t\tif (!launcherFactory) {\r\n\t\t\tthrow new Error(\"launcherFactory must not be null\");\r\n\t\t}\r\n\t\tif (!onSurveyActivatedCallback) {\r\n\t\t\tthrow new Error(\"onSurveyActivatedCallback must not be null\");\r\n\t\t}\r\n\t\tif (!storage) {\r\n\t\t\tthrow new Error(\"storage must not be null\");\r\n\t\t}\r\n\t\tif (!governor) {\r\n\t\t\tthrow new Error(\"governor must not be null\");\r\n\t\t}\r\n\t\tif (!transporterFactory) {\r\n\t\t\tthrow new Error(\"transporterFactory must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.surveyClient = surveyClient;\r\n\t\tthis.activityListener = activityListener;\r\n\t\tthis.launcherFactory = launcherFactory;\r\n\t\tthis.onSurveyActivatedCallback = onSurveyActivatedCallback;\r\n\t\tthis.storage = storage;\r\n\t\tthis.governor = governor;\r\n\t\tthis.surveyActivationStatsProvider = surveyActivationStatsProvider;\r\n\t\tthis.governanceServiceClient = governanceServiceClient;\r\n\t\tFloodgateEngine.transporterFactory = transporterFactory;\r\n\r\n\t\tthis.loggedFirstStart = false;\r\n\r\n\t\t// Initialize our list to a valid, empty collection\r\n\t\tthis.setPendingSurveys(null);\r\n\r\n\t\t// If the listener was pre-configured with survey for some reason, clear it now\r\n\t\tthis.activityListener.clearSurveys();\r\n\r\n\t\t// Link ourselves with the listener\r\n\t\tconst thisObj = this; // Save current object in a variable to allow access from callback.\r\n\t\tthis.activityListener.setCallback({\r\n\t\t\trun(surveyId: string, contextInfo: IContextData[]) {\r\n\t\t\t\tthisObj.onSurveyActivated(surveyId, contextInfo);\r\n\t\t\t},\r\n\t\t\tshouldAcceptActivity(activityName: string) {\r\n\t\t\t\treturn thisObj.shouldAcceptActivity(activityName);\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Save all internal stats and floodgateSettings (merging with existing file contents), without stopping the engine.\r\n\t */\r\n\tpublic mergeAndSave(): void {\r\n\t\tthis.saveSettings();\r\n\t\tthis.saveSurveyActivationHistory();\r\n\t\tthis.saveSurveyEventActivityHistory();\r\n\r\n\t\t// Inform surveyClient to save its state\r\n\t\tthis.surveyClient.saveCurrentState();\r\n\r\n\t\t// Save governed channel states\r\n\t\tthis.governor.saveChannelStates();\r\n\t}\r\n\r\n\t/**\r\n\t * Start the engine.  Checks feature enable state, causes survey definitions to be read, and tracked activities to be set on the listener.\r\n\t */\r\n\tpublic start(): void {\r\n\t\tif (this.initializationStatus === InitializationStatus.Initializing ||\r\n\t\t\tthis.initializationStatus === InitializationStatus.Started) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tthis.setInitializationStatus(InitializationStatus.Initializing);\r\n\t\t\tthis.loadSettingsAndPriorEventCounts();\r\n\r\n\t\t\tconst channelTypes: GovernedChannelType[] = this.getAvailableChannelTypes();\r\n\r\n\t\t\tthis.surveyClient.refreshSurveyDefinitions(channelTypes);\r\n\r\n\t\t\tthis.setPendingSurveysAndStartFloodgate();\r\n\t\t\tthis.setInitializationStatus(InitializationStatus.Started);\r\n\t\t} catch (e) {\r\n\t\t\tthis.setInitializationStatus(InitializationStatus.Error);\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(TelemetryEvent.FloodgateEngine.Start.Failed,\r\n\t\t\t\t{ ErrorMessage: e && e.toString(), ErrorDetails: e && e.stack });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Start the engine.  Checks feature enable state, causes survey definitions to be read, and tracked activities to be set on the listener.\r\n\t */\r\n\tpublic startAsync(): Promise<void> {\r\n\t\tif (this.initializationStatus === InitializationStatus.Initializing ||\r\n\t\t\tthis.initializationStatus === InitializationStatus.Started) {\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tthis.setInitializationStatus(InitializationStatus.Initializing);\r\n\t\t\tthis.loadSettingsAndPriorEventCounts();\r\n\r\n\t\t\tconst channelTypes: GovernedChannelType[] = this.getAvailableChannelTypes();\r\n\r\n\t\t\tconst thisFloodgateEngine = this;\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tthisFloodgateEngine.surveyClient.refreshSurveyDefinitionsAsync(channelTypes).then(\r\n\t\t\t\t\tfunction onFulfilled() {\r\n\t\t\t\t\t\t// Handle any stop() calls that happened while initializing\r\n\t\t\t\t\t\tif (thisFloodgateEngine.initializationStatus === InitializationStatus.Stopped) {\r\n\t\t\t\t\t\t\tthisFloodgateEngine.setInitializationStatus(InitializationStatus.Started);\r\n\t\t\t\t\t\t\tthisFloodgateEngine.stop();\r\n\t\t\t\t\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(TelemetryEvent.FloodgateEngine.StartAsync.Stopped,\r\n\t\t\t\t\t\t\t\t{ ErrorMessage: \"Stopped because of a pending stop() call\" });\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthisFloodgateEngine.setPendingSurveysAndStartFloodgate();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t},\r\n\t\t\t\t).catch(\r\n\t\t\t\t\tfunction OnRejected(error: Error) {\r\n\t\t\t\t\t\tthisFloodgateEngine.setInitializationStatus(InitializationStatus.Error);\r\n\t\t\t\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(TelemetryEvent.FloodgateEngine.StartAsync.Failed,\r\n\t\t\t\t\t\t\t{ ErrorMessage: \"Survey refresh error \" + (error && error.message) });\r\n\r\n\t\t\t\t\t\treject(error);\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\tthis.setInitializationStatus(InitializationStatus.Error);\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(TelemetryEvent.FloodgateEngine.StartAsync.Failed,\r\n\t\t\t\t{ ErrorMessage: e && e.toString(), ErrorDetails: e && e.stack });\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Stop the engine.  Causes tracked activities to be cleared and any in-progress counters not otherwise saved to be thrown out.\r\n\t */\r\n\tpublic stop(): void {\r\n\t\tif (this.initializationStatus === InitializationStatus.Started) {\r\n\t\t\tthis.mergeAndSave();\r\n\r\n\t\t\t// Clear our Survey list, and push that through to the listener\r\n\t\t\tthis.setPendingSurveys(null);\r\n\t\t\tthis.updateActivityListenerWithCurrentSurveyDefinitions();\r\n\t\t}\r\n\r\n\t\tthis.setInitializationStatus(InitializationStatus.Stopped);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the IActivityListener logging interface for callers that want to log directly rather than through telemetry\r\n\t */\r\n\tpublic getActivityListener(): IActivityListener {\r\n\t\treturn this.activityListener;\r\n\t}\r\n\r\n\tprivate setInitializationStatus(status: InitializationStatus): void {\r\n\t\tthis.initializationStatus = status;\r\n\t}\r\n\r\n\tprivate saveSettings(): void {\r\n\t\tthis.storage.fileLock(FileType.FloodgateSettings);\r\n\r\n\t\ttry {\r\n\t\t\tthis.writeString(FileType.FloodgateSettings, FloodgateSettings.toJson(this.floodgateSettings));\r\n\t\t} finally {\r\n\t\t\tthis.storage.fileUnlock(FileType.FloodgateSettings);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate loadSettingsAndPriorEventCounts(): void {\r\n\t\ttry {\r\n\t\t\t// Load up the prior survey history and prior event counts\r\n\t\t\tthis.previousSurveyActivationStats = this.surveyActivationStatsProvider.load();\r\n\r\n\t\t\tthis.previousSurveyEventActivityStats =\r\n\t\t\t\tSurveyStatCollectionEventActivity.fromJson(this.readString(FileType.SurveyEventActivityStats));\r\n\r\n\t\t\t// get the list of survey Id - all the survey should have event sent already\r\n\t\t\tconst stats: IDictionary<SurveyEventActivityStats> = this.previousSurveyEventActivityStats.getStats();\r\n\t\t\tfor (const key in stats) {\r\n\t\t\t\tif (stats.hasOwnProperty(key)) {\r\n\t\t\t\t\tthis.surveyEventSent.push(key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Load up the general floodgateSettings\r\n\t\t\tthis.floodgateSettings = FloodgateSettings.fromJson(this.readString(FileType.FloodgateSettings));\r\n\t\t} catch (e) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(TelemetryEvent.FloodgateEngine.Common.Error,\r\n\t\t\t\t{ ErrorMessage: \"Error loading prior settings/events \" + (e && e.toString()) });\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getAvailableChannelTypes(): GovernedChannelType[] {\r\n\t\t// Make sure we've loaded the current survey definitions\r\n\t\tconst channels: IGovernedChannelData[] = this.governor.getAvailableChannelData();\r\n\t\tconst channelTypes: GovernedChannelType[] = [];\r\n\r\n\t\tchannels.forEach((channel) => {\r\n\t\t\tif (channel) {\r\n\t\t\t\tchannelTypes.push(channel.getType());\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn channelTypes;\r\n\t}\r\n\r\n\tprivate setPendingSurveysAndStartFloodgate(): void {\r\n\t\t// Update our survey list, and push that through to the listener\r\n\t\tthis.setPendingSurveys(this.surveyClient.getAppSurveys());\r\n\t\tthis.updateActivityListenerWithCurrentSurveyDefinitions();\r\n\r\n\t\t// Mark us as started\r\n\t\tthis.setInitializationStatus(InitializationStatus.Started);\r\n\r\n\t\t// Log our first start (aka floodgate boot) event\r\n\t\tif (!this.loggedFirstStart) {\r\n\t\t\tthis.loggedFirstStart = true;\r\n\t\t\tthis.getActivityListener().logActivity(SurveyActivityListener.FloodgateStartActivityName);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateSurveyActivationStats(survey: ISurvey) {\r\n\t\tconst surveyInfo = survey.getSurveyInfo();\r\n\t\tconst surveyId = surveyInfo.getId();\r\n\t\tconst stats = this.previousSurveyActivationStats.getStats()[surveyId] || new SurveyActivationStats();\r\n\t\tstats.Type = survey.getType();\r\n\t\tstats.ExpirationTimeUtc = surveyInfo.getExpirationTimeUtc();\r\n\t\tstats.ActivationTimeUtc = new Date();\r\n\t\tstats.SurveyLaunchCount++;\r\n\r\n\t\tthis.previousSurveyActivationStats.addStats(surveyId, stats);\r\n\r\n\t\t// Save the SurveyLaunchCountPerSession into global memory but not local storage\r\n\t\t// so it won't be overwritten in local storage by another app instance\r\n\t\tif (!globalSessionSurveyActivationCounts.hasOwnProperty(surveyId)) {\r\n\t\t\tglobalSessionSurveyActivationCounts[surveyId] = 0;\r\n\t\t}\r\n\t\tglobalSessionSurveyActivationCounts[surveyId]++;\r\n\t}\r\n\r\n\tprivate saveSurveyActivationHistory(): void {\r\n\t\tthis.storage.fileLock(FileType.SurveyActivationStats);\r\n\r\n\t\ttry {\r\n\t\t\tconst statCollection: SurveyStatCollectionActivation = this.surveyActivationStatsProvider.load();\r\n\r\n\t\t\tconst previousStats = this.previousSurveyActivationStats.getStats();\r\n\r\n\t\t\t// Build the update collection\r\n\t\t\tconst updateCollection = new SurveyStatCollectionActivation();\r\n\t\t\tfor (const key in this.launchedSurveys) {\r\n\t\t\t\tif (this.launchedSurveys.hasOwnProperty(key)) {\r\n\t\t\t\t\tconst survey: ISurvey = this.launchedSurveys[key];\r\n\t\t\t\t\tconst surveyId = survey.getSurveyInfo().getId();\r\n\r\n\t\t\t\t\t// Make this part of the update list\r\n\t\t\t\t\tconst stats = previousStats[surveyId];\r\n\t\t\t\t\tupdateCollection.addStats(surveyId, stats);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Actually merge our updates into the full collection\r\n\t\t\tstatCollection.accumulate(updateCollection);\r\n\t\t\tthis.surveyActivationStatsProvider.save(statCollection);\r\n\r\n\t\t\t// Make sure to keep our internal collection consistent with what we just wrote\r\n\t\t\tthis.previousSurveyActivationStats = statCollection;\r\n\t\t} finally {\r\n\t\t\tthis.storage.fileUnlock(FileType.SurveyActivationStats);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate saveSurveyEventActivityHistory(): void {\r\n\t\tthis.storage.fileLock(FileType.SurveyEventActivityStats);\r\n\r\n\t\ttry {\r\n\t\t\tconst statCollection: SurveyStatCollectionEventActivity =\r\n\t\t\t\tSurveyStatCollectionEventActivity.fromJson(this.readString(FileType.SurveyEventActivityStats));\r\n\r\n\t\t\tconst now = new Date();\r\n\t\t\t// Fill out our list of updates\r\n\t\t\tconst updateCollection = new SurveyStatCollectionEventActivity();\r\n\t\t\tfor (const key in this.candidateSurveys) {\r\n\t\t\t\tif (this.candidateSurveys.hasOwnProperty(key)) {\r\n\t\t\t\t\tconst stats: SurveyEventActivityStats = new SurveyEventActivityStats();\r\n\t\t\t\t\tconst survey: ISurvey = this.candidateSurveys[key];\r\n\r\n\t\t\t\t\tif (!survey.getSurveyInfo().isActiveForDate(now)) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstats.ExpirationTimeUtc = survey.getSurveyInfo().getExpirationTimeUtc();\r\n\r\n\t\t\t\t\t// Get the activities which are aggregated, if there aren't any continue\r\n\t\t\t\t\tconst allActivities: ActivityTrackingSet = survey.getSurveyInfo().getActivationEvent().getTrackingSet();\r\n\t\t\t\t\tconst aggregateActivities: string[] = [];\r\n\t\t\t\t\tconst nonAggregateActivities: string[] = [];\r\n\r\n\t\t\t\t\tallActivities.getList().forEach((data) => {\r\n\t\t\t\t\t\tif (data) {\r\n\t\t\t\t\t\t\tif (data.getIsAggregate()) {\r\n\t\t\t\t\t\t\t\taggregateActivities.push(data.getActivity());\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tnonAggregateActivities.push(data.getActivity());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tstats.Counts = new Array(aggregateActivities.length);\r\n\r\n\t\t\t\t\t// Save off the counts we've added for this session\r\n\t\t\t\t\tfor (let i = 0; i < aggregateActivities.length; i++) {\r\n\t\t\t\t\t\tstats.Counts[i] = this.activityListener.moveSessionCountIntoBaseCount(aggregateActivities[i], survey.getSurveyInfo().getId());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (const activity of nonAggregateActivities) {\r\n\t\t\t\t\t\tthis.activityListener.saveSessionTrackingActivity(activity);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Make this part of the update list\r\n\t\t\t\t\tupdateCollection.addStats(survey.getSurveyInfo().getId(), stats);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Actually merge our updates into the full collection\r\n\t\t\tstatCollection.accumulate(updateCollection);\r\n\r\n\t\t\tthis.writeString(FileType.SurveyEventActivityStats, SurveyStatCollectionEventActivity.toJson(statCollection));\r\n\t\t\t// Make sure to keep our internal collection consistent with what we just wrote\r\n\t\t\tthis.previousSurveyEventActivityStats = statCollection;\r\n\t\t} finally {\r\n\t\t\tthis.storage.fileUnlock(FileType.SurveyEventActivityStats);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate setPendingSurveys(pendingSurveys: IDictionary<ISurvey>): void {\r\n\t\tthis.candidateSurveys = {};\r\n\t\tif (pendingSurveys) {\r\n\t\t\tfor (const key in pendingSurveys) {\r\n\t\t\t\tif (pendingSurveys.hasOwnProperty(key)) {\r\n\t\t\t\t\tconst survey: ISurvey = pendingSurveys[key];\r\n\t\t\t\t\tif (this.launcherFactory.AcceptsSurvey(survey)) {\r\n\t\t\t\t\t\tthis.candidateSurveys[key] = survey;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getCurrentSurveyDefinitions(): ISurvey[] {\r\n\t\t// Get a vector of Surveys from our id-based map\r\n\t\tconst surveyList: ISurvey[] = new Array<ISurvey>();\r\n\r\n\t\tconst allCampaignDefinitionIDs = this.getAllCampaignDefinitionIDs();\r\n\t\tconst allCandidateCampaignDefinitionIDs = this.getAllCandidateCampaignDefinitionIDs();\r\n\r\n\t\t// Get all the campaign definitions. We need info from these for telemetry.\r\n\t\tconst allCampaignDefinitions = (this.surveyClient as CampaignManager).getCampaignDefinitions();\r\n\r\n\t\tconst isSurveyAllowed = (surveyInfo: ISurveyInfo) => {\r\n\t\t\t// always allow business critical and approved campaigns\r\n\t\t\tif (isBusinessCriticalSurvey(surveyInfo)) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tconst surveyActivationStats = this.previousSurveyActivationStats.getBySurveyId(surveyInfo.getId());\r\n\t\t\tif (isMultiLaunchSurvey(surveyInfo) &&\r\n\t\t\t\t!hasSurveyReachedMaxLaunches(surveyInfo, surveyActivationStats) &&\r\n\t\t\t\t!hasSurveyReachedMaxLaunchesPerSession(surveyInfo, globalSessionSurveyActivationCounts)) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Skip over any candidate surveys that have been previously completed or not active anymore\r\n\t\t\tif (surveyActivationStats || !surveyInfo.isActiveForDate(new Date())) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t};\r\n\r\n\t\tfor (const key in this.candidateSurveys) {\r\n\t\t\tif (this.candidateSurveys.hasOwnProperty(key)) {\r\n\t\t\t\tconst survey: ISurvey = this.candidateSurveys[key];\r\n\t\t\t\tconst surveyInfo = survey.getSurveyInfo();\r\n\t\t\t\tconst campaignDefinition: CampaignDefinition = allCampaignDefinitions[surveyInfo?.getBackEndId()];\r\n\t\t\t\tif (!campaignDefinition || !isSurveyAllowed(surveyInfo)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// send the UserSelected event if it is not sent before\r\n\t\t\t\tif (this.surveyEventSent.indexOf(key) < 0) {\r\n\t\t\t\t\tthis.surveyEventSent.push(key);\r\n\r\n\t\t\t\t\tconst additionalSurveyInfo = this.getAdditionalSurveyInfoForTelemetry(survey,\r\n\t\t\t\t\t\tnull /* contextInfo */,\r\n\t\t\t\t\t\tallCampaignDefinitionIDs,\r\n\t\t\t\t\t\tallCandidateCampaignDefinitionIDs);\r\n\r\n\t\t\t\t\tFloodgateEngine.telemetryLogger.log_UserSelected(surveyInfo.getBackEndId(),\r\n\t\t\t\t\t\tsurveyInfo.getId(),\r\n\t\t\t\t\t\tsurvey.getType(),\r\n\t\t\t\t\t\tJSON.stringify(additionalSurveyInfo));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsurveyList.push(survey);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn surveyList;\r\n\t}\r\n\r\n\tprivate getAdditionalSurveyInfoForTelemetry(survey: ISurvey,\r\n\t\tcontextInfo: IContextData[], allCampaignDefinitionIDs: string[], allCandidateCampaignDefinitionIDs: string[]): {\r\n\t\tallCandidateCampaignDefinitionIDs: string[],\r\n\t\tallCampaignDefinitionIDs: string[],\r\n\t\tcontextCount?: number,\r\n\t\tsurveyLauncherType: string,\r\n\t\tchannelType: GovernedChannelType,\r\n\t\tpercentageNumerator: number,\r\n\t\tpercentageDenominator: number,\r\n\t\tnominationPeriodNumber: number,\r\n\t\tcooldownPeriodNumber: number,\r\n\t\tbusinessLevel: number,\r\n\t\tmaxLaunches: number,\r\n\t\tmaxLaunchesPerSession: number,\r\n\t\tgovernanceServiceClientState?: GovernanceServiceClientState,\r\n\t} {\r\n\t\t// Get all the campaign definitions. We need info from these for telemetry.\r\n\t\tconst allCampaignDefinitions = (this.surveyClient as CampaignManager).getCampaignDefinitions();\r\n\r\n\t\t// Get the corresponding campaign definition to the survey in question.\r\n\t\tconst correspondingCampaignDefinition = allCampaignDefinitions[survey.getCampaignId()];\r\n\r\n\t\t// Survey properties to get from its corresponding CampaignDefinition:\r\n\t\tlet percentageNumerator: number;\r\n\t\tlet percentageDenominator: number;\r\n\t\tlet nominationPeriodNumber: number;\r\n\t\tlet cooldownPeriodNumber: number;\r\n\r\n\t\tpercentageNumerator = (correspondingCampaignDefinition.nominationScheme as CampaignNominationSchemeRatioPercentage).percentageNumerator;\r\n\t\tpercentageDenominator = (correspondingCampaignDefinition.nominationScheme as CampaignNominationSchemeRatioPercentage).percentageDenominator;\r\n\r\n\t\tnominationPeriodNumber = correspondingCampaignDefinition.nominationScheme.nominationPeriod.asTimeIntervalSeconds();\r\n\t\tnominationPeriodNumber = isNOU(nominationPeriodNumber) ? -1 : nominationPeriodNumber; // Setting to -1 if null or undefined\r\n\r\n\t\tcooldownPeriodNumber = correspondingCampaignDefinition.nominationScheme.cooldownPeriod.asTimeIntervalSeconds();\r\n\t\tcooldownPeriodNumber = isNOU(cooldownPeriodNumber) ? -1 : cooldownPeriodNumber;  // Setting to -1 if null or undefined\r\n\r\n\t\tconst surveyInfo = survey.getSurveyInfo();\r\n\t\treturn {\r\n\t\t\tallCampaignDefinitionIDs,\r\n\t\t\tallCandidateCampaignDefinitionIDs,\r\n\t\t\tchannelType: surveyInfo.getGovernedChannelType(),\r\n\t\t\tcontextCount: contextInfo ? contextInfo.length : undefined,\r\n\t\t\tcooldownPeriodNumber,\r\n\t\t\tnominationPeriodNumber,\r\n\t\t\tpercentageDenominator,\r\n\t\t\tpercentageNumerator,\r\n\t\t\tsurveyLauncherType: survey.getLauncherType(),\r\n\r\n\t\t\tbusinessLevel: surveyInfo.getBusinessLevel(),\r\n\t\t\tmaxLaunches: surveyInfo.getMaxLaunches(),\r\n\t\t\tmaxLaunchesPerSession: surveyInfo.getMaxLaunchesPerSession(),\r\n\t\t};\r\n\t}\r\n\r\n\tprivate getAllCandidateCampaignDefinitionIDs(): string[] {\r\n\r\n\t\tconst allCandidateCampaignDefinitionIDs: string[] = [];\r\n\r\n\t\t// Get all the candidate surveys' campaign definition IDs\r\n\t\tfor (const key in this.candidateSurveys) {\r\n\t\t\tif (this.candidateSurveys.hasOwnProperty(key)) {\r\n\t\t\t\tconst candidateSurvey: ISurvey = this.candidateSurveys[key];\r\n\t\t\t\tallCandidateCampaignDefinitionIDs.push(candidateSurvey.getSurveyInfo().getBackEndId());\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn allCandidateCampaignDefinitionIDs;\r\n\t}\r\n\r\n\tprivate getAllCampaignDefinitionIDs(): string[] {\r\n\r\n\t\tconst allCampaignDefinitions = (this.surveyClient as CampaignManager).getCampaignDefinitions();\r\n\t\tconst allCampaignDefinitionIDs: string[] = [];\r\n\r\n\t\tfor (const definitionsKey in allCampaignDefinitions) {\r\n\t\t\tif (Object.prototype.hasOwnProperty.call(allCampaignDefinitions, definitionsKey)) {\r\n\t\t\t\tconst definition: CampaignDefinition = allCampaignDefinitions[definitionsKey];\r\n\t\t\t\tallCampaignDefinitionIDs.push(definition.campaignId);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn allCampaignDefinitionIDs;\r\n\t}\r\n\r\n\tprivate updateActivityListenerWithCurrentSurveyDefinitions(): void {\r\n\t\tconst surveyList: ISurvey[] = this.getCurrentSurveyDefinitions();\r\n\t\tconst trackingContractList: ActivityTrackingContract[] = [];\r\n\r\n\t\tfor (const survey of surveyList) {\r\n\t\t\tconst surveyInfo = survey.getSurveyInfo();\r\n\t\t\tconst trackingContract = new ActivityTrackingContract(surveyInfo.getId(), surveyInfo.getActivationEvent().getTrackingSet());\r\n\t\t\ttrackingContractList.push(trackingContract);\r\n\t\t}\r\n\r\n\t\tthis.activityListener.SetActivityTrackingContracts(trackingContractList, this.previousSurveyEventActivityStats);\r\n\t}\r\n\r\n\tprivate setCriticalPendingSurveysAndUpdateActivityListener() {\r\n\t\tconst activeSurveys: IDictionary<ISurvey> = {};\r\n\r\n\t\t// Get all the candidate surveys' campaign definition IDs\r\n\t\tfor (const key in this.candidateSurveys) {\r\n\t\t\tif (this.candidateSurveys.hasOwnProperty(key)) {\r\n\t\t\t\tconst candidateSurvey: ISurvey = this.candidateSurveys[key];\r\n\t\t\t\tif (isCriticalSurvey(candidateSurvey.getSurveyInfo())) {\r\n\t\t\t\t\tactiveSurveys[key] = candidateSurvey;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (Object.keys(activeSurveys).length > 0) {\r\n\t\t\tthis.setPendingSurveys(activeSurveys);\r\n\t\t\tthis.updateActivityListenerWithCurrentSurveyDefinitions();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate shouldAcceptActivity(activityName: string): boolean {\r\n\t\treturn this.initializationStatus === InitializationStatus.Started ||\r\n\t\t\tactivityName === SurveyActivityListener.FloodgateStartActivityName;\r\n\t}\r\n\r\n\tprivate onSurveyActivated(surveyId: string, contextInfo: IContextData[]): void {\r\n\t\t// Find the survey object that corresponds to the surveyId passed\r\n\t\tconst surveys: ISurvey[] = this.getCurrentSurveyDefinitions();\r\n\t\tlet survey: ISurvey;\r\n\r\n\t\tfor (const tempSurvey of surveys) {\r\n\t\t\tif (tempSurvey.getSurveyInfo().getId() === surveyId) {\r\n\t\t\t\tsurvey = tempSurvey;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isNOU(survey)) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.FloodgateEngine.OnSurveyActivated.SurveyNotDefined,\r\n\t\t\t\t\"Survey is not defined in the current survey definitions.\",\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst governedChannelType: GovernedChannelType = survey.getSurveyInfo().getGovernedChannelType();\r\n\r\n\t\t\t// If the governance service is in use, launch survey asynchronously\r\n\t\t\tif (this.governanceServiceClient.isEnabled(governedChannelType)) {\r\n\t\t\t\t// record the stale surveys, so we can clear its tracker if Engine is stopped\r\n\t\t\t\tthis.staleTriggeredSurveysQueue.push(survey);\r\n\r\n\t\t\t\t// If there is no survey in stale before, launch the survey right away\r\n\t\t\t\tif (this.staleTriggeredSurveysQueue.length === 1) {\r\n\t\t\t\t\t// Launch the survey asynchronously\r\n\t\t\t\t\tthis.checkGovernanceServiceAndActivateSurvey(survey, governedChannelType, contextInfo);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.activateSurvey(survey, governedChannelType, contextInfo);\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tFloodgateEngine.telemetryLogger.log_Event(TelemetryEvent.FloodgateEngine.OnSurveyActivated.Error,\r\n\t\t\t\t{ ErrorMessage: `Error activating survey ${e && e.toString()}`, ErrorDetails: e && e.stack });\r\n\t\t}\r\n\t}\r\n\r\n\tprivate activateSurvey(survey: ISurvey, governedChannelType: GovernedChannelType, contextInfo: IContextData[]) {\r\n\t\tlet launchSurvey: boolean = false;\r\n\t\t// Figure out if the activated survey is still relevant\r\n\t\tif (!this.candidateSurveys[survey.getSurveyInfo().getId()]) {\r\n\t\t\t// Survey is no longer relevant but was activated. Suppress it.\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.FloodgateEngine.OnSurveyActivated.ActivationIrrelevantSurvey,\r\n\t\t\t\t{\r\n\t\t\t\t\tCampaignId: survey.getSurveyInfo().getBackEndId(),\r\n\t\t\t\t\tSurveyId: survey.getSurveyInfo().getId(),\r\n\t\t\t\t});\r\n\t\t} else if (!survey.getSurveyInfo().isActiveForDate(new Date())) {\r\n\t\t\t// Survey is no longer active (e.g. it was when we registered it but it has now expired)\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.FloodgateEngine.OnSurveyActivated.ActivationExpiredSurvey,\r\n\t\t\t\t{\r\n\t\t\t\t\tCampaignId: survey.getSurveyInfo().getBackEndId(),\r\n\t\t\t\t\tSurveyId: survey.getSurveyInfo().getId(),\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\t// Refresh channels\r\n\t\t\tthis.governor.refreshChannelData();\r\n\r\n\t\t\tif (isCriticalSurvey(survey.getSurveyInfo())) {\r\n\t\t\t\tlaunchSurvey = true;\r\n\t\t\t} else if (!this.governor.isChannelOpen(governedChannelType)) {\r\n\t\t\t\t// Channel has closed and maxLaunches is not set, suppress the survey\r\n\t\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\t\tTelemetryEvent.FloodgateEngine.OnSurveyActivated.ClosedChannelType,\r\n\t\t\t\t\t{ ClosedChannelType: GovernedChannelType[governedChannelType] });\r\n\t\t\t} else {\r\n\t\t\t\t// Get latest survey states from provider\r\n\t\t\t\tconst refreshedSurveyActivationStats = this.surveyActivationStatsProvider.load();\r\n\t\t\t\tif (refreshedSurveyActivationStats.getBySurveyId(survey.getSurveyInfo().getId())) {\r\n\t\t\t\t\t// Survey stats exists already, don't launch\r\n\t\t\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\t\t\tTelemetryEvent.FloodgateEngine.OnSurveyActivated.ActivationStatsSuppressedSurvey,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tCampaignId: survey.getSurveyInfo().getBackEndId(),\r\n\t\t\t\t\t\t\tSurveyId: survey.getSurveyInfo().getId(),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else if (Object.keys(this.launchedSurveys).length === 0) {\r\n\t\t\t\t\t// for now we only support launching one survey per session unless it is multi-launch campaign\r\n\t\t\t\t\t// Track this survey activation for the launch history tracker\r\n\t\t\t\t\tlaunchSurvey = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst triggeredSurvey = Object.values(this.launchedSurveys)[0];\r\n\t\t\t\t\tif (!isNOU(triggeredSurvey)) {\r\n\t\t\t\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\t\t\t\tTelemetryEvent.FloodgateEngine.OnSurveyActivated.SessionSuppressedSurvey,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tCampaignId: triggeredSurvey.getSurveyInfo().getBackEndId(),\r\n\t\t\t\t\t\t\t\tSurveyId: triggeredSurvey.getSurveyInfo().getId(),\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (launchSurvey) {\r\n\t\t\t\tthis.launchedSurveys[survey.getSurveyInfo().getId()] = survey;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// At this point, regardless of whether or not the survey is still relevant, we should flush out the stats\r\n\t\tthis.updateSurveyActivationStats(survey);\r\n\t\tthis.mergeAndSave();\r\n\t\t// shut off further survey launches\r\n\t\tthis.activityListener.clearSurveys();\r\n\r\n\t\t// Clear the survey from stale list\r\n\t\tthis.staleTriggeredSurveysQueue = [];\r\n\r\n\t\t// Actually launch the survey if possible\r\n\t\tif (launchSurvey) {\r\n\t\t\t// Get the stringified json with activity names, counts and isAggregate info for TriggetMet telemetry.\r\n\t\t\tconst activityTrackingString = survey.getSurveyInfo().getActivationEvent().getTrackingSet()\r\n\t\t\t.getActivityTrackingInfo(this.activityListener, survey.getSurveyInfo().getId());\r\n\r\n\t\t\tconst additionalSurveyInfo = this.getAdditionalSurveyInfoForTelemetry(survey, contextInfo, this.getAllCampaignDefinitionIDs(),\r\n\t\t\t\tthis.getAllCandidateCampaignDefinitionIDs());\r\n\r\n\t\t\t// Only adding the governance service client state at TriggerMet event\r\n\t\t\tadditionalSurveyInfo.governanceServiceClientState = this.governanceServiceClient.getClientState();\r\n\r\n\t\t\tFloodgateEngine.telemetryLogger.log_TriggerMet(survey.getSurveyInfo().getBackEndId(), survey.getSurveyInfo().getId(),\r\n\t\t\t\tsurvey.getType(), activityTrackingString, JSON.stringify(additionalSurveyInfo));\r\n\r\n\t\t\t// Set govern channel\r\n\t\t\tthis.governor.startChannelCooldown(governedChannelType);\r\n\r\n\t\t\tconst surveyInfo = survey.getSurveyInfo();\r\n\t\t\tlet isSurveyComplete = true;\r\n\t\t\tif (isBusinessCriticalSurvey(surveyInfo)) {\r\n\t\t\t\t// critical campaigns are not tracked\r\n\t\t\t\tisSurveyComplete = false;\r\n\t\t\t} else if (isMultiLaunchSurvey(surveyInfo)) {\r\n\t\t\t\tconst surveyActivationStats = this.previousSurveyActivationStats.getBySurveyId(surveyInfo.getId());\r\n\t\t\t\tisSurveyComplete = hasSurveyReachedMaxLaunches(surveyInfo, surveyActivationStats);\r\n\t\t\t}\r\n\r\n\t\t\t// Set campaign states\r\n\t\t\tthis.surveyClient.onSurveyActivated(surveyInfo, isSurveyComplete);\r\n\r\n\t\t\t// Show the survey\r\n\t\t\tthis.launchLauncher(survey, contextInfo);\r\n\r\n\t\t\t// check if there are any critical campaigns and start tracking again\r\n\t\t\tthis.setCriticalPendingSurveysAndUpdateActivityListener();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async checkGovernanceServiceAndActivateSurvey(survey: ISurvey,\r\n\t\tgovernedChannelType: GovernedChannelType,\r\n\t\tcontextInfo: IContextData[]): Promise<void> {\r\n\t\t// Get the cooldown setting\r\n\t\tconst campaignDefinition = this.surveyClient.getCampaignDefinitions()[survey.getCampaignId()];\r\n\t\tconst campaignCooldown = campaignDefinition.nominationScheme.cooldownPeriod.asTimeIntervalSeconds();\r\n\t\tconst channelCooldown = Governor.GetChannelCoolDown(governedChannelType);\r\n\r\n\t\t// Call the Governance Service\r\n\t\tconst serviceResult: IGovernanceServiceResult = await this.governanceServiceClient\r\n\t\t\t.checkGovernancePermitAsync(survey, campaignCooldown, channelCooldown, governedChannelType);\r\n\t\tlet launchSurvey: boolean = false;\r\n\r\n\t\t// Log the stale\r\n\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\tTelemetryEvent.FloodgateEngine.CheckGovernanceServiceAndActivateSurvey.GovernanceServiceClientCompleted,\r\n\t\t\t{\r\n\t\t\t\tMessage: JSON.stringify(this.createGorvernanceResponseTelemetry(serviceResult)),\r\n\t\t\t});\r\n\r\n\t\t// Check if engine is still running\r\n\t\tif (this.initializationStatus !== InitializationStatus.Started) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!serviceResult.error) {\r\n\t\t\t// Check result is permitted\r\n\t\t\tif (serviceResult.permission) { // the Governance Service is permitting, continue to trigger\r\n\t\t\t\tlaunchSurvey = true;\r\n\t\t\t} else {\r\n\t\t\t\tconst lastSurveyTriggerInfo: IGovernanceSurveyResponse = serviceResult.lastTriggerSurvey;\r\n\t\t\t\t// For now, we only know the channel is in cooldown but not the specific survey\r\n\t\t\t\t// So only set governed channel to new cooldown\r\n\t\t\t\tthis.governor.startChannelCooldown(governedChannelType, lastSurveyTriggerInfo.lastTriggerSurveyTime);\r\n\r\n\t\t\t\t// Clear the survey relating to channel\r\n\t\t\t\tthis.clearSurveyWithChannel(governedChannelType);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// If force to display with error, continue to trigger the survey\r\n\t\t\tif (this.governanceServiceClient.shouldForceDisplay()) {\r\n\t\t\t\tlaunchSurvey = true;\r\n\r\n\t\t\t\t// Log the force to display event\r\n\t\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\t\tTelemetryEvent.FloodgateEngine.CheckGovernanceServiceAndActivateSurvey.GovernanceServiceForceToDisplay,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tErrorMessage: serviceResult.errorMessage,\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (launchSurvey) {\r\n\t\t\t// Launch the survey\r\n\t\t\tthis.activateSurvey(survey, governedChannelType, contextInfo);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If there is only one survey, which is the current one in process, clear queue and return\r\n\t\tif (this.staleTriggeredSurveysQueue.length <= 1) {\r\n\t\t\tthis.staleTriggeredSurveysQueue = [];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Remove the first activated survey from the list which is the current one in process\r\n\t\tthis.staleTriggeredSurveysQueue.shift();\r\n\r\n\t\t// Playback the next activated survey in waiting\r\n\t\tthis.checkGovernanceServiceAndActivateSurvey(this.staleTriggeredSurveysQueue[0], governedChannelType, contextInfo);\r\n\t}\r\n\r\n\tprivate readString(fileType: FileType): string {\r\n\t\treturn this.storage.read(fileType);\r\n\t}\r\n\r\n\tprivate writeString(fileType: FileType, str: string): void {\r\n\t\tthis.storage.write(fileType, str);\r\n\t}\r\n\r\n\tprivate launchLauncher(survey: ISurvey, contextInfo: IContextData[]): void {\r\n\t\tconst launcher: ISurveyLauncher = this.launcherFactory.makeSurveyLauncher(survey);\r\n\t\tif (launcher) {\r\n\t\t\tthis.launchedLaunchers.push(launcher);\r\n\t\t\tthis.onSurveyActivatedCallback.onSurveyActivated(launcher, survey, { contextInfo });\r\n\t\t}\r\n\t}\r\n\r\n\tprivate clearSurveyWithChannel(governedChannelType: GovernedChannelType) {\r\n\t\tconst activeSurveys: IDictionary<ISurvey> = {};\r\n\r\n\t\t// Get all the candidate surveys' campaign definition IDs\r\n\t\tfor (const key in this.candidateSurveys) {\r\n\t\t\tif (this.candidateSurveys.hasOwnProperty(key)) {\r\n\t\t\t\tconst candidateSurvey: ISurvey = this.candidateSurveys[key];\r\n\t\t\t\tif (candidateSurvey.getSurveyInfo().getGovernedChannelType() !== governedChannelType) {\r\n\t\t\t\t\tactiveSurveys[key] = candidateSurvey;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.candidateSurveys = activeSurveys;\r\n\t\tthis.activityListener.UpdateActivityTrackingContracts(this.candidateSurveys);\r\n\t}\r\n\r\n\tprivate createGorvernanceResponseTelemetry(serviceResult: IGovernanceServiceResult ) {\r\n\t\treturn {\r\n\t\t\tFloodgateEngineStatus: this.initializationStatus.toString(),\r\n\t\t\tGovernanceServiceResult: serviceResult,\r\n\t\t\tStaleTriggeredSurveysQueueCount: this.staleTriggeredSurveysQueue.length - 1,\r\n\t\t};\r\n\t}\r\n}\r\n","import * as ISurvey from \"../../src/Api/ISurvey\";\r\nimport { GovernedChannelType } from \"../GovernedChannel\";\r\nimport * as ISurveyEvent from \"../ISurveyEvent\";\r\nimport * as ISurveyInfo from \"../ISurveyInfo\";\r\nimport { BusinessLevel } from \"../ISurveyInfo\";\r\nimport { ISurveyMetadata } from \"../ISurveyMetadata\";\r\nimport * as Utils from \"../Utils\";\r\n\r\nconst { getDistantFuture, getDistantPast, isNOU, isDate } = Utils;\r\n\r\nclass SurveyDataSource implements ISurveyInfo {\r\n\tprivate data: SurveyDataSource.SurveyDataSourceData;\r\n\r\n\tpublic constructor(data: SurveyDataSource.SurveyDataSourceData) {\r\n\t\tif (isNOU(data)) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\t\tif (isNOU(data.id) || data.id === \"\") {\r\n\t\t\tthrow new Error(\"data.id must not be null or empty\");\r\n\t\t}\r\n\t\tif (isNOU(data.governedChannelType)) {\r\n\t\t\tdata.governedChannelType = GovernedChannelType.getDefault();\r\n\t\t}\r\n\t\tif (isNOU(data.expirationTimeUtc) || data.expirationTimeUtc === \"\") {\r\n\t\t\tthrow new Error(\"data.expirationTimeUtc must not be null or empty\");\r\n\t\t}\r\n\t\tif (isNOU(data.activationEvent)) {\r\n\t\t\tthrow new Error(\"data.activationEvent must not be null\");\r\n\t\t}\r\n\t\tif (isNOU(data.backEndIdentifier) || data.backEndIdentifier === \"\") {\r\n\t\t\tdata.backEndIdentifier = data.id;\r\n\t\t}\r\n\t\tif (isNOU(data.launcherType)) {\r\n\t\t\tdata.launcherType = ISurvey.LAUNCHER_TYPE_DEFAULT;\r\n\t\t}\r\n\r\n\t\tthis.data = data;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getId(): string {\r\n\t\treturn this.data.id;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getBackEndId(): string {\r\n\t\treturn this.data.backEndIdentifier;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getGovernedChannelType(): GovernedChannelType {\r\n\t\treturn this.data.governedChannelType;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getRawStartTimeUtc(): string {\r\n\t\treturn this.data.startTimeUtc;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getStartTimeUtc(): Date {\r\n\t\tif (isNOU(this.data.startTimeUtc)) {\r\n\t\t\treturn getDistantPast(); // Optional start date means the survey has started\r\n\t\t}\r\n\r\n\t\tconst parsed = new Date(this.data.startTimeUtc);\r\n\t\tif (!isDate(parsed)) {\r\n\t\t\treturn getDistantFuture(); // Badly specified start dates means the survey never starts\r\n\t\t}\r\n\r\n\t\treturn parsed;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getExpirationTimeUtc(): Date {\r\n\t\t// Bad or missing expiration date means survey is always expired.\r\n\r\n\t\tif (isNOU(this.data.expirationTimeUtc)) {\r\n\t\t\treturn getDistantPast();\r\n\t\t}\r\n\r\n\t\tconst parsed = new Date(this.data.expirationTimeUtc);\r\n\t\tif (!isDate(parsed)) {\r\n\t\t\treturn getDistantPast();\r\n\t\t}\r\n\r\n\t\treturn parsed;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getRawExpirationTimeUtc(): string {\r\n\t\treturn this.data.expirationTimeUtc;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic isActiveForDate(date: Date): boolean {\r\n\t\tif (isNOU(date)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn (date >= this.getStartTimeUtc() && date <= this.getExpirationTimeUtc());\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getActivationEvent(): ISurveyEvent {\r\n\t\treturn this.data.activationEvent;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getPreferredLaunchType(): ISurveyInfo.LaunchType {\r\n\t\treturn this.data.preferredLaunchType;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic isAdditionalDataRequested(additionalDataToCheck: ISurveyInfo.AdditionalDataType): boolean {\r\n\t\tif (isNOU(this.data.additionalDataRequested)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfor (const additionalData of this.data.additionalDataRequested) {\r\n\t\t\tif (additionalData === additionalDataToCheck) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getLauncherType(): string {\r\n\t\treturn this.data.launcherType;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getMetadata(): ISurveyMetadata {\r\n\t\treturn this.data.metadata;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getBusinessLevel(): BusinessLevel {\r\n\t\treturn this.data.businessLevel;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getMaxLaunches(): number {\r\n\t\treturn this.data.maxLaunches;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getMaxLaunchesPerSession(): number {\r\n\t\treturn this.data.maxLaunchesPerSession;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getDomElements(doc: Document): Element[] {\r\n\t\tif (!doc) {\r\n\t\t\tthrow new Error(\"Document must not be null\");\r\n\t\t}\r\n\r\n\t\tconst typeElement: Element = doc.createElement(ISurveyInfo.DOM_TYPE_TAGNAME);\r\n\t\ttypeElement.appendChild(doc.createTextNode(ISurveyInfo.DOM_TYPE_VALUE));\r\n\r\n\t\tconst idElement: Element = doc.createElement(ISurveyInfo.DOM_ID_TAGNAME);\r\n\t\tidElement.appendChild(doc.createTextNode(this.getBackEndId()));\r\n\r\n\t\treturn [typeElement, idElement];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\tconst surveyObject: object = {};\r\n\t\tsurveyObject[ISurveyInfo.JSON_ID_KEYNAME] = this.getBackEndId();\r\n\r\n\t\tconst result: object = {};\r\n\t\tresult[ISurveyInfo.JSON_SURVEY_KEYNAME] = surveyObject;\r\n\r\n\t\treturn result;\r\n\t}\r\n}\r\n\r\nmodule SurveyDataSource {\r\n\t/**\r\n\t * Basic data needed for all Surveys\r\n\t */\r\n\texport class SurveyDataSourceData {\r\n\t\tpublic id: string;\r\n\t\tpublic backEndIdentifier: string;\r\n\t\tpublic governedChannelType: GovernedChannelType;\r\n\t\tpublic startTimeUtc: string;\r\n\t\tpublic expirationTimeUtc: string;\r\n\t\tpublic activationEvent: ISurveyEvent;\r\n\t\tpublic preferredLaunchType: ISurveyInfo.LaunchType = ISurveyInfo.LaunchType.Default;\r\n\t\tpublic additionalDataRequested: ISurveyInfo.AdditionalDataType[];\r\n\t\tpublic launcherType: string;\r\n\t\tpublic metadata: ISurveyMetadata;\r\n\r\n\t\tpublic businessLevel: BusinessLevel;\r\n\t\tpublic maxLaunches: number;\r\n\t\tpublic maxLaunchesPerSession: number;\r\n\t}\r\n}\r\n\r\nexport = SurveyDataSource;\r\n","import ISurvey = require(\"../Api/ISurvey\");\r\nimport ISurveyComponent = require(\"../Api/ISurveyComponent\");\r\nimport { ITransporter } from \"../Api/ITransporter\";\r\nimport { FloodgateEngine } from \"../FloodgateEngine\";\r\nimport * as ISurveyInfo from \"../ISurveyInfo\";\r\nimport * as Utils from \"./../Utils\";\r\n\r\nexport abstract class Survey implements ISurvey {\r\n\tprivate survey: ISurvey;\r\n\tprivate clientFeedbackId: string;\r\n\r\n\tpublic abstract getComponent(componentType: ISurveyComponent.Type): ISurveyComponent;\r\n\r\n\tpublic getCampaignId(): string {\r\n\t\treturn this.getSurveyInfo().getBackEndId();\r\n\t}\r\n\r\n\tpublic getLauncherType(): string {\r\n\t\treturn this.getSurveyInfo().getLauncherType();\r\n\t}\r\n\r\n\tpublic getClientFeedbackId(): string {\r\n\t\treturn this.clientFeedbackId;\r\n\t}\r\n\r\n\tpublic submit() {\r\n\t\tconst surveyType: string = ISurvey.Type[this.getType()];\r\n\t\tconst transporter: ITransporter = FloodgateEngine.getTransportFactory().makeTransporter(surveyType);\r\n\t\ttransporter.setManifestValues(this.getJsonElements());\r\n\t\tthis.clientFeedbackId = transporter.getClientFeedbackId();\r\n\t\ttransporter.submit();\r\n\t}\r\n\r\n\tpublic getPreGeneratedClientFeedbackId(): string {\r\n\t\tif (this.clientFeedbackId) {\r\n\t\t\treturn this.clientFeedbackId;\r\n\t\t} else {\r\n\t\t\treturn this.clientFeedbackId = Utils.guid();\r\n\t\t}\r\n\t}\r\n\t// Abstract classes that are implemented by actual Surveys\r\n\tpublic abstract getType(): ISurvey.Type;\r\n\r\n\tpublic abstract getSurveyInfo(): ISurveyInfo;\r\n\r\n\tpublic abstract getJsonElements(): object;\r\n\r\n\tpublic abstract getDomElements(doc: Document): Element[];\r\n}\r\n","import * as Utils from \"./Utils\";\r\n\r\nexport enum GovernedChannelType {\r\n\tStandard, // 0\r\n\tUrgent, // 1\r\n\tBanner, // 2\r\n\tTeachingMessage, // 3\r\n}\r\n\r\nexport namespace GovernedChannelType {\r\n\texport function getDefault(): GovernedChannelType { return GovernedChannelType.Standard; }\r\n}\r\n\r\nexport interface IGovernedChannelData {\r\n\t/**\r\n\t * Gets the type of GovernedChannel this object represents\r\n\t */\r\n\tgetType(): GovernedChannelType;\r\n\r\n\t/**\r\n\t * Gets the name of this GovernedChannel\r\n\t */\r\n\tgetName(): string;\r\n\r\n\t/**\r\n\t * Gets the amount of time during which this channel will refuse new surveys after a successful prompt\r\n\t */\r\n\tgetCooldownSeconds(): number;\r\n\r\n\t/**\r\n\t * Gets the last time this channel started a cool down (aka the last time a survey was successfully shown).\r\n\t * Null if cool down has never been initiated\r\n\t */\r\n\tgetCooldownStartTime(): Date;\r\n\r\n\t/**\r\n\t * If in cool down, returns the time in which this channel will next be \"Open\".\r\n\t * Else returns the last time this channel became \"Open\".\r\n\t */\r\n\tgetCooldownEndTime(): Date;\r\n\r\n\t/**\r\n\t * Whether or not this channel is open to new surveys at this current point in time (aka Now)\r\n\t */\r\n\tisOpen(): boolean;\r\n\r\n\t/**\r\n\t * Whether or not this channel is open to new surveys at the specified point in time\r\n\t */\r\n\tisOpenAtDate(date: Date): boolean;\r\n}\r\n\r\nexport class GovernedChannel implements IGovernedChannelData {\r\n\tprivate type: GovernedChannelType;\r\n\tprivate name: string;\r\n\tprivate cooldownSeconds: number;\r\n\tprivate cooldownStartTime: Date;\r\n\tprivate cooldownEndTime: Date;\r\n\r\n\tpublic constructor(type: GovernedChannelType, name: string, cooldownSeconds: number, cooldownStartTime: Date) {\r\n\t\tif (!Utils.isEnumValue(type, GovernedChannelType)) {\r\n\t\t\tthrow new Error(\"type is not a valid GovernedChannelType\");\r\n\t\t}\r\n\r\n\t\tif (!name) {\r\n\t\t\tthrow new Error(\"name must not be null or empty\");\r\n\t\t}\r\n\r\n\t\tif (cooldownSeconds < 0) {\r\n\t\t\tthrow new Error(\"cooldownSeconds must not be negative\");\r\n\t\t}\r\n\r\n\t\tthis.type = type;\r\n\t\tthis.name = name;\r\n\t\tthis.cooldownSeconds = cooldownSeconds;\r\n\t\tthis.setCooldownStartTime(cooldownStartTime);\r\n\t}\r\n\r\n\tpublic setCooldownStartTime(cooldownStartTime: Date): void {\r\n\t\t// Set the start time\r\n\t\tthis.cooldownStartTime = cooldownStartTime;\r\n\r\n\t\tif (Utils.isNOU(this.cooldownStartTime)) {\r\n\t\t\t// Null cooldownStartTime means cool down has never been initiated, so set the cooldownEndTime to distant past\r\n\t\t\tthis.cooldownEndTime = Utils.getDistantPast();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Calculate the end time, but don't overflow past max.\r\n\t\tthis.cooldownEndTime = Utils.addSecondsWithoutOverflow(this.cooldownStartTime, this.cooldownSeconds);\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic isOpen(): boolean {\r\n\t\treturn this.isOpenAtDate(new Date());\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic isOpenAtDate(date: Date): boolean {\r\n\t\tif (!date) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn (date > this.cooldownEndTime);\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getType(): GovernedChannelType {\r\n\t\treturn this.type;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getName(): string {\r\n\t\treturn this.name;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getCooldownSeconds(): number {\r\n\t\treturn this.cooldownSeconds;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getCooldownStartTime(): Date {\r\n\t\treturn this.cooldownStartTime;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getCooldownEndTime(): Date {\r\n\t\treturn this.cooldownEndTime;\r\n\t}\r\n}\r\n","import { IFloodgateEnvironmentProvider } from \"../Api/IFloodgateEnvironmentProvider\";\r\nimport * as IFloodgateStorageProvider from \"../Api/IFloodgateStorageProvider\";\r\nimport { TelemetryEvent } from \"../Constants\";\r\nimport { FloodgateEngine } from \"../FloodgateEngine\";\r\nimport { GovernedChannelType } from \"../GovernedChannel\";\r\nimport * as ISurveyInfo from \"../ISurveyInfo\";\r\nimport { BusinessLevel } from \"../ISurveyInfo\";\r\nimport * as Utils from \"../Utils\";\r\n\r\nimport { IUserFactProvider } from \"../Api/Api\";\r\nimport { UserFact } from \"../UserFact/UserFact\";\r\nimport { deserializeUserFacts, validateUserFacts } from \"../UserFact/UserFactHelper\";\r\nimport { CampaignScopeType } from \"./CampaignScopeTypes\";\r\n\r\nconst { getDistantFuture, isBoolean, isNOU, isNumber, isString, isUtcDatetimeString, stringToDate } = Utils;\r\n\r\n// region Language Range\r\n\r\n/**\r\n * Base class representing a language range in a campaign setting\r\n */\r\nexport abstract class CampaignLanguageRange {\r\n\tpublic static deserialize(input: any): CampaignLanguageRange {\r\n\t\tlet result: CampaignLanguageRange;\r\n\r\n\t\tif (input && input.Type === 0) {\r\n\t\t\tresult = CampaignLanguageRangeLanguageSubtag.deserialize(input);\r\n\t\t}\r\n\r\n\t\tif (result === undefined) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected constructor() { }\r\n\r\n\t/**\r\n\t * Returns whether or not the specific language tag (format from RFC 5646) is in this language range specification\r\n\t */\r\n\tpublic abstract isInRange(language: string): boolean;\r\n\r\n\tprotected validate(): boolean {\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * Represents a range matching on the \"language subtag\" against fully specified language tags, according to RFC 5646\r\n */\r\nexport class CampaignLanguageRangeLanguageSubtag extends CampaignLanguageRange {\r\n\tpublic static deserialize(input: any): CampaignLanguageRangeLanguageSubtag {\r\n\t\tconst result = new CampaignLanguageRangeLanguageSubtag();\r\n\r\n\t\tif (input) {\r\n\t\t\tresult.languageSubTag = input.Value;\r\n\t\t}\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"Value\")\r\n\tpublic languageSubTag: string;\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\t// @Override\r\n\tpublic isInRange(language: string): boolean {\r\n\t\tif (isNOU(language)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst extractedLanguageSubTag: string = Utils.extractLanguageSubtag(language);\r\n\t\tif (isNOU(extractedLanguageSubTag)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// compare strings ignoring case\r\n\t\treturn extractedLanguageSubTag.toLocaleUpperCase() === this.languageSubTag.toLocaleUpperCase();\r\n\t}\r\n\r\n\t// @Override\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.languageSubTag) || !isString(this.languageSubTag)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t// Reject any spec that isn't exactly a language subtag\r\n\t\tif (!Utils.isValidLanguageSubTag(this.languageSubTag)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n// endregion\r\n\r\n// region Scope\r\n\r\nexport abstract class CampaignScope {\r\n\tpublic static deserialize(input: any): CampaignScope {\r\n\t\tlet result: CampaignScope;\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tswitch (input.Type) {\r\n\t\t\tcase CampaignScopeType.CampaignScopeAny:\r\n\t\t\t\tresult = CampaignScopeAny.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase CampaignScopeType.CampaignScopeEnvironmentCrossProduct:\r\n\t\t\t\tresult = CampaignScopeEnvironmentCrossProduct.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase CampaignScopeType.CampaignScopeUserFactAny:\r\n\t\t\t\tresult = CampaignScopeUserFactAny.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase CampaignScopeType.CampaignScopeUserFactAll:\r\n\t\t\t\tresult = CampaignScopeUserFactAll.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (result === undefined) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected constructor() { }\r\n\r\n\tpublic abstract isInScope(): boolean;\r\n\r\n\tprotected validate(): boolean {\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignScopeAny extends CampaignScope {\r\n\tpublic static deserialize(input: any): CampaignScopeAny {\r\n\t\treturn new CampaignScopeAny();\r\n\t}\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\t// @Override\r\n\tpublic isInScope(): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// @Override\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignScopeEnvironmentCrossProduct extends CampaignScope {\r\n\tpublic static deserialize(input: any): CampaignScopeEnvironmentCrossProduct {\r\n\t\tconst result = new CampaignScopeEnvironmentCrossProduct();\r\n\t\tlet languageRanges: CampaignLanguageRange[] = [];\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfor (const key in input.Languages) {\r\n\t\t\tif (input.Languages.hasOwnProperty(key)) {\r\n\t\t\t\tconst readRange: CampaignLanguageRange = input.Languages[key];\r\n\r\n\t\t\t\tif (readRange) {\r\n\t\t\t\t\tlanguageRanges.push(CampaignLanguageRange.deserialize(readRange));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (languageRanges.length === 0) {\r\n\t\t\tlanguageRanges = null;\r\n\t\t}\r\n\r\n\t\tresult.languageRanges = languageRanges;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"Languages\")\r\n\tpublic languageRanges: CampaignLanguageRange[];\r\n\r\n\tprivate environmentProvider: IFloodgateEnvironmentProvider;\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\tpublic setEnvironmentProvider(environmentProvider: IFloodgateEnvironmentProvider) {\r\n\t\tthis.environmentProvider = environmentProvider;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic isInScope(): boolean {\r\n\t\tif (isNOU(this.languageRanges)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.environmentProvider) || !this.environmentProvider.getLanguage()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst language = this.environmentProvider.getLanguage();\r\n\t\t// If the environment matches a single pattern, then this is a yes\r\n\t\tfor (const key in this.languageRanges) {\r\n\t\t\tif (this.languageRanges.hasOwnProperty(key)) {\r\n\t\t\t\tconst range = this.languageRanges[key];\r\n\r\n\t\t\t\tif (range.isInRange(language)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// @Override\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Null languageRanges is allowed, means will match with everything.\r\n\t\tif (this.languageRanges) {\r\n\t\t\tfor (const key in this.languageRanges) {\r\n\t\t\t\tif (this.languageRanges.hasOwnProperty(key) && !this.languageRanges[key]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignScopeUserFactAny extends CampaignScope {\r\n\tpublic static deserialize(input: any): CampaignScopeUserFactAny {\r\n\t\tconst result = new CampaignScopeUserFactAny();\r\n\t\tresult.userFacts = deserializeUserFacts(input);\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"UserFacts\")\r\n\tpublic userFacts: UserFact[];\r\n\r\n\tprivate userFactsProvider?: IUserFactProvider;\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\tpublic setUserFactsProvider(userFactsProvider?: IUserFactProvider) {\r\n\t\tthis.userFactsProvider = userFactsProvider;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic isInScope(): boolean {\r\n\t\tif (isNOU(this.userFacts)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (!this.userFactsProvider) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// If one of the user fact matches, then this is a yes\r\n\t\treturn this.userFacts.some((userFact) => {\r\n\t\t\tconst rawUserFact = this.userFactsProvider.getUserFact(userFact.getName());\r\n\t\t\treturn userFact.isAMatch(rawUserFact);\r\n\t\t});\r\n\t}\r\n\r\n\t// @Override\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn validateUserFacts(this.userFacts);\r\n\t}\r\n}\r\n\r\nexport class CampaignScopeUserFactAll extends CampaignScope {\r\n\tpublic static deserialize(input: any): CampaignScopeUserFactAll {\r\n\t\tconst result = new CampaignScopeUserFactAll();\r\n\t\tresult.userFacts = deserializeUserFacts(input);\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"UserFacts\")\r\n\tpublic userFacts: UserFact[];\r\n\r\n\tprivate userFactsProvider?: IUserFactProvider;\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\tpublic setUserFactsProvider(userFactsProvider?: IUserFactProvider) {\r\n\t\tthis.userFactsProvider = userFactsProvider;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic isInScope(): boolean {\r\n\t\tif (isNOU(this.userFacts)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (!this.userFactsProvider) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Get all of the mismatched user facts\r\n\t\tconst mismatchedFacts = this.userFacts.filter((userFact) => {\r\n\t\t\tconst rawUserFact = this.userFactsProvider.getUserFact(userFact.getName());\r\n\t\t\treturn !userFact.isAMatch(rawUserFact);\r\n\t\t});\r\n\r\n\t\tif (mismatchedFacts.length > 0) {\r\n\t\t\tconst mismatchedNames = mismatchedFacts.map((userFact) => userFact.getName());\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Summary, {\r\n\t\t\t\t\tCount: mismatchedFacts.length,\r\n\t\t\t\t\tMessage: mismatchedNames.toString(),\r\n\t\t\t\t});\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// If all of the user facts match, then this is a yes\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// @Override\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn validateUserFacts(this.userFacts);\r\n\t}\r\n}\r\n\r\n// endregion\r\n\r\n// region Durations\r\n\r\n/**\r\n * Base class representing a duration in a campaign setting\r\n */\r\nexport abstract class CampaignDuration {\r\n\tpublic static deserialize(input: any): CampaignDuration {\r\n\t\tlet result: CampaignDuration;\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tswitch (input.Type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tresult = CampaignDurationTimeInterval.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tresult = CampaignDurationSingleBuildChange.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (result === undefined) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected constructor() { }\r\n\r\n\tpublic abstract asTimeIntervalSeconds(): number;\r\n\r\n\tprotected validate(): boolean {\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * A Duration expressed in seconds. UTC datetime comparisons are used to determine expiration.\r\n */\r\nexport class CampaignDurationTimeInterval extends CampaignDuration {\r\n\tpublic static deserialize(input: any): CampaignDurationTimeInterval {\r\n\t\tconst result = new CampaignDurationTimeInterval();\r\n\r\n\t\tif (input) {\r\n\t\t\tresult.intervalSeconds = input.IntervalSeconds;\r\n\t\t}\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"IntervalSeconds\")\r\n\tpublic intervalSeconds: number;\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\t// @Override\r\n\tpublic asTimeIntervalSeconds(): number {\r\n\t\treturn this.intervalSeconds;\r\n\t}\r\n\r\n\t// @Override\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!isNumber(this.intervalSeconds)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * A Duration representing exactly 1 change in build number\r\n */\r\nexport class CampaignDurationSingleBuildChange extends CampaignDuration {\r\n\tpublic static deserialize(input: any): CampaignDurationSingleBuildChange {\r\n\t\treturn new CampaignDurationSingleBuildChange();\r\n\t}\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\t// @Override\r\n\tpublic asTimeIntervalSeconds(): number {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n/**\r\n * Class representing AdditionalDataRequested in CampaignDefinition\r\n */\r\nexport class CampaignAdditionalDataRequested {\r\n\tpublic static deserialize(additionalDataRequested: string[]): CampaignAdditionalDataRequested {\r\n\t\tconst result = new CampaignAdditionalDataRequested();\r\n\r\n\t\tif (!isNOU(additionalDataRequested)) {\r\n\t\t\t// Convert from AdditionalDataRequested string to enum\r\n\t\t\tresult.additionalData = [];\r\n\t\t\tfor (const additionalData of additionalDataRequested) {\r\n\t\t\t\tif (additionalData === \"EmailAddress\") {\r\n\t\t\t\t\tresult.additionalData.push(ISurveyInfo.AdditionalDataType.EmailAddress);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tpublic additionalData: ISurveyInfo.AdditionalDataType[];\r\n\r\n\tprivate validate(): boolean {\r\n\t\tif (isNOU(this.additionalData)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n// endregion\r\n\r\n// region Distribution Schemes\r\n\r\nexport abstract class CampaignDistribution {\r\n\tpublic static deserialize(input: any): CampaignDistribution {\r\n\t\tlet result: CampaignDistribution;\r\n\r\n\t\tif (input && input.Type === 0) {\r\n\t\t\tresult = CampaignDistributionRamp.deserialize(input);\r\n\t\t}\r\n\r\n\t\tif (result === undefined) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected constructor() { }\r\n\r\n\tprotected validate(): boolean {\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignDistributionRamp extends CampaignDistribution {\r\n\tpublic static deserialize(input: any): CampaignDistributionRamp {\r\n\t\tconst result = new CampaignDistributionRamp();\r\n\r\n\t\tif (input) {\r\n\t\t\tresult.maxDelaySeconds = input.MaxDelaySeconds;\r\n\t\t\tresult.chunks = input.Chunks;\r\n\t\t}\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// The time window over which the ramp will distribute start dates.\r\n\t// @SerializedName(\"MaxDelaySeconds\")\r\n\tpublic maxDelaySeconds: number;\r\n\r\n\t// The number of discrete buckets to divide the time window (maxDelaySeconds) into\r\n\t// @SerializedName(\"Chunks\")\r\n\tpublic chunks: number;\r\n\r\n\tprivate constructor() { super(); }\r\n\r\n\t// @Override\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!isNumber(this.maxDelaySeconds) || this.maxDelaySeconds < 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!isNumber(this.chunks) || this.chunks < 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n// endregion\r\n\r\n// region Nomination Scheme\r\n\r\nexport abstract class CampaignNominationScheme {\r\n\tpublic static deserialize(input: any): CampaignNominationScheme {\r\n\t\tlet result: CampaignNominationScheme;\r\n\r\n\t\tif (input && input.Type === 0) {\r\n\t\t\tresult = CampaignNominationSchemeRatioPercentage.deserialize(input);\r\n\t\t}\r\n\r\n\t\tif (result === undefined) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// The amount of time (in seconds) for which the survey is active, if the nominationPeriod can't be interpreted as a time interval\r\n\t// note: This is only used when nominationPeriod is not of a type that can be interpreted as a time interval, otherwise\r\n\t// that value is used instead\r\n\t// @SerializedName(\"FallbackSurveyDurationSeconds\")\r\n\tpublic fallbackSurveyDurationSeconds: number;\r\n\r\n\t// When the user never sees the survey during their candidacy (or anti-candidacy), this is the duration that must lapse\r\n\t// before re- nominating\r\n\t// @SerializedName(\"NominationPeriod\")\r\n\tpublic nominationPeriod: CampaignDuration;\r\n\r\n\t// When the user does sees the survey during their candidacy, this is the duration that must lapse before re-evaluating\r\n\t// candidacy. Generally recommended that this be greater than nominationPeriod\r\n\t// @SerializedName(\"CooldownPeriod\")\r\n\tpublic cooldownPeriod: CampaignDuration;\r\n\r\n\tprotected constructor() { }\r\n\r\n\t/**\r\n\t * @return The amount of time the survey should be active, in seconds. Abstracts the difference between nominationPeriod and the fallback\r\n\t */\r\n\tpublic getActiveSurveyTimeIntervalSeconds(): number {\r\n\t\tconst nominationTimIntervalSeconds: number = this.nominationPeriod.asTimeIntervalSeconds();\r\n\r\n\t\tif (isNumber(nominationTimIntervalSeconds)) {\r\n\t\t\treturn nominationTimIntervalSeconds;\r\n\t\t}\r\n\r\n\t\treturn this.fallbackSurveyDurationSeconds;\r\n\t}\r\n\r\n\t/**\r\n\t * @return The survey start time, possibly adjusted by an underlying DistributionModel.\r\n\t */\r\n\tpublic calculateSurveyStartTimeFromDate(soonestStartTime: Date): Date {\r\n\t\t// No adjustment in base class.  Derived classes can override and implement delays like a \"ramp\"\r\n\t\treturn soonestStartTime ? soonestStartTime : new Date();\r\n\t}\r\n\r\n\t/**\r\n\t * @return The survey expiration time, based on the nomination periods and the survey's adjusted start time\r\n\t */\r\n\tpublic calculateSurveyExpirationTimeFromSurveyStartTime(surveyStartTime: Date): Date {\r\n\t\tsurveyStartTime = surveyStartTime ? surveyStartTime : new Date();\r\n\t\treturn Utils.addSecondsWithoutOverflow(surveyStartTime, this.getActiveSurveyTimeIntervalSeconds());\r\n\t}\r\n\r\n\t/**\r\n\t * @return The appropriate campaign cool down based on whether or not the user activated the survey\r\n\t */\r\n\tpublic getCampaignCooldown(didUserActivateSurvey: boolean): CampaignDuration {\r\n\t\tif (didUserActivateSurvey) {\r\n\t\t\treturn this.cooldownPeriod;\r\n\t\t} else {\r\n\t\t\treturn this.nominationPeriod;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Evaluate this rule set based on a random number\r\n\t *\r\n\t * @return true if the user should be a candidate, false if they should be an anti-candidate\r\n\t */\r\n\tpublic abstract evaluateNominationRules(): boolean;\r\n\r\n\tprotected validate(): boolean {\r\n\t\tif (isNOU(this.nominationPeriod)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.cooldownPeriod)) {\r\n\t\t\tthis.cooldownPeriod = this.nominationPeriod;\r\n\t\t}\r\n\r\n\t\tif (!isNumber(this.nominationPeriod.asTimeIntervalSeconds())) {\r\n\t\t\tif (!isNumber(this.fallbackSurveyDurationSeconds) || this.fallbackSurveyDurationSeconds <= 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * Class representing a set of campaign nomination rules to evaluate for in-scope campaigns:\r\n * percentage\r\n * re-election durations\r\n * distribution model (for \"nominated\" candidates)\r\n */\r\nexport class CampaignNominationSchemeRatioPercentage extends CampaignNominationScheme {\r\n\tpublic static deserialize(input: any): CampaignNominationSchemeRatioPercentage {\r\n\t\tconst result = new CampaignNominationSchemeRatioPercentage();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif (input.DistributionModel) {\r\n\t\t\tresult.distributionModel = CampaignDistribution.deserialize(input.DistributionModel);\r\n\t\t}\r\n\r\n\t\tif (input.CooldownPeriod) {\r\n\t\t\tresult.cooldownPeriod = CampaignDuration.deserialize(input.CooldownPeriod);\r\n\t\t}\r\n\r\n\t\tif (input.NominationPeriod) {\r\n\t\t\tresult.nominationPeriod = CampaignDuration.deserialize(input.NominationPeriod);\r\n\t\t}\r\n\r\n\t\tresult.fallbackSurveyDurationSeconds = input.FallbackSurveyDurationSeconds;\r\n\t\tresult.percentageDenominator = input.PercentageDenominator;\r\n\t\tresult.percentageNumerator = input.PercentageNumerator;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// The numerator when calculating the percentage of users that should be selected as candidates.  Must\r\n\t// satisfy 0 <= percentageNumerator <= percentageDenominator\r\n\t// @SerializedName(\"PercentageNumerator\")\r\n\tpublic percentageNumerator: number;\r\n\r\n\t// The denominator when calculating the percentage of users that should be selected as candidates.  Must be greater than 0.\r\n\t// @SerializedName(\"PercentageDenominator\")\r\n\tpublic percentageDenominator: number;\r\n\r\n\t// NYI - For candidates, allows the Survey start/end dates to be shifted forward in time, to help achieve a smoother signal\r\n\t// @SerializedName(\"DistributionModel\")\r\n\tpublic distributionModel: CampaignDistribution;\r\n\r\n\tprivate constructor() { super(); }\r\n\r\n\t// @Override\r\n\tpublic evaluateNominationRules(): boolean {\r\n\t\tconst rand: number = Math.random();\r\n\t\t// Creates a random number between [0 to (percentageDenominator - 1)]\r\n\t\t// In range [0 to (percentageDenominator - 1)] exactly 'percentageNumerator' values are < percentageNumerator\r\n\t\treturn Math.floor(rand * this.percentageDenominator) < this.percentageNumerator;\r\n\t}\r\n\r\n\t// @Override\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!isNumber(this.percentageDenominator) || !isNumber(this.percentageNumerator)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (this.percentageDenominator <= 0 || this.percentageNumerator < 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (this.percentageNumerator > this.percentageDenominator) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// distribution model may be null\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n// endregion\r\n\r\n// region Survey Event Definitions\r\nexport abstract class CampaignSurveyEvent {\r\n\tpublic static deserialize(input: any): CampaignSurveyEvent {\r\n\t\tlet result: CampaignSurveyEvent;\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tswitch (input.Type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tresult = CampaignSurveyEventCountedActivity.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tresult = CampaignSurveyEventCountedActivitySequence.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (result === undefined) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected constructor() { }\r\n\r\n\tprotected validate(): boolean {\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyEventCountedActivity extends CampaignSurveyEvent {\r\n\tpublic static deserialize(input: any): CampaignSurveyEventCountedActivity {\r\n\t\tconst result = new CampaignSurveyEventCountedActivity();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.activity = input.Activity;\r\n\t\tresult.count = input.Count;\r\n\t\tresult.isAggregate = input.IsAggregate;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"Activity\")\r\n\tpublic activity: string;\r\n\r\n\t// @SerializedName(\"Count\")\r\n\tpublic count: number;\r\n\r\n\t// @SerializedName(\"IsAggregate\")\r\n\tpublic isAggregate: boolean;\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\t// @Override\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.activity) || !isString(this.activity)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!isNumber(this.count) || this.count <= 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!isBoolean(this.isAggregate)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyEventCountedActivitySequence extends CampaignSurveyEvent {\r\n\tpublic static deserialize(input: any): CampaignSurveyEventCountedActivitySequence {\r\n\t\tconst result = new CampaignSurveyEventCountedActivitySequence();\r\n\t\tlet sequence: CampaignSurveyEventCountedActivity[] = [];\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfor (const key in input.Sequence) {\r\n\t\t\tif (input.Sequence.hasOwnProperty(key)) {\r\n\t\t\t\tconst readActivity: CampaignSurveyEventCountedActivity = input.Sequence[key];\r\n\r\n\t\t\t\tif (readActivity) {\r\n\t\t\t\t\tsequence.push(CampaignSurveyEventCountedActivity.deserialize(readActivity));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (sequence.length === 0) {\r\n\t\t\tsequence = null;\r\n\t\t}\r\n\r\n\t\tresult.sequence = sequence;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"Sequence\")\r\n\tpublic sequence: CampaignSurveyEventCountedActivity[];\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\t// @Override\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.sequence)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfor (const key in this.sequence) {\r\n\t\t\tif (this.sequence.hasOwnProperty(key) && !this.sequence[key]) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n// endregion\r\n\r\n// region Survey Content Definitions\r\n\r\nexport class CampaignSurveyContent {\r\n\tpublic static deserialize(input: any, optionalComponents?: boolean): CampaignSurveyContent {\r\n\t\tconst result = new CampaignSurveyContent();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.prompt = CampaignSurveyContentPrompt.deserialize(input.Prompt);\r\n\t\tresult.rating = CampaignSurveyContentRating.deserialize(input.Rating);\r\n\t\tresult.comment = CampaignSurveyContentComment.deserialize(input.Question);\r\n\t\tresult.multipleChoice = CampaignSurveyContentMultipleChoice.deserialize(input.MultipleChoice);\r\n\t\tresult.intercept = CampaignSurveyContentIntercept.deserialize(input.Intercept);\r\n\t\tresult.cvSurvey = CampaignSurveyContentCVSurvey.deserialize(input.CVSurveyParams);\r\n\r\n\t\tif (!result.validate(optionalComponents)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"CVSurvey\")\r\n\tpublic cvSurvey: CampaignSurveyContentCVSurvey;\r\n\r\n\t// @SerializedName(\"Prompt\")\r\n\tpublic prompt: CampaignSurveyContentPrompt;\r\n\r\n\t// @SerializedName(\"Rating\")\r\n\tpublic rating: CampaignSurveyContentRating;\r\n\r\n\t// @SerializedName(\"Question\")\r\n\tpublic comment: CampaignSurveyContentComment;\r\n\r\n\t// @SerializedName(\"MultipleChoice\")\r\n\tpublic multipleChoice: CampaignSurveyContentMultipleChoice;\r\n\r\n\t// @SerializedName(\"Intercept\")\r\n\tpublic intercept: CampaignSurveyContentIntercept;\r\n\r\n\tpublic validate(optionalComponents?: boolean): boolean {\r\n\t\tif (!isNOU(this.intercept)) {\r\n\t\t\t// An intercept survey only requires intercept.\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.prompt)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (optionalComponents) {\r\n\t\t\treturn !isNOU(this.rating) ||\r\n\t\t\t\t!isNOU(this.multipleChoice) ||\r\n\t\t\t\t!isNOU(this.comment);\r\n\t\t}\r\n\r\n\t\treturn !isNOU(this.rating) && !isNOU(this.comment);\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyContentMultipleChoice {\r\n\tpublic static deserialize(input: any): CampaignSurveyContentMultipleChoice {\r\n\t\tconst result = new CampaignSurveyContentMultipleChoice();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.question = input.Question;\r\n\t\tresult.availableOptions = input.AvailableOptions;\r\n\t\tresult.minNumberOfSelectedOptions = input.MinNumberOfSelectedOptions;\r\n\t\tresult.maxNumberOfSelectedOptions = input.MaxNumberOfSelectedOptions;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"Question\")\r\n\tpublic question: string;\r\n\r\n\t// @SerializedName(\"AvailableOptions\")\r\n\tpublic availableOptions: string[];\r\n\r\n\t// @SerializedName(\"MinNumberOfSelectedOptions\")\r\n\tpublic minNumberOfSelectedOptions: number;\r\n\r\n\t// @SerializedName(\"MaxNumberOfSelectedOptions\")\r\n\tpublic maxNumberOfSelectedOptions: number;\r\n\r\n\tprivate validate(): boolean {\r\n\t\tif (isNOU(this.question) || !isString(this.question) ||\r\n\t\t\tisNOU(this.availableOptions) || !Array.isArray(this.availableOptions) || this.availableOptions.length < 2 ||\r\n\t\t\tisNOU(this.minNumberOfSelectedOptions) || !isNumber(this.minNumberOfSelectedOptions) ||\r\n\t\t\tisNOU(this.maxNumberOfSelectedOptions) || !isNumber(this.maxNumberOfSelectedOptions)) {\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// expect all availableOptions values to be string\r\n\t\tfor (const key in this.availableOptions) {\r\n\t\t\tif (this.availableOptions.hasOwnProperty(key)) {\r\n\t\t\t\tif (!isString(this.availableOptions[key])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyContentCVSurvey {\r\n\tpublic static deserialize(input: any): CampaignSurveyContentCVSurvey {\r\n\t\tconst result = new CampaignSurveyContentCVSurvey();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.customerVoiceFormId = input.CustomerVoiceFormId;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"FormId\")\r\n\tpublic customerVoiceFormId: string;\r\n\r\n\tprivate validate(): boolean {\r\n\r\n\t\treturn (!isNOU(this.customerVoiceFormId) && isString(this.customerVoiceFormId));\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyContentPrompt {\r\n\tpublic static deserialize(input: any): CampaignSurveyContentPrompt {\r\n\t\tconst result = new CampaignSurveyContentPrompt();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.title = input.Title;\r\n\t\tresult.question = input.Question;\r\n\t\tresult.yesLabel = input.YesLabel;\r\n\t\tresult.noLabel = input.NoLabel;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"Title\")\r\n\tpublic title: string;\r\n\r\n\t// @SerializedName(\"Question\")\r\n\tpublic question: string;\r\n\r\n\t// @SerializedName(\"YesLabel\")\r\n\tpublic yesLabel: string;\r\n\r\n\t// @SerializedName(\"NoLabel\")\r\n\tpublic noLabel: string;\r\n\r\n\tprivate validate(): boolean {\r\n\t\tif (isNOU(this.title) || !isString(this.title) ||\r\n\t\t\tisNOU(this.question) || !isString(this.question) ||\r\n\t\t\tisNOU(this.yesLabel) || !isString(this.yesLabel) ||\r\n\t\t\tisNOU(this.noLabel) || !isString(this.noLabel)) {\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyContentIntercept {\r\n\tpublic static deserialize(input: any): CampaignSurveyContentIntercept {\r\n\t\tconst result = new CampaignSurveyContentIntercept();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.title = input.Title;\r\n\t\tresult.question = input.Question;\r\n\t\tresult.url = input.Url;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"Title\")\r\n\tpublic title: string;\r\n\r\n\t// @SerializedName(\"Question\")\r\n\tpublic question: string;\r\n\r\n\t// @SerializedName(\"Url\")\r\n\tpublic url: string;\r\n\r\n\tprivate validate(): boolean {\r\n\t\tif (isNOU(this.title) || !isString(this.title) ||\r\n\t\t\tisNOU(this.question) || !isString(this.question) ||\r\n\t\t\tisNOU(this.url) || !isString(this.url)) {\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyContentRating {\r\n\tpublic static deserialize(input: any): CampaignSurveyContentRating {\r\n\t\tconst result = new CampaignSurveyContentRating();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.isZeroBased = input.IsZeroBased;\r\n\t\tresult.question = input.Question;\r\n\t\tresult.ratingValuesAscending = input.RatingValuesAscending;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"IsZeroBased\")\r\n\tpublic isZeroBased: boolean;\r\n\r\n\t// @SerializedName(\"Question\")\r\n\tpublic question: string;\r\n\r\n\t// @SerializedName(\"RatingValuesAscending\")\r\n\tpublic ratingValuesAscending: string[];\r\n\r\n\tprivate validate(): boolean {\r\n\t\t// expect ratingValuesAscending to contain between 2 to 11 values\r\n\t\tif (isNOU(this.question) || !isString(this.question) ||\r\n\t\t\tisNOU(this.ratingValuesAscending) || !Array.isArray(this.ratingValuesAscending) ||\r\n\t\t\tthis.ratingValuesAscending.length < 2 || this.ratingValuesAscending.length > 11) {\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.isZeroBased)) {\r\n\t\t\t// default to false if not provided\r\n\t\t\tthis.isZeroBased = false;\r\n\t\t} else if (!isBoolean(this.isZeroBased)) {\r\n\t\t\t// fail validation if non boolean value is provided\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// expect all ratingValuesAscending values to be string\r\n\t\tfor (const key in this.ratingValuesAscending) {\r\n\t\t\tif (this.ratingValuesAscending.hasOwnProperty(key)) {\r\n\t\t\t\tif (!isString(this.ratingValuesAscending[key])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyContentComment {\r\n\tpublic static deserialize(input: any): CampaignSurveyContentComment {\r\n\t\tconst result = new CampaignSurveyContentComment();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// @SerializedName(\"Question\")\r\n\t\tresult.question = input.Question;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"Question\")\r\n\tpublic question: string;\r\n\r\n\tprivate validate(): boolean {\r\n\t\tif (isNOU(this.question) || !isString(this.question)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n// endregion\r\n\r\n// region Survey Metadata Definitions\r\n\r\nexport class CampaignSurveyMetadata {\r\n\tpublic static deserialize(input: any): CampaignSurveyMetadata {\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst result = new CampaignSurveyMetadata();\r\n\t\tresult.contentMetadata = input.ContentMetadata;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"ContentMetadata\")\r\n\tpublic contentMetadata: object;\r\n\r\n\tpublic validate(): boolean {\r\n\t\tif (isNOU(this.contentMetadata) || !Utils.isObject(this.contentMetadata)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n// endregion\r\n\r\n// region Survey Template definitions\r\n\r\nexport abstract class CampaignSurveyTemplate {\r\n\tpublic static deserialize(input: any): CampaignSurveyTemplate {\r\n\t\tlet result: CampaignSurveyTemplate;\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tswitch (input.Type) {\r\n\t\t\tcase CampaignSurveyTemplate.Type.Nps5PointStatic:\r\n\t\t\t\tresult = CampaignSurveyTemplateNps5PointStatic.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase CampaignSurveyTemplate.Type.Nps11PointStatic:\r\n\t\t\t\tresult = CampaignSurveyTemplateNps11PointStatic.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase CampaignSurveyTemplate.Type.Fps:\r\n\t\t\t\tresult = CampaignSurveyTemplateFps.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase CampaignSurveyTemplate.Type.Nlqs:\r\n\t\t\t\tresult = CampaignSurveyTemplateNlqs.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase CampaignSurveyTemplate.Type.Nps:\r\n\t\t\t\tresult = CampaignSurveyTemplateNps.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase CampaignSurveyTemplate.Type.GenericMessagingSurface:\r\n\t\t\t\tresult = CampaignSurveyTemplateGenericMessagingSurface.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase CampaignSurveyTemplate.Type.Intercept:\r\n\t\t\t\tresult = CampaignSurveyTemplateIntercept.deserialize(input);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (isNOU(result)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"ActivationEvent\")\r\n\tpublic activationEvent: CampaignSurveyEvent;\r\n\r\n\t// @SerializedName(\"Content\")\r\n\tpublic content: CampaignSurveyContent;\r\n\r\n\t// @SerializedName(\"Metadata\")\r\n\tpublic metadata: CampaignSurveyMetadata;\r\n\r\n\t// @SerializedName(\"MaxLaunches\")\r\n\tpublic maxLaunches: number;\r\n\r\n\t// @SerializedName(\"MaxLaunchesPerSession\")\r\n\tpublic maxLaunchesPerSession: number;\r\n\r\n\t// @SerializedName(\"PreferredLaunchType\")\r\n\tpublic preferredLaunchType: ISurveyInfo.LaunchType;\r\n\r\n\tprotected constructor() { }\r\n\r\n\tprotected validate(): boolean {\r\n\t\tif (isNOU(this.activationEvent)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport module CampaignSurveyTemplate {\r\n\texport const enum Type {\r\n\t\tNps5PointStatic = 0,\r\n\t\tNps11PointStatic = 1,\r\n\t\tFps = 2,\r\n\t\tNlqs = 3,\r\n\t\tNps = 4,\r\n\t\tIntercept = 5,\r\n\t\t// A generic messagibg surface template type, which will make use of\r\n\t\t// content metadata to render ui.\r\n\t\t// As of 4th Feb 2019 there are 20 template types defined in Mso,\r\n\t\t// hence giving 22 as value for this type.\r\n\t\tGenericMessagingSurface = 22,\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyTemplateFps extends CampaignSurveyTemplate {\r\n\tpublic static deserialize(input: any): CampaignSurveyTemplateFps {\r\n\t\tconst result = new CampaignSurveyTemplateFps();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.activationEvent = CampaignSurveyEvent.deserialize(input.ActivationEvent);\r\n\t\tresult.content = CampaignSurveyContent.deserialize(input.Content, true /* optionalComponents */);\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate() || isNOU(this.content)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyTemplateNlqs extends CampaignSurveyTemplate {\r\n\tpublic static deserialize(input: any): CampaignSurveyTemplateNlqs {\r\n\t\tconst result = new CampaignSurveyTemplateNlqs();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.activationEvent = CampaignSurveyEvent.deserialize(input.ActivationEvent);\r\n\t\tresult.content = CampaignSurveyContent.deserialize(input.Content);\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate() || isNOU(this.content)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyTemplateNps extends CampaignSurveyTemplate {\r\n\tpublic static deserialize(input: any): CampaignSurveyTemplateNps {\r\n\t\tconst result = new CampaignSurveyTemplateNps();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.activationEvent = CampaignSurveyEvent.deserialize(input.ActivationEvent);\r\n\t\tresult.content = CampaignSurveyContent.deserialize(input.Content);\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate() || isNOU(this.content)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyTemplateNps5PointStatic extends CampaignSurveyTemplate {\r\n\tpublic static deserialize(input: any): CampaignSurveyTemplateNps5PointStatic {\r\n\t\tconst result = new CampaignSurveyTemplateNps5PointStatic();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.activationEvent = CampaignSurveyEvent.deserialize(input.ActivationEvent);\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyTemplateNps11PointStatic extends CampaignSurveyTemplate {\r\n\tpublic static deserialize(input: any): CampaignSurveyTemplateNps11PointStatic {\r\n\t\tconst result = new CampaignSurveyTemplateNps11PointStatic();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.activationEvent = CampaignSurveyEvent.deserialize(input.ActivationEvent);\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprivate constructor() { super(); }\r\n\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyTemplateGenericMessagingSurface extends CampaignSurveyTemplate {\r\n\tpublic static deserialize(input: any): CampaignSurveyTemplateGenericMessagingSurface {\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst result = new CampaignSurveyTemplateGenericMessagingSurface();\r\n\t\tresult.activationEvent = CampaignSurveyEvent.deserialize(input.ActivationEvent);\r\n\t\tresult.metadata = CampaignSurveyMetadata.deserialize(input.Metadata);\r\n\t\tresult.maxLaunches = input.MaxLaunches;\r\n\t\tresult.maxLaunchesPerSession = input.MaxLaunchesPerSession;\r\n\t\tresult.preferredLaunchType = input.PreferredLaunchType;\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tpublic constructor() { super(); }\r\n\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate() || isNOU(this.metadata)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif ((!isNOU(this.maxLaunches) && (!isNumber(this.maxLaunches) || this.maxLaunches <= 0)) ||\r\n\t\t\t(!isNOU(this.maxLaunchesPerSession) && (!isNumber(this.maxLaunchesPerSession) || this.maxLaunchesPerSession <= 0))) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_LocalError(\"Invalid Multi Launch settings\", this.maxLaunches, this.maxLaunchesPerSession);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// check for valid values\r\n\t\tif (isNumber(this.maxLaunches) &&\r\n\t\t\tisNumber(this.maxLaunchesPerSession) &&\r\n\t\t\tthis.maxLaunchesPerSession > this.maxLaunches) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_LocalError(\"Invalid Multi launch settings\", this.maxLaunches, this.maxLaunchesPerSession);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!isNOU(this.preferredLaunchType) && !isString(this.preferredLaunchType)) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_LocalError(\"Invalid launcher type\", this.preferredLaunchType);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport class CampaignSurveyTemplateIntercept extends CampaignSurveyTemplate {\r\n\tpublic static deserialize(input: any): CampaignSurveyTemplateIntercept {\r\n\t\tconst result = new CampaignSurveyTemplateIntercept();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.activationEvent = CampaignSurveyEvent.deserialize(input.ActivationEvent);\r\n\t\tresult.content = CampaignSurveyContent.deserialize(input.Content);\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// public for UT only\r\n\tpublic constructor() { super(); }\r\n\r\n\tprotected validate(): boolean {\r\n\t\tif (!super.validate() || isNOU(this.content)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n// endregion\r\n\r\n// region Campaign Definition\r\n\r\nexport class CampaignDefinition {\r\n\t/**\r\n\t * Method to deserialize a JSON object to class object\r\n\t * @param input: JSON object\r\n\t * Returns result of validation check\r\n\t */\r\n\tpublic static deserialize(input: any): CampaignDefinition {\r\n\t\tconst result: CampaignDefinition = new CampaignDefinition();\r\n\r\n\t\tif (isNOU(input)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tresult.campaignId = input.CampaignId;\r\n\t\tresult.governedChannelType = input.GovernedChannelType;\r\n\t\tresult.startTime = input.StartTimeUtc;\r\n\t\tresult.endTime = input.EndTimeUtc;\r\n\t\tresult.launcherType = input.LauncherType;\r\n\t\tresult.primaryPriority = input.PrimaryPriority;\r\n\t\tresult.tags = input.Tags;\r\n\r\n\t\tconst additionalDataRequested: CampaignAdditionalDataRequested = CampaignAdditionalDataRequested.deserialize(\r\n\t\t\tinput.AdditionalDataRequested);\r\n\t\tresult.additionalDataRequested = additionalDataRequested ? additionalDataRequested.additionalData : [];\r\n\r\n\t\tif (input.SurveyTemplate) {\r\n\t\t\tresult.surveyTemplate = CampaignSurveyTemplate.deserialize(input.SurveyTemplate);\r\n\t\t}\r\n\r\n\t\tif (input.NominationScheme) {\r\n\t\t\tresult.nominationScheme = CampaignNominationScheme.deserialize(input.NominationScheme);\r\n\t\t}\r\n\r\n\t\tif (input.Scope) {\r\n\t\t\tresult.scope = CampaignScope.deserialize(input.Scope);\r\n\t\t}\r\n\r\n\t\tif (!isNOU(input.BusinessLevel)) {\r\n\t\t\tresult.businessLevel = input.BusinessLevel;\r\n\t\t}\r\n\r\n\t\tif (!result.validate()) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_LocalError(\"Invalid definition\", input);\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"CampaignId\")\r\n\tpublic campaignId: string;\r\n\r\n\t// @SerializedName(\"GovernedChannelType\")\r\n\tpublic governedChannelType: GovernedChannelType;\r\n\r\n\t// @SerializedName(\"Scope\")\r\n\tpublic scope: CampaignScope;\r\n\r\n\t// @SerializedName(\"NominationScheme\")\r\n\tpublic nominationScheme: CampaignNominationScheme;\r\n\r\n\t// @SerializedName(\"SurveyTemplate\")\r\n\tpublic surveyTemplate: CampaignSurveyTemplate;\r\n\r\n\t// @SerializedName(\"StartTimeUtc\")\r\n\tpublic startTime: Date;\r\n\r\n\t// @SerializedName(\"EndTimeUtc\")\r\n\tpublic endTime: Date;\r\n\r\n\t// @SerializedName(\"AdditionalDataRequested\")\r\n\tpublic additionalDataRequested: ISurveyInfo.AdditionalDataType[];\r\n\r\n\t// @SerializedName(\"LauncherType\")\r\n\tpublic launcherType: string;\r\n\r\n\t// @SerializedName(\"Priority\")\r\n\tpublic primaryPriority: number;\r\n\r\n\t// @SerializedName(\"Tags\")\r\n\tpublic tags: string[];\r\n\r\n\t// @SerializedName(\"BusinessLevel\")\r\n\tpublic businessLevel: BusinessLevel;\r\n\r\n\tpublic validate(): boolean {\r\n\t\tif (isNOU(this.scope)) {\r\n\t\t\tthis.scope = new CampaignScopeAny();\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.campaignId) || !isString(this.campaignId)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!isNumber(this.governedChannelType) || !Utils.isEnumValue(this.governedChannelType, GovernedChannelType)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.nominationScheme)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.surveyTemplate)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!isNOU(this.launcherType) && !isString(this.launcherType)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (this.launcherType === \"customervoice\" && isNOU(this.surveyTemplate.content?.cvSurvey?.customerVoiceFormId)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!isNOU(this.primaryPriority) && !isNumber(this.primaryPriority)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (this.tags && !Array.isArray(this.tags)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Campaigns with no start date are effectively disabled, in fact, this is the supported way to stage a definition but have it be turned off\r\n\t\tif (isNOU(this.startTime)) {\r\n\t\t\tthis.startTime = getDistantFuture();\r\n\t\t} else if (isUtcDatetimeString(this.startTime)) {\r\n\t\t\tthis.startTime = stringToDate(this.startTime);\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Campaigns with no end date are effectively on indefinitely\r\n\t\tif (isNOU(this.endTime) ||\r\n\t\t\t(typeof(this.endTime) === \"string\" && this.endTime === \"\")) {\r\n\t\t\tthis.endTime = getDistantFuture();\r\n\t\t} else if (isUtcDatetimeString(this.endTime)) {\r\n\t\t\tthis.endTime = stringToDate(this.endTime);\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * Given an array of campaign definitions, returns the valid ones and errors if any are invalid.\r\n * @param input: JSON object\r\n * Returns the valid definitions and the error as string if any.\r\n */\r\nexport function FilterValidCampaignDefinitions(campaignDefinitions: any): { result: CampaignDefinition[], error: string } {\r\n\tconst result: CampaignDefinition[] = [];\r\n\r\n\tif (isNOU(campaignDefinitions)) {\r\n\t\treturn { result, error: \"Empty\" };\r\n\t}\r\n\r\n\tif (!Array.isArray(campaignDefinitions)) {\r\n\t\treturn { result, error: \"Not an array\" };\r\n\t}\r\n\r\n\tconst badIndexes: number[] = [];\r\n\tfor (let i = 0; i < campaignDefinitions.length; i++) {\r\n\t\tconst definition: any = campaignDefinitions[i];\r\n\r\n\t\tif (definition) {\r\n\t\t\tconst newDefinition: CampaignDefinition = CampaignDefinition.deserialize(definition);\r\n\r\n\t\t\tnewDefinition\r\n\t\t\t\t? result.push(newDefinition)\r\n\t\t\t\t: badIndexes.push(i);\r\n\t\t} else {\r\n\t\t\tbadIndexes.push(i);\r\n\t\t}\r\n\t}\r\n\r\n\tconst error: string = badIndexes.length > 0 ? \"Invalid campaign definitions at indexes: \" + badIndexes.toString() : undefined;\r\n\treturn { result, error };\r\n}\r\n\r\n// endregion\r\n\r\nexport interface ICampaignDefinitionProvider {\r\n\tload(): CampaignDefinition[];\r\n\tloadAsync(): Promise<CampaignDefinition[]>;\r\n}\r\n\r\nexport class FileSystemCampaignDefinitionProvider implements ICampaignDefinitionProvider {\r\n\tprivate storage: IFloodgateStorageProvider;\r\n\r\n\tpublic constructor(storage: IFloodgateStorageProvider) {\r\n\t\tif (isNOU(storage)) {\r\n\t\t\tthrow new Error(\"storage must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.storage = storage;\r\n\t}\r\n\r\n\tpublic load(): CampaignDefinition[] {\r\n\t\tconst definitionString: string = this.storage.read(IFloodgateStorageProvider.FileType.CampaignDefinitions);\r\n\t\tif (isNOU(definitionString)) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\tlet readDefinitions: any;\r\n\r\n\t\ttry {\r\n\t\t\treadDefinitions = JSON.parse(definitionString);\r\n\t\t} catch (e) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed(e.toString());\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\t// This ignores errors in validation for now.\r\n\t\treturn FilterValidCampaignDefinitions(readDefinitions).result;\r\n\t}\r\n\r\n\tpublic loadAsync(): Promise<CampaignDefinition[]> {\r\n\t\tconst definitions = this.load();\r\n\t\treturn new Promise(\r\n\t\t\tfunction onFulfilled(resolve, reject) {\r\n\t\t\t\tresolve(definitions);\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n}\r\n","/**\r\n * Parent module for all modules in Api/\r\n */\r\n\r\nimport * as ISurveyInfo from \"./../ISurveyInfo\";\r\nimport * as IActivityListener from \"./IActivityListener\";\r\nimport * as IFloodgateSettingIdMap from \"./IFloodgateSettingIdMap\";\r\nimport * as IFloodgateStorageProvider from \"./IFloodgateStorageProvider\";\r\nimport * as IFloodgateStringProvider from \"./IFloodgateStringProvider\";\r\nimport * as ISurvey from \"./ISurvey\";\r\nimport * as ISurveyComponent from \"./ISurveyComponent\";\r\n\r\nexport { CampaignDefinition } from \"../Campaign/CampaignDefinitionProvider\";\r\nexport { IActivityListener };\r\nexport { IAssetsProvider } from \"./IAssetsProvider\";\r\nexport { IAugLoopCallback } from \"./IAugLoopCallback\";\r\nexport { IBpsSurvey } from \"./IBpsSurvey\";\r\nexport { ICampaignDefinitionProvider } from \"../Campaign/CampaignDefinitionProvider\";\r\nexport { ICommentComponent } from \"./ICommentComponent\";\r\nexport { ICVSurveyComponent } from \"./ICVSurveyComponent\";\r\nexport { IDataProvider } from \"./IDataProvider\";\r\nexport { IFeedbackSurvey } from \"./IFeedbackSurvey\";\r\nexport { IFloodgateAuthTokenCallback } from \"./IFloodgateAuthTokenCallback\";\r\nexport { IFloodgateEnvironmentProvider } from \"./IFloodgateEnvironmentProvider\";\r\nexport { IFloodgateSettingStorageCallback } from \"./IFloodgateSettingStorageCallback\";\r\nexport { IFloodgateStorageProvider };\r\nexport { IFloodgateStringProvider };\r\nexport { IFloodgateSettingIdMap };\r\nexport { IFloodgateTelemetryLogger } from \"./IFloodgateTelemetryLogger\";\r\nexport { IFpsSurvey } from \"./IFpsSurvey\";\r\nexport { INpsSurvey } from \"./INpsSurvey\";\r\nexport { IInterceptSurvey } from \"./IInterceptSurvey\";\r\nexport { IOnSurveyActivatedCallback } from \"./IOnSurveyActivatedCallback\";\r\nexport { IPromptComponent } from \"./IPromptComponent\";\r\nexport { IInterceptComponent } from \"./IInterceptComponent\";\r\nexport { IPsatSurvey } from \"./IPsatSurvey\";\r\nexport { IRatingComponent } from \"./IRatingComponent\";\r\nexport { IFloodgateSetting } from \"./IFloodgateSetting\";\r\nexport { ISurvey };\r\nexport { ISurveyComponent };\r\nexport { ISurveyDomWriter } from \"./ISurveyDomWriter\";\r\nexport { ISurveyForm } from \"./ISurveyForm\";\r\nexport { ISurveyJsonWriter } from \"./ISurveyJsonWriter\";\r\nexport { ISurveyInfo };\r\nexport { ISurveyLauncher } from \"./ISurveyLauncher\";\r\nexport { ISurveyLauncherFactory } from \"./ISurveyLauncherFactory\";\r\nexport { ITelemetryProperties } from \"./ITelemetryProperties\";\r\nexport { ITransporter } from \"./ITransporter\";\r\nexport { ITransporterFactory } from \"./ITransporterFactory\";\r\nexport { IUserFact } from \"../UserFact/IUserFact\";\r\nexport { IUserFactProvider } from \"./IUserFactProvider\";\r\nexport { IGovernanceServiceClient } from \"./IGovernanceServiceClient\";\r\nexport { IPersonalizerClient } from \"./IPersonalizerClient\";\r\n","import { ISurveyDomWriter } from \"./Api/ISurveyDomWriter\";\r\nimport { ISurveyJsonWriter } from \"./Api/ISurveyJsonWriter\";\r\nimport { GovernedChannelType } from \"./GovernedChannel\";\r\nimport * as ISurveyEvent from \"./ISurveyEvent\";\r\nimport { ISurveyMetadata } from \"./ISurveyMetadata\";\r\n\r\n/**\r\n * Interface that can be used to access the basics of a Survey\r\n */\r\ninterface ISurveyInfo extends ISurveyDomWriter, ISurveyJsonWriter {\r\n\t/**\r\n\t * A globally unique, but otherwise opaque, identity for this particular survey\r\n\t */\r\n\tgetId(): string;\r\n\r\n\t/**\r\n\t * A globally unique, but otherwise opaque, identity for this particular survey on the OCV backend\r\n\t * May be the same, or different than getId\r\n\t */\r\n\tgetBackEndId(): string;\r\n\r\n\t/**\r\n\t * The goverend channel that this survey will be delivered/filtered through\r\n\t */\r\n\tgetGovernedChannelType(): GovernedChannelType;\r\n\r\n\t/**\r\n\t * The raw string provided as the survey's start date, with no error checking\r\n\t */\r\n\tgetRawStartTimeUtc(): string;\r\n\r\n\t/**\r\n\t * The start time, in UTC, of this Survey.  Before the client has passed this date\r\n\t * the survey will won't be loaded into the survey activity listener.\r\n\t * If no start date is given, returns distantPast.\r\n\t * If bad start date given, returns distantFuture\r\n\t * Otherwise, returns date\r\n\t */\r\n\tgetStartTimeUtc(): Date;\r\n\r\n\t/**\r\n\t * The expiration time, in UTC, of this Survey. Once the client has passed this date, it should clean any\r\n\t * cached data, and should reject any incoming surveys that have otherwise expired but are still active\r\n\t * in the flighting system\r\n\t * If no/bad expiration date given, returns distantPast to make sure this survey is always expired.\r\n\t */\r\n\tgetExpirationTimeUtc(): Date;\r\n\r\n\t/**\r\n\t * The expiration time, in UTC, of this Survey.  Once the client has passed this date, it should clean any\r\n\t * cached data, and should reject any incoming surveys that have otherwise expired but are still active\r\n\t * in the flighting system\r\n\t */\r\n\tgetRawExpirationTimeUtc(): string;\r\n\r\n\t/**\r\n\t * Returns whether or not the 'date' is between the start/expiration dates for this survey.\r\n\t */\r\n\tisActiveForDate(date: Date): boolean;\r\n\r\n\t/**\r\n\t * Gets the activation event that should be plumbed through to the FloodgateEngine/SurveyActiviytListener.\r\n\t * When activated, this survey should be shown to the user.\r\n\t */\r\n\tgetActivationEvent(): ISurveyEvent;\r\n\r\n\t/**\r\n\t * Gets the preferred launch mechanism based on this survey's data payload.  This may or may not be\r\n\t * respected by the LauncherFactory depending on the platform and implementation, and is strictly considered\r\n\t * a behavioral hint\r\n\t */\r\n\tgetPreferredLaunchType(): ISurveyInfo.LaunchType;\r\n\r\n\t/**\r\n\t * Return additionalDataRequested array\r\n\t */\r\n\tisAdditionalDataRequested(additionalData: ISurveyInfo.AdditionalDataType): boolean;\r\n\r\n\t/**\r\n\t * Return the launcher type string\r\n\t */\r\n\tgetLauncherType(): string;\r\n\r\n\t/**\r\n\t * Gets the metadata of the survey, this is optional but if available it can be used by launcher to\r\n\t * make appropriate decisions while launching a surface.\r\n\t */\r\n\tgetMetadata(): ISurveyMetadata;\r\n\r\n\t/**\r\n\t * Returns businessLevel\r\n\t */\r\n\tgetBusinessLevel(): ISurveyInfo.BusinessLevel;\r\n\r\n\t/**\r\n\t * Returns maxLaunches\r\n\t */\r\n\tgetMaxLaunches(): number;\r\n\r\n\t/**\r\n\t * Returns maxLaunches Per session\r\n\t */\r\n\tgetMaxLaunchesPerSession(): number;\r\n}\r\n\r\nmodule ISurveyInfo {\r\n\texport const enum LaunchType {\r\n\t\t// No launch type specified, defer to the launcher factory code\r\n\t\tDefault = \"Default\",\r\n\t\t// Prefer a notification-based launcher (like the windows toast launcher when present)\r\n\t\tNotification = \"Notification\",\r\n\t\t// Prefer a modal-dialog based launcher\r\n\t\tModal = \"Modal\",\r\n\t}\r\n\r\n\texport enum BusinessLevel {\r\n\t\tNone = 0,\r\n\t\tCritical,\r\n\t}\r\n\r\n\texport const enum AdditionalDataType {\r\n\t\t// Request email address\r\n\t\tEmailAddress,\r\n\t}\r\n\r\n\texport const DOM_TYPE_TAGNAME = \"Type\";\r\n\texport const DOM_TYPE_VALUE = \"Survey\";\r\n\texport const DOM_ID_TAGNAME = \"SurveyID\";\r\n\texport const JSON_SURVEY_KEYNAME = \"survey\";\r\n\texport const JSON_ID_KEYNAME = \"surveyId\";\r\n}\r\n\r\nexport = ISurveyInfo;\r\n","import { SurveyActivationStats, SurveyStatCollectionActivation } from \"../src/SurveyStatCollectionActivation\";\r\nimport { CampaignState } from \"./Campaign/CampaignStateProvider\";\r\nimport { IDictionary } from \"./Common\";\r\nimport { GovernedChannelState } from \"./GovernedChannelStateProvider\";\r\n\r\n/**\r\n * Values for the state list types\r\n */\r\nexport const enum StateListType {\r\n\tMerged,\r\n\tToBeUpdated,\r\n}\r\n\r\nexport interface IKeyedCollection<T> {\r\n\tadd(key: number, value: T);\r\n\tfind(key: number): T;\r\n\tremove(key: number);\r\n\tcount(): number;\r\n}\r\n\r\nexport class ItemCollection<T> implements IKeyedCollection<T> {\r\n\tprivate items: { [key: number]: T } = {};\r\n\tprivate itemCount: number = 0;\r\n\r\n\tpublic add(key: number, value: T) {\r\n\t\tif (!this.items[key]) {\r\n\t\t\tthis.itemCount++;\r\n\t\t}\r\n\t\tthis.items[key] = value;\r\n\t}\r\n\r\n\tpublic find(key: number): T {\r\n\t\treturn this.items[key];\r\n\t}\r\n\r\n\tpublic remove(key: number): T {\r\n\t\tconst item: T = this.items[key];\r\n\r\n\t\tif (item) {\r\n\t\t\tdelete this.items[key];\r\n\t\t\tthis.itemCount--;\r\n\t\t}\r\n\r\n\t\treturn item;\r\n\t}\r\n\r\n\tpublic count(): number {\r\n\t\treturn this.itemCount;\r\n\t}\r\n}\r\n\r\nexport function extractSettingItemValueSubString(itemValue: string): string {\r\n\tif (!itemValue) {\r\n\t\treturn itemValue;\r\n\t}\r\n\r\n\tconst beginPos: number = itemValue.indexOf(SETTING_DATA_OPEN_TAG) + SETTING_DATA_OPEN_TAG.length;\r\n\tconst endPos: number = itemValue.indexOf(SETTING_DATA_CLOSE_TAG);\r\n\r\n\tif (beginPos < 0 || endPos < 0) {\r\n\t\treturn itemValue;\r\n\t}\r\n\r\n\treturn itemValue.substring(beginPos, endPos);\r\n}\r\n\r\nexport function makeSettingItemValue(value: string): string {\r\n\tif (!value) {\r\n\t\treturn SETTING_DATA_OPEN_TAG + SETTING_DATA_CLOSE_TAG;\r\n\t}\r\n\r\n\treturn SETTING_DATA_OPEN_TAG + value + SETTING_DATA_CLOSE_TAG;\r\n}\r\n\r\nexport function MergeAndUpdateGovernedChannelStates(previousStates: GovernedChannelState[],\r\n\tcurrentStates: GovernedChannelState[]): IKeyedCollection<GovernedChannelState[]> {\r\n\tconst stateCollections: IKeyedCollection<GovernedChannelState[]> = new ItemCollection<GovernedChannelState[]>();\r\n\r\n\t// Todo: move the following into a generic method to be shared\r\n\tif (!previousStates && !currentStates) {\r\n\t\treturn stateCollections;\r\n\t}\r\n\r\n\tif (!previousStates) {\r\n\t\tstateCollections.add(StateListType.Merged, currentStates);\r\n\t\treturn stateCollections;\r\n\t}\r\n\r\n\tif (!currentStates) {\r\n\t\tstateCollections.add(StateListType.Merged, previousStates);\r\n\t\tstateCollections.add(StateListType.ToBeUpdated, previousStates);\r\n\t\treturn stateCollections;\r\n\t}\r\n\r\n\tconst mergedStates: GovernedChannelState[] = [];\r\n\tconst toBeUpdatedStates: GovernedChannelState[] = [];\r\n\r\n\tif (previousStates) {\r\n\t\tpreviousStates.forEach((previousState) => {\r\n\t\t\t// find matching in current states\r\n\t\t\tlet pos = -1;\r\n\t\t\tlet currentState: GovernedChannelState;\r\n\t\t\tfor (let i = 0; i < currentStates.length; i++) {\r\n\t\t\t\tcurrentState = currentStates[i];\r\n\t\t\t\tif (currentState.getType() === previousState.getType()) {\r\n\t\t\t\t\tpos = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// if previous state is not in current states\r\n\t\t\tif (pos === -1) {\r\n\t\t\t\t// add previous state to merged\r\n\t\t\t\tmergedStates.push(previousState);\r\n\r\n\t\t\t\t// add previous state to toUpdated\r\n\t\t\t\ttoBeUpdatedStates.push(previousState);\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// if ActivationTimeUtc of previous is greater than current\r\n\t\t\tif (previousState.getCooldownStartTime() > currentState.getCooldownStartTime()) {\r\n\t\t\t\t// add previous state to merged\r\n\t\t\t\tmergedStates.push(previousState);\r\n\r\n\t\t\t\t// add previous state to toUpdated\r\n\t\t\t\ttoBeUpdatedStates.push(previousState);\r\n\t\t\t} else {\r\n\t\t\t\t// add current state to merged\r\n\t\t\t\tmergedStates.push(currentState);\r\n\t\t\t}\r\n\r\n\t\t\t// remove state from current states\r\n\t\t\tcurrentStates.splice(pos, 1);\r\n\t\t});\r\n\t}\r\n\r\n\t// for the remaining current states\r\n\tif (currentStates) {\r\n\t\tcurrentStates.forEach((currentState) => {\r\n\t\t\t// add current state to merged\r\n\t\t\tmergedStates.push(currentState);\r\n\t\t});\r\n\t}\r\n\r\n\tstateCollections.add(StateListType.Merged, mergedStates);\r\n\r\n\tif (toBeUpdatedStates.length > 0) {\r\n\t\tstateCollections.add(StateListType.ToBeUpdated, toBeUpdatedStates);\r\n\t}\r\n\r\n\treturn stateCollections;\r\n}\r\n\r\nexport function MergeAndUpdateCampaignStates(previousStates: CampaignState[],\r\n\tcurrentStates: CampaignState[]): IKeyedCollection<CampaignState[]> {\r\n\tconst stateCollections: IKeyedCollection<CampaignState[]> = new ItemCollection<CampaignState[]>();\r\n\r\n\tif (!previousStates && !currentStates) {\r\n\t\treturn stateCollections;\r\n\t}\r\n\r\n\tif (!previousStates) {\r\n\t\tstateCollections.add(StateListType.Merged, currentStates);\r\n\t\treturn stateCollections;\r\n\t}\r\n\r\n\tif (!currentStates) {\r\n\t\tstateCollections.add(StateListType.Merged, previousStates);\r\n\t\tstateCollections.add(StateListType.ToBeUpdated, previousStates);\r\n\t\treturn stateCollections;\r\n\t}\r\n\r\n\tconst mergedStates: CampaignState[] = [];\r\n\tconst toBeUpdatedStates: CampaignState[] = [];\r\n\r\n\tif (previousStates) {\r\n\t\tpreviousStates.forEach((previousState) => {\r\n\t\t\tconst current = new Date();\r\n\r\n\t\t\t// find matching in current states\r\n\t\t\tlet pos = -1;\r\n\t\t\tlet currentState: CampaignState;\r\n\t\t\tfor (let i = 0; i < currentStates.length; i++) {\r\n\t\t\t\tcurrentState = currentStates[i];\r\n\t\t\t\tif (currentState.CampaignId === previousState.CampaignId) {\r\n\t\t\t\t\tpos = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// if previous state is not in current states\r\n\t\t\tif (pos === -1) {\r\n\t\t\t\t// add previous state to merged\r\n\t\t\t\tmergedStates.push(previousState);\r\n\r\n\t\t\t\t// add previous state to toUpdated\r\n\t\t\t\ttoBeUpdatedStates.push(previousState);\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// if current state is in cooldown, add to merged list\r\n\t\t\tif (currentState.LastCooldownEndTimeUtc > current) {\r\n\t\t\t\t// add previous state to merged list\r\n\t\t\t\tmergedStates.push(currentState);\r\n\r\n\t\t\t\t// emove state from current states\r\n\t\t\t\tcurrentStates.splice(pos, 1);\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// if previous state is in cooldown, add to merged and toUpdated lists\r\n\t\t\tif (previousState.LastCooldownEndTimeUtc > current) {\r\n\t\t\t\t// add previous state to merged list\r\n\t\t\t\tmergedStates.push(previousState);\r\n\r\n\t\t\t\t// add previous state to to-be-updated list\r\n\t\t\t\ttoBeUpdatedStates.push(previousState);\r\n\r\n\t\t\t\t// emove state from current states\r\n\t\t\t\tcurrentStates.splice(pos, 1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// add previous state to toUpdated and merged for the following two conditions:\r\n\t\t\t//  1. previous cooldown time wins, or\r\n\t\t\t//  2. cooldown times are the same and previous nomination wins\r\n\t\t\tif (previousState.getCooldownStartDate() > currentState.getCooldownStartDate()\r\n\t\t\t\t|| (previousState.getCooldownStartDate() === currentState.getCooldownStartDate()\r\n\t\t\t\t\t&& previousState.LastNominationTimeUtc > currentState.LastNominationTimeUtc)\r\n\t\t\t) {\r\n\t\t\t\tmergedStates.push(previousState);\r\n\r\n\t\t\t\ttoBeUpdatedStates.push(previousState);\r\n\t\t\t} else {\r\n\t\t\t\t// add current state to merged\r\n\t\t\t\tmergedStates.push(currentState);\r\n\t\t\t}\r\n\r\n\t\t\t// remove state from current states\r\n\t\t\tcurrentStates.splice(pos, 1);\r\n\t\t});\r\n\t}\r\n\r\n\t// for the remaining current states\r\n\tif (currentStates) {\r\n\t\tcurrentStates.forEach((current) => {\r\n\t\t\t// add current state to merged\r\n\t\t\tmergedStates.push(current);\r\n\t\t});\r\n\t}\r\n\r\n\tstateCollections.add(StateListType.Merged, mergedStates);\r\n\r\n\tif (toBeUpdatedStates.length > 0) {\r\n\t\tstateCollections.add(StateListType.ToBeUpdated, toBeUpdatedStates);\r\n\t}\r\n\r\n\treturn stateCollections;\r\n}\r\n\r\nexport function MergeAndUpdateSurveyActivationStats(previousStats: SurveyStatCollectionActivation,\r\n\tcurrentStats: SurveyStatCollectionActivation): IKeyedCollection<SurveyStatCollectionActivation> {\r\n\r\n\tconst statsCollections: IKeyedCollection<SurveyStatCollectionActivation> = new ItemCollection<SurveyStatCollectionActivation>();\r\n\r\n\t// Handle previousStats and/or currentStats equal to null\r\n\tif (!previousStats && !currentStats) {\r\n\t\treturn statsCollections;\r\n\t}\r\n\r\n\tif (!previousStats) {\r\n\t\tstatsCollections.add(StateListType.Merged, currentStats);\r\n\t\treturn statsCollections;\r\n\t}\r\n\r\n\tif (!currentStats) {\r\n\t\tstatsCollections.add(StateListType.Merged, previousStats);\r\n\t\tstatsCollections.add(StateListType.ToBeUpdated, previousStats);\r\n\t\treturn statsCollections;\r\n\t}\r\n\r\n\t// Enumerate preivous stats\r\n\tconst mergedStats: SurveyStatCollectionActivation = new SurveyStatCollectionActivation();\r\n\tconst toBeUpdatedStats: SurveyStatCollectionActivation = new SurveyStatCollectionActivation();\r\n\r\n\tconst previousStatsDictionary: IDictionary<SurveyActivationStats> = previousStats.getStats();\r\n\tconst currentStatsDictionary: IDictionary<SurveyActivationStats> = currentStats.getStats();\r\n\r\n\tfor (const surveyId in previousStatsDictionary) {\r\n\t\tif (previousStatsDictionary.hasOwnProperty(surveyId)) {\r\n\t\t\t// if an updated stat is not found\r\n\t\t\tconst currentActivationStats: SurveyActivationStats = currentStatsDictionary[surveyId];\r\n\t\t\tif (!currentActivationStats) {\r\n\t\t\t\t// add to merged collection\r\n\t\t\t\tmergedStats.addStats(surveyId, previousStatsDictionary[surveyId]);\r\n\t\t\t\t// add to-be-updated collection\r\n\t\t\t\ttoBeUpdatedStats.addStats(surveyId, previousStatsDictionary[surveyId]);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t// if previous stat has higher activation time\r\n\t\t\tconst previousActivationStats: SurveyActivationStats = previousStatsDictionary[surveyId];\r\n\t\t\tif (previousActivationStats.ActivationTimeUtc > currentActivationStats.ActivationTimeUtc) {\r\n\t\t\t\t// add to merged collection\r\n\t\t\t\tmergedStats.addStats(surveyId, previousStatsDictionary[surveyId]);\r\n\t\t\t\t// add to-be-updated collection\r\n\t\t\t\ttoBeUpdatedStats.addStats(surveyId, previousStatsDictionary[surveyId]);\r\n\t\t\t} else {\r\n\t\t\t\t// add to current stat merged collection\r\n\t\t\t\tmergedStats.addStats(surveyId, currentStatsDictionary[surveyId]);\r\n\t\t\t}\r\n\r\n\t\t\t// delete from stats\r\n\t\t\tdelete currentStatsDictionary[surveyId];\r\n\t\t}\r\n\t}\r\n\r\n\t// merge any remaining stats\r\n\tfor (const surveyId in currentStatsDictionary) {\r\n\t\tif (currentStatsDictionary.hasOwnProperty(surveyId)) {\r\n\t\t\tmergedStats.addStats(surveyId, currentStatsDictionary[surveyId]);\r\n\t\t}\r\n\t}\r\n\r\n\t// always return merged list\r\n\tstatsCollections.add(StateListType.Merged, mergedStats);\r\n\r\n\t// since dictionaries don't have an empty check, enumerate the  first entry to check for non-empty\r\n\tconst toBeUpdatedStatsDictionary: IDictionary<SurveyActivationStats> = toBeUpdatedStats.getStats();\r\n\tfor (const toBeUpdated in toBeUpdatedStatsDictionary) {\r\n\t\tif (toBeUpdatedStatsDictionary.hasOwnProperty(toBeUpdated)) {\r\n\t\t\t// not empty, return to-be-updated\r\n\t\t\tstatsCollections.add(StateListType.ToBeUpdated, toBeUpdatedStats);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn statsCollections;\r\n}\r\n\r\nconst SETTING_DATA_OPEN_TAG = \"<data>\";\r\nconst SETTING_DATA_CLOSE_TAG = \"</data>\";\r\n","import { ICommentComponent } from \"./../Api/ICommentComponent\";\r\nimport ISurveyComponent = require(\"./../Api/ISurveyComponent\");\r\n\r\nclass CommentComponent implements ICommentComponent {\r\n\tpublic static make(data: CommentComponent.CommentComponentData): ICommentComponent {\r\n\t\ttry {\r\n\t\t\treturn new CommentComponent(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate data: CommentComponent.CommentComponentData;\r\n\tprivate userComment: string;\r\n\r\n\tpublic constructor(data: CommentComponent.CommentComponentData) {\r\n\t\tif (!data) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\t\tif (!data.question) {\r\n\t\t\tthrow new Error(\"data.question must not be null or empty\");\r\n\t\t}\r\n\r\n\t\tthis.data = data;\r\n\t\tthis.userComment = \"\";\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getType(): ISurveyComponent.Type {\r\n\t\treturn ISurveyComponent.Type.Comment;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getQuestion(): string {\r\n\t\treturn this.data.question;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic setSubmittedText(userComment: string): void {\r\n\t\tthis.userComment = userComment;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getSubmittedText(): string {\r\n\t\treturn this.userComment;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getDomElements(doc: Document): Element[] {\r\n\t\tif (!doc) {\r\n\t\t\tthrow new Error(\"Document must not be null\");\r\n\t\t}\r\n\r\n\t\tconst element: Element = doc.createElement(ISurveyComponent.DOM_COMMENT_TAGNAME);\r\n\t\telement.appendChild(doc.createTextNode(this.getSubmittedText()));\r\n\r\n\t\treturn [element];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\tconst result: object = {};\r\n\t\tresult[ISurveyComponent.JSON_COMMENT_KEYNAME] = this.getSubmittedText();\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getComponentJson(): object {\r\n\t\treturn {\r\n\t\t\t[ISurveyComponent.JSON_QUESTION_KEYNAME]: this.getQuestion(),\r\n\t\t};\r\n\t}\r\n}\r\n\r\nmodule CommentComponent {\r\n\texport class CommentComponentData {\r\n\t\tpublic question: string;\r\n\t}\r\n}\r\n\r\nexport = CommentComponent;\r\n","import * as ISurveyComponent from \"../Api/ISurveyComponent\";\r\nimport * as IPrompt from \"./../Api/IPrompt\";\r\nimport { IPromptComponent } from \"./../Api/IPromptComponent\";\r\n\r\nclass PromptComponent implements IPromptComponent {\r\n\tpublic static make(data: PromptComponent.PromptComponentData): IPromptComponent {\r\n\t\ttry {\r\n\t\t\treturn new PromptComponent(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate data: PromptComponent.PromptComponentData;\r\n\tprivate selectedButton: IPrompt.PromptButton;\r\n\r\n\tpublic constructor(data: PromptComponent.PromptComponentData) {\r\n\t\tif (!data) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\t\tif (!data.question) {\r\n\t\t\tthrow new Error(\"data.question must not be null or empty\");\r\n\t\t}\r\n\t\tif (!data.title) {\r\n\t\t\tthrow new Error(\"data.title must not be null or empty\");\r\n\t\t}\r\n\t\tif (!data.yesButtonLabel) {\r\n\t\t\tthrow new Error(\"data.yesButtonLabel must not be null or empty\");\r\n\t\t}\r\n\t\tif (!data.noButtonLabel) {\r\n\t\t\tthrow new Error(\"data.noButtonLabel must not be null or empty\");\r\n\t\t}\r\n\r\n\t\tthis.data = data;\r\n\t\tthis.selectedButton = IPrompt.PromptButton.Unselected;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getType(): ISurveyComponent.Type {\r\n\t\treturn ISurveyComponent.Type.Prompt;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getTitle(): string {\r\n\t\treturn this.data.title;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getQuestion(): string {\r\n\t\treturn this.data.question;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getYesButtonText(): string {\r\n\t\treturn this.data.yesButtonLabel;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getNoButtonText(): string {\r\n\t\treturn this.data.noButtonLabel;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic setButtonSelected(selected: IPrompt.PromptButton): void {\r\n\t\tif (selected) {\r\n\t\t\tthis.selectedButton = selected;\r\n\t\t}\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getButtonSelected(): IPrompt.PromptButton {\r\n\t\treturn this.selectedButton;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getDomElements(doc: Document): Element[]  {\r\n\t\tif (!doc) {\r\n\t\t\tthrow new Error(\"Document must not be null\");\r\n\t\t}\r\n\r\n\t\tconst element: Element = doc.createElement(ISurveyComponent.DOM_PROMPT_TAGNAME);\r\n\t\telement.appendChild(doc.createTextNode(this.promptButtonToString(this.getButtonSelected())));\r\n\r\n\t\treturn [element];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\tconst result: object = {};\r\n\t\tresult[ISurveyComponent.JSON_PROMPT_KEYNAME] = this.promptButtonToString(this.getButtonSelected());\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getComponentJson(): object {\r\n\t\treturn {\r\n\t\t\t[ISurveyComponent.JSON_TITLE_KEYNAME]: this.getTitle(),\r\n\t\t\t[ISurveyComponent.JSON_QUESTION_KEYNAME]: this.getQuestion(),\r\n\t\t\t[ISurveyComponent.JSON_PROMPTYESTEXT_KEYNAME]: this.getYesButtonText(),\r\n\t\t\t[ISurveyComponent.JSON_PROMPTNOTEXT_KEYNAME]: this.getNoButtonText(),\r\n\t\t};\r\n\t}\r\n\r\n\tprivate promptButtonToString(value: IPrompt.PromptButton): string {\r\n\t\tswitch (value) {\r\n\t\t\tcase IPrompt.PromptButton.Unselected:\r\n\t\t\t\treturn \"Unselected\";\r\n\t\t\tcase IPrompt.PromptButton.Yes:\r\n\t\t\t\treturn \"Yes\";\r\n\t\t\tcase IPrompt.PromptButton.No:\r\n\t\t\t\treturn \"No\";\r\n\t\t\tdefault:\r\n\t\t\t\treturn \"Unknown\";\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmodule PromptComponent {\r\n\texport class PromptComponentData {\r\n\t\tpublic question: string;\r\n\t\tpublic title: string;\r\n\t\tpublic yesButtonLabel: string;\r\n\t\tpublic noButtonLabel: string;\r\n\t}\r\n}\r\n\r\nexport = PromptComponent;\r\n","import * as ISurveyComponent from \"../Api/ISurveyComponent\";\r\nimport { IRatingComponent } from \"./../Api/IRatingComponent\";\r\n\r\nclass RatingComponent implements IRatingComponent {\r\n\tpublic static make(data: RatingComponent.RatingComponentData): IRatingComponent {\r\n\t\ttry {\r\n\t\t\treturn new RatingComponent(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate data: RatingComponent.RatingComponentData;\r\n\tprivate selectedIndex: number;\r\n\r\n\tpublic constructor(data: RatingComponent.RatingComponentData) {\r\n\t\tif (!data) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\t\tif (!data.question) {\r\n\t\t\tthrow new Error(\"data.question must not be null or empty\");\r\n\t\t}\r\n\t\tif (!data.ratingValuesAscending || data.ratingValuesAscending.length < 2) {\r\n\t\t\tthrow new Error(\"data.ratingValuesAscending must not be null or have less than two choices\");\r\n\t\t}\r\n\r\n\t\tdata.ratingValuesAscending.forEach((rating) => {\r\n\t\t\tif (!rating) {\r\n\t\t\t\tthrow new Error(\"rating values must not contain null or empty\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.data = data;\r\n\t\tthis.selectedIndex = -1;\r\n\t}\r\n\r\n\tpublic getType(): ISurveyComponent.Type {\r\n\t\treturn ISurveyComponent.Type.Rating;\r\n\t}\r\n\r\n\tpublic getQuestion(): string {\r\n\t\treturn this.data.question;\r\n\t}\r\n\r\n\tpublic getRatingValuesAscending(): string[] {\r\n\t\treturn this.data.ratingValuesAscending;\r\n\t}\r\n\r\n\tpublic getSelectedRating(): string {\r\n\t\tif (!this.isRatingIndexValid(this.selectedIndex)) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\r\n\t\treturn this.data.ratingValuesAscending[this.selectedIndex];\r\n\t}\r\n\r\n\tpublic setSelectedRatingIndex(selected: number): void {\r\n\t\tif (this.isRatingIndexValid(selected)) {\r\n\t\t\tthis.selectedIndex = selected;\r\n\t\t} else {\r\n\t\t\tthis.selectedIndex = -1;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getSelectedRatingIndex(): number {\r\n\t\treturn this.selectedIndex;\r\n\t}\r\n\r\n\tpublic getDomElements(doc: Document): Element[] {\r\n\t\tif (!doc) {\r\n\t\t\tthrow new Error(\"Document must not be null\");\r\n\t\t}\r\n\r\n\t\tconst element: Element = doc.createElement(ISurveyComponent.DOM_RATING_TAGNAME);\r\n\r\n\t\tif (!this.isRatingIndexValid(this.getSelectedRatingIndex())) {\r\n\t\t\telement.appendChild(doc.createTextNode(\"Not rated\"));\r\n\t\t} else {\r\n\t\t\t// Enforce six digits after the decimal\r\n\t\t\telement.appendChild(doc.createTextNode(this.getNormalizedRatingScore().toFixed(6)));\r\n\t\t}\r\n\r\n\t\treturn [element];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\tconst result: object = {};\r\n\r\n\t\tif (!this.isRatingIndexValid(this.getSelectedRatingIndex())) {\r\n\t\t\tresult[ISurveyComponent.JSON_RATING_KEYNAME] = \"Not rated\";\r\n\t\t} else {\r\n\t\t\tresult[ISurveyComponent.JSON_RATING_KEYNAME] = this.getNormalizedRatingScore();\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getComponentJson(): object {\r\n\t\treturn {\r\n\t\t\t[ISurveyComponent.JSON_QUESTION_KEYNAME]: this.getQuestion(),\r\n\t\t\t[ISurveyComponent.JSON_RATINGOPTIONS_KEYNAME]: this.getRatingValuesAscending(),\r\n\t\t};\r\n\t}\r\n\r\n\tpublic getNormalizedRatingScore(): number {\r\n\t\tif (!this.isRatingIndexValid(this.getSelectedRatingIndex())) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\tif (this.data.isZeroBased) {\r\n\t\t\treturn (this.selectedIndex) / (this.data.ratingValuesAscending.length - 1);\r\n\t\t} else {\r\n\t\t\treturn (this.selectedIndex + 1.0) / this.data.ratingValuesAscending.length;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isRatingIndexValid(index: number): boolean {\r\n\t\treturn (index >= 0 && index < this.data.ratingValuesAscending.length);\r\n\t}\r\n\r\n}\r\n\r\nmodule RatingComponent {\r\n\texport class RatingComponentData {\r\n\t\tpublic question: string;\r\n\t\tpublic ratingValuesAscending: string[];\r\n\t\tpublic isZeroBased: boolean;\r\n\t}\r\n}\r\n\r\nexport = RatingComponent;\r\n","import { IFloodgateSetting } from \"../Api/IFloodgateSetting\";\r\nimport { IFloodgateSettingStorageCallback } from \"../Api/IFloodgateSettingStorageCallback\";\r\nimport * as IFloodgateStorageProvider from \"../Api/IFloodgateStorageProvider\";\r\nimport { TelemetryEvent } from \"../Constants\";\r\nimport { FloodgateEngine } from \"../FloodgateEngine\";\r\nimport * as StateProviderHelpers from \"../StateProviderHelpers\";\r\nimport * as Utils from \"../Utils\";\r\nimport FileType = IFloodgateStorageProvider.FileType;\r\nimport StateListType = StateProviderHelpers.StateListType;\r\n\r\nconst { getDistantPast, isBoolean, isDate, isNOU, isString, isUtcDatetimeString, stringToDate } = Utils;\r\n\r\nexport class CampaignState {\r\n\t/**\r\n\t * Method to deserialize a JSON object to class object\r\n\t * @param input: JSON object\r\n\t * Returns class object\r\n\t */\r\n\tpublic static deserialize(input: any): CampaignState {\r\n\t\tlet result: CampaignState;\r\n\r\n\t\tif (!input) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tresult = new CampaignState(\r\n\t\t\t\tinput.CampaignId,\r\n\t\t\t\tinput.LastNominationTimeUtc,\r\n\t\t\t\tinput.LastNominationBuildNumber,\r\n\t\t\t\tinput.DeleteAfterSecondsWhenStale,\r\n\t\t\t\tfalse, // ForceCandidacy\r\n\t\t\t\tinput.IsCandidate,\r\n\t\t\t\tinput.DidCandidateTriggerSurvey,\r\n\t\t\t\tinput.LastSurveyActivatedTimeUtc,\r\n\t\t\t\tinput.LastSurveyId,\r\n\t\t\t\tinput.LastSurveyStartTimeUtc,\r\n\t\t\t\tinput.LastSurveyExpirationTimeUtc,\r\n\t\t\t\tinput.LastCooldownEndTimeUtc,\r\n\t\t\t);\r\n\t\t} catch (e) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(TelemetryEvent.CampaignState.Deserialize.Failed, { ErrorMessage: e.toString() });\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// The Campaign to which this state corresponds\r\n\t// @SerializedName(\"CampaignId\")\r\n\tpublic CampaignId: string;\r\n\r\n\t// The last time the candidacy was evaluated\r\n\t// @SerializedName(\"LastNominationTimeUtc\")\r\n\tpublic LastNominationTimeUtc: Date;\r\n\r\n\t// The build number from the last time the candidacy was evaluated\r\n\t// @SerializedName(\"LastNominationBuildNumber\")\r\n\tpublic LastNominationBuildNumber: string;\r\n\r\n\t// Amount of time to delay cleanup of this state from storage, when it's campaign definition is no longer present\r\n\t// @SerializedName(\"DeleteAfterSecondsWhenStale\")\r\n\tpublic DeleteAfterSecondsWhenStale: number;\r\n\r\n\t// Manual setting that can be used to force this client to be a candidate for this campaign. Not persisted to the file.\r\n\tpublic ForceCandidacy: boolean;\r\n\r\n\t// Whether or not the user is currently a candidate or anti-candidate\r\n\t// @SerializedName(\"IsCandidate\")\r\n\tpublic IsCandidate: boolean;\r\n\r\n\t// Whether or not the user triggered a survey when they are a Candidate.\r\n\t// If isCandidate is false, then this value is meaningless.\r\n\t// If isCandidate is true, then this is used to pick a different campaign cooldown time\r\n\t// @SerializedName(\"DidCandidateTriggerSurvey\")\r\n\tpublic DidCandidateTriggerSurvey: boolean;\r\n\r\n\t// The date the last survey was activated\r\n\t// @SerializedName(\"LastSurveyActivatedTimeUtc\")\r\n\tpublic LastSurveyActivatedTimeUtc: Date;\r\n\r\n\t// region Properties of the most recently generated survey.\u0010\r\n\r\n\t// When isCandidate == true for the current election time, this is used to regenerate the same Survey definition\r\n\t// each time we are invoked\r\n\t// Consider: Putting this in its own subclass\r\n\r\n\t// The surveyId for the most recently generated survey in this campaign (can differ from campaignId, and is\r\n\t// used to guarantee a given survey is shown once)\r\n\t// @SerializedName(\"LastSurveyId\")\r\n\tpublic LastSurveyId: string;\r\n\r\n\t// The start time of the most recently generated survey\r\n\t// @SerializedName(\"LastSurveyStartTimeUtc\")\r\n\tpublic LastSurveyStartTimeUtc: Date;\r\n\r\n\t// The expiration time of the most recently generated survey\r\n\t// @SerializedName(\"LastSurveyExpirationTimeUtc\")\r\n\tpublic LastSurveyExpirationTimeUtc: Date;\r\n\r\n\t// The cooldown end time of the most recently generated survey\r\n\t// @SerializedName(\"LastCooldownEndTimeUtc\")\r\n\tpublic LastCooldownEndTimeUtc: Date;\r\n\r\n\tpublic constructor(campaignId: string, lastNominationTime: Date, lastNominationBuildNumber: string, deleteAfterSecondsWhenStale: number,\r\n\t\tForceCandidacy: boolean, isCandidate: boolean, didCandidateTriggerSurvey: boolean, lastSurveyActivatedTime: Date,\r\n\t\tlastSurveyId: string, lastSurveyStartTime: Date, lastSurveyExpirationTime: Date, lastCooldownEndTimeUtc: Date) {\r\n\t\tthis.CampaignId = campaignId;\r\n\t\tthis.LastNominationTimeUtc = lastNominationTime;\r\n\t\tthis.LastNominationBuildNumber = lastNominationBuildNumber;\r\n\t\tthis.DeleteAfterSecondsWhenStale = deleteAfterSecondsWhenStale;\r\n\t\tthis.ForceCandidacy = ForceCandidacy;\r\n\t\tthis.IsCandidate = isCandidate;\r\n\t\tthis.DidCandidateTriggerSurvey = didCandidateTriggerSurvey;\r\n\t\tthis.LastSurveyActivatedTimeUtc = lastSurveyActivatedTime;\r\n\t\tthis.LastSurveyId = lastSurveyId;\r\n\t\tthis.LastSurveyStartTimeUtc = lastSurveyStartTime;\r\n\t\tthis.LastSurveyExpirationTimeUtc = lastSurveyExpirationTime;\r\n\t\tthis.LastCooldownEndTimeUtc = lastCooldownEndTimeUtc;\r\n\r\n\t\tif (!this.validate()) {\r\n\t\t\tthrow new Error(\"Constructor arguments are not valid\");\r\n\t\t}\r\n\t}\r\n\r\n\tpublic validate(): boolean {\r\n\t\tif (!this.CampaignId || !isString(this.CampaignId)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.LastNominationBuildNumber)\r\n\t\t\t|| !isString(this.LastNominationBuildNumber)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!Utils.isNumber(this.DeleteAfterSecondsWhenStale) || this.DeleteAfterSecondsWhenStale < 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!isBoolean(this.IsCandidate) || !isBoolean(this.DidCandidateTriggerSurvey)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (this.IsCandidate) {\r\n\t\t\t// Disallow the following null's if isCandidate == true\r\n\t\t\tif (isNOU(this.LastSurveyStartTimeUtc) || isNOU(this.LastSurveyExpirationTimeUtc)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// LastSurveyId could be \"\"\r\n\t\t\tif (!isString(this.LastSurveyId)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.DidCandidateTriggerSurvey) {\r\n\t\t\t// Disallow the following null's if didCandidateTriggerSurvey == true\r\n\t\t\tif (isNOU(this.LastSurveyActivatedTimeUtc)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isNOU(this.LastSurveyId)) {\r\n\t\t\tthis.LastSurveyId = \"\";\r\n\t\t} else if (!isString(this.LastSurveyId)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// LastNominationTime does not allow null\r\n\t\tif (isUtcDatetimeString(this.LastNominationTimeUtc)) {\r\n\t\t\tthis.LastNominationTimeUtc = stringToDate(this.LastNominationTimeUtc);\r\n\t\t// invalidate if it's not a Date object\r\n\t\t} else if (!isDate(this.LastNominationTimeUtc)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Set value to distance past if value not provided\r\n\t\tif (isNOU(this.LastSurveyActivatedTimeUtc)) {\r\n\t\t\tthis.LastSurveyActivatedTimeUtc = getDistantPast();\r\n\t\t// check if it's UTC date time string, possibly coming from deserialize method\r\n\t\t} else if (isUtcDatetimeString(this.LastSurveyActivatedTimeUtc)) {\r\n\t\t\tthis.LastSurveyActivatedTimeUtc = stringToDate(this.LastSurveyActivatedTimeUtc);\r\n\t\t// invalidate if it's not a Date object\r\n\t\t} else if (!isDate(this.LastSurveyActivatedTimeUtc)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Set value to distance past if value not provided\r\n\t\tif (isNOU(this.LastSurveyStartTimeUtc)) {\r\n\t\t\tthis.LastSurveyStartTimeUtc = getDistantPast();\r\n\t\t// check if it's string, possibly coming from deserialize method\r\n\t\t} else if (isUtcDatetimeString(this.LastSurveyStartTimeUtc)) {\r\n\t\t\tthis.LastSurveyStartTimeUtc = stringToDate(this.LastSurveyStartTimeUtc);\r\n\t\t// invalidate if it's not a Date object\r\n\t\t} else if (!isDate(this.LastSurveyStartTimeUtc)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Set value to distance past if value not provided\r\n\t\tif (isNOU(this.LastSurveyExpirationTimeUtc)) {\r\n\t\t\tthis.LastSurveyExpirationTimeUtc = getDistantPast();\r\n\t\t// check if it's string, possibly coming from deserialize method\r\n\t\t} else if (isUtcDatetimeString(this.LastSurveyExpirationTimeUtc)) {\r\n\t\t\tthis.LastSurveyExpirationTimeUtc = stringToDate(this.LastSurveyExpirationTimeUtc);\r\n\t\t} else if (!isDate(this.LastSurveyExpirationTimeUtc)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Set value to distance past if value not provided\r\n\t\tif (isNOU(this.LastCooldownEndTimeUtc)) {\r\n\t\t\tthis.LastCooldownEndTimeUtc = getDistantPast();\r\n\t\t// check if it's string, possibly coming from deserialize method\r\n\t\t} else if (isUtcDatetimeString(this.LastCooldownEndTimeUtc)) {\r\n\t\t\tthis.LastCooldownEndTimeUtc = stringToDate(this.LastCooldownEndTimeUtc);\r\n\t\t} else if (!isDate(this.LastCooldownEndTimeUtc)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Record that the current survey was taken on this date\r\n\t *\r\n\t * @param date date\r\n\t * @param cooldownSeconds number\r\n\t */\r\n\tpublic markCurrentSurveyTakenOnDate(date: Date, cooldownSeconds: number, isSurveyComplete: boolean): void {\r\n\t\tthis.DidCandidateTriggerSurvey = isSurveyComplete;\r\n\t\tthis.LastSurveyActivatedTimeUtc = date != null ? date : new Date();\r\n\t\tthis.LastCooldownEndTimeUtc = Utils.addSecondsWithoutOverflow(this.LastSurveyActivatedTimeUtc, cooldownSeconds);\r\n\t}\r\n\r\n\tpublic getCooldownStartDate(): Date {\r\n\t\tif (!this.IsCandidate) {\r\n\t\t\treturn this.LastNominationTimeUtc;\r\n\t\t}\r\n\r\n\t\tif (this.DidCandidateTriggerSurvey) {\r\n\t\t\treturn this.LastSurveyActivatedTimeUtc;\r\n\t\t}\r\n\r\n\t\t// In practice this wil be equal to lastNominationTime, but\r\n\t\t// distribution models like a ramp effectively cause us to\r\n\t\t// shift our \"effective nomination date\" forward with the survey start date\r\n\t\treturn this.LastSurveyStartTimeUtc;\r\n\t}\r\n\r\n\t// endregion\r\n}\r\n\r\nexport interface ICampaignStateProvider {\r\n\tload(): CampaignState[];\r\n\r\n\tsave(campaignStates: CampaignState[]): void;\r\n}\r\n\r\nexport class CampaignStateProviderFactory {\r\n\tpublic static make(fileBasedStorage: IFloodgateStorageProvider,\r\n\t\thostBasedStorage: IFloodgateSettingStorageCallback): ICampaignStateProvider {\r\n\t\tif (hostBasedStorage) {\r\n\t\t\treturn new HostBasedCampaignStateProvider(fileBasedStorage, hostBasedStorage);\r\n\t\t}\r\n\r\n\t\treturn new FileBasedCampaignStateProvider(fileBasedStorage);\r\n\t}\r\n}\r\n\r\n/**\r\n * Class representing what is stored in the file.\r\n */\r\nclass FileData {\r\n\t// @SerializedName(\"CampaignStates\")\r\n\tpublic CampaignStates: CampaignState[];\r\n\r\n}\r\n\r\nexport class HostBasedCampaignStateProvider implements ICampaignStateProvider {\r\n\tprivate fileBasedStateProvider: ICampaignStateProvider;\r\n\tprivate hostBasedStorage: IFloodgateSettingStorageCallback;\r\n\r\n\tpublic constructor(fileBasedStorage: IFloodgateStorageProvider, hostBasedStorage: IFloodgateSettingStorageCallback) {\r\n\t\tif (!hostBasedStorage) {\r\n\t\t\tthrow new Error(\"host-based storage must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.hostBasedStorage = hostBasedStorage;\r\n\r\n\t\t// file-based provider is optional\r\n\t\tif (fileBasedStorage) {\r\n\t\t\tthis.fileBasedStateProvider = new FileBasedCampaignStateProvider(fileBasedStorage);\r\n\t\t}\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic load(): CampaignState[] {\r\n\t\tconst statesFromHost: CampaignState[] = this.getStatesFromHost();\r\n\r\n\t\tlet statesFromFile: CampaignState[];\r\n\t\tif (this.fileBasedStateProvider) {\r\n\t\t\tstatesFromFile = this.fileBasedStateProvider.load();\r\n\t\t}\r\n\r\n\t\tconst StateCollections = StateProviderHelpers.MergeAndUpdateCampaignStates(statesFromFile, statesFromHost);\r\n\t\treturn StateCollections.find(StateListType.Merged);\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic save(campaignStates: CampaignState[]): void {\r\n\t\tif (!campaignStates) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst statesFromHost: CampaignState[] = this.getStatesFromHost();\r\n\t\tconst StateCollections = StateProviderHelpers.MergeAndUpdateCampaignStates(campaignStates, statesFromHost);\r\n\t\tconst toBeUpdatedStates: CampaignState[] = StateCollections.find(StateListType.ToBeUpdated);\r\n\t\tconst mergedStates: CampaignState[] = StateCollections.find(StateListType.Merged);\r\n\r\n\t\t// write delta_data to host\r\n\t\tif (toBeUpdatedStates) {\r\n\t\t\ttoBeUpdatedStates.forEach((state) => {\r\n\t\t\t\tconst stateValue: string = StateProviderHelpers.makeSettingItemValue(JSON.stringify(state));\r\n\t\t\t\tthis.hostBasedStorage.upsertSettingItem(FileType[FileType.CampaignStates], state.CampaignId, stateValue);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Write merged data to File\r\n\t\tif (this.fileBasedStateProvider) {\r\n\t\t\tthis.fileBasedStateProvider.save(mergedStates);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getStatesFromHost(): CampaignState[] {\r\n\t\tconst states: CampaignState[] = [];\r\n\t\tconst settings: IFloodgateSetting = this.hostBasedStorage.readSettingList(FileType[FileType.CampaignStates]);\r\n\r\n\t\tfor (const key in settings) {\r\n\t\t\tif (!settings.hasOwnProperty(key)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst value = settings[key];\r\n\t\t\tconst dataString: string = StateProviderHelpers.extractSettingItemValueSubString(value);\r\n\r\n\t\t\tlet itemObject: any = {};\r\n\t\t\ttry {\r\n\t\t\t\titemObject = JSON.parse(dataString);\r\n\r\n\t\t\t\tconst newState: CampaignState = CampaignState.deserialize(itemObject);\r\n\t\t\t\tif (newState) {\r\n\t\t\t\t\tstates.push(newState);\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\t\tTelemetryEvent.HostBasedCampaignStateProvider.GetStatesFromHost.Failed,\r\n\t\t\t\t\t{ ErrorMessage: \"Json parsing/deserializing failed. \" + e.toString() + \".  Input:\" + dataString });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn states;\r\n\t}\r\n}\r\n\r\nexport class FileBasedCampaignStateProvider implements ICampaignStateProvider {\r\n\tprivate storage: IFloodgateStorageProvider;\r\n\r\n\tpublic constructor(storage: IFloodgateStorageProvider) {\r\n\t\tif (!storage) {\r\n\t\t\tthrow new Error(\"storage must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.storage = storage;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic load(): CampaignState[] {\r\n\t\tconst readString: string = this.storage.read(FileType.CampaignStates);\r\n\t\tif (!readString) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\tlet fileData: FileData;\r\n\t\ttry {\r\n\t\t\tfileData = JSON.parse(readString);\r\n\r\n\t\t\tconst result: CampaignState[] = [];\r\n\t\t\tif (fileData && fileData.CampaignStates) {\r\n\t\t\t\tfileData.CampaignStates.forEach((state) => {\r\n\t\t\t\t\tconst newState: CampaignState = CampaignState.deserialize(state);\r\n\r\n\t\t\t\t\tif (newState) {\r\n\t\t\t\t\t\tresult.push(newState);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t} catch (e) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.FileBasedCampaignStateProvider.Load.Failed,\r\n\t\t\t\t{ ErrorMessage: \"Json parsing/deserializing failed. \" + e.toString() + \".  Input:\" + readString });\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic save(campaignStates: CampaignState[]): void {\r\n\t\tif (!campaignStates) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst fileData = new FileData();\r\n\t\tfileData.CampaignStates = campaignStates;\r\n\t\tconst writeString: string = JSON.stringify(fileData);\r\n\t\tthis.storage.write(FileType.CampaignStates, writeString);\r\n\t}\r\n}\r\n","import { IFloodgateSetting } from \"./Api/IFloodgateSetting\";\r\nimport { IFloodgateSettingStorageCallback } from \"./Api/IFloodgateSettingStorageCallback\";\r\nimport * as IFloodgateStorageProvider from \"./Api/IFloodgateStorageProvider\";\r\nimport FileType = IFloodgateStorageProvider.FileType;\r\nimport * as ISurvey from \"./Api/ISurvey\";\r\nimport { IDictionary, ISerializable } from \"./Common\";\r\nimport { TelemetryEvent } from \"./Constants\";\r\nimport { FloodgateEngine } from \"./FloodgateEngine\";\r\nimport * as StateProviderHelpers from \"./StateProviderHelpers\";\r\nimport { SurveyStatCollection } from \"./SurveyStatCollection\";\r\nimport * as Utils from \"./Utils\";\r\n\r\n/**\r\n * StatCollection for activated surveys.  Should be used to track the SurveyIds\r\n * that have been recently shown to a user\r\n */\r\n// TODO (gachoi) Check if this applies - VSOBug: 1443010 One bad Stat object fails the entire serialization\r\nexport class SurveyStatCollectionActivation extends SurveyStatCollection<SurveyActivationStats> implements ISerializable {\r\n\t/**\r\n\t * Load from Json\r\n\t */\r\n\tpublic static fromJson(json: string): SurveyStatCollectionActivation {\r\n\t\tconst statCollection = new SurveyStatCollectionActivation();\r\n\r\n\t\tif (!json) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.SurveyStatCollectionActivation.FromJson.Failed, { ErrorMessage: \"Input json is null or empty.\" });\r\n\t\t\treturn statCollection;\r\n\t\t}\r\n\r\n\t\tlet readStats: SurveyStatCollectionActivation;\r\n\t\ttry {\r\n\t\t\treadStats = JSON.parse(json);\r\n\t\t} catch (e) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.SurveyStatCollectionActivation.FromJson.Failed, { ErrorMessage: \"Json parsing failed. \" + e.toString() });\r\n\t\t\treturn statCollection;\r\n\t\t}\r\n\r\n\t\tif (!statCollection.deserialize(readStats)) {\r\n\t\t\treturn new SurveyStatCollectionActivation();\r\n\t\t}\r\n\r\n\t\treturn statCollection;\r\n\t}\r\n\r\n\t/**\r\n\t * Convert to Json\r\n\t */\r\n\tpublic static toJson(object: SurveyStatCollectionActivation): string {\r\n\t\tif (!object) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.SurveyStatCollectionActivation.ToJson.Failed, { ErrorMessage: \"Input json is null or empty.\" });\r\n\t\t\tobject = new SurveyStatCollectionActivation();\r\n\t\t}\r\n\r\n\t\treturn JSON.stringify(object);\r\n\t}\r\n\r\n\t/**\r\n\t * Add another SurveyStatCollectionActivation object\r\n\t */\r\n\tpublic accumulate(other: SurveyStatCollectionActivation): void {\r\n\t\tif (!other) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst stats: IDictionary<SurveyActivationStats> = other.getStats();\r\n\t\t// SurveyActivationStats accumulation simply overwrites any keys from 'other' into our collection\r\n\t\tfor (const key in stats) {\r\n\t\t\tif (stats.hasOwnProperty(key)) {\r\n\t\t\t\tthis.addStats(key, stats[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Method to deserialize SurveyStatCollectionActivation\r\n\t * @param input: collection of SurveyStatCollectionActivation\r\n\t * Returns result of validation check\r\n\t */\r\n\tpublic deserialize(input: any): boolean {\r\n\t\tconst rawStats: IDictionary<SurveyActivationStats> = input.Surveys;\r\n\t\tconst now = new Date();\r\n\r\n\t\tfor (const key in rawStats) {\r\n\t\t\tif (rawStats.hasOwnProperty(key)) {\r\n\t\t\t\tconst newStat = new SurveyActivationStats();\r\n\r\n\t\t\t\tif (newStat.deserialize(rawStats[key]) && newStat.ExpirationTimeUtc > now) {\r\n\t\t\t\t\tthis.addStats(key, newStat);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * Validate the Surveys\r\n\t * Returns false if validation fails\r\n\t */\r\n\tpublic validate(): boolean {\r\n\t\treturn Utils.isObject(this.getStats());\r\n\t}\r\n}\r\n\r\nexport interface ISurveyActivationStatsProvider {\r\n\tload(): SurveyStatCollectionActivation;\r\n\r\n\tsave(surveyStatCollectionActivation: SurveyStatCollectionActivation): void;\r\n}\r\n\r\nexport class SurveyActivationStatsProviderFactory {\r\n\tpublic static make(fileBasedStorage: IFloodgateStorageProvider,\r\n\t\thostBasedStorage: IFloodgateSettingStorageCallback): ISurveyActivationStatsProvider {\r\n\t\tif (hostBasedStorage) {\r\n\t\t\treturn new HostBasedSurveyActivationStatsProvider(fileBasedStorage, hostBasedStorage);\r\n\t\t}\r\n\r\n\t\treturn new FileBasedSurveyActivationStatsProvider(fileBasedStorage);\r\n\t}\r\n}\r\n\r\nexport class HostBasedSurveyActivationStatsProvider implements ISurveyActivationStatsProvider {\r\n\tprivate fileBasedStorageProvider: FileBasedSurveyActivationStatsProvider;\r\n\tprivate hostBasedStorage: IFloodgateSettingStorageCallback;\r\n\r\n\tpublic constructor(fileBasedStorageProvider: IFloodgateStorageProvider, hostBasedStorage: IFloodgateSettingStorageCallback) {\r\n\t\tif (!hostBasedStorage) {\r\n\t\t\tthrow new Error(\"host-based storage must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.hostBasedStorage = hostBasedStorage;\r\n\r\n\t\t// file based provider is optional\r\n\t\tif (fileBasedStorageProvider) {\r\n\t\t\tthis.fileBasedStorageProvider = new FileBasedSurveyActivationStatsProvider(fileBasedStorageProvider);\r\n\t\t}\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic load(): SurveyStatCollectionActivation {\r\n\t\tconst surveyStatsFromHost: SurveyStatCollectionActivation = this.getSurveyStatsFromHost();\r\n\r\n\t\tlet surveyStatsFromFile: SurveyStatCollectionActivation = new SurveyStatCollectionActivation();\r\n\t\tif (this.fileBasedStorageProvider) {\r\n\t\t\tsurveyStatsFromFile = this.fileBasedStorageProvider.load();\r\n\t\t}\r\n\r\n\t\tconst surveyStatsCollections = StateProviderHelpers.MergeAndUpdateSurveyActivationStats(surveyStatsFromFile, surveyStatsFromHost);\r\n\t\treturn surveyStatsCollections.find(StateProviderHelpers.StateListType.Merged);\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic save(stats: SurveyStatCollectionActivation): void {\r\n\t\tif (!stats) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst statsFromHost: SurveyStatCollectionActivation = this.getSurveyStatsFromHost();\r\n\t\tconst statCollection = StateProviderHelpers.MergeAndUpdateSurveyActivationStats(stats, statsFromHost);\r\n\t\tconst toBeUpdatedStats: SurveyStatCollectionActivation = statCollection.find(StateProviderHelpers.StateListType.ToBeUpdated);\r\n\t\tconst mergedStates: SurveyStatCollectionActivation = statCollection.find(StateProviderHelpers.StateListType.Merged);\r\n\r\n\t\t// write delta_data to Roaming\r\n\t\tif (toBeUpdatedStats) {\r\n\t\t\tconst toBeUpdatedStatsDictionary: IDictionary<SurveyActivationStats> = toBeUpdatedStats.getStats();\r\n\t\t\tfor (const surveyId in toBeUpdatedStatsDictionary) {\r\n\t\t\t\tif (toBeUpdatedStatsDictionary.hasOwnProperty(surveyId)) {\r\n\t\t\t\t\tconst item: string = StateProviderHelpers.makeSettingItemValue(\r\n\t\t\t\t\t\tJSON.stringify(toBeUpdatedStatsDictionary[surveyId]));\r\n\r\n\t\t\t\t\tthis.hostBasedStorage.upsertSettingItem(FileType[FileType.SurveyActivationStats],\r\n\t\t\t\t\t\tsurveyId, item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Write merged data to File\r\n\t\tif (this.fileBasedStorageProvider) {\r\n\t\t\tthis.fileBasedStorageProvider.save(mergedStates);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getSurveyStatsFromHost(): SurveyStatCollectionActivation {\r\n\t\tconst statsCollection: SurveyStatCollectionActivation = new  SurveyStatCollectionActivation();\r\n\t\tconst itemData: IFloodgateSetting = this.hostBasedStorage.readSettingList(FileType[FileType.SurveyActivationStats]);\r\n\r\n\t\tconst now = new Date();\r\n\t\tfor (const surveyId in itemData) {\r\n\t\t\tif (!itemData.hasOwnProperty(surveyId)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst dataString: string = StateProviderHelpers.extractSettingItemValueSubString(itemData[surveyId]);\r\n\t\t\tconst newStats: SurveyActivationStats = new SurveyActivationStats();\r\n\t\t\ttry {\r\n\t\t\t\tconst readStats: SurveyActivationStats = JSON.parse(dataString);\r\n\t\t\t\tnewStats.deserialize(readStats);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\t\tTelemetryEvent.HostBasedSurveyActivationStatsProvider.GetSurveyStatsFromHost.Failed,\r\n\t\t\t\t\t{ ErrorMessage: \"Json parsing/deserializing failed. \" + e.toString() + \".  Input:\" + dataString });\r\n\t\t\t}\r\n\r\n\t\t\tif (newStats.ExpirationTimeUtc <= now) {\r\n\t\t\t\t// Delete survey stat from host storage if it's expired.\r\n\t\t\t\tthis.hostBasedStorage.deleteSettingItem(FileType[FileType.SurveyActivationStats], surveyId);\r\n\t\t\t} else {\r\n\t\t\t\tstatsCollection.addStats(surveyId, newStats);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn statsCollection;\r\n\t}\r\n}\r\nexport class FileBasedSurveyActivationStatsProvider implements ISurveyActivationStatsProvider {\r\n\tprivate storage: IFloodgateStorageProvider;\r\n\r\n\tpublic constructor(storage: IFloodgateStorageProvider) {\r\n\t\tif (!storage) {\r\n\t\t\tthrow new Error(\"storage must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.storage = storage;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic load(): SurveyStatCollectionActivation {\r\n\t\tconst readString: string = this.storage.read(IFloodgateStorageProvider.FileType.SurveyActivationStats);\r\n\t\tif (!readString) {\r\n\t\t\treturn new SurveyStatCollectionActivation();\r\n\t\t}\r\n\r\n\t\treturn SurveyStatCollectionActivation.fromJson(readString);\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic save(surveyStatCollectionActivation: SurveyStatCollectionActivation): void {\r\n\t\tif (!surveyStatCollectionActivation) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst writeString: string = SurveyStatCollectionActivation.toJson(surveyStatCollectionActivation);\r\n\t\tthis.storage.write(IFloodgateStorageProvider.FileType.SurveyActivationStats, writeString);\r\n\t}\r\n}\r\n\r\nexport class SurveyActivationStats implements ISerializable {\r\n\t// The following property names match JSON property names for proper serialization/deserialization\r\n\tpublic ExpirationTimeUtc: Date;\r\n\tpublic ActivationTimeUtc: Date;\r\n\tpublic Type: ISurvey.Type;\r\n\tpublic SurveyLaunchCount = 0;\r\n\tpublic SurveyLaunchCountPerSession = 0;\r\n\r\n\t/**\r\n\t * Method to deserialize a JSON object to class object\r\n\t * @param input: JSON object\r\n\t * Returns result of validation check\r\n\t */\r\n\tpublic deserialize(input: any): boolean {\r\n\t\tthis.ActivationTimeUtc = input.ActivationTimeUtc;\r\n\t\tthis.ExpirationTimeUtc = input.ExpirationTimeUtc;\r\n\t\tthis.Type = input.Type;\r\n\t\tthis.SurveyLaunchCount = input.SurveyLaunchCount ?? 0;\r\n\t\tthis.SurveyLaunchCountPerSession = input.SurveyLaunchCountPerSession ?? 0;\r\n\r\n\t\treturn this.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * Method to call after deserialization to validate generated object.\r\n\t * Returns false if not valid.\r\n\t */\r\n\tpublic validate(): boolean {\r\n\t\t// make it a date object if it's a valid UTC date time value\r\n\t\tif (Utils.isUtcDatetimeString(this.ActivationTimeUtc)) {\r\n\t\t\tthis.ActivationTimeUtc = Utils.stringToDate(this.ActivationTimeUtc);\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// make it a date object if it's a valid UTC date time value\r\n\t\tif (Utils.isUtcDatetimeString(this.ExpirationTimeUtc)) {\r\n\t\t\tthis.ExpirationTimeUtc = Utils.stringToDate(this.ExpirationTimeUtc);\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!Utils.isNumber(this.SurveyLaunchCount) ||\r\n\t\t\t!Utils.isNumber(this.SurveyLaunchCountPerSession)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn Utils.isEnumValue(this.Type, ISurvey.Type);\r\n\t}\r\n}\r\n","import { IDictionary } from \"./Common\";\r\n\r\n/**\r\n * Generic class for managing a collection of survey stats. Includes read-from/write-to json structures or a file,\r\n * as well as merge routines for combining collections\r\n */\r\nexport abstract class SurveyStatCollection<TStats> {\r\n\t// The following property name matches the JSON root key name for proper serialization/ deserialization\r\n\tprivate Surveys: IDictionary<TStats> = {};\r\n\r\n\tpublic constructor() {\r\n\t\tthis.Surveys = {};\r\n\t}\r\n\r\n\t/**\r\n\t * Add stats. Overwrites if already exists.\r\n\t */\r\n\tpublic addStats(surveyId: string, stats: TStats): void {\r\n\t\tthis.Surveys[surveyId] = stats;\r\n\t}\r\n\r\n\t/**\r\n\t * Get a SurveyActivationStats object by surveyId. Returns null if surveyId is not found\r\n\t */\r\n\tpublic getBySurveyId(surveyId: string): TStats {\r\n\t\treturn (this.Surveys[surveyId]);\r\n\t}\r\n\r\n\t/**\r\n\t * Get all stats available\r\n\t */\r\n\tpublic getStats(): IDictionary<TStats> {\r\n\t\treturn this.Surveys;\r\n\t}\r\n}\r\n","import { ICVSurveyComponent } from \"src/Api/Api\";\r\nimport * as ISurveyComponent from \"../Api/ISurveyComponent\";\r\n\r\nclass CVSurveyComponent implements ICVSurveyComponent {\r\n\tpublic static make(data: CVSurveyComponent.CVSurveyComponentData): ICVSurveyComponent {\r\n\t\ttry {\r\n\t\t\treturn new CVSurveyComponent(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate data: CVSurveyComponent.CVSurveyComponentData;\r\n\r\n\tpublic constructor(data: CVSurveyComponent.CVSurveyComponentData) {\r\n\t\tif (!data) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\t\tif (!data.customerVoiceFormId) {\r\n\t\t\tthrow new Error(\"data.formID must not be null or empty\");\r\n\t\t}\r\n\r\n\t\tthis.data = data;\r\n\t}\r\n\r\n\tpublic getType(): ISurveyComponent.Type {\r\n\t\treturn ISurveyComponent.Type.CVSurvey;\r\n\t}\r\n\r\n\tpublic getFormId(): string {\r\n\t\treturn this.data.customerVoiceFormId;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getDomElements(doc: Document): Element[] {\r\n\t\tif (!doc) {\r\n\t\t\tthrow new Error(\"Document must not be null\");\r\n\t\t}\r\n\t\tconst element: Element = doc.createElement(ISurveyComponent.DOM_CVSURVEY_TAGNAME);\r\n\t\treturn [element];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\tconst result: object = {};\r\n\r\n\t\tresult[ISurveyComponent.JSON_CVSURVEY_KEYNAME] = this.getFormId();\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getComponentJson(): object {\r\n\t\treturn {\r\n\t\t\t[ISurveyComponent.JSON_CVSURVEYFORMID_KEYNAME]: this.getFormId(),\r\n\t\t};\r\n\t}\r\n}\r\n\r\nmodule CVSurveyComponent {\r\n\texport class CVSurveyComponentData {\r\n\t\tpublic customerVoiceFormId: string;\r\n\t}\r\n}\r\n\r\nexport = CVSurveyComponent;\r\n","import { IFloodgateSetting } from \"./Api/IFloodgateSetting\";\r\nimport { IFloodgateSettingStorageCallback } from \"./Api/IFloodgateSettingStorageCallback\";\r\nimport * as IFloodgateStorageProvider from \"./Api/IFloodgateStorageProvider\";\r\nimport { TelemetryEvent } from \"./Constants\";\r\nimport { FloodgateEngine } from \"./FloodgateEngine\";\r\nimport { GovernedChannelType } from \"./GovernedChannel\";\r\nimport * as StateProviderHelpers from \"./StateProviderHelpers\";\r\nimport * as Utils from \"./Utils\";\r\nimport FileType = IFloodgateStorageProvider.FileType;\r\nimport StateListType = StateProviderHelpers.StateListType;\r\n\r\nexport class GovernedChannelState {\r\n\t/**\r\n\t * Method to deserialize a JSON object to class object\r\n\t * @param input: JSON object\r\n\t * Returns class object\r\n\t */\r\n\tpublic static deserialize(input: any): GovernedChannelState {\r\n\t\tlet result: GovernedChannelState;\r\n\r\n\t\tif (!input) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// Validation is handled by GovernedChannelState's constructor\r\n\t\ttry {\r\n\t\t\tresult = new GovernedChannelState(\r\n\t\t\t\tinput.ChannelType,\r\n\t\t\t\tinput.CooldownStartTimeUtc,\r\n\t\t\t);\r\n\t\t} catch (e) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.GovernedChannelState.Deserialize.Failed, { ErrorMessage: e.toString() });\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @SerializedName(\"ChannelType\")\r\n\tprivate ChannelType: GovernedChannelType;\r\n\r\n\t// @SerializedName(\"CooldownStartTimeUtc\")\r\n\tprivate CooldownStartTimeUtc: Date;\r\n\r\n\tpublic constructor(type: GovernedChannelType, cooldownStartTime: Date) {\r\n\t\tthis.ChannelType = type;\r\n\t\tthis.CooldownStartTimeUtc = cooldownStartTime;\r\n\r\n\t\tif (!this.validate()) {\r\n\t\t\tthrow new Error(\"Constructor arguments are not valid\");\r\n\t\t}\r\n\t}\r\n\r\n\tpublic validate(): boolean {\r\n\t\tif (!Utils.isEnumValue(this.ChannelType, GovernedChannelType)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// make it a date object if it's a valid UTC date time value\r\n\t\tif (Utils.isUtcDatetimeString(this.CooldownStartTimeUtc)) {\r\n\t\t\tthis.CooldownStartTimeUtc = Utils.stringToDate(this.CooldownStartTimeUtc);\r\n\t\t// Allow null and bad cooldownStartTime\r\n\t\t} else if (Utils.isNOU(this.CooldownStartTimeUtc) || !Utils.isDate(this.CooldownStartTimeUtc)) {\r\n\t\t\tthis.CooldownStartTimeUtc = Utils.getDistantPast();\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tpublic getType(): GovernedChannelType {\r\n\t\treturn this.ChannelType;\r\n\t}\r\n\r\n\tpublic getCooldownStartTime(): Date {\r\n\t\treturn this.CooldownStartTimeUtc;\r\n\t}\r\n}\r\n\r\nexport interface IGovernedChannelStateProvider {\r\n\tload(): GovernedChannelState[];\r\n\r\n\tsave(channels: GovernedChannelState[]): void;\r\n}\r\n\r\nexport class GovernedChannelStateProviderFactory {\r\n\tpublic static make(fileBasedStorage: IFloodgateStorageProvider,\r\n\t\thostBasedStorage: IFloodgateSettingStorageCallback): IGovernedChannelStateProvider {\r\n\t\tif (hostBasedStorage) {\r\n\t\t\treturn new HostBasedGovernedChannelStateProvider(fileBasedStorage, hostBasedStorage);\r\n\t\t}\r\n\r\n\t\treturn new FileBasedGovernedChannelStateProvider(fileBasedStorage);\r\n\t}\r\n}\r\n\r\n/**\r\n * Class representing what is stored in the file.\r\n */\r\nclass FileData {\r\n\t// @SerializedName(\"ChannelStates\")\r\n\tpublic ChannelStates: GovernedChannelState[];\r\n}\r\n\r\nexport class HostBasedGovernedChannelStateProvider implements IGovernedChannelStateProvider {\r\n\tprivate fileBasedStateProvider: IGovernedChannelStateProvider;\r\n\tprivate hostBasedStorage: IFloodgateSettingStorageCallback;\r\n\r\n\tpublic constructor(fileBasedStorage: IFloodgateStorageProvider, hostBasedStorage: IFloodgateSettingStorageCallback) {\r\n\t\tif (!hostBasedStorage) {\r\n\t\t\tthrow new Error(\"host-based storage must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.hostBasedStorage = hostBasedStorage;\r\n\r\n\t\t// file-based provider is optional\r\n\t\tif (fileBasedStorage) {\r\n\t\t\tthis.fileBasedStateProvider = new FileBasedGovernedChannelStateProvider(fileBasedStorage);\r\n\t\t}\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic load(): GovernedChannelState[] {\r\n\t\tconst statesFromHost: GovernedChannelState[] = this.getStatesFromHost();\r\n\r\n\t\tlet statesFromFile: GovernedChannelState[];\r\n\t\tif (this.fileBasedStateProvider) {\r\n\t\t\tstatesFromFile = this.fileBasedStateProvider.load();\r\n\t\t}\r\n\r\n\t\tconst StateCollections = StateProviderHelpers.MergeAndUpdateGovernedChannelStates(statesFromFile, statesFromHost);\r\n\t\treturn StateCollections.find(StateListType.Merged);\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic save(states: GovernedChannelState[]): void {\r\n\t\tif (!states) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst statesFromHost: GovernedChannelState[] = this.getStatesFromHost();\r\n\t\tconst StateCollections = StateProviderHelpers.MergeAndUpdateGovernedChannelStates(states, statesFromHost);\r\n\t\tconst toBeUpdatedStates: GovernedChannelState[] = StateCollections.find(StateListType.ToBeUpdated);\r\n\t\tconst mergedStates: GovernedChannelState[] = StateCollections.find(StateListType.Merged);\r\n\r\n\t\t// write delta_data to Host\r\n\t\tif (toBeUpdatedStates) {\r\n\t\t\ttoBeUpdatedStates.forEach((state) => {\r\n\t\t\t\tconst stateValue: string = StateProviderHelpers.makeSettingItemValue(JSON.stringify(state));\r\n\t\t\t\tthis.hostBasedStorage.upsertSettingItem(FileType[FileType.GovernedChannelStates], String(state.getType()), stateValue);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Write merged data to File\r\n\t\tif (this.fileBasedStateProvider) {\r\n\t\t\tthis.fileBasedStateProvider.save(mergedStates);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getStatesFromHost(): GovernedChannelState[] {\r\n\t\tconst states: GovernedChannelState[] = [];\r\n\t\tconst settings: IFloodgateSetting = this.hostBasedStorage.readSettingList(FileType[FileType.GovernedChannelStates]);\r\n\r\n\t\tfor (const key in settings) {\r\n\t\t\tif (!settings.hasOwnProperty(key)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst value = settings[key];\r\n\t\t\tconst dataString: string = StateProviderHelpers.extractSettingItemValueSubString(value);\r\n\r\n\t\t\tlet itemObject: any = {};\r\n\t\t\ttry {\r\n\t\t\t\titemObject = JSON.parse(dataString);\r\n\r\n\t\t\t\tconst newState: GovernedChannelState = GovernedChannelState.deserialize(itemObject);\r\n\t\t\t\tif (newState) {\r\n\t\t\t\t\tstates.push(newState);\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\t\tTelemetryEvent.HostBasedGovernedChannelStateProvider.GetStatesFromHost.Failed,\r\n\t\t\t\t\t{ ErrorMessage: \"Json parsing/deserializing failed. \" + e.toString() + \".  Input:\" + dataString });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn states;\r\n\t}\r\n}\r\n\r\nexport class FileBasedGovernedChannelStateProvider implements IGovernedChannelStateProvider {\r\n\tprivate storage: IFloodgateStorageProvider;\r\n\r\n\tpublic constructor(storage: IFloodgateStorageProvider) {\r\n\t\tif (!storage) {\r\n\t\t\tthrow new Error(\"storage must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.storage = storage;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic load(): GovernedChannelState[] {\r\n\t\t// Load channel state from file using _storageProvider (get back string)\r\n\t\tconst readString: string = this.storage.read(FileType.GovernedChannelStates);\r\n\t\tif (!readString) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\tlet fileData: FileData;\r\n\t\ttry {\r\n\t\t\tfileData = JSON.parse(readString);\r\n\r\n\t\t\tconst result: GovernedChannelState[] = [];\r\n\r\n\t\t\tif (fileData && fileData.ChannelStates) {\r\n\t\t\t\tfileData.ChannelStates.forEach((state) => {\r\n\t\t\t\t\tconst newState: GovernedChannelState = GovernedChannelState.deserialize(state);\r\n\r\n\t\t\t\t\tif (newState) {\r\n\t\t\t\t\t\tresult.push(newState);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t} catch (e) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.FileBasedGovernedChannelStateProvider.Load.Failed,\r\n\t\t\t\t{ ErrorMessage: \"Json parsing/deserializing failed. \" + e.toString() + \".  Input:\" + readString });\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic save(states: GovernedChannelState[]): void {\r\n\t\tif (!states) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst fileData = new FileData();\r\n\t\tfileData.ChannelStates = states;\r\n\t\tconst writeString: string = JSON.stringify(fileData);\r\n\r\n\t\tthis.storage.write(FileType.GovernedChannelStates, writeString);\r\n\t}\r\n}\r\n","import { IDictionary, ISerializable } from \"./Common\";\r\nimport { TelemetryEvent } from \"./Constants\";\r\nimport { FloodgateEngine } from \"./FloodgateEngine\";\r\nimport { SurveyStatCollection } from \"./SurveyStatCollection\";\r\nimport * as Utils from \"./Utils\";\r\n\r\n/**\r\n * StatCollection for EventActivity counts.  Should be used to store/merge\r\n * aggregate values between sessions tracking the same surveys/events\r\n * E.g. A survey that activates after 3 boots.\r\n */\r\n// TODO (gachoi) check the following - VSOBug: 1443010 One bad Stat object fails the entire serialization\r\nexport class SurveyStatCollectionEventActivity extends SurveyStatCollection<SurveyEventActivityStats> implements ISerializable {\r\n\r\n\t/**\r\n\t * Load from Json\r\n\t */\r\n\tpublic static fromJson(json: string): SurveyStatCollectionEventActivity {\r\n\t\tconst statCollection = new SurveyStatCollectionEventActivity();\r\n\r\n\t\tif (!json) {\r\n\t\t\treturn statCollection;\r\n\t\t}\r\n\r\n\t\tlet readStats: SurveyStatCollectionEventActivity;\r\n\t\ttry {\r\n\t\t\treadStats = JSON.parse(json);\r\n\t\t} catch (e) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.SurveyStatCollectionEventActivity.FromJson.Failed,\r\n\t\t\t\t{ ErrorMessage: \"Json parsing failed. \" + e.toString() });\r\n\t\t\treturn statCollection;\r\n\t\t}\r\n\r\n\t\tif (!statCollection.deserialize(readStats)) {\r\n\t\t\treturn new SurveyStatCollectionEventActivity();\r\n\t\t}\r\n\r\n\t\treturn statCollection;\r\n\t}\r\n\r\n\t/**\r\n\t * Convert to Json\r\n\t */\r\n\tpublic static toJson(object: SurveyStatCollectionEventActivity): string {\r\n\t\tif (!object) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.SurveyStatCollectionEventActivity.ToJson.Failed,\r\n\t\t\t\t{ ErrorMessage: \"Input json is null or empty.\" });\r\n\t\t\tobject = new SurveyStatCollectionEventActivity();\r\n\t\t}\r\n\r\n\t\treturn JSON.stringify(object);\r\n\t}\r\n\r\n\t/**\r\n\t * Add another SurveyStatCollectionEventActivity object\r\n\t */\r\n\tpublic accumulate(other: SurveyStatCollectionEventActivity): void {\r\n\t\tif (!other) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst stats: IDictionary<SurveyEventActivityStats> = other.getStats();\r\n\t\t// SurveyEventActivityStats accumulation simply overwrites any keys from 'other' into our collection\r\n\t\tfor (const key in stats) {\r\n\t\t\tif (stats.hasOwnProperty(key)) {\r\n\t\t\t\tlet ourStats: SurveyEventActivityStats = this.getBySurveyId(key);\r\n\r\n\t\t\t\t// If it does not already exist\r\n\t\t\t\tif (!ourStats) {\r\n\t\t\t\t\tourStats = new SurveyEventActivityStats();\r\n\t\t\t\t\tourStats.Counts = [];\r\n\t\t\t\t\tthis.addStats(key, ourStats);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tourStats.ExpirationTimeUtc = stats[key].ExpirationTimeUtc;\r\n\r\n\t\t\t\t// If for some reason the other counts array is larger, resize ourStats.counts\r\n\t\t\t\tif (ourStats.Counts.length < stats[key].Counts.length) {\r\n\t\t\t\t\tconst resizedCounts: number[] = ourStats.Counts.slice();\r\n\t\t\t\t\tourStats.Counts = resizedCounts;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let i = 0; i < stats[key].Counts.length; i++) {\r\n\t\t\t\t\tif (!ourStats.Counts[i]) {\r\n\t\t\t\t\t\tourStats.Counts[i] = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tourStats.Counts[i] += stats[key].Counts[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Method to deserialize SurveyStatCollectionEventActivity\r\n\t * @param input: collection of SurveyStatCollectionEventActivity\r\n\t * Returns result of validation check\r\n\t */\r\n\tpublic deserialize(input: any): boolean {\r\n\t\tconst rawStats: IDictionary<SurveyEventActivityStats> = input.Surveys;\r\n\t\tconst now = new Date();\r\n\r\n\t\tfor (const key in rawStats) {\r\n\t\t\tif (rawStats.hasOwnProperty(key)) {\r\n\t\t\t\tconst newStat = new SurveyEventActivityStats();\r\n\r\n\t\t\t\tif (newStat.deserialize(rawStats[key]) && newStat.ExpirationTimeUtc > now) {\r\n\t\t\t\t\tthis.addStats(key, newStat);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * Validate the Surveys\r\n\t * Returns false if validation fails\r\n\t */\r\n\tpublic validate(): boolean {\r\n\t\treturn Utils.isObject(this.getStats());\r\n\t}\r\n}\r\n\r\nexport class SurveyEventActivityStats implements ISerializable {\r\n\t// The following property names match JSON property names for proper serialization/deserialization\r\n\tpublic ExpirationTimeUtc: Date;\r\n\tpublic Counts: number[];\r\n\r\n\t/**\r\n\t * Method to deserialize a JSON object to class object\r\n\t * @param input: JSON object\r\n\t * Returns result of validation check\r\n\t */\r\n\tpublic deserialize(input: any): boolean {\r\n\t\tthis.ExpirationTimeUtc = input.ExpirationTimeUtc;\r\n\t\tthis.Counts = input.Counts;\r\n\r\n\t\treturn this.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * Method to call after deserialization to validate generated object.\r\n\t * Returns false if not valid.\r\n\t */\r\n\tpublic validate(): boolean {\r\n\t\tif (!this.Counts) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < this.Counts.length; i++) {\r\n\t\t\tconst val: number = this.Counts[i];\r\n\r\n\t\t\tif (!Utils.isNumber(val)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (val < 0) {\r\n\t\t\t\tthis.Counts[i] = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// make it a date object if it's a valid UTC date time value\r\n\t\tif (Utils.isUtcDatetimeString(this.ExpirationTimeUtc)) {\r\n\t\t\tthis.ExpirationTimeUtc = Utils.stringToDate(this.ExpirationTimeUtc);\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n","/*!\r\n * html2canvas 1.0.0-rc.5 <https://html2canvas.hertzen.com>\r\n * Copyright (c) 2019 Niklas von Hertzen <https://hertzen.com>\r\n * Released under MIT License\r\n */\r\n\r\n(function (global, factory) {\r\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\r\n        typeof define === 'function' && define.amd ? define(factory) :\r\n            (global = global || self, global.html2canvas = factory());\r\n}(this, function () {\r\n    'use strict';\r\n\r\n    /*! *****************************************************************************\r\n    Copyright (c) Microsoft Corporation. All rights reserved.\r\n    Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\n    this file except in compliance with the License. You may obtain a copy of the\r\n    License at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\n    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\n    MERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\n    See the Apache Version 2.0 License for specific language governing permissions\r\n    and limitations under the License.\r\n    ***************************************************************************** */\r\n    /* global Reflect, Promise */\r\n\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n\r\n    function __extends(d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    }\r\n\r\n    var __assign = function () {\r\n        __assign = Object.assign || function __assign(t) {\r\n            for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n                s = arguments[i];\r\n                for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n            }\r\n            return t;\r\n        };\r\n        return __assign.apply(this, arguments);\r\n    };\r\n\r\n    function __awaiter(thisArg, _arguments, P, generator) {\r\n        return new (P || (P = Promise))(function (resolve, reject) {\r\n            function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n            function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n            function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n            step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n        });\r\n    }\r\n\r\n    function __generator(thisArg, body) {\r\n        var _ = { label: 0, sent: function () { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n        return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () { return this; }), g;\r\n        function verb(n) { return function (v) { return step([n, v]); }; }\r\n        function step(op) {\r\n            if (f) throw new TypeError(\"Generator is already executing.\");\r\n            while (_) try {\r\n                if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n                if (y = 0, t) op = [op[0] & 2, t.value];\r\n                switch (op[0]) {\r\n                    case 0: case 1: t = op; break;\r\n                    case 4: _.label++; return { value: op[1], done: false };\r\n                    case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                    case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                    default:\r\n                        if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                        if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                        if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                        if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                        if (t[2]) _.ops.pop();\r\n                        _.trys.pop(); continue;\r\n                }\r\n                op = body.call(thisArg, _);\r\n            } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n            if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n        }\r\n    }\r\n\r\n    var Bounds = /** @class */ (function () {\r\n        function Bounds(x, y, w, h) {\r\n            this.left = x;\r\n            this.top = y;\r\n            this.width = w;\r\n            this.height = h;\r\n        }\r\n        Bounds.prototype.add = function (x, y, w, h) {\r\n            return new Bounds(this.left + x, this.top + y, this.width + w, this.height + h);\r\n        };\r\n        Bounds.fromClientRect = function (clientRect) {\r\n            return new Bounds(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\r\n        };\r\n        return Bounds;\r\n    }());\r\n    var parseBounds = function (node) {\r\n        return Bounds.fromClientRect(node.getBoundingClientRect());\r\n    };\r\n    var parseDocumentSize = function (document) {\r\n        var body = document.body;\r\n        var documentElement = document.documentElement;\r\n        if (!body || !documentElement) {\r\n            throw new Error(\"Unable to get document size\");\r\n        }\r\n        var width = Math.max(Math.max(body.scrollWidth, documentElement.scrollWidth), Math.max(body.offsetWidth, documentElement.offsetWidth), Math.max(body.clientWidth, documentElement.clientWidth));\r\n        var height = Math.max(Math.max(body.scrollHeight, documentElement.scrollHeight), Math.max(body.offsetHeight, documentElement.offsetHeight), Math.max(body.clientHeight, documentElement.clientHeight));\r\n        return new Bounds(0, 0, width, height);\r\n    };\r\n\r\n    /*\r\n     * css-line-break 1.1.1 <https://github.com/niklasvh/css-line-break#readme>\r\n     * Copyright (c) 2019 Niklas von Hertzen <https://hertzen.com>\r\n     * Released under MIT License\r\n     */\r\n    var toCodePoints = function (str) {\r\n        var codePoints = [];\r\n        var i = 0;\r\n        var length = str.length;\r\n        while (i < length) {\r\n            var value = str.charCodeAt(i++);\r\n            if (value >= 0xd800 && value <= 0xdbff && i < length) {\r\n                var extra = str.charCodeAt(i++);\r\n                if ((extra & 0xfc00) === 0xdc00) {\r\n                    codePoints.push(((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000);\r\n                }\r\n                else {\r\n                    codePoints.push(value);\r\n                    i--;\r\n                }\r\n            }\r\n            else {\r\n                codePoints.push(value);\r\n            }\r\n        }\r\n        return codePoints;\r\n    };\r\n    var fromCodePoint = function () {\r\n        var codePoints = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            codePoints[_i] = arguments[_i];\r\n        }\r\n        if (String.fromCodePoint) {\r\n            return String.fromCodePoint.apply(String, codePoints);\r\n        }\r\n        var length = codePoints.length;\r\n        if (!length) {\r\n            return '';\r\n        }\r\n        var codeUnits = [];\r\n        var index = -1;\r\n        var result = '';\r\n        while (++index < length) {\r\n            var codePoint = codePoints[index];\r\n            if (codePoint <= 0xffff) {\r\n                codeUnits.push(codePoint);\r\n            }\r\n            else {\r\n                codePoint -= 0x10000;\r\n                codeUnits.push((codePoint >> 10) + 0xd800, codePoint % 0x400 + 0xdc00);\r\n            }\r\n            if (index + 1 === length || codeUnits.length > 0x4000) {\r\n                result += String.fromCharCode.apply(String, codeUnits);\r\n                codeUnits.length = 0;\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\r\n    // Use a lookup table to find the index.\r\n    var lookup = typeof Uint8Array === 'undefined' ? [] : new Uint8Array(256);\r\n    for (var i = 0; i < chars.length; i++) {\r\n        lookup[chars.charCodeAt(i)] = i;\r\n    }\r\n    var decode = function (base64) {\r\n        var bufferLength = base64.length * 0.75, len = base64.length, i, p = 0, encoded1, encoded2, encoded3, encoded4;\r\n        if (base64[base64.length - 1] === '=') {\r\n            bufferLength--;\r\n            if (base64[base64.length - 2] === '=') {\r\n                bufferLength--;\r\n            }\r\n        }\r\n        var buffer = typeof ArrayBuffer !== 'undefined' &&\r\n            typeof Uint8Array !== 'undefined' &&\r\n            typeof Uint8Array.prototype.slice !== 'undefined'\r\n            ? new ArrayBuffer(bufferLength)\r\n            : new Array(bufferLength);\r\n        var bytes = Array.isArray(buffer) ? buffer : new Uint8Array(buffer);\r\n        for (i = 0; i < len; i += 4) {\r\n            encoded1 = lookup[base64.charCodeAt(i)];\r\n            encoded2 = lookup[base64.charCodeAt(i + 1)];\r\n            encoded3 = lookup[base64.charCodeAt(i + 2)];\r\n            encoded4 = lookup[base64.charCodeAt(i + 3)];\r\n            bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\r\n            bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\r\n            bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\r\n        }\r\n        return buffer;\r\n    };\r\n    var polyUint16Array = function (buffer) {\r\n        var length = buffer.length;\r\n        var bytes = [];\r\n        for (var i = 0; i < length; i += 2) {\r\n            bytes.push((buffer[i + 1] << 8) | buffer[i]);\r\n        }\r\n        return bytes;\r\n    };\r\n    var polyUint32Array = function (buffer) {\r\n        var length = buffer.length;\r\n        var bytes = [];\r\n        for (var i = 0; i < length; i += 4) {\r\n            bytes.push((buffer[i + 3] << 24) | (buffer[i + 2] << 16) | (buffer[i + 1] << 8) | buffer[i]);\r\n        }\r\n        return bytes;\r\n    };\r\n\r\n    /** Shift size for getting the index-2 table offset. */\r\n    var UTRIE2_SHIFT_2 = 5;\r\n    /** Shift size for getting the index-1 table offset. */\r\n    var UTRIE2_SHIFT_1 = 6 + 5;\r\n    /**\r\n     * Shift size for shifting left the index array values.\r\n     * Increases possible data size with 16-bit index values at the cost\r\n     * of compactability.\r\n     * This requires data blocks to be aligned by UTRIE2_DATA_GRANULARITY.\r\n     */\r\n    var UTRIE2_INDEX_SHIFT = 2;\r\n    /**\r\n     * Difference between the two shift sizes,\r\n     * for getting an index-1 offset from an index-2 offset. 6=11-5\r\n     */\r\n    var UTRIE2_SHIFT_1_2 = UTRIE2_SHIFT_1 - UTRIE2_SHIFT_2;\r\n    /**\r\n     * The part of the index-2 table for U+D800..U+DBFF stores values for\r\n     * lead surrogate code _units_ not code _points_.\r\n     * Values for lead surrogate code _points_ are indexed with this portion of the table.\r\n     * Length=32=0x20=0x400>>UTRIE2_SHIFT_2. (There are 1024=0x400 lead surrogates.)\r\n     */\r\n    var UTRIE2_LSCP_INDEX_2_OFFSET = 0x10000 >> UTRIE2_SHIFT_2;\r\n    /** Number of entries in a data block. 32=0x20 */\r\n    var UTRIE2_DATA_BLOCK_LENGTH = 1 << UTRIE2_SHIFT_2;\r\n    /** Mask for getting the lower bits for the in-data-block offset. */\r\n    var UTRIE2_DATA_MASK = UTRIE2_DATA_BLOCK_LENGTH - 1;\r\n    var UTRIE2_LSCP_INDEX_2_LENGTH = 0x400 >> UTRIE2_SHIFT_2;\r\n    /** Count the lengths of both BMP pieces. 2080=0x820 */\r\n    var UTRIE2_INDEX_2_BMP_LENGTH = UTRIE2_LSCP_INDEX_2_OFFSET + UTRIE2_LSCP_INDEX_2_LENGTH;\r\n    /**\r\n     * The 2-byte UTF-8 version of the index-2 table follows at offset 2080=0x820.\r\n     * Length 32=0x20 for lead bytes C0..DF, regardless of UTRIE2_SHIFT_2.\r\n     */\r\n    var UTRIE2_UTF8_2B_INDEX_2_OFFSET = UTRIE2_INDEX_2_BMP_LENGTH;\r\n    var UTRIE2_UTF8_2B_INDEX_2_LENGTH = 0x800 >> 6; /* U+0800 is the first code point after 2-byte UTF-8 */\r\n    /**\r\n     * The index-1 table, only used for supplementary code points, at offset 2112=0x840.\r\n     * Variable length, for code points up to highStart, where the last single-value range starts.\r\n     * Maximum length 512=0x200=0x100000>>UTRIE2_SHIFT_1.\r\n     * (For 0x100000 supplementary code points U+10000..U+10ffff.)\r\n     *\r\n     * The part of the index-2 table for supplementary code points starts\r\n     * after this index-1 table.\r\n     *\r\n     * Both the index-1 table and the following part of the index-2 table\r\n     * are omitted completely if there is only BMP data.\r\n     */\r\n    var UTRIE2_INDEX_1_OFFSET = UTRIE2_UTF8_2B_INDEX_2_OFFSET + UTRIE2_UTF8_2B_INDEX_2_LENGTH;\r\n    /**\r\n     * Number of index-1 entries for the BMP. 32=0x20\r\n     * This part of the index-1 table is omitted from the serialized form.\r\n     */\r\n    var UTRIE2_OMITTED_BMP_INDEX_1_LENGTH = 0x10000 >> UTRIE2_SHIFT_1;\r\n    /** Number of entries in an index-2 block. 64=0x40 */\r\n    var UTRIE2_INDEX_2_BLOCK_LENGTH = 1 << UTRIE2_SHIFT_1_2;\r\n    /** Mask for getting the lower bits for the in-index-2-block offset. */\r\n    var UTRIE2_INDEX_2_MASK = UTRIE2_INDEX_2_BLOCK_LENGTH - 1;\r\n    var slice16 = function (view, start, end) {\r\n        if (view.slice) {\r\n            return view.slice(start, end);\r\n        }\r\n        return new Uint16Array(Array.prototype.slice.call(view, start, end));\r\n    };\r\n    var slice32 = function (view, start, end) {\r\n        if (view.slice) {\r\n            return view.slice(start, end);\r\n        }\r\n        return new Uint32Array(Array.prototype.slice.call(view, start, end));\r\n    };\r\n    var createTrieFromBase64 = function (base64) {\r\n        var buffer = decode(base64);\r\n        var view32 = Array.isArray(buffer) ? polyUint32Array(buffer) : new Uint32Array(buffer);\r\n        var view16 = Array.isArray(buffer) ? polyUint16Array(buffer) : new Uint16Array(buffer);\r\n        var headerLength = 24;\r\n        var index = slice16(view16, headerLength / 2, view32[4] / 2);\r\n        var data = view32[5] === 2\r\n            ? slice16(view16, (headerLength + view32[4]) / 2)\r\n            : slice32(view32, Math.ceil((headerLength + view32[4]) / 4));\r\n        return new Trie(view32[0], view32[1], view32[2], view32[3], index, data);\r\n    };\r\n    var Trie = /** @class */ (function () {\r\n        function Trie(initialValue, errorValue, highStart, highValueIndex, index, data) {\r\n            this.initialValue = initialValue;\r\n            this.errorValue = errorValue;\r\n            this.highStart = highStart;\r\n            this.highValueIndex = highValueIndex;\r\n            this.index = index;\r\n            this.data = data;\r\n        }\r\n        /**\r\n         * Get the value for a code point as stored in the Trie.\r\n         *\r\n         * @param codePoint the code point\r\n         * @return the value\r\n         */\r\n        Trie.prototype.get = function (codePoint) {\r\n            var ix;\r\n            if (codePoint >= 0) {\r\n                if (codePoint < 0x0d800 || (codePoint > 0x0dbff && codePoint <= 0x0ffff)) {\r\n                    // Ordinary BMP code point, excluding leading surrogates.\r\n                    // BMP uses a single level lookup.  BMP index starts at offset 0 in the Trie2 index.\r\n                    // 16 bit data is stored in the index array itself.\r\n                    ix = this.index[codePoint >> UTRIE2_SHIFT_2];\r\n                    ix = (ix << UTRIE2_INDEX_SHIFT) + (codePoint & UTRIE2_DATA_MASK);\r\n                    return this.data[ix];\r\n                }\r\n                if (codePoint <= 0xffff) {\r\n                    // Lead Surrogate Code Point.  A Separate index section is stored for\r\n                    // lead surrogate code units and code points.\r\n                    //   The main index has the code unit data.\r\n                    //   For this function, we need the code point data.\r\n                    // Note: this expression could be refactored for slightly improved efficiency, but\r\n                    //       surrogate code points will be so rare in practice that it's not worth it.\r\n                    ix = this.index[UTRIE2_LSCP_INDEX_2_OFFSET + ((codePoint - 0xd800) >> UTRIE2_SHIFT_2)];\r\n                    ix = (ix << UTRIE2_INDEX_SHIFT) + (codePoint & UTRIE2_DATA_MASK);\r\n                    return this.data[ix];\r\n                }\r\n                if (codePoint < this.highStart) {\r\n                    // Supplemental code point, use two-level lookup.\r\n                    ix = UTRIE2_INDEX_1_OFFSET - UTRIE2_OMITTED_BMP_INDEX_1_LENGTH + (codePoint >> UTRIE2_SHIFT_1);\r\n                    ix = this.index[ix];\r\n                    ix += (codePoint >> UTRIE2_SHIFT_2) & UTRIE2_INDEX_2_MASK;\r\n                    ix = this.index[ix];\r\n                    ix = (ix << UTRIE2_INDEX_SHIFT) + (codePoint & UTRIE2_DATA_MASK);\r\n                    return this.data[ix];\r\n                }\r\n                if (codePoint <= 0x10ffff) {\r\n                    return this.data[this.highValueIndex];\r\n                }\r\n            }\r\n            // Fall through.  The code point is outside of the legal range of 0..0x10ffff.\r\n            return this.errorValue;\r\n        };\r\n        return Trie;\r\n    }());\r\n\r\n    var base64 = 'KwAAAAAAAAAACA4AIDoAAPAfAAACAAAAAAAIABAAGABAAEgAUABYAF4AZgBeAGYAYABoAHAAeABeAGYAfACEAIAAiACQAJgAoACoAK0AtQC9AMUAXgBmAF4AZgBeAGYAzQDVAF4AZgDRANkA3gDmAOwA9AD8AAQBDAEUARoBIgGAAIgAJwEvATcBPwFFAU0BTAFUAVwBZAFsAXMBewGDATAAiwGTAZsBogGkAawBtAG8AcIBygHSAdoB4AHoAfAB+AH+AQYCDgIWAv4BHgImAi4CNgI+AkUCTQJTAlsCYwJrAnECeQKBAk0CiQKRApkCoQKoArACuALAAsQCzAIwANQC3ALkAjAA7AL0AvwCAQMJAxADGAMwACADJgMuAzYDPgOAAEYDSgNSA1IDUgNaA1oDYANiA2IDgACAAGoDgAByA3YDfgOAAIQDgACKA5IDmgOAAIAAogOqA4AAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAK8DtwOAAIAAvwPHA88D1wPfAyAD5wPsA/QD/AOAAIAABAQMBBIEgAAWBB4EJgQuBDMEIAM7BEEEXgBJBCADUQRZBGEEaQQwADAAcQQ+AXkEgQSJBJEEgACYBIAAoASoBK8EtwQwAL8ExQSAAIAAgACAAIAAgACgAM0EXgBeAF4AXgBeAF4AXgBeANUEXgDZBOEEXgDpBPEE+QQBBQkFEQUZBSEFKQUxBTUFPQVFBUwFVAVcBV4AYwVeAGsFcwV7BYMFiwWSBV4AmgWgBacFXgBeAF4AXgBeAKsFXgCyBbEFugW7BcIFwgXIBcIFwgXQBdQF3AXkBesF8wX7BQMGCwYTBhsGIwYrBjMGOwZeAD8GRwZNBl4AVAZbBl4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAGMGXgBqBnEGXgBeAF4AXgBeAF4AXgBeAF4AXgB5BoAG4wSGBo4GkwaAAIADHgR5AF4AXgBeAJsGgABGA4AAowarBrMGswagALsGwwbLBjAA0wbaBtoG3QbaBtoG2gbaBtoG2gblBusG8wb7BgMHCwcTBxsHCwcjBysHMAc1BzUHOgdCB9oGSgdSB1oHYAfaBloHaAfaBlIH2gbaBtoG2gbaBtoG2gbaBjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHbQdeAF4ANQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQd1B30HNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B4MH2gaKB68EgACAAIAAgACAAIAAgACAAI8HlwdeAJ8HpweAAIAArwe3B14AXgC/B8UHygcwANAH2AfgB4AA6AfwBz4B+AcACFwBCAgPCBcIogEYAR8IJwiAAC8INwg/CCADRwhPCFcIXwhnCEoDGgSAAIAAgABvCHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIhAiLCI4IMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAANQc1BzUHNQc1BzUHNQc1BzUHNQc1B54INQc1B6II2gaqCLIIugiAAIAAvgjGCIAAgACAAIAAgACAAIAAgACAAIAAywiHAYAA0wiAANkI3QjlCO0I9Aj8CIAAgACAAAIJCgkSCRoJIgknCTYHLwk3CZYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiAAIAAAAFAAXgBeAGAAcABeAHwAQACQAKAArQC9AJ4AXgBeAE0A3gBRAN4A7AD8AMwBGgEAAKcBNwEFAUwBXAF4QkhCmEKnArcCgAHHAsABz4LAAcABwAHAAd+C6ABoAG+C/4LAAcABwAHAAc+DF4MAAcAB54M3gweDV4Nng3eDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEeDqABVg6WDqABoQ6gAaABoAHXDvcONw/3DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DncPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB7cPPwlGCU4JMACAAIAAgABWCV4JYQmAAGkJcAl4CXwJgAkwADAAMAAwAIgJgACLCZMJgACZCZ8JowmrCYAAswkwAF4AXgB8AIAAuwkABMMJyQmAAM4JgADVCTAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAqwYWBNkIMAAwADAAMADdCeAJ6AnuCR4E9gkwAP4JBQoNCjAAMACAABUK0wiAAB0KJAosCjQKgAAwADwKQwqAAEsKvQmdCVMKWwowADAAgACAALcEMACAAGMKgABrCjAAMAAwADAAMAAwADAAMAAwADAAMAAeBDAAMAAwADAAMAAwADAAMAAwADAAMAAwAIkEPQFzCnoKiQSCCooKkAqJBJgKoAqkCokEGAGsCrQKvArBCjAAMADJCtEKFQHZCuEK/gHpCvEKMAAwADAAMACAAIwE+QowAIAAPwEBCzAAMAAwADAAMACAAAkLEQswAIAAPwEZCyELgAAOCCkLMAAxCzkLMAAwADAAMAAwADAAXgBeAEELMAAwADAAMAAwADAAMAAwAEkLTQtVC4AAXAtkC4AAiQkwADAAMAAwADAAMAAwADAAbAtxC3kLgAuFC4sLMAAwAJMLlwufCzAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAApwswADAAMACAAIAAgACvC4AAgACAAIAAgACAALcLMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAvwuAAMcLgACAAIAAgACAAIAAyguAAIAAgACAAIAA0QswADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAANkLgACAAIAA4AswADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACJCR4E6AswADAAhwHwC4AA+AsADAgMEAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMACAAIAAGAwdDCUMMAAwAC0MNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQw1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHPQwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADUHNQc1BzUHNQc1BzUHNQc2BzAAMAA5DDUHNQc1BzUHNQc1BzUHNQc1BzUHNQdFDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAATQxSDFoMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAF4AXgBeAF4AXgBeAF4AYgxeAGoMXgBxDHkMfwxeAIUMXgBeAI0MMAAwADAAMAAwAF4AXgCVDJ0MMAAwADAAMABeAF4ApQxeAKsMswy7DF4Awgy9DMoMXgBeAF4AXgBeAF4AXgBeAF4AXgDRDNkMeQBqCeAM3Ax8AOYM7Az0DPgMXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgCgAAANoAAHDQ4NFg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAeDSYNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAC4NMABeAF4ANg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAD4NRg1ODVYNXg1mDTAAbQ0wADAAMAAwADAAMAAwADAA2gbaBtoG2gbaBtoG2gbaBnUNeg3CBYANwgWFDdoGjA3aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gaUDZwNpA2oDdoG2gawDbcNvw3HDdoG2gbPDdYN3A3fDeYN2gbsDfMN2gbaBvoN/g3aBgYODg7aBl4AXgBeABYOXgBeACUG2gYeDl4AJA5eACwO2w3aBtoGMQ45DtoG2gbaBtoGQQ7aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B1EO2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQdZDjUHNQc1BzUHNQc1B2EONQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHaA41BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B3AO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B2EO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBkkOeA6gAKAAoAAwADAAMAAwAKAAoACgAKAAoACgAKAAgA4wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAD//wQABAAEAAQABAAEAAQABAAEAA0AAwABAAEAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAKABMAFwAeABsAGgAeABcAFgASAB4AGwAYAA8AGAAcAEsASwBLAEsASwBLAEsASwBLAEsAGAAYAB4AHgAeABMAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAFgAbABIAHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYADQARAB4ABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkAFgAaABsAGwAbAB4AHQAdAB4ATwAXAB4ADQAeAB4AGgAbAE8ATwAOAFAAHQAdAB0ATwBPABcATwBPAE8AFgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwArAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAAQABAANAA0ASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAUAArACsAKwArACsAKwArACsABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAGgAaAFAAUABQAFAAUABMAB4AGwBQAB4AKwArACsABAAEAAQAKwBQAFAAUABQAFAAUAArACsAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUAArAFAAUAArACsABAArAAQABAAEAAQABAArACsAKwArAAQABAArACsABAAEAAQAKwArACsABAArACsAKwArACsAKwArAFAAUABQAFAAKwBQACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwAEAAQAUABQAFAABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQAKwArAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeABsAKwArACsAKwArACsAKwBQAAQABAAEAAQABAAEACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAKwArACsAKwArACsAKwArAAQABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwAEAFAAKwBQAFAAUABQAFAAUAArACsAKwBQAFAAUAArAFAAUABQAFAAKwArACsAUABQACsAUAArAFAAUAArACsAKwBQAFAAKwArACsAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQAKwArACsABAAEAAQAKwAEAAQABAAEACsAKwBQACsAKwArACsAKwArAAQAKwArACsAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAB4AHgAeAB4AHgAeABsAHgArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArAFAAUABQACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAB4AUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArACsAKwArACsAKwArAFAAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwArAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAKwBcAFwAKwBcACsAKwBcACsAKwArACsAKwArAFwAXABcAFwAKwBcAFwAXABcAFwAXABcACsAXABcAFwAKwBcACsAXAArACsAXABcACsAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgArACoAKgBcACsAKwBcAFwAXABcAFwAKwBcACsAKgAqACoAKgAqACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAFwAXABcAFwAUAAOAA4ADgAOAB4ADgAOAAkADgAOAA0ACQATABMAEwATABMACQAeABMAHgAeAB4ABAAEAB4AHgAeAB4AHgAeAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUAANAAQAHgAEAB4ABAAWABEAFgARAAQABABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAAQABAAEAAQABAANAAQABABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsADQANAB4AHgAeAB4AHgAeAAQAHgAeAB4AHgAeAB4AKwAeAB4ADgAOAA0ADgAeAB4AHgAeAB4ACQAJACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgAeAB4AHgBcAFwAXABcAFwAXAAqACoAKgAqAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAKgAqACoAKgAqACoAKgBcAFwAXAAqACoAKgAqAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAXAAqAEsASwBLAEsASwBLAEsASwBLAEsAKgAqACoAKgAqACoAUABQAFAAUABQAFAAKwBQACsAKwArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQACsAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwAEAAQABAAeAA0AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAEQArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAADQANAA0AUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAA0ADQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoADQANABUAXAANAB4ADQAbAFwAKgArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAB4AHgATABMADQANAA4AHgATABMAHgAEAAQABAAJACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAUABQAFAAUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwAeACsAKwArABMAEwBLAEsASwBLAEsASwBLAEsASwBLAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwBcAFwAXABcAFwAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcACsAKwArACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwAeAB4AXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsABABLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKgAqACoAKgAqACoAKgBcACoAKgAqACoAKgAqACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAUABQAFAAUABQAFAAUAArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4ADQANAA0ADQAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAHgAeAB4AHgBQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwANAA0ADQANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwBQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsABAAEAAQAHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAABABQAFAAUABQAAQABAAEAFAAUAAEAAQABAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAKwBQACsAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAKwArAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAKwAeAB4AHgAeAB4AHgAeAA4AHgArAA0ADQANAA0ADQANAA0ACQANAA0ADQAIAAQACwAEAAQADQAJAA0ADQAMAB0AHQAeABcAFwAWABcAFwAXABYAFwAdAB0AHgAeABQAFAAUAA0AAQABAAQABAAEAAQABAAJABoAGgAaABoAGgAaABoAGgAeABcAFwAdABUAFQAeAB4AHgAeAB4AHgAYABYAEQAVABUAFQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgANAB4ADQANAA0ADQAeAA0ADQANAAcAHgAeAB4AHgArAAQABAAEAAQABAAEAAQABAAEAAQAUABQACsAKwBPAFAAUABQAFAAUAAeAB4AHgAWABEATwBQAE8ATwBPAE8AUABQAFAAUABQAB4AHgAeABYAEQArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGgAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgBQABoAHgAdAB4AUAAeABoAHgAeAB4AHgAeAB4AHgAeAB4ATwAeAFAAGwAeAB4AUABQAFAAUABQAB4AHgAeAB0AHQAeAFAAHgBQAB4AUAAeAFAATwBQAFAAHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AUABQAFAAUABPAE8AUABQAFAAUABQAE8AUABQAE8AUABPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAE8ATwBPAE8ATwBPAE8ATwBPAE8AUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAATwAeAB4AKwArACsAKwAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB0AHQAeAB4AHgAdAB0AHgAeAB0AHgAeAB4AHQAeAB0AGwAbAB4AHQAeAB4AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB0AHgAdAB4AHQAdAB0AHQAdAB0AHgAdAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAdAB0AHQAdAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAlACUAHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB0AHQAeAB4AHgAeAB0AHQAdAB4AHgAdAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB0AHQAeAB4AHQAeAB4AHgAeAB0AHQAeAB4AHgAeACUAJQAdAB0AJQAeACUAJQAlACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHQAdAB0AHgAdACUAHQAdAB4AHQAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHQAdAB0AHQAlAB4AJQAlACUAHQAlACUAHQAdAB0AJQAlAB0AHQAlAB0AHQAlACUAJQAeAB0AHgAeAB4AHgAdAB0AJQAdAB0AHQAdAB0AHQAlACUAJQAlACUAHQAlACUAIAAlAB0AHQAlACUAJQAlACUAJQAlACUAHgAeAB4AJQAlACAAIAAgACAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeABcAFwAXABcAFwAXAB4AEwATACUAHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACUAJQBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwArACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAE8ATwBPAE8ATwBPAE8ATwAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeACsAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUAArACsAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQBQAFAAUABQACsAKwArACsAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAABAAEAAQAKwAEAAQAKwArACsAKwArAAQABAAEAAQAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsABAAEAAQAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsADQANAA0ADQANAA0ADQANAB4AKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAUABQAFAAUABQAA0ADQANAA0ADQANABQAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwANAA0ADQANAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAeAAQABAAEAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLACsADQArAB4AKwArAAQABAAEAAQAUABQAB4AUAArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwAEAAQABAAEAAQABAAEAAQABAAOAA0ADQATABMAHgAeAB4ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0AUABQAFAAUAAEAAQAKwArAAQADQANAB4AUAArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXABcAA0ADQANACoASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUAArACsAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANACsADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEcARwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwAeAAQABAANAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAEAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUAArACsAUAArACsAUABQACsAKwBQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAeAB4ADQANAA0ADQAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAArAAQABAArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAEAAQABAAEAAQABAAEACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAFgAWAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAKwBQACsAKwArACsAKwArAFAAKwArACsAKwBQACsAUAArAFAAKwBQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQACsAUAArAFAAKwBQACsAUABQACsAUAArACsAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAUABQAFAAUAArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUAArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAlACUAJQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeACUAJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeACUAJQAlACUAJQAeACUAJQAlACUAJQAgACAAIAAlACUAIAAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIQAhACEAIQAhACUAJQAgACAAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAIAAlACUAJQAlACAAJQAgACAAIAAgACAAIAAgACAAIAAlACUAJQAgACUAJQAlACUAIAAgACAAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeACUAHgAlAB4AJQAlACUAJQAlACAAJQAlACUAJQAeACUAHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAIAAgACAAIAAgAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFwAXABcAFQAVABUAHgAeAB4AHgAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAlACAAIAAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsA';\r\n\r\n    /* @flow */\r\n    var LETTER_NUMBER_MODIFIER = 50;\r\n    // Non-tailorable Line Breaking Classes\r\n    var BK = 1; //  Cause a line break (after)\r\n    var CR = 2; //  Cause a line break (after), except between CR and LF\r\n    var LF = 3; //  Cause a line break (after)\r\n    var CM = 4; //  Prohibit a line break between the character and the preceding character\r\n    var NL = 5; //  Cause a line break (after)\r\n    var WJ = 7; //  Prohibit line breaks before and after\r\n    var ZW = 8; //  Provide a break opportunity\r\n    var GL = 9; //  Prohibit line breaks before and after\r\n    var SP = 10; // Enable indirect line breaks\r\n    var ZWJ = 11; // Prohibit line breaks within joiner sequences\r\n    // Break Opportunities\r\n    var B2 = 12; //  Provide a line break opportunity before and after the character\r\n    var BA = 13; //  Generally provide a line break opportunity after the character\r\n    var BB = 14; //  Generally provide a line break opportunity before the character\r\n    var HY = 15; //  Provide a line break opportunity after the character, except in numeric context\r\n    var CB = 16; //   Provide a line break opportunity contingent on additional information\r\n    // Characters Prohibiting Certain Breaks\r\n    var CL = 17; //  Prohibit line breaks before\r\n    var CP = 18; //  Prohibit line breaks before\r\n    var EX = 19; //  Prohibit line breaks before\r\n    var IN = 20; //  Allow only indirect line breaks between pairs\r\n    var NS = 21; //  Allow only indirect line breaks before\r\n    var OP = 22; //  Prohibit line breaks after\r\n    var QU = 23; //  Act like they are both opening and closing\r\n    // Numeric Context\r\n    var IS = 24; //  Prevent breaks after any and before numeric\r\n    var NU = 25; //  Form numeric expressions for line breaking purposes\r\n    var PO = 26; //  Do not break following a numeric expression\r\n    var PR = 27; //  Do not break in front of a numeric expression\r\n    var SY = 28; //  Prevent a break before; and allow a break after\r\n    // Other Characters\r\n    var AI = 29; //  Act like AL when the resolvedEAW is N; otherwise; act as ID\r\n    var AL = 30; //  Are alphabetic characters or symbols that are used with alphabetic characters\r\n    var CJ = 31; //  Treat as NS or ID for strict or normal breaking.\r\n    var EB = 32; //  Do not break from following Emoji Modifier\r\n    var EM = 33; //  Do not break from preceding Emoji Base\r\n    var H2 = 34; //  Form Korean syllable blocks\r\n    var H3 = 35; //  Form Korean syllable blocks\r\n    var HL = 36; //  Do not break around a following hyphen; otherwise act as Alphabetic\r\n    var ID = 37; //  Break before or after; except in some numeric context\r\n    var JL = 38; //  Form Korean syllable blocks\r\n    var JV = 39; //  Form Korean syllable blocks\r\n    var JT = 40; //  Form Korean syllable blocks\r\n    var RI = 41; //  Keep pairs together. For pairs; break before and after other classes\r\n    var SA = 42; //  Provide a line break opportunity contingent on additional, language-specific context analysis\r\n    var XX = 43; //  Have as yet unknown line breaking behavior or unassigned code positions\r\n    var BREAK_MANDATORY = '!';\r\n    var BREAK_NOT_ALLOWED = '';\r\n    var BREAK_ALLOWED = '';\r\n    var UnicodeTrie = createTrieFromBase64(base64);\r\n    var ALPHABETICS = [AL, HL];\r\n    var HARD_LINE_BREAKS = [BK, CR, LF, NL];\r\n    var SPACE = [SP, ZW];\r\n    var PREFIX_POSTFIX = [PR, PO];\r\n    var LINE_BREAKS = HARD_LINE_BREAKS.concat(SPACE);\r\n    var KOREAN_SYLLABLE_BLOCK = [JL, JV, JT, H2, H3];\r\n    var HYPHEN = [HY, BA];\r\n    var codePointsToCharacterClasses = function (codePoints, lineBreak) {\r\n        if (lineBreak === void 0) { lineBreak = 'strict'; }\r\n        var types = [];\r\n        var indicies = [];\r\n        var categories = [];\r\n        codePoints.forEach(function (codePoint, index) {\r\n            var classType = UnicodeTrie.get(codePoint);\r\n            if (classType > LETTER_NUMBER_MODIFIER) {\r\n                categories.push(true);\r\n                classType -= LETTER_NUMBER_MODIFIER;\r\n            }\r\n            else {\r\n                categories.push(false);\r\n            }\r\n            if (['normal', 'auto', 'loose'].indexOf(lineBreak) !== -1) {\r\n                // U+2010,  U+2013,  U+301C,  U+30A0\r\n                if ([0x2010, 0x2013, 0x301c, 0x30a0].indexOf(codePoint) !== -1) {\r\n                    indicies.push(index);\r\n                    return types.push(CB);\r\n                }\r\n            }\r\n            if (classType === CM || classType === ZWJ) {\r\n                // LB10 Treat any remaining combining mark or ZWJ as AL.\r\n                if (index === 0) {\r\n                    indicies.push(index);\r\n                    return types.push(AL);\r\n                }\r\n                // LB9 Do not break a combining character sequence; treat it as if it has the line breaking class of\r\n                // the base character in all of the following rules. Treat ZWJ as if it were CM.\r\n                var prev = types[index - 1];\r\n                if (LINE_BREAKS.indexOf(prev) === -1) {\r\n                    indicies.push(indicies[index - 1]);\r\n                    return types.push(prev);\r\n                }\r\n                indicies.push(index);\r\n                return types.push(AL);\r\n            }\r\n            indicies.push(index);\r\n            if (classType === CJ) {\r\n                return types.push(lineBreak === 'strict' ? NS : ID);\r\n            }\r\n            if (classType === SA) {\r\n                return types.push(AL);\r\n            }\r\n            if (classType === AI) {\r\n                return types.push(AL);\r\n            }\r\n            // For supplementary characters, a useful default is to treat characters in the range 10000..1FFFD as AL\r\n            // and characters in the ranges 20000..2FFFD and 30000..3FFFD as ID, until the implementation can be revised\r\n            // to take into account the actual line breaking properties for these characters.\r\n            if (classType === XX) {\r\n                if ((codePoint >= 0x20000 && codePoint <= 0x2fffd) || (codePoint >= 0x30000 && codePoint <= 0x3fffd)) {\r\n                    return types.push(ID);\r\n                }\r\n                else {\r\n                    return types.push(AL);\r\n                }\r\n            }\r\n            types.push(classType);\r\n        });\r\n        return [indicies, types, categories];\r\n    };\r\n    var isAdjacentWithSpaceIgnored = function (a, b, currentIndex, classTypes) {\r\n        var current = classTypes[currentIndex];\r\n        if (Array.isArray(a) ? a.indexOf(current) !== -1 : a === current) {\r\n            var i = currentIndex;\r\n            while (i <= classTypes.length) {\r\n                i++;\r\n                var next = classTypes[i];\r\n                if (next === b) {\r\n                    return true;\r\n                }\r\n                if (next !== SP) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (current === SP) {\r\n            var i = currentIndex;\r\n            while (i > 0) {\r\n                i--;\r\n                var prev = classTypes[i];\r\n                if (Array.isArray(a) ? a.indexOf(prev) !== -1 : a === prev) {\r\n                    var n = currentIndex;\r\n                    while (n <= classTypes.length) {\r\n                        n++;\r\n                        var next = classTypes[n];\r\n                        if (next === b) {\r\n                            return true;\r\n                        }\r\n                        if (next !== SP) {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                if (prev !== SP) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    var previousNonSpaceClassType = function (currentIndex, classTypes) {\r\n        var i = currentIndex;\r\n        while (i >= 0) {\r\n            var type = classTypes[i];\r\n            if (type === SP) {\r\n                i--;\r\n            }\r\n            else {\r\n                return type;\r\n            }\r\n        }\r\n        return 0;\r\n    };\r\n    var _lineBreakAtIndex = function (codePoints, classTypes, indicies, index, forbiddenBreaks) {\r\n        if (indicies[index] === 0) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        var currentIndex = index - 1;\r\n        if (Array.isArray(forbiddenBreaks) && forbiddenBreaks[currentIndex] === true) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        var beforeIndex = currentIndex - 1;\r\n        var afterIndex = currentIndex + 1;\r\n        var current = classTypes[currentIndex];\r\n        // LB4 Always break after hard line breaks.\r\n        // LB5 Treat CR followed by LF, as well as CR, LF, and NL as hard line breaks.\r\n        var before = beforeIndex >= 0 ? classTypes[beforeIndex] : 0;\r\n        var next = classTypes[afterIndex];\r\n        if (current === CR && next === LF) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        if (HARD_LINE_BREAKS.indexOf(current) !== -1) {\r\n            return BREAK_MANDATORY;\r\n        }\r\n        // LB6 Do not break before hard line breaks.\r\n        if (HARD_LINE_BREAKS.indexOf(next) !== -1) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB7 Do not break before spaces or zero width space.\r\n        if (SPACE.indexOf(next) !== -1) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB8 Break before any character following a zero-width space, even if one or more spaces intervene.\r\n        if (previousNonSpaceClassType(currentIndex, classTypes) === ZW) {\r\n            return BREAK_ALLOWED;\r\n        }\r\n        // LB8a Do not break between a zero width joiner and an ideograph, emoji base or emoji modifier.\r\n        if (UnicodeTrie.get(codePoints[currentIndex]) === ZWJ && (next === ID || next === EB || next === EM)) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB11 Do not break before or after Word joiner and related characters.\r\n        if (current === WJ || next === WJ) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB12 Do not break after NBSP and related characters.\r\n        if (current === GL) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB12a Do not break before NBSP and related characters, except after spaces and hyphens.\r\n        if ([SP, BA, HY].indexOf(current) === -1 && next === GL) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB13 Do not break before ] or ! or ; or /, even after spaces.\r\n        if ([CL, CP, EX, IS, SY].indexOf(next) !== -1) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB14 Do not break after [, even after spaces.\r\n        if (previousNonSpaceClassType(currentIndex, classTypes) === OP) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB15 Do not break within [, even with intervening spaces.\r\n        if (isAdjacentWithSpaceIgnored(QU, OP, currentIndex, classTypes)) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB16 Do not break between closing punctuation and a nonstarter (lb=NS), even with intervening spaces.\r\n        if (isAdjacentWithSpaceIgnored([CL, CP], NS, currentIndex, classTypes)) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB17 Do not break within , even with intervening spaces.\r\n        if (isAdjacentWithSpaceIgnored(B2, B2, currentIndex, classTypes)) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB18 Break after spaces.\r\n        if (current === SP) {\r\n            return BREAK_ALLOWED;\r\n        }\r\n        // LB19 Do not break before or after quotation marks, such as   .\r\n        if (current === QU || next === QU) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB20 Break before and after unresolved CB.\r\n        if (next === CB || current === CB) {\r\n            return BREAK_ALLOWED;\r\n        }\r\n        // LB21 Do not break before hyphen-minus, other hyphens, fixed-width spaces, small kana, and other non-starters, or after acute accents.\r\n        if ([BA, HY, NS].indexOf(next) !== -1 || current === BB) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB21a Don't break after Hebrew + Hyphen.\r\n        if (before === HL && HYPHEN.indexOf(current) !== -1) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB21b Dont break between Solidus and Hebrew letters.\r\n        if (current === SY && next === HL) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB22 Do not break between two ellipses, or between letters, numbers or exclamations and ellipsis.\r\n        if (next === IN && ALPHABETICS.concat(IN, EX, NU, ID, EB, EM).indexOf(current) !== -1) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB23 Do not break between digits and letters.\r\n        if ((ALPHABETICS.indexOf(next) !== -1 && current === NU) || (ALPHABETICS.indexOf(current) !== -1 && next === NU)) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB23a Do not break between numeric prefixes and ideographs, or between ideographs and numeric postfixes.\r\n        if ((current === PR && [ID, EB, EM].indexOf(next) !== -1) ||\r\n            ([ID, EB, EM].indexOf(current) !== -1 && next === PO)) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB24 Do not break between numeric prefix/postfix and letters, or between letters and prefix/postfix.\r\n        if ((ALPHABETICS.indexOf(current) !== -1 && PREFIX_POSTFIX.indexOf(next) !== -1) ||\r\n            (PREFIX_POSTFIX.indexOf(current) !== -1 && ALPHABETICS.indexOf(next) !== -1)) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB25 Do not break between the following pairs of classes relevant to numbers:\r\n        if (\r\n            // (PR | PO)  ( OP | HY )? NU\r\n            ([PR, PO].indexOf(current) !== -1 &&\r\n                (next === NU || ([OP, HY].indexOf(next) !== -1 && classTypes[afterIndex + 1] === NU))) ||\r\n            // ( OP | HY )  NU\r\n            ([OP, HY].indexOf(current) !== -1 && next === NU) ||\r\n            // NU \t(NU | SY | IS)\r\n            (current === NU && [NU, SY, IS].indexOf(next) !== -1)) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // NU (NU | SY | IS)*  (NU | SY | IS | CL | CP)\r\n        if ([NU, SY, IS, CL, CP].indexOf(next) !== -1) {\r\n            var prevIndex = currentIndex;\r\n            while (prevIndex >= 0) {\r\n                var type = classTypes[prevIndex];\r\n                if (type === NU) {\r\n                    return BREAK_NOT_ALLOWED;\r\n                }\r\n                else if ([SY, IS].indexOf(type) !== -1) {\r\n                    prevIndex--;\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        // NU (NU | SY | IS)* (CL | CP)?  (PO | PR))\r\n        if ([PR, PO].indexOf(next) !== -1) {\r\n            var prevIndex = [CL, CP].indexOf(current) !== -1 ? beforeIndex : currentIndex;\r\n            while (prevIndex >= 0) {\r\n                var type = classTypes[prevIndex];\r\n                if (type === NU) {\r\n                    return BREAK_NOT_ALLOWED;\r\n                }\r\n                else if ([SY, IS].indexOf(type) !== -1) {\r\n                    prevIndex--;\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        // LB26 Do not break a Korean syllable.\r\n        if ((JL === current && [JL, JV, H2, H3].indexOf(next) !== -1) ||\r\n            ([JV, H2].indexOf(current) !== -1 && [JV, JT].indexOf(next) !== -1) ||\r\n            ([JT, H3].indexOf(current) !== -1 && next === JT)) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB27 Treat a Korean Syllable Block the same as ID.\r\n        if ((KOREAN_SYLLABLE_BLOCK.indexOf(current) !== -1 && [IN, PO].indexOf(next) !== -1) ||\r\n            (KOREAN_SYLLABLE_BLOCK.indexOf(next) !== -1 && current === PR)) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB28 Do not break between alphabetics (at).\r\n        if (ALPHABETICS.indexOf(current) !== -1 && ALPHABETICS.indexOf(next) !== -1) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB29 Do not break between numeric punctuation and alphabetics (e.g.).\r\n        if (current === IS && ALPHABETICS.indexOf(next) !== -1) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB30 Do not break between letters, numbers, or ordinary symbols and opening or closing parentheses.\r\n        if ((ALPHABETICS.concat(NU).indexOf(current) !== -1 && next === OP) ||\r\n            (ALPHABETICS.concat(NU).indexOf(next) !== -1 && current === CP)) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        // LB30a Break between two regional indicator symbols if and only if there are an even number of regional\r\n        // indicators preceding the position of the break.\r\n        if (current === RI && next === RI) {\r\n            var i = indicies[currentIndex];\r\n            var count = 1;\r\n            while (i > 0) {\r\n                i--;\r\n                if (classTypes[i] === RI) {\r\n                    count++;\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n            if (count % 2 !== 0) {\r\n                return BREAK_NOT_ALLOWED;\r\n            }\r\n        }\r\n        // LB30b Do not break between an emoji base and an emoji modifier.\r\n        if (current === EB && next === EM) {\r\n            return BREAK_NOT_ALLOWED;\r\n        }\r\n        return BREAK_ALLOWED;\r\n    };\r\n    var cssFormattedClasses = function (codePoints, options) {\r\n        if (!options) {\r\n            options = { lineBreak: 'normal', wordBreak: 'normal' };\r\n        }\r\n        var _a = codePointsToCharacterClasses(codePoints, options.lineBreak), indicies = _a[0], classTypes = _a[1], isLetterNumber = _a[2];\r\n        if (options.wordBreak === 'break-all' || options.wordBreak === 'break-word') {\r\n            classTypes = classTypes.map(function (type) { return ([NU, AL, SA].indexOf(type) !== -1 ? ID : type); });\r\n        }\r\n        var forbiddenBreakpoints = options.wordBreak === 'keep-all'\r\n            ? isLetterNumber.map(function (letterNumber, i) {\r\n                return letterNumber && codePoints[i] >= 0x4e00 && codePoints[i] <= 0x9fff;\r\n            })\r\n            : undefined;\r\n        return [indicies, classTypes, forbiddenBreakpoints];\r\n    };\r\n    var Break = /** @class */ (function () {\r\n        function Break(codePoints, lineBreak, start, end) {\r\n            this.codePoints = codePoints;\r\n            this.required = lineBreak === BREAK_MANDATORY;\r\n            this.start = start;\r\n            this.end = end;\r\n        }\r\n        Break.prototype.slice = function () {\r\n            return fromCodePoint.apply(void 0, this.codePoints.slice(this.start, this.end));\r\n        };\r\n        return Break;\r\n    }());\r\n    var LineBreaker = function (str, options) {\r\n        var codePoints = toCodePoints(str);\r\n        var _a = cssFormattedClasses(codePoints, options), indicies = _a[0], classTypes = _a[1], forbiddenBreakpoints = _a[2];\r\n        var length = codePoints.length;\r\n        var lastEnd = 0;\r\n        var nextIndex = 0;\r\n        return {\r\n            next: function () {\r\n                if (nextIndex >= length) {\r\n                    return { done: true, value: null };\r\n                }\r\n                var lineBreak = BREAK_NOT_ALLOWED;\r\n                while (nextIndex < length &&\r\n                    (lineBreak = _lineBreakAtIndex(codePoints, classTypes, indicies, ++nextIndex, forbiddenBreakpoints)) ===\r\n                    BREAK_NOT_ALLOWED) { }\r\n                if (lineBreak !== BREAK_NOT_ALLOWED || nextIndex === length) {\r\n                    var value = new Break(codePoints, lineBreak, lastEnd, nextIndex);\r\n                    lastEnd = nextIndex;\r\n                    return { value: value, done: false };\r\n                }\r\n                return { done: true, value: null };\r\n            },\r\n        };\r\n    };\r\n\r\n    // https://www.w3.org/TR/css-syntax-3\r\n    var TokenType;\r\n    (function (TokenType) {\r\n        TokenType[TokenType[\"STRING_TOKEN\"] = 0] = \"STRING_TOKEN\";\r\n        TokenType[TokenType[\"BAD_STRING_TOKEN\"] = 1] = \"BAD_STRING_TOKEN\";\r\n        TokenType[TokenType[\"LEFT_PARENTHESIS_TOKEN\"] = 2] = \"LEFT_PARENTHESIS_TOKEN\";\r\n        TokenType[TokenType[\"RIGHT_PARENTHESIS_TOKEN\"] = 3] = \"RIGHT_PARENTHESIS_TOKEN\";\r\n        TokenType[TokenType[\"COMMA_TOKEN\"] = 4] = \"COMMA_TOKEN\";\r\n        TokenType[TokenType[\"HASH_TOKEN\"] = 5] = \"HASH_TOKEN\";\r\n        TokenType[TokenType[\"DELIM_TOKEN\"] = 6] = \"DELIM_TOKEN\";\r\n        TokenType[TokenType[\"AT_KEYWORD_TOKEN\"] = 7] = \"AT_KEYWORD_TOKEN\";\r\n        TokenType[TokenType[\"PREFIX_MATCH_TOKEN\"] = 8] = \"PREFIX_MATCH_TOKEN\";\r\n        TokenType[TokenType[\"DASH_MATCH_TOKEN\"] = 9] = \"DASH_MATCH_TOKEN\";\r\n        TokenType[TokenType[\"INCLUDE_MATCH_TOKEN\"] = 10] = \"INCLUDE_MATCH_TOKEN\";\r\n        TokenType[TokenType[\"LEFT_CURLY_BRACKET_TOKEN\"] = 11] = \"LEFT_CURLY_BRACKET_TOKEN\";\r\n        TokenType[TokenType[\"RIGHT_CURLY_BRACKET_TOKEN\"] = 12] = \"RIGHT_CURLY_BRACKET_TOKEN\";\r\n        TokenType[TokenType[\"SUFFIX_MATCH_TOKEN\"] = 13] = \"SUFFIX_MATCH_TOKEN\";\r\n        TokenType[TokenType[\"SUBSTRING_MATCH_TOKEN\"] = 14] = \"SUBSTRING_MATCH_TOKEN\";\r\n        TokenType[TokenType[\"DIMENSION_TOKEN\"] = 15] = \"DIMENSION_TOKEN\";\r\n        TokenType[TokenType[\"PERCENTAGE_TOKEN\"] = 16] = \"PERCENTAGE_TOKEN\";\r\n        TokenType[TokenType[\"NUMBER_TOKEN\"] = 17] = \"NUMBER_TOKEN\";\r\n        TokenType[TokenType[\"FUNCTION\"] = 18] = \"FUNCTION\";\r\n        TokenType[TokenType[\"FUNCTION_TOKEN\"] = 19] = \"FUNCTION_TOKEN\";\r\n        TokenType[TokenType[\"IDENT_TOKEN\"] = 20] = \"IDENT_TOKEN\";\r\n        TokenType[TokenType[\"COLUMN_TOKEN\"] = 21] = \"COLUMN_TOKEN\";\r\n        TokenType[TokenType[\"URL_TOKEN\"] = 22] = \"URL_TOKEN\";\r\n        TokenType[TokenType[\"BAD_URL_TOKEN\"] = 23] = \"BAD_URL_TOKEN\";\r\n        TokenType[TokenType[\"CDC_TOKEN\"] = 24] = \"CDC_TOKEN\";\r\n        TokenType[TokenType[\"CDO_TOKEN\"] = 25] = \"CDO_TOKEN\";\r\n        TokenType[TokenType[\"COLON_TOKEN\"] = 26] = \"COLON_TOKEN\";\r\n        TokenType[TokenType[\"SEMICOLON_TOKEN\"] = 27] = \"SEMICOLON_TOKEN\";\r\n        TokenType[TokenType[\"LEFT_SQUARE_BRACKET_TOKEN\"] = 28] = \"LEFT_SQUARE_BRACKET_TOKEN\";\r\n        TokenType[TokenType[\"RIGHT_SQUARE_BRACKET_TOKEN\"] = 29] = \"RIGHT_SQUARE_BRACKET_TOKEN\";\r\n        TokenType[TokenType[\"UNICODE_RANGE_TOKEN\"] = 30] = \"UNICODE_RANGE_TOKEN\";\r\n        TokenType[TokenType[\"WHITESPACE_TOKEN\"] = 31] = \"WHITESPACE_TOKEN\";\r\n        TokenType[TokenType[\"EOF_TOKEN\"] = 32] = \"EOF_TOKEN\";\r\n    })(TokenType || (TokenType = {}));\r\n    var FLAG_UNRESTRICTED = 1 << 0;\r\n    var FLAG_ID = 1 << 1;\r\n    var FLAG_INTEGER = 1 << 2;\r\n    var FLAG_NUMBER = 1 << 3;\r\n    var LINE_FEED = 0x000a;\r\n    var SOLIDUS = 0x002f;\r\n    var REVERSE_SOLIDUS = 0x005c;\r\n    var CHARACTER_TABULATION = 0x0009;\r\n    var SPACE$1 = 0x0020;\r\n    var QUOTATION_MARK = 0x0022;\r\n    var EQUALS_SIGN = 0x003d;\r\n    var NUMBER_SIGN = 0x0023;\r\n    var DOLLAR_SIGN = 0x0024;\r\n    var PERCENTAGE_SIGN = 0x0025;\r\n    var APOSTROPHE = 0x0027;\r\n    var LEFT_PARENTHESIS = 0x0028;\r\n    var RIGHT_PARENTHESIS = 0x0029;\r\n    var LOW_LINE = 0x005f;\r\n    var HYPHEN_MINUS = 0x002d;\r\n    var EXCLAMATION_MARK = 0x0021;\r\n    var LESS_THAN_SIGN = 0x003c;\r\n    var GREATER_THAN_SIGN = 0x003e;\r\n    var COMMERCIAL_AT = 0x0040;\r\n    var LEFT_SQUARE_BRACKET = 0x005b;\r\n    var RIGHT_SQUARE_BRACKET = 0x005d;\r\n    var CIRCUMFLEX_ACCENT = 0x003d;\r\n    var LEFT_CURLY_BRACKET = 0x007b;\r\n    var QUESTION_MARK = 0x003f;\r\n    var RIGHT_CURLY_BRACKET = 0x007d;\r\n    var VERTICAL_LINE = 0x007c;\r\n    var TILDE = 0x007e;\r\n    var CONTROL = 0x0080;\r\n    var REPLACEMENT_CHARACTER = 0xfffd;\r\n    var ASTERISK = 0x002a;\r\n    var PLUS_SIGN = 0x002b;\r\n    var COMMA = 0x002c;\r\n    var COLON = 0x003a;\r\n    var SEMICOLON = 0x003b;\r\n    var FULL_STOP = 0x002e;\r\n    var NULL = 0x0000;\r\n    var BACKSPACE = 0x0008;\r\n    var LINE_TABULATION = 0x000b;\r\n    var SHIFT_OUT = 0x000e;\r\n    var INFORMATION_SEPARATOR_ONE = 0x001f;\r\n    var DELETE = 0x007f;\r\n    var EOF = -1;\r\n    var ZERO = 0x0030;\r\n    var a = 0x0061;\r\n    var e = 0x0065;\r\n    var f = 0x0066;\r\n    var u = 0x0075;\r\n    var z = 0x007a;\r\n    var A = 0x0041;\r\n    var E = 0x0045;\r\n    var F = 0x0046;\r\n    var U = 0x0055;\r\n    var Z = 0x005a;\r\n    var isDigit = function (codePoint) { return codePoint >= ZERO && codePoint <= 0x0039; };\r\n    var isSurrogateCodePoint = function (codePoint) { return codePoint >= 0xd800 && codePoint <= 0xdfff; };\r\n    var isHex = function (codePoint) {\r\n        return isDigit(codePoint) || (codePoint >= A && codePoint <= F) || (codePoint >= a && codePoint <= f);\r\n    };\r\n    var isLowerCaseLetter = function (codePoint) { return codePoint >= a && codePoint <= z; };\r\n    var isUpperCaseLetter = function (codePoint) { return codePoint >= A && codePoint <= Z; };\r\n    var isLetter = function (codePoint) { return isLowerCaseLetter(codePoint) || isUpperCaseLetter(codePoint); };\r\n    var isNonASCIICodePoint = function (codePoint) { return codePoint >= CONTROL; };\r\n    var isWhiteSpace = function (codePoint) {\r\n        return codePoint === LINE_FEED || codePoint === CHARACTER_TABULATION || codePoint === SPACE$1;\r\n    };\r\n    var isNameStartCodePoint = function (codePoint) {\r\n        return isLetter(codePoint) || isNonASCIICodePoint(codePoint) || codePoint === LOW_LINE;\r\n    };\r\n    var isNameCodePoint = function (codePoint) {\r\n        return isNameStartCodePoint(codePoint) || isDigit(codePoint) || codePoint === HYPHEN_MINUS;\r\n    };\r\n    var isNonPrintableCodePoint = function (codePoint) {\r\n        return ((codePoint >= NULL && codePoint <= BACKSPACE) ||\r\n            codePoint === LINE_TABULATION ||\r\n            (codePoint >= SHIFT_OUT && codePoint <= INFORMATION_SEPARATOR_ONE) ||\r\n            codePoint === DELETE);\r\n    };\r\n    var isValidEscape = function (c1, c2) {\r\n        if (c1 !== REVERSE_SOLIDUS) {\r\n            return false;\r\n        }\r\n        return c2 !== LINE_FEED;\r\n    };\r\n    var isIdentifierStart = function (c1, c2, c3) {\r\n        if (c1 === HYPHEN_MINUS) {\r\n            return isNameStartCodePoint(c2) || isValidEscape(c2, c3);\r\n        }\r\n        else if (isNameStartCodePoint(c1)) {\r\n            return true;\r\n        }\r\n        else if (c1 === REVERSE_SOLIDUS && isValidEscape(c1, c2)) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    var isNumberStart = function (c1, c2, c3) {\r\n        if (c1 === PLUS_SIGN || c1 === HYPHEN_MINUS) {\r\n            if (isDigit(c2)) {\r\n                return true;\r\n            }\r\n            return c2 === FULL_STOP && isDigit(c3);\r\n        }\r\n        if (c1 === FULL_STOP) {\r\n            return isDigit(c2);\r\n        }\r\n        return isDigit(c1);\r\n    };\r\n    var stringToNumber = function (codePoints) {\r\n        var c = 0;\r\n        var sign = 1;\r\n        if (codePoints[c] === PLUS_SIGN || codePoints[c] === HYPHEN_MINUS) {\r\n            if (codePoints[c] === HYPHEN_MINUS) {\r\n                sign = -1;\r\n            }\r\n            c++;\r\n        }\r\n        var integers = [];\r\n        while (isDigit(codePoints[c])) {\r\n            integers.push(codePoints[c++]);\r\n        }\r\n        var int = integers.length ? parseInt(fromCodePoint.apply(void 0, integers), 10) : 0;\r\n        if (codePoints[c] === FULL_STOP) {\r\n            c++;\r\n        }\r\n        var fraction = [];\r\n        while (isDigit(codePoints[c])) {\r\n            fraction.push(codePoints[c++]);\r\n        }\r\n        var fracd = fraction.length;\r\n        var frac = fracd ? parseInt(fromCodePoint.apply(void 0, fraction), 10) : 0;\r\n        if (codePoints[c] === E || codePoints[c] === e) {\r\n            c++;\r\n        }\r\n        var expsign = 1;\r\n        if (codePoints[c] === PLUS_SIGN || codePoints[c] === HYPHEN_MINUS) {\r\n            if (codePoints[c] === HYPHEN_MINUS) {\r\n                expsign = -1;\r\n            }\r\n            c++;\r\n        }\r\n        var exponent = [];\r\n        while (isDigit(codePoints[c])) {\r\n            exponent.push(codePoints[c++]);\r\n        }\r\n        var exp = exponent.length ? parseInt(fromCodePoint.apply(void 0, exponent), 10) : 0;\r\n        return sign * (int + frac * Math.pow(10, -fracd)) * Math.pow(10, expsign * exp);\r\n    };\r\n    var LEFT_PARENTHESIS_TOKEN = {\r\n        type: TokenType.LEFT_PARENTHESIS_TOKEN\r\n    };\r\n    var RIGHT_PARENTHESIS_TOKEN = {\r\n        type: TokenType.RIGHT_PARENTHESIS_TOKEN\r\n    };\r\n    var COMMA_TOKEN = { type: TokenType.COMMA_TOKEN };\r\n    var SUFFIX_MATCH_TOKEN = { type: TokenType.SUFFIX_MATCH_TOKEN };\r\n    var PREFIX_MATCH_TOKEN = { type: TokenType.PREFIX_MATCH_TOKEN };\r\n    var COLUMN_TOKEN = { type: TokenType.COLUMN_TOKEN };\r\n    var DASH_MATCH_TOKEN = { type: TokenType.DASH_MATCH_TOKEN };\r\n    var INCLUDE_MATCH_TOKEN = { type: TokenType.INCLUDE_MATCH_TOKEN };\r\n    var LEFT_CURLY_BRACKET_TOKEN = {\r\n        type: TokenType.LEFT_CURLY_BRACKET_TOKEN\r\n    };\r\n    var RIGHT_CURLY_BRACKET_TOKEN = {\r\n        type: TokenType.RIGHT_CURLY_BRACKET_TOKEN\r\n    };\r\n    var SUBSTRING_MATCH_TOKEN = { type: TokenType.SUBSTRING_MATCH_TOKEN };\r\n    var BAD_URL_TOKEN = { type: TokenType.BAD_URL_TOKEN };\r\n    var BAD_STRING_TOKEN = { type: TokenType.BAD_STRING_TOKEN };\r\n    var CDO_TOKEN = { type: TokenType.CDO_TOKEN };\r\n    var CDC_TOKEN = { type: TokenType.CDC_TOKEN };\r\n    var COLON_TOKEN = { type: TokenType.COLON_TOKEN };\r\n    var SEMICOLON_TOKEN = { type: TokenType.SEMICOLON_TOKEN };\r\n    var LEFT_SQUARE_BRACKET_TOKEN = {\r\n        type: TokenType.LEFT_SQUARE_BRACKET_TOKEN\r\n    };\r\n    var RIGHT_SQUARE_BRACKET_TOKEN = {\r\n        type: TokenType.RIGHT_SQUARE_BRACKET_TOKEN\r\n    };\r\n    var WHITESPACE_TOKEN = { type: TokenType.WHITESPACE_TOKEN };\r\n    var EOF_TOKEN = { type: TokenType.EOF_TOKEN };\r\n    var Tokenizer = /** @class */ (function () {\r\n        function Tokenizer() {\r\n            this._value = [];\r\n        }\r\n        Tokenizer.prototype.write = function (chunk) {\r\n            this._value = this._value.concat(toCodePoints(chunk));\r\n        };\r\n        Tokenizer.prototype.read = function () {\r\n            var tokens = [];\r\n            var token = this.consumeToken();\r\n            while (token !== EOF_TOKEN) {\r\n                tokens.push(token);\r\n                token = this.consumeToken();\r\n            }\r\n            return tokens;\r\n        };\r\n        Tokenizer.prototype.consumeToken = function () {\r\n            var codePoint = this.consumeCodePoint();\r\n            switch (codePoint) {\r\n                case QUOTATION_MARK:\r\n                    return this.consumeStringToken(QUOTATION_MARK);\r\n                case NUMBER_SIGN:\r\n                    var c1 = this.peekCodePoint(0);\r\n                    var c2 = this.peekCodePoint(1);\r\n                    var c3 = this.peekCodePoint(2);\r\n                    if (isNameCodePoint(c1) || isValidEscape(c2, c3)) {\r\n                        var flags = isIdentifierStart(c1, c2, c3) ? FLAG_ID : FLAG_UNRESTRICTED;\r\n                        var value = this.consumeName();\r\n                        return { type: TokenType.HASH_TOKEN, value: value, flags: flags };\r\n                    }\r\n                    break;\r\n                case DOLLAR_SIGN:\r\n                    if (this.peekCodePoint(0) === EQUALS_SIGN) {\r\n                        this.consumeCodePoint();\r\n                        return SUFFIX_MATCH_TOKEN;\r\n                    }\r\n                    break;\r\n                case APOSTROPHE:\r\n                    return this.consumeStringToken(APOSTROPHE);\r\n                case LEFT_PARENTHESIS:\r\n                    return LEFT_PARENTHESIS_TOKEN;\r\n                case RIGHT_PARENTHESIS:\r\n                    return RIGHT_PARENTHESIS_TOKEN;\r\n                case ASTERISK:\r\n                    if (this.peekCodePoint(0) === EQUALS_SIGN) {\r\n                        this.consumeCodePoint();\r\n                        return SUBSTRING_MATCH_TOKEN;\r\n                    }\r\n                    break;\r\n                case PLUS_SIGN:\r\n                    if (isNumberStart(codePoint, this.peekCodePoint(0), this.peekCodePoint(1))) {\r\n                        this.reconsumeCodePoint(codePoint);\r\n                        return this.consumeNumericToken();\r\n                    }\r\n                    break;\r\n                case COMMA:\r\n                    return COMMA_TOKEN;\r\n                case HYPHEN_MINUS:\r\n                    var e1 = codePoint;\r\n                    var e2 = this.peekCodePoint(0);\r\n                    var e3 = this.peekCodePoint(1);\r\n                    if (isNumberStart(e1, e2, e3)) {\r\n                        this.reconsumeCodePoint(codePoint);\r\n                        return this.consumeNumericToken();\r\n                    }\r\n                    if (isIdentifierStart(e1, e2, e3)) {\r\n                        this.reconsumeCodePoint(codePoint);\r\n                        return this.consumeIdentLikeToken();\r\n                    }\r\n                    if (e2 === HYPHEN_MINUS && e3 === GREATER_THAN_SIGN) {\r\n                        this.consumeCodePoint();\r\n                        this.consumeCodePoint();\r\n                        return CDC_TOKEN;\r\n                    }\r\n                    break;\r\n                case FULL_STOP:\r\n                    if (isNumberStart(codePoint, this.peekCodePoint(0), this.peekCodePoint(1))) {\r\n                        this.reconsumeCodePoint(codePoint);\r\n                        return this.consumeNumericToken();\r\n                    }\r\n                    break;\r\n                case SOLIDUS:\r\n                    if (this.peekCodePoint(0) === ASTERISK) {\r\n                        this.consumeCodePoint();\r\n                        while (true) {\r\n                            var c = this.consumeCodePoint();\r\n                            if (c === ASTERISK) {\r\n                                c = this.consumeCodePoint();\r\n                                if (c === SOLIDUS) {\r\n                                    return this.consumeToken();\r\n                                }\r\n                            }\r\n                            if (c === EOF) {\r\n                                return this.consumeToken();\r\n                            }\r\n                        }\r\n                    }\r\n                    break;\r\n                case COLON:\r\n                    return COLON_TOKEN;\r\n                case SEMICOLON:\r\n                    return SEMICOLON_TOKEN;\r\n                case LESS_THAN_SIGN:\r\n                    if (this.peekCodePoint(0) === EXCLAMATION_MARK &&\r\n                        this.peekCodePoint(1) === HYPHEN_MINUS &&\r\n                        this.peekCodePoint(2) === HYPHEN_MINUS) {\r\n                        this.consumeCodePoint();\r\n                        this.consumeCodePoint();\r\n                        return CDO_TOKEN;\r\n                    }\r\n                    break;\r\n                case COMMERCIAL_AT:\r\n                    var a1 = this.peekCodePoint(0);\r\n                    var a2 = this.peekCodePoint(1);\r\n                    var a3 = this.peekCodePoint(2);\r\n                    if (isIdentifierStart(a1, a2, a3)) {\r\n                        var value = this.consumeName();\r\n                        return { type: TokenType.AT_KEYWORD_TOKEN, value: value };\r\n                    }\r\n                    break;\r\n                case LEFT_SQUARE_BRACKET:\r\n                    return LEFT_SQUARE_BRACKET_TOKEN;\r\n                case REVERSE_SOLIDUS:\r\n                    if (isValidEscape(codePoint, this.peekCodePoint(0))) {\r\n                        this.reconsumeCodePoint(codePoint);\r\n                        return this.consumeIdentLikeToken();\r\n                    }\r\n                    break;\r\n                case RIGHT_SQUARE_BRACKET:\r\n                    return RIGHT_SQUARE_BRACKET_TOKEN;\r\n                case CIRCUMFLEX_ACCENT:\r\n                    if (this.peekCodePoint(0) === EQUALS_SIGN) {\r\n                        this.consumeCodePoint();\r\n                        return PREFIX_MATCH_TOKEN;\r\n                    }\r\n                    break;\r\n                case LEFT_CURLY_BRACKET:\r\n                    return LEFT_CURLY_BRACKET_TOKEN;\r\n                case RIGHT_CURLY_BRACKET:\r\n                    return RIGHT_CURLY_BRACKET_TOKEN;\r\n                case u:\r\n                case U:\r\n                    var u1 = this.peekCodePoint(0);\r\n                    var u2 = this.peekCodePoint(1);\r\n                    if (u1 === PLUS_SIGN && (isHex(u2) || u2 === QUESTION_MARK)) {\r\n                        this.consumeCodePoint();\r\n                        this.consumeUnicodeRangeToken();\r\n                    }\r\n                    this.reconsumeCodePoint(codePoint);\r\n                    return this.consumeIdentLikeToken();\r\n                case VERTICAL_LINE:\r\n                    if (this.peekCodePoint(0) === EQUALS_SIGN) {\r\n                        this.consumeCodePoint();\r\n                        return DASH_MATCH_TOKEN;\r\n                    }\r\n                    if (this.peekCodePoint(0) === VERTICAL_LINE) {\r\n                        this.consumeCodePoint();\r\n                        return COLUMN_TOKEN;\r\n                    }\r\n                    break;\r\n                case TILDE:\r\n                    if (this.peekCodePoint(0) === EQUALS_SIGN) {\r\n                        this.consumeCodePoint();\r\n                        return INCLUDE_MATCH_TOKEN;\r\n                    }\r\n                    break;\r\n                case EOF:\r\n                    return EOF_TOKEN;\r\n            }\r\n            if (isWhiteSpace(codePoint)) {\r\n                this.consumeWhiteSpace();\r\n                return WHITESPACE_TOKEN;\r\n            }\r\n            if (isDigit(codePoint)) {\r\n                this.reconsumeCodePoint(codePoint);\r\n                return this.consumeNumericToken();\r\n            }\r\n            if (isNameStartCodePoint(codePoint)) {\r\n                this.reconsumeCodePoint(codePoint);\r\n                return this.consumeIdentLikeToken();\r\n            }\r\n            return { type: TokenType.DELIM_TOKEN, value: fromCodePoint(codePoint) };\r\n        };\r\n        Tokenizer.prototype.consumeCodePoint = function () {\r\n            var value = this._value.shift();\r\n            return typeof value === 'undefined' ? -1 : value;\r\n        };\r\n        Tokenizer.prototype.reconsumeCodePoint = function (codePoint) {\r\n            this._value.unshift(codePoint);\r\n        };\r\n        Tokenizer.prototype.peekCodePoint = function (delta) {\r\n            if (delta >= this._value.length) {\r\n                return -1;\r\n            }\r\n            return this._value[delta];\r\n        };\r\n        Tokenizer.prototype.consumeUnicodeRangeToken = function () {\r\n            var digits = [];\r\n            var codePoint = this.consumeCodePoint();\r\n            while (isHex(codePoint) && digits.length < 6) {\r\n                digits.push(codePoint);\r\n                codePoint = this.consumeCodePoint();\r\n            }\r\n            var questionMarks = false;\r\n            while (codePoint === QUESTION_MARK && digits.length < 6) {\r\n                digits.push(codePoint);\r\n                codePoint = this.consumeCodePoint();\r\n                questionMarks = true;\r\n            }\r\n            if (questionMarks) {\r\n                var start_1 = parseInt(fromCodePoint.apply(void 0, digits.map(function (digit) { return (digit === QUESTION_MARK ? ZERO : digit); })), 16);\r\n                var end = parseInt(fromCodePoint.apply(void 0, digits.map(function (digit) { return (digit === QUESTION_MARK ? F : digit); })), 16);\r\n                return { type: TokenType.UNICODE_RANGE_TOKEN, start: start_1, end: end };\r\n            }\r\n            var start = parseInt(fromCodePoint.apply(void 0, digits), 16);\r\n            if (this.peekCodePoint(0) === HYPHEN_MINUS && isHex(this.peekCodePoint(1))) {\r\n                this.consumeCodePoint();\r\n                codePoint = this.consumeCodePoint();\r\n                var endDigits = [];\r\n                while (isHex(codePoint) && endDigits.length < 6) {\r\n                    endDigits.push(codePoint);\r\n                    codePoint = this.consumeCodePoint();\r\n                }\r\n                var end = parseInt(fromCodePoint.apply(void 0, endDigits), 16);\r\n                return { type: TokenType.UNICODE_RANGE_TOKEN, start: start, end: end };\r\n            }\r\n            else {\r\n                return { type: TokenType.UNICODE_RANGE_TOKEN, start: start, end: start };\r\n            }\r\n        };\r\n        Tokenizer.prototype.consumeIdentLikeToken = function () {\r\n            var value = this.consumeName();\r\n            if (value.toLowerCase() === 'url' && this.peekCodePoint(0) === LEFT_PARENTHESIS) {\r\n                this.consumeCodePoint();\r\n                return this.consumeUrlToken();\r\n            }\r\n            else if (this.peekCodePoint(0) === LEFT_PARENTHESIS) {\r\n                this.consumeCodePoint();\r\n                return { type: TokenType.FUNCTION_TOKEN, value: value };\r\n            }\r\n            return { type: TokenType.IDENT_TOKEN, value: value };\r\n        };\r\n        Tokenizer.prototype.consumeUrlToken = function () {\r\n            var value = [];\r\n            this.consumeWhiteSpace();\r\n            if (this.peekCodePoint(0) === EOF) {\r\n                return { type: TokenType.URL_TOKEN, value: '' };\r\n            }\r\n            var next = this.peekCodePoint(0);\r\n            if (next === APOSTROPHE || next === QUOTATION_MARK) {\r\n                var stringToken = this.consumeStringToken(this.consumeCodePoint());\r\n                if (stringToken.type === TokenType.STRING_TOKEN) {\r\n                    this.consumeWhiteSpace();\r\n                    if (this.peekCodePoint(0) === EOF || this.peekCodePoint(0) === RIGHT_PARENTHESIS) {\r\n                        this.consumeCodePoint();\r\n                        return { type: TokenType.URL_TOKEN, value: stringToken.value };\r\n                    }\r\n                }\r\n                this.consumeBadUrlRemnants();\r\n                return BAD_URL_TOKEN;\r\n            }\r\n            while (true) {\r\n                var codePoint = this.consumeCodePoint();\r\n                if (codePoint === EOF || codePoint === RIGHT_PARENTHESIS) {\r\n                    return { type: TokenType.URL_TOKEN, value: fromCodePoint.apply(void 0, value) };\r\n                }\r\n                else if (isWhiteSpace(codePoint)) {\r\n                    this.consumeWhiteSpace();\r\n                    if (this.peekCodePoint(0) === EOF || this.peekCodePoint(0) === RIGHT_PARENTHESIS) {\r\n                        this.consumeCodePoint();\r\n                        return { type: TokenType.URL_TOKEN, value: fromCodePoint.apply(void 0, value) };\r\n                    }\r\n                    this.consumeBadUrlRemnants();\r\n                    return BAD_URL_TOKEN;\r\n                }\r\n                else if (codePoint === QUOTATION_MARK ||\r\n                    codePoint === APOSTROPHE ||\r\n                    codePoint === LEFT_PARENTHESIS ||\r\n                    isNonPrintableCodePoint(codePoint)) {\r\n                    this.consumeBadUrlRemnants();\r\n                    return BAD_URL_TOKEN;\r\n                }\r\n                else if (codePoint === REVERSE_SOLIDUS) {\r\n                    if (isValidEscape(codePoint, this.peekCodePoint(0))) {\r\n                        value.push(this.consumeEscapedCodePoint());\r\n                    }\r\n                    else {\r\n                        this.consumeBadUrlRemnants();\r\n                        return BAD_URL_TOKEN;\r\n                    }\r\n                }\r\n                else {\r\n                    value.push(codePoint);\r\n                }\r\n            }\r\n        };\r\n        Tokenizer.prototype.consumeWhiteSpace = function () {\r\n            while (isWhiteSpace(this.peekCodePoint(0))) {\r\n                this.consumeCodePoint();\r\n            }\r\n        };\r\n        Tokenizer.prototype.consumeBadUrlRemnants = function () {\r\n            while (true) {\r\n                var codePoint = this.consumeCodePoint();\r\n                if (codePoint === RIGHT_PARENTHESIS || codePoint === EOF) {\r\n                    return;\r\n                }\r\n                if (isValidEscape(codePoint, this.peekCodePoint(0))) {\r\n                    this.consumeEscapedCodePoint();\r\n                }\r\n            }\r\n        };\r\n        Tokenizer.prototype.consumeStringSlice = function (count) {\r\n            var SLICE_STACK_SIZE = 60000;\r\n            var value = '';\r\n            while (count > 0) {\r\n                var amount = Math.min(SLICE_STACK_SIZE, count);\r\n                value += fromCodePoint.apply(void 0, this._value.splice(0, amount));\r\n                count -= amount;\r\n            }\r\n            this._value.shift();\r\n            return value;\r\n        };\r\n        Tokenizer.prototype.consumeStringToken = function (endingCodePoint) {\r\n            var value = '';\r\n            var i = 0;\r\n            do {\r\n                var codePoint = this._value[i];\r\n                if (codePoint === EOF || codePoint === undefined || codePoint === endingCodePoint) {\r\n                    value += this.consumeStringSlice(i);\r\n                    return { type: TokenType.STRING_TOKEN, value: value };\r\n                }\r\n                if (codePoint === LINE_FEED) {\r\n                    this._value.splice(0, i);\r\n                    return BAD_STRING_TOKEN;\r\n                }\r\n                if (codePoint === REVERSE_SOLIDUS) {\r\n                    var next = this._value[i + 1];\r\n                    if (next !== EOF && next !== undefined) {\r\n                        if (next === LINE_FEED) {\r\n                            value += this.consumeStringSlice(i);\r\n                            i = -1;\r\n                            this._value.shift();\r\n                        }\r\n                        else if (isValidEscape(codePoint, next)) {\r\n                            value += this.consumeStringSlice(i);\r\n                            value += fromCodePoint(this.consumeEscapedCodePoint());\r\n                            i = -1;\r\n                        }\r\n                    }\r\n                }\r\n                i++;\r\n            } while (true);\r\n        };\r\n        Tokenizer.prototype.consumeNumber = function () {\r\n            var repr = [];\r\n            var type = FLAG_INTEGER;\r\n            var c1 = this.peekCodePoint(0);\r\n            if (c1 === PLUS_SIGN || c1 === HYPHEN_MINUS) {\r\n                repr.push(this.consumeCodePoint());\r\n            }\r\n            while (isDigit(this.peekCodePoint(0))) {\r\n                repr.push(this.consumeCodePoint());\r\n            }\r\n            c1 = this.peekCodePoint(0);\r\n            var c2 = this.peekCodePoint(1);\r\n            if (c1 === FULL_STOP && isDigit(c2)) {\r\n                repr.push(this.consumeCodePoint(), this.consumeCodePoint());\r\n                type = FLAG_NUMBER;\r\n                while (isDigit(this.peekCodePoint(0))) {\r\n                    repr.push(this.consumeCodePoint());\r\n                }\r\n            }\r\n            c1 = this.peekCodePoint(0);\r\n            c2 = this.peekCodePoint(1);\r\n            var c3 = this.peekCodePoint(2);\r\n            if ((c1 === E || c1 === e) && (((c2 === PLUS_SIGN || c2 === HYPHEN_MINUS) && isDigit(c3)) || isDigit(c2))) {\r\n                repr.push(this.consumeCodePoint(), this.consumeCodePoint());\r\n                type = FLAG_NUMBER;\r\n                while (isDigit(this.peekCodePoint(0))) {\r\n                    repr.push(this.consumeCodePoint());\r\n                }\r\n            }\r\n            return [stringToNumber(repr), type];\r\n        };\r\n        Tokenizer.prototype.consumeNumericToken = function () {\r\n            var _a = this.consumeNumber(), number = _a[0], flags = _a[1];\r\n            var c1 = this.peekCodePoint(0);\r\n            var c2 = this.peekCodePoint(1);\r\n            var c3 = this.peekCodePoint(2);\r\n            if (isIdentifierStart(c1, c2, c3)) {\r\n                var unit = this.consumeName();\r\n                return { type: TokenType.DIMENSION_TOKEN, number: number, flags: flags, unit: unit };\r\n            }\r\n            if (c1 === PERCENTAGE_SIGN) {\r\n                this.consumeCodePoint();\r\n                return { type: TokenType.PERCENTAGE_TOKEN, number: number, flags: flags };\r\n            }\r\n            return { type: TokenType.NUMBER_TOKEN, number: number, flags: flags };\r\n        };\r\n        Tokenizer.prototype.consumeEscapedCodePoint = function () {\r\n            var codePoint = this.consumeCodePoint();\r\n            if (isHex(codePoint)) {\r\n                var hex = fromCodePoint(codePoint);\r\n                while (isHex(this.peekCodePoint(0)) && hex.length < 6) {\r\n                    hex += fromCodePoint(this.consumeCodePoint());\r\n                }\r\n                if (isWhiteSpace(this.peekCodePoint(0))) {\r\n                    this.consumeCodePoint();\r\n                }\r\n                var hexCodePoint = parseInt(hex, 16);\r\n                if (hexCodePoint === 0 || isSurrogateCodePoint(hexCodePoint) || hexCodePoint > 0x10ffff) {\r\n                    return REPLACEMENT_CHARACTER;\r\n                }\r\n                return hexCodePoint;\r\n            }\r\n            if (codePoint === EOF) {\r\n                return REPLACEMENT_CHARACTER;\r\n            }\r\n            return codePoint;\r\n        };\r\n        Tokenizer.prototype.consumeName = function () {\r\n            var result = '';\r\n            while (true) {\r\n                var codePoint = this.consumeCodePoint();\r\n                if (isNameCodePoint(codePoint)) {\r\n                    result += fromCodePoint(codePoint);\r\n                }\r\n                else if (isValidEscape(codePoint, this.peekCodePoint(0))) {\r\n                    result += fromCodePoint(this.consumeEscapedCodePoint());\r\n                }\r\n                else {\r\n                    this.reconsumeCodePoint(codePoint);\r\n                    return result;\r\n                }\r\n            }\r\n        };\r\n        return Tokenizer;\r\n    }());\r\n\r\n    var Parser = /** @class */ (function () {\r\n        function Parser(tokens) {\r\n            this._tokens = tokens;\r\n        }\r\n        Parser.create = function (value) {\r\n            var tokenizer = new Tokenizer();\r\n            tokenizer.write(value);\r\n            return new Parser(tokenizer.read());\r\n        };\r\n        Parser.parseValue = function (value) {\r\n            return Parser.create(value).parseComponentValue();\r\n        };\r\n        Parser.parseValues = function (value) {\r\n            return Parser.create(value).parseComponentValues();\r\n        };\r\n        Parser.prototype.parseComponentValue = function () {\r\n            var token = this.consumeToken();\r\n            while (token.type === TokenType.WHITESPACE_TOKEN) {\r\n                token = this.consumeToken();\r\n            }\r\n            if (token.type === TokenType.EOF_TOKEN) {\r\n                throw new SyntaxError(\"Error parsing CSS component value, unexpected EOF\");\r\n            }\r\n            this.reconsumeToken(token);\r\n            var value = this.consumeComponentValue();\r\n            do {\r\n                token = this.consumeToken();\r\n            } while (token.type === TokenType.WHITESPACE_TOKEN);\r\n            if (token.type === TokenType.EOF_TOKEN) {\r\n                return value;\r\n            }\r\n            throw new SyntaxError(\"Error parsing CSS component value, multiple values found when expecting only one\");\r\n        };\r\n        Parser.prototype.parseComponentValues = function () {\r\n            var values = [];\r\n            while (true) {\r\n                var value = this.consumeComponentValue();\r\n                if (value.type === TokenType.EOF_TOKEN) {\r\n                    return values;\r\n                }\r\n                values.push(value);\r\n                values.push();\r\n            }\r\n        };\r\n        Parser.prototype.consumeComponentValue = function () {\r\n            var token = this.consumeToken();\r\n            switch (token.type) {\r\n                case TokenType.LEFT_CURLY_BRACKET_TOKEN:\r\n                case TokenType.LEFT_SQUARE_BRACKET_TOKEN:\r\n                case TokenType.LEFT_PARENTHESIS_TOKEN:\r\n                    return this.consumeSimpleBlock(token.type);\r\n                case TokenType.FUNCTION_TOKEN:\r\n                    return this.consumeFunction(token);\r\n            }\r\n            return token;\r\n        };\r\n        Parser.prototype.consumeSimpleBlock = function (type) {\r\n            var block = { type: type, values: [] };\r\n            var token = this.consumeToken();\r\n            while (true) {\r\n                if (token.type === TokenType.EOF_TOKEN || isEndingTokenFor(token, type)) {\r\n                    return block;\r\n                }\r\n                this.reconsumeToken(token);\r\n                block.values.push(this.consumeComponentValue());\r\n                token = this.consumeToken();\r\n            }\r\n        };\r\n        Parser.prototype.consumeFunction = function (functionToken) {\r\n            var cssFunction = {\r\n                name: functionToken.value,\r\n                values: [],\r\n                type: TokenType.FUNCTION\r\n            };\r\n            while (true) {\r\n                var token = this.consumeToken();\r\n                if (token.type === TokenType.EOF_TOKEN || token.type === TokenType.RIGHT_PARENTHESIS_TOKEN) {\r\n                    return cssFunction;\r\n                }\r\n                this.reconsumeToken(token);\r\n                cssFunction.values.push(this.consumeComponentValue());\r\n            }\r\n        };\r\n        Parser.prototype.consumeToken = function () {\r\n            var token = this._tokens.shift();\r\n            return typeof token === 'undefined' ? EOF_TOKEN : token;\r\n        };\r\n        Parser.prototype.reconsumeToken = function (token) {\r\n            this._tokens.unshift(token);\r\n        };\r\n        return Parser;\r\n    }());\r\n    var isDimensionToken = function (token) { return token.type === TokenType.DIMENSION_TOKEN; };\r\n    var isNumberToken = function (token) { return token.type === TokenType.NUMBER_TOKEN; };\r\n    var isIdentToken = function (token) { return token.type === TokenType.IDENT_TOKEN; };\r\n    var isStringToken = function (token) { return token.type === TokenType.STRING_TOKEN; };\r\n    var isIdentWithValue = function (token, value) {\r\n        return isIdentToken(token) && token.value === value;\r\n    };\r\n    var nonWhiteSpace = function (token) { return token.type !== TokenType.WHITESPACE_TOKEN; };\r\n    var nonFunctionArgSeparator = function (token) {\r\n        return token.type !== TokenType.WHITESPACE_TOKEN && token.type !== TokenType.COMMA_TOKEN;\r\n    };\r\n    var parseFunctionArgs = function (tokens) {\r\n        var args = [];\r\n        var arg = [];\r\n        tokens.forEach(function (token) {\r\n            if (token.type === TokenType.COMMA_TOKEN) {\r\n                if (arg.length === 0) {\r\n                    throw new Error(\"Error parsing function args, zero tokens for arg\");\r\n                }\r\n                args.push(arg);\r\n                arg = [];\r\n                return;\r\n            }\r\n            if (token.type !== TokenType.WHITESPACE_TOKEN) {\r\n                arg.push(token);\r\n            }\r\n        });\r\n        if (arg.length) {\r\n            args.push(arg);\r\n        }\r\n        return args;\r\n    };\r\n    var isEndingTokenFor = function (token, type) {\r\n        if (type === TokenType.LEFT_CURLY_BRACKET_TOKEN && token.type === TokenType.RIGHT_CURLY_BRACKET_TOKEN) {\r\n            return true;\r\n        }\r\n        if (type === TokenType.LEFT_SQUARE_BRACKET_TOKEN && token.type === TokenType.RIGHT_SQUARE_BRACKET_TOKEN) {\r\n            return true;\r\n        }\r\n        return type === TokenType.LEFT_PARENTHESIS_TOKEN && token.type === TokenType.RIGHT_PARENTHESIS_TOKEN;\r\n    };\r\n\r\n    var isLength = function (token) {\r\n        return token.type === TokenType.NUMBER_TOKEN || token.type === TokenType.DIMENSION_TOKEN;\r\n    };\r\n\r\n    var isLengthPercentage = function (token) {\r\n        return token.type === TokenType.PERCENTAGE_TOKEN || isLength(token);\r\n    };\r\n    var parseLengthPercentageTuple = function (tokens) {\r\n        return tokens.length > 1 ? [tokens[0], tokens[1]] : [tokens[0]];\r\n    };\r\n    var ZERO_LENGTH = {\r\n        type: TokenType.NUMBER_TOKEN,\r\n        number: 0,\r\n        flags: FLAG_INTEGER\r\n    };\r\n    var FIFTY_PERCENT = {\r\n        type: TokenType.PERCENTAGE_TOKEN,\r\n        number: 50,\r\n        flags: FLAG_INTEGER\r\n    };\r\n    var HUNDRED_PERCENT = {\r\n        type: TokenType.PERCENTAGE_TOKEN,\r\n        number: 100,\r\n        flags: FLAG_INTEGER\r\n    };\r\n    var getAbsoluteValueForTuple = function (tuple, width, height) {\r\n        var x = tuple[0], y = tuple[1];\r\n        return [getAbsoluteValue(x, width), getAbsoluteValue(typeof y !== 'undefined' ? y : x, height)];\r\n    };\r\n    var getAbsoluteValue = function (token, parent) {\r\n        if (token.type === TokenType.PERCENTAGE_TOKEN) {\r\n            return (token.number / 100) * parent;\r\n        }\r\n        if (isDimensionToken(token)) {\r\n            switch (token.unit) {\r\n                case 'rem':\r\n                case 'em':\r\n                    return 16 * token.number; // TODO use correct font-size\r\n                case 'px':\r\n                default:\r\n                    return token.number;\r\n            }\r\n        }\r\n        return token.number;\r\n    };\r\n\r\n    var DEG = 'deg';\r\n    var GRAD = 'grad';\r\n    var RAD = 'rad';\r\n    var TURN = 'turn';\r\n    var angle = {\r\n        name: 'angle',\r\n        parse: function (value) {\r\n            if (value.type === TokenType.DIMENSION_TOKEN) {\r\n                switch (value.unit) {\r\n                    case DEG:\r\n                        return (Math.PI * value.number) / 180;\r\n                    case GRAD:\r\n                        return (Math.PI / 200) * value.number;\r\n                    case RAD:\r\n                        return value.number;\r\n                    case TURN:\r\n                        return Math.PI * 2 * value.number;\r\n                }\r\n            }\r\n            throw new Error(\"Unsupported angle type\");\r\n        }\r\n    };\r\n    var isAngle = function (value) {\r\n        if (value.type === TokenType.DIMENSION_TOKEN) {\r\n            if (value.unit === DEG || value.unit === GRAD || value.unit === RAD || value.unit === TURN) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    var parseNamedSide = function (tokens) {\r\n        var sideOrCorner = tokens\r\n            .filter(isIdentToken)\r\n            .map(function (ident) { return ident.value; })\r\n            .join(' ');\r\n        switch (sideOrCorner) {\r\n            case 'to bottom right':\r\n            case 'to right bottom':\r\n            case 'left top':\r\n            case 'top left':\r\n                return [ZERO_LENGTH, ZERO_LENGTH];\r\n            case 'to top':\r\n            case 'bottom':\r\n                return deg(0);\r\n            case 'to bottom left':\r\n            case 'to left bottom':\r\n            case 'right top':\r\n            case 'top right':\r\n                return [ZERO_LENGTH, HUNDRED_PERCENT];\r\n            case 'to right':\r\n            case 'left':\r\n                return deg(90);\r\n            case 'to top left':\r\n            case 'to left top':\r\n            case 'right bottom':\r\n            case 'bottom right':\r\n                return [HUNDRED_PERCENT, HUNDRED_PERCENT];\r\n            case 'to bottom':\r\n            case 'top':\r\n                return deg(180);\r\n            case 'to top right':\r\n            case 'to right top':\r\n            case 'left bottom':\r\n            case 'bottom left':\r\n                return [HUNDRED_PERCENT, ZERO_LENGTH];\r\n            case 'to left':\r\n            case 'right':\r\n                return deg(270);\r\n        }\r\n        return 0;\r\n    };\r\n    var deg = function (deg) { return (Math.PI * deg) / 180; };\r\n\r\n    var color = {\r\n        name: 'color',\r\n        parse: function (value) {\r\n            if (value.type === TokenType.FUNCTION) {\r\n                var colorFunction = SUPPORTED_COLOR_FUNCTIONS[value.name];\r\n                if (typeof colorFunction === 'undefined') {\r\n                    throw new Error(\"Attempting to parse an unsupported color function \\\"\" + value.name + \"\\\"\");\r\n                }\r\n                return colorFunction(value.values);\r\n            }\r\n            if (value.type === TokenType.HASH_TOKEN) {\r\n                if (value.value.length === 3) {\r\n                    var r = value.value.substring(0, 1);\r\n                    var g = value.value.substring(1, 2);\r\n                    var b = value.value.substring(2, 3);\r\n                    return pack(parseInt(r + r, 16), parseInt(g + g, 16), parseInt(b + b, 16), 1);\r\n                }\r\n                if (value.value.length === 4) {\r\n                    var r = value.value.substring(0, 1);\r\n                    var g = value.value.substring(1, 2);\r\n                    var b = value.value.substring(2, 3);\r\n                    var a = value.value.substring(3, 4);\r\n                    return pack(parseInt(r + r, 16), parseInt(g + g, 16), parseInt(b + b, 16), parseInt(a + a, 16) / 255);\r\n                }\r\n                if (value.value.length === 6) {\r\n                    var r = value.value.substring(0, 2);\r\n                    var g = value.value.substring(2, 4);\r\n                    var b = value.value.substring(4, 6);\r\n                    return pack(parseInt(r, 16), parseInt(g, 16), parseInt(b, 16), 1);\r\n                }\r\n                if (value.value.length === 8) {\r\n                    var r = value.value.substring(0, 2);\r\n                    var g = value.value.substring(2, 4);\r\n                    var b = value.value.substring(4, 6);\r\n                    var a = value.value.substring(6, 8);\r\n                    return pack(parseInt(r, 16), parseInt(g, 16), parseInt(b, 16), parseInt(a, 16) / 255);\r\n                }\r\n            }\r\n            if (value.type === TokenType.IDENT_TOKEN) {\r\n                var namedColor = COLORS[value.value.toUpperCase()];\r\n                if (typeof namedColor !== 'undefined') {\r\n                    return namedColor;\r\n                }\r\n            }\r\n            return COLORS.TRANSPARENT;\r\n        }\r\n    };\r\n    var isTransparent = function (color) { return (0xff & color) === 0; };\r\n    var asString = function (color) {\r\n        var alpha = 0xff & color;\r\n        var blue = 0xff & (color >> 8);\r\n        var green = 0xff & (color >> 16);\r\n        var red = 0xff & (color >> 24);\r\n        return alpha < 255 ? \"rgba(\" + red + \",\" + green + \",\" + blue + \",\" + alpha / 255 + \")\" : \"rgb(\" + red + \",\" + green + \",\" + blue + \")\";\r\n    };\r\n    var pack = function (r, g, b, a) {\r\n        return ((r << 24) | (g << 16) | (b << 8) | (Math.round(a * 255) << 0)) >>> 0;\r\n    };\r\n    var getTokenColorValue = function (token, i) {\r\n        if (token.type === TokenType.NUMBER_TOKEN) {\r\n            return token.number;\r\n        }\r\n        if (token.type === TokenType.PERCENTAGE_TOKEN) {\r\n            var max = i === 3 ? 1 : 255;\r\n            return i === 3 ? (token.number / 100) * max : Math.round((token.number / 100) * max);\r\n        }\r\n        return 0;\r\n    };\r\n    var rgb = function (args) {\r\n        var tokens = args.filter(nonFunctionArgSeparator);\r\n        if (tokens.length === 3) {\r\n            var _a = tokens.map(getTokenColorValue), r = _a[0], g = _a[1], b = _a[2];\r\n            return pack(r, g, b, 1);\r\n        }\r\n        if (tokens.length === 4) {\r\n            var _b = tokens.map(getTokenColorValue), r = _b[0], g = _b[1], b = _b[2], a = _b[3];\r\n            return pack(r, g, b, a);\r\n        }\r\n        return 0;\r\n    };\r\n    function hue2rgb(t1, t2, hue) {\r\n        if (hue < 0) {\r\n            hue += 1;\r\n        }\r\n        if (hue >= 1) {\r\n            hue -= 1;\r\n        }\r\n        if (hue < 1 / 6) {\r\n            return (t2 - t1) * hue * 6 + t1;\r\n        }\r\n        else if (hue < 1 / 2) {\r\n            return t2;\r\n        }\r\n        else if (hue < 2 / 3) {\r\n            return (t2 - t1) * 6 * (2 / 3 - hue) + t1;\r\n        }\r\n        else {\r\n            return t1;\r\n        }\r\n    }\r\n    var hsl = function (args) {\r\n        var tokens = args.filter(nonFunctionArgSeparator);\r\n        var hue = tokens[0], saturation = tokens[1], lightness = tokens[2], alpha = tokens[3];\r\n        var h = (hue.type === TokenType.NUMBER_TOKEN ? deg(hue.number) : angle.parse(hue)) / (Math.PI * 2);\r\n        var s = isLengthPercentage(saturation) ? saturation.number / 100 : 0;\r\n        var l = isLengthPercentage(lightness) ? lightness.number / 100 : 0;\r\n        var a = typeof alpha !== 'undefined' && isLengthPercentage(alpha) ? getAbsoluteValue(alpha, 1) : 1;\r\n        if (s === 0) {\r\n            return pack(l * 255, l * 255, l * 255, 1);\r\n        }\r\n        var t2 = l <= 0.5 ? l * (s + 1) : l + s - l * s;\r\n        var t1 = l * 2 - t2;\r\n        var r = hue2rgb(t1, t2, h + 1 / 3);\r\n        var g = hue2rgb(t1, t2, h);\r\n        var b = hue2rgb(t1, t2, h - 1 / 3);\r\n        return pack(r * 255, g * 255, b * 255, a);\r\n    };\r\n    var SUPPORTED_COLOR_FUNCTIONS = {\r\n        hsl: hsl,\r\n        hsla: hsl,\r\n        rgb: rgb,\r\n        rgba: rgb\r\n    };\r\n    var COLORS = {\r\n        ALICEBLUE: 0xf0f8ffff,\r\n        ANTIQUEWHITE: 0xfaebd7ff,\r\n        AQUA: 0x00ffffff,\r\n        AQUAMARINE: 0x7fffd4ff,\r\n        AZURE: 0xf0ffffff,\r\n        BEIGE: 0xf5f5dcff,\r\n        BISQUE: 0xffe4c4ff,\r\n        BLACK: 0x000000ff,\r\n        BLANCHEDALMOND: 0xffebcdff,\r\n        BLUE: 0x0000ffff,\r\n        BLUEVIOLET: 0x8a2be2ff,\r\n        BROWN: 0xa52a2aff,\r\n        BURLYWOOD: 0xdeb887ff,\r\n        CADETBLUE: 0x5f9ea0ff,\r\n        CHARTREUSE: 0x7fff00ff,\r\n        CHOCOLATE: 0xd2691eff,\r\n        CORAL: 0xff7f50ff,\r\n        CORNFLOWERBLUE: 0x6495edff,\r\n        CORNSILK: 0xfff8dcff,\r\n        CRIMSON: 0xdc143cff,\r\n        CYAN: 0x00ffffff,\r\n        DARKBLUE: 0x00008bff,\r\n        DARKCYAN: 0x008b8bff,\r\n        DARKGOLDENROD: 0xb886bbff,\r\n        DARKGRAY: 0xa9a9a9ff,\r\n        DARKGREEN: 0x006400ff,\r\n        DARKGREY: 0xa9a9a9ff,\r\n        DARKKHAKI: 0xbdb76bff,\r\n        DARKMAGENTA: 0x8b008bff,\r\n        DARKOLIVEGREEN: 0x556b2fff,\r\n        DARKORANGE: 0xff8c00ff,\r\n        DARKORCHID: 0x9932ccff,\r\n        DARKRED: 0x8b0000ff,\r\n        DARKSALMON: 0xe9967aff,\r\n        DARKSEAGREEN: 0x8fbc8fff,\r\n        DARKSLATEBLUE: 0x483d8bff,\r\n        DARKSLATEGRAY: 0x2f4f4fff,\r\n        DARKSLATEGREY: 0x2f4f4fff,\r\n        DARKTURQUOISE: 0x00ced1ff,\r\n        DARKVIOLET: 0x9400d3ff,\r\n        DEEPPINK: 0xff1493ff,\r\n        DEEPSKYBLUE: 0x00bfffff,\r\n        DIMGRAY: 0x696969ff,\r\n        DIMGREY: 0x696969ff,\r\n        DODGERBLUE: 0x1e90ffff,\r\n        FIREBRICK: 0xb22222ff,\r\n        FLORALWHITE: 0xfffaf0ff,\r\n        FORESTGREEN: 0x228b22ff,\r\n        FUCHSIA: 0xff00ffff,\r\n        GAINSBORO: 0xdcdcdcff,\r\n        GHOSTWHITE: 0xf8f8ffff,\r\n        GOLD: 0xffd700ff,\r\n        GOLDENROD: 0xdaa520ff,\r\n        GRAY: 0x808080ff,\r\n        GREEN: 0x008000ff,\r\n        GREENYELLOW: 0xadff2fff,\r\n        GREY: 0x808080ff,\r\n        HONEYDEW: 0xf0fff0ff,\r\n        HOTPINK: 0xff69b4ff,\r\n        INDIANRED: 0xcd5c5cff,\r\n        INDIGO: 0x4b0082ff,\r\n        IVORY: 0xfffff0ff,\r\n        KHAKI: 0xf0e68cff,\r\n        LAVENDER: 0xe6e6faff,\r\n        LAVENDERBLUSH: 0xfff0f5ff,\r\n        LAWNGREEN: 0x7cfc00ff,\r\n        LEMONCHIFFON: 0xfffacdff,\r\n        LIGHTBLUE: 0xadd8e6ff,\r\n        LIGHTCORAL: 0xf08080ff,\r\n        LIGHTCYAN: 0xe0ffffff,\r\n        LIGHTGOLDENRODYELLOW: 0xfafad2ff,\r\n        LIGHTGRAY: 0xd3d3d3ff,\r\n        LIGHTGREEN: 0x90ee90ff,\r\n        LIGHTGREY: 0xd3d3d3ff,\r\n        LIGHTPINK: 0xffb6c1ff,\r\n        LIGHTSALMON: 0xffa07aff,\r\n        LIGHTSEAGREEN: 0x20b2aaff,\r\n        LIGHTSKYBLUE: 0x87cefaff,\r\n        LIGHTSLATEGRAY: 0x778899ff,\r\n        LIGHTSLATEGREY: 0x778899ff,\r\n        LIGHTSTEELBLUE: 0xb0c4deff,\r\n        LIGHTYELLOW: 0xffffe0ff,\r\n        LIME: 0x00ff00ff,\r\n        LIMEGREEN: 0x32cd32ff,\r\n        LINEN: 0xfaf0e6ff,\r\n        MAGENTA: 0xff00ffff,\r\n        MAROON: 0x800000ff,\r\n        MEDIUMAQUAMARINE: 0x66cdaaff,\r\n        MEDIUMBLUE: 0x0000cdff,\r\n        MEDIUMORCHID: 0xba55d3ff,\r\n        MEDIUMPURPLE: 0x9370dbff,\r\n        MEDIUMSEAGREEN: 0x3cb371ff,\r\n        MEDIUMSLATEBLUE: 0x7b68eeff,\r\n        MEDIUMSPRINGGREEN: 0x00fa9aff,\r\n        MEDIUMTURQUOISE: 0x48d1ccff,\r\n        MEDIUMVIOLETRED: 0xc71585ff,\r\n        MIDNIGHTBLUE: 0x191970ff,\r\n        MINTCREAM: 0xf5fffaff,\r\n        MISTYROSE: 0xffe4e1ff,\r\n        MOCCASIN: 0xffe4b5ff,\r\n        NAVAJOWHITE: 0xffdeadff,\r\n        NAVY: 0x000080ff,\r\n        OLDLACE: 0xfdf5e6ff,\r\n        OLIVE: 0x808000ff,\r\n        OLIVEDRAB: 0x6b8e23ff,\r\n        ORANGE: 0xffa500ff,\r\n        ORANGERED: 0xff4500ff,\r\n        ORCHID: 0xda70d6ff,\r\n        PALEGOLDENROD: 0xeee8aaff,\r\n        PALEGREEN: 0x98fb98ff,\r\n        PALETURQUOISE: 0xafeeeeff,\r\n        PALEVIOLETRED: 0xdb7093ff,\r\n        PAPAYAWHIP: 0xffefd5ff,\r\n        PEACHPUFF: 0xffdab9ff,\r\n        PERU: 0xcd853fff,\r\n        PINK: 0xffc0cbff,\r\n        PLUM: 0xdda0ddff,\r\n        POWDERBLUE: 0xb0e0e6ff,\r\n        PURPLE: 0x800080ff,\r\n        REBECCAPURPLE: 0x663399ff,\r\n        RED: 0xff0000ff,\r\n        ROSYBROWN: 0xbc8f8fff,\r\n        ROYALBLUE: 0x4169e1ff,\r\n        SADDLEBROWN: 0x8b4513ff,\r\n        SALMON: 0xfa8072ff,\r\n        SANDYBROWN: 0xf4a460ff,\r\n        SEAGREEN: 0x2e8b57ff,\r\n        SEASHELL: 0xfff5eeff,\r\n        SIENNA: 0xa0522dff,\r\n        SILVER: 0xc0c0c0ff,\r\n        SKYBLUE: 0x87ceebff,\r\n        SLATEBLUE: 0x6a5acdff,\r\n        SLATEGRAY: 0x708090ff,\r\n        SLATEGREY: 0x708090ff,\r\n        SNOW: 0xfffafaff,\r\n        SPRINGGREEN: 0x00ff7fff,\r\n        STEELBLUE: 0x4682b4ff,\r\n        TAN: 0xd2b48cff,\r\n        TEAL: 0x008080ff,\r\n        THISTLE: 0xd8bfd8ff,\r\n        TOMATO: 0xff6347ff,\r\n        TRANSPARENT: 0x00000000,\r\n        TURQUOISE: 0x40e0d0ff,\r\n        VIOLET: 0xee82eeff,\r\n        WHEAT: 0xf5deb3ff,\r\n        WHITE: 0xffffffff,\r\n        WHITESMOKE: 0xf5f5f5ff,\r\n        YELLOW: 0xffff00ff,\r\n        YELLOWGREEN: 0x9acd32ff\r\n    };\r\n\r\n    var PropertyDescriptorParsingType;\r\n    (function (PropertyDescriptorParsingType) {\r\n        PropertyDescriptorParsingType[PropertyDescriptorParsingType[\"VALUE\"] = 0] = \"VALUE\";\r\n        PropertyDescriptorParsingType[PropertyDescriptorParsingType[\"LIST\"] = 1] = \"LIST\";\r\n        PropertyDescriptorParsingType[PropertyDescriptorParsingType[\"IDENT_VALUE\"] = 2] = \"IDENT_VALUE\";\r\n        PropertyDescriptorParsingType[PropertyDescriptorParsingType[\"TYPE_VALUE\"] = 3] = \"TYPE_VALUE\";\r\n        PropertyDescriptorParsingType[PropertyDescriptorParsingType[\"TOKEN_VALUE\"] = 4] = \"TOKEN_VALUE\";\r\n    })(PropertyDescriptorParsingType || (PropertyDescriptorParsingType = {}));\r\n\r\n    var BACKGROUND_CLIP;\r\n    (function (BACKGROUND_CLIP) {\r\n        BACKGROUND_CLIP[BACKGROUND_CLIP[\"BORDER_BOX\"] = 0] = \"BORDER_BOX\";\r\n        BACKGROUND_CLIP[BACKGROUND_CLIP[\"PADDING_BOX\"] = 1] = \"PADDING_BOX\";\r\n        BACKGROUND_CLIP[BACKGROUND_CLIP[\"CONTENT_BOX\"] = 2] = \"CONTENT_BOX\";\r\n    })(BACKGROUND_CLIP || (BACKGROUND_CLIP = {}));\r\n    var backgroundClip = {\r\n        name: 'background-clip',\r\n        initialValue: 'border-box',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            return tokens.map(function (token) {\r\n                if (isIdentToken(token)) {\r\n                    switch (token.value) {\r\n                        case 'padding-box':\r\n                            return BACKGROUND_CLIP.PADDING_BOX;\r\n                        case 'content-box':\r\n                            return BACKGROUND_CLIP.CONTENT_BOX;\r\n                    }\r\n                }\r\n                return BACKGROUND_CLIP.BORDER_BOX;\r\n            });\r\n        }\r\n    };\r\n\r\n    var backgroundColor = {\r\n        name: \"background-color\",\r\n        initialValue: 'transparent',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.TYPE_VALUE,\r\n        format: 'color'\r\n    };\r\n\r\n    var parseColorStop = function (args) {\r\n        var color$1 = color.parse(args[0]);\r\n        var stop = args[1];\r\n        return stop && isLengthPercentage(stop) ? { color: color$1, stop: stop } : { color: color$1, stop: null };\r\n    };\r\n    var processColorStops = function (stops, lineLength) {\r\n        var first = stops[0];\r\n        var last = stops[stops.length - 1];\r\n        if (first.stop === null) {\r\n            first.stop = ZERO_LENGTH;\r\n        }\r\n        if (last.stop === null) {\r\n            last.stop = HUNDRED_PERCENT;\r\n        }\r\n        var processStops = [];\r\n        var previous = 0;\r\n        for (var i = 0; i < stops.length; i++) {\r\n            var stop_1 = stops[i].stop;\r\n            if (stop_1 !== null) {\r\n                var absoluteValue = getAbsoluteValue(stop_1, lineLength);\r\n                if (absoluteValue > previous) {\r\n                    processStops.push(absoluteValue);\r\n                }\r\n                else {\r\n                    processStops.push(previous);\r\n                }\r\n                previous = absoluteValue;\r\n            }\r\n            else {\r\n                processStops.push(null);\r\n            }\r\n        }\r\n        var gapBegin = null;\r\n        for (var i = 0; i < processStops.length; i++) {\r\n            var stop_2 = processStops[i];\r\n            if (stop_2 === null) {\r\n                if (gapBegin === null) {\r\n                    gapBegin = i;\r\n                }\r\n            }\r\n            else if (gapBegin !== null) {\r\n                var gapLength = i - gapBegin;\r\n                var beforeGap = processStops[gapBegin - 1];\r\n                var gapValue = (stop_2 - beforeGap) / (gapLength + 1);\r\n                for (var g = 1; g <= gapLength; g++) {\r\n                    processStops[gapBegin + g - 1] = gapValue * g;\r\n                }\r\n                gapBegin = null;\r\n            }\r\n        }\r\n        return stops.map(function (_a, i) {\r\n            var color = _a.color;\r\n            return { color: color, stop: Math.max(Math.min(1, processStops[i] / lineLength), 0) };\r\n        });\r\n    };\r\n    var getAngleFromCorner = function (corner, width, height) {\r\n        var centerX = width / 2;\r\n        var centerY = height / 2;\r\n        var x = getAbsoluteValue(corner[0], width) - centerX;\r\n        var y = centerY - getAbsoluteValue(corner[1], height);\r\n        return (Math.atan2(y, x) + Math.PI * 2) % (Math.PI * 2);\r\n    };\r\n    var calculateGradientDirection = function (angle, width, height) {\r\n        var radian = typeof angle === 'number' ? angle : getAngleFromCorner(angle, width, height);\r\n        var lineLength = Math.abs(width * Math.sin(radian)) + Math.abs(height * Math.cos(radian));\r\n        var halfWidth = width / 2;\r\n        var halfHeight = height / 2;\r\n        var halfLineLength = lineLength / 2;\r\n        var yDiff = Math.sin(radian - Math.PI / 2) * halfLineLength;\r\n        var xDiff = Math.cos(radian - Math.PI / 2) * halfLineLength;\r\n        return [lineLength, halfWidth - xDiff, halfWidth + xDiff, halfHeight - yDiff, halfHeight + yDiff];\r\n    };\r\n    var distance = function (a, b) { return Math.sqrt(a * a + b * b); };\r\n    var findCorner = function (width, height, x, y, closest) {\r\n        var corners = [[0, 0], [0, height], [width, 0], [width, height]];\r\n        return corners.reduce(function (stat, corner) {\r\n            var cx = corner[0], cy = corner[1];\r\n            var d = distance(x - cx, y - cy);\r\n            if (closest ? d < stat.optimumDistance : d > stat.optimumDistance) {\r\n                return {\r\n                    optimumCorner: corner,\r\n                    optimumDistance: d\r\n                };\r\n            }\r\n            return stat;\r\n        }, {\r\n            optimumDistance: closest ? Infinity : -Infinity,\r\n            optimumCorner: null\r\n        }).optimumCorner;\r\n    };\r\n    var calculateRadius = function (gradient, x, y, width, height) {\r\n        var rx = 0;\r\n        var ry = 0;\r\n        switch (gradient.size) {\r\n            case CSSRadialExtent.CLOSEST_SIDE:\r\n                // The ending shape is sized so that that it exactly meets the side of the gradient box closest to the gradients center.\r\n                // If the shape is an ellipse, it exactly meets the closest side in each dimension.\r\n                if (gradient.shape === CSSRadialShape.CIRCLE) {\r\n                    rx = ry = Math.min(Math.abs(x), Math.abs(x - width), Math.abs(y), Math.abs(y - height));\r\n                }\r\n                else if (gradient.shape === CSSRadialShape.ELLIPSE) {\r\n                    rx = Math.min(Math.abs(x), Math.abs(x - width));\r\n                    ry = Math.min(Math.abs(y), Math.abs(y - height));\r\n                }\r\n                break;\r\n            case CSSRadialExtent.CLOSEST_CORNER:\r\n                // The ending shape is sized so that that it passes through the corner of the gradient box closest to the gradients center.\r\n                // If the shape is an ellipse, the ending shape is given the same aspect-ratio it would have if closest-side were specified.\r\n                if (gradient.shape === CSSRadialShape.CIRCLE) {\r\n                    rx = ry = Math.min(distance(x, y), distance(x, y - height), distance(x - width, y), distance(x - width, y - height));\r\n                }\r\n                else if (gradient.shape === CSSRadialShape.ELLIPSE) {\r\n                    // Compute the ratio ry/rx (which is to be the same as for \"closest-side\")\r\n                    var c = Math.min(Math.abs(y), Math.abs(y - height)) / Math.min(Math.abs(x), Math.abs(x - width));\r\n                    var _a = findCorner(width, height, x, y, true), cx = _a[0], cy = _a[1];\r\n                    rx = distance(cx - x, (cy - y) / c);\r\n                    ry = c * rx;\r\n                }\r\n                break;\r\n            case CSSRadialExtent.FARTHEST_SIDE:\r\n                // Same as closest-side, except the ending shape is sized based on the farthest side(s)\r\n                if (gradient.shape === CSSRadialShape.CIRCLE) {\r\n                    rx = ry = Math.max(Math.abs(x), Math.abs(x - width), Math.abs(y), Math.abs(y - height));\r\n                }\r\n                else if (gradient.shape === CSSRadialShape.ELLIPSE) {\r\n                    rx = Math.max(Math.abs(x), Math.abs(x - width));\r\n                    ry = Math.max(Math.abs(y), Math.abs(y - height));\r\n                }\r\n                break;\r\n            case CSSRadialExtent.FARTHEST_CORNER:\r\n                // Same as closest-corner, except the ending shape is sized based on the farthest corner.\r\n                // If the shape is an ellipse, the ending shape is given the same aspect ratio it would have if farthest-side were specified.\r\n                if (gradient.shape === CSSRadialShape.CIRCLE) {\r\n                    rx = ry = Math.max(distance(x, y), distance(x, y - height), distance(x - width, y), distance(x - width, y - height));\r\n                }\r\n                else if (gradient.shape === CSSRadialShape.ELLIPSE) {\r\n                    // Compute the ratio ry/rx (which is to be the same as for \"farthest-side\")\r\n                    var c = Math.max(Math.abs(y), Math.abs(y - height)) / Math.max(Math.abs(x), Math.abs(x - width));\r\n                    var _b = findCorner(width, height, x, y, false), cx = _b[0], cy = _b[1];\r\n                    rx = distance(cx - x, (cy - y) / c);\r\n                    ry = c * rx;\r\n                }\r\n                break;\r\n        }\r\n        if (Array.isArray(gradient.size)) {\r\n            rx = getAbsoluteValue(gradient.size[0], width);\r\n            ry = gradient.size.length === 2 ? getAbsoluteValue(gradient.size[1], height) : rx;\r\n        }\r\n        return [rx, ry];\r\n    };\r\n\r\n    var linearGradient = function (tokens) {\r\n        var angle$1 = deg(180);\r\n        var stops = [];\r\n        parseFunctionArgs(tokens).forEach(function (arg, i) {\r\n            if (i === 0) {\r\n                var firstToken = arg[0];\r\n                if (firstToken.type === TokenType.IDENT_TOKEN && firstToken.value === 'to') {\r\n                    angle$1 = parseNamedSide(arg);\r\n                    return;\r\n                }\r\n                else if (isAngle(firstToken)) {\r\n                    angle$1 = angle.parse(firstToken);\r\n                    return;\r\n                }\r\n            }\r\n            var colorStop = parseColorStop(arg);\r\n            stops.push(colorStop);\r\n        });\r\n        return { angle: angle$1, stops: stops, type: CSSImageType.LINEAR_GRADIENT };\r\n    };\r\n\r\n    var prefixLinearGradient = function (tokens) {\r\n        var angle$1 = deg(180);\r\n        var stops = [];\r\n        parseFunctionArgs(tokens).forEach(function (arg, i) {\r\n            if (i === 0) {\r\n                var firstToken = arg[0];\r\n                if (firstToken.type === TokenType.IDENT_TOKEN &&\r\n                    ['top', 'left', 'right', 'bottom'].indexOf(firstToken.value) !== -1) {\r\n                    angle$1 = parseNamedSide(arg);\r\n                    return;\r\n                }\r\n                else if (isAngle(firstToken)) {\r\n                    angle$1 = (angle.parse(firstToken) + deg(270)) % deg(360);\r\n                    return;\r\n                }\r\n            }\r\n            var colorStop = parseColorStop(arg);\r\n            stops.push(colorStop);\r\n        });\r\n        return {\r\n            angle: angle$1,\r\n            stops: stops,\r\n            type: CSSImageType.LINEAR_GRADIENT\r\n        };\r\n    };\r\n\r\n    var testRangeBounds = function (document) {\r\n        var TEST_HEIGHT = 123;\r\n        if (document.createRange) {\r\n            var range = document.createRange();\r\n            if (range.getBoundingClientRect) {\r\n                var testElement = document.createElement('boundtest');\r\n                testElement.style.height = TEST_HEIGHT + \"px\";\r\n                testElement.style.display = 'block';\r\n                document.body.appendChild(testElement);\r\n                range.selectNode(testElement);\r\n                var rangeBounds = range.getBoundingClientRect();\r\n                var rangeHeight = Math.round(rangeBounds.height);\r\n                document.body.removeChild(testElement);\r\n                if (rangeHeight === TEST_HEIGHT) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    var testCORS = function () { return typeof new Image().crossOrigin !== 'undefined'; };\r\n    var testResponseType = function () { return typeof new XMLHttpRequest().responseType === 'string'; };\r\n    var testSVG = function (document) {\r\n        var img = new Image();\r\n        var canvas = document.createElement('canvas');\r\n        var ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            return false;\r\n        }\r\n        img.src = \"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>\";\r\n        try {\r\n            ctx.drawImage(img, 0, 0);\r\n            canvas.toDataURL();\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n    var isGreenPixel = function (data) {\r\n        return data[0] === 0 && data[1] === 255 && data[2] === 0 && data[3] === 255;\r\n    };\r\n    var testForeignObject = function (document) {\r\n        var canvas = document.createElement('canvas');\r\n        var size = 100;\r\n        canvas.width = size;\r\n        canvas.height = size;\r\n        var ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            return Promise.reject(false);\r\n        }\r\n        ctx.fillStyle = 'rgb(0, 255, 0)';\r\n        ctx.fillRect(0, 0, size, size);\r\n        var img = new Image();\r\n        var greenImageSrc = canvas.toDataURL();\r\n        img.src = greenImageSrc;\r\n        var svg = createForeignObjectSVG(size, size, 0, 0, img);\r\n        ctx.fillStyle = 'red';\r\n        ctx.fillRect(0, 0, size, size);\r\n        return loadSerializedSVG(svg)\r\n            .then(function (img) {\r\n                ctx.drawImage(img, 0, 0);\r\n                var data = ctx.getImageData(0, 0, size, size).data;\r\n                ctx.fillStyle = 'red';\r\n                ctx.fillRect(0, 0, size, size);\r\n                var node = document.createElement('div');\r\n                node.style.backgroundImage = \"url(\" + greenImageSrc + \")\";\r\n                node.style.height = size + \"px\";\r\n                // Firefox 55 does not render inline <img /> tags\r\n                return isGreenPixel(data)\r\n                    ? loadSerializedSVG(createForeignObjectSVG(size, size, 0, 0, node))\r\n                    : Promise.reject(false);\r\n            })\r\n            .then(function (img) {\r\n                ctx.drawImage(img, 0, 0);\r\n                // Edge does not render background-images\r\n                return isGreenPixel(ctx.getImageData(0, 0, size, size).data);\r\n            })\r\n            .catch(function () { return false; });\r\n    };\r\n    var createForeignObjectSVG = function (width, height, x, y, node) {\r\n        var xmlns = 'http://www.w3.org/2000/svg';\r\n        var svg = document.createElementNS(xmlns, 'svg');\r\n        var foreignObject = document.createElementNS(xmlns, 'foreignObject');\r\n        svg.setAttributeNS(null, 'width', width.toString());\r\n        svg.setAttributeNS(null, 'height', height.toString());\r\n        foreignObject.setAttributeNS(null, 'width', '100%');\r\n        foreignObject.setAttributeNS(null, 'height', '100%');\r\n        foreignObject.setAttributeNS(null, 'x', x.toString());\r\n        foreignObject.setAttributeNS(null, 'y', y.toString());\r\n        foreignObject.setAttributeNS(null, 'externalResourcesRequired', 'true');\r\n        svg.appendChild(foreignObject);\r\n        foreignObject.appendChild(node);\r\n        return svg;\r\n    };\r\n    var loadSerializedSVG = function (svg) {\r\n        return new Promise(function (resolve, reject) {\r\n            var img = new Image();\r\n            img.onload = function () { return resolve(img); };\r\n            img.onerror = reject;\r\n            img.src = \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(new XMLSerializer().serializeToString(svg));\r\n        });\r\n    };\r\n    var FEATURES = {\r\n        get SUPPORT_RANGE_BOUNDS() {\r\n            var value = testRangeBounds(document);\r\n            Object.defineProperty(FEATURES, 'SUPPORT_RANGE_BOUNDS', { value: value });\r\n            return value;\r\n        },\r\n        get SUPPORT_SVG_DRAWING() {\r\n            var value = testSVG(document);\r\n            Object.defineProperty(FEATURES, 'SUPPORT_SVG_DRAWING', { value: value });\r\n            return value;\r\n        },\r\n        get SUPPORT_FOREIGNOBJECT_DRAWING() {\r\n            var value = typeof Array.from === 'function' && typeof window.fetch === 'function'\r\n                ? testForeignObject(document)\r\n                : Promise.resolve(false);\r\n            Object.defineProperty(FEATURES, 'SUPPORT_FOREIGNOBJECT_DRAWING', { value: value });\r\n            return value;\r\n        },\r\n        get SUPPORT_CORS_IMAGES() {\r\n            var value = testCORS();\r\n            Object.defineProperty(FEATURES, 'SUPPORT_CORS_IMAGES', { value: value });\r\n            return value;\r\n        },\r\n        get SUPPORT_RESPONSE_TYPE() {\r\n            var value = testResponseType();\r\n            Object.defineProperty(FEATURES, 'SUPPORT_RESPONSE_TYPE', { value: value });\r\n            return value;\r\n        },\r\n        get SUPPORT_CORS_XHR() {\r\n            var value = 'withCredentials' in new XMLHttpRequest();\r\n            Object.defineProperty(FEATURES, 'SUPPORT_CORS_XHR', { value: value });\r\n            return value;\r\n        }\r\n    };\r\n\r\n    var Logger = /** @class */ (function () {\r\n        function Logger(_a) {\r\n            var id = _a.id, enabled = _a.enabled;\r\n            this.id = id;\r\n            this.enabled = enabled;\r\n            this.start = Date.now();\r\n        }\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        Logger.prototype.debug = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            if (this.enabled) {\r\n                // eslint-disable-next-line no-console\r\n                if (typeof window !== 'undefined' && window.console && typeof console.debug === 'function') {\r\n                    // eslint-disable-next-line no-console\r\n                    console.debug.apply(console, [this.id, this.getTime() + \"ms\"].concat(args));\r\n                }\r\n                else {\r\n                    this.info.apply(this, args);\r\n                }\r\n            }\r\n        };\r\n        Logger.prototype.getTime = function () {\r\n            return Date.now() - this.start;\r\n        };\r\n        Logger.create = function (options) {\r\n            Logger.instances[options.id] = new Logger(options);\r\n        };\r\n        Logger.destroy = function (id) {\r\n            delete Logger.instances[id];\r\n        };\r\n        Logger.getInstance = function (id) {\r\n            var instance = Logger.instances[id];\r\n            if (typeof instance === 'undefined') {\r\n                throw new Error(\"No logger instance found with id \" + id);\r\n            }\r\n            return instance;\r\n        };\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        Logger.prototype.info = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            if (this.enabled) {\r\n                // eslint-disable-next-line no-console\r\n                if (typeof window !== 'undefined' && window.console && typeof console.info === 'function') {\r\n                    // eslint-disable-next-line no-console\r\n                    console.info.apply(console, [this.id, this.getTime() + \"ms\"].concat(args));\r\n                }\r\n            }\r\n        };\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        Logger.prototype.error = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            if (this.enabled) {\r\n                // eslint-disable-next-line no-console\r\n                if (typeof window !== 'undefined' && window.console && typeof console.error === 'function') {\r\n                    // eslint-disable-next-line no-console\r\n                    console.error.apply(console, [this.id, this.getTime() + \"ms\"].concat(args));\r\n                }\r\n                else {\r\n                    this.info.apply(this, args);\r\n                }\r\n            }\r\n        };\r\n        Logger.instances = {};\r\n        return Logger;\r\n    }());\r\n\r\n    var CacheStorage = /** @class */ (function () {\r\n        function CacheStorage() {\r\n        }\r\n        CacheStorage.create = function (name, options) {\r\n            return (CacheStorage._caches[name] = new Cache(name, options));\r\n        };\r\n        CacheStorage.destroy = function (name) {\r\n            delete CacheStorage._caches[name];\r\n        };\r\n        CacheStorage.open = function (name) {\r\n            var cache = CacheStorage._caches[name];\r\n            if (typeof cache !== 'undefined') {\r\n                return cache;\r\n            }\r\n            throw new Error(\"Cache with key \\\"\" + name + \"\\\" not found\");\r\n        };\r\n        CacheStorage.getOrigin = function (url) {\r\n            var link = CacheStorage._link;\r\n            if (!link) {\r\n                return 'about:blank';\r\n            }\r\n            link.href = url;\r\n            link.href = link.href; // IE9, LOL! - http://jsfiddle.net/niklasvh/2e48b/\r\n            return link.protocol + link.hostname + link.port;\r\n        };\r\n        CacheStorage.isSameOrigin = function (src) {\r\n            return CacheStorage.getOrigin(src) === CacheStorage._origin;\r\n        };\r\n        CacheStorage.setContext = function (window) {\r\n            CacheStorage._link = window.document.createElement('a');\r\n            CacheStorage._origin = CacheStorage.getOrigin(window.location.href);\r\n        };\r\n        CacheStorage.getInstance = function () {\r\n            var current = CacheStorage._current;\r\n            if (current === null) {\r\n                throw new Error(\"No cache instance attached\");\r\n            }\r\n            return current;\r\n        };\r\n        CacheStorage.attachInstance = function (cache) {\r\n            CacheStorage._current = cache;\r\n        };\r\n        CacheStorage.detachInstance = function () {\r\n            CacheStorage._current = null;\r\n        };\r\n        CacheStorage._caches = {};\r\n        CacheStorage._origin = 'about:blank';\r\n        CacheStorage._current = null;\r\n        return CacheStorage;\r\n    }());\r\n    var Cache = /** @class */ (function () {\r\n        function Cache(id, options) {\r\n            this.id = id;\r\n            this._options = options;\r\n            this._cache = {};\r\n        }\r\n        Cache.prototype.addImage = function (src) {\r\n            var result = Promise.resolve();\r\n            if (this.has(src)) {\r\n                return result;\r\n            }\r\n            if (isBlobImage(src) || isRenderable(src)) {\r\n                this._cache[src] = this.loadImage(src);\r\n                return result;\r\n            }\r\n            return result;\r\n        };\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        Cache.prototype.match = function (src) {\r\n            return this._cache[src];\r\n        };\r\n        Cache.prototype.loadImage = function (key) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var isSameOrigin, useCORS, useProxy, src;\r\n                var _this = this;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            isSameOrigin = CacheStorage.isSameOrigin(key);\r\n                            useCORS = !isInlineImage(key) && this._options.useCORS === true && FEATURES.SUPPORT_CORS_IMAGES && !isSameOrigin;\r\n                            useProxy = !isInlineImage(key) &&\r\n                                !isSameOrigin &&\r\n                                typeof this._options.proxy === 'string' &&\r\n                                FEATURES.SUPPORT_CORS_XHR &&\r\n                                !useCORS;\r\n                            if (!isSameOrigin && this._options.allowTaint === false && !isInlineImage(key) && !useProxy && !useCORS) {\r\n                                return [2 /*return*/];\r\n                            }\r\n                            src = key;\r\n                            if (!useProxy) return [3 /*break*/, 2];\r\n                            return [4 /*yield*/, this.proxy(src)];\r\n                        case 1:\r\n                            src = _a.sent();\r\n                            _a.label = 2;\r\n                        case 2:\r\n                            Logger.getInstance(this.id).debug(\"Added image \" + key.substring(0, 256));\r\n                            return [4 /*yield*/, new Promise(function (resolve, reject) {\r\n                                var img = new Image();\r\n                                img.onload = function () { return resolve(img); };\r\n                                img.onerror = reject;\r\n                                //ios safari 10.3 taints canvas with data urls unless crossOrigin is set to anonymous\r\n                                if (isInlineBase64Image(src) || useCORS) {\r\n                                    img.crossOrigin = 'anonymous';\r\n                                }\r\n                                img.src = src;\r\n                                if (img.complete === true) {\r\n                                    // Inline XML images may fail to parse, throwing an Error later on\r\n                                    setTimeout(function () { return resolve(img); }, 500);\r\n                                }\r\n                                if (_this._options.imageTimeout > 0) {\r\n                                    setTimeout(function () { return reject(\"Timed out (\" + _this._options.imageTimeout + \"ms) loading image\"); }, _this._options.imageTimeout);\r\n                                }\r\n                            })];\r\n                        case 3: return [2 /*return*/, _a.sent()];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        Cache.prototype.has = function (key) {\r\n            return typeof this._cache[key] !== 'undefined';\r\n        };\r\n        Cache.prototype.keys = function () {\r\n            return Promise.resolve(Object.keys(this._cache));\r\n        };\r\n        Cache.prototype.proxy = function (src) {\r\n            var _this = this;\r\n            var proxy = this._options.proxy;\r\n            if (!proxy) {\r\n                throw new Error('No proxy defined');\r\n            }\r\n            var key = src.substring(0, 256);\r\n            return new Promise(function (resolve, reject) {\r\n                var responseType = FEATURES.SUPPORT_RESPONSE_TYPE ? 'blob' : 'text';\r\n                var xhr = new XMLHttpRequest();\r\n                xhr.onload = function () {\r\n                    if (xhr.status === 200) {\r\n                        if (responseType === 'text') {\r\n                            resolve(xhr.response);\r\n                        }\r\n                        else {\r\n                            var reader_1 = new FileReader();\r\n                            reader_1.addEventListener('load', function () { return resolve(reader_1.result); }, false);\r\n                            reader_1.addEventListener('error', function (e) { return reject(e); }, false);\r\n                            reader_1.readAsDataURL(xhr.response);\r\n                        }\r\n                    }\r\n                    else {\r\n                        reject(\"Failed to proxy resource \" + key + \" with status code \" + xhr.status);\r\n                    }\r\n                };\r\n                xhr.onerror = reject;\r\n                xhr.open('GET', proxy + \"?url=\" + encodeURIComponent(src) + \"&responseType=\" + responseType);\r\n                if (responseType !== 'text' && xhr instanceof XMLHttpRequest) {\r\n                    xhr.responseType = responseType;\r\n                }\r\n                if (_this._options.imageTimeout) {\r\n                    var timeout_1 = _this._options.imageTimeout;\r\n                    xhr.timeout = timeout_1;\r\n                    xhr.ontimeout = function () { return reject(\"Timed out (\" + timeout_1 + \"ms) proxying \" + key); };\r\n                }\r\n                xhr.send();\r\n            });\r\n        };\r\n        return Cache;\r\n    }());\r\n    var INLINE_SVG = /^data:image\\/svg\\+xml/i;\r\n    var INLINE_BASE64 = /^data:image\\/.*;base64,/i;\r\n    var INLINE_IMG = /^data:image\\/.*/i;\r\n    var isRenderable = function (src) { return FEATURES.SUPPORT_SVG_DRAWING || !isSVG(src); };\r\n    var isInlineImage = function (src) { return INLINE_IMG.test(src); };\r\n    var isInlineBase64Image = function (src) { return INLINE_BASE64.test(src); };\r\n    var isBlobImage = function (src) { return src.substr(0, 4) === 'blob'; };\r\n    var isSVG = function (src) { return src.substr(-3).toLowerCase() === 'svg' || INLINE_SVG.test(src); };\r\n\r\n    var webkitGradient = function (tokens) {\r\n        var angle = deg(180);\r\n        var stops = [];\r\n        var type = CSSImageType.LINEAR_GRADIENT;\r\n        var shape = CSSRadialShape.CIRCLE;\r\n        var size = CSSRadialExtent.FARTHEST_CORNER;\r\n        var position = [];\r\n        parseFunctionArgs(tokens).forEach(function (arg, i) {\r\n            var firstToken = arg[0];\r\n            if (i === 0) {\r\n                if (isIdentToken(firstToken) && firstToken.value === 'linear') {\r\n                    type = CSSImageType.LINEAR_GRADIENT;\r\n                    return;\r\n                }\r\n                else if (isIdentToken(firstToken) && firstToken.value === 'radial') {\r\n                    type = CSSImageType.RADIAL_GRADIENT;\r\n                    return;\r\n                }\r\n            }\r\n            if (firstToken.type === TokenType.FUNCTION) {\r\n                if (firstToken.name === 'from') {\r\n                    var color$1 = color.parse(firstToken.values[0]);\r\n                    stops.push({ stop: ZERO_LENGTH, color: color$1 });\r\n                }\r\n                else if (firstToken.name === 'to') {\r\n                    var color$1 = color.parse(firstToken.values[0]);\r\n                    stops.push({ stop: HUNDRED_PERCENT, color: color$1 });\r\n                }\r\n                else if (firstToken.name === 'color-stop') {\r\n                    var values = firstToken.values.filter(nonFunctionArgSeparator);\r\n                    if (values.length === 2) {\r\n                        var color$1 = color.parse(values[1]);\r\n                        var stop_1 = values[0];\r\n                        if (isNumberToken(stop_1)) {\r\n                            stops.push({\r\n                                stop: { type: TokenType.PERCENTAGE_TOKEN, number: stop_1.number * 100, flags: stop_1.flags },\r\n                                color: color$1\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return type === CSSImageType.LINEAR_GRADIENT\r\n            ? {\r\n                angle: (angle + deg(180)) % deg(360),\r\n                stops: stops,\r\n                type: type\r\n            }\r\n            : { size: size, shape: shape, stops: stops, position: position, type: type };\r\n    };\r\n\r\n    var CLOSEST_SIDE = 'closest-side';\r\n    var FARTHEST_SIDE = 'farthest-side';\r\n    var CLOSEST_CORNER = 'closest-corner';\r\n    var FARTHEST_CORNER = 'farthest-corner';\r\n    var CIRCLE = 'circle';\r\n    var ELLIPSE = 'ellipse';\r\n    var COVER = 'cover';\r\n    var CONTAIN = 'contain';\r\n    var radialGradient = function (tokens) {\r\n        var shape = CSSRadialShape.CIRCLE;\r\n        var size = CSSRadialExtent.FARTHEST_CORNER;\r\n        var stops = [];\r\n        var position = [];\r\n        parseFunctionArgs(tokens).forEach(function (arg, i) {\r\n            var isColorStop = true;\r\n            if (i === 0) {\r\n                var isAtPosition_1 = false;\r\n                isColorStop = arg.reduce(function (acc, token) {\r\n                    if (isAtPosition_1) {\r\n                        if (isIdentToken(token)) {\r\n                            switch (token.value) {\r\n                                case 'center':\r\n                                    position.push(FIFTY_PERCENT);\r\n                                    return acc;\r\n                                case 'top':\r\n                                case 'left':\r\n                                    position.push(ZERO_LENGTH);\r\n                                    return acc;\r\n                                case 'right':\r\n                                case 'bottom':\r\n                                    position.push(HUNDRED_PERCENT);\r\n                                    return acc;\r\n                            }\r\n                        }\r\n                        else if (isLengthPercentage(token) || isLength(token)) {\r\n                            position.push(token);\r\n                        }\r\n                    }\r\n                    else if (isIdentToken(token)) {\r\n                        switch (token.value) {\r\n                            case CIRCLE:\r\n                                shape = CSSRadialShape.CIRCLE;\r\n                                return false;\r\n                            case ELLIPSE:\r\n                                shape = CSSRadialShape.ELLIPSE;\r\n                                return false;\r\n                            case 'at':\r\n                                isAtPosition_1 = true;\r\n                                return false;\r\n                            case CLOSEST_SIDE:\r\n                                size = CSSRadialExtent.CLOSEST_SIDE;\r\n                                return false;\r\n                            case COVER:\r\n                            case FARTHEST_SIDE:\r\n                                size = CSSRadialExtent.FARTHEST_SIDE;\r\n                                return false;\r\n                            case CONTAIN:\r\n                            case CLOSEST_CORNER:\r\n                                size = CSSRadialExtent.CLOSEST_CORNER;\r\n                                return false;\r\n                            case FARTHEST_CORNER:\r\n                                size = CSSRadialExtent.FARTHEST_CORNER;\r\n                                return false;\r\n                        }\r\n                    }\r\n                    else if (isLength(token) || isLengthPercentage(token)) {\r\n                        if (!Array.isArray(size)) {\r\n                            size = [];\r\n                        }\r\n                        size.push(token);\r\n                        return false;\r\n                    }\r\n                    return acc;\r\n                }, isColorStop);\r\n            }\r\n            if (isColorStop) {\r\n                var colorStop = parseColorStop(arg);\r\n                stops.push(colorStop);\r\n            }\r\n        });\r\n        return { size: size, shape: shape, stops: stops, position: position, type: CSSImageType.RADIAL_GRADIENT };\r\n    };\r\n\r\n    var prefixRadialGradient = function (tokens) {\r\n        var shape = CSSRadialShape.CIRCLE;\r\n        var size = CSSRadialExtent.FARTHEST_CORNER;\r\n        var stops = [];\r\n        var position = [];\r\n        parseFunctionArgs(tokens).forEach(function (arg, i) {\r\n            var isColorStop = true;\r\n            if (i === 0) {\r\n                isColorStop = arg.reduce(function (acc, token) {\r\n                    if (isIdentToken(token)) {\r\n                        switch (token.value) {\r\n                            case 'center':\r\n                                position.push(FIFTY_PERCENT);\r\n                                return false;\r\n                            case 'top':\r\n                            case 'left':\r\n                                position.push(ZERO_LENGTH);\r\n                                return false;\r\n                            case 'right':\r\n                            case 'bottom':\r\n                                position.push(HUNDRED_PERCENT);\r\n                                return false;\r\n                        }\r\n                    }\r\n                    else if (isLengthPercentage(token) || isLength(token)) {\r\n                        position.push(token);\r\n                        return false;\r\n                    }\r\n                    return acc;\r\n                }, isColorStop);\r\n            }\r\n            else if (i === 1) {\r\n                isColorStop = arg.reduce(function (acc, token) {\r\n                    if (isIdentToken(token)) {\r\n                        switch (token.value) {\r\n                            case CIRCLE:\r\n                                shape = CSSRadialShape.CIRCLE;\r\n                                return false;\r\n                            case ELLIPSE:\r\n                                shape = CSSRadialShape.ELLIPSE;\r\n                                return false;\r\n                            case CONTAIN:\r\n                            case CLOSEST_SIDE:\r\n                                size = CSSRadialExtent.CLOSEST_SIDE;\r\n                                return false;\r\n                            case FARTHEST_SIDE:\r\n                                size = CSSRadialExtent.FARTHEST_SIDE;\r\n                                return false;\r\n                            case CLOSEST_CORNER:\r\n                                size = CSSRadialExtent.CLOSEST_CORNER;\r\n                                return false;\r\n                            case COVER:\r\n                            case FARTHEST_CORNER:\r\n                                size = CSSRadialExtent.FARTHEST_CORNER;\r\n                                return false;\r\n                        }\r\n                    }\r\n                    else if (isLength(token) || isLengthPercentage(token)) {\r\n                        if (!Array.isArray(size)) {\r\n                            size = [];\r\n                        }\r\n                        size.push(token);\r\n                        return false;\r\n                    }\r\n                    return acc;\r\n                }, isColorStop);\r\n            }\r\n            if (isColorStop) {\r\n                var colorStop = parseColorStop(arg);\r\n                stops.push(colorStop);\r\n            }\r\n        });\r\n        return { size: size, shape: shape, stops: stops, position: position, type: CSSImageType.RADIAL_GRADIENT };\r\n    };\r\n\r\n    var CSSImageType;\r\n    (function (CSSImageType) {\r\n        CSSImageType[CSSImageType[\"URL\"] = 0] = \"URL\";\r\n        CSSImageType[CSSImageType[\"LINEAR_GRADIENT\"] = 1] = \"LINEAR_GRADIENT\";\r\n        CSSImageType[CSSImageType[\"RADIAL_GRADIENT\"] = 2] = \"RADIAL_GRADIENT\";\r\n    })(CSSImageType || (CSSImageType = {}));\r\n    var isLinearGradient = function (background) {\r\n        return background.type === CSSImageType.LINEAR_GRADIENT;\r\n    };\r\n    var isRadialGradient = function (background) {\r\n        return background.type === CSSImageType.RADIAL_GRADIENT;\r\n    };\r\n    var CSSRadialShape;\r\n    (function (CSSRadialShape) {\r\n        CSSRadialShape[CSSRadialShape[\"CIRCLE\"] = 0] = \"CIRCLE\";\r\n        CSSRadialShape[CSSRadialShape[\"ELLIPSE\"] = 1] = \"ELLIPSE\";\r\n    })(CSSRadialShape || (CSSRadialShape = {}));\r\n    var CSSRadialExtent;\r\n    (function (CSSRadialExtent) {\r\n        CSSRadialExtent[CSSRadialExtent[\"CLOSEST_SIDE\"] = 0] = \"CLOSEST_SIDE\";\r\n        CSSRadialExtent[CSSRadialExtent[\"FARTHEST_SIDE\"] = 1] = \"FARTHEST_SIDE\";\r\n        CSSRadialExtent[CSSRadialExtent[\"CLOSEST_CORNER\"] = 2] = \"CLOSEST_CORNER\";\r\n        CSSRadialExtent[CSSRadialExtent[\"FARTHEST_CORNER\"] = 3] = \"FARTHEST_CORNER\";\r\n    })(CSSRadialExtent || (CSSRadialExtent = {}));\r\n    var image = {\r\n        name: 'image',\r\n        parse: function (value) {\r\n            if (value.type === TokenType.URL_TOKEN) {\r\n                var image_1 = { url: value.value, type: CSSImageType.URL };\r\n                CacheStorage.getInstance().addImage(value.value);\r\n                return image_1;\r\n            }\r\n            if (value.type === TokenType.FUNCTION) {\r\n                var imageFunction = SUPPORTED_IMAGE_FUNCTIONS[value.name];\r\n                if (typeof imageFunction === 'undefined') {\r\n                    throw new Error(\"Attempting to parse an unsupported image function \\\"\" + value.name + \"\\\"\");\r\n                }\r\n                return imageFunction(value.values);\r\n            }\r\n            throw new Error(\"Unsupported image type\");\r\n        }\r\n    };\r\n    function isSupportedImage(value) {\r\n        return value.type !== TokenType.FUNCTION || SUPPORTED_IMAGE_FUNCTIONS[value.name];\r\n    }\r\n    var SUPPORTED_IMAGE_FUNCTIONS = {\r\n        'linear-gradient': linearGradient,\r\n        '-moz-linear-gradient': prefixLinearGradient,\r\n        '-ms-linear-gradient': prefixLinearGradient,\r\n        '-o-linear-gradient': prefixLinearGradient,\r\n        '-webkit-linear-gradient': prefixLinearGradient,\r\n        'radial-gradient': radialGradient,\r\n        '-moz-radial-gradient': prefixRadialGradient,\r\n        '-ms-radial-gradient': prefixRadialGradient,\r\n        '-o-radial-gradient': prefixRadialGradient,\r\n        '-webkit-radial-gradient': prefixRadialGradient,\r\n        '-webkit-gradient': webkitGradient\r\n    };\r\n\r\n    var backgroundImage = {\r\n        name: 'background-image',\r\n        initialValue: 'none',\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        prefix: false,\r\n        parse: function (tokens) {\r\n            if (tokens.length === 0) {\r\n                return [];\r\n            }\r\n            var first = tokens[0];\r\n            if (first.type === TokenType.IDENT_TOKEN && first.value === 'none') {\r\n                return [];\r\n            }\r\n            return tokens.filter(function (value) { return nonFunctionArgSeparator(value) && isSupportedImage(value); }).map(image.parse);\r\n        }\r\n    };\r\n\r\n    var backgroundOrigin = {\r\n        name: 'background-origin',\r\n        initialValue: 'border-box',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            return tokens.map(function (token) {\r\n                if (isIdentToken(token)) {\r\n                    switch (token.value) {\r\n                        case 'padding-box':\r\n                            return 1 /* PADDING_BOX */;\r\n                        case 'content-box':\r\n                            return 2 /* CONTENT_BOX */;\r\n                    }\r\n                }\r\n                return 0 /* BORDER_BOX */;\r\n            });\r\n        }\r\n    };\r\n\r\n    var backgroundPosition = {\r\n        name: 'background-position',\r\n        initialValue: '0% 0%',\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        prefix: false,\r\n        parse: function (tokens) {\r\n            return parseFunctionArgs(tokens)\r\n                .map(function (values) { return values.filter(isLengthPercentage); })\r\n                .map(parseLengthPercentageTuple);\r\n        }\r\n    };\r\n\r\n    var BACKGROUND_REPEAT;\r\n    (function (BACKGROUND_REPEAT) {\r\n        BACKGROUND_REPEAT[BACKGROUND_REPEAT[\"REPEAT\"] = 0] = \"REPEAT\";\r\n        BACKGROUND_REPEAT[BACKGROUND_REPEAT[\"NO_REPEAT\"] = 1] = \"NO_REPEAT\";\r\n        BACKGROUND_REPEAT[BACKGROUND_REPEAT[\"REPEAT_X\"] = 2] = \"REPEAT_X\";\r\n        BACKGROUND_REPEAT[BACKGROUND_REPEAT[\"REPEAT_Y\"] = 3] = \"REPEAT_Y\";\r\n    })(BACKGROUND_REPEAT || (BACKGROUND_REPEAT = {}));\r\n    var backgroundRepeat = {\r\n        name: 'background-repeat',\r\n        initialValue: 'repeat',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            return parseFunctionArgs(tokens)\r\n                .map(function (values) {\r\n                    return values\r\n                        .filter(isIdentToken)\r\n                        .map(function (token) { return token.value; })\r\n                        .join(' ');\r\n                })\r\n                .map(parseBackgroundRepeat);\r\n        }\r\n    };\r\n    var parseBackgroundRepeat = function (value) {\r\n        switch (value) {\r\n            case 'no-repeat':\r\n                return BACKGROUND_REPEAT.NO_REPEAT;\r\n            case 'repeat-x':\r\n            case 'repeat no-repeat':\r\n                return BACKGROUND_REPEAT.REPEAT_X;\r\n            case 'repeat-y':\r\n            case 'no-repeat repeat':\r\n                return BACKGROUND_REPEAT.REPEAT_Y;\r\n            case 'repeat':\r\n            default:\r\n                return BACKGROUND_REPEAT.REPEAT;\r\n        }\r\n    };\r\n\r\n    var BACKGROUND_SIZE;\r\n    (function (BACKGROUND_SIZE) {\r\n        BACKGROUND_SIZE[\"AUTO\"] = \"auto\";\r\n        BACKGROUND_SIZE[\"CONTAIN\"] = \"contain\";\r\n        BACKGROUND_SIZE[\"COVER\"] = \"cover\";\r\n    })(BACKGROUND_SIZE || (BACKGROUND_SIZE = {}));\r\n    var backgroundSize = {\r\n        name: 'background-size',\r\n        initialValue: '0',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            return parseFunctionArgs(tokens).map(function (values) { return values.filter(isBackgroundSizeInfoToken); });\r\n        }\r\n    };\r\n    var isBackgroundSizeInfoToken = function (value) {\r\n        return isIdentToken(value) || isLengthPercentage(value);\r\n    };\r\n\r\n    var borderColorForSide = function (side) {\r\n        return ({\r\n            name: \"border-\" + side + \"-color\",\r\n            initialValue: 'transparent',\r\n            prefix: false,\r\n            type: PropertyDescriptorParsingType.TYPE_VALUE,\r\n            format: 'color'\r\n        });\r\n    };\r\n    var borderTopColor = borderColorForSide('top');\r\n    var borderRightColor = borderColorForSide('right');\r\n    var borderBottomColor = borderColorForSide('bottom');\r\n    var borderLeftColor = borderColorForSide('left');\r\n\r\n    var borderRadiusForSide = function (side) {\r\n        return ({\r\n            name: \"border-radius-\" + side,\r\n            initialValue: '0 0',\r\n            prefix: false,\r\n            type: PropertyDescriptorParsingType.LIST,\r\n            parse: function (tokens) { return parseLengthPercentageTuple(tokens.filter(isLengthPercentage)); }\r\n        });\r\n    };\r\n    var borderTopLeftRadius = borderRadiusForSide('top-left');\r\n    var borderTopRightRadius = borderRadiusForSide('top-right');\r\n    var borderBottomRightRadius = borderRadiusForSide('bottom-right');\r\n    var borderBottomLeftRadius = borderRadiusForSide('bottom-left');\r\n\r\n    var BORDER_STYLE;\r\n    (function (BORDER_STYLE) {\r\n        BORDER_STYLE[BORDER_STYLE[\"NONE\"] = 0] = \"NONE\";\r\n        BORDER_STYLE[BORDER_STYLE[\"SOLID\"] = 1] = \"SOLID\";\r\n    })(BORDER_STYLE || (BORDER_STYLE = {}));\r\n    var borderStyleForSide = function (side) {\r\n        return ({\r\n            name: \"border-\" + side + \"-style\",\r\n            initialValue: 'solid',\r\n            prefix: false,\r\n            type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n            parse: function (style) {\r\n                switch (style) {\r\n                    case 'none':\r\n                        return BORDER_STYLE.NONE;\r\n                }\r\n                return BORDER_STYLE.SOLID;\r\n            }\r\n        });\r\n    };\r\n    var borderTopStyle = borderStyleForSide('top');\r\n    var borderRightStyle = borderStyleForSide('right');\r\n    var borderBottomStyle = borderStyleForSide('bottom');\r\n    var borderLeftStyle = borderStyleForSide('left');\r\n\r\n    var borderWidthForSide = function (side) {\r\n        return ({\r\n            name: \"border-\" + side + \"-width\",\r\n            initialValue: '0',\r\n            type: PropertyDescriptorParsingType.VALUE,\r\n            prefix: false,\r\n            parse: function (token) {\r\n                if (isDimensionToken(token)) {\r\n                    return token.number;\r\n                }\r\n                return 0;\r\n            }\r\n        });\r\n    };\r\n    var borderTopWidth = borderWidthForSide('top');\r\n    var borderRightWidth = borderWidthForSide('right');\r\n    var borderBottomWidth = borderWidthForSide('bottom');\r\n    var borderLeftWidth = borderWidthForSide('left');\r\n\r\n    var color$1 = {\r\n        name: \"color\",\r\n        initialValue: 'transparent',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.TYPE_VALUE,\r\n        format: 'color'\r\n    };\r\n\r\n    var display = {\r\n        name: 'display',\r\n        initialValue: 'inline-block',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            return tokens.filter(isIdentToken).reduce(function (bit, token) {\r\n                return bit | parseDisplayValue(token.value);\r\n            }, 0 /* NONE */);\r\n        }\r\n    };\r\n    var parseDisplayValue = function (display) {\r\n        switch (display) {\r\n            case 'block':\r\n                return 2 /* BLOCK */;\r\n            case 'inline':\r\n                return 4 /* INLINE */;\r\n            case 'run-in':\r\n                return 8 /* RUN_IN */;\r\n            case 'flow':\r\n                return 16 /* FLOW */;\r\n            case 'flow-root':\r\n                return 32 /* FLOW_ROOT */;\r\n            case 'table':\r\n                return 64 /* TABLE */;\r\n            case 'flex':\r\n            case '-webkit-flex':\r\n                return 128 /* FLEX */;\r\n            case 'grid':\r\n            case '-ms-grid':\r\n                return 256 /* GRID */;\r\n            case 'ruby':\r\n                return 512 /* RUBY */;\r\n            case 'subgrid':\r\n                return 1024 /* SUBGRID */;\r\n            case 'list-item':\r\n                return 2048 /* LIST_ITEM */;\r\n            case 'table-row-group':\r\n                return 4096 /* TABLE_ROW_GROUP */;\r\n            case 'table-header-group':\r\n                return 8192 /* TABLE_HEADER_GROUP */;\r\n            case 'table-footer-group':\r\n                return 16384 /* TABLE_FOOTER_GROUP */;\r\n            case 'table-row':\r\n                return 32768 /* TABLE_ROW */;\r\n            case 'table-cell':\r\n                return 65536 /* TABLE_CELL */;\r\n            case 'table-column-group':\r\n                return 131072 /* TABLE_COLUMN_GROUP */;\r\n            case 'table-column':\r\n                return 262144 /* TABLE_COLUMN */;\r\n            case 'table-caption':\r\n                return 524288 /* TABLE_CAPTION */;\r\n            case 'ruby-base':\r\n                return 1048576 /* RUBY_BASE */;\r\n            case 'ruby-text':\r\n                return 2097152 /* RUBY_TEXT */;\r\n            case 'ruby-base-container':\r\n                return 4194304 /* RUBY_BASE_CONTAINER */;\r\n            case 'ruby-text-container':\r\n                return 8388608 /* RUBY_TEXT_CONTAINER */;\r\n            case 'contents':\r\n                return 16777216 /* CONTENTS */;\r\n            case 'inline-block':\r\n                return 33554432 /* INLINE_BLOCK */;\r\n            case 'inline-list-item':\r\n                return 67108864 /* INLINE_LIST_ITEM */;\r\n            case 'inline-table':\r\n                return 134217728 /* INLINE_TABLE */;\r\n            case 'inline-flex':\r\n                return 268435456 /* INLINE_FLEX */;\r\n            case 'inline-grid':\r\n                return 536870912 /* INLINE_GRID */;\r\n        }\r\n        return 0 /* NONE */;\r\n    };\r\n\r\n    var FLOAT;\r\n    (function (FLOAT) {\r\n        FLOAT[FLOAT[\"NONE\"] = 0] = \"NONE\";\r\n        FLOAT[FLOAT[\"LEFT\"] = 1] = \"LEFT\";\r\n        FLOAT[FLOAT[\"RIGHT\"] = 2] = \"RIGHT\";\r\n        FLOAT[FLOAT[\"INLINE_START\"] = 3] = \"INLINE_START\";\r\n        FLOAT[FLOAT[\"INLINE_END\"] = 4] = \"INLINE_END\";\r\n    })(FLOAT || (FLOAT = {}));\r\n    var float = {\r\n        name: 'float',\r\n        initialValue: 'none',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n        parse: function (float) {\r\n            switch (float) {\r\n                case 'left':\r\n                    return FLOAT.LEFT;\r\n                case 'right':\r\n                    return FLOAT.RIGHT;\r\n                case 'inline-start':\r\n                    return FLOAT.INLINE_START;\r\n                case 'inline-end':\r\n                    return FLOAT.INLINE_END;\r\n            }\r\n            return FLOAT.NONE;\r\n        }\r\n    };\r\n\r\n    var letterSpacing = {\r\n        name: 'letter-spacing',\r\n        initialValue: '0',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.VALUE,\r\n        parse: function (token) {\r\n            if (token.type === TokenType.IDENT_TOKEN && token.value === 'normal') {\r\n                return 0;\r\n            }\r\n            if (token.type === TokenType.NUMBER_TOKEN) {\r\n                return token.number;\r\n            }\r\n            if (token.type === TokenType.DIMENSION_TOKEN) {\r\n                return token.number;\r\n            }\r\n            return 0;\r\n        }\r\n    };\r\n\r\n    var LINE_BREAK;\r\n    (function (LINE_BREAK) {\r\n        LINE_BREAK[\"NORMAL\"] = \"normal\";\r\n        LINE_BREAK[\"STRICT\"] = \"strict\";\r\n    })(LINE_BREAK || (LINE_BREAK = {}));\r\n    var lineBreak = {\r\n        name: 'line-break',\r\n        initialValue: 'normal',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n        parse: function (lineBreak) {\r\n            switch (lineBreak) {\r\n                case 'strict':\r\n                    return LINE_BREAK.STRICT;\r\n                case 'normal':\r\n                default:\r\n                    return LINE_BREAK.NORMAL;\r\n            }\r\n        }\r\n    };\r\n\r\n    var lineHeight = {\r\n        name: 'line-height',\r\n        initialValue: 'normal',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.TOKEN_VALUE\r\n    };\r\n    var computeLineHeight = function (token, fontSize) {\r\n        if (isIdentToken(token) && token.value === 'normal') {\r\n            return 1.2 * fontSize;\r\n        }\r\n        else if (token.type === TokenType.NUMBER_TOKEN) {\r\n            return fontSize * token.number;\r\n        }\r\n        else if (isLengthPercentage(token)) {\r\n            return getAbsoluteValue(token, fontSize);\r\n        }\r\n        return fontSize;\r\n    };\r\n\r\n    var listStyleImage = {\r\n        name: 'list-style-image',\r\n        initialValue: 'none',\r\n        type: PropertyDescriptorParsingType.VALUE,\r\n        prefix: false,\r\n        parse: function (token) {\r\n            if (token.type === TokenType.IDENT_TOKEN && token.value === 'none') {\r\n                return null;\r\n            }\r\n            return image.parse(token);\r\n        }\r\n    };\r\n\r\n    var LIST_STYLE_POSITION;\r\n    (function (LIST_STYLE_POSITION) {\r\n        LIST_STYLE_POSITION[LIST_STYLE_POSITION[\"INSIDE\"] = 0] = \"INSIDE\";\r\n        LIST_STYLE_POSITION[LIST_STYLE_POSITION[\"OUTSIDE\"] = 1] = \"OUTSIDE\";\r\n    })(LIST_STYLE_POSITION || (LIST_STYLE_POSITION = {}));\r\n    var listStylePosition = {\r\n        name: 'list-style-position',\r\n        initialValue: 'outside',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n        parse: function (position) {\r\n            switch (position) {\r\n                case 'inside':\r\n                    return LIST_STYLE_POSITION.INSIDE;\r\n                case 'outside':\r\n                default:\r\n                    return LIST_STYLE_POSITION.OUTSIDE;\r\n            }\r\n        }\r\n    };\r\n\r\n    var LIST_STYLE_TYPE;\r\n    (function (LIST_STYLE_TYPE) {\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"NONE\"] = -1] = \"NONE\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"DISC\"] = 0] = \"DISC\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"CIRCLE\"] = 1] = \"CIRCLE\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"SQUARE\"] = 2] = \"SQUARE\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"DECIMAL\"] = 3] = \"DECIMAL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"CJK_DECIMAL\"] = 4] = \"CJK_DECIMAL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"DECIMAL_LEADING_ZERO\"] = 5] = \"DECIMAL_LEADING_ZERO\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"LOWER_ROMAN\"] = 6] = \"LOWER_ROMAN\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"UPPER_ROMAN\"] = 7] = \"UPPER_ROMAN\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"LOWER_GREEK\"] = 8] = \"LOWER_GREEK\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"LOWER_ALPHA\"] = 9] = \"LOWER_ALPHA\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"UPPER_ALPHA\"] = 10] = \"UPPER_ALPHA\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"ARABIC_INDIC\"] = 11] = \"ARABIC_INDIC\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"ARMENIAN\"] = 12] = \"ARMENIAN\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"BENGALI\"] = 13] = \"BENGALI\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"CAMBODIAN\"] = 14] = \"CAMBODIAN\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"CJK_EARTHLY_BRANCH\"] = 15] = \"CJK_EARTHLY_BRANCH\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"CJK_HEAVENLY_STEM\"] = 16] = \"CJK_HEAVENLY_STEM\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"CJK_IDEOGRAPHIC\"] = 17] = \"CJK_IDEOGRAPHIC\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"DEVANAGARI\"] = 18] = \"DEVANAGARI\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"ETHIOPIC_NUMERIC\"] = 19] = \"ETHIOPIC_NUMERIC\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"GEORGIAN\"] = 20] = \"GEORGIAN\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"GUJARATI\"] = 21] = \"GUJARATI\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"GURMUKHI\"] = 22] = \"GURMUKHI\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"HEBREW\"] = 22] = \"HEBREW\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"HIRAGANA\"] = 23] = \"HIRAGANA\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"HIRAGANA_IROHA\"] = 24] = \"HIRAGANA_IROHA\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"JAPANESE_FORMAL\"] = 25] = \"JAPANESE_FORMAL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"JAPANESE_INFORMAL\"] = 26] = \"JAPANESE_INFORMAL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"KANNADA\"] = 27] = \"KANNADA\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"KATAKANA\"] = 28] = \"KATAKANA\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"KATAKANA_IROHA\"] = 29] = \"KATAKANA_IROHA\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"KHMER\"] = 30] = \"KHMER\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"KOREAN_HANGUL_FORMAL\"] = 31] = \"KOREAN_HANGUL_FORMAL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"KOREAN_HANJA_FORMAL\"] = 32] = \"KOREAN_HANJA_FORMAL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"KOREAN_HANJA_INFORMAL\"] = 33] = \"KOREAN_HANJA_INFORMAL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"LAO\"] = 34] = \"LAO\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"LOWER_ARMENIAN\"] = 35] = \"LOWER_ARMENIAN\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"MALAYALAM\"] = 36] = \"MALAYALAM\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"MONGOLIAN\"] = 37] = \"MONGOLIAN\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"MYANMAR\"] = 38] = \"MYANMAR\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"ORIYA\"] = 39] = \"ORIYA\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"PERSIAN\"] = 40] = \"PERSIAN\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"SIMP_CHINESE_FORMAL\"] = 41] = \"SIMP_CHINESE_FORMAL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"SIMP_CHINESE_INFORMAL\"] = 42] = \"SIMP_CHINESE_INFORMAL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"TAMIL\"] = 43] = \"TAMIL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"TELUGU\"] = 44] = \"TELUGU\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"THAI\"] = 45] = \"THAI\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"TIBETAN\"] = 46] = \"TIBETAN\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"TRAD_CHINESE_FORMAL\"] = 47] = \"TRAD_CHINESE_FORMAL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"TRAD_CHINESE_INFORMAL\"] = 48] = \"TRAD_CHINESE_INFORMAL\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"UPPER_ARMENIAN\"] = 49] = \"UPPER_ARMENIAN\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"DISCLOSURE_OPEN\"] = 50] = \"DISCLOSURE_OPEN\";\r\n        LIST_STYLE_TYPE[LIST_STYLE_TYPE[\"DISCLOSURE_CLOSED\"] = 51] = \"DISCLOSURE_CLOSED\";\r\n    })(LIST_STYLE_TYPE || (LIST_STYLE_TYPE = {}));\r\n    var listStyleType = {\r\n        name: 'list-style-type',\r\n        initialValue: 'none',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n        parse: function (type) {\r\n            switch (type) {\r\n                case 'disc':\r\n                    return LIST_STYLE_TYPE.DISC;\r\n                case 'circle':\r\n                    return LIST_STYLE_TYPE.CIRCLE;\r\n                case 'square':\r\n                    return LIST_STYLE_TYPE.SQUARE;\r\n                case 'decimal':\r\n                    return LIST_STYLE_TYPE.DECIMAL;\r\n                case 'cjk-decimal':\r\n                    return LIST_STYLE_TYPE.CJK_DECIMAL;\r\n                case 'decimal-leading-zero':\r\n                    return LIST_STYLE_TYPE.DECIMAL_LEADING_ZERO;\r\n                case 'lower-roman':\r\n                    return LIST_STYLE_TYPE.LOWER_ROMAN;\r\n                case 'upper-roman':\r\n                    return LIST_STYLE_TYPE.UPPER_ROMAN;\r\n                case 'lower-greek':\r\n                    return LIST_STYLE_TYPE.LOWER_GREEK;\r\n                case 'lower-alpha':\r\n                    return LIST_STYLE_TYPE.LOWER_ALPHA;\r\n                case 'upper-alpha':\r\n                    return LIST_STYLE_TYPE.UPPER_ALPHA;\r\n                case 'arabic-indic':\r\n                    return LIST_STYLE_TYPE.ARABIC_INDIC;\r\n                case 'armenian':\r\n                    return LIST_STYLE_TYPE.ARMENIAN;\r\n                case 'bengali':\r\n                    return LIST_STYLE_TYPE.BENGALI;\r\n                case 'cambodian':\r\n                    return LIST_STYLE_TYPE.CAMBODIAN;\r\n                case 'cjk-earthly-branch':\r\n                    return LIST_STYLE_TYPE.CJK_EARTHLY_BRANCH;\r\n                case 'cjk-heavenly-stem':\r\n                    return LIST_STYLE_TYPE.CJK_HEAVENLY_STEM;\r\n                case 'cjk-ideographic':\r\n                    return LIST_STYLE_TYPE.CJK_IDEOGRAPHIC;\r\n                case 'devanagari':\r\n                    return LIST_STYLE_TYPE.DEVANAGARI;\r\n                case 'ethiopic-numeric':\r\n                    return LIST_STYLE_TYPE.ETHIOPIC_NUMERIC;\r\n                case 'georgian':\r\n                    return LIST_STYLE_TYPE.GEORGIAN;\r\n                case 'gujarati':\r\n                    return LIST_STYLE_TYPE.GUJARATI;\r\n                case 'gurmukhi':\r\n                    return LIST_STYLE_TYPE.GURMUKHI;\r\n                case 'hebrew':\r\n                    return LIST_STYLE_TYPE.HEBREW;\r\n                case 'hiragana':\r\n                    return LIST_STYLE_TYPE.HIRAGANA;\r\n                case 'hiragana-iroha':\r\n                    return LIST_STYLE_TYPE.HIRAGANA_IROHA;\r\n                case 'japanese-formal':\r\n                    return LIST_STYLE_TYPE.JAPANESE_FORMAL;\r\n                case 'japanese-informal':\r\n                    return LIST_STYLE_TYPE.JAPANESE_INFORMAL;\r\n                case 'kannada':\r\n                    return LIST_STYLE_TYPE.KANNADA;\r\n                case 'katakana':\r\n                    return LIST_STYLE_TYPE.KATAKANA;\r\n                case 'katakana-iroha':\r\n                    return LIST_STYLE_TYPE.KATAKANA_IROHA;\r\n                case 'khmer':\r\n                    return LIST_STYLE_TYPE.KHMER;\r\n                case 'korean-hangul-formal':\r\n                    return LIST_STYLE_TYPE.KOREAN_HANGUL_FORMAL;\r\n                case 'korean-hanja-formal':\r\n                    return LIST_STYLE_TYPE.KOREAN_HANJA_FORMAL;\r\n                case 'korean-hanja-informal':\r\n                    return LIST_STYLE_TYPE.KOREAN_HANJA_INFORMAL;\r\n                case 'lao':\r\n                    return LIST_STYLE_TYPE.LAO;\r\n                case 'lower-armenian':\r\n                    return LIST_STYLE_TYPE.LOWER_ARMENIAN;\r\n                case 'malayalam':\r\n                    return LIST_STYLE_TYPE.MALAYALAM;\r\n                case 'mongolian':\r\n                    return LIST_STYLE_TYPE.MONGOLIAN;\r\n                case 'myanmar':\r\n                    return LIST_STYLE_TYPE.MYANMAR;\r\n                case 'oriya':\r\n                    return LIST_STYLE_TYPE.ORIYA;\r\n                case 'persian':\r\n                    return LIST_STYLE_TYPE.PERSIAN;\r\n                case 'simp-chinese-formal':\r\n                    return LIST_STYLE_TYPE.SIMP_CHINESE_FORMAL;\r\n                case 'simp-chinese-informal':\r\n                    return LIST_STYLE_TYPE.SIMP_CHINESE_INFORMAL;\r\n                case 'tamil':\r\n                    return LIST_STYLE_TYPE.TAMIL;\r\n                case 'telugu':\r\n                    return LIST_STYLE_TYPE.TELUGU;\r\n                case 'thai':\r\n                    return LIST_STYLE_TYPE.THAI;\r\n                case 'tibetan':\r\n                    return LIST_STYLE_TYPE.TIBETAN;\r\n                case 'trad-chinese-formal':\r\n                    return LIST_STYLE_TYPE.TRAD_CHINESE_FORMAL;\r\n                case 'trad-chinese-informal':\r\n                    return LIST_STYLE_TYPE.TRAD_CHINESE_INFORMAL;\r\n                case 'upper-armenian':\r\n                    return LIST_STYLE_TYPE.UPPER_ARMENIAN;\r\n                case 'disclosure-open':\r\n                    return LIST_STYLE_TYPE.DISCLOSURE_OPEN;\r\n                case 'disclosure-closed':\r\n                    return LIST_STYLE_TYPE.DISCLOSURE_CLOSED;\r\n                case 'none':\r\n                default:\r\n                    return LIST_STYLE_TYPE.NONE;\r\n            }\r\n        }\r\n    };\r\n\r\n    var marginForSide = function (side) {\r\n        return ({\r\n            name: \"margin-\" + side,\r\n            initialValue: '0',\r\n            prefix: false,\r\n            type: PropertyDescriptorParsingType.TOKEN_VALUE\r\n        });\r\n    };\r\n    var marginTop = marginForSide('top');\r\n    var marginRight = marginForSide('right');\r\n    var marginBottom = marginForSide('bottom');\r\n    var marginLeft = marginForSide('left');\r\n\r\n    var OVERFLOW;\r\n    (function (OVERFLOW) {\r\n        OVERFLOW[OVERFLOW[\"VISIBLE\"] = 0] = \"VISIBLE\";\r\n        OVERFLOW[OVERFLOW[\"HIDDEN\"] = 1] = \"HIDDEN\";\r\n        OVERFLOW[OVERFLOW[\"SCROLL\"] = 2] = \"SCROLL\";\r\n        OVERFLOW[OVERFLOW[\"AUTO\"] = 3] = \"AUTO\";\r\n    })(OVERFLOW || (OVERFLOW = {}));\r\n    var overflow = {\r\n        name: 'overflow',\r\n        initialValue: 'visible',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            return tokens.filter(isIdentToken).map(function (overflow) {\r\n                switch (overflow.value) {\r\n                    case 'hidden':\r\n                        return OVERFLOW.HIDDEN;\r\n                    case 'scroll':\r\n                        return OVERFLOW.SCROLL;\r\n                    case 'auto':\r\n                        return OVERFLOW.AUTO;\r\n                    case 'visible':\r\n                    default:\r\n                        return OVERFLOW.VISIBLE;\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    var OVERFLOW_WRAP;\r\n    (function (OVERFLOW_WRAP) {\r\n        OVERFLOW_WRAP[\"NORMAL\"] = \"normal\";\r\n        OVERFLOW_WRAP[\"BREAK_WORD\"] = \"break-word\";\r\n    })(OVERFLOW_WRAP || (OVERFLOW_WRAP = {}));\r\n    var overflowWrap = {\r\n        name: 'overflow-wrap',\r\n        initialValue: 'normal',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n        parse: function (overflow) {\r\n            switch (overflow) {\r\n                case 'break-word':\r\n                    return OVERFLOW_WRAP.BREAK_WORD;\r\n                case 'normal':\r\n                default:\r\n                    return OVERFLOW_WRAP.NORMAL;\r\n            }\r\n        }\r\n    };\r\n\r\n    var paddingForSide = function (side) {\r\n        return ({\r\n            name: \"padding-\" + side,\r\n            initialValue: '0',\r\n            prefix: false,\r\n            type: PropertyDescriptorParsingType.TYPE_VALUE,\r\n            format: 'length-percentage'\r\n        });\r\n    };\r\n    var paddingTop = paddingForSide('top');\r\n    var paddingRight = paddingForSide('right');\r\n    var paddingBottom = paddingForSide('bottom');\r\n    var paddingLeft = paddingForSide('left');\r\n\r\n    var TEXT_ALIGN;\r\n    (function (TEXT_ALIGN) {\r\n        TEXT_ALIGN[TEXT_ALIGN[\"LEFT\"] = 0] = \"LEFT\";\r\n        TEXT_ALIGN[TEXT_ALIGN[\"CENTER\"] = 1] = \"CENTER\";\r\n        TEXT_ALIGN[TEXT_ALIGN[\"RIGHT\"] = 2] = \"RIGHT\";\r\n    })(TEXT_ALIGN || (TEXT_ALIGN = {}));\r\n    var textAlign = {\r\n        name: 'text-align',\r\n        initialValue: 'left',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n        parse: function (textAlign) {\r\n            switch (textAlign) {\r\n                case 'right':\r\n                    return TEXT_ALIGN.RIGHT;\r\n                case 'center':\r\n                case 'justify':\r\n                    return TEXT_ALIGN.CENTER;\r\n                case 'left':\r\n                default:\r\n                    return TEXT_ALIGN.LEFT;\r\n            }\r\n        }\r\n    };\r\n\r\n    var POSITION;\r\n    (function (POSITION) {\r\n        POSITION[POSITION[\"STATIC\"] = 0] = \"STATIC\";\r\n        POSITION[POSITION[\"RELATIVE\"] = 1] = \"RELATIVE\";\r\n        POSITION[POSITION[\"ABSOLUTE\"] = 2] = \"ABSOLUTE\";\r\n        POSITION[POSITION[\"FIXED\"] = 3] = \"FIXED\";\r\n        POSITION[POSITION[\"STICKY\"] = 4] = \"STICKY\";\r\n    })(POSITION || (POSITION = {}));\r\n    var position = {\r\n        name: 'position',\r\n        initialValue: 'static',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n        parse: function (position) {\r\n            switch (position) {\r\n                case 'relative':\r\n                    return POSITION.RELATIVE;\r\n                case 'absolute':\r\n                    return POSITION.ABSOLUTE;\r\n                case 'fixed':\r\n                    return POSITION.FIXED;\r\n                case 'sticky':\r\n                    return POSITION.STICKY;\r\n            }\r\n            return POSITION.STATIC;\r\n        }\r\n    };\r\n\r\n    var textShadow = {\r\n        name: 'text-shadow',\r\n        initialValue: 'none',\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        prefix: false,\r\n        parse: function (tokens) {\r\n            if (tokens.length === 1 && isIdentWithValue(tokens[0], 'none')) {\r\n                return [];\r\n            }\r\n            return parseFunctionArgs(tokens).map(function (values) {\r\n                var shadow = {\r\n                    color: COLORS.TRANSPARENT,\r\n                    offsetX: ZERO_LENGTH,\r\n                    offsetY: ZERO_LENGTH,\r\n                    blur: ZERO_LENGTH\r\n                };\r\n                var c = 0;\r\n                for (var i = 0; i < values.length; i++) {\r\n                    var token = values[i];\r\n                    if (isLength(token)) {\r\n                        if (c === 0) {\r\n                            shadow.offsetX = token;\r\n                        }\r\n                        else if (c === 1) {\r\n                            shadow.offsetY = token;\r\n                        }\r\n                        else {\r\n                            shadow.blur = token;\r\n                        }\r\n                        c++;\r\n                    }\r\n                    else {\r\n                        shadow.color = color.parse(token);\r\n                    }\r\n                }\r\n                return shadow;\r\n            });\r\n        }\r\n    };\r\n\r\n    var TEXT_TRANSFORM;\r\n    (function (TEXT_TRANSFORM) {\r\n        TEXT_TRANSFORM[TEXT_TRANSFORM[\"NONE\"] = 0] = \"NONE\";\r\n        TEXT_TRANSFORM[TEXT_TRANSFORM[\"LOWERCASE\"] = 1] = \"LOWERCASE\";\r\n        TEXT_TRANSFORM[TEXT_TRANSFORM[\"UPPERCASE\"] = 2] = \"UPPERCASE\";\r\n        TEXT_TRANSFORM[TEXT_TRANSFORM[\"CAPITALIZE\"] = 3] = \"CAPITALIZE\";\r\n    })(TEXT_TRANSFORM || (TEXT_TRANSFORM = {}));\r\n    var textTransform = {\r\n        name: 'text-transform',\r\n        initialValue: 'none',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n        parse: function (textTransform) {\r\n            switch (textTransform) {\r\n                case 'uppercase':\r\n                    return TEXT_TRANSFORM.UPPERCASE;\r\n                case 'lowercase':\r\n                    return TEXT_TRANSFORM.LOWERCASE;\r\n                case 'capitalize':\r\n                    return TEXT_TRANSFORM.CAPITALIZE;\r\n            }\r\n            return TEXT_TRANSFORM.NONE;\r\n        }\r\n    };\r\n\r\n    var transform = {\r\n        name: 'transform',\r\n        initialValue: 'none',\r\n        prefix: true,\r\n        type: PropertyDescriptorParsingType.VALUE,\r\n        parse: function (token) {\r\n            if (token.type === TokenType.IDENT_TOKEN && token.value === 'none') {\r\n                return null;\r\n            }\r\n            if (token.type === TokenType.FUNCTION) {\r\n                var transformFunction = SUPPORTED_TRANSFORM_FUNCTIONS[token.name];\r\n                if (typeof transformFunction === 'undefined') {\r\n                    throw new Error(\"Attempting to parse an unsupported transform function \\\"\" + token.name + \"\\\"\");\r\n                }\r\n                return transformFunction(token.values);\r\n            }\r\n            return null;\r\n        }\r\n    };\r\n    var matrix = function (args) {\r\n        var values = args.filter(function (arg) { return arg.type === TokenType.NUMBER_TOKEN; }).map(function (arg) { return arg.number; });\r\n        return values.length === 6 ? values : null;\r\n    };\r\n    // doesn't support 3D transforms at the moment\r\n    var matrix3d = function (args) {\r\n        var values = args.filter(function (arg) { return arg.type === TokenType.NUMBER_TOKEN; }).map(function (arg) { return arg.number; });\r\n        var a1 = values[0], b1 = values[1], _a = values[2], _b = values[3], a2 = values[4], b2 = values[5], _c = values[6], _d = values[7], _e = values[8], _f = values[9], _g = values[10], _h = values[11], a4 = values[12], b4 = values[13], _j = values[14], _k = values[15];\r\n        return values.length === 16 ? [a1, b1, a2, b2, a4, b4] : null;\r\n    };\r\n    var SUPPORTED_TRANSFORM_FUNCTIONS = {\r\n        matrix: matrix,\r\n        matrix3d: matrix3d\r\n    };\r\n\r\n    var DEFAULT_VALUE = {\r\n        type: TokenType.PERCENTAGE_TOKEN,\r\n        number: 50,\r\n        flags: FLAG_INTEGER\r\n    };\r\n    var DEFAULT = [DEFAULT_VALUE, DEFAULT_VALUE];\r\n    var transformOrigin = {\r\n        name: 'transform-origin',\r\n        initialValue: '50% 50%',\r\n        prefix: true,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            var origins = tokens.filter(isLengthPercentage);\r\n            if (origins.length !== 2) {\r\n                return DEFAULT;\r\n            }\r\n            return [origins[0], origins[1]];\r\n        }\r\n    };\r\n\r\n    var VISIBILITY;\r\n    (function (VISIBILITY) {\r\n        VISIBILITY[VISIBILITY[\"VISIBLE\"] = 0] = \"VISIBLE\";\r\n        VISIBILITY[VISIBILITY[\"HIDDEN\"] = 1] = \"HIDDEN\";\r\n        VISIBILITY[VISIBILITY[\"COLLAPSE\"] = 2] = \"COLLAPSE\";\r\n    })(VISIBILITY || (VISIBILITY = {}));\r\n    var visibility = {\r\n        name: 'visible',\r\n        initialValue: 'none',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n        parse: function (visibility) {\r\n            switch (visibility) {\r\n                case 'hidden':\r\n                    return VISIBILITY.HIDDEN;\r\n                case 'collapse':\r\n                    return VISIBILITY.COLLAPSE;\r\n                case 'visible':\r\n                default:\r\n                    return VISIBILITY.VISIBLE;\r\n            }\r\n        }\r\n    };\r\n\r\n    var WORD_BREAK;\r\n    (function (WORD_BREAK) {\r\n        WORD_BREAK[\"NORMAL\"] = \"normal\";\r\n        WORD_BREAK[\"BREAK_ALL\"] = \"break-all\";\r\n        WORD_BREAK[\"KEEP_ALL\"] = \"keep-all\";\r\n    })(WORD_BREAK || (WORD_BREAK = {}));\r\n    var wordBreak = {\r\n        name: 'word-break',\r\n        initialValue: 'normal',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n        parse: function (wordBreak) {\r\n            switch (wordBreak) {\r\n                case 'break-all':\r\n                    return WORD_BREAK.BREAK_ALL;\r\n                case 'keep-all':\r\n                    return WORD_BREAK.KEEP_ALL;\r\n                case 'normal':\r\n                default:\r\n                    return WORD_BREAK.NORMAL;\r\n            }\r\n        }\r\n    };\r\n\r\n    var zIndex = {\r\n        name: 'z-index',\r\n        initialValue: 'auto',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.VALUE,\r\n        parse: function (token) {\r\n            if (token.type === TokenType.IDENT_TOKEN) {\r\n                return { auto: true, order: 0 };\r\n            }\r\n            if (isNumberToken(token)) {\r\n                return { auto: false, order: token.number };\r\n            }\r\n            throw new Error(\"Invalid z-index number parsed\");\r\n        }\r\n    };\r\n\r\n    var opacity = {\r\n        name: 'opacity',\r\n        initialValue: '1',\r\n        type: PropertyDescriptorParsingType.VALUE,\r\n        prefix: false,\r\n        parse: function (token) {\r\n            if (isNumberToken(token)) {\r\n                return token.number;\r\n            }\r\n            return 1;\r\n        }\r\n    };\r\n\r\n    var textDecorationColor = {\r\n        name: \"text-decoration-color\",\r\n        initialValue: 'transparent',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.TYPE_VALUE,\r\n        format: 'color'\r\n    };\r\n\r\n    var textDecorationLine = {\r\n        name: 'text-decoration-line',\r\n        initialValue: 'none',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            return tokens\r\n                .filter(isIdentToken)\r\n                .map(function (token) {\r\n                    switch (token.value) {\r\n                        case 'underline':\r\n                            return 1 /* UNDERLINE */;\r\n                        case 'overline':\r\n                            return 2 /* OVERLINE */;\r\n                        case 'line-through':\r\n                            return 3 /* LINE_THROUGH */;\r\n                        case 'none':\r\n                            return 4 /* BLINK */;\r\n                    }\r\n                    return 0 /* NONE */;\r\n                })\r\n                .filter(function (line) { return line !== 0 /* NONE */; });\r\n        }\r\n    };\r\n\r\n    var fontFamily = {\r\n        name: \"font-family\",\r\n        initialValue: '',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            return tokens.filter(isStringToken$1).map(function (token) { return token.value; });\r\n        }\r\n    };\r\n    var isStringToken$1 = function (token) {\r\n        return token.type === TokenType.STRING_TOKEN || token.type === TokenType.IDENT_TOKEN;\r\n    };\r\n\r\n    var fontSize = {\r\n        name: \"font-size\",\r\n        initialValue: '0',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.TYPE_VALUE,\r\n        format: 'length'\r\n    };\r\n\r\n    var fontWeight = {\r\n        name: 'font-weight',\r\n        initialValue: 'normal',\r\n        type: PropertyDescriptorParsingType.VALUE,\r\n        prefix: false,\r\n        parse: function (token) {\r\n            if (isNumberToken(token)) {\r\n                return token.number;\r\n            }\r\n            if (isIdentToken(token)) {\r\n                switch (token.value) {\r\n                    case 'bold':\r\n                        return 700;\r\n                    case 'normal':\r\n                    default:\r\n                        return 400;\r\n                }\r\n            }\r\n            return 400;\r\n        }\r\n    };\r\n\r\n    var fontVariant = {\r\n        name: 'font-variant',\r\n        initialValue: 'none',\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        prefix: false,\r\n        parse: function (tokens) {\r\n            return tokens.filter(isIdentToken).map(function (token) { return token.value; });\r\n        }\r\n    };\r\n\r\n    var FONT_STYLE;\r\n    (function (FONT_STYLE) {\r\n        FONT_STYLE[\"NORMAL\"] = \"normal\";\r\n        FONT_STYLE[\"ITALIC\"] = \"italic\";\r\n        FONT_STYLE[\"OBLIQUE\"] = \"oblique\";\r\n    })(FONT_STYLE || (FONT_STYLE = {}));\r\n    var fontStyle = {\r\n        name: 'font-style',\r\n        initialValue: 'normal',\r\n        prefix: false,\r\n        type: PropertyDescriptorParsingType.IDENT_VALUE,\r\n        parse: function (overflow) {\r\n            switch (overflow) {\r\n                case 'oblique':\r\n                    return FONT_STYLE.OBLIQUE;\r\n                case 'italic':\r\n                    return FONT_STYLE.ITALIC;\r\n                case 'normal':\r\n                default:\r\n                    return FONT_STYLE.NORMAL;\r\n            }\r\n        }\r\n    };\r\n\r\n    var contains = function (bit, value) { return (bit & value) !== 0; };\r\n\r\n    var content = {\r\n        name: 'content',\r\n        initialValue: 'none',\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        prefix: false,\r\n        parse: function (tokens) {\r\n            if (tokens.length === 0) {\r\n                return [];\r\n            }\r\n            var first = tokens[0];\r\n            if (first.type === TokenType.IDENT_TOKEN && first.value === 'none') {\r\n                return [];\r\n            }\r\n            return tokens;\r\n        }\r\n    };\r\n\r\n    var counterIncrement = {\r\n        name: 'counter-increment',\r\n        initialValue: 'none',\r\n        prefix: true,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            if (tokens.length === 0) {\r\n                return null;\r\n            }\r\n            var first = tokens[0];\r\n            if (first.type === TokenType.IDENT_TOKEN && first.value === 'none') {\r\n                return null;\r\n            }\r\n            var increments = [];\r\n            var filtered = tokens.filter(nonWhiteSpace);\r\n            for (var i = 0; i < filtered.length; i++) {\r\n                var counter = filtered[i];\r\n                var next = filtered[i + 1];\r\n                if (counter.type === TokenType.IDENT_TOKEN) {\r\n                    var increment = next && isNumberToken(next) ? next.number : 1;\r\n                    increments.push({ counter: counter.value, increment: increment });\r\n                }\r\n            }\r\n            return increments;\r\n        }\r\n    };\r\n\r\n    var counterReset = {\r\n        name: 'counter-reset',\r\n        initialValue: 'none',\r\n        prefix: true,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            if (tokens.length === 0) {\r\n                return [];\r\n            }\r\n            var resets = [];\r\n            var filtered = tokens.filter(nonWhiteSpace);\r\n            for (var i = 0; i < filtered.length; i++) {\r\n                var counter = filtered[i];\r\n                var next = filtered[i + 1];\r\n                if (isIdentToken(counter) && counter.value !== 'none') {\r\n                    var reset = next && isNumberToken(next) ? next.number : 0;\r\n                    resets.push({ counter: counter.value, reset: reset });\r\n                }\r\n            }\r\n            return resets;\r\n        }\r\n    };\r\n\r\n    var quotes = {\r\n        name: 'quotes',\r\n        initialValue: 'none',\r\n        prefix: true,\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        parse: function (tokens) {\r\n            if (tokens.length === 0) {\r\n                return null;\r\n            }\r\n            var first = tokens[0];\r\n            if (first.type === TokenType.IDENT_TOKEN && first.value === 'none') {\r\n                return null;\r\n            }\r\n            var quotes = [];\r\n            var filtered = tokens.filter(isStringToken);\r\n            if (filtered.length % 2 !== 0) {\r\n                return null;\r\n            }\r\n            for (var i = 0; i < filtered.length; i += 2) {\r\n                var open_1 = filtered[i].value;\r\n                var close_1 = filtered[i + 1].value;\r\n                quotes.push({ open: open_1, close: close_1 });\r\n            }\r\n            return quotes;\r\n        }\r\n    };\r\n    var getQuote = function (quotes, depth, open) {\r\n        if (!quotes) {\r\n            return '';\r\n        }\r\n        var quote = quotes[Math.min(depth, quotes.length - 1)];\r\n        if (!quote) {\r\n            return '';\r\n        }\r\n        return open ? quote.open : quote.close;\r\n    };\r\n\r\n    var boxShadow = {\r\n        name: 'box-shadow',\r\n        initialValue: 'none',\r\n        type: PropertyDescriptorParsingType.LIST,\r\n        prefix: false,\r\n        parse: function (tokens) {\r\n            if (tokens.length === 1 && isIdentWithValue(tokens[0], 'none')) {\r\n                return [];\r\n            }\r\n            return parseFunctionArgs(tokens).map(function (values) {\r\n                var shadow = {\r\n                    color: 0x000000ff,\r\n                    offsetX: ZERO_LENGTH,\r\n                    offsetY: ZERO_LENGTH,\r\n                    blur: ZERO_LENGTH,\r\n                    spread: ZERO_LENGTH,\r\n                    inset: false\r\n                };\r\n                var c = 0;\r\n                for (var i = 0; i < values.length; i++) {\r\n                    var token = values[i];\r\n                    if (isIdentWithValue(token, 'inset')) {\r\n                        shadow.inset = true;\r\n                    }\r\n                    else if (isLength(token)) {\r\n                        if (c === 0) {\r\n                            shadow.offsetX = token;\r\n                        }\r\n                        else if (c === 1) {\r\n                            shadow.offsetY = token;\r\n                        }\r\n                        else if (c === 2) {\r\n                            shadow.blur = token;\r\n                        }\r\n                        else {\r\n                            shadow.spread = token;\r\n                        }\r\n                        c++;\r\n                    }\r\n                    else {\r\n                        shadow.color = color.parse(token);\r\n                    }\r\n                }\r\n                return shadow;\r\n            });\r\n        }\r\n    };\r\n\r\n    var CSSParsedDeclaration = /** @class */ (function () {\r\n        function CSSParsedDeclaration(declaration) {\r\n            this.backgroundClip = parse(backgroundClip, declaration.backgroundClip);\r\n            this.backgroundColor = parse(backgroundColor, declaration.backgroundColor);\r\n            this.backgroundImage = parse(backgroundImage, declaration.backgroundImage);\r\n            this.backgroundOrigin = parse(backgroundOrigin, declaration.backgroundOrigin);\r\n            this.backgroundPosition = parse(backgroundPosition, declaration.backgroundPosition);\r\n            this.backgroundRepeat = parse(backgroundRepeat, declaration.backgroundRepeat);\r\n            this.backgroundSize = parse(backgroundSize, declaration.backgroundSize);\r\n            this.borderTopColor = parse(borderTopColor, declaration.borderTopColor);\r\n            this.borderRightColor = parse(borderRightColor, declaration.borderRightColor);\r\n            this.borderBottomColor = parse(borderBottomColor, declaration.borderBottomColor);\r\n            this.borderLeftColor = parse(borderLeftColor, declaration.borderLeftColor);\r\n            this.borderTopLeftRadius = parse(borderTopLeftRadius, declaration.borderTopLeftRadius);\r\n            this.borderTopRightRadius = parse(borderTopRightRadius, declaration.borderTopRightRadius);\r\n            this.borderBottomRightRadius = parse(borderBottomRightRadius, declaration.borderBottomRightRadius);\r\n            this.borderBottomLeftRadius = parse(borderBottomLeftRadius, declaration.borderBottomLeftRadius);\r\n            this.borderTopStyle = parse(borderTopStyle, declaration.borderTopStyle);\r\n            this.borderRightStyle = parse(borderRightStyle, declaration.borderRightStyle);\r\n            this.borderBottomStyle = parse(borderBottomStyle, declaration.borderBottomStyle);\r\n            this.borderLeftStyle = parse(borderLeftStyle, declaration.borderLeftStyle);\r\n            this.borderTopWidth = parse(borderTopWidth, declaration.borderTopWidth);\r\n            this.borderRightWidth = parse(borderRightWidth, declaration.borderRightWidth);\r\n            this.borderBottomWidth = parse(borderBottomWidth, declaration.borderBottomWidth);\r\n            this.borderLeftWidth = parse(borderLeftWidth, declaration.borderLeftWidth);\r\n            this.boxShadow = parse(boxShadow, declaration.boxShadow);\r\n            this.color = parse(color$1, declaration.color);\r\n            this.display = parse(display, declaration.display);\r\n            this.float = parse(float, declaration.cssFloat);\r\n            this.fontFamily = parse(fontFamily, declaration.fontFamily);\r\n            this.fontSize = parse(fontSize, declaration.fontSize);\r\n            this.fontStyle = parse(fontStyle, declaration.fontStyle);\r\n            this.fontVariant = parse(fontVariant, declaration.fontVariant);\r\n            this.fontWeight = parse(fontWeight, declaration.fontWeight);\r\n            this.letterSpacing = parse(letterSpacing, declaration.letterSpacing);\r\n            this.lineBreak = parse(lineBreak, declaration.lineBreak);\r\n            this.lineHeight = parse(lineHeight, declaration.lineHeight);\r\n            this.listStyleImage = parse(listStyleImage, declaration.listStyleImage);\r\n            this.listStylePosition = parse(listStylePosition, declaration.listStylePosition);\r\n            this.listStyleType = parse(listStyleType, declaration.listStyleType);\r\n            this.marginTop = parse(marginTop, declaration.marginTop);\r\n            this.marginRight = parse(marginRight, declaration.marginRight);\r\n            this.marginBottom = parse(marginBottom, declaration.marginBottom);\r\n            this.marginLeft = parse(marginLeft, declaration.marginLeft);\r\n            this.opacity = parse(opacity, declaration.opacity);\r\n            var overflowTuple = parse(overflow, declaration.overflow);\r\n            this.overflowX = overflowTuple[0];\r\n            this.overflowY = overflowTuple[overflowTuple.length > 1 ? 1 : 0];\r\n            this.overflowWrap = parse(overflowWrap, declaration.overflowWrap);\r\n            this.paddingTop = parse(paddingTop, declaration.paddingTop);\r\n            this.paddingRight = parse(paddingRight, declaration.paddingRight);\r\n            this.paddingBottom = parse(paddingBottom, declaration.paddingBottom);\r\n            this.paddingLeft = parse(paddingLeft, declaration.paddingLeft);\r\n            this.position = parse(position, declaration.position);\r\n            this.textAlign = parse(textAlign, declaration.textAlign);\r\n            this.textDecorationColor = parse(textDecorationColor, declaration.textDecorationColor || declaration.color);\r\n            this.textDecorationLine = parse(textDecorationLine, declaration.textDecorationLine);\r\n            this.textShadow = parse(textShadow, declaration.textShadow);\r\n            this.textTransform = parse(textTransform, declaration.textTransform);\r\n            this.transform = parse(transform, declaration.transform);\r\n            this.transformOrigin = parse(transformOrigin, declaration.transformOrigin);\r\n            this.visibility = parse(visibility, declaration.visibility);\r\n            this.wordBreak = parse(wordBreak, declaration.wordBreak);\r\n            this.zIndex = parse(zIndex, declaration.zIndex);\r\n        }\r\n        CSSParsedDeclaration.prototype.isVisible = function () {\r\n            return this.display > 0 && this.opacity > 0 && this.visibility === VISIBILITY.VISIBLE;\r\n        };\r\n        CSSParsedDeclaration.prototype.isTransparent = function () {\r\n            return isTransparent(this.backgroundColor);\r\n        };\r\n        CSSParsedDeclaration.prototype.isTransformed = function () {\r\n            return this.transform !== null;\r\n        };\r\n        CSSParsedDeclaration.prototype.isPositioned = function () {\r\n            return this.position !== POSITION.STATIC;\r\n        };\r\n        CSSParsedDeclaration.prototype.isPositionedWithZIndex = function () {\r\n            return this.isPositioned() && !this.zIndex.auto;\r\n        };\r\n        CSSParsedDeclaration.prototype.isFloating = function () {\r\n            return this.float !== FLOAT.NONE;\r\n        };\r\n        CSSParsedDeclaration.prototype.isInlineLevel = function () {\r\n            return (contains(this.display, 4 /* INLINE */) ||\r\n                contains(this.display, 33554432 /* INLINE_BLOCK */) ||\r\n                contains(this.display, 268435456 /* INLINE_FLEX */) ||\r\n                contains(this.display, 536870912 /* INLINE_GRID */) ||\r\n                contains(this.display, 67108864 /* INLINE_LIST_ITEM */) ||\r\n                contains(this.display, 134217728 /* INLINE_TABLE */));\r\n        };\r\n        return CSSParsedDeclaration;\r\n    }());\r\n    var CSSParsedPseudoDeclaration = /** @class */ (function () {\r\n        function CSSParsedPseudoDeclaration(declaration) {\r\n            this.content = parse(content, declaration.content);\r\n            this.quotes = parse(quotes, declaration.quotes);\r\n        }\r\n        return CSSParsedPseudoDeclaration;\r\n    }());\r\n    var CSSParsedCounterDeclaration = /** @class */ (function () {\r\n        function CSSParsedCounterDeclaration(declaration) {\r\n            this.counterIncrement = parse(counterIncrement, declaration.counterIncrement);\r\n            this.counterReset = parse(counterReset, declaration.counterReset);\r\n        }\r\n        return CSSParsedCounterDeclaration;\r\n    }());\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    var parse = function (descriptor, style) {\r\n        var tokenizer = new Tokenizer();\r\n        var value = style !== null && typeof style !== 'undefined' ? style.toString() : descriptor.initialValue;\r\n        tokenizer.write(value);\r\n        var parser = new Parser(tokenizer.read());\r\n        switch (descriptor.type) {\r\n            case PropertyDescriptorParsingType.IDENT_VALUE:\r\n                var token = parser.parseComponentValue();\r\n                return descriptor.parse(isIdentToken(token) ? token.value : descriptor.initialValue);\r\n            case PropertyDescriptorParsingType.VALUE:\r\n                return descriptor.parse(parser.parseComponentValue());\r\n            case PropertyDescriptorParsingType.LIST:\r\n                return descriptor.parse(parser.parseComponentValues());\r\n            case PropertyDescriptorParsingType.TOKEN_VALUE:\r\n                return parser.parseComponentValue();\r\n            case PropertyDescriptorParsingType.TYPE_VALUE:\r\n                switch (descriptor.format) {\r\n                    case 'angle':\r\n                        return angle.parse(parser.parseComponentValue());\r\n                    case 'color':\r\n                        return color.parse(parser.parseComponentValue());\r\n                    case 'image':\r\n                        return image.parse(parser.parseComponentValue());\r\n                    case 'length':\r\n                        var length_1 = parser.parseComponentValue();\r\n                        return isLength(length_1) ? length_1 : ZERO_LENGTH;\r\n                    case 'length-percentage':\r\n                        var value_1 = parser.parseComponentValue();\r\n                        return isLengthPercentage(value_1) ? value_1 : ZERO_LENGTH;\r\n                }\r\n        }\r\n        throw new Error(\"Attempting to parse unsupported css format type \" + descriptor.format);\r\n    };\r\n\r\n    var ElementContainer = /** @class */ (function () {\r\n        function ElementContainer(element) {\r\n            this.styles = new CSSParsedDeclaration(window.getComputedStyle(element, null));\r\n            this.textNodes = [];\r\n            this.elements = [];\r\n            if (this.styles.transform !== null && isHTMLElementNode(element)) {\r\n                // getBoundingClientRect takes transforms into account\r\n                element.style.transform = 'none';\r\n            }\r\n            this.bounds = parseBounds(element);\r\n            this.flags = 0;\r\n        }\r\n        return ElementContainer;\r\n    }());\r\n\r\n    var TextBounds = /** @class */ (function () {\r\n        function TextBounds(text, bounds) {\r\n            this.text = text;\r\n            this.bounds = bounds;\r\n        }\r\n        return TextBounds;\r\n    }());\r\n    var parseTextBounds = function (value, styles, node) {\r\n        var textList = breakText(value, styles);\r\n        var textBounds = [];\r\n        var offset = 0;\r\n        textList.forEach(function (text) {\r\n            if (styles.textDecorationLine.length || text.trim().length > 0) {\r\n                if (FEATURES.SUPPORT_RANGE_BOUNDS) {\r\n                    textBounds.push(new TextBounds(text, getRangeBounds(node, offset, text.length)));\r\n                }\r\n                else {\r\n                    var replacementNode = node.splitText(text.length);\r\n                    textBounds.push(new TextBounds(text, getWrapperBounds(node)));\r\n                    node = replacementNode;\r\n                }\r\n            }\r\n            else if (!FEATURES.SUPPORT_RANGE_BOUNDS) {\r\n                node = node.splitText(text.length);\r\n            }\r\n            offset += text.length;\r\n        });\r\n        return textBounds;\r\n    };\r\n    var getWrapperBounds = function (node) {\r\n        var ownerDocument = node.ownerDocument;\r\n        if (ownerDocument) {\r\n            var wrapper = ownerDocument.createElement('html2canvaswrapper');\r\n            wrapper.appendChild(node.cloneNode(true));\r\n            var parentNode = node.parentNode;\r\n            if (parentNode) {\r\n                parentNode.replaceChild(wrapper, node);\r\n                var bounds = parseBounds(wrapper);\r\n                if (wrapper.firstChild) {\r\n                    parentNode.replaceChild(wrapper.firstChild, wrapper);\r\n                }\r\n                return bounds;\r\n            }\r\n        }\r\n        return new Bounds(0, 0, 0, 0);\r\n    };\r\n    var getRangeBounds = function (node, offset, length) {\r\n        var ownerDocument = node.ownerDocument;\r\n        if (!ownerDocument) {\r\n            throw new Error('Node has no owner document');\r\n        }\r\n        var range = ownerDocument.createRange();\r\n        range.setStart(node, offset);\r\n        range.setEnd(node, offset + length);\r\n        return Bounds.fromClientRect(range.getBoundingClientRect());\r\n    };\r\n    var breakText = function (value, styles) {\r\n        return styles.letterSpacing !== 0 ? toCodePoints(value).map(function (i) { return fromCodePoint(i); }) : breakWords(value, styles);\r\n    };\r\n    var breakWords = function (str, styles) {\r\n        var breaker = LineBreaker(str, {\r\n            lineBreak: styles.lineBreak,\r\n            wordBreak: styles.overflowWrap === OVERFLOW_WRAP.BREAK_WORD ? 'break-word' : styles.wordBreak\r\n        });\r\n        var words = [];\r\n        var bk;\r\n        while (!(bk = breaker.next()).done) {\r\n            if (bk.value) {\r\n                words.push(bk.value.slice());\r\n            }\r\n        }\r\n        return words;\r\n    };\r\n\r\n    var TextContainer = /** @class */ (function () {\r\n        function TextContainer(node, styles) {\r\n            this.text = transform$1(node.data, styles.textTransform);\r\n            this.textBounds = parseTextBounds(this.text, styles, node);\r\n        }\r\n        return TextContainer;\r\n    }());\r\n    var transform$1 = function (text, transform) {\r\n        switch (transform) {\r\n            case TEXT_TRANSFORM.LOWERCASE:\r\n                return text.toLowerCase();\r\n            case TEXT_TRANSFORM.CAPITALIZE:\r\n                return text.replace(CAPITALIZE, capitalize);\r\n            case TEXT_TRANSFORM.UPPERCASE:\r\n                return text.toUpperCase();\r\n            default:\r\n                return text;\r\n        }\r\n    };\r\n    var CAPITALIZE = /(^|\\s|:|-|\\(|\\))([a-z])/g;\r\n    var capitalize = function (m, p1, p2) {\r\n        if (m.length > 0) {\r\n            return p1 + p2.toUpperCase();\r\n        }\r\n        return m;\r\n    };\r\n\r\n    var ImageElementContainer = /** @class */ (function (_super) {\r\n        __extends(ImageElementContainer, _super);\r\n        function ImageElementContainer(img) {\r\n            var _this = _super.call(this, img) || this;\r\n            _this.src = img.currentSrc || img.src;\r\n            _this.intrinsicWidth = img.naturalWidth;\r\n            _this.intrinsicHeight = img.naturalHeight;\r\n            CacheStorage.getInstance().addImage(_this.src);\r\n            return _this;\r\n        }\r\n        return ImageElementContainer;\r\n    }(ElementContainer));\r\n\r\n    var CanvasElementContainer = /** @class */ (function (_super) {\r\n        __extends(CanvasElementContainer, _super);\r\n        function CanvasElementContainer(canvas) {\r\n            var _this = _super.call(this, canvas) || this;\r\n            _this.canvas = canvas;\r\n            _this.intrinsicWidth = canvas.width;\r\n            _this.intrinsicHeight = canvas.height;\r\n            return _this;\r\n        }\r\n        return CanvasElementContainer;\r\n    }(ElementContainer));\r\n\r\n    var SVGElementContainer = /** @class */ (function (_super) {\r\n        __extends(SVGElementContainer, _super);\r\n        function SVGElementContainer(img) {\r\n            var _this = _super.call(this, img) || this;\r\n            var s = new XMLSerializer();\r\n            _this.svg = \"data:image/svg+xml,\" + encodeURIComponent(s.serializeToString(img));\r\n            _this.intrinsicWidth = img.width.baseVal.value;\r\n            _this.intrinsicHeight = img.height.baseVal.value;\r\n            CacheStorage.getInstance().addImage(_this.svg);\r\n            return _this;\r\n        }\r\n        return SVGElementContainer;\r\n    }(ElementContainer));\r\n\r\n    var LIElementContainer = /** @class */ (function (_super) {\r\n        __extends(LIElementContainer, _super);\r\n        function LIElementContainer(element) {\r\n            var _this = _super.call(this, element) || this;\r\n            _this.value = element.value;\r\n            return _this;\r\n        }\r\n        return LIElementContainer;\r\n    }(ElementContainer));\r\n\r\n    var OLElementContainer = /** @class */ (function (_super) {\r\n        __extends(OLElementContainer, _super);\r\n        function OLElementContainer(element) {\r\n            var _this = _super.call(this, element) || this;\r\n            _this.start = element.start;\r\n            _this.reversed = typeof element.reversed === 'boolean' && element.reversed === true;\r\n            return _this;\r\n        }\r\n        return OLElementContainer;\r\n    }(ElementContainer));\r\n\r\n    var CHECKBOX_BORDER_RADIUS = [\r\n        {\r\n            type: TokenType.DIMENSION_TOKEN,\r\n            flags: 0,\r\n            unit: 'px',\r\n            number: 3\r\n        }\r\n    ];\r\n    var RADIO_BORDER_RADIUS = [\r\n        {\r\n            type: TokenType.PERCENTAGE_TOKEN,\r\n            flags: 0,\r\n            number: 50\r\n        }\r\n    ];\r\n    var reformatInputBounds = function (bounds) {\r\n        if (bounds.width > bounds.height) {\r\n            return new Bounds(bounds.left + (bounds.width - bounds.height) / 2, bounds.top, bounds.height, bounds.height);\r\n        }\r\n        else if (bounds.width < bounds.height) {\r\n            return new Bounds(bounds.left, bounds.top + (bounds.height - bounds.width) / 2, bounds.width, bounds.width);\r\n        }\r\n        return bounds;\r\n    };\r\n    var getInputValue = function (node) {\r\n        var value = node.type === PASSWORD ? new Array(node.value.length + 1).join('\\u2022') : node.value;\r\n        return value.length === 0 ? node.placeholder || '' : value;\r\n    };\r\n    var CHECKBOX = 'checkbox';\r\n    var RADIO = 'radio';\r\n    var PASSWORD = 'password';\r\n    var INPUT_COLOR = 0x2a2a2aff;\r\n    var InputElementContainer = /** @class */ (function (_super) {\r\n        __extends(InputElementContainer, _super);\r\n        function InputElementContainer(input) {\r\n            var _this = _super.call(this, input) || this;\r\n            _this.type = input.type.toLowerCase();\r\n            _this.checked = input.checked;\r\n            _this.value = getInputValue(input);\r\n            if (_this.type === CHECKBOX || _this.type === RADIO) {\r\n                _this.styles.backgroundColor = 0xdededeff;\r\n                _this.styles.borderTopColor = _this.styles.borderRightColor = _this.styles.borderBottomColor = _this.styles.borderLeftColor = 0xa5a5a5ff;\r\n                _this.styles.borderTopWidth = _this.styles.borderRightWidth = _this.styles.borderBottomWidth = _this.styles.borderLeftWidth = 1;\r\n                _this.styles.borderTopStyle = _this.styles.borderRightStyle = _this.styles.borderBottomStyle = _this.styles.borderLeftStyle =\r\n                    BORDER_STYLE.SOLID;\r\n                _this.styles.backgroundClip = [BACKGROUND_CLIP.BORDER_BOX];\r\n                _this.styles.backgroundOrigin = [0 /* BORDER_BOX */];\r\n                _this.bounds = reformatInputBounds(_this.bounds);\r\n            }\r\n            switch (_this.type) {\r\n                case CHECKBOX:\r\n                    _this.styles.borderTopRightRadius = _this.styles.borderTopLeftRadius = _this.styles.borderBottomRightRadius = _this.styles.borderBottomLeftRadius = CHECKBOX_BORDER_RADIUS;\r\n                    break;\r\n                case RADIO:\r\n                    _this.styles.borderTopRightRadius = _this.styles.borderTopLeftRadius = _this.styles.borderBottomRightRadius = _this.styles.borderBottomLeftRadius = RADIO_BORDER_RADIUS;\r\n                    break;\r\n            }\r\n            return _this;\r\n        }\r\n        return InputElementContainer;\r\n    }(ElementContainer));\r\n\r\n    var SelectElementContainer = /** @class */ (function (_super) {\r\n        __extends(SelectElementContainer, _super);\r\n        function SelectElementContainer(element) {\r\n            var _this = _super.call(this, element) || this;\r\n            var option = element.options[element.selectedIndex || 0];\r\n            _this.value = option ? option.text || '' : '';\r\n            return _this;\r\n        }\r\n        return SelectElementContainer;\r\n    }(ElementContainer));\r\n\r\n    var TextareaElementContainer = /** @class */ (function (_super) {\r\n        __extends(TextareaElementContainer, _super);\r\n        function TextareaElementContainer(element) {\r\n            var _this = _super.call(this, element) || this;\r\n            _this.value = element.value;\r\n            return _this;\r\n        }\r\n        return TextareaElementContainer;\r\n    }(ElementContainer));\r\n\r\n    var parseColor = function (value) { return color.parse(Parser.create(value).parseComponentValue()); };\r\n    var IFrameElementContainer = /** @class */ (function (_super) {\r\n        __extends(IFrameElementContainer, _super);\r\n        function IFrameElementContainer(iframe) {\r\n            var _this = _super.call(this, iframe) || this;\r\n            _this.src = iframe.src;\r\n            _this.width = parseInt(iframe.width, 10) || 0;\r\n            _this.height = parseInt(iframe.height, 10) || 0;\r\n            _this.backgroundColor = _this.styles.backgroundColor;\r\n            try {\r\n                if (iframe.contentWindow &&\r\n                    iframe.contentWindow.document &&\r\n                    iframe.contentWindow.document.documentElement) {\r\n                    _this.tree = parseTree(iframe.contentWindow.document.documentElement);\r\n                    // http://www.w3.org/TR/css3-background/#special-backgrounds\r\n                    var documentBackgroundColor = iframe.contentWindow.document.documentElement\r\n                        ? parseColor(getComputedStyle(iframe.contentWindow.document.documentElement)\r\n                            .backgroundColor)\r\n                        : COLORS.TRANSPARENT;\r\n                    var bodyBackgroundColor = iframe.contentWindow.document.body\r\n                        ? parseColor(getComputedStyle(iframe.contentWindow.document.body).backgroundColor)\r\n                        : COLORS.TRANSPARENT;\r\n                    _this.backgroundColor = isTransparent(documentBackgroundColor)\r\n                        ? isTransparent(bodyBackgroundColor)\r\n                            ? _this.styles.backgroundColor\r\n                            : bodyBackgroundColor\r\n                        : documentBackgroundColor;\r\n                }\r\n            }\r\n            catch (e) { }\r\n            return _this;\r\n        }\r\n        return IFrameElementContainer;\r\n    }(ElementContainer));\r\n\r\n    var LIST_OWNERS = ['OL', 'UL', 'MENU'];\r\n    var parseNodeTree = function (node, parent, root) {\r\n        for (var childNode = node.firstChild, nextNode = void 0; childNode; childNode = nextNode) {\r\n            nextNode = childNode.nextSibling;\r\n            if (isTextNode(childNode) && childNode.data.trim().length > 0) {\r\n                parent.textNodes.push(new TextContainer(childNode, parent.styles));\r\n            }\r\n            else if (isElementNode(childNode)) {\r\n                var container = createContainer(childNode);\r\n                if (container.styles.isVisible()) {\r\n                    if (createsRealStackingContext(childNode, container, root)) {\r\n                        container.flags |= 4 /* CREATES_REAL_STACKING_CONTEXT */;\r\n                    }\r\n                    else if (createsStackingContext(container.styles)) {\r\n                        container.flags |= 2 /* CREATES_STACKING_CONTEXT */;\r\n                    }\r\n                    if (LIST_OWNERS.indexOf(childNode.tagName) !== -1) {\r\n                        container.flags |= 8 /* IS_LIST_OWNER */;\r\n                    }\r\n                    parent.elements.push(container);\r\n                    if (!isTextareaElement(childNode) && !isSVGElement(childNode) && !isSelectElement(childNode)) {\r\n                        parseNodeTree(childNode, container, root);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    var createContainer = function (element) {\r\n        if (isImageElement(element)) {\r\n            return new ImageElementContainer(element);\r\n        }\r\n        if (isCanvasElement(element)) {\r\n            return new CanvasElementContainer(element);\r\n        }\r\n        if (isSVGElement(element)) {\r\n            return new SVGElementContainer(element);\r\n        }\r\n        if (isLIElement(element)) {\r\n            return new LIElementContainer(element);\r\n        }\r\n        if (isOLElement(element)) {\r\n            return new OLElementContainer(element);\r\n        }\r\n        if (isInputElement(element)) {\r\n            return new InputElementContainer(element);\r\n        }\r\n        if (isSelectElement(element)) {\r\n            return new SelectElementContainer(element);\r\n        }\r\n        if (isTextareaElement(element)) {\r\n            return new TextareaElementContainer(element);\r\n        }\r\n        if (isIFrameElement(element)) {\r\n            return new IFrameElementContainer(element);\r\n        }\r\n        return new ElementContainer(element);\r\n    };\r\n    var parseTree = function (element) {\r\n        var container = createContainer(element);\r\n        container.flags |= 4 /* CREATES_REAL_STACKING_CONTEXT */;\r\n        parseNodeTree(element, container, container);\r\n        return container;\r\n    };\r\n    var createsRealStackingContext = function (node, container, root) {\r\n        return (container.styles.isPositionedWithZIndex() ||\r\n            container.styles.opacity < 1 ||\r\n            container.styles.isTransformed() ||\r\n            (isBodyElement(node) && root.styles.isTransparent()));\r\n    };\r\n    var createsStackingContext = function (styles) { return styles.isPositioned() || styles.isFloating(); };\r\n    var isTextNode = function (node) { return node.nodeType === Node.TEXT_NODE; };\r\n    var isElementNode = function (node) { return node.nodeType === Node.ELEMENT_NODE; };\r\n    var isHTMLElementNode = function (node) {\r\n        return typeof node.style !== 'undefined';\r\n    };\r\n    var isLIElement = function (node) { return node.tagName === 'LI'; };\r\n    var isOLElement = function (node) { return node.tagName === 'OL'; };\r\n    var isInputElement = function (node) { return node.tagName === 'INPUT'; };\r\n    var isHTMLElement = function (node) { return node.tagName === 'HTML'; };\r\n    var isSVGElement = function (node) { return node.tagName === 'svg'; };\r\n    var isBodyElement = function (node) { return node.tagName === 'BODY'; };\r\n    var isCanvasElement = function (node) { return node.tagName === 'CANVAS'; };\r\n    var isImageElement = function (node) { return node.tagName === 'IMG'; };\r\n    var isIFrameElement = function (node) { return node.tagName === 'IFRAME'; };\r\n    var isStyleElement = function (node) { return node.tagName === 'STYLE'; };\r\n    var isScriptElement = function (node) { return node.tagName === 'SCRIPT'; };\r\n    var isTextareaElement = function (node) { return node.tagName === 'TEXTAREA'; };\r\n    var isSelectElement = function (node) { return node.tagName === 'SELECT'; };\r\n\r\n    var CounterState = /** @class */ (function () {\r\n        function CounterState() {\r\n            this.counters = {};\r\n        }\r\n        CounterState.prototype.getCounterValue = function (name) {\r\n            var counter = this.counters[name];\r\n            if (counter && counter.length) {\r\n                return counter[counter.length - 1];\r\n            }\r\n            return 1;\r\n        };\r\n        CounterState.prototype.getCounterValues = function (name) {\r\n            var counter = this.counters[name];\r\n            return counter ? counter : [];\r\n        };\r\n        CounterState.prototype.pop = function (counters) {\r\n            var _this = this;\r\n            counters.forEach(function (counter) { return _this.counters[counter].pop(); });\r\n        };\r\n        CounterState.prototype.parse = function (style) {\r\n            var _this = this;\r\n            var counterIncrement = style.counterIncrement;\r\n            var counterReset = style.counterReset;\r\n            var canReset = true;\r\n            if (counterIncrement !== null) {\r\n                counterIncrement.forEach(function (entry) {\r\n                    var counter = _this.counters[entry.counter];\r\n                    if (counter && entry.increment !== 0) {\r\n                        canReset = false;\r\n                        counter[Math.max(0, counter.length - 1)] += entry.increment;\r\n                    }\r\n                });\r\n            }\r\n            var counterNames = [];\r\n            if (canReset) {\r\n                counterReset.forEach(function (entry) {\r\n                    var counter = _this.counters[entry.counter];\r\n                    counterNames.push(entry.counter);\r\n                    if (!counter) {\r\n                        counter = _this.counters[entry.counter] = [];\r\n                    }\r\n                    counter.push(entry.reset);\r\n                });\r\n            }\r\n            return counterNames;\r\n        };\r\n        return CounterState;\r\n    }());\r\n    var ROMAN_UPPER = {\r\n        integers: [1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1],\r\n        values: ['M', 'CM', 'D', 'CD', 'C', 'XC', 'L', 'XL', 'X', 'IX', 'V', 'IV', 'I']\r\n    };\r\n    var ARMENIAN = {\r\n        integers: [\r\n            9000,\r\n            8000,\r\n            7000,\r\n            6000,\r\n            5000,\r\n            4000,\r\n            3000,\r\n            2000,\r\n            1000,\r\n            900,\r\n            800,\r\n            700,\r\n            600,\r\n            500,\r\n            400,\r\n            300,\r\n            200,\r\n            100,\r\n            90,\r\n            80,\r\n            70,\r\n            60,\r\n            50,\r\n            40,\r\n            30,\r\n            20,\r\n            10,\r\n            9,\r\n            8,\r\n            7,\r\n            6,\r\n            5,\r\n            4,\r\n            3,\r\n            2,\r\n            1\r\n        ],\r\n        values: [\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            ''\r\n        ]\r\n    };\r\n    var HEBREW = {\r\n        integers: [\r\n            10000,\r\n            9000,\r\n            8000,\r\n            7000,\r\n            6000,\r\n            5000,\r\n            4000,\r\n            3000,\r\n            2000,\r\n            1000,\r\n            400,\r\n            300,\r\n            200,\r\n            100,\r\n            90,\r\n            80,\r\n            70,\r\n            60,\r\n            50,\r\n            40,\r\n            30,\r\n            20,\r\n            19,\r\n            18,\r\n            17,\r\n            16,\r\n            15,\r\n            10,\r\n            9,\r\n            8,\r\n            7,\r\n            6,\r\n            5,\r\n            4,\r\n            3,\r\n            2,\r\n            1\r\n        ],\r\n        values: [\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            ''\r\n        ]\r\n    };\r\n    var GEORGIAN = {\r\n        integers: [\r\n            10000,\r\n            9000,\r\n            8000,\r\n            7000,\r\n            6000,\r\n            5000,\r\n            4000,\r\n            3000,\r\n            2000,\r\n            1000,\r\n            900,\r\n            800,\r\n            700,\r\n            600,\r\n            500,\r\n            400,\r\n            300,\r\n            200,\r\n            100,\r\n            90,\r\n            80,\r\n            70,\r\n            60,\r\n            50,\r\n            40,\r\n            30,\r\n            20,\r\n            10,\r\n            9,\r\n            8,\r\n            7,\r\n            6,\r\n            5,\r\n            4,\r\n            3,\r\n            2,\r\n            1\r\n        ],\r\n        values: [\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            '',\r\n            ''\r\n        ]\r\n    };\r\n    var createAdditiveCounter = function (value, min, max, symbols, fallback, suffix) {\r\n        if (value < min || value > max) {\r\n            return createCounterText(value, fallback, suffix.length > 0);\r\n        }\r\n        return (symbols.integers.reduce(function (string, integer, index) {\r\n            while (value >= integer) {\r\n                value -= integer;\r\n                string += symbols.values[index];\r\n            }\r\n            return string;\r\n        }, '') + suffix);\r\n    };\r\n    var createCounterStyleWithSymbolResolver = function (value, codePointRangeLength, isNumeric, resolver) {\r\n        var string = '';\r\n        do {\r\n            if (!isNumeric) {\r\n                value--;\r\n            }\r\n            string = resolver(value) + string;\r\n            value /= codePointRangeLength;\r\n        } while (value * codePointRangeLength >= codePointRangeLength);\r\n        return string;\r\n    };\r\n    var createCounterStyleFromRange = function (value, codePointRangeStart, codePointRangeEnd, isNumeric, suffix) {\r\n        var codePointRangeLength = codePointRangeEnd - codePointRangeStart + 1;\r\n        return ((value < 0 ? '-' : '') +\r\n            (createCounterStyleWithSymbolResolver(Math.abs(value), codePointRangeLength, isNumeric, function (codePoint) {\r\n                return fromCodePoint(Math.floor(codePoint % codePointRangeLength) + codePointRangeStart);\r\n            }) +\r\n                suffix));\r\n    };\r\n    var createCounterStyleFromSymbols = function (value, symbols, suffix) {\r\n        if (suffix === void 0) { suffix = '. '; }\r\n        var codePointRangeLength = symbols.length;\r\n        return (createCounterStyleWithSymbolResolver(Math.abs(value), codePointRangeLength, false, function (codePoint) { return symbols[Math.floor(codePoint % codePointRangeLength)]; }) + suffix);\r\n    };\r\n    var CJK_ZEROS = 1 << 0;\r\n    var CJK_TEN_COEFFICIENTS = 1 << 1;\r\n    var CJK_TEN_HIGH_COEFFICIENTS = 1 << 2;\r\n    var CJK_HUNDRED_COEFFICIENTS = 1 << 3;\r\n    var createCJKCounter = function (value, numbers, multipliers, negativeSign, suffix, flags) {\r\n        if (value < -9999 || value > 9999) {\r\n            return createCounterText(value, LIST_STYLE_TYPE.CJK_DECIMAL, suffix.length > 0);\r\n        }\r\n        var tmp = Math.abs(value);\r\n        var string = suffix;\r\n        if (tmp === 0) {\r\n            return numbers[0] + string;\r\n        }\r\n        for (var digit = 0; tmp > 0 && digit <= 4; digit++) {\r\n            var coefficient = tmp % 10;\r\n            if (coefficient === 0 && contains(flags, CJK_ZEROS) && string !== '') {\r\n                string = numbers[coefficient] + string;\r\n            }\r\n            else if (coefficient > 1 ||\r\n                (coefficient === 1 && digit === 0) ||\r\n                (coefficient === 1 && digit === 1 && contains(flags, CJK_TEN_COEFFICIENTS)) ||\r\n                (coefficient === 1 && digit === 1 && contains(flags, CJK_TEN_HIGH_COEFFICIENTS) && value > 100) ||\r\n                (coefficient === 1 && digit > 1 && contains(flags, CJK_HUNDRED_COEFFICIENTS))) {\r\n                string = numbers[coefficient] + (digit > 0 ? multipliers[digit - 1] : '') + string;\r\n            }\r\n            else if (coefficient === 1 && digit > 0) {\r\n                string = multipliers[digit - 1] + string;\r\n            }\r\n            tmp = Math.floor(tmp / 10);\r\n        }\r\n        return (value < 0 ? negativeSign : '') + string;\r\n    };\r\n    var CHINESE_INFORMAL_MULTIPLIERS = '';\r\n    var CHINESE_FORMAL_MULTIPLIERS = '';\r\n    var JAPANESE_NEGATIVE = '';\r\n    var KOREAN_NEGATIVE = '';\r\n    var createCounterText = function (value, type, appendSuffix) {\r\n        var defaultSuffix = appendSuffix ? '. ' : '';\r\n        var cjkSuffix = appendSuffix ? '' : '';\r\n        var koreanSuffix = appendSuffix ? ', ' : '';\r\n        var spaceSuffix = appendSuffix ? ' ' : '';\r\n        switch (type) {\r\n            case LIST_STYLE_TYPE.DISC:\r\n                return '' + spaceSuffix;\r\n            case LIST_STYLE_TYPE.CIRCLE:\r\n                return '' + spaceSuffix;\r\n            case LIST_STYLE_TYPE.SQUARE:\r\n                return '' + spaceSuffix;\r\n            case LIST_STYLE_TYPE.DECIMAL_LEADING_ZERO:\r\n                var string = createCounterStyleFromRange(value, 48, 57, true, defaultSuffix);\r\n                return string.length < 4 ? \"0\" + string : string;\r\n            case LIST_STYLE_TYPE.CJK_DECIMAL:\r\n                return createCounterStyleFromSymbols(value, '', cjkSuffix);\r\n            case LIST_STYLE_TYPE.LOWER_ROMAN:\r\n                return createAdditiveCounter(value, 1, 3999, ROMAN_UPPER, LIST_STYLE_TYPE.DECIMAL, defaultSuffix).toLowerCase();\r\n            case LIST_STYLE_TYPE.UPPER_ROMAN:\r\n                return createAdditiveCounter(value, 1, 3999, ROMAN_UPPER, LIST_STYLE_TYPE.DECIMAL, defaultSuffix);\r\n            case LIST_STYLE_TYPE.LOWER_GREEK:\r\n                return createCounterStyleFromRange(value, 945, 969, false, defaultSuffix);\r\n            case LIST_STYLE_TYPE.LOWER_ALPHA:\r\n                return createCounterStyleFromRange(value, 97, 122, false, defaultSuffix);\r\n            case LIST_STYLE_TYPE.UPPER_ALPHA:\r\n                return createCounterStyleFromRange(value, 65, 90, false, defaultSuffix);\r\n            case LIST_STYLE_TYPE.ARABIC_INDIC:\r\n                return createCounterStyleFromRange(value, 1632, 1641, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.ARMENIAN:\r\n            case LIST_STYLE_TYPE.UPPER_ARMENIAN:\r\n                return createAdditiveCounter(value, 1, 9999, ARMENIAN, LIST_STYLE_TYPE.DECIMAL, defaultSuffix);\r\n            case LIST_STYLE_TYPE.LOWER_ARMENIAN:\r\n                return createAdditiveCounter(value, 1, 9999, ARMENIAN, LIST_STYLE_TYPE.DECIMAL, defaultSuffix).toLowerCase();\r\n            case LIST_STYLE_TYPE.BENGALI:\r\n                return createCounterStyleFromRange(value, 2534, 2543, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.CAMBODIAN:\r\n            case LIST_STYLE_TYPE.KHMER:\r\n                return createCounterStyleFromRange(value, 6112, 6121, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.CJK_EARTHLY_BRANCH:\r\n                return createCounterStyleFromSymbols(value, '', cjkSuffix);\r\n            case LIST_STYLE_TYPE.CJK_HEAVENLY_STEM:\r\n                return createCounterStyleFromSymbols(value, '', cjkSuffix);\r\n            case LIST_STYLE_TYPE.CJK_IDEOGRAPHIC:\r\n            case LIST_STYLE_TYPE.TRAD_CHINESE_INFORMAL:\r\n                return createCJKCounter(value, '', CHINESE_INFORMAL_MULTIPLIERS, '', cjkSuffix, CJK_TEN_COEFFICIENTS | CJK_TEN_HIGH_COEFFICIENTS | CJK_HUNDRED_COEFFICIENTS);\r\n            case LIST_STYLE_TYPE.TRAD_CHINESE_FORMAL:\r\n                return createCJKCounter(value, '', CHINESE_FORMAL_MULTIPLIERS, '', cjkSuffix, CJK_ZEROS | CJK_TEN_COEFFICIENTS | CJK_TEN_HIGH_COEFFICIENTS | CJK_HUNDRED_COEFFICIENTS);\r\n            case LIST_STYLE_TYPE.SIMP_CHINESE_INFORMAL:\r\n                return createCJKCounter(value, '', CHINESE_INFORMAL_MULTIPLIERS, '', cjkSuffix, CJK_TEN_COEFFICIENTS | CJK_TEN_HIGH_COEFFICIENTS | CJK_HUNDRED_COEFFICIENTS);\r\n            case LIST_STYLE_TYPE.SIMP_CHINESE_FORMAL:\r\n                return createCJKCounter(value, '', CHINESE_FORMAL_MULTIPLIERS, '', cjkSuffix, CJK_ZEROS | CJK_TEN_COEFFICIENTS | CJK_TEN_HIGH_COEFFICIENTS | CJK_HUNDRED_COEFFICIENTS);\r\n            case LIST_STYLE_TYPE.JAPANESE_INFORMAL:\r\n                return createCJKCounter(value, '', '', JAPANESE_NEGATIVE, cjkSuffix, 0);\r\n            case LIST_STYLE_TYPE.JAPANESE_FORMAL:\r\n                return createCJKCounter(value, '', '', JAPANESE_NEGATIVE, cjkSuffix, CJK_ZEROS | CJK_TEN_COEFFICIENTS | CJK_TEN_HIGH_COEFFICIENTS);\r\n            case LIST_STYLE_TYPE.KOREAN_HANGUL_FORMAL:\r\n                return createCJKCounter(value, '', '', KOREAN_NEGATIVE, koreanSuffix, CJK_ZEROS | CJK_TEN_COEFFICIENTS | CJK_TEN_HIGH_COEFFICIENTS);\r\n            case LIST_STYLE_TYPE.KOREAN_HANJA_INFORMAL:\r\n                return createCJKCounter(value, '', '', KOREAN_NEGATIVE, koreanSuffix, 0);\r\n            case LIST_STYLE_TYPE.KOREAN_HANJA_FORMAL:\r\n                return createCJKCounter(value, '', '', KOREAN_NEGATIVE, koreanSuffix, CJK_ZEROS | CJK_TEN_COEFFICIENTS | CJK_TEN_HIGH_COEFFICIENTS);\r\n            case LIST_STYLE_TYPE.DEVANAGARI:\r\n                return createCounterStyleFromRange(value, 0x966, 0x96f, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.GEORGIAN:\r\n                return createAdditiveCounter(value, 1, 19999, GEORGIAN, LIST_STYLE_TYPE.DECIMAL, defaultSuffix);\r\n            case LIST_STYLE_TYPE.GUJARATI:\r\n                return createCounterStyleFromRange(value, 0xae6, 0xaef, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.GURMUKHI:\r\n                return createCounterStyleFromRange(value, 0xa66, 0xa6f, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.HEBREW:\r\n                return createAdditiveCounter(value, 1, 10999, HEBREW, LIST_STYLE_TYPE.DECIMAL, defaultSuffix);\r\n            case LIST_STYLE_TYPE.HIRAGANA:\r\n                return createCounterStyleFromSymbols(value, '');\r\n            case LIST_STYLE_TYPE.HIRAGANA_IROHA:\r\n                return createCounterStyleFromSymbols(value, '');\r\n            case LIST_STYLE_TYPE.KANNADA:\r\n                return createCounterStyleFromRange(value, 0xce6, 0xcef, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.KATAKANA:\r\n                return createCounterStyleFromSymbols(value, '', cjkSuffix);\r\n            case LIST_STYLE_TYPE.KATAKANA_IROHA:\r\n                return createCounterStyleFromSymbols(value, '', cjkSuffix);\r\n            case LIST_STYLE_TYPE.LAO:\r\n                return createCounterStyleFromRange(value, 0xed0, 0xed9, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.MONGOLIAN:\r\n                return createCounterStyleFromRange(value, 0x1810, 0x1819, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.MYANMAR:\r\n                return createCounterStyleFromRange(value, 0x1040, 0x1049, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.ORIYA:\r\n                return createCounterStyleFromRange(value, 0xb66, 0xb6f, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.PERSIAN:\r\n                return createCounterStyleFromRange(value, 0x6f0, 0x6f9, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.TAMIL:\r\n                return createCounterStyleFromRange(value, 0xbe6, 0xbef, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.TELUGU:\r\n                return createCounterStyleFromRange(value, 0xc66, 0xc6f, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.THAI:\r\n                return createCounterStyleFromRange(value, 0xe50, 0xe59, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.TIBETAN:\r\n                return createCounterStyleFromRange(value, 0xf20, 0xf29, true, defaultSuffix);\r\n            case LIST_STYLE_TYPE.DECIMAL:\r\n            default:\r\n                return createCounterStyleFromRange(value, 48, 57, true, defaultSuffix);\r\n        }\r\n    };\r\n\r\n    var IGNORE_ATTRIBUTE = 'data-html2canvas-ignore';\r\n    var DocumentCloner = /** @class */ (function () {\r\n        function DocumentCloner(element, options) {\r\n            this.options = options;\r\n            this.scrolledElements = [];\r\n            this.referenceElement = element;\r\n            this.counters = new CounterState();\r\n            this.quoteDepth = 0;\r\n            if (!element.ownerDocument) {\r\n                throw new Error('Cloned element does not have an owner document');\r\n            }\r\n            this.documentElement = this.cloneNode(element.ownerDocument.documentElement);\r\n        }\r\n        DocumentCloner.prototype.toIFrame = function (ownerDocument, windowSize) {\r\n            var _this = this;\r\n            var iframe = createIFrameContainer(ownerDocument, windowSize);\r\n            if (!iframe.contentWindow) {\r\n                return Promise.reject(\"Unable to find iframe window\");\r\n            }\r\n            var scrollX = ownerDocument.defaultView.pageXOffset;\r\n            var scrollY = ownerDocument.defaultView.pageYOffset;\r\n            var cloneWindow = iframe.contentWindow;\r\n            var documentClone = cloneWindow.document;\r\n            /* Chrome doesn't detect relative background-images assigned in inline <style> sheets when fetched through getComputedStyle\r\n             if window url is about:blank, we can assign the url to current by writing onto the document\r\n             */\r\n            var iframeLoad = iframeLoader(iframe).then(function () {\r\n                return __awaiter(_this, void 0, void 0, function () {\r\n                    var onclone;\r\n                    return __generator(this, function (_a) {\r\n                        switch (_a.label) {\r\n                            case 0:\r\n                                this.scrolledElements.forEach(restoreNodeScroll);\r\n                                if (cloneWindow) {\r\n                                    cloneWindow.scrollTo(windowSize.left, windowSize.top);\r\n                                    if (/(iPad|iPhone|iPod)/g.test(navigator.userAgent) &&\r\n                                        (cloneWindow.scrollY !== windowSize.top || cloneWindow.scrollX !== windowSize.left)) {\r\n                                        documentClone.documentElement.style.top = -windowSize.top + 'px';\r\n                                        documentClone.documentElement.style.left = -windowSize.left + 'px';\r\n                                        documentClone.documentElement.style.position = 'absolute';\r\n                                    }\r\n                                }\r\n                                onclone = this.options.onclone;\r\n                                if (typeof this.clonedReferenceElement === 'undefined') {\r\n                                    return [2 /*return*/, Promise.reject(\"Error finding the \" + this.referenceElement.nodeName + \" in the cloned document\")];\r\n                                }\r\n                                if (!(documentClone.fonts && documentClone.fonts.ready)) return [3 /*break*/, 2];\r\n                                return [4 /*yield*/, documentClone.fonts.ready];\r\n                            case 1:\r\n                                _a.sent();\r\n                                _a.label = 2;\r\n                            case 2:\r\n                                if (typeof onclone === 'function') {\r\n                                    return [2 /*return*/, Promise.resolve()\r\n                                        .then(function () { return onclone(documentClone); })\r\n                                        .then(function () { return iframe; })];\r\n                                }\r\n                                return [2 /*return*/, iframe];\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n            documentClone.open();\r\n            documentClone.write(serializeDoctype(document.doctype) + \"<html></html>\");\r\n            // Chrome scrolls the parent document for some reason after the write to the cloned window???\r\n            restoreOwnerScroll(this.referenceElement.ownerDocument, scrollX, scrollY);\r\n            documentClone.replaceChild(documentClone.adoptNode(this.documentElement), documentClone.documentElement);\r\n            documentClone.close();\r\n            return iframeLoad;\r\n        };\r\n        DocumentCloner.prototype.createElementClone = function (node) {\r\n            if (isCanvasElement(node)) {\r\n                return this.createCanvasClone(node);\r\n            }\r\n            /*\r\n            if (isIFrameElement(node)) {\r\n                return this.createIFrameClone(node);\r\n            }\r\n    */\r\n            if (isStyleElement(node)) {\r\n                return this.createStyleClone(node);\r\n            }\r\n            return node.cloneNode(false);\r\n        };\r\n        DocumentCloner.prototype.createStyleClone = function (node) {\r\n            try {\r\n                var sheet = node.sheet;\r\n                if (sheet && sheet.cssRules) {\r\n                    var css = [].slice.call(sheet.cssRules, 0).reduce(function (css, rule) {\r\n                        if (rule && typeof rule.cssText === 'string') {\r\n                            return css + rule.cssText;\r\n                        }\r\n                        return css;\r\n                    }, '');\r\n                    var style = node.cloneNode(false);\r\n                    style.textContent = css;\r\n                    return style;\r\n                }\r\n            }\r\n            catch (e) {\r\n                // accessing node.sheet.cssRules throws a DOMException\r\n                Logger.getInstance(this.options.id).error('Unable to access cssRules property', e);\r\n                if (e.name !== 'SecurityError') {\r\n                    throw e;\r\n                }\r\n            }\r\n            return node.cloneNode(false);\r\n        };\r\n        DocumentCloner.prototype.createCanvasClone = function (canvas) {\r\n            if (this.options.inlineImages && canvas.ownerDocument) {\r\n                var img = canvas.ownerDocument.createElement('img');\r\n                try {\r\n                    img.src = canvas.toDataURL();\r\n                    return img;\r\n                }\r\n                catch (e) {\r\n                    Logger.getInstance(this.options.id).info(\"Unable to clone canvas contents, canvas is tainted\");\r\n                }\r\n            }\r\n            var clonedCanvas = canvas.cloneNode(false);\r\n            try {\r\n                clonedCanvas.width = canvas.width;\r\n                clonedCanvas.height = canvas.height;\r\n                var ctx = canvas.getContext('2d');\r\n                var clonedCtx = clonedCanvas.getContext('2d');\r\n                if (clonedCtx) {\r\n                    if (ctx) {\r\n                        clonedCtx.putImageData(ctx.getImageData(0, 0, canvas.width, canvas.height), 0, 0);\r\n                    }\r\n                    else {\r\n                        clonedCtx.drawImage(canvas, 0, 0);\r\n                    }\r\n                }\r\n                return clonedCanvas;\r\n            }\r\n            catch (e) { }\r\n            return clonedCanvas;\r\n        };\r\n        /*\r\n        createIFrameClone(iframe: HTMLIFrameElement) {\r\n            const tempIframe = <HTMLIFrameElement>iframe.cloneNode(false);\r\n            const iframeKey = generateIframeKey();\r\n            tempIframe.setAttribute('data-html2canvas-internal-iframe-key', iframeKey);\r\n\r\n            const {width, height} = parseBounds(iframe);\r\n\r\n            this.resourceLoader.cache[iframeKey] = getIframeDocumentElement(iframe, this.options)\r\n                .then(documentElement => {\r\n                    return this.renderer(\r\n                        documentElement,\r\n                        {\r\n                            allowTaint: this.options.allowTaint,\r\n                            backgroundColor: '#ffffff',\r\n                            canvas: null,\r\n                            imageTimeout: this.options.imageTimeout,\r\n                            logging: this.options.logging,\r\n                            proxy: this.options.proxy,\r\n                            removeContainer: this.options.removeContainer,\r\n                            scale: this.options.scale,\r\n                            foreignObjectRendering: this.options.foreignObjectRendering,\r\n                            useCORS: this.options.useCORS,\r\n                            target: new CanvasRenderer(),\r\n                            width,\r\n                            height,\r\n                            x: 0,\r\n                            y: 0,\r\n                            windowWidth: documentElement.ownerDocument.defaultView.innerWidth,\r\n                            windowHeight: documentElement.ownerDocument.defaultView.innerHeight,\r\n                            scrollX: documentElement.ownerDocument.defaultView.pageXOffset,\r\n                            scrollY: documentElement.ownerDocument.defaultView.pageYOffset\r\n                        },\r\n                    );\r\n                })\r\n                .then(\r\n                    (canvas: HTMLCanvasElement) =>\r\n                        new Promise((resolve, reject) => {\r\n                            const iframeCanvas = document.createElement('img');\r\n                            iframeCanvas.onload = () => resolve(canvas);\r\n                            iframeCanvas.onerror = (event) => {\r\n                                // Empty iframes may result in empty \"data:,\" URLs, which are invalid from the <img>'s point of view\r\n                                // and instead of `onload` cause `onerror` and unhandled rejection warnings\r\n                                // https://github.com/niklasvh/html2canvas/issues/1502\r\n                                iframeCanvas.src == 'data:,' ? resolve(canvas) : reject(event);\r\n                            };\r\n                            iframeCanvas.src = canvas.toDataURL();\r\n                            if (tempIframe.parentNode && iframe.ownerDocument && iframe.ownerDocument.defaultView) {\r\n                                tempIframe.parentNode.replaceChild(\r\n                                    copyCSSStyles(\r\n                                        iframe.ownerDocument.defaultView.getComputedStyle(iframe),\r\n                                        iframeCanvas\r\n                                    ),\r\n                                    tempIframe\r\n                                );\r\n                            }\r\n                        })\r\n                );\r\n            return tempIframe;\r\n        }\r\n    */\r\n        DocumentCloner.prototype.cloneNode = function (node) {\r\n            if (isTextNode(node)) {\r\n                return document.createTextNode(node.data);\r\n            }\r\n            if (!node.ownerDocument) {\r\n                return node.cloneNode(false);\r\n            }\r\n            var window = node.ownerDocument.defaultView;\r\n            if (isHTMLElementNode(node) && window) {\r\n                var clone = this.createElementClone(node);\r\n                var style = window.getComputedStyle(node);\r\n                var styleBefore = window.getComputedStyle(node, ':before');\r\n                var styleAfter = window.getComputedStyle(node, ':after');\r\n                if (this.referenceElement === node) {\r\n                    this.clonedReferenceElement = clone;\r\n                }\r\n                if (isBodyElement(clone)) {\r\n                    createPseudoHideStyles(clone);\r\n                }\r\n                var counters = this.counters.parse(new CSSParsedCounterDeclaration(style));\r\n                var before = this.resolvePseudoContent(node, clone, styleBefore, PseudoElementType.BEFORE);\r\n                for (var child = node.firstChild; child; child = child.nextSibling) {\r\n                    if (!isElementNode(child) ||\r\n                        (!isScriptElement(child) &&\r\n                            !child.hasAttribute(IGNORE_ATTRIBUTE) &&\r\n                            (typeof this.options.ignoreElements !== 'function' || !this.options.ignoreElements(child)))) {\r\n                        if (!this.options.copyStyles || !isElementNode(child) || !isStyleElement(child)) {\r\n                            clone.appendChild(this.cloneNode(child));\r\n                        }\r\n                    }\r\n                }\r\n                if (before) {\r\n                    clone.insertBefore(before, clone.firstChild);\r\n                }\r\n                var after = this.resolvePseudoContent(node, clone, styleAfter, PseudoElementType.AFTER);\r\n                if (after) {\r\n                    clone.appendChild(after);\r\n                }\r\n                this.counters.pop(counters);\r\n                if (style && this.options.copyStyles && !isIFrameElement(node)) {\r\n                    copyCSSStyles(style, clone);\r\n                }\r\n                //this.inlineAllImages(clone);\r\n                if (node.scrollTop !== 0 || node.scrollLeft !== 0) {\r\n                    this.scrolledElements.push([clone, node.scrollLeft, node.scrollTop]);\r\n                }\r\n                if ((isTextareaElement(node) || isSelectElement(node)) &&\r\n                    (isTextareaElement(clone) || isSelectElement(clone))) {\r\n                    clone.value = node.value;\r\n                }\r\n                return clone;\r\n            }\r\n            return node.cloneNode(false);\r\n        };\r\n        DocumentCloner.prototype.resolvePseudoContent = function (node, clone, style, pseudoElt) {\r\n            var _this = this;\r\n            if (!style) {\r\n                return;\r\n            }\r\n            var value = style.content;\r\n            var document = clone.ownerDocument;\r\n            if (!document || !value || value === 'none' || value === '-moz-alt-content' || style.display === 'none') {\r\n                return;\r\n            }\r\n            this.counters.parse(new CSSParsedCounterDeclaration(style));\r\n            var declaration = new CSSParsedPseudoDeclaration(style);\r\n            var anonymousReplacedElement = document.createElement('html2canvaspseudoelement');\r\n            copyCSSStyles(style, anonymousReplacedElement);\r\n            declaration.content.forEach(function (token) {\r\n                if (token.type === TokenType.STRING_TOKEN) {\r\n                    anonymousReplacedElement.appendChild(document.createTextNode(token.value));\r\n                }\r\n                else if (token.type === TokenType.URL_TOKEN) {\r\n                    var img = document.createElement('img');\r\n                    img.src = token.value;\r\n                    img.style.opacity = '1';\r\n                    anonymousReplacedElement.appendChild(img);\r\n                }\r\n                else if (token.type === TokenType.FUNCTION) {\r\n                    if (token.name === 'attr') {\r\n                        var attr = token.values.filter(isIdentToken);\r\n                        if (attr.length) {\r\n                            anonymousReplacedElement.appendChild(document.createTextNode(node.getAttribute(attr[0].value) || ''));\r\n                        }\r\n                    }\r\n                    else if (token.name === 'counter') {\r\n                        var _a = token.values.filter(nonFunctionArgSeparator), counter = _a[0], counterStyle = _a[1];\r\n                        if (counter && isIdentToken(counter)) {\r\n                            var counterState = _this.counters.getCounterValue(counter.value);\r\n                            var counterType = counterStyle && isIdentToken(counterStyle)\r\n                                ? listStyleType.parse(counterStyle.value)\r\n                                : LIST_STYLE_TYPE.DECIMAL;\r\n                            anonymousReplacedElement.appendChild(document.createTextNode(createCounterText(counterState, counterType, false)));\r\n                        }\r\n                    }\r\n                    else if (token.name === 'counters') {\r\n                        var _b = token.values.filter(nonFunctionArgSeparator), counter = _b[0], delim = _b[1], counterStyle = _b[2];\r\n                        if (counter && isIdentToken(counter)) {\r\n                            var counterStates = _this.counters.getCounterValues(counter.value);\r\n                            var counterType_1 = counterStyle && isIdentToken(counterStyle)\r\n                                ? listStyleType.parse(counterStyle.value)\r\n                                : LIST_STYLE_TYPE.DECIMAL;\r\n                            var separator = delim && delim.type === TokenType.STRING_TOKEN ? delim.value : '';\r\n                            var text = counterStates\r\n                                .map(function (value) { return createCounterText(value, counterType_1, false); })\r\n                                .join(separator);\r\n                            anonymousReplacedElement.appendChild(document.createTextNode(text));\r\n                        }\r\n                    }\r\n                }\r\n                else if (token.type === TokenType.IDENT_TOKEN) {\r\n                    switch (token.value) {\r\n                        case 'open-quote':\r\n                            anonymousReplacedElement.appendChild(document.createTextNode(getQuote(declaration.quotes, _this.quoteDepth++, true)));\r\n                            break;\r\n                        case 'close-quote':\r\n                            anonymousReplacedElement.appendChild(document.createTextNode(getQuote(declaration.quotes, --_this.quoteDepth, false)));\r\n                            break;\r\n                        default:\r\n                            // safari doesn't parse string tokens correctly because of lack of quotes\r\n                            anonymousReplacedElement.appendChild(document.createTextNode(token.value));\r\n                    }\r\n                }\r\n            });\r\n            anonymousReplacedElement.className = PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + \" \" + PSEUDO_HIDE_ELEMENT_CLASS_AFTER;\r\n            clone.className +=\r\n                pseudoElt === PseudoElementType.BEFORE\r\n                    ? \" \" + PSEUDO_HIDE_ELEMENT_CLASS_BEFORE\r\n                    : \" \" + PSEUDO_HIDE_ELEMENT_CLASS_AFTER;\r\n            return anonymousReplacedElement;\r\n        };\r\n        DocumentCloner.destroy = function (container) {\r\n            if (container.parentNode) {\r\n                container.parentNode.removeChild(container);\r\n                return true;\r\n            }\r\n            return false;\r\n        };\r\n        return DocumentCloner;\r\n    }());\r\n    var PseudoElementType;\r\n    (function (PseudoElementType) {\r\n        PseudoElementType[PseudoElementType[\"BEFORE\"] = 0] = \"BEFORE\";\r\n        PseudoElementType[PseudoElementType[\"AFTER\"] = 1] = \"AFTER\";\r\n    })(PseudoElementType || (PseudoElementType = {}));\r\n    var createIFrameContainer = function (ownerDocument, bounds) {\r\n        var cloneIframeContainer = ownerDocument.createElement('iframe');\r\n        cloneIframeContainer.className = 'html2canvas-container';\r\n        cloneIframeContainer.style.visibility = 'hidden';\r\n        cloneIframeContainer.style.position = 'fixed';\r\n        cloneIframeContainer.style.left = '-10000px';\r\n        cloneIframeContainer.style.top = '0px';\r\n        cloneIframeContainer.style.border = '0';\r\n        cloneIframeContainer.width = bounds.width.toString();\r\n        cloneIframeContainer.height = bounds.height.toString();\r\n        cloneIframeContainer.scrolling = 'no'; // ios won't scroll without it\r\n        cloneIframeContainer.setAttribute(IGNORE_ATTRIBUTE, 'true');\r\n        ownerDocument.body.appendChild(cloneIframeContainer);\r\n        return cloneIframeContainer;\r\n    };\r\n    var iframeLoader = function (iframe) {\r\n        return new Promise(function (resolve, reject) {\r\n            var cloneWindow = iframe.contentWindow;\r\n            if (!cloneWindow) {\r\n                return reject(\"No window assigned for iframe\");\r\n            }\r\n            var documentClone = cloneWindow.document;\r\n            cloneWindow.onload = iframe.onload = documentClone.onreadystatechange = function () {\r\n                cloneWindow.onload = iframe.onload = documentClone.onreadystatechange = null;\r\n                var interval = setInterval(function () {\r\n                    if (documentClone.body.childNodes.length > 0 && documentClone.readyState === 'complete') {\r\n                        clearInterval(interval);\r\n                        resolve(iframe);\r\n                    }\r\n                }, 50);\r\n            };\r\n        });\r\n    };\r\n    var copyCSSStyles = function (style, target) {\r\n        // Edge does not provide value for cssText\r\n        for (var i = style.length - 1; i >= 0; i--) {\r\n            var property = style.item(i);\r\n            // Safari shows pseudoelements if content is set\r\n            if (property !== 'content') {\r\n                target.style.setProperty(property, style.getPropertyValue(property));\r\n            }\r\n        }\r\n        return target;\r\n    };\r\n    var serializeDoctype = function (doctype) {\r\n        var str = '';\r\n        if (doctype) {\r\n            str += '<!DOCTYPE ';\r\n            if (doctype.name) {\r\n                str += doctype.name;\r\n            }\r\n            if (doctype.internalSubset) {\r\n                str += doctype.internalSubset;\r\n            }\r\n            if (doctype.publicId) {\r\n                str += \"\\\"\" + doctype.publicId + \"\\\"\";\r\n            }\r\n            if (doctype.systemId) {\r\n                str += \"\\\"\" + doctype.systemId + \"\\\"\";\r\n            }\r\n            str += '>';\r\n        }\r\n        return str;\r\n    };\r\n    var restoreOwnerScroll = function (ownerDocument, x, y) {\r\n        if (ownerDocument &&\r\n            ownerDocument.defaultView &&\r\n            (x !== ownerDocument.defaultView.pageXOffset || y !== ownerDocument.defaultView.pageYOffset)) {\r\n            ownerDocument.defaultView.scrollTo(x, y);\r\n        }\r\n    };\r\n    var restoreNodeScroll = function (_a) {\r\n        var element = _a[0], x = _a[1], y = _a[2];\r\n        element.scrollLeft = x;\r\n        element.scrollTop = y;\r\n    };\r\n    var PSEUDO_BEFORE = ':before';\r\n    var PSEUDO_AFTER = ':after';\r\n    var PSEUDO_HIDE_ELEMENT_CLASS_BEFORE = '___html2canvas___pseudoelement_before';\r\n    var PSEUDO_HIDE_ELEMENT_CLASS_AFTER = '___html2canvas___pseudoelement_after';\r\n    var PSEUDO_HIDE_ELEMENT_STYLE = \"{\\n    content: \\\"\\\" !important;\\n    display: none !important;\\n}\";\r\n    var createPseudoHideStyles = function (body) {\r\n        createStyles(body, \".\" + PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + PSEUDO_BEFORE + PSEUDO_HIDE_ELEMENT_STYLE + \"\\n         .\" + PSEUDO_HIDE_ELEMENT_CLASS_AFTER + PSEUDO_AFTER + PSEUDO_HIDE_ELEMENT_STYLE);\r\n    };\r\n    var createStyles = function (body, styles) {\r\n        var document = body.ownerDocument;\r\n        if (document) {\r\n            var style = document.createElement('style');\r\n            style.textContent = styles;\r\n            body.appendChild(style);\r\n        }\r\n    };\r\n\r\n    var PathType;\r\n    (function (PathType) {\r\n        PathType[PathType[\"VECTOR\"] = 0] = \"VECTOR\";\r\n        PathType[PathType[\"BEZIER_CURVE\"] = 1] = \"BEZIER_CURVE\";\r\n    })(PathType || (PathType = {}));\r\n    var equalPath = function (a, b) {\r\n        if (a.length === b.length) {\r\n            return a.some(function (v, i) { return v === b[i]; });\r\n        }\r\n        return false;\r\n    };\r\n    var transformPath = function (path, deltaX, deltaY, deltaW, deltaH) {\r\n        return path.map(function (point, index) {\r\n            switch (index) {\r\n                case 0:\r\n                    return point.add(deltaX, deltaY);\r\n                case 1:\r\n                    return point.add(deltaX + deltaW, deltaY);\r\n                case 2:\r\n                    return point.add(deltaX + deltaW, deltaY + deltaH);\r\n                case 3:\r\n                    return point.add(deltaX, deltaY + deltaH);\r\n            }\r\n            return point;\r\n        });\r\n    };\r\n\r\n    var Vector = /** @class */ (function () {\r\n        function Vector(x, y) {\r\n            this.type = PathType.VECTOR;\r\n            this.x = x;\r\n            this.y = y;\r\n        }\r\n        Vector.prototype.add = function (deltaX, deltaY) {\r\n            return new Vector(this.x + deltaX, this.y + deltaY);\r\n        };\r\n        return Vector;\r\n    }());\r\n\r\n    var lerp = function (a, b, t) {\r\n        return new Vector(a.x + (b.x - a.x) * t, a.y + (b.y - a.y) * t);\r\n    };\r\n    var BezierCurve = /** @class */ (function () {\r\n        function BezierCurve(start, startControl, endControl, end) {\r\n            this.type = PathType.BEZIER_CURVE;\r\n            this.start = start;\r\n            this.startControl = startControl;\r\n            this.endControl = endControl;\r\n            this.end = end;\r\n        }\r\n        BezierCurve.prototype.subdivide = function (t, firstHalf) {\r\n            var ab = lerp(this.start, this.startControl, t);\r\n            var bc = lerp(this.startControl, this.endControl, t);\r\n            var cd = lerp(this.endControl, this.end, t);\r\n            var abbc = lerp(ab, bc, t);\r\n            var bccd = lerp(bc, cd, t);\r\n            var dest = lerp(abbc, bccd, t);\r\n            return firstHalf ? new BezierCurve(this.start, ab, abbc, dest) : new BezierCurve(dest, bccd, cd, this.end);\r\n        };\r\n        BezierCurve.prototype.add = function (deltaX, deltaY) {\r\n            return new BezierCurve(this.start.add(deltaX, deltaY), this.startControl.add(deltaX, deltaY), this.endControl.add(deltaX, deltaY), this.end.add(deltaX, deltaY));\r\n        };\r\n        BezierCurve.prototype.reverse = function () {\r\n            return new BezierCurve(this.end, this.endControl, this.startControl, this.start);\r\n        };\r\n        return BezierCurve;\r\n    }());\r\n    var isBezierCurve = function (path) { return path.type === PathType.BEZIER_CURVE; };\r\n\r\n    var BoundCurves = /** @class */ (function () {\r\n        function BoundCurves(element) {\r\n            var styles = element.styles;\r\n            var bounds = element.bounds;\r\n            var _a = getAbsoluteValueForTuple(styles.borderTopLeftRadius, bounds.width, bounds.height), tlh = _a[0], tlv = _a[1];\r\n            var _b = getAbsoluteValueForTuple(styles.borderTopRightRadius, bounds.width, bounds.height), trh = _b[0], trv = _b[1];\r\n            var _c = getAbsoluteValueForTuple(styles.borderBottomRightRadius, bounds.width, bounds.height), brh = _c[0], brv = _c[1];\r\n            var _d = getAbsoluteValueForTuple(styles.borderBottomLeftRadius, bounds.width, bounds.height), blh = _d[0], blv = _d[1];\r\n            var factors = [];\r\n            factors.push((tlh + trh) / bounds.width);\r\n            factors.push((blh + brh) / bounds.width);\r\n            factors.push((tlv + blv) / bounds.height);\r\n            factors.push((trv + brv) / bounds.height);\r\n            var maxFactor = Math.max.apply(Math, factors);\r\n            if (maxFactor > 1) {\r\n                tlh /= maxFactor;\r\n                tlv /= maxFactor;\r\n                trh /= maxFactor;\r\n                trv /= maxFactor;\r\n                brh /= maxFactor;\r\n                brv /= maxFactor;\r\n                blh /= maxFactor;\r\n                blv /= maxFactor;\r\n            }\r\n            var topWidth = bounds.width - trh;\r\n            var rightHeight = bounds.height - brv;\r\n            var bottomWidth = bounds.width - brh;\r\n            var leftHeight = bounds.height - blv;\r\n            var borderTopWidth = styles.borderTopWidth;\r\n            var borderRightWidth = styles.borderRightWidth;\r\n            var borderBottomWidth = styles.borderBottomWidth;\r\n            var borderLeftWidth = styles.borderLeftWidth;\r\n            var paddingTop = getAbsoluteValue(styles.paddingTop, element.bounds.width);\r\n            var paddingRight = getAbsoluteValue(styles.paddingRight, element.bounds.width);\r\n            var paddingBottom = getAbsoluteValue(styles.paddingBottom, element.bounds.width);\r\n            var paddingLeft = getAbsoluteValue(styles.paddingLeft, element.bounds.width);\r\n            this.topLeftBorderBox =\r\n                tlh > 0 || tlv > 0\r\n                    ? getCurvePoints(bounds.left, bounds.top, tlh, tlv, CORNER.TOP_LEFT)\r\n                    : new Vector(bounds.left, bounds.top);\r\n            this.topRightBorderBox =\r\n                trh > 0 || trv > 0\r\n                    ? getCurvePoints(bounds.left + topWidth, bounds.top, trh, trv, CORNER.TOP_RIGHT)\r\n                    : new Vector(bounds.left + bounds.width, bounds.top);\r\n            this.bottomRightBorderBox =\r\n                brh > 0 || brv > 0\r\n                    ? getCurvePoints(bounds.left + bottomWidth, bounds.top + rightHeight, brh, brv, CORNER.BOTTOM_RIGHT)\r\n                    : new Vector(bounds.left + bounds.width, bounds.top + bounds.height);\r\n            this.bottomLeftBorderBox =\r\n                blh > 0 || blv > 0\r\n                    ? getCurvePoints(bounds.left, bounds.top + leftHeight, blh, blv, CORNER.BOTTOM_LEFT)\r\n                    : new Vector(bounds.left, bounds.top + bounds.height);\r\n            this.topLeftPaddingBox =\r\n                tlh > 0 || tlv > 0\r\n                    ? getCurvePoints(bounds.left + borderLeftWidth, bounds.top + borderTopWidth, Math.max(0, tlh - borderLeftWidth), Math.max(0, tlv - borderTopWidth), CORNER.TOP_LEFT)\r\n                    : new Vector(bounds.left + borderLeftWidth, bounds.top + borderTopWidth);\r\n            this.topRightPaddingBox =\r\n                trh > 0 || trv > 0\r\n                    ? getCurvePoints(bounds.left + Math.min(topWidth, bounds.width + borderLeftWidth), bounds.top + borderTopWidth, topWidth > bounds.width + borderLeftWidth ? 0 : trh - borderLeftWidth, trv - borderTopWidth, CORNER.TOP_RIGHT)\r\n                    : new Vector(bounds.left + bounds.width - borderRightWidth, bounds.top + borderTopWidth);\r\n            this.bottomRightPaddingBox =\r\n                brh > 0 || brv > 0\r\n                    ? getCurvePoints(bounds.left + Math.min(bottomWidth, bounds.width - borderLeftWidth), bounds.top + Math.min(rightHeight, bounds.height + borderTopWidth), Math.max(0, brh - borderRightWidth), brv - borderBottomWidth, CORNER.BOTTOM_RIGHT)\r\n                    : new Vector(bounds.left + bounds.width - borderRightWidth, bounds.top + bounds.height - borderBottomWidth);\r\n            this.bottomLeftPaddingBox =\r\n                blh > 0 || blv > 0\r\n                    ? getCurvePoints(bounds.left + borderLeftWidth, bounds.top + leftHeight, Math.max(0, blh - borderLeftWidth), blv - borderBottomWidth, CORNER.BOTTOM_LEFT)\r\n                    : new Vector(bounds.left + borderLeftWidth, bounds.top + bounds.height - borderBottomWidth);\r\n            this.topLeftContentBox =\r\n                tlh > 0 || tlv > 0\r\n                    ? getCurvePoints(bounds.left + borderLeftWidth + paddingLeft, bounds.top + borderTopWidth + paddingTop, Math.max(0, tlh - (borderLeftWidth + paddingLeft)), Math.max(0, tlv - (borderTopWidth + paddingTop)), CORNER.TOP_LEFT)\r\n                    : new Vector(bounds.left + borderLeftWidth + paddingLeft, bounds.top + borderTopWidth + paddingTop);\r\n            this.topRightContentBox =\r\n                trh > 0 || trv > 0\r\n                    ? getCurvePoints(bounds.left + Math.min(topWidth, bounds.width + borderLeftWidth + paddingLeft), bounds.top + borderTopWidth + paddingTop, topWidth > bounds.width + borderLeftWidth + paddingLeft ? 0 : trh - borderLeftWidth + paddingLeft, trv - (borderTopWidth + paddingTop), CORNER.TOP_RIGHT)\r\n                    : new Vector(bounds.left + bounds.width - (borderRightWidth + paddingRight), bounds.top + borderTopWidth + paddingTop);\r\n            this.bottomRightContentBox =\r\n                brh > 0 || brv > 0\r\n                    ? getCurvePoints(bounds.left + Math.min(bottomWidth, bounds.width - (borderLeftWidth + paddingLeft)), bounds.top + Math.min(rightHeight, bounds.height + borderTopWidth + paddingTop), Math.max(0, brh - (borderRightWidth + paddingRight)), brv - (borderBottomWidth + paddingBottom), CORNER.BOTTOM_RIGHT)\r\n                    : new Vector(bounds.left + bounds.width - (borderRightWidth + paddingRight), bounds.top + bounds.height - (borderBottomWidth + paddingBottom));\r\n            this.bottomLeftContentBox =\r\n                blh > 0 || blv > 0\r\n                    ? getCurvePoints(bounds.left + borderLeftWidth + paddingLeft, bounds.top + leftHeight, Math.max(0, blh - (borderLeftWidth + paddingLeft)), blv - (borderBottomWidth + paddingBottom), CORNER.BOTTOM_LEFT)\r\n                    : new Vector(bounds.left + borderLeftWidth + paddingLeft, bounds.top + bounds.height - (borderBottomWidth + paddingBottom));\r\n        }\r\n        return BoundCurves;\r\n    }());\r\n    var CORNER;\r\n    (function (CORNER) {\r\n        CORNER[CORNER[\"TOP_LEFT\"] = 0] = \"TOP_LEFT\";\r\n        CORNER[CORNER[\"TOP_RIGHT\"] = 1] = \"TOP_RIGHT\";\r\n        CORNER[CORNER[\"BOTTOM_RIGHT\"] = 2] = \"BOTTOM_RIGHT\";\r\n        CORNER[CORNER[\"BOTTOM_LEFT\"] = 3] = \"BOTTOM_LEFT\";\r\n    })(CORNER || (CORNER = {}));\r\n    var getCurvePoints = function (x, y, r1, r2, position) {\r\n        var kappa = 4 * ((Math.sqrt(2) - 1) / 3);\r\n        var ox = r1 * kappa; // control point offset horizontal\r\n        var oy = r2 * kappa; // control point offset vertical\r\n        var xm = x + r1; // x-middle\r\n        var ym = y + r2; // y-middle\r\n        switch (position) {\r\n            case CORNER.TOP_LEFT:\r\n                return new BezierCurve(new Vector(x, ym), new Vector(x, ym - oy), new Vector(xm - ox, y), new Vector(xm, y));\r\n            case CORNER.TOP_RIGHT:\r\n                return new BezierCurve(new Vector(x, y), new Vector(x + ox, y), new Vector(xm, ym - oy), new Vector(xm, ym));\r\n            case CORNER.BOTTOM_RIGHT:\r\n                return new BezierCurve(new Vector(xm, y), new Vector(xm, y + oy), new Vector(x + ox, ym), new Vector(x, ym));\r\n            case CORNER.BOTTOM_LEFT:\r\n            default:\r\n                return new BezierCurve(new Vector(xm, ym), new Vector(xm - ox, ym), new Vector(x, y + oy), new Vector(x, y));\r\n        }\r\n    };\r\n    var calculateBorderBoxPath = function (curves) {\r\n        return [curves.topLeftBorderBox, curves.topRightBorderBox, curves.bottomRightBorderBox, curves.bottomLeftBorderBox];\r\n    };\r\n    var calculateContentBoxPath = function (curves) {\r\n        return [\r\n            curves.topLeftContentBox,\r\n            curves.topRightContentBox,\r\n            curves.bottomRightContentBox,\r\n            curves.bottomLeftContentBox\r\n        ];\r\n    };\r\n    var calculatePaddingBoxPath = function (curves) {\r\n        return [\r\n            curves.topLeftPaddingBox,\r\n            curves.topRightPaddingBox,\r\n            curves.bottomRightPaddingBox,\r\n            curves.bottomLeftPaddingBox\r\n        ];\r\n    };\r\n\r\n    var TransformEffect = /** @class */ (function () {\r\n        function TransformEffect(offsetX, offsetY, matrix) {\r\n            this.type = 0 /* TRANSFORM */;\r\n            this.offsetX = offsetX;\r\n            this.offsetY = offsetY;\r\n            this.matrix = matrix;\r\n            this.target = 2 /* BACKGROUND_BORDERS */ | 4 /* CONTENT */;\r\n        }\r\n        return TransformEffect;\r\n    }());\r\n    var ClipEffect = /** @class */ (function () {\r\n        function ClipEffect(path, target) {\r\n            this.type = 1 /* CLIP */;\r\n            this.target = target;\r\n            this.path = path;\r\n        }\r\n        return ClipEffect;\r\n    }());\r\n    var isTransformEffect = function (effect) {\r\n        return effect.type === 0 /* TRANSFORM */;\r\n    };\r\n    var isClipEffect = function (effect) { return effect.type === 1 /* CLIP */; };\r\n\r\n    var StackingContext = /** @class */ (function () {\r\n        function StackingContext(container) {\r\n            this.element = container;\r\n            this.inlineLevel = [];\r\n            this.nonInlineLevel = [];\r\n            this.negativeZIndex = [];\r\n            this.zeroOrAutoZIndexOrTransformedOrOpacity = [];\r\n            this.positiveZIndex = [];\r\n            this.nonPositionedFloats = [];\r\n            this.nonPositionedInlineLevel = [];\r\n        }\r\n        return StackingContext;\r\n    }());\r\n    var ElementPaint = /** @class */ (function () {\r\n        function ElementPaint(element, parentStack) {\r\n            this.container = element;\r\n            this.effects = parentStack.slice(0);\r\n            this.curves = new BoundCurves(element);\r\n            if (element.styles.transform !== null) {\r\n                var offsetX = element.bounds.left + element.styles.transformOrigin[0].number;\r\n                var offsetY = element.bounds.top + element.styles.transformOrigin[1].number;\r\n                var matrix = element.styles.transform;\r\n                this.effects.push(new TransformEffect(offsetX, offsetY, matrix));\r\n            }\r\n            if (element.styles.overflowX !== OVERFLOW.VISIBLE) {\r\n                var borderBox = calculateBorderBoxPath(this.curves);\r\n                var paddingBox = calculatePaddingBoxPath(this.curves);\r\n                if (equalPath(borderBox, paddingBox)) {\r\n                    this.effects.push(new ClipEffect(borderBox, 2 /* BACKGROUND_BORDERS */ | 4 /* CONTENT */));\r\n                }\r\n                else {\r\n                    this.effects.push(new ClipEffect(borderBox, 2 /* BACKGROUND_BORDERS */));\r\n                    this.effects.push(new ClipEffect(paddingBox, 4 /* CONTENT */));\r\n                }\r\n            }\r\n        }\r\n        ElementPaint.prototype.getParentEffects = function () {\r\n            var effects = this.effects.slice(0);\r\n            if (this.container.styles.overflowX !== OVERFLOW.VISIBLE) {\r\n                var borderBox = calculateBorderBoxPath(this.curves);\r\n                var paddingBox = calculatePaddingBoxPath(this.curves);\r\n                if (!equalPath(borderBox, paddingBox)) {\r\n                    effects.push(new ClipEffect(paddingBox, 2 /* BACKGROUND_BORDERS */ | 4 /* CONTENT */));\r\n                }\r\n            }\r\n            return effects;\r\n        };\r\n        return ElementPaint;\r\n    }());\r\n    var parseStackTree = function (parent, stackingContext, realStackingContext, listItems) {\r\n        parent.container.elements.forEach(function (child) {\r\n            var treatAsRealStackingContext = contains(child.flags, 4 /* CREATES_REAL_STACKING_CONTEXT */);\r\n            var createsStackingContext = contains(child.flags, 2 /* CREATES_STACKING_CONTEXT */);\r\n            var paintContainer = new ElementPaint(child, parent.getParentEffects());\r\n            if (contains(child.styles.display, 2048 /* LIST_ITEM */)) {\r\n                listItems.push(paintContainer);\r\n            }\r\n            var listOwnerItems = contains(child.flags, 8 /* IS_LIST_OWNER */) ? [] : listItems;\r\n            if (treatAsRealStackingContext || createsStackingContext) {\r\n                var parentStack = treatAsRealStackingContext || child.styles.isPositioned() ? realStackingContext : stackingContext;\r\n                var stack = new StackingContext(paintContainer);\r\n                if (child.styles.isPositioned() || child.styles.opacity < 1 || child.styles.isTransformed()) {\r\n                    var order_1 = child.styles.zIndex.order;\r\n                    if (order_1 < 0) {\r\n                        var index_1 = 0;\r\n                        parentStack.negativeZIndex.some(function (current, i) {\r\n                            if (order_1 > current.element.container.styles.zIndex.order) {\r\n                                index_1 = i;\r\n                                return false;\r\n                            }\r\n                            else if (index_1 > 0) {\r\n                                return true;\r\n                            }\r\n                            return false;\r\n                        });\r\n                        parentStack.negativeZIndex.splice(index_1, 0, stack);\r\n                    }\r\n                    else if (order_1 > 0) {\r\n                        var index_2 = 0;\r\n                        parentStack.positiveZIndex.some(function (current, i) {\r\n                            if (order_1 > current.element.container.styles.zIndex.order) {\r\n                                index_2 = i + 1;\r\n                                return false;\r\n                            }\r\n                            else if (index_2 > 0) {\r\n                                return true;\r\n                            }\r\n                            return false;\r\n                        });\r\n                        parentStack.positiveZIndex.splice(index_2, 0, stack);\r\n                    }\r\n                    else {\r\n                        parentStack.zeroOrAutoZIndexOrTransformedOrOpacity.push(stack);\r\n                    }\r\n                }\r\n                else {\r\n                    if (child.styles.isFloating()) {\r\n                        parentStack.nonPositionedFloats.push(stack);\r\n                    }\r\n                    else {\r\n                        parentStack.nonPositionedInlineLevel.push(stack);\r\n                    }\r\n                }\r\n                parseStackTree(paintContainer, stack, treatAsRealStackingContext ? stack : realStackingContext, listOwnerItems);\r\n            }\r\n            else {\r\n                if (child.styles.isInlineLevel()) {\r\n                    stackingContext.inlineLevel.push(paintContainer);\r\n                }\r\n                else {\r\n                    stackingContext.nonInlineLevel.push(paintContainer);\r\n                }\r\n                parseStackTree(paintContainer, stackingContext, realStackingContext, listOwnerItems);\r\n            }\r\n            if (contains(child.flags, 8 /* IS_LIST_OWNER */)) {\r\n                processListItems(child, listOwnerItems);\r\n            }\r\n        });\r\n    };\r\n    var processListItems = function (owner, elements) {\r\n        var numbering = owner instanceof OLElementContainer ? owner.start : 1;\r\n        var reversed = owner instanceof OLElementContainer ? owner.reversed : false;\r\n        for (var i = 0; i < elements.length; i++) {\r\n            var item = elements[i];\r\n            if (item.container instanceof LIElementContainer &&\r\n                typeof item.container.value === 'number' &&\r\n                item.container.value !== 0) {\r\n                numbering = item.container.value;\r\n            }\r\n            item.listValue = createCounterText(numbering, item.container.styles.listStyleType, true);\r\n            numbering += reversed ? -1 : 1;\r\n        }\r\n    };\r\n    var parseStackingContexts = function (container) {\r\n        var paintContainer = new ElementPaint(container, []);\r\n        var root = new StackingContext(paintContainer);\r\n        var listItems = [];\r\n        parseStackTree(paintContainer, root, root, listItems);\r\n        processListItems(paintContainer.container, listItems);\r\n        return root;\r\n    };\r\n\r\n    var parsePathForBorder = function (curves, borderSide) {\r\n        switch (borderSide) {\r\n            case 0:\r\n                return createPathFromCurves(curves.topLeftBorderBox, curves.topLeftPaddingBox, curves.topRightBorderBox, curves.topRightPaddingBox);\r\n            case 1:\r\n                return createPathFromCurves(curves.topRightBorderBox, curves.topRightPaddingBox, curves.bottomRightBorderBox, curves.bottomRightPaddingBox);\r\n            case 2:\r\n                return createPathFromCurves(curves.bottomRightBorderBox, curves.bottomRightPaddingBox, curves.bottomLeftBorderBox, curves.bottomLeftPaddingBox);\r\n            case 3:\r\n            default:\r\n                return createPathFromCurves(curves.bottomLeftBorderBox, curves.bottomLeftPaddingBox, curves.topLeftBorderBox, curves.topLeftPaddingBox);\r\n        }\r\n    };\r\n    var createPathFromCurves = function (outer1, inner1, outer2, inner2) {\r\n        var path = [];\r\n        if (isBezierCurve(outer1)) {\r\n            path.push(outer1.subdivide(0.5, false));\r\n        }\r\n        else {\r\n            path.push(outer1);\r\n        }\r\n        if (isBezierCurve(outer2)) {\r\n            path.push(outer2.subdivide(0.5, true));\r\n        }\r\n        else {\r\n            path.push(outer2);\r\n        }\r\n        if (isBezierCurve(inner2)) {\r\n            path.push(inner2.subdivide(0.5, true).reverse());\r\n        }\r\n        else {\r\n            path.push(inner2);\r\n        }\r\n        if (isBezierCurve(inner1)) {\r\n            path.push(inner1.subdivide(0.5, false).reverse());\r\n        }\r\n        else {\r\n            path.push(inner1);\r\n        }\r\n        return path;\r\n    };\r\n\r\n    var paddingBox = function (element) {\r\n        var bounds = element.bounds;\r\n        var styles = element.styles;\r\n        return bounds.add(styles.borderLeftWidth, styles.borderTopWidth, -(styles.borderRightWidth + styles.borderLeftWidth), -(styles.borderTopWidth + styles.borderBottomWidth));\r\n    };\r\n    var contentBox = function (element) {\r\n        var styles = element.styles;\r\n        var bounds = element.bounds;\r\n        var paddingLeft = getAbsoluteValue(styles.paddingLeft, bounds.width);\r\n        var paddingRight = getAbsoluteValue(styles.paddingRight, bounds.width);\r\n        var paddingTop = getAbsoluteValue(styles.paddingTop, bounds.width);\r\n        var paddingBottom = getAbsoluteValue(styles.paddingBottom, bounds.width);\r\n        return bounds.add(paddingLeft + styles.borderLeftWidth, paddingTop + styles.borderTopWidth, -(styles.borderRightWidth + styles.borderLeftWidth + paddingLeft + paddingRight), -(styles.borderTopWidth + styles.borderBottomWidth + paddingTop + paddingBottom));\r\n    };\r\n\r\n    var calculateBackgroundPositioningArea = function (backgroundOrigin, element) {\r\n        if (backgroundOrigin === 0 /* BORDER_BOX */) {\r\n            return element.bounds;\r\n        }\r\n        if (backgroundOrigin === 2 /* CONTENT_BOX */) {\r\n            return contentBox(element);\r\n        }\r\n        return paddingBox(element);\r\n    };\r\n    var calculateBackgroundPaintingArea = function (backgroundClip, element) {\r\n        if (backgroundClip === BACKGROUND_CLIP.BORDER_BOX) {\r\n            return element.bounds;\r\n        }\r\n        if (backgroundClip === BACKGROUND_CLIP.CONTENT_BOX) {\r\n            return contentBox(element);\r\n        }\r\n        return paddingBox(element);\r\n    };\r\n    var calculateBackgroundRendering = function (container, index, intrinsicSize) {\r\n        var backgroundPositioningArea = calculateBackgroundPositioningArea(getBackgroundValueForIndex(container.styles.backgroundOrigin, index), container);\r\n        var backgroundPaintingArea = calculateBackgroundPaintingArea(getBackgroundValueForIndex(container.styles.backgroundClip, index), container);\r\n        var backgroundImageSize = calculateBackgroundSize(getBackgroundValueForIndex(container.styles.backgroundSize, index), intrinsicSize, backgroundPositioningArea);\r\n        var sizeWidth = backgroundImageSize[0], sizeHeight = backgroundImageSize[1];\r\n        var position = getAbsoluteValueForTuple(getBackgroundValueForIndex(container.styles.backgroundPosition, index), backgroundPositioningArea.width - sizeWidth, backgroundPositioningArea.height - sizeHeight);\r\n        var path = calculateBackgroundRepeatPath(getBackgroundValueForIndex(container.styles.backgroundRepeat, index), position, backgroundImageSize, backgroundPositioningArea, backgroundPaintingArea);\r\n        var offsetX = Math.round(backgroundPositioningArea.left + position[0]);\r\n        var offsetY = Math.round(backgroundPositioningArea.top + position[1]);\r\n        return [path, offsetX, offsetY, sizeWidth, sizeHeight];\r\n    };\r\n    var isAuto = function (token) { return isIdentToken(token) && token.value === BACKGROUND_SIZE.AUTO; };\r\n    var hasIntrinsicValue = function (value) { return typeof value === 'number'; };\r\n    var calculateBackgroundSize = function (size, _a, bounds) {\r\n        var intrinsicWidth = _a[0], intrinsicHeight = _a[1], intrinsicProportion = _a[2];\r\n        var first = size[0], second = size[1];\r\n        if (isLengthPercentage(first) && second && isLengthPercentage(second)) {\r\n            return [getAbsoluteValue(first, bounds.width), getAbsoluteValue(second, bounds.height)];\r\n        }\r\n        var hasIntrinsicProportion = hasIntrinsicValue(intrinsicProportion);\r\n        if (isIdentToken(first) && (first.value === BACKGROUND_SIZE.CONTAIN || first.value === BACKGROUND_SIZE.COVER)) {\r\n            if (hasIntrinsicValue(intrinsicProportion)) {\r\n                var targetRatio = bounds.width / bounds.height;\r\n                return targetRatio < intrinsicProportion !== (first.value === BACKGROUND_SIZE.COVER)\r\n                    ? [bounds.width, bounds.width / intrinsicProportion]\r\n                    : [bounds.height * intrinsicProportion, bounds.height];\r\n            }\r\n            return [bounds.width, bounds.height];\r\n        }\r\n        var hasIntrinsicWidth = hasIntrinsicValue(intrinsicWidth);\r\n        var hasIntrinsicHeight = hasIntrinsicValue(intrinsicHeight);\r\n        var hasIntrinsicDimensions = hasIntrinsicWidth || hasIntrinsicHeight;\r\n        // If the background-size is auto or auto auto:\r\n        if (isAuto(first) && (!second || isAuto(second))) {\r\n            // If the image has both horizontal and vertical intrinsic dimensions, it's rendered at that size.\r\n            if (hasIntrinsicWidth && hasIntrinsicHeight) {\r\n                return [intrinsicWidth, intrinsicHeight];\r\n            }\r\n            // If the image has no intrinsic dimensions and has no intrinsic proportions,\r\n            // it's rendered at the size of the background positioning area.\r\n            if (!hasIntrinsicProportion && !hasIntrinsicDimensions) {\r\n                return [bounds.width, bounds.height];\r\n            }\r\n            // TODO If the image has no intrinsic dimensions but has intrinsic proportions, it's rendered as if contain had been specified instead.\r\n            // If the image has only one intrinsic dimension and has intrinsic proportions, it's rendered at the size corresponding to that one dimension.\r\n            // The other dimension is computed using the specified dimension and the intrinsic proportions.\r\n            if (hasIntrinsicDimensions && hasIntrinsicProportion) {\r\n                var width_1 = hasIntrinsicWidth\r\n                    ? intrinsicWidth\r\n                    : intrinsicHeight * intrinsicProportion;\r\n                var height_1 = hasIntrinsicHeight\r\n                    ? intrinsicHeight\r\n                    : intrinsicWidth / intrinsicProportion;\r\n                return [width_1, height_1];\r\n            }\r\n            // If the image has only one intrinsic dimension but has no intrinsic proportions,\r\n            // it's rendered using the specified dimension and the other dimension of the background positioning area.\r\n            var width_2 = hasIntrinsicWidth ? intrinsicWidth : bounds.width;\r\n            var height_2 = hasIntrinsicHeight ? intrinsicHeight : bounds.height;\r\n            return [width_2, height_2];\r\n        }\r\n        // If the image has intrinsic proportions, it's stretched to the specified dimension.\r\n        // The unspecified dimension is computed using the specified dimension and the intrinsic proportions.\r\n        if (hasIntrinsicProportion) {\r\n            var width_3 = 0;\r\n            var height_3 = 0;\r\n            if (isLengthPercentage(first)) {\r\n                width_3 = getAbsoluteValue(first, bounds.width);\r\n            }\r\n            else if (isLengthPercentage(second)) {\r\n                height_3 = getAbsoluteValue(second, bounds.height);\r\n            }\r\n            if (isAuto(first)) {\r\n                width_3 = height_3 * intrinsicProportion;\r\n            }\r\n            else if (!second || isAuto(second)) {\r\n                height_3 = width_3 / intrinsicProportion;\r\n            }\r\n            return [width_3, height_3];\r\n        }\r\n        // If the image has no intrinsic proportions, it's stretched to the specified dimension.\r\n        // The unspecified dimension is computed using the image's corresponding intrinsic dimension,\r\n        // if there is one. If there is no such intrinsic dimension,\r\n        // it becomes the corresponding dimension of the background positioning area.\r\n        var width = null;\r\n        var height = null;\r\n        if (isLengthPercentage(first)) {\r\n            width = getAbsoluteValue(first, bounds.width);\r\n        }\r\n        else if (second && isLengthPercentage(second)) {\r\n            height = getAbsoluteValue(second, bounds.height);\r\n        }\r\n        if (width !== null && (!second || isAuto(second))) {\r\n            height =\r\n                hasIntrinsicWidth && hasIntrinsicHeight\r\n                    ? (width / intrinsicWidth) * intrinsicHeight\r\n                    : bounds.height;\r\n        }\r\n        if (height !== null && isAuto(first)) {\r\n            width =\r\n                hasIntrinsicWidth && hasIntrinsicHeight\r\n                    ? (height / intrinsicHeight) * intrinsicWidth\r\n                    : bounds.width;\r\n        }\r\n        if (width !== null && height !== null) {\r\n            return [width, height];\r\n        }\r\n        throw new Error(\"Unable to calculate background-size for element\");\r\n    };\r\n    var getBackgroundValueForIndex = function (values, index) {\r\n        var value = values[index];\r\n        if (typeof value === 'undefined') {\r\n            return values[0];\r\n        }\r\n        return value;\r\n    };\r\n    var calculateBackgroundRepeatPath = function (repeat, _a, _b, backgroundPositioningArea, backgroundPaintingArea) {\r\n        var x = _a[0], y = _a[1];\r\n        var width = _b[0], height = _b[1];\r\n        switch (repeat) {\r\n            case BACKGROUND_REPEAT.REPEAT_X:\r\n                return [\r\n                    new Vector(Math.round(backgroundPositioningArea.left), Math.round(backgroundPositioningArea.top + y)),\r\n                    new Vector(Math.round(backgroundPositioningArea.left + backgroundPositioningArea.width), Math.round(backgroundPositioningArea.top + y)),\r\n                    new Vector(Math.round(backgroundPositioningArea.left + backgroundPositioningArea.width), Math.round(height + backgroundPositioningArea.top + y)),\r\n                    new Vector(Math.round(backgroundPositioningArea.left), Math.round(height + backgroundPositioningArea.top + y))\r\n                ];\r\n            case BACKGROUND_REPEAT.REPEAT_Y:\r\n                return [\r\n                    new Vector(Math.round(backgroundPositioningArea.left + x), Math.round(backgroundPositioningArea.top)),\r\n                    new Vector(Math.round(backgroundPositioningArea.left + x + width), Math.round(backgroundPositioningArea.top)),\r\n                    new Vector(Math.round(backgroundPositioningArea.left + x + width), Math.round(backgroundPositioningArea.height + backgroundPositioningArea.top)),\r\n                    new Vector(Math.round(backgroundPositioningArea.left + x), Math.round(backgroundPositioningArea.height + backgroundPositioningArea.top))\r\n                ];\r\n            case BACKGROUND_REPEAT.NO_REPEAT:\r\n                return [\r\n                    new Vector(Math.round(backgroundPositioningArea.left + x), Math.round(backgroundPositioningArea.top + y)),\r\n                    new Vector(Math.round(backgroundPositioningArea.left + x + width), Math.round(backgroundPositioningArea.top + y)),\r\n                    new Vector(Math.round(backgroundPositioningArea.left + x + width), Math.round(backgroundPositioningArea.top + y + height)),\r\n                    new Vector(Math.round(backgroundPositioningArea.left + x), Math.round(backgroundPositioningArea.top + y + height))\r\n                ];\r\n            default:\r\n                return [\r\n                    new Vector(Math.round(backgroundPaintingArea.left), Math.round(backgroundPaintingArea.top)),\r\n                    new Vector(Math.round(backgroundPaintingArea.left + backgroundPaintingArea.width), Math.round(backgroundPaintingArea.top)),\r\n                    new Vector(Math.round(backgroundPaintingArea.left + backgroundPaintingArea.width), Math.round(backgroundPaintingArea.height + backgroundPaintingArea.top)),\r\n                    new Vector(Math.round(backgroundPaintingArea.left), Math.round(backgroundPaintingArea.height + backgroundPaintingArea.top))\r\n                ];\r\n        }\r\n    };\r\n\r\n    var SMALL_IMAGE = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\r\n\r\n    var SAMPLE_TEXT = 'Hidden Text';\r\n    var FontMetrics = /** @class */ (function () {\r\n        function FontMetrics(document) {\r\n            this._data = {};\r\n            this._document = document;\r\n        }\r\n        FontMetrics.prototype.parseMetrics = function (fontFamily, fontSize) {\r\n            var container = this._document.createElement('div');\r\n            var img = this._document.createElement('img');\r\n            var span = this._document.createElement('span');\r\n            var body = this._document.body;\r\n            container.style.visibility = 'hidden';\r\n            container.style.fontFamily = fontFamily;\r\n            container.style.fontSize = fontSize;\r\n            container.style.margin = '0';\r\n            container.style.padding = '0';\r\n            body.appendChild(container);\r\n            img.src = SMALL_IMAGE;\r\n            img.width = 1;\r\n            img.height = 1;\r\n            img.style.margin = '0';\r\n            img.style.padding = '0';\r\n            img.style.verticalAlign = 'baseline';\r\n            span.style.fontFamily = fontFamily;\r\n            span.style.fontSize = fontSize;\r\n            span.style.margin = '0';\r\n            span.style.padding = '0';\r\n            span.appendChild(this._document.createTextNode(SAMPLE_TEXT));\r\n            container.appendChild(span);\r\n            container.appendChild(img);\r\n            var baseline = img.offsetTop - span.offsetTop + 2;\r\n            container.removeChild(span);\r\n            container.appendChild(this._document.createTextNode(SAMPLE_TEXT));\r\n            container.style.lineHeight = 'normal';\r\n            img.style.verticalAlign = 'super';\r\n            var middle = img.offsetTop - container.offsetTop + 2;\r\n            body.removeChild(container);\r\n            return { baseline: baseline, middle: middle };\r\n        };\r\n        FontMetrics.prototype.getMetrics = function (fontFamily, fontSize) {\r\n            var key = fontFamily + \" \" + fontSize;\r\n            if (typeof this._data[key] === 'undefined') {\r\n                this._data[key] = this.parseMetrics(fontFamily, fontSize);\r\n            }\r\n            return this._data[key];\r\n        };\r\n        return FontMetrics;\r\n    }());\r\n\r\n    var MASK_OFFSET = 10000;\r\n    var CanvasRenderer = /** @class */ (function () {\r\n        function CanvasRenderer(options) {\r\n            this._activeEffects = [];\r\n            this.canvas = options.canvas ? options.canvas : document.createElement('canvas');\r\n            this.ctx = this.canvas.getContext('2d');\r\n            this.options = options;\r\n            if (!options.canvas) {\r\n                this.canvas.width = Math.floor(options.width * options.scale);\r\n                this.canvas.height = Math.floor(options.height * options.scale);\r\n                this.canvas.style.width = options.width + \"px\";\r\n                this.canvas.style.height = options.height + \"px\";\r\n            }\r\n            this.fontMetrics = new FontMetrics(document);\r\n            this.ctx.scale(this.options.scale, this.options.scale);\r\n            this.ctx.translate(-options.x + options.scrollX, -options.y + options.scrollY);\r\n            this.ctx.textBaseline = 'bottom';\r\n            this._activeEffects = [];\r\n            Logger.getInstance(options.id).debug(\"Canvas renderer initialized (\" + options.width + \"x\" + options.height + \" at \" + options.x + \",\" + options.y + \") with scale \" + options.scale);\r\n        }\r\n        CanvasRenderer.prototype.applyEffects = function (effects, target) {\r\n            var _this = this;\r\n            while (this._activeEffects.length) {\r\n                this.popEffect();\r\n            }\r\n            effects.filter(function (effect) { return contains(effect.target, target); }).forEach(function (effect) { return _this.applyEffect(effect); });\r\n        };\r\n        CanvasRenderer.prototype.applyEffect = function (effect) {\r\n            this.ctx.save();\r\n            if (isTransformEffect(effect)) {\r\n                this.ctx.translate(effect.offsetX, effect.offsetY);\r\n                this.ctx.transform(effect.matrix[0], effect.matrix[1], effect.matrix[2], effect.matrix[3], effect.matrix[4], effect.matrix[5]);\r\n                this.ctx.translate(-effect.offsetX, -effect.offsetY);\r\n            }\r\n            if (isClipEffect(effect)) {\r\n                this.path(effect.path);\r\n                this.ctx.clip();\r\n            }\r\n            this._activeEffects.push(effect);\r\n        };\r\n        CanvasRenderer.prototype.popEffect = function () {\r\n            this._activeEffects.pop();\r\n            this.ctx.restore();\r\n        };\r\n        CanvasRenderer.prototype.renderStack = function (stack) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var styles;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            styles = stack.element.container.styles;\r\n                            if (!styles.isVisible()) return [3 /*break*/, 2];\r\n                            this.ctx.globalAlpha = styles.opacity;\r\n                            return [4 /*yield*/, this.renderStackContent(stack)];\r\n                        case 1:\r\n                            _a.sent();\r\n                            _a.label = 2;\r\n                        case 2: return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        CanvasRenderer.prototype.renderNode = function (paint) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            if (!paint.container.styles.isVisible()) return [3 /*break*/, 3];\r\n                            return [4 /*yield*/, this.renderNodeBackgroundAndBorders(paint)];\r\n                        case 1:\r\n                            _a.sent();\r\n                            return [4 /*yield*/, this.renderNodeContent(paint)];\r\n                        case 2:\r\n                            _a.sent();\r\n                            _a.label = 3;\r\n                        case 3: return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        CanvasRenderer.prototype.renderTextWithLetterSpacing = function (text, letterSpacing) {\r\n            var _this = this;\r\n            if (letterSpacing === 0) {\r\n                this.ctx.fillText(text.text, text.bounds.left, text.bounds.top + text.bounds.height);\r\n            }\r\n            else {\r\n                var letters = toCodePoints(text.text).map(function (i) { return fromCodePoint(i); });\r\n                letters.reduce(function (left, letter) {\r\n                    _this.ctx.fillText(letter, left, text.bounds.top + text.bounds.height);\r\n                    return left + _this.ctx.measureText(letter).width;\r\n                }, text.bounds.left);\r\n            }\r\n        };\r\n        CanvasRenderer.prototype.createFontStyle = function (styles) {\r\n            var fontVariant = styles.fontVariant\r\n                .filter(function (variant) { return variant === 'normal' || variant === 'small-caps'; })\r\n                .join('');\r\n            var fontFamily = styles.fontFamily.join(', ');\r\n            var fontSize = isDimensionToken(styles.fontSize)\r\n                ? \"\" + styles.fontSize.number + styles.fontSize.unit\r\n                : styles.fontSize.number + \"px\";\r\n            return [\r\n                [styles.fontStyle, fontVariant, styles.fontWeight, fontSize, fontFamily].join(' '),\r\n                fontFamily,\r\n                fontSize\r\n            ];\r\n        };\r\n        CanvasRenderer.prototype.renderTextNode = function (text, styles) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var _a, font, fontFamily, fontSize;\r\n                var _this = this;\r\n                return __generator(this, function (_b) {\r\n                    _a = this.createFontStyle(styles), font = _a[0], fontFamily = _a[1], fontSize = _a[2];\r\n                    this.ctx.font = font;\r\n                    text.textBounds.forEach(function (text) {\r\n                        _this.ctx.fillStyle = asString(styles.color);\r\n                        _this.renderTextWithLetterSpacing(text, styles.letterSpacing);\r\n                        var textShadows = styles.textShadow;\r\n                        if (textShadows.length && text.text.trim().length) {\r\n                            textShadows\r\n                                .slice(0)\r\n                                .reverse()\r\n                                .forEach(function (textShadow) {\r\n                                    _this.ctx.shadowColor = asString(textShadow.color);\r\n                                    _this.ctx.shadowOffsetX = textShadow.offsetX.number * _this.options.scale;\r\n                                    _this.ctx.shadowOffsetY = textShadow.offsetY.number * _this.options.scale;\r\n                                    _this.ctx.shadowBlur = textShadow.blur.number;\r\n                                    _this.ctx.fillText(text.text, text.bounds.left, text.bounds.top + text.bounds.height);\r\n                                });\r\n                            _this.ctx.shadowColor = '';\r\n                            _this.ctx.shadowOffsetX = 0;\r\n                            _this.ctx.shadowOffsetY = 0;\r\n                            _this.ctx.shadowBlur = 0;\r\n                        }\r\n                        if (styles.textDecorationLine.length) {\r\n                            _this.ctx.fillStyle = asString(styles.textDecorationColor || styles.color);\r\n                            styles.textDecorationLine.forEach(function (textDecorationLine) {\r\n                                switch (textDecorationLine) {\r\n                                    case 1 /* UNDERLINE */:\r\n                                        // Draws a line at the baseline of the font\r\n                                        // TODO As some browsers display the line as more than 1px if the font-size is big,\r\n                                        // need to take that into account both in position and size\r\n                                        var baseline = _this.fontMetrics.getMetrics(fontFamily, fontSize).baseline;\r\n                                        _this.ctx.fillRect(text.bounds.left, Math.round(text.bounds.top + baseline), text.bounds.width, 1);\r\n                                        break;\r\n                                    case 2 /* OVERLINE */:\r\n                                        _this.ctx.fillRect(text.bounds.left, Math.round(text.bounds.top), text.bounds.width, 1);\r\n                                        break;\r\n                                    case 3 /* LINE_THROUGH */:\r\n                                        // TODO try and find exact position for line-through\r\n                                        var middle = _this.fontMetrics.getMetrics(fontFamily, fontSize).middle;\r\n                                        _this.ctx.fillRect(text.bounds.left, Math.ceil(text.bounds.top + middle), text.bounds.width, 1);\r\n                                        break;\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n                    return [2 /*return*/];\r\n                });\r\n            });\r\n        };\r\n        CanvasRenderer.prototype.renderReplacedElement = function (container, curves, image) {\r\n            if (image && container.intrinsicWidth > 0 && container.intrinsicHeight > 0) {\r\n                var box = contentBox(container);\r\n                var path = calculatePaddingBoxPath(curves);\r\n                this.path(path);\r\n                this.ctx.save();\r\n                this.ctx.clip();\r\n                this.ctx.drawImage(image, 0, 0, container.intrinsicWidth, container.intrinsicHeight, box.left, box.top, box.width, box.height);\r\n                this.ctx.restore();\r\n            }\r\n        };\r\n        CanvasRenderer.prototype.renderNodeContent = function (paint) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var container, curves, styles, _i, _a, child, image, e_1, image, e_2, iframeRenderer, canvas, size, bounds, x, textBounds, img, image, url, e_3, bounds;\r\n                return __generator(this, function (_b) {\r\n                    switch (_b.label) {\r\n                        case 0:\r\n                            this.applyEffects(paint.effects, 4 /* CONTENT */);\r\n                            container = paint.container;\r\n                            curves = paint.curves;\r\n                            styles = container.styles;\r\n                            _i = 0, _a = container.textNodes;\r\n                            _b.label = 1;\r\n                        case 1:\r\n                            if (!(_i < _a.length)) return [3 /*break*/, 4];\r\n                            child = _a[_i];\r\n                            return [4 /*yield*/, this.renderTextNode(child, styles)];\r\n                        case 2:\r\n                            _b.sent();\r\n                            _b.label = 3;\r\n                        case 3:\r\n                            _i++;\r\n                            return [3 /*break*/, 1];\r\n                        case 4:\r\n                            if (!(container instanceof ImageElementContainer)) return [3 /*break*/, 8];\r\n                            _b.label = 5;\r\n                        case 5:\r\n                            _b.trys.push([5, 7, , 8]);\r\n                            return [4 /*yield*/, this.options.cache.match(container.src)];\r\n                        case 6:\r\n                            image = _b.sent();\r\n                            this.renderReplacedElement(container, curves, image);\r\n                            return [3 /*break*/, 8];\r\n                        case 7:\r\n                            e_1 = _b.sent();\r\n                            Logger.getInstance(this.options.id).error(\"Error loading image \" + container.src);\r\n                            return [3 /*break*/, 8];\r\n                        case 8:\r\n                            if (container instanceof CanvasElementContainer) {\r\n                                this.renderReplacedElement(container, curves, container.canvas);\r\n                            }\r\n                            if (!(container instanceof SVGElementContainer)) return [3 /*break*/, 12];\r\n                            _b.label = 9;\r\n                        case 9:\r\n                            _b.trys.push([9, 11, , 12]);\r\n                            return [4 /*yield*/, this.options.cache.match(container.svg)];\r\n                        case 10:\r\n                            image = _b.sent();\r\n                            this.renderReplacedElement(container, curves, image);\r\n                            return [3 /*break*/, 12];\r\n                        case 11:\r\n                            e_2 = _b.sent();\r\n                            Logger.getInstance(this.options.id).error(\"Error loading svg \" + container.svg.substring(0, 255));\r\n                            return [3 /*break*/, 12];\r\n                        case 12:\r\n                            if (!(container instanceof IFrameElementContainer && container.tree)) return [3 /*break*/, 14];\r\n                            iframeRenderer = new CanvasRenderer({\r\n                                id: this.options.id,\r\n                                scale: this.options.scale,\r\n                                backgroundColor: container.backgroundColor,\r\n                                x: 0,\r\n                                y: 0,\r\n                                scrollX: 0,\r\n                                scrollY: 0,\r\n                                width: container.width,\r\n                                height: container.height,\r\n                                cache: this.options.cache,\r\n                                windowWidth: container.width,\r\n                                windowHeight: container.height\r\n                            });\r\n                            return [4 /*yield*/, iframeRenderer.render(container.tree)];\r\n                        case 13:\r\n                            canvas = _b.sent();\r\n                            if (container.width && container.height) {\r\n                                this.ctx.drawImage(canvas, 0, 0, container.width, container.height, container.bounds.left, container.bounds.top, container.bounds.width, container.bounds.height);\r\n                            }\r\n                            _b.label = 14;\r\n                        case 14:\r\n                            if (container instanceof InputElementContainer) {\r\n                                size = Math.min(container.bounds.width, container.bounds.height);\r\n                                if (container.type === CHECKBOX) {\r\n                                    if (container.checked) {\r\n                                        this.ctx.save();\r\n                                        this.path([\r\n                                            new Vector(container.bounds.left + size * 0.39363, container.bounds.top + size * 0.79),\r\n                                            new Vector(container.bounds.left + size * 0.16, container.bounds.top + size * 0.5549),\r\n                                            new Vector(container.bounds.left + size * 0.27347, container.bounds.top + size * 0.44071),\r\n                                            new Vector(container.bounds.left + size * 0.39694, container.bounds.top + size * 0.5649),\r\n                                            new Vector(container.bounds.left + size * 0.72983, container.bounds.top + size * 0.23),\r\n                                            new Vector(container.bounds.left + size * 0.84, container.bounds.top + size * 0.34085),\r\n                                            new Vector(container.bounds.left + size * 0.39363, container.bounds.top + size * 0.79)\r\n                                        ]);\r\n                                        this.ctx.fillStyle = asString(INPUT_COLOR);\r\n                                        this.ctx.fill();\r\n                                        this.ctx.restore();\r\n                                    }\r\n                                }\r\n                                else if (container.type === RADIO) {\r\n                                    if (container.checked) {\r\n                                        this.ctx.save();\r\n                                        this.ctx.beginPath();\r\n                                        this.ctx.arc(container.bounds.left + size / 2, container.bounds.top + size / 2, size / 4, 0, Math.PI * 2, true);\r\n                                        this.ctx.fillStyle = asString(INPUT_COLOR);\r\n                                        this.ctx.fill();\r\n                                        this.ctx.restore();\r\n                                    }\r\n                                }\r\n                            }\r\n                            if (isTextInputElement(container) && container.value.length) {\r\n                                this.ctx.font = this.createFontStyle(styles)[0];\r\n                                this.ctx.fillStyle = asString(styles.color);\r\n                                this.ctx.textBaseline = 'middle';\r\n                                this.ctx.textAlign = canvasTextAlign(container.styles.textAlign);\r\n                                bounds = contentBox(container);\r\n                                x = 0;\r\n                                switch (container.styles.textAlign) {\r\n                                    case TEXT_ALIGN.CENTER:\r\n                                        x += bounds.width / 2;\r\n                                        break;\r\n                                    case TEXT_ALIGN.RIGHT:\r\n                                        x += bounds.width;\r\n                                        break;\r\n                                }\r\n                                textBounds = bounds.add(x, 0, 0, -bounds.height / 2 + 1);\r\n                                this.ctx.save();\r\n                                this.path([\r\n                                    new Vector(bounds.left, bounds.top),\r\n                                    new Vector(bounds.left + bounds.width, bounds.top),\r\n                                    new Vector(bounds.left + bounds.width, bounds.top + bounds.height),\r\n                                    new Vector(bounds.left, bounds.top + bounds.height)\r\n                                ]);\r\n                                this.ctx.clip();\r\n                                this.renderTextWithLetterSpacing(new TextBounds(container.value, textBounds), styles.letterSpacing);\r\n                                this.ctx.restore();\r\n                                this.ctx.textBaseline = 'bottom';\r\n                                this.ctx.textAlign = 'left';\r\n                            }\r\n                            if (!contains(container.styles.display, 2048 /* LIST_ITEM */)) return [3 /*break*/, 20];\r\n                            if (!(container.styles.listStyleImage !== null)) return [3 /*break*/, 19];\r\n                            img = container.styles.listStyleImage;\r\n                            if (!(img.type === CSSImageType.URL)) return [3 /*break*/, 18];\r\n                            image = void 0;\r\n                            url = img.url;\r\n                            _b.label = 15;\r\n                        case 15:\r\n                            _b.trys.push([15, 17, , 18]);\r\n                            return [4 /*yield*/, this.options.cache.match(url)];\r\n                        case 16:\r\n                            image = _b.sent();\r\n                            this.ctx.drawImage(image, container.bounds.left - (image.width + 10), container.bounds.top);\r\n                            return [3 /*break*/, 18];\r\n                        case 17:\r\n                            e_3 = _b.sent();\r\n                            Logger.getInstance(this.options.id).error(\"Error loading list-style-image \" + url);\r\n                            return [3 /*break*/, 18];\r\n                        case 18: return [3 /*break*/, 20];\r\n                        case 19:\r\n                            if (paint.listValue && container.styles.listStyleType !== LIST_STYLE_TYPE.NONE) {\r\n                                this.ctx.font = this.createFontStyle(styles)[0];\r\n                                this.ctx.fillStyle = asString(styles.color);\r\n                                this.ctx.textBaseline = 'middle';\r\n                                this.ctx.textAlign = 'right';\r\n                                bounds = new Bounds(container.bounds.left, container.bounds.top + getAbsoluteValue(container.styles.paddingTop, container.bounds.width), container.bounds.width, computeLineHeight(styles.lineHeight, styles.fontSize.number) / 2 + 1);\r\n                                this.renderTextWithLetterSpacing(new TextBounds(paint.listValue, bounds), styles.letterSpacing);\r\n                                this.ctx.textBaseline = 'bottom';\r\n                                this.ctx.textAlign = 'left';\r\n                            }\r\n                            _b.label = 20;\r\n                        case 20: return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        CanvasRenderer.prototype.renderStackContent = function (stack) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var _i, _a, child, _b, _c, child, _d, _e, child, _f, _g, child, _h, _j, child, _k, _l, child, _m, _o, child;\r\n                return __generator(this, function (_p) {\r\n                    switch (_p.label) {\r\n                        case 0:\r\n                            // https://www.w3.org/TR/css-position-3/#painting-order\r\n                            // 1. the background and borders of the element forming the stacking context.\r\n                            return [4 /*yield*/, this.renderNodeBackgroundAndBorders(stack.element)];\r\n                        case 1:\r\n                            // https://www.w3.org/TR/css-position-3/#painting-order\r\n                            // 1. the background and borders of the element forming the stacking context.\r\n                            _p.sent();\r\n                            _i = 0, _a = stack.negativeZIndex;\r\n                            _p.label = 2;\r\n                        case 2:\r\n                            if (!(_i < _a.length)) return [3 /*break*/, 5];\r\n                            child = _a[_i];\r\n                            return [4 /*yield*/, this.renderStack(child)];\r\n                        case 3:\r\n                            _p.sent();\r\n                            _p.label = 4;\r\n                        case 4:\r\n                            _i++;\r\n                            return [3 /*break*/, 2];\r\n                        case 5:\r\n                            // 3. For all its in-flow, non-positioned, block-level descendants in tree order:\r\n                            return [4 /*yield*/, this.renderNodeContent(stack.element)];\r\n                        case 6:\r\n                            // 3. For all its in-flow, non-positioned, block-level descendants in tree order:\r\n                            _p.sent();\r\n                            _b = 0, _c = stack.nonInlineLevel;\r\n                            _p.label = 7;\r\n                        case 7:\r\n                            if (!(_b < _c.length)) return [3 /*break*/, 10];\r\n                            child = _c[_b];\r\n                            return [4 /*yield*/, this.renderNode(child)];\r\n                        case 8:\r\n                            _p.sent();\r\n                            _p.label = 9;\r\n                        case 9:\r\n                            _b++;\r\n                            return [3 /*break*/, 7];\r\n                        case 10:\r\n                            _d = 0, _e = stack.nonPositionedFloats;\r\n                            _p.label = 11;\r\n                        case 11:\r\n                            if (!(_d < _e.length)) return [3 /*break*/, 14];\r\n                            child = _e[_d];\r\n                            return [4 /*yield*/, this.renderStack(child)];\r\n                        case 12:\r\n                            _p.sent();\r\n                            _p.label = 13;\r\n                        case 13:\r\n                            _d++;\r\n                            return [3 /*break*/, 11];\r\n                        case 14:\r\n                            _f = 0, _g = stack.nonPositionedInlineLevel;\r\n                            _p.label = 15;\r\n                        case 15:\r\n                            if (!(_f < _g.length)) return [3 /*break*/, 18];\r\n                            child = _g[_f];\r\n                            return [4 /*yield*/, this.renderStack(child)];\r\n                        case 16:\r\n                            _p.sent();\r\n                            _p.label = 17;\r\n                        case 17:\r\n                            _f++;\r\n                            return [3 /*break*/, 15];\r\n                        case 18:\r\n                            _h = 0, _j = stack.inlineLevel;\r\n                            _p.label = 19;\r\n                        case 19:\r\n                            if (!(_h < _j.length)) return [3 /*break*/, 22];\r\n                            child = _j[_h];\r\n                            return [4 /*yield*/, this.renderNode(child)];\r\n                        case 20:\r\n                            _p.sent();\r\n                            _p.label = 21;\r\n                        case 21:\r\n                            _h++;\r\n                            return [3 /*break*/, 19];\r\n                        case 22:\r\n                            _k = 0, _l = stack.zeroOrAutoZIndexOrTransformedOrOpacity;\r\n                            _p.label = 23;\r\n                        case 23:\r\n                            if (!(_k < _l.length)) return [3 /*break*/, 26];\r\n                            child = _l[_k];\r\n                            return [4 /*yield*/, this.renderStack(child)];\r\n                        case 24:\r\n                            _p.sent();\r\n                            _p.label = 25;\r\n                        case 25:\r\n                            _k++;\r\n                            return [3 /*break*/, 23];\r\n                        case 26:\r\n                            _m = 0, _o = stack.positiveZIndex;\r\n                            _p.label = 27;\r\n                        case 27:\r\n                            if (!(_m < _o.length)) return [3 /*break*/, 30];\r\n                            child = _o[_m];\r\n                            return [4 /*yield*/, this.renderStack(child)];\r\n                        case 28:\r\n                            _p.sent();\r\n                            _p.label = 29;\r\n                        case 29:\r\n                            _m++;\r\n                            return [3 /*break*/, 27];\r\n                        case 30: return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        CanvasRenderer.prototype.mask = function (paths) {\r\n            this.ctx.beginPath();\r\n            this.ctx.moveTo(0, 0);\r\n            this.ctx.lineTo(this.canvas.width, 0);\r\n            this.ctx.lineTo(this.canvas.width, this.canvas.height);\r\n            this.ctx.lineTo(0, this.canvas.height);\r\n            this.ctx.lineTo(0, 0);\r\n            this.formatPath(paths.slice(0).reverse());\r\n            this.ctx.closePath();\r\n        };\r\n        CanvasRenderer.prototype.path = function (paths) {\r\n            this.ctx.beginPath();\r\n            this.formatPath(paths);\r\n            this.ctx.closePath();\r\n        };\r\n        CanvasRenderer.prototype.formatPath = function (paths) {\r\n            var _this = this;\r\n            paths.forEach(function (point, index) {\r\n                var start = isBezierCurve(point) ? point.start : point;\r\n                if (index === 0) {\r\n                    _this.ctx.moveTo(start.x, start.y);\r\n                }\r\n                else {\r\n                    _this.ctx.lineTo(start.x, start.y);\r\n                }\r\n                if (isBezierCurve(point)) {\r\n                    _this.ctx.bezierCurveTo(point.startControl.x, point.startControl.y, point.endControl.x, point.endControl.y, point.end.x, point.end.y);\r\n                }\r\n            });\r\n        };\r\n        CanvasRenderer.prototype.renderRepeat = function (path, pattern, offsetX, offsetY) {\r\n            this.path(path);\r\n            this.ctx.fillStyle = pattern;\r\n            this.ctx.translate(offsetX, offsetY);\r\n            this.ctx.fill();\r\n            this.ctx.translate(-offsetX, -offsetY);\r\n        };\r\n        CanvasRenderer.prototype.resizeImage = function (image, width, height) {\r\n            if (image.width === width && image.height === height) {\r\n                return image;\r\n            }\r\n            var canvas = this.canvas.ownerDocument.createElement('canvas');\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n            var ctx = canvas.getContext('2d');\r\n            ctx.drawImage(image, 0, 0, image.width, image.height, 0, 0, width, height);\r\n            return canvas;\r\n        };\r\n        CanvasRenderer.prototype.renderBackgroundImage = function (container) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var index, _loop_1, this_1, _i, _a, backgroundImage;\r\n                return __generator(this, function (_b) {\r\n                    switch (_b.label) {\r\n                        case 0:\r\n                            index = container.styles.backgroundImage.length - 1;\r\n                            _loop_1 = function (backgroundImage) {\r\n                                var image, url, e_4, _a, path, x, y, width, height, pattern, _b, path, x, y, width, height, _c, lineLength, x0, x1, y0, y1, canvas, ctx, gradient_1, pattern, _d, path, left, top_1, width, height, position, x, y, _e, rx, ry, radialGradient_1, midX, midY, f, invF;\r\n                                return __generator(this, function (_f) {\r\n                                    switch (_f.label) {\r\n                                        case 0:\r\n                                            if (!(backgroundImage.type === CSSImageType.URL)) return [3 /*break*/, 5];\r\n                                            image = void 0;\r\n                                            url = backgroundImage.url;\r\n                                            _f.label = 1;\r\n                                        case 1:\r\n                                            _f.trys.push([1, 3, , 4]);\r\n                                            return [4 /*yield*/, this_1.options.cache.match(url)];\r\n                                        case 2:\r\n                                            image = _f.sent();\r\n                                            return [3 /*break*/, 4];\r\n                                        case 3:\r\n                                            e_4 = _f.sent();\r\n                                            Logger.getInstance(this_1.options.id).error(\"Error loading background-image \" + url);\r\n                                            return [3 /*break*/, 4];\r\n                                        case 4:\r\n                                            if (image) {\r\n                                                _a = calculateBackgroundRendering(container, index, [\r\n                                                    image.width,\r\n                                                    image.height,\r\n                                                    image.width / image.height\r\n                                                ]), path = _a[0], x = _a[1], y = _a[2], width = _a[3], height = _a[4];\r\n                                                pattern = this_1.ctx.createPattern(this_1.resizeImage(image, width, height), 'repeat');\r\n                                                this_1.renderRepeat(path, pattern, x, y);\r\n                                            }\r\n                                            return [3 /*break*/, 6];\r\n                                        case 5:\r\n                                            if (isLinearGradient(backgroundImage)) {\r\n                                                _b = calculateBackgroundRendering(container, index, [null, null, null]), path = _b[0], x = _b[1], y = _b[2], width = _b[3], height = _b[4];\r\n                                                _c = calculateGradientDirection(backgroundImage.angle, width, height), lineLength = _c[0], x0 = _c[1], x1 = _c[2], y0 = _c[3], y1 = _c[4];\r\n                                                canvas = document.createElement('canvas');\r\n                                                canvas.width = width;\r\n                                                canvas.height = height;\r\n                                                ctx = canvas.getContext('2d');\r\n                                                gradient_1 = ctx.createLinearGradient(x0, y0, x1, y1);\r\n                                                processColorStops(backgroundImage.stops, lineLength).forEach(function (colorStop) {\r\n                                                    return gradient_1.addColorStop(colorStop.stop, asString(colorStop.color));\r\n                                                });\r\n                                                ctx.fillStyle = gradient_1;\r\n                                                ctx.fillRect(0, 0, width, height);\r\n                                                if (width > 0 && height > 0) {\r\n                                                    pattern = this_1.ctx.createPattern(canvas, 'repeat');\r\n                                                    this_1.renderRepeat(path, pattern, x, y);\r\n                                                }\r\n                                            }\r\n                                            else if (isRadialGradient(backgroundImage)) {\r\n                                                _d = calculateBackgroundRendering(container, index, [\r\n                                                    null,\r\n                                                    null,\r\n                                                    null\r\n                                                ]), path = _d[0], left = _d[1], top_1 = _d[2], width = _d[3], height = _d[4];\r\n                                                position = backgroundImage.position.length === 0 ? [FIFTY_PERCENT] : backgroundImage.position;\r\n                                                x = getAbsoluteValue(position[0], width);\r\n                                                y = getAbsoluteValue(position[position.length - 1], height);\r\n                                                _e = calculateRadius(backgroundImage, x, y, width, height), rx = _e[0], ry = _e[1];\r\n                                                if (rx > 0 && rx > 0) {\r\n                                                    radialGradient_1 = this_1.ctx.createRadialGradient(left + x, top_1 + y, 0, left + x, top_1 + y, rx);\r\n                                                    processColorStops(backgroundImage.stops, rx * 2).forEach(function (colorStop) {\r\n                                                        return radialGradient_1.addColorStop(colorStop.stop, asString(colorStop.color));\r\n                                                    });\r\n                                                    this_1.path(path);\r\n                                                    this_1.ctx.fillStyle = radialGradient_1;\r\n                                                    if (rx !== ry) {\r\n                                                        midX = container.bounds.left + 0.5 * container.bounds.width;\r\n                                                        midY = container.bounds.top + 0.5 * container.bounds.height;\r\n                                                        f = ry / rx;\r\n                                                        invF = 1 / f;\r\n                                                        this_1.ctx.save();\r\n                                                        this_1.ctx.translate(midX, midY);\r\n                                                        this_1.ctx.transform(1, 0, 0, f, 0, 0);\r\n                                                        this_1.ctx.translate(-midX, -midY);\r\n                                                        this_1.ctx.fillRect(left, invF * (top_1 - midY) + midY, width, height * invF);\r\n                                                        this_1.ctx.restore();\r\n                                                    }\r\n                                                    else {\r\n                                                        this_1.ctx.fill();\r\n                                                    }\r\n                                                }\r\n                                            }\r\n                                            _f.label = 6;\r\n                                        case 6:\r\n                                            index--;\r\n                                            return [2 /*return*/];\r\n                                    }\r\n                                });\r\n                            };\r\n                            this_1 = this;\r\n                            _i = 0, _a = container.styles.backgroundImage.slice(0).reverse();\r\n                            _b.label = 1;\r\n                        case 1:\r\n                            if (!(_i < _a.length)) return [3 /*break*/, 4];\r\n                            backgroundImage = _a[_i];\r\n                            return [5 /*yield**/, _loop_1(backgroundImage)];\r\n                        case 2:\r\n                            _b.sent();\r\n                            _b.label = 3;\r\n                        case 3:\r\n                            _i++;\r\n                            return [3 /*break*/, 1];\r\n                        case 4: return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        CanvasRenderer.prototype.renderBorder = function (color, side, curvePoints) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                return __generator(this, function (_a) {\r\n                    this.path(parsePathForBorder(curvePoints, side));\r\n                    this.ctx.fillStyle = asString(color);\r\n                    this.ctx.fill();\r\n                    return [2 /*return*/];\r\n                });\r\n            });\r\n        };\r\n        CanvasRenderer.prototype.renderNodeBackgroundAndBorders = function (paint) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var styles, hasBackground, borders, backgroundPaintingArea, side, _i, borders_1, border;\r\n                var _this = this;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            this.applyEffects(paint.effects, 2 /* BACKGROUND_BORDERS */);\r\n                            styles = paint.container.styles;\r\n                            hasBackground = !isTransparent(styles.backgroundColor) || styles.backgroundImage.length;\r\n                            borders = [\r\n                                { style: styles.borderTopStyle, color: styles.borderTopColor },\r\n                                { style: styles.borderRightStyle, color: styles.borderRightColor },\r\n                                { style: styles.borderBottomStyle, color: styles.borderBottomColor },\r\n                                { style: styles.borderLeftStyle, color: styles.borderLeftColor }\r\n                            ];\r\n                            backgroundPaintingArea = calculateBackgroundCurvedPaintingArea(getBackgroundValueForIndex(styles.backgroundClip, 0), paint.curves);\r\n                            if (!(hasBackground || styles.boxShadow.length)) return [3 /*break*/, 2];\r\n                            this.ctx.save();\r\n                            this.path(backgroundPaintingArea);\r\n                            this.ctx.clip();\r\n                            if (!isTransparent(styles.backgroundColor)) {\r\n                                this.ctx.fillStyle = asString(styles.backgroundColor);\r\n                                this.ctx.fill();\r\n                            }\r\n                            return [4 /*yield*/, this.renderBackgroundImage(paint.container)];\r\n                        case 1:\r\n                            _a.sent();\r\n                            this.ctx.restore();\r\n                            styles.boxShadow\r\n                                .slice(0)\r\n                                .reverse()\r\n                                .forEach(function (shadow) {\r\n                                    _this.ctx.save();\r\n                                    var borderBoxArea = calculateBorderBoxPath(paint.curves);\r\n                                    var maskOffset = shadow.inset ? 0 : MASK_OFFSET;\r\n                                    var shadowPaintingArea = transformPath(borderBoxArea, -maskOffset + (shadow.inset ? 1 : -1) * shadow.spread.number, (shadow.inset ? 1 : -1) * shadow.spread.number, shadow.spread.number * (shadow.inset ? -2 : 2), shadow.spread.number * (shadow.inset ? -2 : 2));\r\n                                    if (shadow.inset) {\r\n                                        _this.path(borderBoxArea);\r\n                                        _this.ctx.clip();\r\n                                        _this.mask(shadowPaintingArea);\r\n                                    }\r\n                                    else {\r\n                                        _this.mask(borderBoxArea);\r\n                                        _this.ctx.clip();\r\n                                        _this.path(shadowPaintingArea);\r\n                                    }\r\n                                    _this.ctx.shadowOffsetX = shadow.offsetX.number + maskOffset;\r\n                                    _this.ctx.shadowOffsetY = shadow.offsetY.number;\r\n                                    _this.ctx.shadowColor = asString(shadow.color);\r\n                                    _this.ctx.shadowBlur = shadow.blur.number;\r\n                                    _this.ctx.fillStyle = shadow.inset ? asString(shadow.color) : 'rgba(0,0,0,1)';\r\n                                    _this.ctx.fill();\r\n                                    _this.ctx.restore();\r\n                                });\r\n                            _a.label = 2;\r\n                        case 2:\r\n                            side = 0;\r\n                            _i = 0, borders_1 = borders;\r\n                            _a.label = 3;\r\n                        case 3:\r\n                            if (!(_i < borders_1.length)) return [3 /*break*/, 7];\r\n                            border = borders_1[_i];\r\n                            if (!(border.style !== BORDER_STYLE.NONE && !isTransparent(border.color))) return [3 /*break*/, 5];\r\n                            return [4 /*yield*/, this.renderBorder(border.color, side, paint.curves)];\r\n                        case 4:\r\n                            _a.sent();\r\n                            _a.label = 5;\r\n                        case 5:\r\n                            side++;\r\n                            _a.label = 6;\r\n                        case 6:\r\n                            _i++;\r\n                            return [3 /*break*/, 3];\r\n                        case 7: return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        CanvasRenderer.prototype.render = function (element) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var stack;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            if (this.options.backgroundColor) {\r\n                                this.ctx.fillStyle = asString(this.options.backgroundColor);\r\n                                this.ctx.fillRect(this.options.x - this.options.scrollX, this.options.y - this.options.scrollY, this.options.width, this.options.height);\r\n                            }\r\n                            stack = parseStackingContexts(element);\r\n                            return [4 /*yield*/, this.renderStack(stack)];\r\n                        case 1:\r\n                            _a.sent();\r\n                            this.applyEffects([], 2 /* BACKGROUND_BORDERS */);\r\n                            return [2 /*return*/, this.canvas];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        return CanvasRenderer;\r\n    }());\r\n    var isTextInputElement = function (container) {\r\n        if (container instanceof TextareaElementContainer) {\r\n            return true;\r\n        }\r\n        else if (container instanceof SelectElementContainer) {\r\n            return true;\r\n        }\r\n        else if (container instanceof InputElementContainer && container.type !== RADIO && container.type !== CHECKBOX) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    var calculateBackgroundCurvedPaintingArea = function (clip, curves) {\r\n        switch (clip) {\r\n            case BACKGROUND_CLIP.BORDER_BOX:\r\n                return calculateBorderBoxPath(curves);\r\n            case BACKGROUND_CLIP.CONTENT_BOX:\r\n                return calculateContentBoxPath(curves);\r\n            case BACKGROUND_CLIP.PADDING_BOX:\r\n            default:\r\n                return calculatePaddingBoxPath(curves);\r\n        }\r\n    };\r\n    var canvasTextAlign = function (textAlign) {\r\n        switch (textAlign) {\r\n            case TEXT_ALIGN.CENTER:\r\n                return 'center';\r\n            case TEXT_ALIGN.RIGHT:\r\n                return 'right';\r\n            case TEXT_ALIGN.LEFT:\r\n            default:\r\n                return 'left';\r\n        }\r\n    };\r\n\r\n    var ForeignObjectRenderer = /** @class */ (function () {\r\n        function ForeignObjectRenderer(options) {\r\n            this.canvas = options.canvas ? options.canvas : document.createElement('canvas');\r\n            this.ctx = this.canvas.getContext('2d');\r\n            this.options = options;\r\n            this.canvas.width = Math.floor(options.width * options.scale);\r\n            this.canvas.height = Math.floor(options.height * options.scale);\r\n            this.canvas.style.width = options.width + \"px\";\r\n            this.canvas.style.height = options.height + \"px\";\r\n            this.ctx.scale(this.options.scale, this.options.scale);\r\n            this.ctx.translate(-options.x + options.scrollX, -options.y + options.scrollY);\r\n            Logger.getInstance(options.id).debug(\"EXPERIMENTAL ForeignObject renderer initialized (\" + options.width + \"x\" + options.height + \" at \" + options.x + \",\" + options.y + \") with scale \" + options.scale);\r\n        }\r\n        ForeignObjectRenderer.prototype.render = function (element) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var svg, img;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            svg = createForeignObjectSVG(Math.max(this.options.windowWidth, this.options.width) * this.options.scale, Math.max(this.options.windowHeight, this.options.height) * this.options.scale, this.options.scrollX * this.options.scale, this.options.scrollY * this.options.scale, element);\r\n                            return [4 /*yield*/, loadSerializedSVG$1(svg)];\r\n                        case 1:\r\n                            img = _a.sent();\r\n                            if (this.options.backgroundColor) {\r\n                                this.ctx.fillStyle = asString(this.options.backgroundColor);\r\n                                this.ctx.fillRect(0, 0, this.options.width * this.options.scale, this.options.height * this.options.scale);\r\n                            }\r\n                            this.ctx.drawImage(img, -this.options.x * this.options.scale, -this.options.y * this.options.scale);\r\n                            return [2 /*return*/, this.canvas];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        return ForeignObjectRenderer;\r\n    }());\r\n    var loadSerializedSVG$1 = function (svg) {\r\n        return new Promise(function (resolve, reject) {\r\n            var img = new Image();\r\n            img.onload = function () {\r\n                resolve(img);\r\n            };\r\n            img.onerror = reject;\r\n            img.src = \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(new XMLSerializer().serializeToString(svg));\r\n        });\r\n    };\r\n\r\n    var _this = undefined;\r\n    var parseColor$1 = function (value) { return color.parse(Parser.create(value).parseComponentValue()); };\r\n    var html2canvas = function (element, options) {\r\n        if (options === void 0) { options = {}; }\r\n        return renderElement(element, options);\r\n    };\r\n    CacheStorage.setContext(window);\r\n    var renderElement = function (element, opts) {\r\n        return __awaiter(_this, void 0, void 0, function () {\r\n            var ownerDocument, defaultView, instanceName, _a, width, height, left, top, defaultResourceOptions, resourceOptions, defaultOptions, options, windowBounds, documentCloner, clonedElement, container, documentBackgroundColor, bodyBackgroundColor, bgColor, defaultBackgroundColor, backgroundColor, renderOptions, canvas, renderer, root, renderer;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        ownerDocument = element.ownerDocument;\r\n                        if (!ownerDocument) {\r\n                            throw new Error(\"Element is not attached to a Document\");\r\n                        }\r\n                        defaultView = ownerDocument.defaultView;\r\n                        if (!defaultView) {\r\n                            throw new Error(\"Document is not attached to a Window\");\r\n                        }\r\n                        instanceName = (Math.round(Math.random() * 1000) + Date.now()).toString(16);\r\n                        _a = isBodyElement(element) || isHTMLElement(element) ? parseDocumentSize(ownerDocument) : parseBounds(element), width = _a.width, height = _a.height, left = _a.left, top = _a.top;\r\n                        defaultResourceOptions = {\r\n                            allowTaint: false,\r\n                            imageTimeout: 15000,\r\n                            proxy: undefined,\r\n                            useCORS: false\r\n                        };\r\n                        resourceOptions = __assign({}, defaultResourceOptions, opts);\r\n                        defaultOptions = {\r\n                            backgroundColor: '#ffffff',\r\n                            cache: opts.cache ? opts.cache : CacheStorage.create(instanceName, resourceOptions),\r\n                            logging: true,\r\n                            removeContainer: true,\r\n                            foreignObjectRendering: false,\r\n                            scale: defaultView.devicePixelRatio || 1,\r\n                            windowWidth: defaultView.innerWidth,\r\n                            windowHeight: defaultView.innerHeight,\r\n                            scrollX: defaultView.pageXOffset,\r\n                            scrollY: defaultView.pageYOffset,\r\n                            x: left,\r\n                            y: top,\r\n                            width: Math.ceil(width),\r\n                            height: Math.ceil(height),\r\n                            id: instanceName\r\n                        };\r\n                        options = __assign({}, defaultOptions, resourceOptions, opts);\r\n                        windowBounds = new Bounds(options.scrollX, options.scrollY, options.windowWidth, options.windowHeight);\r\n                        Logger.create({ id: instanceName, enabled: options.logging });\r\n                        Logger.getInstance(instanceName).debug(\"Starting document clone\");\r\n                        documentCloner = new DocumentCloner(element, {\r\n                            id: instanceName,\r\n                            onclone: options.onclone,\r\n                            ignoreElements: options.ignoreElements,\r\n                            inlineImages: options.foreignObjectRendering,\r\n                            copyStyles: options.foreignObjectRendering\r\n                        });\r\n                        clonedElement = documentCloner.clonedReferenceElement;\r\n                        if (!clonedElement) {\r\n                            return [2 /*return*/, Promise.reject(\"Unable to find element in cloned iframe\")];\r\n                        }\r\n                        return [4 /*yield*/, documentCloner.toIFrame(ownerDocument, windowBounds)];\r\n                    case 1:\r\n                        container = _b.sent();\r\n                        documentBackgroundColor = ownerDocument.documentElement\r\n                            ? parseColor$1(getComputedStyle(ownerDocument.documentElement).backgroundColor)\r\n                            : COLORS.TRANSPARENT;\r\n                        bodyBackgroundColor = ownerDocument.body\r\n                            ? parseColor$1(getComputedStyle(ownerDocument.body).backgroundColor)\r\n                            : COLORS.TRANSPARENT;\r\n                        bgColor = opts.backgroundColor;\r\n                        defaultBackgroundColor = typeof bgColor === 'string' ? parseColor$1(bgColor) : bgColor === null ? COLORS.TRANSPARENT : 0xffffffff;\r\n                        backgroundColor = element === ownerDocument.documentElement\r\n                            ? isTransparent(documentBackgroundColor)\r\n                                ? isTransparent(bodyBackgroundColor)\r\n                                    ? defaultBackgroundColor\r\n                                    : bodyBackgroundColor\r\n                                : documentBackgroundColor\r\n                            : defaultBackgroundColor;\r\n                        renderOptions = {\r\n                            id: instanceName,\r\n                            cache: options.cache,\r\n                            canvas: options.canvas,\r\n                            backgroundColor: backgroundColor,\r\n                            scale: options.scale,\r\n                            x: options.x,\r\n                            y: options.y,\r\n                            scrollX: options.scrollX,\r\n                            scrollY: options.scrollY,\r\n                            width: options.width,\r\n                            height: options.height,\r\n                            windowWidth: options.windowWidth,\r\n                            windowHeight: options.windowHeight\r\n                        };\r\n                        if (!options.foreignObjectRendering) return [3 /*break*/, 3];\r\n                        Logger.getInstance(instanceName).debug(\"Document cloned, using foreign object rendering\");\r\n                        renderer = new ForeignObjectRenderer(renderOptions);\r\n                        return [4 /*yield*/, renderer.render(clonedElement)];\r\n                    case 2:\r\n                        canvas = _b.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 3:\r\n                        Logger.getInstance(instanceName).debug(\"Document cloned, using computed rendering\");\r\n                        CacheStorage.attachInstance(options.cache);\r\n                        Logger.getInstance(instanceName).debug(\"Starting DOM parsing\");\r\n                        root = parseTree(clonedElement);\r\n                        CacheStorage.detachInstance();\r\n                        if (backgroundColor === root.styles.backgroundColor) {\r\n                            root.styles.backgroundColor = COLORS.TRANSPARENT;\r\n                        }\r\n                        Logger.getInstance(instanceName).debug(\"Starting renderer\");\r\n                        renderer = new CanvasRenderer(renderOptions);\r\n                        return [4 /*yield*/, renderer.render(root)];\r\n                    case 4:\r\n                        canvas = _b.sent();\r\n                        _b.label = 5;\r\n                    case 5:\r\n                        if (options.removeContainer === true) {\r\n                            if (!DocumentCloner.destroy(container)) {\r\n                                Logger.getInstance(instanceName).error(\"Cannot detach cloned iframe as it is not in the DOM anymore\");\r\n                            }\r\n                        }\r\n                        Logger.getInstance(instanceName).debug(\"Finished rendering\");\r\n                        Logger.destroy(instanceName);\r\n                        CacheStorage.destroy(instanceName);\r\n                        return [2 /*return*/, canvas];\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    return html2canvas;\r\n\r\n}));\r\n//# sourceMappingURL=html2canvas.js.map\r\n","/**\r\n * Main entry point.\r\n */\r\n\r\nimport * as Api from \"./src/Api/Api\";\r\nimport * as Utils from \"./src/Utils\";\r\n\r\nexport { FloodgateEngine } from \"./src/FloodgateEngine\";\r\nexport { Api, Utils };\r\n","/**\r\n * Localization.ts\r\n *\r\n * Module for Localization\r\n */\r\n\r\n/**\r\n * List of supported Locales\r\n * REMINDER: update readme to match the list below if change is made\r\n */\r\nlet supportedLocales: string[] = [\r\n\t\"af\",\r\n\t\"am\",\r\n\t\"ar\",\r\n\t\"as\",\r\n\t\"az\",\r\n\t\"be\",\r\n\t\"bg\",\r\n\t\"bn-BD\",\r\n\t\"bn-IN\",\r\n\t\"bs\",\r\n\t\"ca\",\r\n\t\"ca-Es-VALENCIA\",\r\n\t\"chr-Cher\",\r\n\t\"cs\",\r\n\t\"cy\",\r\n\t\"da\",\r\n\t\"de\",\r\n\t\"el\",\r\n\t\"en-GB\",\r\n\t\"es\",\r\n\t\"es-MX\",\r\n\t\"et\",\r\n\t\"eu\",\r\n\t\"fa\",\r\n\t\"fi\",\r\n\t\"fil\",\r\n\t\"fr\",\r\n\t\"fr-CA\",\r\n\t\"ga\",\r\n\t\"gd\",\r\n\t\"gl\",\r\n\t\"gu\",\r\n\t\"ha-Latn-NG\",\r\n\t\"he\",\r\n\t\"hi\",\r\n\t\"hr\",\r\n\t\"hu\",\r\n\t\"hy\",\r\n\t\"id\",\r\n\t\"is\",\r\n\t\"it\",\r\n\t\"ja\",\r\n\t\"ka\",\r\n\t\"kk\",\r\n\t\"km-KH\",\r\n\t\"kn\",\r\n\t\"ko\",\r\n\t\"kok\",\r\n\t\"ky\",\r\n\t\"lb\",\r\n\t\"lo\",\r\n\t\"lt\",\r\n\t\"lv\",\r\n\t\"mi\",\r\n\t\"mk\",\r\n\t\"ml\",\r\n\t\"mn\",\r\n\t\"mr\",\r\n\t\"ms\",\r\n\t\"mt\",\r\n\t\"nb-NO\",\r\n\t\"ne\",\r\n\t\"nl\",\r\n\t\"nn-NO\",\r\n\t\"or\",\r\n\t\"pa\",\r\n\t\"pl\",\r\n\t\"prs\",\r\n\t\"pt-BR\",\r\n\t\"pt-PT\",\r\n\t\"quz\",\r\n\t\"ro\",\r\n\t\"ru\",\r\n\t\"sd\",\r\n\t\"si\",\r\n\t\"sk\",\r\n\t\"sl\",\r\n\t\"sq\",\r\n\t\"sr-Cyrl-BA\",\r\n\t\"sr-Cyrl-RS\",\r\n\t\"sr-Latn-RS\",\r\n\t\"sv\",\r\n\t\"sw\",\r\n\t\"ta\",\r\n\t\"te\",\r\n\t\"th\",\r\n\t\"tk\",\r\n\t\"tr\",\r\n\t\"tt\",\r\n\t\"ug\",\r\n\t\"uk\",\r\n\t\"ur\",\r\n\t\"uz-Latn-UZ\",\r\n\t\"vi\",\r\n\t\"zh-Hans\",\r\n\t\"zh-Hant\",\r\n];\r\n\r\nconst localeVariantToSupportedlocaleMap: { [key: string]: string } = {\r\n\t\"ZH-CN\": \"zh-Hans\",\r\n\t\"ZH-HK\": \"zh-Hant\",\r\n\t\"ZH-MO\": \"zh-Hant\",\r\n\t\"ZH-SG\": \"zh-Hans\",\r\n\t\"ZH-TW\": \"zh-Hant\",\r\n};\r\n\r\nexport function validate(locale: string): string {\r\n\tlet localeUpperCase = locale.toLocaleUpperCase();\r\n\r\n\t// support for Chinese ll-cc, VSO Bug 1583389\r\n\tif (localeUpperCase in localeVariantToSupportedlocaleMap) {\r\n\t\treturn localeVariantToSupportedlocaleMap[localeUpperCase];\r\n\t}\r\n\r\n\t// return supported locale if exact match found\r\n\tfor (let supportedLocale of supportedLocales) {\r\n\t\tif (supportedLocale.toUpperCase() === localeUpperCase) {\r\n\t\t\treturn supportedLocale;\r\n\t\t}\r\n\t}\r\n\r\n\tlet localePartOne = localeUpperCase.split(\"-\")[0];\r\n\t// return supported \"ll\" if exact match not found, but \"ll\" matches\r\n\tfor (let supportedLocale of supportedLocales) {\r\n\t\tif (supportedLocale.toUpperCase() === localePartOne) {\r\n\t\t\treturn supportedLocale;\r\n\t\t}\r\n\t}\r\n\r\n\t// default everything else to en\r\n\treturn \"en\";\r\n}\r\n","/**\r\n * The main interface to use when instrumenting survey activities in app code\r\n */\r\ninterface IActivityListener {\r\n\t/**\r\n\t * Log an activity to Floodgate, incrementing its occurrence count by the given number if specified,\r\n\t * otherwise incrementing its occurrence count by one as default\r\n\t */\r\n\tlogActivity(activityName: string, increment?: number, context?:IActivityListener.IActivityContext): void;\r\n\r\n\t/**\r\n\t * Start an activity timer (overwriting any previously unclosed start).\r\n\t * NOTE: Does not increment the activity count.\r\n\t */\r\n\tlogActivityStartTime(activityName: string, startTime?: Date): void;\r\n\r\n\t/**\r\n\t * Stop an activity timer and clears the previous start time.\r\n\t * Adds the elapsed seconds between this stop and the previous start into the count for this activity\r\n\t * \\note If no previous start was logged, or start is somehow in the future, results in 0 count increment\r\n\t */\r\n\tlogActivityStopTime(activityName: string, stopTime?: Date): void;\r\n}\r\n\r\nmodule IActivityListener {\r\n\texportinterfaceIActivityContext{\r\n\t\tdata?:unknown;\r\n\t}\r\n\r\n\texport class ActivityName {\r\n\t\tpublic static readonly AppLaunch = \"AppLaunch\";\r\n\t\tpublic static readonly AppUsageTime = \"AppUsageTime\";\r\n\t\tpublic static readonly AppResume = \"AppResume\";\r\n\t}\r\n}\r\n\r\nexport = IActivityListener;\r\n","/**\r\n * Interface for a collection of Floodgate setting names and ids\r\n */\r\ninterface IFloodgateSettingIdMap {\r\n\treadonly [key: string]: number;\r\n}\r\n\r\nmodule IFloodgateSettingIdMap {\r\n\t/**\r\n\t * Collection of setting names and ids\r\n\t */\r\n\texport const RoamingSettingIdMap = {\r\n\t\tCampaignStates: 1258,\r\n\t\tGovernedChannelStates: 1257,\r\n\t\tSurveyActivationStats: 1259,\r\n\t};\r\n}\r\n\r\nexport = IFloodgateSettingIdMap;\r\n","import { IFloodgateEnvironmentProvider } from \"../Api/IFloodgateEnvironmentProvider\";\r\nimport * as IFloodgateStringProvider from \"../Api/IFloodgateStringProvider\";\r\nimport * as ISurvey from \"../Api/ISurvey\";\r\nimport { IDictionary } from \"../Common\";\r\nimport { FloodgateEngine } from \"../FloodgateEngine\";\r\nimport { GovernedChannelType } from \"../GovernedChannel\";\r\nimport { ISurveyClient } from \"../ISurveyClient\";\r\nimport * as ISurveyInfo from \"../ISurveyInfo\";\r\nimport * as Utils from \"../Utils\";\r\nimport {\r\n\tCampaignDefinition, CampaignDuration, CampaignDurationSingleBuildChange,\r\n\tCampaignDurationTimeInterval, CampaignScopeEnvironmentCrossProduct, CampaignScopeUserFactAll, CampaignScopeUserFactAny, ICampaignDefinitionProvider,\r\n} from \"./CampaignDefinitionProvider\";\r\nimport { CampaignState, ICampaignStateProvider } from \"./CampaignStateProvider\";\r\nimport { CampaignSurveyFactory } from \"./CampaignSurveyFactory\";\r\n\r\nimport { IUserFact, IUserFactProvider } from \"../Api/Api\";\r\nimport { TelemetryEvent } from \"../Constants\";\r\nimport { BusinessLevel } from \"../ISurveyInfo\";\r\n\r\nconst { getDistantFuture, getDistantPast, isArray, isNOU } = Utils;\r\n\r\n/**\r\n * The CampaignManager is responsible for combining read-only campaign definitions with previously stored campaign state,\r\n * running re-nomination elections, and ultimately generating surveys\r\n */\r\nexport interface ICampaignManager {\r\n\t// Get the list of active surveys targeting this user\r\n\tgetActiveSurveys(): IDictionary<ISurvey>;\r\n\r\n\t// Updates the campaign state based on the fact that the user just took that campaign's survey\r\n\tonCampaignSurveyActivated(campaignId: string, date: Date, isSurveyComplete: boolean): void;\r\n}\r\n\r\n/**\r\n * The standard campaign manager implementation.\r\n */\r\nexport class CampaignManager implements ICampaignManager, ISurveyClient {\r\n\tpublic static isStateUpForNomination(state: CampaignState, definition: CampaignDefinition, date: Date, buildNumber: string): boolean {\r\n\t\tif (!state || !definition) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tdate = date ? date : new Date();\r\n\r\n\t\t// Check manual override\r\n\t\tif (state.ForceCandidacy) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Figure out which duration we're using based on whether or not the user triggered the survey\r\n\t\tconst campaignCooldownDuration: CampaignDuration\r\n\t\t\t= definition.nominationScheme.getCampaignCooldown(state.IsCandidate && state.DidCandidateTriggerSurvey);\r\n\r\n\t\tif (!campaignCooldownDuration) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t// First check for build-based rules. Eventually this could get more complex if we supported counting differently seen build numbers\r\n\t\tif (CampaignManager.hasBuildChangeDurationElapsed(campaignCooldownDuration, state.LastNominationBuildNumber, buildNumber)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Next check date rules\r\n\t\treturn CampaignManager.hasTimeIntervalDurationElapsed(campaignCooldownDuration, state.getCooldownStartDate(), date);\r\n\t}\r\n\r\n\tpublic static isDateInRange(date: Date, startDate: Date, endDate: Date): boolean {\r\n\t\tdate = date ? date : new Date();\r\n\t\tstartDate = startDate ? startDate : getDistantPast();\r\n\t\tendDate = endDate ? endDate : getDistantFuture();\r\n\r\n\t\t// Check Start/Expire date range\r\n\t\tif (startDate.getTime() <= date.getTime() && endDate.getTime() >= date.getTime()) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tpublic static hasTimeIntervalDurationElapsed(duration: CampaignDuration, startDate: Date, date: Date): boolean {\r\n\t\tif (isNOU(duration) || !(duration instanceof CampaignDurationTimeInterval)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (!startDate || !date) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst endDate: Date = Utils.addSecondsWithoutOverflow(startDate, duration.intervalSeconds);\r\n\t\treturn date.getTime() >= endDate.getTime();\r\n\t}\r\n\r\n\tpublic static hasBuildChangeDurationElapsed(duration: CampaignDuration, startBuild: string, build: string): boolean {\r\n\t\tif (isNOU(duration) || !(duration instanceof CampaignDurationSingleBuildChange)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (isNOU(startBuild) || isNOU(build)) {\r\n\t\t\treturn (startBuild === null) !== (build === null);\r\n\t\t}\r\n\r\n\t\treturn !(startBuild === build);\r\n\t}\r\n\r\n\tprivate static isCampaignInScope(\r\n\t\tdefinition: CampaignDefinition,\r\n\t\tdate: Date,\r\n\t\tenvironmentProvider: IFloodgateEnvironmentProvider,\r\n\t\tuserFactsProvider: IUserFactProvider): boolean {\r\n\t\tif (!definition) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tdate = date ? date : new Date();\r\n\r\n\t\t// Check Start/Expire date range\r\n\t\tif (!CampaignManager.isDateInRangeWithDefinition(date, definition)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (definition.scope) {\r\n\t\t\tif (definition.scope instanceof CampaignScopeUserFactAny || definition.scope instanceof CampaignScopeUserFactAll) {\r\n\t\t\t\tdefinition.scope.setUserFactsProvider(userFactsProvider);\r\n\t\t\t}\r\n\t\t\tif (definition.scope instanceof CampaignScopeEnvironmentCrossProduct) {\r\n\t\t\t\tdefinition.scope.setEnvironmentProvider(environmentProvider);\r\n\t\t\t}\r\n\t\t\tif (!definition.scope.isInScope()) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If we get here, the definition is relevant\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate static isDateInRangeWithDefinition(date: Date, definition: CampaignDefinition): boolean {\r\n\t\tif (!definition) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tdate = date ? date : new Date();\r\n\r\n\t\treturn CampaignManager.isDateInRange(date,\r\n\t\t\t// null start dates should be impossible, but if set, should mean the campaign is disabled\r\n\t\t\tdefinition.startTime ? definition.startTime : getDistantFuture(),\r\n\t\t\tdefinition.endTime);\r\n\t}\r\n\r\n\tprivate campaignStates: IDictionary<CampaignState>;\r\n\tprivate campaignDefinitions: IDictionary<CampaignDefinition>;\r\n\tprivate userFacts: IUserFact[];\r\n\tprivate currentBuildNumber: string;\r\n\tprivate stateProvider: ICampaignStateProvider;\r\n\tprivate definitionProviders: ICampaignDefinitionProvider[];\r\n\tprivate stringProvider: IFloodgateStringProvider;\r\n\tprivate environmentProvider: IFloodgateEnvironmentProvider;\r\n\tprivate userFactsProvider: IUserFactProvider;\r\n\r\n\tpublic constructor(stateProvider: ICampaignStateProvider,\r\n\t\tdefinitionProviders: ICampaignDefinitionProvider[],\r\n\t\tstringProvider: IFloodgateStringProvider,\r\n\t\tenvironmentProvider: IFloodgateEnvironmentProvider,\r\n\t\tcurrentBuildNumber: string,\r\n\t\tcurrentDate: Date,\r\n\t\tuserFactsProvider?: IUserFactProvider) {\r\n\r\n\t\tif (!stateProvider) {\r\n\t\t\tthrow new Error(\"stateProvider must not be null\");\r\n\t\t}\r\n\r\n\t\tif (!isArray(definitionProviders)) {\r\n\t\t\tthrow new Error(\"definitionProviders is either null or not an array type\");\r\n\t\t}\r\n\r\n\t\tif (!stringProvider) {\r\n\t\t\tthrow new Error(\"stringProvider must not be null\");\r\n\t\t}\r\n\r\n\t\tif (isNOU(currentBuildNumber)) {\r\n\t\t\tthrow new Error(\"currentBuildNumber must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.campaignStates = {};\r\n\t\tthis.campaignDefinitions = {};\r\n\t\tthis.userFacts = [];\r\n\t\tthis.stateProvider = stateProvider;\r\n\t\tthis.definitionProviders = definitionProviders;\r\n\t\tthis.stringProvider = stringProvider;\r\n\t\tthis.userFactsProvider = userFactsProvider;\r\n\t\tthis.environmentProvider = environmentProvider; // Can be null\r\n\t\tthis.currentBuildNumber = currentBuildNumber;\r\n\r\n\t\tcurrentDate = currentDate ? currentDate : new Date();\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getActiveSurveys(): IDictionary<ISurvey> {\r\n\t\tconst surveys: IDictionary<ISurvey> = {};\r\n\t\tconst prioritizedCampaigns = this.getPrioritizedCampaigns();\r\n\r\n\t\tfor (const key in this.campaignStates) {\r\n\t\t\tif (this.campaignStates.hasOwnProperty(key)) {\r\n\t\t\t\tconst state: CampaignState = this.campaignStates[key];\r\n\t\t\t\tif (!state.IsCandidate) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// This is a requirement because we keep some otherwise \"stale\" campaigns around for the save routine\r\n\t\t\t\tconst definition: CampaignDefinition = prioritizedCampaigns[state.CampaignId];\r\n\t\t\t\tif (!definition) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst survey: ISurvey = CampaignSurveyFactory.makeSurvey(state, definition, this.stringProvider);\r\n\t\t\t\tif (!survey) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsurveys[survey.getSurveyInfo().getId()] = survey;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn surveys;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic onCampaignSurveyActivated(campaignId: string, takenDate: Date, isSurveyComplete: boolean): void {\r\n\t\tconst state: CampaignState = this.campaignStates[campaignId];\r\n\t\tif (!state) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttakenDate = takenDate ? takenDate : new Date();\r\n\r\n\t\tconst cooldownSeconds = this.campaignDefinitions[campaignId].nominationScheme.cooldownPeriod.asTimeIntervalSeconds();\r\n\t\tstate.markCurrentSurveyTakenOnDate(takenDate, cooldownSeconds, isSurveyComplete);\r\n\r\n\t\tthis.saveCurrentState();\r\n\t}\r\n\r\n\tpublic getCampaignStates(): IDictionary<CampaignState> {\r\n\t\treturn this.campaignStates;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getCampaignDefinitions(): IDictionary<CampaignDefinition> {\r\n\t\treturn this.campaignDefinitions;\r\n\t}\r\n\r\n\tpublic getUserFacts(): IUserFact[] {\r\n\t\treturn this.userFacts;\r\n\t}\r\n\r\n\t// region ISurveyClient methods\r\n\r\n\t// @Override\r\n\tpublic onSurveyActivated(surveyInfo: ISurveyInfo, isSurveyComplete: boolean): void {\r\n\t\tif (!surveyInfo) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.onCampaignSurveyActivated(surveyInfo.getBackEndId(), new Date(), isSurveyComplete);\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic refreshSurveyDefinitions(channelTypes?: GovernedChannelType[], date?: Date): void {\r\n\t\tthis.refreshSurveyDefinitionsPrivate(channelTypes, (date ? date : new Date()));\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic refreshSurveyDefinitionsAsync(channelTypes?: GovernedChannelType[], date?: Date): Promise<void> {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.refreshSurveyDefinitionsPrivateAsync(channelTypes, (date ? date : new Date())).then(\r\n\t\t\t\tfunction onFulfilled() {\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t},\r\n\t\t\t).catch(\r\n\t\t\t\tfunction OnRejected(errReason) {\r\n\t\t\t\t\treject(errReason);\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getAppSurveys(): { [id: string]: ISurvey } {\r\n\t\treturn this.getActiveSurveys();\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic saveCurrentState(): void {\r\n\t\t// Sort by campaignId, ascending for uniformity\r\n\t\tconst states: CampaignState[] = Utils.makeArrayFromObjectValuesSortedByKeyString(this.campaignStates);\r\n\r\n\t\tthis.stateProvider.save(states);\r\n\t}\r\n\r\n\t// endregion\r\n\r\n\tprivate refreshSurveyDefinitionsPrivate(channelTypes: GovernedChannelType[], date: Date): void {\r\n\t\tthis.campaignStates = {};\r\n\t\tthis.campaignDefinitions = {};\r\n\t\tthis.userFacts = [];\r\n\r\n\t\tthis.loadAndFilterCampaignData(date, channelTypes);\r\n\t\tthis.evaluateCampaigns(date);\r\n\t}\r\n\r\n\tprivate refreshSurveyDefinitionsPrivateAsync(channelTypes: GovernedChannelType[], date: Date): Promise<void> {\r\n\t\tthis.campaignStates = {};\r\n\t\tthis.campaignDefinitions = {};\r\n\t\tthis.userFacts = [];\r\n\r\n\t\tconst thisCampaignManager = this;\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthisCampaignManager.loadAndFilterCampaignDataAsync(date, channelTypes).then(\r\n\t\t\t\tfunction onFulfilled() {\r\n\t\t\t\t\tthisCampaignManager.evaluateCampaigns(date);\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t},\r\n\t\t\t).catch(\r\n\t\t\t\tfunction OnRejected(errReason) {\r\n\t\t\t\t\treject(errReason);\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Load and filter the campaigns definitions and states\r\n\t */\r\n\tprivate loadAndFilterCampaignDataAsync(currentDate: Date, channelTypes: GovernedChannelType[]): Promise<void> {\r\n\t\tcurrentDate = currentDate ? currentDate : new Date();\r\n\t\tlet loadedDefinitions: CampaignDefinition[] = [];\r\n\t\tconst promises = [];\r\n\r\n\t\tconst userFactsPromise = this.userFactsProvider && this.userFactsProvider.loadAsync() as Promise<IUserFact[]>;\r\n\r\n\t\tfor (const i of Object.keys(this.definitionProviders)) {\r\n\t\t\tconst provider = this.definitionProviders[i];\r\n\t\t\tlet promise: any = provider && provider.loadAsync();\r\n\t\t\tif (!isNOU(promise)) {\r\n\t\t\t\t// Promise.all fails even if one promise fails.\r\n\t\t\t\t// We want to ignore the promise that failed and continue with the ones\r\n\t\t\t\t// those are succesful, hence overriding the catch to always resolve.\r\n\t\t\t\t// responsibility of logging failures should be with the provider.\r\n\t\t\t\tpromise = promise.catch(() => {\r\n\t\t\t\t\tFloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed(\"Failed to load from campaign definition provider\");\r\n\t\t\t\t\tPromise.resolve();\r\n\t\t\t\t});\r\n\t\t\t\tpromises.push(promise);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst thisCampaignManager = this;\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tPromise.all(promises).then(\r\n\t\t\t\tfunction onFulfilled(values) {\r\n\t\t\t\t\tfor (const i of Object.keys(values)) {\r\n\t\t\t\t\t\tconst campaignDefinitions = values[i];\r\n\t\t\t\t\t\tif (isArray(campaignDefinitions)) {\r\n\t\t\t\t\t\t\t// If there are campaign defintions with duplicate campaign Id's\r\n\t\t\t\t\t\t\t// Floodgate will load the last one it found. FilterCampaignData does this filteration\r\n\t\t\t\t\t\t\tloadedDefinitions = loadedDefinitions.concat(campaignDefinitions);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst setUserFacts = (userFacts?: IUserFact[]) => {\r\n\t\t\t\t\t\tthisCampaignManager.userFacts = userFacts || [];\r\n\t\t\t\t\t\tthisCampaignManager.FilterCampaignData(currentDate, channelTypes, loadedDefinitions);\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Before filtering and evaluating the campaign definitions,\r\n\t\t\t\t\t// wait until the user facts are loaded as they will be used in evaluating campaign scopes\r\n\t\t\t\t\tif (!isNOU(userFactsPromise)) {\r\n\t\t\t\t\t\tuserFactsPromise.then((userFacts: IUserFact[]) => {\r\n\t\t\t\t\t\t\tsetUserFacts(userFacts);\r\n\t\t\t\t\t\t}).catch(() => {\r\n\t\t\t\t\t\t\t// this should never happen as user facts promise will always be resolved by the user facts provider\r\n\t\t\t\t\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(TelemetryEvent.Floodgate.UserFactsLoad.Failed, \"Failed to load from user facts provider\");\r\n\t\t\t\t\t\t\tsetUserFacts();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsetUserFacts();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t).catch(\r\n\t\t\t\tfunction OnRejected(error) {\r\n\t\t\t\t\t// this should never happen as Promise.all will always be resolved\r\n\t\t\t\t\t// because of hack at the top of the function.\r\n\t\t\t\t\tFloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed(\"Failed to load from campaign definition provider\");\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate loadAndFilterCampaignData(currentDate: Date, channelTypes: GovernedChannelType[]): void {\r\n\t\tcurrentDate = currentDate ? currentDate : new Date();\r\n\t\tlet loadedDefinitions: CampaignDefinition[] = [];\r\n\r\n\t\tfor (const index of Object.keys(this.definitionProviders)) {\r\n\t\t\ttry {\r\n\t\t\t\tconst definitions = this.definitionProviders[index] && this.definitionProviders[index].load();\r\n\t\t\t\tif (isArray(definitions)) {\r\n\t\t\t\t\t// If there are campaign defintions with duplicate campaign Id's\r\n\t\t\t\t\t// Floodgate will load the last one it found. FilterCampaignData does this filteration\r\n\t\t\t\t\tloadedDefinitions = loadedDefinitions.concat(definitions);\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\t// Log error, but continue with other providers\r\n\t\t\t\t// It should be the responsibility of provider to log detailed errors\r\n\t\t\t\tFloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed(\"Failed to load from campaign definition provider. \" + error.toString());\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Load the user facts before all the campaign definitions are evaluated\r\n\t\ttry {\r\n\t\t\tthis.userFacts = (this.userFactsProvider && this.userFactsProvider.load()) || [];\r\n\t\t} catch (error) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsLoad.Failed, \"Failed to load from user facts provider. \" + error);\r\n\t\t}\r\n\r\n\t\tthis.FilterCampaignData(currentDate, channelTypes, loadedDefinitions);\r\n\t}\r\n\r\n\t/**\r\n\t * Load and filter the campaigns definitions and states\r\n\t */\r\n\tprivate FilterCampaignData(currentDate: Date, channelTypes: GovernedChannelType[], loadedDefinitions: CampaignDefinition[]): void {\r\n\t\tconst loadedDefinitionsMap: IDictionary<CampaignDefinition> = {};\r\n\r\n\t\t// Load filtered campaign definitions\r\n\t\tfor (const key in loadedDefinitions) {\r\n\t\t\tif (loadedDefinitions.hasOwnProperty(key)) {\r\n\t\t\t\tconst definition: CampaignDefinition = loadedDefinitions[key];\r\n\r\n\t\t\t\tloadedDefinitionsMap[definition.campaignId] = definition;\r\n\r\n\t\t\t\tif (channelTypes &&\r\n\t\t\t\t\t(channelTypes.indexOf(definition.governedChannelType) < 0) &&\r\n\t\t\t\t\t(definition.businessLevel !== BusinessLevel.Critical)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!CampaignManager.isCampaignInScope(definition, currentDate, this.environmentProvider, this.userFactsProvider)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.campaignDefinitions[definition.campaignId] = definition;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Load campaign state, filtering out the expired definitions\r\n\t\tconst loadedStates: CampaignState[] = this.stateProvider.load();\r\n\t\tconst staleLoadedStates: CampaignState[] = [];\r\n\r\n\t\tfor (const key in loadedStates) {\r\n\t\t\tif (loadedStates.hasOwnProperty(key)) {\r\n\t\t\t\tconst state: CampaignState = loadedStates[key];\r\n\r\n\t\t\t\tif (!this.campaignDefinitions.hasOwnProperty(state.CampaignId)) {\r\n\t\t\t\t\tstaleLoadedStates.push(state);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.campaignStates[state.CampaignId] = state;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t * Stale State data cleanup\r\n\t\t * State needs to be cleaned up when:\r\n\t\t * 1) The campaign has expired\r\n\t\t * 2) The campaign is no longer present in the definitions (think ECS or other outages or very old expirations)\r\n\t\t *    In this case the state should still be cleaned up on it's reelection date\r\n\t\t * 3) When the user is out of scope (for an otherwise active campaign) and is up for nomination\r\n\r\n\t\t * This optimizes the user experience in case the campaign pops up or gets renewed when we would have preferred the user remain in cool down\r\n\r\n\t\t * 2&3 are basically the same, and 1 is a special case optimization on top of 2&3 for earlier clean up\r\n\r\n\t\t * To do 2 & 3, we just look at states with no matching definition (after filtering), and reject them if they are past their nomination period\r\n\t\t * To do 1, we just need to keep a list/hash of the definitions that we filtered out this load cycle, specifically for expiration dates, and bypass\r\n\t\t * the cool down \"wait\" for these specifically\r\n\r\n\t\t * For now, allowing some \"grace\" for \"missing\"/\"blippy\" campaign definitions (in case they pop in and out of ECS) by deferring missing\r\n\t\t * deletion by a delay-time specified by the original campaign.\r\n\t\t */\r\n\t\tfor (const key in staleLoadedStates) {\r\n\t\t\tif (staleLoadedStates.hasOwnProperty(key)) {\r\n\t\t\t\tconst state: CampaignState = staleLoadedStates[key];\r\n\t\t\t\tif (!state) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst definition: CampaignDefinition = loadedDefinitionsMap[state.CampaignId];\r\n\t\t\t\tlet shouldRemove = false;\r\n\r\n\t\t\t\tif (!definition) {\r\n\t\t\t\t\tif (state.LastNominationTimeUtc.getTime() <= Utils.subtractSecondsWithoutOverflow(currentDate, state.DeleteAfterSecondsWhenStale).getTime()) {\r\n\t\t\t\t\t\tshouldRemove = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (CampaignManager.isStateUpForNomination(state, definition, currentDate, this.currentBuildNumber)) {\r\n\t\t\t\t\tshouldRemove = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// The next time we write to storage, these will be removed\r\n\t\t\t\tif (shouldRemove) {\r\n\t\t\t\t\tdelete this.campaignStates[state.CampaignId];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Filter lower priority campaigns that are on same channel and have a matching tag\r\n\tprivate getPrioritizedCampaigns() {\r\n\t\tconst prioritizedCampaigns: IDictionary<CampaignDefinition> = {};\r\n\r\n\t\t// build <tagId_channel, campaign[]> map\r\n\t\tconst matchingTagCampaigns: IDictionary<CampaignDefinition[]> = {};\r\n\t\tObject.keys(this.campaignDefinitions || []).forEach((key) => {\r\n\t\t\tconst definition: CampaignDefinition = this.campaignDefinitions[key];\r\n\t\t\tprioritizedCampaigns[key] = definition;\r\n\r\n\t\t\t// if tags are not defined, use empty tag to fallback to channel level aggregation\r\n\t\t\tconst definitionTags = definition.tags && definition.tags.length > 0 ? definition.tags : [\"\"];\r\n\t\t\tdefinitionTags.forEach((tagId) => {\r\n\t\t\t\tconst mapKey = `${tagId}_${definition.governedChannelType}`;\r\n\t\t\t\tmatchingTagCampaigns[mapKey] = matchingTagCampaigns[mapKey] || [];\r\n\t\t\t\tmatchingTagCampaigns[mapKey].push(definition);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// remove lower priority campaigns\r\n\t\tObject.keys(matchingTagCampaigns).forEach((key) => {\r\n\t\t\tconst definitions = matchingTagCampaigns[key];\r\n\t\t\tif (definitions.length <= 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Get definition that has max priority value (0/null/undefined has highest prioirty)\r\n\t\t\tconst maxPriorityDefinition = definitions.reduce((prev, cur) => {\r\n\t\t\t\tconst curPriority = cur.primaryPriority || 0;\r\n\t\t\t\tconst prevPriority = prev.primaryPriority || 0;\r\n\r\n\t\t\t\treturn curPriority < prevPriority ? cur : prev;\r\n\t\t\t}, definitions[0]);\r\n\r\n\t\t\tconst maxPriority = maxPriorityDefinition.primaryPriority;\r\n\t\t\tif (isNOU(maxPriority)) {\r\n\t\t\t\t// nothing to filter because all priorities are null/undefined\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// delete lower priority campaigns while preserving all the matching higher priority items\r\n\t\t\tdefinitions.forEach((current) => {\r\n\t\t\t\tconst currentPriority = current.primaryPriority;\r\n\r\n\t\t\t\t// for mso compatability ignore campaigns without priority set so that they are always considered\r\n\t\t\t\tif (!isNOU(current.primaryPriority) && currentPriority > maxPriority) {\r\n\t\t\t\t\tdelete prioritizedCampaigns[current.campaignId];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn prioritizedCampaigns;\r\n\t}\r\n\r\n\t/**\r\n\t * Given the loaded campaign definitions and states from previous sessions, run anything up for nomination\r\n\t */\r\n\tprivate evaluateCampaigns(currentDate: Date): void {\r\n\t\t// Loop through campaigns definitions, and update their state if necessary\r\n\t\tcurrentDate = currentDate ? currentDate : new Date();\r\n\r\n\t\tfor (const key in this.campaignDefinitions) {\r\n\t\t\tif (this.campaignDefinitions.hasOwnProperty(key)) {\r\n\t\t\t\tconst definition: CampaignDefinition = this.campaignDefinitions[key];\r\n\t\t\t\tconst state: CampaignState = this.campaignStates[definition.campaignId];\r\n\r\n\t\t\t\tif (!state || CampaignManager.isStateUpForNomination(state, definition, currentDate, this.currentBuildNumber)) {\r\n\t\t\t\t\tlet lastSurveyId: string = state ? state.LastSurveyId : \"\";\r\n\t\t\t\t\tlet lastSurveyStartTime: Date = state ? state.LastSurveyStartTimeUtc : getDistantPast();\r\n\t\t\t\t\tlet lastSurveyExpirationTime: Date = state ? state.LastSurveyExpirationTimeUtc : getDistantPast();\r\n\t\t\t\t\tconst lastSurveyActivatedTime: Date = state ? state.LastSurveyActivatedTimeUtc : getDistantPast();\r\n\t\t\t\t\tconst lastCooldownEndTimeUtc: Date = state ? state.LastCooldownEndTimeUtc : getDistantPast();\r\n\r\n\t\t\t\t\t// Run the nomination\r\n\t\t\t\t\tconst isCandidate: boolean = (state && state.ForceCandidacy) || definition.nominationScheme.evaluateNominationRules();\r\n\t\t\t\t\tif (isCandidate) {\r\n\t\t\t\t\t\t// Make new survey properties for the next call to get the active surveys\r\n\t\t\t\t\t\tlastSurveyId = Utils.guid();\r\n\t\t\t\t\t\tlastSurveyStartTime = definition.nominationScheme.calculateSurveyStartTimeFromDate(currentDate);\r\n\t\t\t\t\t\tlastSurveyExpirationTime = definition.nominationScheme.calculateSurveyExpirationTimeFromSurveyStartTime(lastSurveyStartTime);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst newState: CampaignState = new CampaignState(\r\n\t\t\t\t\t\tdefinition.campaignId,\r\n\t\t\t\t\t\tcurrentDate,\r\n\t\t\t\t\t\tthis.currentBuildNumber,\r\n\t\t\t\t\t\tdefinition.nominationScheme.getActiveSurveyTimeIntervalSeconds(),\r\n\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\tisCandidate,\r\n\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\tlastSurveyActivatedTime,\r\n\t\t\t\t\t\tlastSurveyId,\r\n\t\t\t\t\t\tlastSurveyStartTime,\r\n\t\t\t\t\t\tlastSurveyExpirationTime,\r\n\t\t\t\t\t\tlastCooldownEndTimeUtc,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Save the new state to our local cache\r\n\t\t\t\t\tthis.campaignStates[newState.CampaignId] = newState;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import * as IFloodgateStringProvider from \"../Api/IFloodgateStringProvider\";\r\nimport * as ISurvey from \"../Api/ISurvey\";\r\nimport { GovernedChannelType } from \"../GovernedChannel\";\r\nimport * as ISurveyEvent from \"../ISurveyEvent\";\r\nimport * as ISurveyInfo from \"../ISurveyInfo\";\r\nimport { ISurveyMetadata } from \"../ISurveyMetadata\";\r\nimport {\r\n\tCountedActivityEvent, CountedActivityEventData, CountedActivitySequenceEvent, CountedActivitySequenceEventData,\r\n\tICountedActivityEvent, ICountedActivitySequenceEvent,\r\n} from \"../SurveyEvents\";\r\nimport { Metadata, SurveyMetadata } from \"../SurveyMetadata\";\r\nimport * as FpsSurvey from \"../Surveys/FpsSurvey\";\r\nimport * as GenericMessagingSurfaceSurvey from \"../Surveys/GenericMessagingSurfaceSurvey\";\r\nimport * as InterceptSurvey from \"../Surveys/InterceptSurvey\";\r\nimport * as NlqsSurvey from \"../Surveys/NlqsSurvey\";\r\nimport * as NpsSurvey from \"../Surveys/NpsSurvey\";\r\nimport * as SurveyDataSource from \"../Surveys/SurveyDataSource\";\r\nimport * as Utils from \"../Utils\";\r\nimport {\r\n\tCampaignDefinition,\r\n\tCampaignSurveyEvent, CampaignSurveyEventCountedActivity, CampaignSurveyEventCountedActivitySequence, CampaignSurveyMetadata,\r\n\tCampaignSurveyTemplate, CampaignSurveyTemplateFps, CampaignSurveyTemplateGenericMessagingSurface, CampaignSurveyTemplateIntercept,\r\n\tCampaignSurveyTemplateNlqs, CampaignSurveyTemplateNps, CampaignSurveyTemplateNps11PointStatic, CampaignSurveyTemplateNps5PointStatic,\r\n} from \"./CampaignDefinitionProvider\";\r\nimport { CampaignState } from \"./CampaignStateProvider\";\r\n\r\nconst { dateToShortUtcString, isNOU } = Utils;\r\n\r\n/**\r\n * Contains methods to take a campaign definition + state and generate an ISurvey\r\n */\r\nexport class CampaignSurveyFactory {\r\n\tpublic static makeSurvey(state: CampaignState, definition: CampaignDefinition, stringProvider: IFloodgateStringProvider): ISurvey {\r\n\t\tif (!state || !definition || !definition.surveyTemplate || !stringProvider) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst surveyDataSource = CampaignSurveyFactory.makeSurveyDataSourceData(state, definition);\r\n\t\tconst surveyModel = definition.surveyTemplate;\r\n\t\tif (surveyModel instanceof CampaignSurveyTemplateNps5PointStatic) {\r\n\t\t\treturn NpsSurvey.make5Point(surveyDataSource, stringProvider);\r\n\t\t} else if (surveyModel instanceof CampaignSurveyTemplateNps11PointStatic) {\r\n\t\t\treturn NpsSurvey.make11Point(surveyDataSource, stringProvider);\r\n\t\t} else if (surveyModel instanceof CampaignSurveyTemplateFps) {\r\n\t\t\treturn FpsSurvey.makeFps(surveyDataSource, stringProvider, surveyModel);\r\n\t\t} else if (surveyModel instanceof CampaignSurveyTemplateNlqs) {\r\n\t\t\treturn NlqsSurvey.makeNlqs(surveyDataSource, stringProvider, surveyModel);\r\n\t\t} else if (surveyModel instanceof CampaignSurveyTemplateNps) {\r\n\t\t\treturn NpsSurvey.makeCustom(surveyDataSource, stringProvider, surveyModel);\r\n\t\t} else if (surveyModel instanceof CampaignSurveyTemplateGenericMessagingSurface) {\r\n\t\t\treturn GenericMessagingSurfaceSurvey.makeCustom(surveyDataSource);\r\n\t\t} else if (surveyModel instanceof CampaignSurveyTemplateIntercept) {\r\n\t\t\treturn InterceptSurvey.makeIntercept(surveyDataSource, stringProvider, surveyModel);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static makeSurveyDataSourceData(state: CampaignState, definition: CampaignDefinition): SurveyDataSource.SurveyDataSourceData {\r\n\t\tif (!state || !definition || !definition.surveyTemplate) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst surveyModel = definition.surveyTemplate;\r\n\t\tconst surveyData = new SurveyDataSource.SurveyDataSourceData();\r\n\t\tsurveyData.activationEvent = CampaignSurveyFactory.makeEvent(state, surveyModel.activationEvent);\r\n\t\tsurveyData.metadata = CampaignSurveyFactory.makeMetadata(surveyModel.metadata);\r\n\t\tsurveyData.id = state.LastSurveyId;\r\n\t\tsurveyData.backEndIdentifier = state.CampaignId;\r\n\t\tsurveyData.expirationTimeUtc = dateToShortUtcString(state.LastSurveyExpirationTimeUtc);\r\n\t\tsurveyData.governedChannelType = definition.governedChannelType;\r\n\t\tsurveyData.startTimeUtc = dateToShortUtcString(state.LastSurveyStartTimeUtc);\r\n\t\tsurveyData.additionalDataRequested = definition.additionalDataRequested  || [];\r\n\t\tsurveyData.launcherType = definition.launcherType || ISurvey.LAUNCHER_TYPE_DEFAULT;\r\n\t\tsurveyData.preferredLaunchType = definition.surveyTemplate.preferredLaunchType || ISurveyInfo.LaunchType.Default;\r\n\t\tsurveyData.businessLevel = definition.businessLevel;\r\n\r\n\t\tif (!isNOU(surveyModel.maxLaunches)) {\r\n\t\t\tsurveyData.maxLaunches = surveyModel.maxLaunches;\r\n\t\t}\r\n\r\n\t\tif (!isNOU(surveyModel.maxLaunchesPerSession)) {\r\n\t\t\tsurveyData.maxLaunchesPerSession = surveyModel.maxLaunchesPerSession;\r\n\t\t}\r\n\r\n\t\treturn surveyData;\r\n\t}\r\n\r\n\tprivate static makeCountedActivityEventData(eventModel: CampaignSurveyEventCountedActivity): CountedActivityEventData {\r\n\t\tif (!eventModel) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst eventData = new CountedActivityEventData();\r\n\t\teventData.activity = eventModel.activity;\r\n\t\teventData.count = eventModel.count;\r\n\t\teventData.isAggregate = eventModel.isAggregate;\r\n\r\n\t\treturn eventData;\r\n\t}\r\n\r\n\tprivate static makeCountedActivityEvent(state: CampaignState, eventModel: CampaignSurveyEventCountedActivity): ICountedActivityEvent {\r\n\t\tif (!state || !eventModel) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst eventData: CountedActivityEventData = CampaignSurveyFactory.makeCountedActivityEventData(eventModel);\r\n\t\tif (!eventData) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn new CountedActivityEvent(eventData);\r\n\t}\r\n\r\n\tprivate static makeCountedActivitySequenceEvent(state: CampaignState,\r\n\t\teventModel: CampaignSurveyEventCountedActivitySequence): ICountedActivitySequenceEvent {\r\n\r\n\t\tif (!state || !eventModel) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst sequenceEventData = new CountedActivitySequenceEventData();\r\n\t\tsequenceEventData.sequence = [];\r\n\r\n\t\tfor (const event of eventModel.sequence) {\r\n\t\t\tconst eventData: CountedActivityEventData = CampaignSurveyFactory.makeCountedActivityEventData(event);\r\n\t\t\tif (!eventData) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tsequenceEventData.sequence.push(eventData);\r\n\t\t}\r\n\r\n\t\treturn new CountedActivitySequenceEvent(sequenceEventData);\r\n\t}\r\n\r\n\tprivate static makeEvent(state: CampaignState, eventModel: CampaignSurveyEvent): ISurveyEvent {\r\n\t\tif (eventModel instanceof CampaignSurveyEventCountedActivity) {\r\n\t\t\treturn CampaignSurveyFactory.makeCountedActivityEvent(state, eventModel as CampaignSurveyEventCountedActivity);\r\n\t\t} else if (eventModel instanceof CampaignSurveyEventCountedActivitySequence) {\r\n\t\t\treturn CampaignSurveyFactory.makeCountedActivitySequenceEvent(state, eventModel as CampaignSurveyEventCountedActivitySequence);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static makeMetadata(metadataModel: CampaignSurveyMetadata): ISurveyMetadata {\r\n\t\tif (isNOU(metadataModel) || isNOU(metadataModel.contentMetadata)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst metadata = new Metadata();\r\n\t\tmetadata.contentMetadata = metadataModel.contentMetadata;\r\n\r\n\t\treturn new SurveyMetadata(metadata);\r\n\t}\r\n}\r\n","import { ActivityTrackingData } from \"./ActivityTrackingData\";\r\nimport { ActivityTrackingSet } from \"./ActivityTrackingSet\";\r\nimport * as ISurveyEvent from \"./ISurveyEvent\";\r\n\r\n/**\r\n * A SurveyEvent that counts occurrences of a literal string logged by the product.\r\n * Survey is activated once the activity occurs Count times.\r\n */\r\nexport interface ICountedActivityEvent extends ISurveyEvent {\r\n\t/**\r\n\t * Name of the activity to listen for\r\n\t */\r\n\tgetActivity(): string;\r\n\r\n\t/**\r\n\t * Number of times the named activity must be logged to activate\r\n\t */\r\n\tgetCount(): number;\r\n\r\n\t/**\r\n\t * Whether or not the count should be persisted across app sessions\r\n\t */\r\n\tisAggregate(): boolean;\r\n}\r\n\r\nexport interface ICountedActivitySequenceEvent extends ISurveyEvent {\r\n\tgetSequence(): ICountedActivityEvent[];\r\n}\r\n\r\nexport class CountedActivityEvent implements ICountedActivityEvent {\r\n\tpublic static make(data: CountedActivityEventData): ICountedActivityEvent {\r\n\t\ttry {\r\n\t\t\treturn new CountedActivityEvent(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate data: CountedActivityEventData;\r\n\r\n\tpublic constructor(data: CountedActivityEventData) {\r\n\t\tif (!data) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\t\tif (data.count <= 0) {\r\n\t\t\tthrow new Error(\"count must be greater than 0\");\r\n\t\t}\r\n\t\tif (!data.activity || data.activity.length === 0) {\r\n\t\t\tthrow new Error(\"activity must not be null or an empty string\");\r\n\t\t}\r\n\r\n\t\tthis.data = data;\r\n\t}\r\n\r\n\tpublic getActivity(): string {\r\n\t\treturn this.data.activity;\r\n\t}\r\n\r\n\tpublic getCount(): number {\r\n\t\treturn this.data.count;\r\n\t}\r\n\r\n\tpublic isAggregate(): boolean {\r\n\t\treturn this.data.isAggregate;\r\n\t}\r\n\r\n\tpublic getType(): ISurveyEvent.Type {\r\n\t\treturn ISurveyEvent.Type.CountedActivity;\r\n\t}\r\n\r\n\tpublic getTrackingSet(): ActivityTrackingSet {\r\n\t\tconst trackingDataList = new Array<ActivityTrackingData>();\r\n\t\ttrackingDataList.push(new ActivityTrackingData(this.data.activity, this.data.count, this.data.isAggregate));\r\n\t\treturn new ActivityTrackingSet(false, trackingDataList);\r\n\t}\r\n}\r\n\r\n/**\r\n * Data class for serialization and deserialization. Do not add logic in here.\r\n */\r\nexport class CountedActivityEventData {\r\n\tpublic activity: string;\r\n\tpublic count: number;\r\n\tpublic isAggregate: boolean;\r\n}\r\n\r\nexport class CountedActivitySequenceEvent implements ICountedActivitySequenceEvent {\r\n\tpublic static make(data: CountedActivitySequenceEventData): ICountedActivitySequenceEvent {\r\n\t\ttry {\r\n\t\t\treturn new CountedActivitySequenceEvent(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate data: ICountedActivityEvent[];\r\n\r\n\tpublic constructor(data: CountedActivitySequenceEventData) {\r\n\t\tif (!data) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\t\tif (!data.sequence) {\r\n\t\t\tthrow new Error(\"data.sequence must not be null\");\r\n\t\t}\r\n\t\tif (data.sequence.length === 0) {\r\n\t\t\tthrow new Error(\"data.sequence size must be greater than 0\");\r\n\t\t}\r\n\r\n\t\tthis.data = [];\r\n\t\tfor (const countedActivityEventData of data.sequence) {\r\n\t\t\tthis.data.push(new CountedActivityEvent(countedActivityEventData));\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getSequence(): ICountedActivityEvent[] {\r\n\t\treturn this.data;\r\n\t}\r\n\r\n\tpublic getType(): ISurveyEvent.Type {\r\n\t\treturn ISurveyEvent.Type.CountedActivitySequence;\r\n\t}\r\n\r\n\tpublic getTrackingSet(): ActivityTrackingSet {\r\n\t\tconst trackingDataList = new Array<ActivityTrackingData>();\r\n\r\n\t\tfor (const countedActivityEvent of this.data) {\r\n\t\t\ttrackingDataList.push(new ActivityTrackingData(countedActivityEvent.getActivity(), countedActivityEvent.getCount(),\r\n\t\t\t\tcountedActivityEvent.isAggregate()));\r\n\t\t}\r\n\r\n\t\treturn new ActivityTrackingSet(true, trackingDataList);\r\n\t}\r\n}\r\n\r\n/**\r\n * Data class for serialization and deserialization. Do not add logic in here.\r\n */\r\nexport class CountedActivitySequenceEventData {\r\n\tpublic sequence: CountedActivityEventData[];\r\n\r\n\t/**\r\n\t * No args constructor needed for serialization.\r\n\t */\r\n\tpublic CountedActivitySequenceEventData() {\r\n\t}\r\n}\r\n","/**\r\n * Basic structure used to configure an ActivityTracker\r\n */\r\nexport class ActivityTrackingData {\r\n\tprivate activity: string;\r\n\tprivate count: number;\r\n\tprivate isAggregate: boolean;\r\n\r\n\tpublic constructor(activity: string, count: number, isAggregate: boolean) {\r\n\t\tthis.activity = activity;\r\n\t\tthis.count = count;\r\n\t\tthis.isAggregate = isAggregate;\r\n\t}\r\n\r\n\tpublic getActivity(): string {\r\n\t\treturn this.activity;\r\n\t}\r\n\r\n\tpublic getCount(): number {\r\n\t\treturn this.count;\r\n\t}\r\n\r\n\tpublic setCount(count: number): void {\r\n\t\tthis.count = count;\r\n\t}\r\n\r\n\tpublic getIsAggregate(): boolean {\r\n\t\treturn this.isAggregate;\r\n\t}\r\n}\r\n","import { ActivityTrackingData } from \"./ActivityTrackingData\";\r\nimport SurveyActivityListener = require(\"./SurveyActivityListener\");\r\nimport { isNOU } from \"./Utils\";\r\n\r\n/**\r\n * Class to hold a collection of Activity Tracking Data\r\n */\r\nexport class ActivityTrackingSet {\r\n\tprivate isOrdered: boolean;\r\n\tprivate list: ActivityTrackingData[];\r\n\r\n\tpublic constructor(isOrdered: boolean, list: ActivityTrackingData[]) {\r\n\t\tthis.isOrdered = isOrdered;\r\n\t\tthis.list = list;\r\n\t}\r\n\r\n\tpublic getIsOrdered(): boolean {\r\n\t\treturn this.isOrdered;\r\n\t}\r\n\r\n\tpublic getList(): ActivityTrackingData[] {\r\n\t\treturn this.list;\r\n\t}\r\n\r\n\t// returns a stringified json with the list and isOrdered info.\r\n\tpublic getActivityTrackingInfo(activityListener: SurveyActivityListener, surveyId: string): string {\r\n\r\n\t\tlet activitiesInfoObject: {\r\n\t\t\tActivities: Array<{ Activity: string, Count: number, IsAggregate: boolean }>,\r\n\t\t\tIsListOrdered: boolean,\r\n\t\t};\r\n\r\n\t\tif (this.list.length === 0) {\r\n\t\t\tactivitiesInfoObject = {\r\n\t\t\t\tActivities: [],\r\n\t\t\t\tIsListOrdered: this.isOrdered,\r\n\t\t\t};\r\n\r\n\t\t\treturn JSON.stringify(activitiesInfoObject);\r\n\t\t}\r\n\r\n\t\tfor (const trackingData of this.list) {\r\n\r\n\t\t\tconst actualCount = activityListener.getCount(trackingData.getActivity(), surveyId);\r\n\t\t\tconst tempActivities = {\r\n\t\t\t\t\t\tActivity: trackingData.getActivity(),\r\n\t\t\t\t\t\tActualCount: actualCount,\r\n\t\t\t\t\t\tCount: trackingData.getCount(),\r\n\t\t\t\t\t\tIsAggregate: trackingData.getIsAggregate(),\r\n\t\t\t\t\t\tIsDiscrete: actualCount % 1 === 0,\r\n\t\t\t\t\t};\r\n\r\n\t\t\tif (isNOU(activitiesInfoObject)) {\r\n\t\t\t\tactivitiesInfoObject = {\r\n\t\t\t\t\t\t\t\tActivities: [tempActivities],\r\n\t\t\t\t\t\t\t\tIsListOrdered: this.isOrdered,\r\n\t\t\t\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tactivitiesInfoObject.Activities.push(tempActivities);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn JSON.stringify(activitiesInfoObject);\r\n\t}\r\n}\r\n","import { ISurveyMetadata } from \"./ISurveyMetadata\";\r\nimport * as Utils from \"./Utils\";\r\n\r\nexport class SurveyMetadata implements ISurveyMetadata {\r\n\tpublic static make(data: Metadata): ISurveyMetadata {\r\n\t\ttry {\r\n\t\t\treturn new SurveyMetadata(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate data: Metadata;\r\n\r\n\tpublic constructor(data: Metadata) {\r\n\t\tif (!data) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\t\tif (!data.contentMetadata) {\r\n\t\t\tthrow new Error(\"content metadata must not be null\");\r\n\t\t}\r\n\t\tif (!Utils.isObject(data.contentMetadata)) {\r\n\t\t\tthrow new Error(\"content metadata must be of object type\");\r\n\t\t}\r\n\r\n\t\tthis.data = data;\r\n\t}\r\n\r\n\tpublic getContentMetadata(): object {\r\n\t\treturn this.data.contentMetadata;\r\n\t}\r\n}\r\n\r\n/**\r\n * Data class for serialization and deserialization. Do not add logic in here.\r\n */\r\nexport class Metadata {\r\n\tpublic contentMetadata: object;\r\n}\r\n","import * as IFloodgateStringProvider from \"../Api/IFloodgateStringProvider\";\r\nimport { IFpsSurvey } from \"../Api/IFpsSurvey\";\r\nimport * as ISurvey from \"../Api/ISurvey\";\r\nimport * as ISurveyComponent from \"../Api/ISurveyComponent\";\r\nimport { CampaignSurveyContent, CampaignSurveyTemplate } from \"../Campaign/CampaignDefinitionProvider\";\r\nimport * as ISurveyInfo from \"../ISurveyInfo\";\r\nimport * as CommentComponent from \"../SurveyComponents/CommentComponent\";\r\nimport * as CVSurveyComponent from \"../SurveyComponents/CVSurveyComponent\";\r\nimport * as MultipleChoiceComponent from \"../SurveyComponents/MultipleChoiceComponent\";\r\nimport * as PromptComponent from \"../SurveyComponents/PromptComponent\";\r\nimport * as RatingComponent from \"../SurveyComponents/RatingComponent\";\r\nimport * as Utils from \"../Utils\";\r\nimport { Survey } from \"./Survey\";\r\nimport * as SurveyDataSource from \"./SurveyDataSource\";\r\n\r\nconst { isNOU } = Utils;\r\n\r\nclass FpsSurvey extends Survey implements IFpsSurvey {\r\n\tpublic static make(data: FpsSurvey.FpsSurveyData): IFpsSurvey {\r\n\t\ttry {\r\n\t\t\treturn new FpsSurvey(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic static makeFps(baseData: SurveyDataSource.SurveyDataSourceData, sp: IFloodgateStringProvider,\r\n\t\tsurveyModel: CampaignSurveyTemplate): IFpsSurvey {\r\n\r\n\t\tif (isNOU(baseData) || isNOU(sp) || isNOU(surveyModel)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst ratingValuesAscending: string[] = [];\r\n\t\tconst availableOptions: string[] = [];\r\n\t\tconst content: CampaignSurveyContent = surveyModel.content;\r\n\r\n\t\t// Prompt is required and at least one of the other components are required\r\n\t\tif (isNOU(content) || isNOU(content.prompt) ||\r\n\t\t\t(isNOU(content.rating) && isNOU(content.multipleChoice) &&\r\n\t\t\tisNOU(content.comment))) {\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst data = new FpsSurvey.FpsSurveyData();\r\n\t\tdata.baseData = baseData;\r\n\t\tdata.promptData = new PromptComponent.PromptComponentData();\r\n\t\tdata.promptData.title = sp.getCustomString(content.prompt.title);\r\n\t\tdata.promptData.question = sp.getCustomString(content.prompt.question);\r\n\t\tdata.promptData.yesButtonLabel = sp.getCustomString(content.prompt.yesLabel);\r\n\t\tdata.promptData.noButtonLabel = sp.getCustomString(content.prompt.noLabel);\r\n\r\n\t\tif ( isNOU(data.promptData.title)\r\n\t\t\t|| isNOU(data.promptData.question)\r\n\t\t\t|| isNOU(data.promptData.yesButtonLabel)\r\n\t\t\t|| isNOU(data.promptData.noButtonLabel)) {\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif (content.rating) {\r\n\t\t\tdata.ratingData = new RatingComponent.RatingComponentData();\r\n\t\t\tdata.ratingData.question = sp.getCustomString(content.rating.question);\r\n\t\t\tdata.ratingData.isZeroBased = content.rating.isZeroBased;\r\n\r\n\t\t\tfor (const value of content.rating.ratingValuesAscending) {\r\n\t\t\t\tconst customString: string = sp.getCustomString(value);\r\n\r\n\t\t\t\tif (isNOU(customString)) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tratingValuesAscending.push(customString);\r\n\t\t\t}\r\n\r\n\t\t\tdata.ratingData.ratingValuesAscending = ratingValuesAscending;\r\n\r\n\t\t\tif (isNOU(data.ratingData.question)\r\n\t\t\t\t|| isNOU(data.ratingData.ratingValuesAscending)) {\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (content.multipleChoice) {\r\n\t\t\tdata.multipleChoiceData = new MultipleChoiceComponent.MultipleChoiceComponentData();\r\n\t\t\tdata.multipleChoiceData.question = sp.getCustomString(content.multipleChoice.question);\r\n\t\t\tdata.multipleChoiceData.minNumberOfSelectedOptions = content.multipleChoice.minNumberOfSelectedOptions;\r\n\t\t\tdata.multipleChoiceData.maxNumberOfSelectedOptions = content.multipleChoice.maxNumberOfSelectedOptions;\r\n\r\n\t\t\tfor (const value of content.multipleChoice.availableOptions) {\r\n\t\t\t\tconst customString: string = sp.getCustomString(value);\r\n\r\n\t\t\t\tif (isNOU(customString)) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tavailableOptions.push(customString);\r\n\t\t\t}\r\n\r\n\t\t\tdata.multipleChoiceData.availableOptions = availableOptions;\r\n\r\n\t\t\tif (isNOU(data.multipleChoiceData.question)\r\n\t\t\t\t|| isNOU(data.multipleChoiceData.availableOptions)) {\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (content.comment) {\r\n\t\t\tdata.commentData = new CommentComponent.CommentComponentData();\r\n\t\t\tdata.commentData.question = sp.getCustomString(content.comment.question);\r\n\r\n\t\t\tif (isNOU(data.commentData.question)) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// cvsurvey data is not required on all surveys.\r\n\t\tif (content.cvSurvey) {\r\n\t\t\tdata.cvSurveyData = new CVSurveyComponent.CVSurveyComponentData();\r\n\t\t\tdata.cvSurveyData.customerVoiceFormId =  content.cvSurvey.customerVoiceFormId;\r\n\r\n\t\t\tif (isNOU(data.cvSurveyData.customerVoiceFormId)) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.make(data);\r\n\t}\r\n\r\n\tprivate surveyInfo: SurveyDataSource;\r\n\tprivate question: CommentComponent;\r\n\tprivate prompt: PromptComponent;\r\n\tprivate rating: RatingComponent;\r\n\tprivate multipleChoice: MultipleChoiceComponent;\r\n\tprivate cvSurvey: CVSurveyComponent;\r\n\r\n\tprivate constructor(data: FpsSurvey.FpsSurveyData) {\r\n\t\tsuper();\r\n\t\tif (isNOU(data)) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.surveyInfo = new SurveyDataSource(data.baseData);\r\n\t\tthis.prompt = new PromptComponent(data.promptData);\r\n\t\tthis.question = data.commentData ? (new CommentComponent(data.commentData)) : null;\r\n\t\tthis.rating = data.ratingData ? (new RatingComponent(data.ratingData)) : null;\r\n\t\tthis.multipleChoice = data.multipleChoiceData ? (new MultipleChoiceComponent(data.multipleChoiceData)) : null;\r\n\t\tthis.cvSurvey = data.cvSurveyData ? (new CVSurveyComponent(data.cvSurveyData)) : null;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getType(): ISurvey.Type {\r\n\t\treturn ISurvey.Type.Fps;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getSurveyInfo(): ISurveyInfo {\r\n\t\treturn this.surveyInfo;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getCommentComponent(): CommentComponent {\r\n\t\treturn this.question;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getPromptComponent(): PromptComponent {\r\n\t\treturn this.prompt;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getRatingComponent(): RatingComponent {\r\n\t\treturn this.rating;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getMultipleChoiceComponent(): MultipleChoiceComponent {\r\n\t\treturn this.multipleChoice;\r\n\t}\r\n\r\n\tpublic getCVSurveyComponent(): CVSurveyComponent {\r\n\t\treturn this.cvSurvey;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getComponent(componentType: ISurveyComponent.Type): ISurveyComponent {\r\n\t\tswitch (componentType) {\r\n\t\t\tcase ISurveyComponent.Type.Comment:\r\n\t\t\t\treturn this.getCommentComponent();\r\n\t\t\tcase ISurveyComponent.Type.Prompt:\r\n\t\t\t\treturn this.getPromptComponent();\r\n\t\t\tcase ISurveyComponent.Type.Rating:\r\n\t\t\t\treturn this.getRatingComponent();\r\n\t\t\tcase ISurveyComponent.Type.MultipleChoice:\r\n\t\t\t\treturn this.getMultipleChoiceComponent();\r\n\t\t\tcase ISurveyComponent.Type.CVSurvey:\r\n\t\t\t\treturn this.getCVSurveyComponent();\r\n\t\t\tdefault:\r\n\t\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getDomElements(doc: Document): Element[] {\r\n\t\tif (isNOU(doc)) {\r\n\t\t\tthrow new Error(\"Document must not be null\");\r\n\t\t}\r\n\r\n\t\tconst element: Element = doc.createElement(ISurvey.DOM_FPS_TAGNAME);\r\n\r\n\t\tthis.getSurveyInfo().getDomElements(doc).forEach((child) => {\r\n\t\t\tif (!isNOU(child)) {\r\n\t\t\t\telement.appendChild(child);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.getCommentComponent().getDomElements(doc).forEach((child) => {\r\n\t\t\tif (!isNOU(child)) {\r\n\t\t\t\telement.appendChild(child);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (this.getRatingComponent()) {\r\n\t\t\tthis.getRatingComponent().getDomElements(doc).forEach((child) => {\r\n\t\t\t\tif (!isNOU(child)) {\r\n\t\t\t\t\telement.appendChild(child);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.getMultipleChoiceComponent()) {\r\n\t\t\tthis.getMultipleChoiceComponent().getDomElements(doc).forEach((child) => {\r\n\t\t\t\tif (!isNOU(child)) {\r\n\t\t\t\t\telement.appendChild(child);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn [element];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\tlet result: object = {};\r\n\r\n\t\tresult = Utils.overrideValues(this.getSurveyInfo().getJsonElements(), result);\r\n\t\tresult[ISurveyComponent.JSON_APPLICATION_KEYNAME] = {};\r\n\r\n\t\tresult[ISurveyComponent.JSON_APPLICATION_KEYNAME][ISurveyComponent.JSON_EXTENDEDMANIFESTDATA_KEYNAME] =\r\n\t\t\tJSON.stringify({\r\n\t\t\t\t[ISurveyComponent.JSON_SURVEYSTRINGS_KEYNAME]: this.makeSurveyStrings(),\r\n\t\t\t\t[ISurveyComponent.JSON_SURVEYSPECIFICDATA_KEYNAME]: this.makeResponseString(),\r\n\t\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// Makes the string to send to Manifest respecting the components present in the survey\r\n\tprivate makeResponseString(): string {\r\n\t\tconst response: object = {};\r\n\r\n\t\tif (this.question) {\r\n\t\t\tresponse[ISurveyComponent.JSON_COMMENT_KEYNAME] = [this.getCommentComponent().getSubmittedText()];\r\n\t\t}\r\n\r\n\t\tif (this.multipleChoice) {\r\n\t\t\tresponse[ISurveyComponent.JSON_MULTIPLECHOICE_KEYNAME] =\r\n\t\t\t\t[this.getMultipleChoiceComponent().getOptionSelectedStates()];\r\n\t\t}\r\n\r\n\t\tif (this.rating) {\r\n\t\t\tresponse[ISurveyComponent.JSON_RATING_KEYNAME] = [\r\n\t\t\t\t{numberOfOptions: this.getRatingComponent().getRatingValuesAscending().length,\r\n\t\t\tselectedRating: this.getRatingComponent().getSelectedRatingIndex() }];\r\n\t\t}\r\n\r\n\t\treturn JSON.stringify(response);\r\n\t}\r\n\r\n\t// Makes the string to send to Manifest respecting the components present in the survey\r\n\tprivate makeSurveyStrings(): string {\r\n\t\tconst actualStrings: object = {};\r\n\r\n\t\tif (this.prompt) {\r\n\t\t\tactualStrings[ISurveyComponent.JSON_PROMPT_KEYNAME] = this.prompt.getComponentJson();\r\n\t\t}\r\n\r\n\t\tif (this.rating) {\r\n\t\t\tactualStrings[ISurveyComponent.JSON_RATING_KEYNAME] = [this.rating.getComponentJson()];\r\n\t\t}\r\n\r\n\t\tif (this.question) {\r\n\t\t\tactualStrings[ISurveyComponent.JSON_COMMENT_KEYNAME] = [this.question.getComponentJson()];\r\n\t\t}\r\n\r\n\t\tif (this.multipleChoice) {\r\n\t\t\tactualStrings[ISurveyComponent.JSON_MULTIPLECHOICE_KEYNAME] = [this.multipleChoice.getComponentJson()];\r\n\t\t}\r\n\r\n\t\treturn JSON.stringify(actualStrings);\r\n\t}\r\n}\r\nmodule FpsSurvey {\r\n\t/**\r\n\t * Data required for a Fps Survey\r\n\t */\r\n\texport class FpsSurveyData {\r\n\t\tpublic baseData: SurveyDataSource.SurveyDataSourceData;\r\n\t\tpublic commentData: CommentComponent.CommentComponentData;\r\n\t\tpublic promptData: PromptComponent.PromptComponentData;\r\n\t\tpublic ratingData: RatingComponent.RatingComponentData;\r\n\t\tpublic multipleChoiceData: MultipleChoiceComponent.MultipleChoiceComponentData;\r\n\t\tpublic cvSurveyData: CVSurveyComponent.CVSurveyComponentData;\r\n\t}\r\n}\r\n\r\nexport = FpsSurvey;\r\n","import * as ISurveyComponent from \"../Api/ISurveyComponent\";\r\nimport { IMultipleChoiceComponent } from \"./../Api/IMultipleChoiceComponent\";\r\n\r\nclass MultipleChoiceComponent implements IMultipleChoiceComponent {\r\n\tpublic static make(data: MultipleChoiceComponent.MultipleChoiceComponentData): IMultipleChoiceComponent {\r\n\t\ttry {\r\n\t\t\treturn new MultipleChoiceComponent(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate data: MultipleChoiceComponent.MultipleChoiceComponentData;\r\n\tprivate optionStates: boolean[];\r\n\r\n\tpublic constructor(data: MultipleChoiceComponent.MultipleChoiceComponentData) {\r\n\t\tif (!data) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\t\tif (!data.question) {\r\n\t\t\tthrow new Error(\"data.question must not be null or empty\");\r\n\t\t}\r\n\t\tif (!data.availableOptions || data.availableOptions.length < 2) {\r\n\t\t\tthrow new Error(\"data.availableOptions must not be null or have less than two choices\");\r\n\t\t}\r\n\r\n\t\tdata.availableOptions.forEach((option) => {\r\n\t\t\tif (!option) {\r\n\t\t\t\tthrow new Error(\"Option values must not contain null or empty\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.data = data;\r\n\t\tthis.optionStates = new Array<boolean>(data.availableOptions.length);\r\n\t\t// Initialize with all false values\r\n\t\tfor (let i = 0; i < this.optionStates.length; i++) {\r\n\t\t\tthis.optionStates[i] = false;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getType(): ISurveyComponent.Type {\r\n\t\treturn ISurveyComponent.Type.MultipleChoice;\r\n\t}\r\n\r\n\tpublic getQuestion(): string {\r\n\t\treturn this.data.question;\r\n\t}\r\n\r\n\tpublic getAvailableOptions(): string[] {\r\n\t\treturn this.data.availableOptions;\r\n\t}\r\n\r\n\tpublic getOptionSelectedStates(): boolean[] {\r\n\t\treturn this.optionStates;\r\n\t}\r\n\r\n\tpublic getMinNumberofSelectedOptions(): number {\r\n\t\treturn this.data.minNumberOfSelectedOptions;\r\n\t}\r\n\r\n\tpublic getMaxNumberofSelectedOptions(): number {\r\n\t\treturn this.data.maxNumberOfSelectedOptions;\r\n\t}\r\n\r\n\tpublic setOptionSelectedStates(selectedStates: boolean[]): void {\r\n\t\tfor (let i = 0; i < selectedStates.length; i ++) {\r\n\t\t\tthis.optionStates[i] = selectedStates[i];\r\n\t\t}\r\n\t}\r\n\r\n\tpublic ValidateMinNumberofSelectedOptions(): boolean {\r\n\t\tlet result: number = 0;\r\n\t\tthis.optionStates.forEach((element) => {\r\n\t\t\tif (element) {\r\n\t\t\t\tresult++;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn (result >= this.getMinNumberofSelectedOptions());\r\n\t}\r\n\r\n\tpublic ValidateMaxNumberofSelectedOptions(): boolean {\r\n\t\tlet result: number = 0;\r\n\t\tthis.optionStates.forEach((element) => {\r\n\t\t\tif (element) {\r\n\t\t\t\tresult++;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn (result <= this.getMaxNumberofSelectedOptions());\r\n\t}\r\n\r\n\tpublic getDomElements(doc: Document): Element[] {\r\n\t\tif (!doc) {\r\n\t\t\tthrow new Error(\"Document must not be null\");\r\n\t\t}\r\n\r\n\t\tconst element: Element = doc.createElement(ISurveyComponent.DOM_MULTIPLECHOICE_TAGNAME);\r\n\r\n\t\telement.appendChild(doc.createTextNode(this.getOptionSelectedStates().toString()));\r\n\r\n\t\treturn [element];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\tconst result: object = {};\r\n\t\tresult[ISurveyComponent.JSON_MULTIPLECHOICE_KEYNAME] = this.getOptionSelectedStates().toString();\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getComponentJson(): object {\r\n\t\treturn {\r\n\t\t\t[ISurveyComponent.JSON_QUESTION_KEYNAME]: this.getQuestion(),\r\n\t\t\t[ISurveyComponent.JSON_RATINGOPTIONS_KEYNAME]: this.getAvailableOptions(),\r\n\t\t};\r\n\t}\r\n}\r\n\r\nmodule MultipleChoiceComponent {\r\n\texport class MultipleChoiceComponentData {\r\n\t\tpublic question: string;\r\n\t\tpublic availableOptions: string[];\r\n\t\tpublic minNumberOfSelectedOptions: number;\r\n\t\tpublic maxNumberOfSelectedOptions: number;\r\n\t}\r\n}\r\n\r\nexport = MultipleChoiceComponent;\r\n","import * as ISurvey from \"../Api/ISurvey\";\r\nimport * as ISurveyComponent from \"../Api/ISurveyComponent\";\r\nimport * as ISurveyInfo from \"../ISurveyInfo\";\r\nimport * as Utils from \"../Utils\";\r\nimport { Survey } from \"./Survey\";\r\nimport * as SurveyDataSource from \"./SurveyDataSource\";\r\n\r\nconst { isNOU } = Utils;\r\n\r\nclass GenericMessagingSurfaceSurvey extends Survey {\r\n\tpublic static make(data: GenericMessagingSurfaceSurvey.GenericMessagingSurfaceSurveyData): ISurvey {\r\n\t\ttry {\r\n\t\t\treturn new GenericMessagingSurfaceSurvey(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic static makeCustom(baseData: SurveyDataSource.SurveyDataSourceData): ISurvey {\r\n\t\tif (isNOU(baseData)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst data = new GenericMessagingSurfaceSurvey.GenericMessagingSurfaceSurveyData();\r\n\t\tdata.baseData = baseData;\r\n\r\n\t\treturn this.make(data);\r\n\t}\r\n\r\n\tprivate surveyInfo: SurveyDataSource;\r\n\r\n\tprivate constructor(data: GenericMessagingSurfaceSurvey.GenericMessagingSurfaceSurveyData) {\r\n\t\tsuper();\r\n\t\tif (!data) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.surveyInfo = new SurveyDataSource(data.baseData);\r\n\r\n\t\t// This check cannot be done in survey info constructor\r\n\t\t// as metadata is specific to this survey type.\r\n\t\tif (isNOU(this.surveyInfo.getMetadata())) {\r\n\t\t\tthrow new Error(\"metadata must not be null\");\r\n\t\t}\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getType(): ISurvey.Type {\r\n\t\treturn ISurvey.Type.GenericMessagingSurface;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getSurveyInfo(): ISurveyInfo {\r\n\t\treturn this.surveyInfo;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getComponent(componentType: ISurveyComponent.Type): ISurveyComponent {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getDomElements(doc: Document): Element[] {\r\n\t\treturn [];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\treturn {};\r\n\t}\r\n}\r\n\r\nmodule GenericMessagingSurfaceSurvey {\r\n\t/**\r\n\t * Data required for a Generic Surface Survey\r\n\t */\r\n\texport class GenericMessagingSurfaceSurveyData {\r\n\t\tpublic baseData: SurveyDataSource.SurveyDataSourceData;\r\n\t}\r\n}\r\n\r\nexport = GenericMessagingSurfaceSurvey;\r\n","import * as IFloodgateStringProvider from \"../Api/IFloodgateStringProvider\";\r\nimport { IInterceptSurvey } from \"../Api/IInterceptSurvey\";\r\nimport * as ISurvey from \"../Api/ISurvey\";\r\nimport * as ISurveyComponent from \"../Api/ISurveyComponent\";\r\nimport { CampaignSurveyContent, CampaignSurveyTemplate } from \"../Campaign/CampaignDefinitionProvider\";\r\nimport * as ISurveyInfo from \"../ISurveyInfo\";\r\nimport * as InterceptComponent from \"../SurveyComponents/InterceptComponent\";\r\nimport * as Utils from \"../Utils\";\r\nimport { Survey } from \"./Survey\";\r\nimport * as SurveyDataSource from \"./SurveyDataSource\";\r\n\r\nconst { isNOU } = Utils;\r\n\r\nclass InterceptSurvey extends Survey implements IInterceptSurvey {\r\n\tpublic static make(data: InterceptSurvey.InterceptSurveyData): IInterceptSurvey {\r\n\t\ttry {\r\n\t\t\treturn new InterceptSurvey(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic static makeIntercept(baseData: SurveyDataSource.SurveyDataSourceData, sp: IFloodgateStringProvider,\r\n\t\tsurveyModel: CampaignSurveyTemplate): IInterceptSurvey {\r\n\r\n\t\tif (isNOU(baseData) || isNOU(sp) || isNOU(surveyModel)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst content: CampaignSurveyContent = surveyModel.content;\r\n\r\n\t\t// Intercept component is required.\r\n\t\tif (isNOU(content) || isNOU(content.intercept)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst data = new InterceptSurvey.InterceptSurveyData();\r\n\t\tdata.baseData = baseData;\r\n\r\n\t\tdata.interceptData = new InterceptComponent.InterceptComponentData();\r\n\r\n\t\tdata.interceptData.title = sp.getCustomString(content.intercept.title);\r\n\t\tdata.interceptData.question = sp.getCustomString(content.intercept.question);\r\n\t\tdata.interceptData.url = sp.getCustomString(content.intercept.url);\r\n\r\n\t\tif ( isNOU(data.interceptData.title)\r\n\t\t\t|| isNOU(data.interceptData.question)\r\n\t\t\t|| isNOU(data.interceptData.url)) {\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn this.make(data);\r\n\t}\r\n\r\n\tprivate surveyInfo: SurveyDataSource;\r\n\tprivate intercept: InterceptComponent;\r\n\r\n\tprivate constructor(data: InterceptSurvey.InterceptSurveyData) {\r\n\t\tsuper();\r\n\t\tif (isNOU(data)) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.surveyInfo = new SurveyDataSource(data.baseData);\r\n\t\tthis.intercept = new InterceptComponent(data.interceptData);\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getType(): ISurvey.Type {\r\n\t\treturn ISurvey.Type.Intercept;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getSurveyInfo(): ISurveyInfo {\r\n\t\treturn this.surveyInfo;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getInterceptComponent(): InterceptComponent {\r\n\t\treturn this.intercept;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getComponent(componentType: ISurveyComponent.Type): ISurveyComponent {\r\n\t\treturn (componentType === ISurveyComponent.Type.Intercept) ? this.getInterceptComponent() : null;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getDomElements(doc: Document): Element[] {\r\n\t\treturn [];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\treturn {};\r\n\t}\r\n}\r\nmodule InterceptSurvey {\r\n\t/**\r\n\t * Data required for an Intercept Survey\r\n\t */\r\n\texport class InterceptSurveyData {\r\n\t\tpublic baseData: SurveyDataSource.SurveyDataSourceData;\r\n\t\tpublic interceptData: InterceptComponent.InterceptComponentData;\r\n\t}\r\n}\r\n\r\nexport = InterceptSurvey;\r\n","import * as ISurveyComponent from \"../Api/ISurveyComponent\";\r\nimport { IInterceptComponent } from \"./../Api/IInterceptComponent\";\r\n\r\nclass InterceptComponent implements IInterceptComponent {\r\n\tpublic static make(data: InterceptComponent.InterceptComponentData): IInterceptComponent {\r\n\t\ttry {\r\n\t\t\treturn new InterceptComponent(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate data: InterceptComponent.InterceptComponentData;\r\n\r\n\tpublic constructor(data: InterceptComponent.InterceptComponentData) {\r\n\t\tif (!data) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\t\tif (!data.question) {\r\n\t\t\tthrow new Error(\"data.question must not be null or empty\");\r\n\t\t}\r\n\t\tif (!data.title) {\r\n\t\t\tthrow new Error(\"data.title must not be null or empty\");\r\n\t\t}\r\n\t\tif (!data.url) {\r\n\t\t\tthrow new Error(\"data.url must not be null or empty\");\r\n\t\t}\r\n\r\n\t\tthis.data = data;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getType(): ISurveyComponent.Type {\r\n\t\treturn ISurveyComponent.Type.Intercept;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getTitle(): string {\r\n\t\treturn this.data.title;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getQuestion(): string {\r\n\t\treturn this.data.question;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getUrl(): string {\r\n\t\treturn this.data.url;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getDomElements(doc: Document): Element[]  {\r\n\t\tif (!doc) {\r\n\t\t\tthrow new Error(\"Document must not be null\");\r\n\t\t}\r\n\t\treturn [doc.createElement(ISurveyComponent.DOM_INTERCEPT_TAGNAME)];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\treturn {[ISurveyComponent.JSON_INTERCEPT_KEYNAME]: \"\"};\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getComponentJson(): object {\r\n\t\treturn {\r\n\t\t\t[ISurveyComponent.JSON_TITLE_KEYNAME]: this.getTitle(),\r\n\t\t\t[ISurveyComponent.JSON_QUESTION_KEYNAME]: this.getQuestion(),\r\n\t\t\t[ISurveyComponent.JSON_INTERCEPTURL_KEYNAME]: this.getUrl(),\r\n\t\t};\r\n\t}\r\n}\r\n\r\nmodule InterceptComponent {\r\n\texport class InterceptComponentData {\r\n\t\tpublic question: string;\r\n\t\tpublic title: string;\r\n\t\tpublic url: string;\r\n\t}\r\n}\r\n\r\nexport = InterceptComponent;\r\n","import * as IFloodgateStringProvider from \"../Api/IFloodgateStringProvider\";\r\nimport { INlqsSurvey } from \"../Api/INlqsSurvey\";\r\nimport * as ISurvey from \"../Api/ISurvey\";\r\nimport * as ISurveyComponent from \"../Api/ISurveyComponent\";\r\nimport { CampaignSurveyContent, CampaignSurveyTemplate } from \"../Campaign/CampaignDefinitionProvider\";\r\nimport * as ISurveyInfo from \"../ISurveyInfo\";\r\nimport * as CommentComponent from \"../SurveyComponents/CommentComponent\";\r\nimport * as PromptComponent from \"../SurveyComponents/PromptComponent\";\r\nimport * as RatingComponent from \"../SurveyComponents/RatingComponent\";\r\nimport * as Utils from \"../Utils\";\r\nimport { Survey } from \"./Survey\";\r\nimport * as SurveyDataSource from \"./SurveyDataSource\";\r\n\r\nconst { isNOU, overrideValues } = Utils;\r\n\r\nclass NlqsSurvey extends Survey implements INlqsSurvey {\r\n\tpublic static make(data: NlqsSurvey.NlqsSurveyData): INlqsSurvey {\r\n\t\ttry {\r\n\t\t\treturn new NlqsSurvey(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic static makeNlqs(baseData: SurveyDataSource.SurveyDataSourceData, sp: IFloodgateStringProvider,\r\n\t\tsurveyModel: CampaignSurveyTemplate): INlqsSurvey {\r\n\r\n\t\tif (isNOU(baseData) || isNOU(sp) || isNOU(surveyModel)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst ratingValuesAscending: string[] = [];\r\n\t\tconst content: CampaignSurveyContent = surveyModel.content;\r\n\r\n\t\tif (isNOU(content) || isNOU(content.comment)\r\n\t\t\t|| isNOU(content.prompt) || isNOU(content.rating)) {\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst data = new NlqsSurvey.NlqsSurveyData();\r\n\t\tdata.baseData = baseData;\r\n\t\tdata.promptData = new PromptComponent.PromptComponentData();\r\n\t\tdata.ratingData = new RatingComponent.RatingComponentData();\r\n\t\tdata.commentData = new CommentComponent.CommentComponentData();\r\n\r\n\t\tdata.promptData.title = sp.getCustomString(content.prompt.title);\r\n\t\tdata.promptData.question = sp.getCustomString(content.prompt.question);\r\n\t\tdata.promptData.yesButtonLabel = sp.getCustomString(content.prompt.yesLabel);\r\n\t\tdata.promptData.noButtonLabel = sp.getCustomString(content.prompt.noLabel);\r\n\t\tdata.ratingData.question = sp.getCustomString(content.rating.question);\r\n\t\tdata.ratingData.isZeroBased = content.rating.isZeroBased;\r\n\t\tdata.commentData.question = sp.getCustomString(content.comment.question);\r\n\r\n\t\tfor (const value of content.rating.ratingValuesAscending) {\r\n\t\t\tconst customString: string = sp.getCustomString(value);\r\n\r\n\t\t\tif (isNOU(customString)) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tratingValuesAscending.push(customString);\r\n\t\t}\r\n\r\n\t\tdata.ratingData.ratingValuesAscending = ratingValuesAscending;\r\n\r\n\t\tif (isNOU(data.ratingData.question)\r\n\t\t\t|| isNOU(data.commentData.question)\r\n\t\t\t|| isNOU(data.promptData.title)\r\n\t\t\t|| isNOU(data.promptData.question)\r\n\t\t\t|| isNOU(data.promptData.yesButtonLabel)\r\n\t\t\t|| isNOU(data.promptData.noButtonLabel)\r\n\t\t\t|| isNOU(data.ratingData.ratingValuesAscending)) {\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn this.make(data);\r\n\t}\r\n\r\n\tprivate surveyInfo: SurveyDataSource;\r\n\tprivate question: CommentComponent;\r\n\tprivate prompt: PromptComponent;\r\n\tprivate rating: RatingComponent;\r\n\r\n\tprivate constructor(data: NlqsSurvey.NlqsSurveyData) {\r\n\t\tsuper();\r\n\t\tif (isNOU(data)) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.surveyInfo = new SurveyDataSource(data.baseData);\r\n\t\tthis.prompt = new PromptComponent(data.promptData);\r\n\t\tthis.question = new CommentComponent(data.commentData);\r\n\t\tthis.rating = new RatingComponent(data.ratingData);\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getType(): ISurvey.Type {\r\n\t\treturn ISurvey.Type.Nlqs;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getSurveyInfo(): ISurveyInfo {\r\n\t\treturn this.surveyInfo;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getCommentComponent(): CommentComponent {\r\n\t\treturn this.question;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getPromptComponent(): PromptComponent {\r\n\t\treturn this.prompt;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getRatingComponent(): RatingComponent {\r\n\t\treturn this.rating;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getComponent(componentType: ISurveyComponent.Type): ISurveyComponent {\r\n\t\tswitch (componentType) {\r\n\t\t\tcase ISurveyComponent.Type.Comment:\r\n\t\t\t\treturn this.getCommentComponent();\r\n\t\t\tcase ISurveyComponent.Type.Prompt:\r\n\t\t\t\treturn this.getPromptComponent();\r\n\t\t\tcase ISurveyComponent.Type.Rating:\r\n\t\t\t\treturn this.getRatingComponent();\r\n\t\t\tdefault:\r\n\t\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getDomElements(doc: Document): Element[] {\r\n\t\tif (isNOU(doc)) {\r\n\t\t\tthrow new Error(\"Document must not be null\");\r\n\t\t}\r\n\r\n\t\tconst element: Element = doc.createElement(ISurvey.DOM_NLQS_TAGNAME);\r\n\r\n\t\tthis.getSurveyInfo().getDomElements(doc).forEach((child) => {\r\n\t\t\tif (!isNOU(child)) {\r\n\t\t\t\telement.appendChild(child);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.getCommentComponent().getDomElements(doc).forEach((child) => {\r\n\t\t\tif (!isNOU(child)) {\r\n\t\t\t\telement.appendChild(child);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.getRatingComponent().getDomElements(doc).forEach((child) => {\r\n\t\t\tif (!isNOU(child)) {\r\n\t\t\t\telement.appendChild(child);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn [element];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\tlet result: object = {};\r\n\r\n\t\tresult = overrideValues(this.getSurveyInfo().getJsonElements(), result);\r\n\t\tresult = overrideValues(this.getCommentComponent().getJsonElements(), result);\r\n\t\tresult = overrideValues(this.getRatingComponent().getJsonElements(), result);\r\n\r\n\t\treturn result;\r\n\t}\r\n}\r\n\r\nmodule NlqsSurvey {\r\n\t/**\r\n\t * Data required for a Nlqs Survey\r\n\t */\r\n\texport class NlqsSurveyData {\r\n\t\tpublic baseData: SurveyDataSource.SurveyDataSourceData;\r\n\t\tpublic commentData: CommentComponent.CommentComponentData;\r\n\t\tpublic promptData: PromptComponent.PromptComponentData;\r\n\t\tpublic ratingData: RatingComponent.RatingComponentData;\r\n\t}\r\n}\r\n\r\nexport = NlqsSurvey;\r\n","import * as IFloodgateStringProvider from \"../Api/IFloodgateStringProvider\";\r\nimport { INpsSurvey } from \"../Api/INpsSurvey\";\r\nimport * as ISurvey from \"../Api/ISurvey\";\r\nimport * as ISurveyComponent from \"../Api/ISurveyComponent\";\r\nimport { CampaignSurveyContent, CampaignSurveyTemplate } from \"../Campaign/CampaignDefinitionProvider\";\r\nimport * as ISurveyInfo from \"../ISurveyInfo\";\r\nimport * as CommentComponent from \"../SurveyComponents/CommentComponent\";\r\nimport * as CVSurveyComponent from \"../SurveyComponents/CVSurveyComponent\";\r\nimport * as PromptComponent from \"../SurveyComponents/PromptComponent\";\r\nimport * as RatingComponent from \"../SurveyComponents/RatingComponent\";\r\nimport * as Utils from \"../Utils\";\r\nimport { Survey } from \"./Survey\";\r\nimport * as SurveyDataSource from \"./SurveyDataSource\";\r\n\r\nconst { isNOU, overrideValues } = Utils;\r\n\r\nclass NpsSurvey extends Survey implements INpsSurvey {\r\n\tpublic static make(data: NpsSurvey.NpsSurveyData): INpsSurvey {\r\n\t\ttry {\r\n\t\t\treturn new NpsSurvey(data);\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic static makeCustom(baseData: SurveyDataSource.SurveyDataSourceData, sp: IFloodgateStringProvider,\r\n\t\tsurveyModel: CampaignSurveyTemplate): INpsSurvey {\r\n\r\n\t\tif (isNOU(baseData) || isNOU(sp) || isNOU(surveyModel)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst ratingValuesAscending: string[] = [];\r\n\t\tconst content: CampaignSurveyContent = surveyModel.content;\r\n\r\n\t\tif (isNOU(content) || isNOU(content.comment)\r\n\t\t\t|| isNOU(content.prompt) || isNOU(content.rating)) {\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst data = new NpsSurvey.NpsSurveyData();\r\n\t\tdata.baseData = baseData;\r\n\t\tdata.promptData = new PromptComponent.PromptComponentData();\r\n\t\tdata.ratingData = new RatingComponent.RatingComponentData();\r\n\t\tdata.commentData = new CommentComponent.CommentComponentData();\r\n\r\n\t\tdata.promptData.title = sp.getCustomString(content.prompt.title);\r\n\t\tdata.promptData.question = sp.getCustomString(content.prompt.question);\r\n\t\tdata.promptData.yesButtonLabel = sp.getCustomString(content.prompt.yesLabel);\r\n\t\tdata.promptData.noButtonLabel = sp.getCustomString(content.prompt.noLabel);\r\n\t\tdata.ratingData.question = sp.getCustomString(content.rating.question);\r\n\t\tdata.ratingData.isZeroBased = content.rating.isZeroBased;\r\n\t\tdata.commentData.question = sp.getCustomString(content.comment.question);\r\n\r\n\t\tfor (const value of content.rating.ratingValuesAscending) {\r\n\t\t\tconst customString: string = sp.getCustomString(value);\r\n\r\n\t\t\tif (isNOU(customString)) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tratingValuesAscending.push(customString);\r\n\t\t}\r\n\r\n\t\tdata.ratingData.ratingValuesAscending = ratingValuesAscending;\r\n\r\n\t\tif (isNOU(data.ratingData.question)\r\n\t\t\t|| isNOU(data.commentData.question)\r\n\t\t\t|| isNOU(data.promptData.title)\r\n\t\t\t|| isNOU(data.promptData.question)\r\n\t\t\t|| isNOU(data.promptData.yesButtonLabel)\r\n\t\t\t|| isNOU(data.promptData.noButtonLabel)\r\n\t\t\t|| isNOU(data.ratingData.ratingValuesAscending)) {\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// cvsurvey data is not required on all surveys.\r\n\t\tif (content.cvSurvey) {\r\n\t\t\tdata.cvSurveyData = new CVSurveyComponent.CVSurveyComponentData();\r\n\t\t\tdata.cvSurveyData.customerVoiceFormId =  content.cvSurvey.customerVoiceFormId;\r\n\r\n\t\t\tif (isNOU(data.cvSurveyData.customerVoiceFormId)) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.make(data);\r\n\t}\r\n\r\n\tpublic static make5Point(baseData: SurveyDataSource.SurveyDataSourceData, sp: IFloodgateStringProvider): INpsSurvey {\r\n\t\tif (!baseData || !sp) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst data = new NpsSurvey.NpsSurveyData();\r\n\t\tdata.baseData = baseData;\r\n\t\tdata.ratingData = new RatingComponent.RatingComponentData();\r\n\t\tdata.ratingData.isZeroBased = false;\r\n\t\tdata.commentData = new CommentComponent.CommentComponentData();\r\n\t\tdata.promptData = new PromptComponent.PromptComponentData();\r\n\t\tdata.ratingData.question = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsRatingQuestion);\r\n\t\tdata.commentData.question = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsCommentQuestion);\r\n\t\tdata.promptData.title = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsPromptTitle);\r\n\t\tdata.promptData.question = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsPromptQuestion);\r\n\t\tdata.promptData.yesButtonLabel = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsPromptYesLabel);\r\n\t\tdata.promptData.noButtonLabel = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsPromptNotNowLabel);\r\n\t\tconst ratingValuesAscending: string[] = new Array(5);\r\n\t\tratingValuesAscending[0] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps5RatingValue1);\r\n\t\tratingValuesAscending[1] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps5RatingValue2);\r\n\t\tratingValuesAscending[2] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps5RatingValue3);\r\n\t\tratingValuesAscending[3] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps5RatingValue4);\r\n\t\tratingValuesAscending[4] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps5RatingValue5);\r\n\r\n\t\tif (!data.ratingData.question\r\n\t\t\t|| !data.commentData.question\r\n\t\t\t|| !data.promptData.title\r\n\t\t\t|| !data.promptData.question\r\n\t\t\t|| !data.promptData.yesButtonLabel\r\n\t\t\t|| !data.promptData.noButtonLabel\r\n\t\t\t|| !ratingValuesAscending[0]\r\n\t\t\t|| !ratingValuesAscending[1]\r\n\t\t\t|| !ratingValuesAscending[2]\r\n\t\t\t|| !ratingValuesAscending[3]\r\n\t\t\t|| !ratingValuesAscending[4]) {\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tdata.ratingData.ratingValuesAscending = ratingValuesAscending;\r\n\t\treturn this.make(data);\r\n\t}\r\n\r\n\tpublic static make11Point(baseData: SurveyDataSource.SurveyDataSourceData, sp: IFloodgateStringProvider): INpsSurvey {\r\n\t\tif (!baseData || !sp) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst data = new NpsSurvey.NpsSurveyData();\r\n\t\tdata.baseData = baseData;\r\n\t\tdata.ratingData = new RatingComponent.RatingComponentData();\r\n\t\tdata.ratingData.isZeroBased = true;\r\n\t\tdata.commentData = new CommentComponent.CommentComponentData();\r\n\t\tdata.promptData = new PromptComponent.PromptComponentData();\r\n\t\tdata.ratingData.question = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsRatingQuestion);\r\n\t\tdata.commentData.question = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsCommentQuestion);\r\n\t\tdata.promptData.title = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsPromptTitle);\r\n\t\tdata.promptData.question = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsPromptQuestion);\r\n\t\tdata.promptData.yesButtonLabel = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsPromptYesLabel);\r\n\t\tdata.promptData.noButtonLabel = sp.loadStringResource(IFloodgateStringProvider.StringType.NpsPromptNotNowLabel);\r\n\r\n\t\tconst ratingValuesAscending: string[] = new Array(11);\r\n\t\tratingValuesAscending[0] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps11RatingValue0);\r\n\t\tratingValuesAscending[1] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps11RatingValue1);\r\n\t\tratingValuesAscending[2] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps11RatingValue2);\r\n\t\tratingValuesAscending[3] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps11RatingValue3);\r\n\t\tratingValuesAscending[4] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps11RatingValue4);\r\n\t\tratingValuesAscending[5] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps11RatingValue5);\r\n\t\tratingValuesAscending[6] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps11RatingValue6);\r\n\t\tratingValuesAscending[7] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps11RatingValue7);\r\n\t\tratingValuesAscending[8] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps11RatingValue8);\r\n\t\tratingValuesAscending[9] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps11RatingValue9);\r\n\t\tratingValuesAscending[10] = sp.loadStringResource(IFloodgateStringProvider.StringType.Nps11RatingValue10);\r\n\r\n\t\tif (!data.ratingData.question\r\n\t\t\t|| !data.commentData.question\r\n\t\t\t|| !data.promptData.title\r\n\t\t\t|| !data.promptData.question\r\n\t\t\t|| !data.promptData.yesButtonLabel\r\n\t\t\t|| !data.promptData.noButtonLabel\r\n\t\t\t|| !ratingValuesAscending[0]\r\n\t\t\t|| !ratingValuesAscending[1]\r\n\t\t\t|| !ratingValuesAscending[2]\r\n\t\t\t|| !ratingValuesAscending[3]\r\n\t\t\t|| !ratingValuesAscending[4]\r\n\t\t\t|| !ratingValuesAscending[5]\r\n\t\t\t|| !ratingValuesAscending[6]\r\n\t\t\t|| !ratingValuesAscending[7]\r\n\t\t\t|| !ratingValuesAscending[8]\r\n\t\t\t|| !ratingValuesAscending[9]\r\n\t\t\t|| !ratingValuesAscending[10]) {\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tdata.ratingData.ratingValuesAscending = ratingValuesAscending;\r\n\t\treturn this.make(data);\r\n\t}\r\n\r\n\tprivate surveyInfo: SurveyDataSource;\r\n\tprivate question: CommentComponent;\r\n\tprivate prompt: PromptComponent;\r\n\tprivate rating: RatingComponent;\r\n\tprivate cvSurvey: CVSurveyComponent;\r\n\r\n\tprivate constructor(data: NpsSurvey.NpsSurveyData) {\r\n\t\tsuper();\r\n\t\tif (!data) {\r\n\t\t\tthrow new Error(\"data must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.surveyInfo = new SurveyDataSource(data.baseData);\r\n\t\tthis.prompt = new PromptComponent(data.promptData);\r\n\t\tthis.question = new CommentComponent(data.commentData);\r\n\t\tthis.rating = new RatingComponent(data.ratingData);\r\n\t\tthis.cvSurvey = data.cvSurveyData ? (new CVSurveyComponent(data.cvSurveyData)) : null;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getType(): ISurvey.Type {\r\n\t\treturn ISurvey.Type.Nps;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getSurveyInfo(): ISurveyInfo {\r\n\t\treturn this.surveyInfo;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getCommentComponent(): CommentComponent {\r\n\t\treturn this.question;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getPromptComponent(): PromptComponent {\r\n\t\treturn this.prompt;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getRatingComponent(): RatingComponent {\r\n\t\treturn this.rating;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getCVSurveyComponent(): CVSurveyComponent {\r\n\t\treturn this.cvSurvey;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getComponent(componentType: ISurveyComponent.Type): ISurveyComponent {\r\n\t\tswitch (componentType) {\r\n\t\t\tcase ISurveyComponent.Type.Comment:\r\n\t\t\t\treturn this.getCommentComponent();\r\n\t\t\tcase ISurveyComponent.Type.Prompt:\r\n\t\t\t\treturn this.getPromptComponent();\r\n\t\t\tcase ISurveyComponent.Type.Rating:\r\n\t\t\t\treturn this.getRatingComponent();\r\n\t\t\tcase ISurveyComponent.Type.CVSurvey:\r\n\t\t\t\treturn this.getCVSurveyComponent();\r\n\t\t\tdefault:\r\n\t\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getDomElements(doc: Document): Element[] {\r\n\t\tif (!doc) {\r\n\t\t\tthrow new Error(\"Document must not be null\");\r\n\t\t}\r\n\r\n\t\tconst element: Element = doc.createElement(ISurvey.DOM_NPS_TAGNAME);\r\n\r\n\t\tthis.getSurveyInfo().getDomElements(doc).forEach((child) => {\r\n\t\t\tif (child) {\r\n\t\t\t\telement.appendChild(child);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.getCommentComponent().getDomElements(doc).forEach((child) => {\r\n\t\t\tif (child) {\r\n\t\t\t\telement.appendChild(child);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.getRatingComponent().getDomElements(doc).forEach((child) => {\r\n\t\t\tif (child) {\r\n\t\t\t\telement.appendChild(child);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn [element];\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getJsonElements(): object {\r\n\t\tlet result: object = {};\r\n\r\n\t\tresult = overrideValues(this.getSurveyInfo().getJsonElements(), result);\r\n\t\tresult = overrideValues(this.getCommentComponent().getJsonElements(), result);\r\n\t\tresult = overrideValues(this.getRatingComponent().getJsonElements(), result);\r\n\r\n\t\tresult[ISurveyComponent.JSON_APPLICATION_KEYNAME] = {};\r\n\t\tresult[ISurveyComponent.JSON_APPLICATION_KEYNAME][ISurveyComponent.JSON_EXTENDEDMANIFESTDATA_KEYNAME] =\r\n\t\t\tJSON.stringify({[ISurveyComponent.JSON_SURVEYSTRINGS_KEYNAME]: this.makeSurveyStrings()});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// Makes the string to send to Manifest respecting the components present in the survey\r\n\tprivate makeSurveyStrings(): string {\r\n\t\tconst actualStrings: object = {};\r\n\r\n\t\tif (this.prompt) {\r\n\t\t\tactualStrings[ISurveyComponent.JSON_PROMPT_KEYNAME] = this.prompt.getComponentJson();\r\n\t\t}\r\n\r\n\t\tif (this.rating) {\r\n\t\t\tactualStrings[ISurveyComponent.JSON_RATING_KEYNAME] = [this.rating.getComponentJson()];\r\n\t\t}\r\n\r\n\t\tif (this.question) {\r\n\t\t\tactualStrings[ISurveyComponent.JSON_COMMENT_KEYNAME] = [this.question.getComponentJson()];\r\n\t\t}\r\n\r\n\t\treturn JSON.stringify(actualStrings);\r\n\t}\r\n}\r\n\r\nmodule NpsSurvey {\r\n\t/**\r\n\t * Data required for a Nps Survey\r\n\t */\r\n\texport class NpsSurveyData {\r\n\t\tpublic baseData: SurveyDataSource.SurveyDataSourceData;\r\n\t\tpublic commentData: CommentComponent.CommentComponentData;\r\n\t\tpublic promptData: PromptComponent.PromptComponentData;\r\n\t\tpublic ratingData: RatingComponent.RatingComponentData;\r\n\t\tpublic cvSurveyData: CVSurveyComponent.CVSurveyComponentData;\r\n\t}\r\n}\r\n\r\nexport = NpsSurvey;\r\n","/**\r\n * General floodgate settings\r\n */\r\nexport class FloodgateSettings {\r\n\t/**\r\n\t * Convert to Json\r\n\t */\r\n\tpublic static toJson(object: FloodgateSettings): string {\r\n\t\treturn JSON.stringify(object);\r\n\t}\r\n\r\n\t/**\r\n\t * Load from Json\r\n\t */\r\n\tpublic static fromJson(json: string): FloodgateSettings {\r\n\t\treturn JSON.parse(json);\r\n\t}\r\n}\r\n","import { GovernedChannel, GovernedChannelType, IGovernedChannelData } from \"./GovernedChannel\";\r\nimport { GovernedChannelState, IGovernedChannelStateProvider } from \"./GovernedChannelStateProvider\";\r\nimport * as Utils from \"./Utils\";\r\n\r\nconst { isNOU } = Utils;\r\n\r\nexport const DEFAULT_TEACHING_MESSAGE_COOLDOWN = 15;\r\n\r\nexport interface IGovernor {\r\n\tgetAvailableChannelData(): IGovernedChannelData[];\r\n\r\n\tisChannelOpen(type: GovernedChannelType): boolean;\r\n\r\n\tstartChannelCooldown(type: GovernedChannelType, date?: Date): void;\r\n\r\n\trefreshChannelData(): void;\r\n\r\n\tsaveChannelStates(): void;\r\n}\r\n\r\nclass DefaultChannelData {\r\n\tpublic cooldownSeconds: number;\r\n\tpublic name: string;\r\n\r\n\tpublic constructor(name: string, cooldownSeconds: number) {\r\n\t\tthis.name = name;\r\n\t\tthis.cooldownSeconds = cooldownSeconds;\r\n\t}\r\n}\r\n\r\nexport class Governor implements IGovernor {\r\n\tpublic static GetChannelCoolDown(channelType: GovernedChannelType) {\r\n\t\tconst channelData = Governor.defaultChannelData[channelType];\r\n\t\treturn channelData ? channelData.cooldownSeconds : 0;\r\n\t}\r\n\r\n\tpublic static SetDefaultChannelCoolDown(channelType: GovernedChannelType, cooldownSeconds: number) {\r\n\t\tconst channelData = Governor.defaultChannelData[channelType];\r\n\t\tif (channelData) {\r\n\t\t\tchannelData.cooldownSeconds = cooldownSeconds;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static minute: number = 60;\r\n\tprivate static hour: number = 60 * Governor.minute;\r\n\tprivate static day: number = 24 * Governor.hour;\r\n\r\n\t// Array of default values for each channel type. Indexed by the GovernedChannelType enum name.\r\n\tprivate static defaultChannelData: DefaultChannelData[] = [\r\n\t\tnew DefaultChannelData(GovernedChannelType[GovernedChannelType.Standard], 14 * Governor.day),\r\n\t\tnew DefaultChannelData(GovernedChannelType[GovernedChannelType.Urgent], 0),\r\n\t\tnew DefaultChannelData(GovernedChannelType[GovernedChannelType.Banner], 15 * Governor.day),\r\n\t\tnew DefaultChannelData(GovernedChannelType[GovernedChannelType.TeachingMessage], DEFAULT_TEACHING_MESSAGE_COOLDOWN * Governor.day),\r\n\t];\r\n\r\n\tprivate channelStateProvider: IGovernedChannelStateProvider;\r\n\tprivate channels: GovernedChannel[] = [];\r\n\r\n\tpublic constructor(channelStateProvider: IGovernedChannelStateProvider) {\r\n\t\tif (!channelStateProvider) {\r\n\t\t\tthrow new Error(\"channelStateProvider must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.channelStateProvider = channelStateProvider;\r\n\t\tthis.loadChannels();\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic refreshChannelData(): void {\r\n\t\tthis.loadChannels();\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic getAvailableChannelData(): IGovernedChannelData[] {\r\n\t\tconst channelData: IGovernedChannelData[] = [];\r\n\r\n\t\tfor (const key in this.channels) {\r\n\t\t\tif (this.channels.hasOwnProperty(key)) {\r\n\t\t\t\tconst channel: GovernedChannel = this.channels[key];\r\n\r\n\t\t\t\tif (channel.isOpen()) {\r\n\t\t\t\t\tchannelData.push(channel);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn channelData;\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic isChannelOpen(type: GovernedChannelType): boolean {\r\n\t\tif (isNOU(type)) {\r\n\t\t\tthrow new Error(\"type must not be null\");\r\n\t\t}\r\n\r\n\t\treturn this.channels[type].isOpen();\r\n\t}\r\n\r\n\t// @Override\r\n\tpublic startChannelCooldown(type: GovernedChannelType, date?: Date): void {\r\n\t\tif (isNOU(type)) {\r\n\t\t\tthrow new Error(\"type must not be null\");\r\n\t\t}\r\n\r\n\t\tdate = date ? date : new Date();\r\n\r\n\t\t// Start the cool down\r\n\t\tthis.channels[type].setCooldownStartTime(date);\r\n\r\n\t\t// Save the new channel state for future sessions\r\n\t\tthis.saveChannelStates();\r\n\t}\r\n\r\n\tpublic saveChannelStates(): void {\r\n\t\t// Build up the list of channel states\r\n\t\tconst channelStates: GovernedChannelState[] = [];\r\n\r\n\t\tfor (const key in this.channels) {\r\n\t\t\tif (this.channels.hasOwnProperty(key)) {\r\n\t\t\t\tconst channel: GovernedChannel = this.channels[key];\r\n\t\t\t\tconst channelState: GovernedChannelState =\r\n\t\t\t\t\tnew GovernedChannelState(channel.getType(), channel.getCooldownStartTime());\r\n\r\n\t\t\t\tchannelStates.push(channelState);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.channelStateProvider.save(channelStates);\r\n\t}\r\n\r\n\tprivate loadChannels(): void {\r\n\t\t// Load up state from previous sessions\r\n\t\tthis.loadChannelStatesFromProvider();\r\n\r\n\t\t// For any missing channels, init them from scratch\r\n\t\t// There's no straightforward way to iterate enums, we need to iterate through the enum array\r\n\t\t//    filtering out just the numeric enum values (excluding enum names).\r\n\t\tfor (const item in GovernedChannelType) {\r\n\t\t\tif (GovernedChannelType.hasOwnProperty(item)) {\r\n\t\t\t\tconst key: number = Number(item);\r\n\r\n\t\t\t\t// skip if key is not numeric enum value, or if already exists\r\n\t\t\t\tif (isNaN(key) || this.channels[key]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst defaultData: DefaultChannelData = Governor.defaultChannelData[key];\r\n\t\t\t\tconst newChannel: GovernedChannel =\r\n\t\t\t\t\tnew GovernedChannel(key, defaultData.name, defaultData.cooldownSeconds, null);\r\n\t\t\t\tthis.channels[key] = newChannel;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate loadChannelStatesFromProvider(): void {\r\n\t\tthis.channels = [];\r\n\r\n\t\tconst channelStates: GovernedChannelState[] = this.channelStateProvider.load();\r\n\r\n\t\tfor (const key in channelStates) {\r\n\t\t\tif (channelStates.hasOwnProperty(key)) {\r\n\t\t\t\tconst channelState: GovernedChannelState = channelStates[key];\r\n\r\n\t\t\t\tconst type: GovernedChannelType = channelState.getType();\r\n\t\t\t\tconst defaultData: DefaultChannelData = Governor.defaultChannelData[type];\r\n\t\t\t\tconst newChannel: GovernedChannel =\r\n\t\t\t\t\tnew GovernedChannel(type, defaultData.name, defaultData.cooldownSeconds, channelState.getCooldownStartTime());\r\n\r\n\t\t\t\tthis.channels[newChannel.getType()] = newChannel;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import * as ActivityTracker from \"./ActivityTracker\";\r\nimport { ActivityTrackingContract } from \"./ActivityTrackingContract\";\r\nimport { ActivityTrackingSet } from \"./ActivityTrackingSet\";\r\nimport * as IActivityListener from \"./Api/IActivityListener\";\r\nimport { IFloodgateTelemetryLogger } from \"./Api/IFloodgateTelemetryLogger\";\r\nimport { IContextData } from \"./Api/IOnSurveyActivatedCallback\";\r\nimport ISurvey = require(\"./Api/ISurvey\");\r\nimport { IDictionary } from \"./Common\";\r\nimport { TelemetryEvent } from \"./Constants\";\r\nimport { IndexedTracker } from \"./IndexedTracker\";\r\nimport { SurveyEventActivityStats, SurveyStatCollectionEventActivity } from \"./SurveyStatCollectionEventActivity\";\r\nimport { fyShuffle, isNOU } from \"./Utils\";\r\n\r\nlet queuedActivities: SurveyActivityListener.IQueuedActivityParams[] = [];\r\nlet pendingActivityCount: number = 0;\r\nlet previousTrackedActivityMap: { [id: string]: IndexedTracker[] } = {};\r\n\r\n/**\r\n * This class tracks log calls against named activity strings (matched on strict case-sensitive equality)\r\n * and calls the provided callback when all activity thresholds for a given survey have been crossed\r\n */\r\nclass SurveyActivityListener implements IActivityListener {\r\n\tpublic static FloodgateStartActivityName = \"FloodgateFirstStart\";\r\n\t// The size of the dropped activities is set to 100 due to the following two reasons.\r\n\t// 1) To prevent the array growing too big and causing memory issues.\r\n\t// 2) Based on the telemetry analysis of number of dropped activities, the count is very small and much lesser than 100.\r\n\tpublic static MaxPendingActivitiesQueueSize = 100;\r\n\r\n\tpublic static resetSessionActivity(): void {\r\n\t\tpreviousTrackedActivityMap = {};\r\n\t}\r\n\r\n\t// Saveincomingactivity contextdatainadictionarywithSurveyID askey,activitydataarrayasvalue\r\n\tprivate activityContext: Record<string,IContextData[]> = {};\r\n\r\n\tprivate trackedActivityMap: { [id: string]: IndexedTracker[] };\r\n\tprivate callback: SurveyActivityListener.IActivityListenerCallback;\r\n\tprivate loggerCallback: () => IFloodgateTelemetryLogger;\r\n\r\n\tpublic constructor(callback: SurveyActivityListener.IActivityListenerCallback, loggerCallback?: () => IFloodgateTelemetryLogger) {\r\n\t\tif (!callback) {\r\n\t\t\tthrow new Error(\"callback must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.trackedActivityMap = {};\r\n\t\tthis.callback = callback;\r\n\t\tthis.loggerCallback = loggerCallback;\r\n\t}\r\n\r\n\tpublic logActivity(activityName: string, increment: number = 1, context?:IActivityListener.IActivityContext): void {\r\n\t\tthis.logActivity_private(activityName, SurveyActivityListener.LogActionType.Increment, increment, null, context);\r\n\t}\r\n\r\n\tpublic logActivityStartTime(activityName: string, startTime?: Date): void {\r\n\t\tthis.logActivity_private(activityName, SurveyActivityListener.LogActionType.StartTime, 0, startTime, null);\r\n\t}\r\n\r\n\tpublic logActivityStopTime(activityName: string, stopTime?: Date): void {\r\n\t\tthis.logActivity_private(activityName, SurveyActivityListener.LogActionType.StopTime, 0, stopTime, null);\r\n\t}\r\n\r\n\tpublic SetActivityTrackingContracts(activityTrackingContracts: ActivityTrackingContract[],\r\n\t\tbaseline = new SurveyStatCollectionEventActivity()): void {\r\n\r\n\t\tlet duplicateCounter = 0;\r\n\r\n\t\tif (!activityTrackingContracts || activityTrackingContracts.length === 0 || !baseline) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Populate a new map based on the passed in surveys, but propagating and tracking activity counts\r\n\t\t// we may have seen against those events\r\n\t\t// NOTE: We will lose activity counts for survey events that are no longer relevant.\r\n\t\tconst newMap: { [id: string]: IndexedTracker[] } = {};\r\n\t\tconst trackedSurveyIds: string[] = [];\r\n\r\n\t\tfor (const activityTrackingContract of activityTrackingContracts) {\r\n\t\t\tconst trackingSet: ActivityTrackingSet = activityTrackingContract.trackingSet;\r\n\r\n\t\t\t// Added to the new set to make sure they are not duplicated. Based on MSO.\r\n\t\t\tif (trackedSurveyIds.indexOf(activityTrackingContract.surveyId) === -1) {\r\n\t\t\t\ttrackedSurveyIds.push(activityTrackingContract.surveyId);\r\n\t\t\t} else {\r\n\t\t\t\t// Duplicate surveyId being added, count it for the log.\r\n\t\t\t\tduplicateCounter++;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// At this point, the survey's activities are safe to add.\r\n\t\t\t// Set up the structures we need to transfer baseline counts (from previous sessions) or current counts (from previous trackers)\r\n\t\t\t// Both vectors must be sorted in the same order as the trackingSet.List items\r\n\t\t\tconst baselineStats: SurveyEventActivityStats = baseline.getBySurveyId(activityTrackingContract.surveyId);\r\n\t\t\tconst baselineCounts: number[] = [trackingSet.getList().length];\r\n\t\t\tconst currentIndexedTrackers: IndexedTracker[] = new Array<IndexedTracker>(trackingSet.getList().length);\r\n\r\n\t\t\tlet currentBaselineIndex = 0;\r\n\t\t\tlet currentIndex = 0;\r\n\r\n\t\t\tfor (const trackingData of trackingSet.getList()) {\r\n\t\t\t\t// Baseline stats count is 0 for events with \"IsAggregate = false\"\r\n\t\t\t\tbaselineCounts[currentIndex] = 0;\r\n\t\t\t\tif (trackingData.getIsAggregate() && baselineStats && currentBaselineIndex < baselineStats.Counts.length) {\r\n\t\t\t\t\tbaselineCounts[currentIndex] = baselineStats.Counts[currentBaselineIndex++];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Session stats may be available in the previous trackedActivityMap\r\n\t\t\t\t// Transfer the old \"current session\" count to the new tracker\r\n\t\t\t\t// Is set to null if not available\r\n\t\t\t\tif (previousTrackedActivityMap[trackingData.getActivity()]) {\r\n\t\t\t\t\tfor (const tracker of previousTrackedActivityMap[trackingData.getActivity()]) {\r\n\t\t\t\t\t\tif (tracker.surveyId === activityTrackingContract.surveyId) {\r\n\t\t\t\t\t\t\tcurrentIndexedTrackers[currentIndex] = tracker;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurrentIndex++;\r\n\t\t\t}\r\n\r\n\t\t\t// Make a new tracker and init the counts appropriately.\r\n\t\t\tconst newTracker = new ActivityTracker(trackingSet);\r\n\t\t\t// If in a future change we start keeping trackers registered past activation, this will change\r\n\t\t\tnewTracker.initCounts(baselineCounts, currentIndexedTrackers, false /*wasActivatedThisSession*/);\r\n\r\n\t\t\t// Setup the indexed trackers\r\n\t\t\tfor (const activityIndex of newTracker.generateActivityIndexList()) {\r\n\t\t\t\tconst indexedTracker = new IndexedTracker();\r\n\t\t\t\tindexedTracker.index = activityIndex.index;\r\n\t\t\t\tindexedTracker.surveyId = activityTrackingContract.surveyId;\r\n\t\t\t\tindexedTracker.tracker = newTracker;\r\n\r\n\t\t\t\tif (!newMap[activityIndex.activity]) {\r\n\t\t\t\t\tnewMap[activityIndex.activity] = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Register the new tracker in our new map\r\n\t\t\t\tnewMap[activityIndex.activity].push(indexedTracker);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (duplicateCounter > 0) {\r\n\t\t\tconst telemetryLogger = this.loggerCallback && this.loggerCallback();\r\n\t\t\tif (telemetryLogger) {\r\n\t\t\t\ttelemetryLogger.log_Error(TelemetryEvent.SurveyActivity.SetActivityTrackingContracts.DuplicateSurveyID,\r\n\t\t\t\t\t\"Duplicate surveyId passed in activityTrackingContracts. Duplicate count: \" + duplicateCounter);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Set the new map in place of the old\r\n\t\tthis.copyObject(this.trackedActivityMap, newMap);\r\n\t}\r\n\r\n\tpublic clearSurveys(): void {\r\n\t\tObject.getOwnPropertyNames(this.trackedActivityMap).forEach((key) => {\r\n\t\t\tdelete this.trackedActivityMap[key];\r\n\t\t});\r\n\t}\r\n\r\n\tpublic saveSessionTrackingActivity(activity: string): void {\r\n\t\t// Set the new activity in place of the old\r\n\t\tpreviousTrackedActivityMap[activity] = this.trackedActivityMap[activity];\r\n\t}\r\n\r\n\t// Get the indexedTracker that corresponds to the SurveyID and return that count. otherwise return 0.\r\n\tpublic getCount(activity: string, surveyId: string): number {\r\n\t\tconst indexedTracker = this.getIndexedTracker(activity, surveyId);\r\n\t\tif (!indexedTracker) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\treturn indexedTracker.tracker.getCount(indexedTracker.index);\r\n\t}\r\n\r\n\tpublic getSessionCount(activity: string, surveyId: string): number {\r\n\t\tconst indexedTracker = this.getIndexedTracker(activity, surveyId);\r\n\t\tif (!indexedTracker) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\treturn indexedTracker.tracker.getSessionCount(indexedTracker.index);\r\n\t}\r\n\r\n\t/**\r\n\t * An atomic get-and-set method.  Returns the current SessionCount, resetting it to zero and adding it into the established baseline\r\n\t */\r\n\tpublic moveSessionCountIntoBaseCount(activity: string, surveyId: string): number {\r\n\t\tconst indexedTracker = this.getIndexedTracker(activity, surveyId);\r\n\t\tif (!indexedTracker) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\treturn indexedTracker.tracker.moveSessionCountIntoBaseCount(indexedTracker.index);\r\n\t}\r\n\r\n\tpublic getSurveyIds(activity: string): string[] | undefined {\r\n\t\tif (isNOU(activity)) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tconst indexedTrackers = this.trackedActivityMap[activity];\r\n\t\tif (!indexedTrackers) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tconst surveyIds = indexedTrackers.map((indexedTracker) => indexedTracker.surveyId);\r\n\t\treturn surveyIds;\r\n\t}\r\n\r\n\tpublic setCallback(callback: SurveyActivityListener.IActivityListenerCallback): void {\r\n\t\tthis.callback = callback;\r\n\t}\r\n\r\n\tpublic UpdateActivityTrackingContracts(surveyList: IDictionary<ISurvey>): void {\r\n\t\tif (isNOU(surveyList) || Object.keys(surveyList).length === 0) {\r\n\t\t\tthis.clearSurveys();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (const key in this.trackedActivityMap) {\r\n\t\t\tif (this.trackedActivityMap.hasOwnProperty(key)) {\r\n\t\t\t\tconst tracker: IndexedTracker[] = this.trackedActivityMap[key];\r\n\r\n\t\t\t\t// loop through tracker and remove the ones not associate with given surveys\r\n\t\t\t\tfor (let i = tracker.length - 1; i >= 0; --i) {\r\n\t\t\t\t\tif (surveyList.hasOwnProperty(tracker[i].surveyId)) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttracker.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getIndexedTracker(activity: string, surveyId: string): IndexedTracker | undefined {\r\n\t\tconst indexedTrackers = this.trackedActivityMap[activity];\r\n\r\n\t\tif (!indexedTrackers) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tlet indexedTracker: IndexedTracker | undefined;\r\n\t\tfor (const tracker of indexedTrackers) {\r\n\t\t\tif (tracker.surveyId === surveyId) {\r\n\t\t\t\tindexedTracker = tracker;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn indexedTracker;\r\n\t}\r\n\r\n\tprivate resetQueuedActivities(): void {\r\n\t\tqueuedActivities = [];\r\n\t}\r\n\r\n\tprivate logActivity_private(activityName: string,\r\n\t\tlogType: SurveyActivityListener.LogActionType,\r\n\t\tincrement: number,\r\n\t\ttimestamp: Date,\r\n\t\tcontext:IActivityListener.IActivityContext): void {\r\n\t\tif (this.callback && !this.callback.shouldAcceptActivity(activityName)) {\r\n\t\t\tpendingActivityCount++;\r\n\t\t\tif (queuedActivities.length < SurveyActivityListener.MaxPendingActivitiesQueueSize) {\r\n\t\t\t\tqueuedActivities.push({activityName, logType, increment, timestamp});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Count any activities that are posted before 'FloodgateFirstStart' activity happens\r\n\t\tif (activityName === SurveyActivityListener.FloodgateStartActivityName) {\r\n\t\t\tif (pendingActivityCount > 0) {\r\n\t\t\t\t// Get the activity names of the queued activities for telemetry, send only first 25.\r\n\t\t\t\tconst activityNames = queuedActivities.slice(0, 25).map((queuedActivity) => queuedActivity.activityName);\r\n\r\n\t\t\t\tconst telemetryLogger = this.loggerCallback && this.loggerCallback();\r\n\t\t\t\tif (telemetryLogger) {\r\n\t\t\t\t\t// Sampling this telemetry event to 5%\r\n\t\t\t\t\ttelemetryLogger.log_Event(TelemetryEvent.SurveyActivity.LogActivity.EventsReprocessed,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tActivityNames: JSON.stringify(activityNames),\r\n\t\t\t\t\t\t\tCount: queuedActivities.length,\r\n\t\t\t\t\t\t\tDropped: pendingActivityCount - queuedActivities.length,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t0.05);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// replay all the queued activities one by one as the floodgate engine has started now\r\n\t\t\t\tqueuedActivities.map((queuedActivity) => this.logActivity_core(\r\n\t\t\t\t\tqueuedActivity.activityName, queuedActivity.logType, queuedActivity.increment, queuedActivity.timestamp, context));\r\n\t\t\t}\r\n\r\n\t\t\tpendingActivityCount = 0;\r\n\t\t\tthis.resetQueuedActivities();\r\n\t\t}\r\n\r\n\t\tthis.logActivity_core(activityName, logType, increment, timestamp, context);\r\n\t}\r\n\r\n\tprivate logActivity_core(activityName: string,\r\n\t\tlogType: SurveyActivityListener.LogActionType,\r\n\t\tincrement: number,\r\n\t\ttimestamp: Date,\r\n\t\tcontext:IActivityListener.IActivityContext): void {\r\n\t\tconst indexedTrackers: IndexedTracker[] = this.trackedActivityMap[activityName];\r\n\t\tif (!indexedTrackers || indexedTrackers.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet indices: number[] = [];\r\n\r\n\t\t// If we have more than one tracker shuffle trackers to randomize which is evaluated first\r\n\t\tif (indexedTrackers.length > 1) {\r\n\t\t\tindices = new Array<number>(indexedTrackers.length);\r\n\t\t\tfor (let i = 0; i < indices.length; i++) {\r\n\t\t\t\tindices[i] = i;\r\n\t\t\t}\r\n\t\t\tindices = fyShuffle(indices); // shuffle and reassign\r\n\t\t} else {\r\n\t\t\tindices.push(0); // just have a zero. Shuffling is not needed.\r\n\t\t}\r\n\r\n\t\t// Loop through trackers in shuffled order\r\n\t\tfor (const index of indices) {\r\n\t\t\tconst tracker: IndexedTracker = indexedTrackers[index];\r\n\t\t\tswitch (logType) {\r\n\t\t\t\tcase SurveyActivityListener.LogActionType.StartTime: {\r\n\t\t\t\t\ttracker.tracker.startTime(tracker.index, timestamp);\r\n\t\t\t\t\tcontinue; // Look at the next tracker. Increment not needed.\r\n\t\t\t\t}\r\n\t\t\t\tcase SurveyActivityListener.LogActionType.StopTime: {\r\n\t\t\t\t\tincrement = tracker.tracker.stopTime(tracker.index, timestamp);\r\n\t\t\t\t\t// fall through to increment the activity as well.\r\n\t\t\t\t}\r\n\t\t\t\tcase SurveyActivityListener.LogActionType.Increment: {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tdefault: {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (context) {\r\n\t\t\t\tconst trackerSurveyId = tracker.surveyId;\r\n\t\t\t\tthis.activityContext[trackerSurveyId] = this.activityContext[trackerSurveyId] || [];\r\n\t\t\t\tthis.activityContext[trackerSurveyId].push({ activityName, context });\r\n\t\t\t}\r\n\r\n\t\t\tconst result: ActivityTracker.IncrementResult = tracker.tracker.incrementActivity(tracker.index, increment);\r\n\t\t\tif (result === ActivityTracker.IncrementResult.AllActivitiesActivated) {\r\n\t\t\t\t// Check the activated surveys list to ensure whether any previous survey is still in process\r\n\t\t\t\t// If not, the length should be 1 and call to execute this survey right away\r\n\t\t\t\t// This should only happen if calling to Governance Service, due to the call is asynchronous\r\n\t\t\t\tthis.executeCallback(tracker.surveyId);\r\n\t\t\t\tbreak;\r\n\t\t\t\t/* Breaking here to let one and only one callback to be made from a logActivity call.\r\n\t\t\t\tThis ensures only one survey can fully 'trigger' for a logActivity call. Others that would also\r\n\t\t\t\thave triggered must wait until the next call to trigger (without there being a cooldown, of course).\r\n\t\t\t\t*/\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate executeCallback(surveyId: string): void {\r\n\t\tthis.callback.run(surveyId, this.activityContext[surveyId]);\r\n\t}\r\n\r\n\tprivate copyObject(target: {}, source: {}) {\r\n\t\tObject.keys(source).forEach((key) => {\r\n\t\t\ttarget[key] = source[key];\r\n\t\t});\r\n\t}\r\n}\r\n\r\nmodule SurveyActivityListener {\r\n\texport interface IActivityListenerCallback {\r\n\t\trun(surveyId: string, contextData: IContextData[]): void;\r\n\t\tshouldAcceptActivity(activityName: string): boolean;\r\n\t}\r\n\r\n\texport const enum LogActionType {\r\n\t\tIncrement,\r\n\t\tStartTime,\r\n\t\tStopTime,\r\n\t}\r\n\r\n\texport interface IQueuedActivityParams {\r\n\t\tactivityName: string;\r\n\t\tlogType: SurveyActivityListener.LogActionType;\r\n\t\tincrement: number;\r\n\t\ttimestamp: Date;\r\n\t}\r\n}\r\n\r\nexport = SurveyActivityListener;\r\n","import { ActivityTrackingData } from \"./ActivityTrackingData\";\r\nimport { ActivityTrackingSet } from \"./ActivityTrackingSet\";\r\nimport { IndexedTracker } from \"./IndexedTracker\";\r\n\r\n/**\r\n * Class to track ticks against a list of expected counts in a thread-safe way\r\n * Main API of interest is incrementActivity, which returns an enumerated value indicating\r\n * whether or not the increment resulted in no thresholds crossed, a single activity threshold crossed,\r\n * or the final activity threshold crossed.\r\n */\r\nclass ActivityTracker {\r\n\tprivate isOrdered: boolean;\r\n\tprivate trackedActivities: ActivityTrackingData[];\r\n\tprivate currentIndex: number;\r\n\tprivate activationMask: number;\r\n\tprivate currentActivationFlags: number;\r\n\tprivate isActivationByInitPending: boolean;\r\n\tprivate currentCounts: number[];\r\n\tprivate currentSessionCounts: number[];\r\n\tprivate currentStartTimes: Date[];\r\n\r\n\tpublic constructor(trackingSet: ActivityTrackingSet) {\r\n\t\tif (!trackingSet) {\r\n\t\t\tthrow new Error(\"trackingSet must not be null\");\r\n\t\t}\r\n\t\tif (trackingSet.getList().length > 32) {\r\n\t\t\tthrow new Error(\"trackingSet list size must be less than 32\");\r\n\t\t}\r\n\r\n\t\tthis.isOrdered = trackingSet.getIsOrdered();\r\n\t\tthis.trackedActivities = trackingSet.getList();\r\n\r\n\t\t/**\r\n\t\t * For ordered sets, the current index.\r\n\t\t */\r\n\t\tthis.currentIndex = 0;\r\n\t\tthis.activationMask = 0;\r\n\t\tthis.currentActivationFlags = 0;\r\n\t\tthis.isActivationByInitPending = false;\r\n\r\n\t\tthis.currentCounts = new Array<number>(this.trackedActivities.length);\r\n\t\tthis.currentStartTimes = new Array<Date>(this.trackedActivities.length);\r\n\t\tthis.currentSessionCounts = new Array<number>(this.trackedActivities.length);\r\n\r\n\t\tfor (let i = 0; i < this.trackedActivities.length; i++) {\r\n\t\t\tthis.currentCounts[i] = 0;\r\n\t\t\tthis.currentSessionCounts[i] = 0;\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < this.trackedActivities.length; i++) {\r\n\t\t\tthis.activationMask |= 0x1 << i;\r\n\r\n\t\t\tif (this.trackedActivities[i].getCount() < 1) {\r\n\t\t\t\tthis.trackedActivities[i].setCount(1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get the count for the activity at the specified index. Returns 0 for out-of-range indices\r\n\t *\r\n\t * @param index index\r\n\t */\r\n\tpublic getCount(index: number): number {\r\n\t\tif (!this.isValidIndex(index)) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\treturn this.currentCounts[index];\r\n\t}\r\n\r\n\t/**\r\n\t * Get the count for the activity at the specified index, as tracked only for this session.\r\n\t * Returns 0 for out-of-range indices\r\n\t *\r\n\t * @param index index\r\n\t */\r\n\tpublic getSessionCount(index: number): number {\r\n\t\tif (!this.isValidIndex(index)) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\treturn this.currentSessionCounts[index];\r\n\t}\r\n\r\n\t/**\r\n\t * Get the StartTime for the activity at the specified index. Returns null for out-of-range indices\r\n\t *\r\n\t * @param index index\r\n\t */\r\n\tpublic getStartTime(index: number): Date {\r\n\t\tif (!this.isValidIndex(index)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn this.currentStartTimes[index];\r\n\t}\r\n\r\n\t/**\r\n\t * A get-and-set method. Returns the current SessionCount, resetting it to zero and adding it into\r\n\t * the established baseline.\r\n\t *\r\n\t * @param index index\r\n\t */\r\n\tpublic moveSessionCountIntoBaseCount(index: number): number {\r\n\t\tif (!this.isValidIndex(index)) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tconst sessionCount: number = this.currentSessionCounts[index];\r\n\t\tthis.currentSessionCounts[index] = 0;\r\n\r\n\t\treturn sessionCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Forcibly set the counts for the activities in the trackingSet.\r\n\t * Unlike other APIs, this expects vector indices to match the order\r\n\t * of the ActivityTrackingSet.List initially used to construct this tracker.\r\n\t * (When data is copied from a different IndexedTracker, it will properly use the IndexedTracker.Index to query internals)\r\n\t * Note:\r\n\t * 1) Assumes a count of 0 for any missing index in undersized arrays.\r\n\t * 2) Respects and enforces ordered list initialization (i.e. all init values are ignored once a unfinished activity is\r\n\t * encountered in an ordered tracking list).\r\n\t * 3) If the tracker is fully Activated as a result of this call, the next call to IncrementActivity will raise the\r\n\t * IncrementEdgeResult.AllActivitiesActivated, for any valid index accepted by IsPermittedIndexForActivationByInit().\r\n\t */\r\n\tpublic initCounts(baselineCounts: number[], otherTrackers: IndexedTracker[], wasAlreadyActivatedThisSession: boolean = false): void {\r\n\t\t// NOTE: baselineIncrements and sessionIncrements are sorted the same as the initial trackedActivity set, which\r\n\t\t// for this class is the same as trackedActivities\r\n\r\n\t\tfor (let i = 0; i < this.trackedActivities.length; i++) {\r\n\t\t\t// Only accept values up to the current index, when ordered\r\n\t\t\tif (this.isOrdered && i > this.currentIndex) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Start off by pulling values from this session\r\n\t\t\tif (i < otherTrackers.length && otherTrackers[i]) {\r\n\t\t\t\tthis.currentSessionCounts[i] = this.currentCounts[i] = otherTrackers[i].tracker.getSessionCount(otherTrackers[i].index);\r\n\t\t\t\tthis.currentStartTimes[i] = otherTrackers[i].tracker.getStartTime(otherTrackers[i].index);\r\n\t\t\t}\r\n\r\n\t\t\t// If we've got a baseline from previous sessions, add it in as well\r\n\t\t\tif (this.trackedActivities[i].getIsAggregate() && i < baselineCounts.length) {\r\n\t\t\t\tthis.currentCounts[i] += baselineCounts[i];\r\n\t\t\t}\r\n\r\n\t\t\tif (this.hasCountCrossedThreshold(i)) {\r\n\t\t\t\tthis.finishActivityAtIndex(i);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.isActivated() && !wasAlreadyActivatedThisSession) {\r\n\t\t\t// Mark this object so that the next time any permitted activation event is logged, the survey will activate\r\n\t\t\tthis.isActivationByInitPending = true;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic generateActivityIndexList(): ActivityTracker.ActivityIndex[] {\r\n\t\tconst indexList = new Array<ActivityTracker.ActivityIndex>();\r\n\t\tfor (let i = 0; i < this.trackedActivities.length; i++) {\r\n\t\t\tconst current = new ActivityTracker.ActivityIndex();\r\n\t\t\tcurrent.activity = this.trackedActivities[i].getActivity();\r\n\t\t\tcurrent.index = i;\r\n\t\t\tindexList.push(current);\r\n\t\t}\r\n\r\n\t\treturn indexList;\r\n\t}\r\n\r\n\t/**\r\n\t * Increments the count at the specified index by the given increment.  Returns a value indicating whether\r\n\t * or not this call triggered a transition edge (activating the activity at 'index', or finishing the activation\r\n\t * of the final pending activity)\r\n\t */\r\n\tpublic incrementActivity(index: number, increment: number): ActivityTracker.IncrementResult {\r\n\t\tif (!this.isValidIndex(index)) {\r\n\t\t\treturn ActivityTracker.IncrementResult.Pending;\r\n\t\t}\r\n\r\n\t\tif (increment < 0) {\r\n\t\t\tthrow new Error(\"increment must be non-negative\");\r\n\t\t}\r\n\r\n\t\t// Ordered sets must be triggered in order.  We can only track at the current index, or before\r\n\t\tif (this.isOrdered && index > this.currentIndex) {\r\n\t\t\treturn ActivityTracker.IncrementResult.Pending;\r\n\t\t}\r\n\r\n\t\t// Add to our counts after storing off our current state\r\n\t\tconst startedLessThanThreshold = !this.hasCountCrossedThreshold(index);\r\n\t\tthis.currentCounts[index] += increment;\r\n\t\tthis.currentSessionCounts[index] += increment;\r\n\r\n\t\tif (this.isActivationByInitPending) {\r\n\t\t\tif (this.isPermittedIndexForActivationByInit(index)) {\r\n\t\t\t\t// This tracker was completed due to the initialization from previous increment data\r\n\t\t\t\t// now that we've store this activities increments, raise the AllActivitiesActivated signal\r\n\t\t\t\treturn this.commitActivation();\r\n\t\t\t} else {\r\n\t\t\t\t// Still waiting for a valid re-activation activity\r\n\t\t\t\treturn ActivityTracker.IncrementResult.Pending;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!(startedLessThanThreshold && this.hasCountCrossedThreshold(index))) {\r\n\t\t\t// Still waiting for this activity to finish\r\n\t\t\treturn ActivityTracker.IncrementResult.Pending;\r\n\t\t}\r\n\r\n\t\t// Mark this activity as complete in our flag collection\r\n\t\tthis.finishActivityAtIndex(index);\r\n\r\n\t\tif (this.isActivated()) {\r\n\t\t\treturn this.commitActivation();\r\n\t\t}\r\n\r\n\t\treturn ActivityTracker.IncrementResult.SingleActivityActivated;\r\n\t}\r\n\r\n\t/**\r\n\t * Explicitly sets a start timestamp (now if startTime is null) for the specified activity index. Overwrites any previous StartTime.\r\n\t */\r\n\tpublic startTime(index: number, startTime?: Date): void {\r\n\t\tif (!this.isValidIndex(index)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.currentStartTimes[index] = (!startTime) ? new Date() : startTime;\r\n\t}\r\n\r\n\t/**\r\n\t * Computes the \"count\" delta (delta in whatever units are appropriate for a subsequent call to IncrementActivity)\r\n\t * elapsed between now and a previously logged StartTime for this activity index.\r\n\t * Always clears the previous StartTime.\r\n\t * Returns 0 if no previous StartTime was logged, or if StartTime > StopTime\r\n\t */\r\n\tpublic stopTime(index: number, stopTime?: Date): number {\r\n\t\tif (!this.isValidIndex(index)) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tconst startTime = this.currentStartTimes[index];\r\n\t\tthis.currentStartTimes[index] = null;\r\n\r\n\t\tif (!startTime) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tstopTime = (!stopTime) ? new Date() : stopTime;\r\n\t\tif (startTime > stopTime) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tconst deltaMS = stopTime.getTime() - startTime.getTime();\r\n\t\t// Currently all timer activities return seconds as the increment unit\r\n\t\tlet diff = deltaMS / 1000;\r\n\r\n\t\t// Adding 1ms to the count so it can have the decimal place\r\n\t\t// So that we can distinguish the Time activity\r\n\t\tif (diff % 1 === 0) {\r\n\t\t\tdiff += 0.001;\r\n\t\t}\r\n\r\n\t\treturn diff;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true if the index is valid for accessing the stored activity counts, false otherwise\r\n\t */\r\n\tpublic isValidIndex(index: number): boolean {\r\n\t\treturn index < this.trackedActivities.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets whether or not the full set of activities for this tracker have exceeded their trigger thresholds\r\n\t */\r\n\tpublic isActivated(): boolean {\r\n\t\treturn (this.currentActivationFlags & this.activationMask) === this.activationMask;\r\n\t}\r\n\r\n\t/**\r\n\t\t* Marks the activity at the index as finished. Includes setting the proper\r\n\t\t* activation flags and potentially advancing the current index for ordered tracking sets\r\n\t\t*/\r\n\tprivate finishActivityAtIndex(index: number): void {\r\n\t\tif (!this.isValidIndex(index)) {\r\n\t\t\tthrow new Error(\"Index is not valid\");\r\n\t\t}\r\n\r\n\t\tthis.currentActivationFlags |= 0x1 << index;\r\n\r\n\t\tif (index + 1 < this.trackedActivities.length) {\r\n\t\t\tthis.currentIndex = index + 1;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param index index\r\n\t * @return true if the counts for the activity at the specified index have met or exceeded the threshold count.\r\n\t */\r\n\tprivate hasCountCrossedThreshold(index: number): boolean {\r\n\t\tif (!this.isValidIndex(index)) {\r\n\t\t\tthrow new Error(\"Index is not valid\");\r\n\t\t}\r\n\r\n\t\treturn this.currentCounts[index] >= this.trackedActivities[index].getCount();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true if the index refers to an activity that can re-activate a tracked object (aka return AllActivitiesActivated)\r\n\t * that was initialized as \"complete\" via initCounts.\r\n\t * Note: For unordered sets, any activity is valid. For ordered sequences, only the final activity is valid\r\n\t */\r\n\tprivate isPermittedIndexForActivationByInit(index: number): boolean {\r\n\t\treturn !this.isOrdered || ((index + 1) === this.currentCounts.length);\r\n\t}\r\n\r\n\tprivate commitActivation(): ActivityTracker.IncrementResult {\r\n\t\tthis.isActivationByInitPending = false;\r\n\t\treturn ActivityTracker.IncrementResult.AllActivitiesActivated;\r\n\t}\r\n}\r\n\r\nmodule ActivityTracker {\r\n\t/**\r\n\t * Structure returned by an ActivityTracker to call back into\r\n\t * IncrementActivity with valid index values\r\n\t */\r\n\texport class ActivityIndex {\r\n\t\tpublic activity: string;\r\n\t\tpublic index: number;\r\n\t}\r\n\r\n\texport const enum IncrementResult {\r\n\t\t/**\r\n\t\t * No thresholds crossed as a result of this increment operation\r\n\t\t */\r\n\t\tPending,\r\n\r\n\t\t/**\r\n\t\t * The threshold for the targeted activity index was crossed as a result of this increment operation\r\n\t\t */\r\n\t\tSingleActivityActivated,\r\n\r\n\t\t/**\r\n\t\t * The threshold for the targeted activity index was crossed as a result of this increment operation\r\n\t\t * and this was the final activity being tracked\r\n\t\t */\r\n\t\tAllActivitiesActivated,\r\n\t}\r\n}\r\n\r\nexport = ActivityTracker;\r\n","import ActivityTracker = require(\"./ActivityTracker\");\r\nimport ISurvey = require(\"./Api/ISurvey\");\r\n\r\nexport class IndexedTracker {\r\n\tpublic index: number;\r\n\tpublic surveyId: string;\r\n\tpublic tracker: ActivityTracker;\r\n}\r\n","import { ActivityTrackingSet } from \"./ActivityTrackingSet\";\r\n\r\nexport class ActivityTrackingContract {\r\n\tpublic surveyId: string;\r\n\tpublic trackingSet: ActivityTrackingSet;\r\n\r\n\tpublic constructor(surveyId: string, trackingSet: ActivityTrackingSet) {\r\n\t\tthis.surveyId = surveyId;\r\n\t\tthis.trackingSet = trackingSet;\r\n\t}\r\n}\r\n","import { ISurveyInfo } from \"./Api/Api\";\r\nimport { IDictionary } from \"./Common\";\r\nimport { SurveyActivationStats } from \"./SurveyStatCollectionActivation\";\r\nimport { isNOU, isNumber } from \"./Utils\";\r\n\r\nexport function isMultiLaunchSurvey(surveyInfo: ISurveyInfo): boolean {\r\n\tconst maxLaunches = surveyInfo?.getMaxLaunches();\r\n\treturn isNumber(maxLaunches) && maxLaunches > 1;\r\n}\r\n\r\nexport function isBusinessCriticalSurvey(surveyInfo: ISurveyInfo): boolean {\r\n\tconst businessLevel = surveyInfo?.getBusinessLevel();\r\n\treturn !isNOU(businessLevel) && businessLevel === ISurveyInfo.BusinessLevel.Critical;\r\n}\r\n\r\nexport function isCriticalSurvey(surveyInfo: ISurveyInfo): boolean {\r\n\treturn isMultiLaunchSurvey(surveyInfo) || isBusinessCriticalSurvey(surveyInfo);\r\n}\r\n\r\nexport function hasSurveyReachedMaxLaunchesPerSession(surveyInfo: ISurveyInfo, surveyActivationStats: IDictionary<number>): boolean {\r\n\tif (isMultiLaunchSurvey(surveyInfo) && isNumber(surveyInfo.getMaxLaunchesPerSession())) {\r\n\t\tconst surveyLaunchCountInSession = surveyActivationStats[surveyInfo.getId()] ?? 0;\r\n\t\tconst maxLaunchesPerSession = surveyInfo.getMaxLaunchesPerSession();\r\n\t\treturn surveyLaunchCountInSession >= maxLaunchesPerSession;\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nexport function hasSurveyReachedMaxLaunches(surveyInfo: ISurveyInfo, surveyActivationStats: SurveyActivationStats): boolean {\r\n\tif (isMultiLaunchSurvey(surveyInfo)) {\r\n\t\tconst surveyLaunchCount = surveyActivationStats?.SurveyLaunchCount || 0;\r\n\t\treturn surveyLaunchCount >= surveyInfo.getMaxLaunches();\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n","import { UserFact } from \"./UserFact\";\r\n\r\nexport const deserializeUserFacts = (input: any): UserFact[] => {\r\n\tlet userFacts: UserFact[] = [];\r\n\tfor (const key in input.UserFacts) {\r\n\t\tif (input.UserFacts.hasOwnProperty(key)) {\r\n\t\t\tconst userFactInput = input.UserFacts[key];\r\n\r\n\t\t\tif (userFactInput) {\r\n\t\t\t\tuserFacts.push(UserFact.deserialize(userFactInput));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (userFacts.length === 0) {\r\n\t\tuserFacts = null;\r\n\t}\r\n\r\n\treturn userFacts;\r\n\r\n};\r\n\r\nexport const validateUserFacts = (userFacts: UserFact[]): boolean => {\r\n\tif (userFacts) {\r\n\t\tfor (const key in userFacts) {\r\n\t\t\tif (userFacts.hasOwnProperty(key) && !userFacts[key]) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n","import { TelemetryEvent } from \"../Constants\";\r\nimport { FloodgateEngine } from \"../FloodgateEngine\";\r\nimport * as Utils from \"../Utils\";\r\nimport { IUserFact } from \"./IUserFact\";\r\nimport { ComparatorType, CurrentTimeIntervalType, IUserFactInput, UserFactLatencyType, UserFactType } from \"./UserFactModel\";\r\n\r\nconst { isNOU, isNumber, isArray } = Utils;\r\nconst commonComparatorTypes: ComparatorType[] = [\r\n\tComparatorType.Equal,\r\n\tComparatorType.NotEqual,\r\n\tComparatorType.GreaterThan,\r\n\tComparatorType.GreaterThanOrEqual,\r\n\tComparatorType.LessThan,\r\n\tComparatorType.LessThanOrEqual,\r\n];\r\n\r\nexport class UserFact {\r\n\tpublic static deserialize(rawUserFactSpec: any): UserFact {\r\n\t\treturn this.validate(rawUserFactSpec) ? new UserFact(rawUserFactSpec) : null;\r\n\t}\r\n\r\n\tprivate static validate(input: any) {\r\n\t\tif (!input) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,\r\n\t\t\t\t\"Input is null or undefined for user fact\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Values is used for type UserFactType.ListOfStrings\r\n\t\tif (!input.Value && input.Values) {\r\n\t\t\tinput.Value = input.Values;\r\n\t\t}\r\n\r\n\t\tif (isNOU(input.Name) || isNOU(input.Type) || isNOU(input.Value)) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,\r\n\t\t\t\t`Either of the required parameters Name: ${input.Name}, Type: ${input.Type} or Value: ${input.Value} are not provided for the user fact`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!this.validateUserFactType(input.Type)) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,\r\n\t\t\t\t`Invalid UserFactType value ${input.Type} is provided for user fact`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (input.Type === UserFactType.ListFile) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,\r\n\t\t\t\t`Unsupported UserFactType value ${input.Type} is provided for user fact`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (input.LatencyType && !this.validateLatencyType(input.LatencyType)) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,\r\n\t\t\t\t`Invalid LatencyType value ${input.LatencyType} is provided for user fact of type ${input.Type}`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (input.LatencyType && input.LatencyType !== UserFactLatencyType.None && isNOU(input.LatencyDurationInSeconds)) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,\r\n\t\t\t\t`LatencyDurationInSeconds value ${input.LatencyDurationInSeconds} is not provided for user fact of type ${input.Type}`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (input.LatencyDurationInSeconds && !isNumber(input.LatencyDurationInSeconds)) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,\r\n\t\t\t\t`Invalid LatencyDurationInSeconds value ${input.LatencyDurationInSeconds} is provided for user fact of type ${input.Type}`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (input.Type === UserFactType.TimeIntervalInSeconds && isNOU(input.IntervalType)) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,\r\n\t\t\t\t`Required parameter intervalType is not provided for user fact of type ${input.Type}`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst supportedComparatorTypes = this.getComparatorTypes(input.Type);\r\n\t\tif (input.Comparator && !isComparatorTypeSupported(input.Comparator, supportedComparatorTypes)) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,\r\n\t\t\t\t`Unsupported comparator type for user fact of type ${input.Type}`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate static getComparatorTypes(userFactType: UserFactType): ComparatorType[]  {\r\n\t\tswitch (userFactType) {\r\n\t\t\tcase UserFactType.Boolean:\r\n\t\t\t\treturn [ComparatorType.Equal, ComparatorType.NotEqual];\r\n\t\t\tcase UserFactType.String:\r\n\t\t\t\treturn [ComparatorType.Equal,\r\n\t\t\t\t\t\tComparatorType.NotEqual,\r\n\t\t\t\t\t\tComparatorType.In,\r\n\t\t\t\t\t\tComparatorType.NotIn,\r\n\t\t\t\t\t\tComparatorType.InverseIn,\r\n\t\t\t\t\t\tComparatorType.InverseNotIn];\r\n\t\t\tcase UserFactType.ListOfStrings:\r\n\t\t\t\treturn [ComparatorType.In, ComparatorType.NotIn, ComparatorType.InverseIn, ComparatorType.InverseNotIn];\r\n\t\t\tcase UserFactType.TimeIntervalInSeconds:\r\n\t\t\tcase UserFactType.DateTimeUTC:\r\n\t\t\tcase UserFactType.Number:\r\n\t\t\tcase UserFactType.ListFile:\r\n\t\t\t\treturn commonComparatorTypes;\r\n\t\t\tdefault:\r\n\t\t\t\tassertNever(userFactType);\r\n\t\t}\r\n\r\n\t\treturn commonComparatorTypes;\r\n\t}\r\n\r\n\tprivate static validateLatencyType(latency: UserFactLatencyType) {\r\n\t\treturn (\r\n\t\t\tlatency === UserFactLatencyType.None ||\r\n\t\t\tlatency === UserFactLatencyType.ClientIngestionDateTime ||\r\n\t\t\tlatency === UserFactLatencyType.SourceDateTime ||\r\n\t\t\tlatency === UserFactLatencyType.StorageDateTime\r\n\t\t) ? true : assertNever(latency);\r\n\t}\r\n\r\n\tprivate static validateUserFactType(factType: UserFactType) {\r\n\t\treturn (\r\n\t\t\tfactType === UserFactType.Boolean ||\r\n\t\t\tfactType === UserFactType.DateTimeUTC ||\r\n\t\t\tfactType === UserFactType.Number ||\r\n\t\t\tfactType === UserFactType.String ||\r\n\t\t\tfactType === UserFactType.TimeIntervalInSeconds ||\r\n\t\t\tfactType === UserFactType.ListOfStrings ||\r\n\t\t\tfactType === UserFactType.ListFile\r\n\t\t) ? true : assertNever(factType);\r\n\t}\r\n\r\n\tprivate input: IUserFactInput;\r\n\r\n\tconstructor(input: IUserFactInput) {\r\n\t\tthis.input = input;\r\n\t}\r\n\r\n\tpublic isAMatch(rawUserFact: IUserFact): boolean {\r\n\t\tif (!rawUserFact || !rawUserFact.userFactValue) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!this.isLatencyAcceptable(rawUserFact)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst factType = this.getType();\r\n\t\t\tif (factType === UserFactType.Boolean) {\r\n\t\t\t\treturn compareBooleanValues(this.getValue(), rawUserFact, this.getComparator());\r\n\t\t\t} else if (factType === UserFactType.DateTimeUTC) {\r\n\t\t\t\treturn compareDateTimeUTCValues(this.getValue() as string, rawUserFact, this.getComparator());\r\n\t\t\t} else if (factType === UserFactType.Number) {\r\n\t\t\t\treturn compareNumberValues(this.getValue() as number, rawUserFact, this.getComparator());\r\n\t\t\t} else if (factType === UserFactType.String) {\r\n\t\t\t\treturn compareStringValues(this.getValue() as string, rawUserFact, this.getComparator());\r\n\t\t\t} else if (factType === UserFactType.TimeIntervalInSeconds) {\r\n\t\t\t\treturn compareTimeIntervalValues(this.getValue() as number, rawUserFact, this.getComparator(), this.getIntervalType());\r\n\t\t\t} else if (factType === UserFactType.ListOfStrings) {\r\n\t\t\t\treturn compareListValues(this.getValue() as unknown as string[], rawUserFact, this.getComparator());\r\n\t\t\t} else {\r\n\t\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,\r\n\t\t\t\t\t`Unsupported type of user fact was provided ${factType}`);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,\r\n\t\t\t\terror);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getType() {\r\n\t\treturn this.input.Type;\r\n\t}\r\n\r\n\tpublic getName() {\r\n\t\treturn this.input.Name;\r\n\t}\r\n\r\n\tpublic getValue() {\r\n\t\treturn this.input.Value;\r\n\t}\r\n\r\n\tpublic getComparator() {\r\n\t\treturn this.input.Comparator || ComparatorType.Equal;\r\n\t}\r\n\r\n\tpublic getLatencyType() {\r\n\t\treturn this.input.LatencyType || UserFactLatencyType.None;\r\n\t}\r\n\r\n\tpublic getLatencyDurationInSeconds() {\r\n\t\treturn this.input.LatencyDurationInSeconds;\r\n\t}\r\n\r\n\tpublic getIntervalType() {\r\n\t\treturn this.input.IntervalType;\r\n\t}\r\n\r\n\tprivate isLatencyAcceptable(rawUserFact: IUserFact) {\r\n\t\tconst factType = this.getType();\r\n\r\n\t\tif (!isNOU(this.getLatencyDurationInSeconds()) &&\r\n\t\t\t!evaluateFactCandidacy(this.getLatencyType(), this.getLatencyDurationInSeconds(), rawUserFact)) {\r\n\t\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\t\tTelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Mismatch, {\r\n\t\t\t\t\tErrorMessage: `Latency duration not acceptable - { Name: \"${rawUserFact.userFactName}\" }`,\r\n\t\t\t\t\tTimeMilliseconds: this.getLatencyDurationInSeconds(),\r\n\t\t\t\t\tType: `${factType}`,\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nfunction evaluateFactCandidacy(latencyType: UserFactLatencyType, latencyDurationInSeconds: number, userFact: IUserFact) {\r\n\tlet userFactTime: string;\r\n\tswitch (latencyType) {\r\n\t\tcase UserFactLatencyType.None:\r\n\t\t\tbreak;\r\n\t\tcase UserFactLatencyType.SourceDateTime:\r\n\t\t\tuserFactTime = userFact.sourceDateTime;\r\n\t\t\tbreak;\r\n\t\tcase UserFactLatencyType.StorageDateTime:\r\n\t\t\tuserFactTime = userFact.storageDateTime;\r\n\t\t\tbreak;\r\n\t\tcase UserFactLatencyType.ClientIngestionDateTime:\r\n\t\t\tuserFactTime = userFact.clientIngestionDateTime;\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tassertNever(latencyType);\r\n\t\t}\r\n\r\n\tif (!isNOU(userFactTime)) {\r\n\t\tconst userFactTimeInMilliseconds = Date.parse(userFactTime);\r\n\t\tconst currentTimeInMilliseconds = Date.now();\r\n\r\n\t\treturn currentTimeInMilliseconds - userFactTimeInMilliseconds <= (latencyDurationInSeconds * 1000);\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction compareBooleanValues(userFactSpecValue: any, rawUserFact: IUserFact, comparator: ComparatorType) {\r\n\tconst rawUserFactValueInBoolean = JSON.parse(rawUserFact.userFactValue.toLowerCase());\r\n\treturn compareValues(!!userFactSpecValue, !!rawUserFactValueInBoolean, comparator);\r\n}\r\n\r\nfunction compareDateTimeUTCValues(userFactSpecValue: string, rawUserFact: IUserFact, comparator: ComparatorType) {\r\n\tconst rawUserFactValueInMilliseconds = Date.parse(rawUserFact.userFactValue);\r\n\tif (!isAValidNumber(rawUserFactValueInMilliseconds, rawUserFact.userFactValue, rawUserFact.userFactName)) {\r\n\t\treturn false;\r\n\t}\r\n\tconst userFactSpecValueInMilliseconds = Date.parse(userFactSpecValue);\r\n\tif (!isAValidNumber(userFactSpecValueInMilliseconds, userFactSpecValue, null, UserFactType.DateTimeUTC)) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn compareValues(userFactSpecValueInMilliseconds, rawUserFactValueInMilliseconds, comparator);\r\n}\r\n\r\nfunction compareNumberValues(userFactSpecValue: number, rawUserFact: IUserFact, comparator: ComparatorType) {\r\n\tconst rawUserFactValueInNumber = parseInt(rawUserFact.userFactValue, 10);\r\n\tif (!isAValidNumber(rawUserFactValueInNumber, rawUserFact.userFactValue, rawUserFact.userFactName)) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn compareValues(userFactSpecValue, rawUserFactValueInNumber, comparator);\r\n}\r\n\r\nfunction compareStringValues(userFactSpecValue: string, rawUserFact: IUserFact, comparator: ComparatorType) {\r\n\treturn compareValues(userFactSpecValue.toLowerCase(), rawUserFact.userFactValue.toLowerCase(), comparator);\r\n}\r\n\r\nfunction compareTimeIntervalValues(\r\n\tuserFactSpecValue: number, rawUserFact: IUserFact, comparator: ComparatorType, intervalType: CurrentTimeIntervalType) {\r\n\tconst rawUserFactValueInMilliseconds = Date.parse(rawUserFact.userFactValue);\r\n\tif (!isAValidNumber(rawUserFactValueInMilliseconds, rawUserFact.userFactValue, rawUserFact.userFactName)) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Diff from now and users input date\r\n\t// IntervalTo - Internval to current date from fact date (fact date is expected to be before current date)\r\n\t// IntervalFrom - Interval from current date to fact date (fact date is expected to be after current date)\r\n\tconst currentTimeInMilliseconds = Date.now();\r\n\tconst currentDateDiff = intervalType === CurrentTimeIntervalType.IntervalTo ?\r\n\t\t(currentTimeInMilliseconds - rawUserFactValueInMilliseconds) : (rawUserFactValueInMilliseconds - currentTimeInMilliseconds);\r\n\tif (currentDateDiff < 0) {\r\n\t\tFloodgateEngine.getTelemetryLogger().log_Event(\r\n\t\t\tTelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Mismatch, {\r\n\t\t\t\tErrorMessage: `Interval type not acceptable - { Spec: ${userFactSpecValue}, Name: \"${rawUserFact.userFactName}\" }`,\r\n\t\t\t\tTimeMilliseconds: currentDateDiff,\r\n\t\t\t\tType: `${intervalType}`,\r\n\t\t\t},\r\n\t\t);\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tconst dayInMilliseconds = 86400000;\r\n\tconst userFactSpecValueInMilliseconds = userFactSpecValue * dayInMilliseconds;\r\n\r\n\t// check if the above diff satisfies the comparison criteria\r\n\treturn compareValues(userFactSpecValueInMilliseconds, currentDateDiff, comparator);\r\n}\r\n\r\nfunction compareListValues<T extends string | boolean | number>(userFactSpecValue: T[], rawUserFact: IUserFact, comparator: ComparatorType) {\r\n\treturn compareValues(userFactSpecValue, rawUserFact.userFactValue as T, comparator);\r\n}\r\n\r\nfunction isComparatorTypeSupported(comparator: ComparatorType, supportedComparatorTypes: ComparatorType[]) {\r\n\treturn supportedComparatorTypes.indexOf(comparator) !== -1;\r\n}\r\n\r\nfunction compareValues<T extends string | boolean | number>(\r\n\tuserFactSpecValue: T | T[], userFactRawValue: T, comparator: ComparatorType): boolean {\r\n\tswitch (comparator) {\r\n\t\tcase ComparatorType.Equal:\r\n\t\t\treturn userFactRawValue === userFactSpecValue;\r\n\t\tcase ComparatorType.NotEqual:\r\n\t\t\treturn userFactRawValue !== userFactSpecValue;\r\n\t\tcase ComparatorType.GreaterThan:\r\n\t\t\treturn userFactRawValue > userFactSpecValue;\r\n\t\tcase ComparatorType.GreaterThanOrEqual:\r\n\t\t\treturn userFactRawValue >= userFactSpecValue;\r\n\t\tcase ComparatorType.LessThan:\r\n\t\t\treturn userFactRawValue < userFactSpecValue;\r\n\t\tcase ComparatorType.LessThanOrEqual:\r\n\t\t\treturn userFactRawValue <= userFactSpecValue;\r\n\t\tcase ComparatorType.In:\r\n\t\t\treturn isFactValueInTargetItem(userFactSpecValue, userFactRawValue);\r\n\t\tcase ComparatorType.NotIn:\r\n\t\t\treturn !isFactValueInTargetItem(userFactSpecValue, userFactRawValue);\r\n\t\tcase ComparatorType.InverseIn:\r\n\t\t\treturn isFactValueInTargetItem(userFactRawValue, userFactSpecValue as T);\r\n\t\tcase ComparatorType.InverseNotIn:\r\n\t\t\treturn !isFactValueInTargetItem(userFactRawValue, userFactSpecValue as T);\r\n\t\tdefault:\r\n\t\t\tassertNever(comparator);\r\n\t}\r\n}\r\n\r\nfunction assertNever(_: never) {\r\n\treturn false;\r\n}\r\n\r\nfunction isFactValueInTargetItem<T>(userFactTargetValues: T | T[], userFactRawValue: T): boolean {\r\n\tif (typeof userFactRawValue === \"string\") {\r\n\t\tconst factValue = userFactRawValue.toLowerCase();\r\n\t\tif (typeof userFactTargetValues === \"string\") {\r\n\t\t\t// both the inputs are strings, do a plain indexOf\r\n\t\t\treturn (userFactTargetValues as string).toLowerCase().indexOf(factValue) !== -1;\r\n\t\t}\r\n\r\n\t\tif (isArray(userFactTargetValues)) {\r\n\t\t\tconst specValues = userFactTargetValues as T[];\r\n\t\t\treturn specValues.some((specValue) => specValue && specValue.toString().toLowerCase() === factValue);\r\n\t\t}\r\n\t}\r\n\r\n\tif (isArray(userFactTargetValues)) {\r\n\t\treturn (userFactTargetValues as T[]).indexOf(userFactRawValue) !== -1;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nfunction isAValidNumber(numberValue: number, value: string, rawUserFactName: string, factType?: UserFactType) {\r\n\tif (!isNumber(numberValue)) {\r\n\t\tlet errorMessage = `User fact ${rawUserFactName} has invalid value ${value}`;\r\n\t\tif (factType) {\r\n\t\t\terrorMessage = `Invalid value ${value} was provided for user fact of type ${factType}`;\r\n\t\t}\r\n\r\n\t\tFloodgateEngine.getTelemetryLogger().log_Error(\r\n\t\t\tTelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,\r\n\t\t\terrorMessage);\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n","(function webpackUniversalModuleDefinition(root, factory) {\r\n\tif(typeof exports === 'object' && typeof module === 'object')\r\n\t\tmodule.exports = factory();\r\n\telse if(typeof define === 'function' && define.amd)\r\n\t\tdefine([], factory);\r\n\telse {\r\n\t\tvar a = factory();\r\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\r\n\t}\r\n})(this, function() {\r\nreturn /******/ (function(modules) { // webpackBootstrap\r\n/******/ \t// The module cache\r\n/******/ \tvar installedModules = {};\r\n/******/\r\n/******/ \t// The require function\r\n/******/ \tfunction __webpack_require__(moduleId) {\r\n/******/\r\n/******/ \t\t// Check if module is in cache\r\n/******/ \t\tif(installedModules[moduleId]) {\r\n/******/ \t\t\treturn installedModules[moduleId].exports;\r\n/******/ \t\t}\r\n/******/ \t\t// Create a new module (and put it into the cache)\r\n/******/ \t\tvar module = installedModules[moduleId] = {\r\n/******/ \t\t\ti: moduleId,\r\n/******/ \t\t\tl: false,\r\n/******/ \t\t\texports: {}\r\n/******/ \t\t};\r\n/******/\r\n/******/ \t\t// Execute the module function\r\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\r\n/******/\r\n/******/ \t\t// Flag the module as loaded\r\n/******/ \t\tmodule.l = true;\r\n/******/\r\n/******/ \t\t// Return the exports of the module\r\n/******/ \t\treturn module.exports;\r\n/******/ \t}\r\n/******/\r\n/******/\r\n/******/ \t// expose the modules object (__webpack_modules__)\r\n/******/ \t__webpack_require__.m = modules;\r\n/******/\r\n/******/ \t// expose the module cache\r\n/******/ \t__webpack_require__.c = installedModules;\r\n/******/\r\n/******/ \t// identity function for calling harmony imports with the correct context\r\n/******/ \t__webpack_require__.i = function(value) { return value; };\r\n/******/\r\n/******/ \t// define getter function for harmony exports\r\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\r\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\r\n/******/ \t\t\tObject.defineProperty(exports, name, {\r\n/******/ \t\t\t\tconfigurable: false,\r\n/******/ \t\t\t\tenumerable: true,\r\n/******/ \t\t\t\tget: getter\r\n/******/ \t\t\t});\r\n/******/ \t\t}\r\n/******/ \t};\r\n/******/\r\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\r\n/******/ \t__webpack_require__.n = function(module) {\r\n/******/ \t\tvar getter = module && module.__esModule ?\r\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\r\n/******/ \t\t\tfunction getModuleExports() { return module; };\r\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\r\n/******/ \t\treturn getter;\r\n/******/ \t};\r\n/******/\r\n/******/ \t// Object.prototype.hasOwnProperty.call\r\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\r\n/******/\r\n/******/ \t// __webpack_public_path__\r\n/******/ \t__webpack_require__.p = \"\";\r\n/******/\r\n/******/ \t// Load entry module and return exports\r\n/******/ \treturn __webpack_require__(__webpack_require__.s = 15);\r\n/******/ })\r\n/************************************************************************/\r\n/******/ ([\r\n/* 0 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\n/**\r\n* microsoft.bond.primitives.ts\r\n* Copyright: Microsoft 2016\r\n*/\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Int64 = /** @class */ (function () {\r\n    // BUG!!: need implement, currently, just handle 32bits number\r\n    function Int64(numberStr) {\r\n        this.low = 0;\r\n        this.high = 0;\r\n        this.low = parseInt(numberStr, 10);\r\n        if (this.low < 0) {\r\n            this.high = -1;\r\n        }\r\n    }\r\n    Int64.prototype.Equals = function (numberStr) {\r\n        var tmp = new Int64(numberStr);\r\n        return this.low === tmp.low && this.high === tmp.high;\r\n    };\r\n    return Int64;\r\n}());\r\nexports.Int64 = Int64;\r\nvar UInt64 = /** @class */ (function () {\r\n    // BUG!!: need implement, currently, just handle 32bits number\r\n    function UInt64(numberStr) {\r\n        this.low = 0;\r\n        this.high = 0;\r\n        this.low = parseInt(numberStr, 10);\r\n    }\r\n    UInt64.prototype.Equals = function (numberStr) {\r\n        var tmp = new UInt64(numberStr);\r\n        return this.low === tmp.low && this.high === tmp.high;\r\n    };\r\n    return UInt64;\r\n}());\r\nexports.UInt64 = UInt64;\r\nvar Number = /** @class */ (function () {\r\n    function Number() {\r\n    }\r\n    Number.ToByte = function (value) {\r\n        return this.ToUInt8(value);\r\n    };\r\n    Number.ToInt16 = function (value) {\r\n        var signMask = (value & 0x8000) << 16 >> 16;\r\n        return (value & 0x7fff) | signMask;\r\n    };\r\n    Number.ToInt32 = function (value) {\r\n        var signMask = (value & 0x80000000);\r\n        return (value & 0x7fffffff) | signMask;\r\n    };\r\n    Number.ToUInt8 = function (value) {\r\n        return value & 0xff;\r\n    };\r\n    Number.ToUInt32 = function (value) {\r\n        return value & 0xffffffff;\r\n    };\r\n    return Number;\r\n}());\r\nexports.Number = Number;\r\n\r\n\r\n/***/ }),\r\n/* 1 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\n/**\r\n* Enums.ts\r\n* Author: Abhilash Panwar (abpanwar)\r\n* Copyright: Microsoft 2016\r\n* Common enum values used in the SDK.\r\n*/\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AWTPiiKind;\r\n(function (AWTPiiKind) {\r\n    AWTPiiKind[AWTPiiKind[\"NotSet\"] = 0] = \"NotSet\";\r\n    AWTPiiKind[AWTPiiKind[\"DistinguishedName\"] = 1] = \"DistinguishedName\";\r\n    AWTPiiKind[AWTPiiKind[\"GenericData\"] = 2] = \"GenericData\";\r\n    AWTPiiKind[AWTPiiKind[\"IPV4Address\"] = 3] = \"IPV4Address\";\r\n    AWTPiiKind[AWTPiiKind[\"IPv6Address\"] = 4] = \"IPv6Address\";\r\n    AWTPiiKind[AWTPiiKind[\"MailSubject\"] = 5] = \"MailSubject\";\r\n    AWTPiiKind[AWTPiiKind[\"PhoneNumber\"] = 6] = \"PhoneNumber\";\r\n    AWTPiiKind[AWTPiiKind[\"QueryString\"] = 7] = \"QueryString\";\r\n    AWTPiiKind[AWTPiiKind[\"SipAddress\"] = 8] = \"SipAddress\";\r\n    AWTPiiKind[AWTPiiKind[\"SmtpAddress\"] = 9] = \"SmtpAddress\";\r\n    AWTPiiKind[AWTPiiKind[\"Identity\"] = 10] = \"Identity\";\r\n    AWTPiiKind[AWTPiiKind[\"Uri\"] = 11] = \"Uri\";\r\n    AWTPiiKind[AWTPiiKind[\"Fqdn\"] = 12] = \"Fqdn\";\r\n    // Supports scrubbing of the last octet in a IPV4 address. E.g. 10.121.227.147 becomes 10.121.227.*\r\n    AWTPiiKind[AWTPiiKind[\"IPV4AddressLegacy\"] = 13] = \"IPV4AddressLegacy\";\r\n})(AWTPiiKind = exports.AWTPiiKind || (exports.AWTPiiKind = {}));\r\n\r\n\r\n/***/ }),\r\n/* 2 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\n/**\r\n* AWTBondSerializer.ts\r\n* Author: Brent Erickson (brericks) and Abhilash Panwar (abpanwar)\r\n* Copyright: Microsoft 2016\r\n* Class to handler bond serialization.\r\n*/\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Bond = __webpack_require__(9);\r\nvar Enums_1 = __webpack_require__(1);\r\nvar Utils = __webpack_require__(3);\r\nvar AWTBondSerializer = /** @class */ (function () {\r\n    function AWTBondSerializer() {\r\n    }\r\n    AWTBondSerializer.getPayloadBlob = function (requestDictionary, tokenCount) {\r\n        var stream = new Bond.IO.MemoryStream();\r\n        var writer = new Bond.CompactBinaryProtocolWriter(stream);\r\n        // Begin ClientCollector request\r\n        //Write TokenToDataPackagesMap\r\n        writer.WriteFieldBegin(Bond.BondDataType.BT_MAP, 3);\r\n        writer.WriteMapContainerBegin(tokenCount, Bond.BondDataType.BT_STRING, Bond.BondDataType.BT_LIST);\r\n        Object.keys(requestDictionary).forEach(function (token) {\r\n            //write token\r\n            writer.WriteString(token);\r\n            var dataPackage = requestDictionary[token];\r\n            // Write list of DataPackages\r\n            writer.WriteContainerBegin(1, Bond.BondDataType.BT_STRUCT);\r\n            // Source\r\n            writer.WriteFieldBegin(Bond.BondDataType.BT_STRING, 2);\r\n            writer.WriteString('act_default_source');\r\n            // DataPackageId\r\n            writer.WriteFieldBegin(Bond.BondDataType.BT_STRING, 5);\r\n            writer.WriteString(Utils.newGuid());\r\n            // Timestamp\r\n            writer.WriteFieldBegin(Bond.BondDataType.BT_INT64, 6);\r\n            writer.WriteInt64(Utils.numberToBondInt64(Date.now()));\r\n            // Records\r\n            writer.WriteFieldBegin(Bond.BondDataType.BT_LIST, 8);\r\n            writer.WriteContainerBegin(dataPackage.length, Bond.BondDataType.BT_STRUCT);\r\n            for (var i = 0; i < dataPackage.length; ++i) {\r\n                writer.WriteBlob(dataPackage[i]);\r\n            }\r\n            writer.WriteStructEnd(false);\r\n        });\r\n        // End ClientCollector\r\n        writer.WriteStructEnd(false);\r\n        return stream.GetBuffer();\r\n    };\r\n    // As per mappings at https://skype.visualstudio.com/SCC/F.S4L.FUNDAMENTALS/_git/infrastructure_data_clienttelemetry?\r\n    // path=%2Fclienttelemetry%2Fsrc%2Fbond%2FDataPackage.bond&version=GBdev2&_a=contents\r\n    // Requires that the values of AWTEventData.properties must all be AWTEventProperty\r\n    AWTBondSerializer.getEventBlob = function (eventData) {\r\n        var stream = new Bond.IO.MemoryStream();\r\n        var writer = new Bond.CompactBinaryProtocolWriter(stream);\r\n        // ID\r\n        writer.WriteFieldBegin(Bond.BondDataType.BT_STRING, 1);\r\n        writer.WriteString(eventData.id);\r\n        // Timestamp\r\n        writer.WriteFieldBegin(Bond.BondDataType.BT_INT64, 3);\r\n        writer.WriteInt64(Utils.numberToBondInt64(eventData.timestamp));\r\n        // Type\r\n        writer.WriteFieldBegin(Bond.BondDataType.BT_STRING, 5);\r\n        writer.WriteString(eventData.type);\r\n        // Event Type\r\n        writer.WriteFieldBegin(Bond.BondDataType.BT_STRING, 6);\r\n        writer.WriteString(eventData.name);\r\n        var propsString = [];\r\n        var piiProps = [];\r\n        // Iterate across event data properties and separate based on pii\r\n        Object.keys(eventData.properties).forEach(function (key) {\r\n            var property = eventData.properties[key];\r\n            if (property.pii === Enums_1.AWTPiiKind.NotSet) {\r\n                propsString.push(key);\r\n            }\r\n            else {\r\n                piiProps.push(key);\r\n            }\r\n        });\r\n        //Extension map\r\n        if (propsString.length) {\r\n            writer.WriteFieldBegin(Bond.BondDataType.BT_MAP, 13);\r\n            writer.WriteMapContainerBegin(propsString.length, Bond.BondDataType.BT_STRING, Bond.BondDataType.BT_STRING);\r\n            propsString.forEach(function (name) {\r\n                writer.WriteString(name);\r\n                writer.WriteString(eventData.properties[name].value);\r\n            });\r\n        }\r\n        // Pii\r\n        if (piiProps.length) {\r\n            writer.WriteFieldBegin(Bond.BondDataType.BT_MAP, 30);\r\n            writer.WriteMapContainerBegin(piiProps.length, Bond.BondDataType.BT_STRING, Bond.BondDataType.BT_STRUCT);\r\n            piiProps.forEach(function (name) {\r\n                writer.WriteString(name);\r\n                // PII Data\r\n                // O365 scrubber type\r\n                writer.WriteFieldBegin(Bond.BondDataType.BT_INT32, 1);\r\n                writer.WriteInt32(1);\r\n                // PII Kind\r\n                writer.WriteFieldBegin(Bond.BondDataType.BT_INT32, 2);\r\n                writer.WriteInt32(eventData.properties[name].pii);\r\n                // Value\r\n                writer.WriteFieldBegin(Bond.BondDataType.BT_STRING, 3);\r\n                writer.WriteString(eventData.properties[name].value);\r\n                writer.WriteStructEnd(false);\r\n            });\r\n        }\r\n        writer.WriteStructEnd(false);\r\n        return stream.GetBuffer();\r\n    };\r\n    AWTBondSerializer.base64Encode = function (data) {\r\n        return Bond.Encoding.Base64.GetString(data);\r\n    };\r\n    return AWTBondSerializer;\r\n}());\r\nexports.default = AWTBondSerializer;\r\n\r\n\r\n/***/ }),\r\n/* 3 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n* Utils.ts\r\n* Author: Brent Erickson (brericks) and Abhilash Panwar (abpanwar)\r\n* Copyright: Microsoft 2016\r\n* Common functions used in the SDK.\r\n*/\r\nvar microsoft_bond_primitives_1 = __webpack_require__(0);\r\nvar GuidRegex = /[xy]/g;\r\nfunction numberToBondInt64(value) {\r\n    // Construct bond timestamp for aria\r\n    var bond_value = new microsoft_bond_primitives_1.Int64('0');\r\n    bond_value.low = value & 0xffffffff;\r\n    bond_value.high = Math.floor(value / 0x100000000);\r\n    return bond_value;\r\n}\r\nexports.numberToBondInt64 = numberToBondInt64;\r\nfunction newGuid() {\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(GuidRegex, function (c) {\r\n        var r = (Math.random() * 16 | 0), v = (c === 'x' ? r : r & 0x3 | 0x8);\r\n        return v.toString(16);\r\n    });\r\n}\r\nexports.newGuid = newGuid;\r\nfunction isPii(value) {\r\n    if (!isNaN(value) && value !== null && value >= 0 && value <= 13) {\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\nexports.isPii = isPii;\r\n\r\n\r\n/***/ }),\r\n/* 4 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n* Version.ts\r\n* Author: Abhilash Panwar (abpanwar)\r\n* Copyright: Microsoft 2016\r\n* Class for SDK version.\r\n*/\r\nexports.Version = '1.2.2';\r\nexports.FullVersionString = 'AWT-Web-CJS-' + exports.Version;\r\n\r\n\r\n/***/ }),\r\n/* 5 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n* AriaSDK.ts\r\n* Author: Abhilash Panwar (abpanwar)\r\n* Copyright: Microsoft 2016\r\n*/\r\nvar Enums_1 = __webpack_require__(1);\r\nexports.AWTPiiKind = Enums_1.AWTPiiKind;\r\nvar AWT_1 = __webpack_require__(13);\r\nexports.AWT = AWT_1.default;\r\nexports.AWT_COLLECTOR_URL_UNITED_STATES = 'https://us.pipe.aria.microsoft.com/Collector/3.0/';\r\nexports.AWT_COLLECTOR_URL_GERMANY = 'https://de.pipe.aria.microsoft.com/Collector/3.0/';\r\nexports.AWT_COLLECTOR_URL_JAPAN = 'https://jp.pipe.aria.microsoft.com/Collector/3.0/';\r\nexports.AWT_COLLECTOR_URL_AUSTRALIA = 'https://au.pipe.aria.microsoft.com/Collector/3.0/';\r\nexports.AWT_COLLECTOR_URL_EUROPE = 'https://eu.pipe.aria.microsoft.com/Collector/3.0/';\r\n\r\n\r\n/***/ }),\r\n/* 6 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\n/**\r\n* bond_const.ts\r\n* Copyright: Microsoft 2016\r\n*/\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n//------------------------------------------------------------------------------\r\n// <auto-generated>\r\n//     This code was generated by a tool.\r\n//\r\n//     Tool     : bondc, Version=3.0.1, Build=bond-git.debug.not\r\n//     Template : Microsoft.Bond.Rules.dll#TypeScript.tt\r\n//     File     : bond_const.ts\r\n//\r\n//     Changes to this file may cause incorrect behavior and will be lost when\r\n//     the code is regenerated.\r\n// </auto-generated>\r\n//------------------------------------------------------------------------------\r\nvar BondDataType;\r\n(function (BondDataType) {\r\n    BondDataType[BondDataType[\"BT_STOP\"] = 0] = \"BT_STOP\";\r\n    BondDataType[BondDataType[\"BT_STOP_BASE\"] = 1] = \"BT_STOP_BASE\";\r\n    BondDataType[BondDataType[\"BT_UINT8\"] = 3] = \"BT_UINT8\";\r\n    BondDataType[BondDataType[\"BT_UINT32\"] = 5] = \"BT_UINT32\";\r\n    BondDataType[BondDataType[\"BT_UINT64\"] = 6] = \"BT_UINT64\";\r\n    BondDataType[BondDataType[\"BT_STRING\"] = 9] = \"BT_STRING\";\r\n    BondDataType[BondDataType[\"BT_STRUCT\"] = 10] = \"BT_STRUCT\";\r\n    BondDataType[BondDataType[\"BT_LIST\"] = 11] = \"BT_LIST\";\r\n    BondDataType[BondDataType[\"BT_MAP\"] = 13] = \"BT_MAP\";\r\n    BondDataType[BondDataType[\"BT_INT32\"] = 16] = \"BT_INT32\";\r\n    BondDataType[BondDataType[\"BT_INT64\"] = 17] = \"BT_INT64\";\r\n    BondDataType[BondDataType[\"BT_UNAVAILABLE\"] = 127] = \"BT_UNAVAILABLE\";\r\n})(BondDataType = exports.BondDataType || (exports.BondDataType = {}));\r\n\r\n\r\n/***/ }),\r\n/* 7 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\n/**\r\n* microsoft.bond.encoding.ts\r\n* Copyright: Microsoft 2016\r\n*/\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar microsoft_bond_primitives_1 = __webpack_require__(0);\r\nvar Utf8 = /** @class */ (function () {\r\n    function Utf8() {\r\n    }\r\n    Utf8.GetBytes = function (value) {\r\n        var array = [];\r\n        for (var i = 0; i < value.length; ++i) {\r\n            var char = value.charCodeAt(i);\r\n            if (char < 0x80) {\r\n                array.push(char);\r\n            }\r\n            else if (char < 0x800) {\r\n                array.push(0xc0 | (char >> 6), 0x80 | (char & 0x3f));\r\n            }\r\n            else if (char < 0xd800 || char >= 0xe000) {\r\n                array.push(0xe0 | (char >> 12), 0x80 | ((char >> 6) & 0x3f), 0x80 | (char & 0x3f));\r\n            }\r\n            else {\r\n                char = 0x10000 + (((char & 0x3ff) << 10) | (value.charCodeAt(++i) & 0x3ff));\r\n                array.push(0xf0 | (char >> 18), 0x80 | ((char >> 12) & 0x3f), 0x80 | ((char >> 6) & 0x3f), 0x80 | (char & 0x3f));\r\n            }\r\n        }\r\n        return array;\r\n    };\r\n    return Utf8;\r\n}());\r\nexports.Utf8 = Utf8;\r\nvar Base64 = /** @class */ (function () {\r\n    function Base64() {\r\n    }\r\n    Base64.GetString = function (inArray) {\r\n        var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\r\n        var output = [];\r\n        var paddingBytes = inArray.length % 3;\r\n        var toBase64 = function (num) {\r\n            return [lookup.charAt((num >> 18) & 0x3F),\r\n                lookup.charAt((num >> 12) & 0x3F),\r\n                lookup.charAt((num >> 6) & 0x3F),\r\n                lookup.charAt(num & 0x3F)].join('');\r\n        };\r\n        for (var i = 0, length_1 = inArray.length - paddingBytes; i < length_1; i += 3) {\r\n            var temp = (inArray[i] << 16) + (inArray[i + 1] << 8) + (inArray[i + 2]);\r\n            output.push(toBase64(temp));\r\n        }\r\n        switch (paddingBytes) {\r\n            case 1:\r\n                var temp = inArray[inArray.length - 1];\r\n                output.push(lookup.charAt(temp >> 2));\r\n                output.push(lookup.charAt((temp << 4) & 0x3F));\r\n                output.push('==');\r\n                break;\r\n            case 2:\r\n                var temp2 = (inArray[inArray.length - 2] << 8) + (inArray[inArray.length - 1]);\r\n                output.push(lookup.charAt(temp2 >> 10));\r\n                output.push(lookup.charAt((temp2 >> 4) & 0x3F));\r\n                output.push(lookup.charAt((temp2 << 2) & 0x3F));\r\n                output.push('=');\r\n                break;\r\n        }\r\n        return output.join('');\r\n    };\r\n    return Base64;\r\n}());\r\nexports.Base64 = Base64;\r\nvar Varint = /** @class */ (function () {\r\n    function Varint() {\r\n    }\r\n    Varint.GetBytes = function (value) {\r\n        var array = [];\r\n        while (value & 0xffffff80) {\r\n            array.push((value & 0x7f) | 0x80);\r\n            value >>>= 7;\r\n        }\r\n        array.push(value & 0x7f);\r\n        return array;\r\n    };\r\n    return Varint;\r\n}());\r\nexports.Varint = Varint;\r\nvar Varint64 = /** @class */ (function () {\r\n    function Varint64() {\r\n    }\r\n    Varint64.GetBytes = function (value) {\r\n        var low = value.low;\r\n        var high = value.high;\r\n        var array = [];\r\n        while (high || (0xffffff80 & low)) {\r\n            array.push((low & 0x7f) | 0x80);\r\n            low = ((high & 0x7f) << 25) | (low >>> 7);\r\n            high >>>= 7;\r\n        }\r\n        array.push(low & 0x7f);\r\n        return array;\r\n    };\r\n    return Varint64;\r\n}());\r\nexports.Varint64 = Varint64;\r\nvar Zigzag = /** @class */ (function () {\r\n    function Zigzag() {\r\n    }\r\n    Zigzag.EncodeZigzag32 = function (value) {\r\n        value = microsoft_bond_primitives_1.Number.ToInt32(value);\r\n        return ((value << 1) ^ (value >> (4 /*sizeof(int)*/ * 8 - 1)));\r\n    };\r\n    Zigzag.EncodeZigzag64 = function (value) {\r\n        var low = value.low;\r\n        var high = value.high;\r\n        var tmpH = (high << 1) | (low >>> 31);\r\n        var tmpL = low << 1;\r\n        if (high & 0x80000000) {\r\n            tmpH = ~tmpH;\r\n            tmpL = ~tmpL;\r\n        }\r\n        var res = new microsoft_bond_primitives_1.UInt64('0');\r\n        res.low = tmpL;\r\n        res.high = tmpH;\r\n        return res;\r\n    };\r\n    return Zigzag;\r\n}());\r\nexports.Zigzag = Zigzag;\r\n\r\n\r\n/***/ }),\r\n/* 8 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\n/**\r\n* microsoft.bond.io.ts\r\n* Copyright: Microsoft 2016\r\n*/\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar microsoft_bond_primitives_1 = __webpack_require__(0);\r\nvar MemoryStream = /** @class */ (function () {\r\n    function MemoryStream() {\r\n        this._buffer = [];\r\n    }\r\n    /*override*/\r\n    MemoryStream.prototype.WriteByte = function (byte) {\r\n        this._buffer.push(microsoft_bond_primitives_1.Number.ToByte(byte));\r\n    };\r\n    /*override*/\r\n    MemoryStream.prototype.Write = function (buffer, offset, count) {\r\n        while (count--) {\r\n            this.WriteByte(buffer[offset++]);\r\n        }\r\n    };\r\n    /**\r\n     * Returns the array of unsigned bytes from which this stream was created.\r\n     */\r\n    MemoryStream.prototype.GetBuffer = function () {\r\n        return this._buffer;\r\n    };\r\n    return MemoryStream;\r\n}());\r\nexports.MemoryStream = MemoryStream;\r\n\r\n\r\n/***/ }),\r\n/* 9 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\n/**\r\n* microsoft.bond.ts\r\n* Copyright: Microsoft 2016\r\n*/\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar bond_const_1 = __webpack_require__(6);\r\nexports.BondDataType = bond_const_1.BondDataType;\r\nvar Encoding = __webpack_require__(7);\r\nexports.Encoding = Encoding;\r\nvar IO = __webpack_require__(8);\r\nexports.IO = IO;\r\nvar microsoft_bond_primitives_1 = __webpack_require__(0);\r\nexports.Int64 = microsoft_bond_primitives_1.Int64;\r\nexports.UInt64 = microsoft_bond_primitives_1.UInt64;\r\nexports.Number = microsoft_bond_primitives_1.Number;\r\nvar CompactBinaryProtocolWriter = /** @class */ (function () {\r\n    function CompactBinaryProtocolWriter(stream) {\r\n        this._stream = stream;\r\n    }\r\n    /*override*/\r\n    CompactBinaryProtocolWriter.prototype.WriteBlob = function (blob) {\r\n        this._stream.Write(blob, 0, blob.length);\r\n    };\r\n    /*override*/\r\n    CompactBinaryProtocolWriter.prototype.WriteContainerBegin = function (size, elementType) {\r\n        this.WriteUInt8(elementType);\r\n        this.WriteUInt32(size);\r\n    };\r\n    /*override*/\r\n    CompactBinaryProtocolWriter.prototype.WriteMapContainerBegin = function (size, keyType, valueType) {\r\n        this.WriteUInt8(keyType);\r\n        this.WriteUInt8(valueType);\r\n        this.WriteUInt32(size);\r\n    };\r\n    /*override*/\r\n    CompactBinaryProtocolWriter.prototype.WriteFieldBegin = function (type, id) {\r\n        if (id <= 5) {\r\n            this._stream.WriteByte(type | (id << 5));\r\n        }\r\n        else if (id <= 0xff) {\r\n            this._stream.WriteByte(type | (6 << 5));\r\n            this._stream.WriteByte(id);\r\n        }\r\n        else {\r\n            this._stream.WriteByte(type | (7 << 5));\r\n            this._stream.WriteByte(id);\r\n            this._stream.WriteByte(id >> 8);\r\n        }\r\n    };\r\n    /*override*/\r\n    CompactBinaryProtocolWriter.prototype.WriteInt32 = function (value) {\r\n        value = Encoding.Zigzag.EncodeZigzag32(value);\r\n        this.WriteUInt32(value);\r\n    };\r\n    /*override*/\r\n    CompactBinaryProtocolWriter.prototype.WriteInt64 = function (value) {\r\n        this.WriteUInt64(Encoding.Zigzag.EncodeZigzag64(value));\r\n    };\r\n    /*override*/\r\n    CompactBinaryProtocolWriter.prototype.WriteString = function (value) {\r\n        if (value === '') {\r\n            this.WriteUInt32(0 /*length*/);\r\n        }\r\n        else {\r\n            var array = Encoding.Utf8.GetBytes(value);\r\n            this.WriteUInt32(array.length);\r\n            this._stream.Write(array, 0, array.length);\r\n        }\r\n    };\r\n    /*override*/\r\n    CompactBinaryProtocolWriter.prototype.WriteStructEnd = function (isBase) {\r\n        this.WriteUInt8(isBase ? bond_const_1.BondDataType.BT_STOP_BASE : bond_const_1.BondDataType.BT_STOP);\r\n    };\r\n    /*override*/\r\n    CompactBinaryProtocolWriter.prototype.WriteUInt32 = function (value) {\r\n        var array = Encoding.Varint.GetBytes(microsoft_bond_primitives_1.Number.ToUInt32(value));\r\n        this._stream.Write(array, 0, array.length);\r\n    };\r\n    /*override*/\r\n    CompactBinaryProtocolWriter.prototype.WriteUInt64 = function (value) {\r\n        var array = Encoding.Varint64.GetBytes(value);\r\n        this._stream.Write(array, 0, array.length);\r\n    };\r\n    /*override*/\r\n    CompactBinaryProtocolWriter.prototype.WriteUInt8 = function (value) {\r\n        this._stream.WriteByte(microsoft_bond_primitives_1.Number.ToUInt8(value));\r\n    };\r\n    return CompactBinaryProtocolWriter;\r\n}());\r\nexports.CompactBinaryProtocolWriter = CompactBinaryProtocolWriter;\r\n\r\n\r\n/***/ }),\r\n/* 10 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar SecToMsMultiplier = 1000;\r\nvar AWTKillSwitch = /** @class */ (function () {\r\n    function AWTKillSwitch() {\r\n        this._killedTokenDictionary = {};\r\n    }\r\n    AWTKillSwitch.prototype.setKillSwitchTenants = function (killTokens, killDuration) {\r\n        var _this = this;\r\n        if (killTokens && killDuration) {\r\n            try {\r\n                var killedTokens = killTokens.split(',');\r\n                if (killDuration === 'this-request-only') {\r\n                    return killedTokens;\r\n                }\r\n                var durationMs_1 = parseInt(killDuration, 10) * SecToMsMultiplier;\r\n                killedTokens.forEach(function (token) {\r\n                    _this._killedTokenDictionary[token] = Date.now() + durationMs_1;\r\n                });\r\n            }\r\n            catch (ex) {\r\n                return [];\r\n            }\r\n        }\r\n        return [];\r\n    };\r\n    AWTKillSwitch.prototype.isTenantKilled = function (tenantToken) {\r\n        if (this._killedTokenDictionary[tenantToken] !== undefined && this._killedTokenDictionary[tenantToken] > Date.now()) {\r\n            return true;\r\n        }\r\n        delete this._killedTokenDictionary[tenantToken];\r\n        return false;\r\n    };\r\n    return AWTKillSwitch;\r\n}());\r\nexports.default = AWTKillSwitch;\r\n\r\n\r\n/***/ }),\r\n/* 11 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AWTBondSerializer_1 = __webpack_require__(2);\r\nvar AWTRecordBatcher = /** @class */ (function () {\r\n    function AWTRecordBatcher(_maxRequestSize, _outboundQueue) {\r\n        this._maxRequestSize = _maxRequestSize;\r\n        this._outboundQueue = _outboundQueue;\r\n        this._currentBatch = {};\r\n        this._currentBatchSize = 0;\r\n    }\r\n    AWTRecordBatcher.prototype.addEventToBatch = function (event) {\r\n        var serializedEvent = AWTBondSerializer_1.default.getEventBlob(event);\r\n        if (serializedEvent.length > this._maxRequestSize) {\r\n            //single event too big\r\n            return;\r\n        }\r\n        if (this._currentBatchSize + serializedEvent.length > this._maxRequestSize) {\r\n            this.flushBatch();\r\n        }\r\n        else {\r\n            if (this._currentBatch[event.tenantToken] === undefined) {\r\n                this._currentBatch[event.tenantToken] = [];\r\n            }\r\n            this._currentBatch[event.tenantToken].push(serializedEvent);\r\n            this._currentBatchSize += serializedEvent.length;\r\n        }\r\n    };\r\n    AWTRecordBatcher.prototype.flushBatch = function () {\r\n        if (this._currentBatchSize > 0) {\r\n            this._outboundQueue.push(this._currentBatch);\r\n            this._currentBatch = {};\r\n            this._currentBatchSize = 0;\r\n        }\r\n    };\r\n    return AWTRecordBatcher;\r\n}());\r\nexports.default = AWTRecordBatcher;\r\n\r\n\r\n/***/ }),\r\n/* 12 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n* AWTRetryPolicy.ts\r\n* Author: Abhilash Panwar (abpanwar)\r\n* Copyright: Microsoft 2016\r\n* Class for retry policy.\r\n*/\r\nvar RandomizationLowerThreshold = 0.8;\r\nvar RandomizationUpperThreshold = 1.2;\r\nvar BaseBackoff = 3000;\r\nvar MaxBackoff = 120000;\r\nvar AWTRetryPolicy = /** @class */ (function () {\r\n    function AWTRetryPolicy() {\r\n    }\r\n    AWTRetryPolicy.shouldRetryForStatus = function (httpStatusCode) {\r\n        /* The below expression reads that we should only retry for:\r\n            - HttpStatusCodes that are smaller than 300.\r\n            - HttpStatusCodes greater or equal to 500 (except for 501-NotImplement\r\n              and 505-HttpVersionNotSupport).\r\n            - HttpStatusCode 408-RequestTimeout.\r\n           This is based on Microsoft.WindowsAzure.Storage.RetryPolicies.ExponentialRetry class */\r\n        return !((httpStatusCode >= 300 && httpStatusCode < 500 && httpStatusCode !== 408)\r\n            || (httpStatusCode === 501)\r\n            || (httpStatusCode === 505));\r\n    };\r\n    AWTRetryPolicy.getMillisToBackoffForRetry = function (retriesSoFar) {\r\n        var waitDuration = 0;\r\n        var minBackoff = BaseBackoff * RandomizationLowerThreshold;\r\n        var maxBackoff = BaseBackoff * RandomizationUpperThreshold;\r\n        var randomBackoff = Math.floor(Math.random() * (maxBackoff - minBackoff)) + minBackoff;\r\n        waitDuration = Math.pow(4, retriesSoFar) * randomBackoff;\r\n        return Math.min(waitDuration, MaxBackoff);\r\n    };\r\n    return AWTRetryPolicy;\r\n}());\r\nexports.default = AWTRetryPolicy;\r\n\r\n\r\n/***/ }),\r\n/* 13 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Enums_1 = __webpack_require__(1);\r\nvar AWTTransmissionManager_1 = __webpack_require__(14);\r\nvar Utils = __webpack_require__(3);\r\nvar Version = __webpack_require__(4);\r\nvar AllTokens = 'allTkns';\r\nvar EventNameAndTypeRegex = /^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/;\r\nvar EventNameDotRegex = /\\./g;\r\nvar PropertyNameRegex = /^[a-zA-Z0-9](([a-zA-Z0-9|_|\\.]){0,98}[a-zA-Z0-9])?$/;\r\nvar AWT = /** @class */ (function () {\r\n    function AWT() {\r\n    }\r\n    AWT.initialize = function (tenantToken, configuration) {\r\n        if (configuration === void 0) { configuration = {}; }\r\n        if (this._isInitialized) {\r\n            // tslint:disable-next-line\r\n            throw 'Already Initialized';\r\n        }\r\n        this._defaultTenantToken = tenantToken;\r\n        this._overrideValuesFromConfig(configuration);\r\n        //Create sender\r\n        AWTTransmissionManager_1.default.initialize(this._config);\r\n        this._isInitialized = true;\r\n    };\r\n    AWT.flush = function (callback) {\r\n        if (this._isInitialized && !this._isDestroyed) {\r\n            AWTTransmissionManager_1.default.flush(callback);\r\n        }\r\n    };\r\n    AWT.flushAndTeardown = function () {\r\n        if (this._isInitialized && !this._isDestroyed) {\r\n            this._isDestroyed = true;\r\n            AWTTransmissionManager_1.default.flushAndTeardown();\r\n        }\r\n    };\r\n    AWT.setContext = function (name, property, tenantToken) {\r\n        if (tenantToken === void 0) { tenantToken = AllTokens; }\r\n        property = this._sanitizeProperty(name, property);\r\n        if (property === null) {\r\n            return;\r\n        }\r\n        if (!this._contextProperties[tenantToken]) {\r\n            this._contextProperties[tenantToken] = {};\r\n        }\r\n        this._contextProperties[tenantToken][name] = property;\r\n    };\r\n    AWT.logEvent = function (event) {\r\n        var _this = this;\r\n        if (this._isInitialized) {\r\n            if (!event.name || !event.properties) {\r\n                return;\r\n            }\r\n            event.name = event.name.toLowerCase();\r\n            event.name.replace(EventNameDotRegex, '_');\r\n            var typePrefix = '';\r\n            if (!event.type) {\r\n                event.type = 'custom';\r\n            }\r\n            else {\r\n                event.type.toLowerCase();\r\n                typePrefix = 'custom.';\r\n            }\r\n            if (!EventNameAndTypeRegex.test(event.name) || !EventNameAndTypeRegex.test(event.type)) {\r\n                return;\r\n            }\r\n            event.type = typePrefix + event.type;\r\n            if (isNaN(event.timestamp)) {\r\n                event.timestamp = (new Date()).getTime();\r\n            }\r\n            if (!event.tenantToken) {\r\n                event.tenantToken = this._defaultTenantToken;\r\n            }\r\n            event.id = Utils.newGuid();\r\n            Object.keys(event.properties).forEach(function (name) {\r\n                event.properties[name] = _this._sanitizeProperty(name, event.properties[name]);\r\n                if (event.properties[name] === null) {\r\n                    delete event.properties[name];\r\n                }\r\n            });\r\n            this._addContextIfAbsent(event, event.tenantToken);\r\n            this._addContextIfAbsent(event, AllTokens);\r\n            if (Object.keys(event.properties).length === 0) {\r\n                return;\r\n            }\r\n            this._setDefaultProperty(event, 'EventInfo.InitId', this._getInitId(event.tenantToken));\r\n            this._setDefaultProperty(event, 'EventInfo.Sequence', this._getSequenceId(event.tenantToken));\r\n            this._setDefaultProperty(event, 'EventInfo.SdkVersion', Version.FullVersionString);\r\n            this._setDefaultProperty(event, 'EventInfo.Name', event.name);\r\n            this._setDefaultProperty(event, 'EventInfo.Time', (new Date(event.timestamp)).toISOString());\r\n            AWTTransmissionManager_1.default.sendEvent(event);\r\n        }\r\n    };\r\n    AWT._overrideValuesFromConfig = function (config) {\r\n        if (config.collectorUrl) {\r\n            this._config.collectorUrl = config.collectorUrl;\r\n        }\r\n        if (config.sendingTimer > 1000) {\r\n            this._config.sendingTimer = config.sendingTimer;\r\n        }\r\n    };\r\n    AWT._getInitId = function (tenantToken) {\r\n        if (this._initIdMap[tenantToken] === undefined) {\r\n            this._initIdMap[tenantToken] = Utils.newGuid();\r\n        }\r\n        return this._initIdMap[tenantToken];\r\n    };\r\n    AWT._getSequenceId = function (tenantToken) {\r\n        if (this._sequenceIdMap[tenantToken] === undefined) {\r\n            this._sequenceIdMap[tenantToken] = 0;\r\n        }\r\n        return (++this._sequenceIdMap[tenantToken]).toString();\r\n    };\r\n    AWT._setDefaultProperty = function (event, name, value) {\r\n        event.properties[name] = { value: value, pii: Enums_1.AWTPiiKind.NotSet };\r\n    };\r\n    AWT._addContextIfAbsent = function (event, tenantToken) {\r\n        if (this._contextProperties[tenantToken]) {\r\n            var context_1 = this._contextProperties[tenantToken];\r\n            Object.keys(context_1).forEach(function (name) {\r\n                if (!event.properties[name]) {\r\n                    event.properties[name] = context_1[name];\r\n                }\r\n            });\r\n        }\r\n    };\r\n    AWT._sanitizeProperty = function (name, property) {\r\n        if (typeof property === 'string' || typeof property === 'number' || typeof property === 'boolean') {\r\n            property = { value: property };\r\n        }\r\n        if (!PropertyNameRegex.test(name) || property === undefined || property === null\r\n            || property.value === null || property.value === undefined || property.value === '') {\r\n            return null;\r\n        }\r\n        if (typeof property.pii === 'undefined') {\r\n            property.pii = Enums_1.AWTPiiKind.NotSet;\r\n        }\r\n        property.value = property.value.toString();\r\n        return Utils.isPii(property.pii) ? property : null;\r\n    };\r\n    AWT._isInitialized = false;\r\n    AWT._isDestroyed = false;\r\n    AWT._contextProperties = {};\r\n    AWT._sequenceIdMap = {};\r\n    AWT._initIdMap = {};\r\n    AWT._config = {\r\n        collectorUrl: 'https://browser.pipe.aria.microsoft.com/Collector/3.0/',\r\n        sendingTimer: 1000\r\n    };\r\n    return AWT;\r\n}());\r\nexports.default = AWT;\r\n\r\n\r\n/***/ }),\r\n/* 14 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AWTRecordBatcher_1 = __webpack_require__(11);\r\nvar AWTBondSerializer_1 = __webpack_require__(2);\r\nvar AWTRetryPolicy_1 = __webpack_require__(12);\r\nvar AWTKillSwitch_1 = __webpack_require__(10);\r\nvar Version = __webpack_require__(4);\r\nvar FlushCheckTimer = 250;\r\nvar RequestSizeLimitBytes = 2936012; //approx 2.8 Mb\r\nvar MaxRetries = 4;\r\nvar AWTTransmissionManager = /** @class */ (function () {\r\n    function AWTTransmissionManager() {\r\n    }\r\n    AWTTransmissionManager.initialize = function (config) {\r\n        this._inboundQueues.push([]);\r\n        this._recordBatcher = new AWTRecordBatcher_1.default(RequestSizeLimitBytes, this._outboundQueue);\r\n        this._newEventsAllowed = true;\r\n        if (typeof Uint8Array === 'undefined') {\r\n            this._urlString += '&content-encoding=base64';\r\n        }\r\n        this._sendingTimer = config.sendingTimer;\r\n        this._urlString = config.collectorUrl + this._urlString + '&x-apikey=';\r\n    };\r\n    //Push the event into the inbound queue and return\r\n    AWTTransmissionManager.sendEvent = function (event) {\r\n        var _this = this;\r\n        if (this._newEventsAllowed) {\r\n            //Add event to the last inbound queue\r\n            this._inboundQueues[this._inboundQueues.length - 1].push(event);\r\n            if (!this._running && this._timeout < 0 && !this._isCurrentlyFlushing) {\r\n                this._timeout = setTimeout(function () { return _this._batchAndSendEvents(false); }, this._sendingTimer);\r\n            }\r\n        }\r\n    };\r\n    AWTTransmissionManager.flushAndTeardown = function () {\r\n        this._newEventsAllowed = false;\r\n        this._batchAndSendEvents(true);\r\n    };\r\n    AWTTransmissionManager.flush = function (callback) {\r\n        this._inboundQueues.push([]);\r\n        if (!this._isCurrentlyFlushing) {\r\n            this._isCurrentlyFlushing = true;\r\n            this._flush(callback);\r\n        }\r\n        else {\r\n            this._flushQueue.push(callback);\r\n        }\r\n    };\r\n    AWTTransmissionManager._batchAndSendEvents = function (isTeardown) {\r\n        this._running = true;\r\n        while (this._inboundQueues[0].length > 0 && this._outboundQueue.length < 1) {\r\n            this._recordBatcher.addEventToBatch(this._inboundQueues[0].pop());\r\n        }\r\n        if (this._outboundQueue.length === 0) {\r\n            this._recordBatcher.flushBatch();\r\n        }\r\n        this._sendRequest(this._outboundQueue.pop(), 0, isTeardown);\r\n    };\r\n    AWTTransmissionManager._retryRequestIfNeeded = function (conn, request, tokenCount, apikey, retryCount) {\r\n        var _this = this;\r\n        var shouldRetry = true;\r\n        if (conn && typeof conn.status !== 'undefined') {\r\n            var killedTokens = this._killSwitch.setKillSwitchTenants(conn.getResponseHeader('kill-tokens'), conn.getResponseHeader('kill-duration-seconds'));\r\n            killedTokens.forEach(function (key) {\r\n                delete request[key];\r\n                tokenCount--;\r\n            });\r\n            if (!AWTRetryPolicy_1.default.shouldRetryForStatus(conn.status) || tokenCount <= 0) {\r\n                shouldRetry = false;\r\n            }\r\n        }\r\n        if (shouldRetry && retryCount < MaxRetries) {\r\n            setTimeout(function () { return _this._sendRequest(request, retryCount + 1, false); }, AWTRetryPolicy_1.default.getMillisToBackoffForRetry(retryCount));\r\n        }\r\n        else {\r\n            this._handleRequestFinished(null);\r\n        }\r\n    };\r\n    AWTTransmissionManager._sendRequest = function (request, retryCount, isTeardown) {\r\n        var _this = this;\r\n        try {\r\n            var conn_1 = new XMLHttpRequest();\r\n            var tokenCount_1 = 0;\r\n            var apikey_1 = '';\r\n            Object.keys(request).forEach(function (token) {\r\n                if (!_this._killSwitch.isTenantKilled(token)) {\r\n                    if (apikey_1.length > 0) {\r\n                        apikey_1 += ',';\r\n                    }\r\n                    apikey_1 += token;\r\n                    tokenCount_1++;\r\n                }\r\n                else {\r\n                    delete request[token];\r\n                }\r\n            });\r\n            conn_1.open('POST', this._urlString + apikey_1, !isTeardown);\r\n            if (!isTeardown) {\r\n                conn_1.ontimeout = function () {\r\n                    _this._retryRequestIfNeeded(conn_1, request, tokenCount_1, apikey_1, retryCount);\r\n                };\r\n                conn_1.onerror = function () {\r\n                    _this._retryRequestIfNeeded(conn_1, request, tokenCount_1, apikey_1, retryCount);\r\n                };\r\n                conn_1.onload = function () {\r\n                    _this._handleRequestFinished(conn_1);\r\n                };\r\n            }\r\n            if (tokenCount_1 > 0) {\r\n                var blob = AWTBondSerializer_1.default.getPayloadBlob(request, tokenCount_1);\r\n                if (typeof Uint8Array === 'undefined') {\r\n                    conn_1.send(AWTBondSerializer_1.default.base64Encode(blob));\r\n                }\r\n                else {\r\n                    conn_1.send(new Uint8Array(blob));\r\n                }\r\n            }\r\n            else if (isTeardown) {\r\n                this._handleRequestFinished(null);\r\n            }\r\n        }\r\n        catch (e) {\r\n            this._handleRequestFinished(null);\r\n        }\r\n    };\r\n    AWTTransmissionManager._handleRequestFinished = function (conn) {\r\n        var _this = this;\r\n        if (conn) {\r\n            this._killSwitch.setKillSwitchTenants(conn.getResponseHeader('kill-tokens'), conn.getResponseHeader('kill-duration-seconds'));\r\n        }\r\n        if (this._inboundQueues[0].length > 0) {\r\n            this._timeout = setTimeout(function () { return _this._batchAndSendEvents(false); }, this._sendingTimer);\r\n        }\r\n        else {\r\n            this._timeout = -1;\r\n            this._running = false;\r\n        }\r\n    };\r\n    AWTTransmissionManager._flush = function (callback) {\r\n        var _this = this;\r\n        if (!this._running) {\r\n            if (this._timeout > -1) {\r\n                clearTimeout(this._timeout);\r\n                this._timeout = -1;\r\n            }\r\n            if (this._inboundQueues[0].length > 0) {\r\n                this._batchAndSendEvents(false);\r\n            }\r\n        }\r\n        this._checkPrimaryInboundQueueEmpty(function () {\r\n            //Move the next queue to be primary\r\n            _this._inboundQueues.shift();\r\n            if (callback !== null && callback !== undefined) {\r\n                callback();\r\n            }\r\n            if (_this._flushQueue.length > 0) {\r\n                setTimeout(function () { return _this._flush(_this._flushQueue.shift()); }, _this._sendingTimer);\r\n            }\r\n            else {\r\n                _this._isCurrentlyFlushing = false;\r\n                if (_this._inboundQueues[0].length > 0) {\r\n                    _this._timeout = setTimeout(function () { return _this._batchAndSendEvents(false); }, _this._sendingTimer);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    AWTTransmissionManager._checkPrimaryInboundQueueEmpty = function (callback) {\r\n        var _this = this;\r\n        if (this._inboundQueues[0].length === 0) {\r\n            this._checkOutboundQueueEmptyAndSent(callback);\r\n        }\r\n        else {\r\n            setTimeout(function () { return _this._checkPrimaryInboundQueueEmpty(callback); }, FlushCheckTimer);\r\n        }\r\n    };\r\n    AWTTransmissionManager._checkOutboundQueueEmptyAndSent = function (callback) {\r\n        var _this = this;\r\n        if (!this._running) {\r\n            callback();\r\n        }\r\n        else {\r\n            setTimeout(function () { return _this._checkOutboundQueueEmptyAndSent(callback); }, FlushCheckTimer);\r\n        }\r\n    };\r\n    AWTTransmissionManager._outboundQueue = [];\r\n    AWTTransmissionManager._inboundQueues = [];\r\n    AWTTransmissionManager._newEventsAllowed = false;\r\n    AWTTransmissionManager._killSwitch = new AWTKillSwitch_1.default();\r\n    AWTTransmissionManager._isCurrentlyFlushing = false;\r\n    AWTTransmissionManager._flushQueue = [];\r\n    AWTTransmissionManager._running = false;\r\n    AWTTransmissionManager._timeout = -1;\r\n    AWTTransmissionManager._urlString = '?qsp=true&content-type=application%2Fbond-compact-binary&client-id=NO_AUTH&sdk-version='\r\n        + Version.FullVersionString;\r\n    return AWTTransmissionManager;\r\n}());\r\nexports.default = AWTTransmissionManager;\r\n\r\n\r\n/***/ }),\r\n/* 15 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\nmodule.exports = __webpack_require__(5);\r\n\r\n\r\n/***/ })\r\n/******/ ]);\r\n});\r\n//# sourceMappingURL=aria-webjs-compact-sdk-1.2.2.js.map","/**\r\n * Version.ts\r\n *\r\n * Module for package version\r\n */\r\nexport default \"0.0.0\";\r\n","/**\r\n * Window.ts\r\n *\r\n * Module wrapping around the global window object\r\n */\r\n\r\nimport * as Configuration from \"./../Configuration/Configuration\";\r\nimport { ILaunchOptionsInAppFeedback } from \"./../Configuration/ILaunchOptions\";\r\nimport ICustomSurvey from \"./../FloodgateCore/ICustomSurvey\";\r\nimport IUISurvey from \"./../FloodgateCore/UISurvey/IUISurvey\";\r\nimport { FloodgateEngine } from \"@ms-ofb/officefloodgatecore\";\r\nimport { IFloodgateSettingIdMap } from \"@ms-ofb/officefloodgatecore/dist/src/Api/Api\";\r\nimport { FeedbackStatus } from \"./../Constants\";\r\n\r\nconst w = window as any;\r\nconst officeBrowserFeedback = w.OfficeBrowserFeedback = w.OfficeBrowserFeedback || {};\r\nconst floodgate = officeBrowserFeedback.floodgate = officeBrowserFeedback.floodgate || {};\r\n\r\n/**\r\n * Get the IWindow object\r\n */\r\nexport function get(): IWindow { return w; }\r\n\r\n/**\r\n * Get the IWindow object\r\n */\r\nexport function getGlobal(): IWindow { return w; }\r\n\r\n/**\r\n * Set the setUiStrings() method\r\n * @param setUiStrings the method\r\n */\r\nexport function setSetUiStrings(setUiStrings: (data: any) => void) {\r\n\tofficeBrowserFeedback.setUiStrings = setUiStrings;\r\n}\r\n\r\n/**\r\n * Set the singleFeedback() method\r\n * @param singleFeedback the method\r\n */\r\nexport function setSingleFeedback(\r\n\tsingleFeedback: (feedbackType: string, launchOptions: ILaunchOptionsInAppFeedback) => Promise<any>) {\r\n\t\tofficeBrowserFeedback.singleFeedback = singleFeedback;\r\n}\r\n\r\n/**\r\n * Set the multiFeedback() method\r\n * @param multiFeedback the method\r\n */\r\nexport function setMultiFeedback(\r\n\tmultiFeedback: (launchOptions: ILaunchOptionsInAppFeedback) => Promise<any>) {\r\n\t\tofficeBrowserFeedback.multiFeedback = multiFeedback;\r\n}\r\n\r\n/**\r\n * Set the getFeedbackStatus() method\r\n * @param getFeedbackStatus the method\r\n */\r\nexport function setFeedbackStatus(\r\n\tgetFeedbackStatus: () => FeedbackStatus) {\r\n\t\tofficeBrowserFeedback.getFeedbackStatus = getFeedbackStatus;\r\n}\r\n\r\n/**\r\n * Set the createScreenshot() method\r\n * @param createScreenshot the method\r\n */\r\nexport function setCreateScreenshot(\r\n\tcreateScreenshot: (domElement?: object, options?: any) => Promise<any>) {\r\n\t\tofficeBrowserFeedback.createScreenshot = createScreenshot;\r\n}\r\n\r\n/**\r\n * Set the isFeedbackSurveyEnabledByAADC() method\r\n * @param isFeedbackSurveyEnabledByAADC the method\r\n */\r\nexport function setIsFeedbackSurveyEnabledByAADC(\r\n\tisFeedbackSurveyEnabledByAADC: () => boolean) {\r\n\t\tofficeBrowserFeedback.isFeedbackSurveyEnabledByAADC = isFeedbackSurveyEnabledByAADC;\r\n}\r\n\r\n/**\r\n * Set the floodgate showSurvey() method\r\n * @param floodgateShowSurvey the method\r\n */\r\nexport function setFloodgateShowSurvey(floodgateShowSurvey: (survey: IUISurvey) => Promise<any>) {\r\n\tfloodgate.showSurvey = floodgateShowSurvey;\r\n}\r\n\r\n/**\r\n * Set the floodgate showCustomSurvey() method\r\n * @param floodgateShowSurvey the method\r\n */\r\nexport function setFloodgateShowCustomSurvey(floodgateShowCustomSurvey: (survey: ICustomSurvey) => Promise<any>) {\r\n\tfloodgate.showCustomSurvey = floodgateShowCustomSurvey;\r\n}\r\n\r\n/**\r\n * Set the floodgate initialize() method\r\n * @param floodgateInitialize the method\r\n */\r\nexport function setFloodgateInitialize(floodgateInitialize: () => Promise<any>) {\r\n\tfloodgate.initialize = floodgateInitialize;\r\n}\r\n\r\n/**\r\n * Set the floodgate start() method\r\n * @param floodgateStart the method\r\n */\r\nexport function setFloodgateStart(floodgateStart: () => Promise<any>) {\r\n\tfloodgate.start = floodgateStart;\r\n}\r\n\r\n/**\r\n * Set the floodgate stop() method\r\n * @param floodgateStop the method\r\n */\r\nexport function setFloodgateStop(floodgateStop: () => void) {\r\n\tfloodgate.stop = floodgateStop;\r\n}\r\n\r\n/**\r\n * Set the floodgate getEngine() method\r\n * @param floodgateGetEngine the method\r\n */\r\nexport function setFloodgateGetEngine(floodgateGetEngine: () => FloodgateEngine) {\r\n\tfloodgate.getEngine = floodgateGetEngine;\r\n}\r\n\r\n/**\r\n * Set the floodgate getSettingIdMap() method\r\n * @param floodgateSettingIdMap the method\r\n */\r\nexport function getSettingIdMap(floodgateSettingIdMap: () => IFloodgateSettingIdMap) {\r\n\tfloodgate.getSettingIdMap = floodgateSettingIdMap;\r\n}\r\n\r\nexport interface IInitOptions extends Configuration.IInitOptionsCommon, Configuration.IInitOptionsInAppFeedback {\r\n}\r\n\r\nexport interface IFloodgate {\r\n\tinitOptions: Configuration.IInitOptionsFloodgate;\r\n\tshowSurvey: (survey: IUISurvey) => Promise<any>;\r\n\tinitialize: () => Promise<any>;\r\n\tstart: () => Promise<any>;\r\n\tstop: () => void;\r\n\tgetEngine: () => FloodgateEngine;\r\n}\r\n\r\nexport interface IWindow extends WindowLocalStorage {\r\n\tOfficeBrowserFeedback: {\r\n\t\tinitOptions: IInitOptions;\r\n\t\tmultiFeedback: (launchOptions: ILaunchOptionsInAppFeedback) => Promise<any>;\r\n\t\tsdkVersion: string;\r\n\t\tsingleFeedback: (feedbackType: string, launchOptions: ILaunchOptionsInAppFeedback) => Promise<any>;\r\n\t\tsetUiStrings: (data: any) => void;\r\n\t\thtml2canvas: () => ((domElement?: object, options?: any) => Promise<HTMLCanvasElement>);\r\n\t\tcreateScreenshot: (domElement?: object, options?: any) => Promise<HTMLCanvasElement>;\r\n\t\tfloodgate: IFloodgate;\r\n\t\tisFeedbackSurveyEnabledByAADC: () => boolean;\r\n\t\tgetFeedbackStatus: () => FeedbackStatus;\r\n\t};\r\n}\r\n","/**\r\n * Contracts enforced by OfficeEventSchema (OES)\r\n */\r\n\r\nexport class App {\r\n\tprivate static PLATFORM: string = \"Web\";\r\n\r\n\tprivate name: string;\r\n\tprivate version: string;\r\n\r\n\tpublic constructor(name: string, version: string) {\r\n\t\tif (!name) {\r\n\t\t\tthrow new Error(\"name must not be null\");\r\n\t\t}\r\n\t\tif (!version) {\r\n\t\t\tthrow new Error(\"version must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.name = name;\r\n\t\tthis.version = version;\r\n\t}\r\n\r\n\tpublic getName(): string {\r\n\t\treturn this.name;\r\n\t}\r\n\r\n\tpublic getPlatform(): string {\r\n\t\treturn App.PLATFORM;\r\n\t}\r\n\r\n\tpublic getVersion(): string {\r\n\t\treturn this.version;\r\n\t}\r\n}\r\n\r\nexport class Session {\r\n\tprivate id: string;\r\n\r\n\tpublic constructor(id: string) {\r\n\t\tif (!id) {\r\n\t\t\tthrow new Error(\"id must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tpublic getId(): string {\r\n\t\treturn this.id;\r\n\t}\r\n}\r\n\r\nexport class Host {\r\n\tprivate id: string;\r\n\tprivate locale: string;\r\n\tprivate sessionId: string;\r\n\tprivate version: string;\r\n\r\n\tconstructor(id: string, locale: string, sessionId: string, version: string) {\r\n\t\tthis.id = id;\r\n\t\tthis.locale = locale;\r\n\t\tthis.sessionId = sessionId;\r\n\t\tthis.version = version;\r\n\t}\r\n\r\n\tpublic getId(): string {\r\n\t\treturn this.id;\r\n\t}\r\n\r\n\tpublic getLocale(): string {\r\n\t\treturn this.locale;\r\n\t}\r\n\r\n\tpublic getSessionId(): string {\r\n\t\treturn this.sessionId;\r\n\t}\r\n\r\n\tpublic getVersion(): string {\r\n\t\treturn this.version;\r\n\t}\r\n}\r\n\r\nexport class Event {\r\n\t// Id is set to sessionId<DELIMITER>sequence\r\n\tprivate static ID_DELIMITER = \".\";\r\n\tprivate static SOURCE: string = \"MsoThin\";\r\n\tprivate static SCHEMA_VERSION: number = 1;\r\n\r\n\tprivate name: string;\r\n\tprivate id: string;\r\n\tprivate sequence: number;\r\n\tprivate sampleRate: number;\r\n\r\n\tpublic constructor(name: string, sessionId: string, sequence: number, sampleRate: number) {\r\n\t\tif (!name) {\r\n\t\t\tthrow new Error(\"name must not be null\");\r\n\t\t}\r\n\t\tif (!sessionId) {\r\n\t\t\tthrow new Error(\"sessionId must not be null\");\r\n\t\t}\r\n\t\tif ((!sequence && sequence !== 0) || sequence < 0) {\r\n\t\t\tthrow new Error(\"sequence must not be negative\");\r\n\t\t}\r\n\r\n\t\tthis.name = name;\r\n\t\tthis.id = sessionId + Event.ID_DELIMITER + sequence;\r\n\t\tthis.sequence = sequence;\r\n\t\tthis.sampleRate = sampleRate;\r\n\t}\r\n\r\n\tpublic getName(): string {\r\n\t\treturn this.name;\r\n\t}\r\n\r\n\tpublic getId(): string {\r\n\t\treturn this.id;\r\n\t}\r\n\r\n\tpublic getSource(): string {\r\n\t\treturn Event.SOURCE;\r\n\t}\r\n\r\n\tpublic getSchemaVersion(): number {\r\n\t\treturn Event.SCHEMA_VERSION;\r\n\t}\r\n\r\n\tpublic getSequence(): number {\r\n\t\treturn this.sequence;\r\n\t}\r\n\r\n\tpublic getSampleRate(): number {\r\n\t\treturn this.sampleRate;\r\n\t}\r\n}\r\n\r\nexport class Release {\r\n\tprivate audienceGroup: string;\r\n\r\n\tpublic constructor(audienceGroup: string) {\r\n\t\tthis.audienceGroup = audienceGroup;\r\n\t}\r\n\r\n\tpublic getAudienceGroup(): string {\r\n\t\treturn this.audienceGroup;\r\n\t}\r\n}\r\n\r\nexport class Browser {\r\n\tprivate name: string;\r\n\tprivate version: string;\r\n\r\n\tpublic constructor(name: string, version: string) {\r\n\t\tthis.name = name;\r\n\t\tthis.version = version;\r\n\t}\r\n\r\n\tpublic getName(): string {\r\n\t\treturn this.name;\r\n\t}\r\n\r\n\tpublic getVersion(): string {\r\n\t\treturn this.version;\r\n\t}\r\n}\r\n\r\nexport class Device {\r\n\tprivate id: string;\r\n\r\n\tpublic constructor(id: string) {\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tpublic getId(): string {\r\n\t\treturn this.id;\r\n\t}\r\n}\r\n\r\nexport class User {\r\n\tprivate primaryIdentityHash: string;\r\n\tprivate primaryIdentitySpace: string;\r\n\tprivate tenantId: string;\r\n\r\n\tpublic constructor(primaryIdentityHash: string, tenantId: string) {\r\n\t\tthis.tenantId = tenantId;\r\n\t\tthis.primaryIdentityHash = primaryIdentityHash ? primaryIdentityHash.trim() : primaryIdentityHash;\r\n\t\tthis.primaryIdentitySpace = this.generatePrimaryIdentitySpace();\r\n\t}\r\n\r\n\tpublic getTenantId(): string {\r\n\t\treturn this.tenantId;\r\n\t}\r\n\r\n\tpublic getPrimaryIdentityHash(): string {\r\n\t\treturn this.primaryIdentityHash;\r\n\t}\r\n\r\n\tpublic getPrimaryIdentitySpace(): string {\r\n\t\treturn this.primaryIdentitySpace;\r\n\t}\r\n\r\n\tprivate generatePrimaryIdentitySpace(): string {\r\n\t\tif (this.primaryIdentityHash) {\r\n\t\t\tif (this.primaryIdentityHash.startsWith(\"a:\")) {\r\n\t\t\t\treturn \"UserObjectId\";\r\n\t\t\t}\r\n\t\t\tif (this.primaryIdentityHash.startsWith(\"p:\")) {\r\n\t\t\t\treturn \"MsaPuid\";\r\n\t\t\t}\r\n\t\t\tif (this.primaryIdentityHash.startsWith(\"ap:\")) {\r\n\t\t\t\treturn \"OrgIdPuid\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\t}\r\n}\r\n","/**\r\n * Aria.ts\r\n *\r\n * Module for wrapper around Aria\r\n */\r\n\r\nlet aria: any = require(\"./../../thirdparty/aria-webjs-compact-sdk-1.2.2\");\r\n\r\nexport function AWT() { return aria.AWT; };\r\n","/**\r\n * An Aria-based logger\r\n */\r\n\r\nimport * as Aria from \"./Aria\";\r\nimport { App, Browser, Device, Event, Host, Release, Session, User } from \"./Contracts\";\r\nimport ITelemetryLogger from \"./ITelemetryLogger\";\r\n\r\nexport default class AriaTelemetryLogger implements ITelemetryLogger {\r\n\t// Event.name is set as namespace<DELIMITER>eventName\r\n\tprivate static EVENT_NAME_DELIMITER: string = \"_\";\r\n\tprivate static CUSTOM_PROPERTIES_FIELD_PREFIX: string = \"Data.\";\r\n\r\n\tprivate static setApp(properties: any, app: App): void {\r\n\t\tproperties[\"App.Name\"] = app.getName();\r\n\t\tproperties[\"App.Platform\"] = app.getPlatform();\r\n\t\tproperties[\"App.Version\"] = app.getVersion();\r\n\t}\r\n\r\n\tprivate static setSession(properties: any, session: Session) {\r\n\t\tproperties[\"Session.Id\"] = session.getId();\r\n\t}\r\n\r\n\tprivate static setHost(properties: any, host: Host) {\r\n\t\tif (host) {\r\n\t\t\tproperties[\"Host.Id\"] = host.getId();\r\n\t\t\tproperties[\"Host.SessionId2\"] = host.getSessionId();\r\n\t\t\tproperties[\"Host.Version\"] = host.getVersion();\r\n\t\t\tproperties[\"Host.Locale\"] = host.getLocale();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static setEvent(properties: any, event: Event) {\r\n\t\tproperties[\"Event.Name\"] = event.getName();\r\n\t\tproperties[\"Event.Id\"] = event.getId();\r\n\t\tproperties[\"Event.Source\"] = event.getSource();\r\n\t\tproperties[\"Event.SchemaVersion\"] = event.getSchemaVersion();\r\n\t\tproperties[\"Event.Sequence\"] = event.getSequence();\r\n\t\tproperties[\"Event.SampleRate\"] = event.getSampleRate();\r\n\t}\r\n\r\n\tprivate static setRelease(properties: any, release: Release) {\r\n\t\tif (release) {\r\n\t\t\tproperties[\"Release.AudienceGroup\"] = release.getAudienceGroup();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static setBrowser(properties: any, browser: Browser) {\r\n\t\tif (browser) {\r\n\t\t\tproperties[\"Browser.Name\"] = browser.getName();\r\n\t\t\tproperties[\"Browser.Version\"] = browser.getVersion();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static setDevice(properties: any, device: Device) {\r\n\t\tif (device) {\r\n\t\t\tproperties[\"Device.Id\"] = device.getId();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static setUser(properties: any, user: User) {\r\n\t\tif (user) {\r\n\t\t\tproperties[\"User.PrimaryIdentityHash\"] = user.getPrimaryIdentityHash();\r\n\t\t\tproperties[\"User.PrimaryIdentitySpace\"] = user.getPrimaryIdentitySpace();\r\n\t\t\tproperties[\"User.TenantId\"] = user.getTenantId();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate oesApp: App;\r\n\tprivate oesSession: Session;\r\n\tprivate oesHost: Host;\r\n\tprivate oesRelease: Release;\r\n\tprivate oesBrowser: Browser;\r\n\tprivate oesDevice: Device;\r\n\tprivate oesUser: User;\r\n\r\n\tprivate namespace: string;\r\n\tprivate sequence: number;\r\n\r\n\tconstructor(tenantToken: string, namespace: string, app: App, session: Session, host?: Host, release?: Release,\r\n\t\tbrowser?: Browser, device?: Device, user?: User) {\r\n\r\n\t\tif (!tenantToken) {\r\n\t\t\tthrow new Error(\"tenantToken must not be null\");\r\n\t\t}\r\n\t\tif (!namespace) {\r\n\t\t\tthrow new Error(\"namespace must not be null\");\r\n\t\t}\r\n\t\tif (!app) {\r\n\t\t\tthrow new Error(\"app must not be null\");\r\n\t\t}\r\n\t\tif (!session) {\r\n\t\t\tthrow new Error(\"session must not be null\");\r\n\t\t}\r\n\r\n\t\tAria.AWT().initialize(tenantToken);\r\n\t\tthis.namespace = namespace;\r\n\t\tthis.oesApp = app;\r\n\t\tthis.oesSession = session;\r\n\t\tthis.oesHost = host;\r\n\t\tthis.oesRelease = release;\r\n\t\tthis.oesBrowser = browser;\r\n\t\tthis.oesDevice = device;\r\n\t\tthis.oesUser = user;\r\n\t\tthis.sequence = 1; // Sequence starts at 1 not 0\r\n\t}\r\n\r\n\tpublic logEvent(eventName: string, customProperties?: { [customField: string]: any }, sampleRate: number = 1) {\r\n\t\tif (!eventName) {\r\n\t\t\tthrow new Error(\"eventName must not be null\");\r\n\t\t}\r\n\r\n\t\tlet oesEvent: Event = new Event(\r\n\t\t\tthis.namespace + AriaTelemetryLogger.EVENT_NAME_DELIMITER + eventName,\r\n\t\t\tthis.oesSession.getId(),\r\n\t\t\tthis.sequence,\r\n\t\t\tsampleRate\r\n\t\t);\r\n\r\n\t\tlet ariaProperties: any = {};\r\n\r\n\t\tif (customProperties != null) {\r\n\t\t\tfor (const key in customProperties) {\r\n\t\t\t\tif (customProperties.hasOwnProperty(key)) {\r\n\t\t\t\t\tariaProperties[AriaTelemetryLogger.CUSTOM_PROPERTIES_FIELD_PREFIX + key] = customProperties[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tAriaTelemetryLogger.setApp(ariaProperties, this.oesApp);\r\n\t\tAriaTelemetryLogger.setSession(ariaProperties, this.oesSession);\r\n\t\tAriaTelemetryLogger.setHost(ariaProperties, this.oesHost);\r\n\t\tAriaTelemetryLogger.setRelease(ariaProperties, this.oesRelease);\r\n\t\tAriaTelemetryLogger.setEvent(ariaProperties, oesEvent);\r\n\t\tAriaTelemetryLogger.setBrowser(ariaProperties, this.oesBrowser);\r\n\t\tAriaTelemetryLogger.setDevice(ariaProperties, this.oesDevice);\r\n\t\tAriaTelemetryLogger.setUser(ariaProperties, this.oesUser);\r\n\r\n\t\tAria.AWT().logEvent({\r\n\t\t\tname: oesEvent.getName(),\r\n\t\t\tproperties: ariaProperties,\r\n\t\t});\r\n\r\n\t\tthis.sequence++;\r\n\t}\r\n}\r\n","/**\r\n * Implementation of IFloodgateStorageProvider for Web SDK\r\n */\r\n\r\nimport { IFloodgateStorageProvider } from \"@ms-ofb/officefloodgatecore/dist/src/Api/Api\";\r\nimport * as Window from \"./../Window/Window\";\r\nimport * as Logging from \"./../Logging/Logging\";\r\nimport FileType = IFloodgateStorageProvider.FileType;\r\n\r\nconst fileTypeToKeyMap: { [k in FileType]: string } = {\r\n\t[FileType.CampaignDefinitions]: \"obf-CampaignDefinitions\",\r\n\t[FileType.CampaignStates]: \"obf-CampaignStates\",\r\n\t[FileType.FloodgateSettings]: \"obf-FloodgateSettings\",\r\n\t[FileType.GovernedChannelStates]: \"obf-GovernedChannelStates\",\r\n\t[FileType.SurveyActivationStats]: \"obf-SurveyActivationStats\",\r\n\t[FileType.SurveyEventActivityStats]: \"obf-SurveyEventActivityStats\",\r\n\t[FileType.TmsCache_CampaignContent]: \"obf-TmsCampaignContent\",\r\n\t[FileType.TmsCache_MessageMetadata]: \"obf-TmsMessageMetadata\",\r\n\t[FileType.TmsCache_UserGovernance]: \"obf-TmsUserGovernance\",\r\n\t[FileType.Tms_DynamicSettings]: \"obf-TmsDynamicSettings\",\r\n\t[FileType.LogLevelSettings]: \"obf-LogLevelSettings\",\r\n\t[FileType.UserFacts]: \"obf-UserFacts\",\r\n\t[FileType.DebugOverrides]: \"obf-DebugOverrides\",\r\n};\r\n\r\nexport default class FloodgateStorageProvider implements IFloodgateStorageProvider {\r\n\t/**\r\n\t * Code to detect localStorage presence.\r\n\t * Copied from MDN: https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API\r\n\t */\r\n\tpublic static isStorageAvailable(): boolean {\r\n\t\ttry {\r\n\t\t\tlet x = \"__storage_test__\";\r\n\t\t\tWindow.getGlobal().localStorage.setItem(x, x);\r\n\t\t\tWindow.getGlobal().localStorage.removeItem(x);\r\n\t\t\treturn true;\r\n\t\t} catch (e) {\r\n\t\t\treturn e instanceof DOMException && (\r\n\t\t\t\t// everything except Firefox\r\n\t\t\t\te.code === 22 ||\r\n\t\t\t\t// Firefox\r\n\t\t\t\te.code === 1014 ||\r\n\t\t\t\t// test name field too, because code might not be present\r\n\t\t\t\t// everything except Firefox\r\n\t\t\t\te.name === \"QuotaExceededError\" ||\r\n\t\t\t\t// Firefox\r\n\t\t\t\te.name === \"NS_ERROR_DOM_QUOTA_REACHED\") &&\r\n\t\t\t\t// acknowledge QuotaExceededError only if there's something already stored\r\n\t\t\t\tWindow.getGlobal().localStorage.length !== 0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Safely read an object\r\n\t */\r\n\tpublic static safeReadObject<T>(fileType: FileType, defaultValue: T = undefined): T {\r\n\t\tif (!(fileType in FileType)) {\r\n\t\t\treturn defaultValue;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tlet storageKey = fileTypeToKeyMap[fileType];\r\n\t\t\tconst result = Window.getGlobal().localStorage.getItem(storageKey);\r\n\t\t\tconst parsedObject = result && (result[0] === \"{\" || result[0] === \"[\") ? JSON.parse(result) : result;\r\n\t\t\treturn parsedObject ?? defaultValue;\r\n\t\t} catch (e) {\r\n\t\t\t// ignore\r\n\t\t}\r\n\r\n\t\treturn defaultValue;\r\n\t}\r\n\r\n\t/**\r\n\t * Lock the file to prevent access from another process.\r\n\t */\r\n\tpublic fileLock(fileType: FileType): void {\r\n\t\t// JS runs on a single thread in the browser.\r\n\t\treturn;\r\n\t}\r\n\r\n\t/**\r\n\t * Unlock the file.\r\n\t */\r\n\tpublic fileUnlock(fileType: FileType): void {\r\n\t\t// JS runs on a single thread in the browser.\r\n\t\treturn;\r\n\t}\r\n\r\n\t/**\r\n\t * Read the file\r\n\t */\r\n\tpublic read(fileType: FileType): string {\r\n\t\tif (!(fileType in FileType)) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\r\n\t\tlet storageKey = fileTypeToKeyMap[fileType];\r\n\t\tlet result: string;\r\n\t\ttry {\r\n\t\t\tresult = Window.getGlobal().localStorage.getItem(storageKey);\r\n\t\t} catch (e) {\r\n\t\t\tLogging.getLogger().logEvent(Logging.EventIds.SURVEY_FLOODGATE_FILEREAD_FAILED,\r\n\t\t\t\tLogging.LogLevel.Error,\r\n\t\t\t\t{\r\n\t\t\t\t\tErrorMessage: e.toString(),\r\n\t\t\t\t\tFileName: storageKey,\r\n\t\t\t\t});\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Write to the file\r\n\t */\r\n\tpublic write(fileType: FileType, content: string): void {\r\n\t\tif (!(fileType in FileType)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet storageKey = fileTypeToKeyMap[fileType];\r\n\t\ttry {\r\n\t\t\tWindow.getGlobal().localStorage.setItem(storageKey, content);\r\n\t\t} catch (e) {\r\n\t\t\tLogging.getLogger().logEvent(Logging.EventIds.SURVEY_FLOODGATE_FILEWRITE_FAILED,\r\n\t\t\t\tLogging.LogLevel.Error,\r\n\t\t\t\t{\r\n\t\t\t\t\tErrorMessage: e.toString(),\r\n\t\t\t\t\tFileName: storageKey,\r\n\t\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * Constants.ts\r\n *\r\n * Module to hold logging-related constants\r\n */\r\n\r\nexport interface ICustomProperties {\r\n\tCampaignId?: string;\r\n\tCorrelationId?: string;\r\n\tCount?: number;\r\n\tData?: string;\r\n\tErrorMessage?: string;\r\n\tFeedbackType?: number;\r\n\tPanelType?: number;\r\n\tFileName?: string;\r\n\tFlights?: string;\r\n\tHttpStatusCode?: number;\r\n\tHttpStatusText?: string;\r\n\tIsBugEnabled?: boolean;\r\n\tIsDiagnosticsIncluded?: boolean;\r\n\tIsEmailIncluded?: boolean;\r\n\tIsEmailPolicyEnabled?: boolean;\r\n\tIsIdeaEnabled?: boolean;\r\n\tIsScreenshotIncluded?: boolean;\r\n\tMessage?: string;\r\n\tSessionId?: string;\r\n\tSurveyId?: string;\r\n\tSurveyType?: number;\r\n\tTimeMilliseconds?: number;\r\n\tType?: string;\r\n\tClientFeedbackId?: string;\r\n\tPromptAutoDismiss?: string;\r\n\tAdditionalSurveyInfo?: string;\r\n\tSurveyActivityInfo?: string;\r\n\tPersonalizerUserAction?: number;\r\n\tPersonalizerEventId?: string;\r\n\tGovernanceRequestBody?: string;\r\n\tGovernanceResponseText?: string;\r\n\tActualSetAutoDismissValue?: number;\r\n\tCVFormId?: string;\r\n}\r\n\r\nexport interface IEventId {\r\n\tname: string;\r\n}\r\n\r\nexport class EventIds {\r\n\tpublic static InApp = class {\r\n\t\tpublic static UI = class {\r\n\t\t\tpublic static Picker = class {\r\n\t\t\t\tpublic static Shown = class {\r\n\t\t\t\t\tpublic static VALUE: IEventId = { name: \"InApp_UI_Picker_Shown\" };\r\n\t\t\t\t};\r\n\t\t\t};\r\n\r\n\t\t\tpublic static Form = class {\r\n\t\t\t\tpublic static Shown = class {\r\n\t\t\t\t\tpublic static VALUE: IEventId = { name: \"InApp_UI_Form_Shown\" };\r\n\t\t\t\t};\r\n\r\n\t\t\t\tpublic static Submit = class {\r\n\t\t\t\t\tpublic static VALUE: IEventId = { name: \"InApp_UI_Form_Submit\" };\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t};\r\n\t};\r\n\r\n\t// This saves ~400 bytes (minified) vs nested classes\r\n\tpublic static SURVEY_FLOODGATE_CAMPAIGNLOAD_FAILED: IEventId = { name: \"Survey_Floodgate_CampaignLoad_Failed\" };\r\n\tpublic static SURVEY_FLOODGATE_FILEREAD_FAILED: IEventId = { name: \"Survey_Floodgate_FileRead_Failed\" };\r\n\tpublic static SURVEY_FLOODGATE_FILEWRITE_FAILED: IEventId = { name: \"Survey_Floodgate_FileWrite_Failed\" };\r\n\tpublic static SURVEY_FLOODGATE_TRIGGERMET: IEventId = { name: \"Survey_Floodgate_TriggerMet\" };\r\n\tpublic static SURVEY_FLOODGATE_USERSELECTED: IEventId = { name: \"Survey_Floodgate_UserSelected\" };\r\n\tpublic static SURVEY_UI_FORM_SHOWN: IEventId = { name: \"Survey_UI_Form_Shown\" };\r\n\tpublic static SURVEY_UI_FORM_SUBMIT: IEventId = { name: \"Survey_UI_Form_Submit\" };\r\n\tpublic static SURVEY_UI_FORM_SECONDARY_SUBMIT: IEventId = { name: \"Survey_UI_Form_Secondary_Submit\" };\r\n\tpublic static SURVEY_UI_FORM_SUBMIT_ERROR: IEventId = { name: \"Survey_UI_Form_Submit_Error\" };\r\n\tpublic static SURVEY_UI_FORM_USERCLOSED: IEventId = { name: \"Survey_UI_Form_UserClosed\" };\r\n\tpublic static SURVEY_UI_FORM_NO_RETURN_TYPE: IEventId = { name: \"Survey_UI_Form_No_Return_Type\"};\r\n\r\n\tpublic static SURVEY_UI_PROMPT_AUTODISMISSED: IEventId = { name: \"Survey_UI_Prompt_AutoDismissed\" };\r\n\tpublic static SURVEY_UI_PROMPT_SHOWN: IEventId = { name: \"Survey_UI_Prompt_Shown\" };\r\n\tpublic static SURVEY_UI_PROMPT_USERCLOSED: IEventId = { name: \"Survey_UI_Prompt_UserClosed\" };\r\n\tpublic static SURVEY_UI_PROMPT_CLICKED: IEventId = { name: \"Survey_UI_Prompt_Clicked\" };\r\n\tpublic static SURVEY_UI_REDIRECTIONFAILURE: IEventId = { name: \"Survey_UI_RedirectionFailure\" };\r\n\tpublic static GOVERNANCE_SERVICEFAILURE: IEventId = { name: \"Gorvenance_ServiceFailure\" };\r\n\tpublic static GOVERNANCE_SERVICERESULT: IEventId = { name: \"Gorvenance_ServiceResult\" };\r\n\tpublic static DYNAMICTRANSPORT_POST_ERROR: IEventId = { name: \"DynamicTransport_Post_Error\" };\r\n\tpublic static FEEDBACK_SURVEYSDISABLED_AADC: IEventId = {name: \"Feedback_SurveysDisabled_AADC\"};\r\n\tpublic static SURVEY_UI_DISABLED_AADC: IEventId = { name: \"Survey_UI_Prevented_AADC\" };\r\n\tpublic static PERSONALIZER_SERVICEREWARDRESULT: IEventId = { name: \"Personalizer_ServiceRewardResult\" };\r\n\tpublic static PERSONALIZER_CLIENTFAILURE: IEventId = { name: \"Personalizer_ClientFailure\" };\r\n\r\n\tpublic static Shared = class {\r\n\t\tpublic static Upload = class {\r\n\t\t\tpublic static Failed = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"Shared_Upload_Failed\" };\r\n\t\t\t};\r\n\t\t\tpublic static Prevented = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"Shared_Upload_Prevented_AADC\" };\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tpublic static Screenshot = class {\r\n\t\t\tpublic static Render = class {\r\n\t\t\t\tpublic static Failed = class {\r\n\t\t\t\t\tpublic static VALUE: IEventId = { name: \"Shared_Screenshot_Render_Failed\" };\r\n\t\t\t\t};\r\n\t\t\t\tpublic static Success = class {\r\n\t\t\t\t\tpublic static VALUE: IEventId = { name: \"Shared_Screenshot_Render_Success\" };\r\n\t\t\t\t};\r\n\t\t\t};\r\n\r\n\t\t\tpublic static GetContent = class {\r\n\t\t\t\tpublic static Failed = class {\r\n\t\t\t\t\tpublic static DefaultImage = class {\r\n\t\t\t\t\t\tpublic static Returned = class {\r\n\t\t\t\t\t\t\tpublic static VALUE: IEventId = { name: \"Shared_Screenshot_GetContent_Failed_DefaultImage_Returned\" };\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static WebSurfaces = class {\r\n\t\tpublic static Common = class {\r\n\t\t\tpublic static Error = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"WebSurfaces_Common_Error\" };\r\n\t\t\t};\r\n\t\t\tpublic static Info = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"WebSurfaces_Common_Info\" };\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tpublic static Messaging = class {\r\n\t\t\tpublic static Requests = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"WebSurfaces_Messaging_Requests\" };\r\n\t\t\t};\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static UserFacts = class {\r\n\t\tpublic static Common = class {\r\n\t\t\tpublic static Error = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"UserFacts_Common_Error\" };\r\n\t\t\t};\r\n\t\t\tpublic static Info = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"UserFacts_Common_Info\" };\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tpublic static LocalFact = class {\r\n\t\t\tpublic static Error = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"UserFacts_LocalFact_Error\" };\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tpublic static Messaging = class {\r\n\t\t\tpublic static Requests = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"UserFacts_Messaging_Requests\" };\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tpublic static AugLoop = class {\r\n\t\t\tpublic static Requests = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"UserFacts_AugLoop_Requests\" };\r\n\t\t\t};\r\n\t\t\tpublic static Error = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"UserFacts_AugLoop_Error\" };\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tpublic static Provider = class {\r\n\t\t\tpublic static Info = class {\r\n\t\t\t\tpublic static VALUE: IEventId = { name: \"UserFacts_Provider_Summary\" };\r\n\t\t\t};\r\n\t\t};\r\n\t};\r\n\r\n\tpublic static Common = class {\r\n\t\tpublic static Error = class {\r\n\t\t\tpublic static VALUE: IEventId = { name: \"Common_Error\" };\r\n\t\t};\r\n\t\tpublic static Info = class {\r\n\t\t\tpublic static VALUE: IEventId = { name: \"Common_Info\" };\r\n\t\t};\r\n\t};\r\n}\r\n","import { ContentType } from \"./TargetedMessagingContentType\";\r\nimport FloodgateStorageProvider from \"../FloodgateCore/FloodgateStorageProvider\";\r\nimport * as Utils from \"../Utils\";\r\nimport { FileType } from \"@ms-ofb/officefloodgatecore/dist/src/Api/IFloodgateStorageProvider\";\r\n\r\nconst { isNOU } = Utils;\r\n\r\nexport interface ICacheItem {\r\n\tcontentType: ContentType;\r\n\tcontent: any;\r\n\texpiryDate: Date;\r\n\tlastRetrievedDate: Date;\r\n}\r\n\r\nexport class TargetedMessagingCache {\r\n\tprivate useLocalStorage: boolean = false;\r\n\tprivate cachedItems: { [key: string]: ICacheItem } = {};\r\n\tprivate floodgateStorage: FloodgateStorageProvider;\r\n\r\n\tconstructor(items: Array<ContentType>) {\r\n\t\tthis.initialize(items);\r\n\t}\r\n\r\n\tpublic setContentItem(contentType: ContentType, content: any, expiryTime: number): ICacheItem {\r\n\t\tconst cacheItem = this.createItem(contentType, content, expiryTime);\r\n\t\tthis.setItem(cacheItem);\r\n\t\treturn cacheItem;\r\n\t}\r\n\r\n\tpublic getItemContent<T>(contentType: ContentType): T {\r\n\t\tconst cacheItem = this.getItem(contentType);\r\n\t\treturn cacheItem && cacheItem.content;\r\n\t}\r\n\r\n\tpublic has(contentType: ContentType): boolean {\r\n\t\treturn contentType in this.cachedItems;\r\n\t}\r\n\r\n\tpublic isItemExpired(contentType: ContentType): boolean {\r\n\t\tconst cacheItem = this.getItem(contentType);\r\n\t\treturn !cacheItem\r\n\t\t\t|| !cacheItem.expiryDate\r\n\t\t\t|| cacheItem.expiryDate < new Date();\r\n\t}\r\n\r\n\tprivate createItem(contentType: ContentType, content: any, expiryTime: number): ICacheItem {\r\n\t\tconst cacheItem: ICacheItem = {\r\n\t\t\tcontentType,\r\n\t\t\tcontent,\r\n\t\t\texpiryDate:  new Date(Date.now() + expiryTime),\r\n\t\t\tlastRetrievedDate: new Date(),\r\n\t\t};\r\n\r\n\t\treturn cacheItem;\r\n\t}\r\n\r\n\tprivate setItem(cacheItem: ICacheItem): void {\r\n\t\tthis.cachedItems[cacheItem.contentType] = cacheItem;\r\n\t\tthis.updateItemInLocalStorage(cacheItem);\r\n\t}\r\n\r\n\tprivate getItem(contentType: ContentType): ICacheItem {\r\n\t\treturn this.cachedItems[contentType];\r\n\t}\r\n\r\n\tprivate initialize(items: Array<ContentType>): void {\r\n\t\tthis.cachedItems = {};\r\n\t\tif (FloodgateStorageProvider.isStorageAvailable()) {\r\n\t\t\tthis.floodgateStorage = new FloodgateStorageProvider();\r\n\t\t\tthis.useLocalStorage = true;\r\n\r\n\t\t\t// try to fetch items from local storage if available from prior sessions\r\n\t\t\tthis.initCachedItemsFromLocalStorage(items);\r\n\t\t} else {\r\n\t\t\t// no LocalStorage support, only active object cache only\r\n\t\t}\r\n\t}\r\n\r\n\tprivate initCachedItemsFromLocalStorage(items: Array<ContentType>): void {\r\n\t\tif (this.useLocalStorage) {\r\n\t\t\tif (!isNOU(items)) {\r\n\t\t\t\tfor (let contentKey of items) {\r\n\t\t\t\t\tlet tempStorageItem: string = this.floodgateStorage.read(this.mapContentTypeToFloodgateProviderKey(contentKey));\r\n\t\t\t\t\tif (!isNOU(tempStorageItem)) {\r\n\t\t\t\t\t\tconst tempCacheItem: ICacheItem = this.parseObjectFromCache(tempStorageItem);\r\n\t\t\t\t\t\tif (!isNOU(tempCacheItem)) {\r\n\t\t\t\t\t\t\ttempCacheItem.expiryDate = typeof tempCacheItem.expiryDate === \"string\" ?\r\n\t\t\t\t\t\t\t\tnew Date(tempCacheItem.expiryDate) : tempCacheItem.expiryDate;\r\n\t\t\t\t\t\t\tthis.cachedItems[tempCacheItem.contentType] = tempCacheItem;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateItemInLocalStorage(cacheItem: ICacheItem): void {\r\n\t\tif (this.useLocalStorage) {\r\n\t\t\tthis.floodgateStorage.write(\r\n\t\t\t\tthis.mapContentTypeToFloodgateProviderKey(cacheItem.contentType),\r\n\t\t\t\tJSON.stringify(cacheItem));\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseObjectFromCache(tempItem: string): ICacheItem {\r\n\t\ttry {\r\n\t\t\tconst tempCacheItem: ICacheItem = JSON.parse(tempItem);\r\n\t\t\treturn tempCacheItem;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate mapContentTypeToFloodgateProviderKey(contentType: ContentType): FileType {\r\n\t\tswitch (contentType) {\r\n\t\t\tcase ContentType.campaignContent:\r\n\t\t\t\treturn FileType.TmsCache_CampaignContent;\r\n\t\t\tcase ContentType.messageMetadata:\r\n\t\t\t\treturn FileType.TmsCache_MessageMetadata;\r\n\t\t\tcase ContentType.userGovernanceRules:\r\n\t\t\t\treturn FileType.TmsCache_UserGovernance;\r\n\t\t\tcase ContentType.dynamicSettings:\r\n\t\t\t\treturn FileType.Tms_DynamicSettings;\r\n\t\t\tcase ContentType.logLevelSettings:\r\n\t\t\t\treturn FileType.LogLevelSettings;\r\n\t\t\tcase ContentType.userFacts:\r\n\t\t\t\treturn FileType.UserFacts;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"Unmapped ContentType in TmsCache\");\r\n\t\t}\r\n\t}\r\n}\r\n","import * as Utils from \"../Utils\";\r\nimport FloodgateStorageProvider from \"../FloodgateCore/FloodgateStorageProvider\";\r\nimport { TargetedMessagingCache } from \"../TargetedMessaging/TargetedMessagingCache\";\r\nimport { ContentType } from \"../TargetedMessaging/TargetedMessagingContentType\";\r\n\r\nimport * as Logging from \"../Logging/Logging\";\r\n\r\nconst { isNOU } = Utils;\r\n\r\nexport const enum SettingKey {\r\n\t// General\r\n\tlogLevelSettings = \"LogLevelSettings\",\r\n\r\n\t// Web surfaces\r\n\tteachingMessageCooldown = \"TeachingMessageCooldown\",\r\n\twebSurfacesIntLink = \"WebSurfacesIntLink\",\r\n\twebSurfacesProdLink = \"WebSurfacesProdLink\",\r\n\r\n\t// TMS settings\r\n\ttmsAppId = \"TmsAppId\",\r\n\ttmsServiceUrl = \"TmsServiceUrl\",\r\n\ttmsActionUrl = \"TmsActionUrl\",\r\n\ttmsLoadTimeout = \"TmsLoadTimeout\",\r\n\ttmsMessageMetadataExpiry = \"TmsMessageMetadataExpiry\",\r\n\ttmsUserGovernanceRulesExpiry = \"TmsUserGovernanceRulesExpiry\",\r\n\ttmsCampaignContentExpiry = \"TmsCampaignContentExpiry\",\r\n\ttmsDynamicSettingsExpiry = \"TmsDynamicSettingsExpiry\",\r\n\ttmsLogLevelSettingsExpiry = \"TmsLogLevelSettingsExpiry\",\r\n\ttmsUserFactsExpiry = \"TmsUserFactsExpiry\",\r\n\r\n\t// Tulips\r\n\ttulipsAppId = \"TulipsAppId\",\r\n\ttulipsLoadTimeout = \"TulipsLoadTimeout\",\r\n\ttulipsServiceUrl = \"TulipsServiceUrl\",\r\n\ttulipsIngestionTimeInterval = \"TulipsIngestionTimeInterval\",\r\n\r\n\t// AugLoop\r\n\ttulipsAugLoopAnnotationName = \"TulipsAugLoopAnnotationName\",\r\n\ttulipsAugLoopPackageDelayLoad = \"TulipsAugLoopPackageDelayLoad\",\r\n\ttulipsAugLoopLoadRetryTimes = \"TulipsAugLoopLoadRetryTimes\",\r\n\ttulipsAugLoopLoadTimeout = \"TulipsAugLoopLoadTimeout\",\r\n}\r\n\r\nlet dynamicSettingsTmsgCache: TargetedMessagingCache = null;\r\n\r\nexport function getDynamicSetting<T>(key: SettingKey, defaultValue: T): T {\r\n\ttry\t{\r\n\t\tif (!dynamicSettingsTmsgCache && FloodgateStorageProvider.isStorageAvailable()) {\r\n\t\t\tdynamicSettingsTmsgCache =  new TargetedMessagingCache([ContentType.dynamicSettings]);\r\n\t\t}\r\n\r\n\t\tif (!dynamicSettingsTmsgCache) {\r\n\t\t\treturn defaultValue;\r\n\t\t}\r\n\r\n\t\tconst settingsObj = dynamicSettingsTmsgCache.getItemContent<Record<string, T>>(ContentType.dynamicSettings);\r\n\t\tif (!isNOU(settingsObj)\r\n\t\t\t&& settingsObj.hasOwnProperty(key)\r\n\t\t\t&& !isNOU(settingsObj[key])) {\r\n\t\t\tconst settingValue = settingsObj[key];\r\n\r\n\t\t\t// parse types\r\n\t\t\tif (typeof defaultValue === \"number\" && typeof settingValue !== \"number\") {\r\n\t\t\t\tif (typeof settingValue === \"string\") {\r\n\t\t\t\t\tconst returnValue = settingValue.indexOf(\".\") === -1 ? parseInt(settingValue, 10) : parseFloat(settingValue);\r\n\t\t\t\t\treturn isNaN(returnValue) ? defaultValue : returnValue as unknown as T;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn defaultValue;\r\n\t\t\t}\r\n\r\n\t\t\treturn settingValue;\r\n\t\t}\r\n\t} catch (error) {\r\n\t\tLogging.getLogger().logEvent(\r\n\t\t\tLogging.EventIds.Common.Error.VALUE,\r\n\t\t\tLogging.LogLevel.Error,\r\n\t\t\t{\r\n\t\t\t\tErrorMessage: `Error reading dynamic setting ${error && error.message}`,\r\n\t\t\t\tType: key,\r\n\t\t\t});\r\n\t}\r\n\r\n\treturn defaultValue;\r\n}\r\n\r\nexport function resetDynamicSettingsTmsgCache() {\r\n\tdynamicSettingsTmsgCache = null;\r\n}\r\n","import { IInitOptionsCommon, ISamplingInitOption } from \"./../Configuration/IInitOptions\";\r\nimport { IEventId, ICustomProperties } from \"./Constants\";\r\nimport { Environment } from \"./../Constants\";\r\nimport { App, Browser, Device, Host, Release, Session, User } from \"./Telemetry/Contracts\";\r\nimport * as Utils from \"./../Utils\";\r\nimport ITelemetryLogger from \"./Telemetry/ITelemetryLogger\";\r\nimport TelemetryLoggerFactory from \"./Telemetry/TelemetryLoggerFactory\";\r\nimport FloodgateStorageProvider from \"../FloodgateCore/FloodgateStorageProvider\";\r\nimport { FileType } from \"@ms-ofb/officefloodgatecore/dist/src/Api/IFloodgateStorageProvider\";\r\n\r\nexport { ICustomProperties, IEventId, EventIds } from \"./Constants\";\r\nimport { getDynamicSetting, SettingKey } from \"../Configuration/DynamicConfiguration\";\r\n\r\nconst { isNOU } = Utils;\r\nconst NAMESPACE: string = \"Office_Feedback\";\r\n\r\nlet logger: ILogger;\r\nlet env: Environment;\r\n\r\n/**\r\n * Initialize the logging module\r\n * @param initOptionsCommon object contains common init options\r\n * @param appName app name\r\n * @param appVersion app version\r\n * @param logSessionId local SDK session id\r\n */\r\nexport function initialize(initOptionsCommon: IInitOptionsCommon, appName: string, appVersion: string,\r\n\tlogSessionId: string, samplingOption: ISamplingInitOption): void {\r\n\r\n\tconst telemetryGroup = initOptionsCommon.telemetryGroup ? initOptionsCommon.telemetryGroup : {};\r\n\tconst webGroup = initOptionsCommon.webGroup ? initOptionsCommon.webGroup : {};\r\n\r\n\tlogger = new Logger(\r\n\t\tTelemetryLoggerFactory.create(\r\n\t\t\tTokenManager.getTenantToken(initOptionsCommon.environment),\r\n\t\t\tNAMESPACE,\r\n\t\t\tnew App(appName, appVersion),\r\n\t\t\tnew Session(logSessionId),\r\n\t\t\tnew Host(initOptionsCommon.appId.toString(), initOptionsCommon.originalLocale, initOptionsCommon.sessionId, initOptionsCommon.build),\r\n\t\t\tnew Release(telemetryGroup.audienceGroup),\r\n\t\t\tnew Browser(webGroup.browser, webGroup.browserVersion),\r\n\t\t\tnew Device(telemetryGroup.deviceId),\r\n\t\t\tnew User(telemetryGroup.loggableUserId ? telemetryGroup.loggableUserId : initOptionsCommon.cid, telemetryGroup.tenantId)\r\n\t\t),\r\n\t\tsamplingOption,\r\n\t\tinitOptionsCommon\r\n\t);\r\n\r\n\tenv = initOptionsCommon.environment;\r\n}\r\n\r\n/**\r\n * Get the logger object\r\n */\r\nexport function getLogger(): ILogger {\r\n\treturn logger;\r\n}\r\n\r\n/**\r\n * Interface for a logger\r\n */\r\nexport interface ILogger {\r\n\tlogEvent(eventId: IEventId, logSeverity: LogLevel, customProperties?: ICustomProperties, internalSampleRate?: number): void;\r\n\tlogLocal?(logSeverity: LogLevel, ...others: any[]): void;\r\n}\r\n\r\n/**\r\n * Log level settings\r\n */\r\nexport const enum LogLevel {\r\n\tNone,\r\n\tCritical,\r\n\tError,\r\n\tInfo\r\n}\r\n\r\ninterface ILogSettings {\r\n\tconsoleLog?: boolean;\r\n\tisEnabled?: boolean;\r\n\tlogLevel?: LogLevel;\r\n};\r\n\r\ninterface ILogLevelSettings {\r\n\tcontent: ILogSettings;\r\n};\r\n\r\n/**\r\n * Class representing a logger for the feedback SDK\r\n */\r\nexport class Logger implements ILogger {\r\n\tprivate static EVENT_NAME: string = \"SDK\";\r\n\tprivate static EVENT_ID: string = \"EventId\";\r\n\tprivate static DEFAULT_SAMPLE_RATE: number = 1;\r\n\r\n\tprivate telemetryLogger: ITelemetryLogger;\r\n\tprivate logLevel: LogLevel;\r\n\tprivate isConsoleLogEnabled: boolean;\r\n\tprivate dynamicLogSettings: ILogLevelSettings;\r\n\r\n\tprivate eventSampling: ISamplingInitOption;\r\n\tprivate initOptionsCommon: IInitOptionsCommon;\r\n\r\n\tprivate readonly SAMPLING_RESULT = Math.random();\r\n\r\n\tconstructor(telemetryLogger: ITelemetryLogger, samplingOptions: ISamplingInitOption, initOptionsCommon?: IInitOptionsCommon) {\r\n\t\tif (!telemetryLogger) {\r\n\t\t\tthrow new Error(\"telemetryLogger must not be null\");\r\n\t\t}\r\n\r\n\t\tthis.telemetryLogger = telemetryLogger;\r\n\t\tthis.eventSampling = samplingOptions;\r\n\t\tthis.initOptionsCommon = initOptionsCommon;\r\n\t}\r\n\r\n\t/**\r\n\t * Log an event\r\n\t * @param eventId event Id\r\n\t * @param logSeverity the log level severity for the message\r\n\t * @param customProperties custom properties to add to the log\r\n\t * @param internalSampleRate sample rate for this event in decimal (example: 0.05 for 5%). (Does not override host set sampleRate)\r\n\t */\r\n\tpublic logEvent(eventId: IEventId, logSeverity: LogLevel, customProperties?: ICustomProperties, internalSampleRate?: number): boolean {\r\n\t\tif (!eventId) {\r\n\t\t\tthrow new Error(\"eventId must not be null\");\r\n\t\t}\r\n\r\n\t\tlet sampleRate = Logger.DEFAULT_SAMPLE_RATE;\r\n\r\n\t\t// Host set sample rate has precedence over internalSampleRate.\r\n\t\tif (this.isEventSampled(eventId.name)) {\r\n\t\t\tsampleRate = this.getEventSamplingRate(eventId.name);\r\n\t\t} else if (internalSampleRate !== undefined) {\r\n\t\t\tsampleRate = internalSampleRate;\r\n\t\t}\r\n\r\n\t\tif (isNOU(logSeverity) || logSeverity === LogLevel.None) {\r\n\t\t\tif (env === Environment.Production) {\r\n\t\t\t\tconst errorMessage = \"logSeverity must not be null or none\";\r\n\t\t\t\tif (this.isConsoleLogEnabled && console) {\r\n\t\t\t\t\t// tslint:disable:no-console\r\n\t\t\t\t\tconsole.log(\"Floodgate event: \", Logger.EVENT_NAME, errorMessage);\r\n\t\t\t\t}\r\n\t\t\t\tthis.telemetryLogger.logEvent(Logger.EVENT_NAME, { ErrorMessage: errorMessage }, sampleRate);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tcustomProperties = customProperties || {};\r\n\t\t(<any> customProperties)[Logger.EVENT_ID] = eventId.name;\r\n\r\n\t\tif (this.isLoggingEnabled(logSeverity, sampleRate) || this.isEventTelemetryEnabled(eventId.name)) {\r\n\t\t\tthis.telemetryLogger.logEvent(Logger.EVENT_NAME, customProperties, sampleRate);\r\n\t\t}\r\n\r\n\t\tif (this.isConsoleLogEnabled && console) {\r\n\t\t\t// tslint:disable:no-console\r\n\t\t\tconsole.log(\"Floodgate event: \", Logger.EVENT_NAME, logSeverity, customProperties);\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tpublic logLocal?(logSeverity: LogLevel, ...others: any[]): void {\r\n\t\tif (this.isLoggingEnabled(logSeverity) && this.isConsoleLogEnabled && console) {\r\n\t\t\t// tslint:disable:no-console\r\n\t\t\tconsole.log(\"LPP FG: \", logSeverity, others);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getUserSamplingRate(): number {\r\n\t\treturn this.SAMPLING_RESULT;\r\n\t}\r\n\r\n\tpublic isEventTelemetryEnabled(eventName: string): boolean {\r\n\t\ttry {\r\n\t\t\tif (!this.dynamicLogSettings) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tconst appId = this.initOptionsCommon?.appId?.toString();\r\n\t\t\tconst locale = this.initOptionsCommon?.originalLocale?.toLowerCase();\r\n\t\t\tconst settingName = `content_${eventName}`;\r\n\r\n\t\t\t// try settings from more specific to generic order\r\n\t\t\tconst overrideSettings =\r\n\t\t\t\tthis.dynamicLogSettings[`${settingName}_${appId}_${locale}` as keyof ILogLevelSettings] ||\r\n\t\t\t\tthis.dynamicLogSettings[`${settingName}_${appId}` as keyof ILogLevelSettings] ||\r\n\t\t\t\tthis.dynamicLogSettings[`${settingName}_${locale}` as keyof ILogLevelSettings] ||\r\n\t\t\t\tthis.dynamicLogSettings[settingName as keyof ILogLevelSettings];\r\n\r\n\t\t\treturn overrideSettings?.isEnabled;\r\n\t\t} catch (e) {\r\n\t\t\tif (this.isConsoleLogEnabled) {\r\n\t\t\t\t// tslint:disable:no-console\r\n\t\t\t\tconsole.log(\"FG: Error checking for dynamic log settings: \", e);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * This method enables logging only if the log severity of the event is less than or equal to the\r\n\t * current log level set and within the sample rate. For example, if the log severity of the event is \r\n\t * LogLevel.Error and the current log level is set as LogLevel.Critical, then isLoggingEnabled will \r\n\t * return false since the condition LogLevel.Error <= LogLevel.Critical is false. Because, the log severity \r\n\t * follows the order defined in the LogLevel enum (None < Critical < Error < Info). The sample rate is the\r\n\t * percentage of users allow to send the event back. If the random genarated number is less than the sample rate\r\n\t * and the sample rate is not full blocking (0 value)\r\n\t * If no current log level is set, then the default log level is set as LogLevel.Error so that all events\r\n\t * marked with critical and error log severity get logged.\r\n\t * @param inputLogLevel the log severity of the event\r\n\t */\r\n\tprivate isLoggingEnabled(inputLogLevel: LogLevel, sampleRate: number = 1): boolean {\r\n\t\tif (isNOU(this.logLevel)) {\r\n\t\t\tconst currentLogLevel = this.getCurrentLogLevel();\r\n\t\t\tthis.logLevel = isNOU(currentLogLevel) ? LogLevel.Error : currentLogLevel;\r\n\t\t}\r\n\r\n\t\treturn (inputLogLevel <= this.logLevel && this.SAMPLING_RESULT <= sampleRate && sampleRate !== 0);\r\n\t}\r\n\r\n\t/**\r\n\t * This method returns the current log level if it is set in either url query parameters or floodgate local storage.\r\n\t * Following table summarizes whether the log event calls with a log severity will log the events or not according\r\n\t * to the current log level set. For example, the first row in the table demonstrates that when the current log level\r\n\t * enabled is critical, then the log event will log the events only if the log severity is critical.\r\n\t *\r\n\t * Current Log Level Enabled | LogSeverity: Critical\t| LogSeverity: Error\t| LogSeverity: Info\r\n\t * --------------------------------------------------------------------------------------------\r\n\t * Critical Enabled\t\t\t | yes      \t\t\t\t| no    \t\t\t \t| no\r\n\t * Error Enabled       \t\t | yes      \t\t\t\t| yes   \t\t\t \t| no\r\n\t * Info Enabled        \t\t | yes      \t\t\t\t| yes   \t\t\t \t| yes\r\n\t * None Enabled        \t\t | no       \t\t\t\t| no    \t\t\t \t| no\r\n\t *\r\n\t * Console logging will be enabled when the current log level is set through the url query parameters or\r\n\t * when the url query parameter \"obfconsolelog\" is explicitly set to true.\r\n\t */\r\n\tprivate getCurrentLogLevel(): LogLevel {\r\n\t\ttry {\r\n\t\t\t// Check if console log is enabled in local browser session with query parameter overrides\r\n\t\t\tconst urlParams = typeof URLSearchParams !== \"undefined\" && new URLSearchParams(window.location.search) || undefined;\r\n\t\t\tlet consoleLogParam: string | boolean = urlParams && urlParams.get(\"obfconsolelog\");\r\n\t\t\tif (!consoleLogParam) {\r\n\t\t\t\t// for getting iframe host url - eg: WAC\r\n\t\t\t\tconst documentReferrer = typeof document !== \"undefined\" && document.referrer;\r\n\t\t\t\tconsoleLogParam = documentReferrer && documentReferrer.indexOf(\"obfconsolelog\") !== -1;\r\n\t\t\t}\r\n\r\n\t\t\tif (consoleLogParam) {\r\n\t\t\t\tthis.isConsoleLogEnabled = true;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if log level is set in local browser session with query parameter overrides\r\n\t\t\tconst logLevelParam = urlParams && urlParams.get(\"obfloglevel\");\r\n\t\t\tif (!isNOU(logLevelParam)) {\r\n\t\t\t\tthis.isConsoleLogEnabled = true;\r\n\t\t\t\treturn parseInt(logLevelParam, 10);\r\n\t\t\t}\r\n\r\n\t\t\t// Check if log level is set in floodgate local storage (manually or with remotely fetched settings)\r\n\t\t\tif (FloodgateStorageProvider.isStorageAvailable()) {\r\n\t\t\t\tconst floodgateStorageProvider: FloodgateStorageProvider = new FloodgateStorageProvider();\r\n\t\t\t\tlet tempStorageItem: string = floodgateStorageProvider.read(FileType.LogLevelSettings);\r\n\t\t\t\tif (!tempStorageItem) {\r\n\t\t\t\t\ttempStorageItem = getDynamicSetting(SettingKey.logLevelSettings, \"\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst settingsObj = tempStorageItem && this.parseObject(tempStorageItem);\r\n\t\t\t\tif (settingsObj) {\r\n\t\t\t\t\tthis.dynamicLogSettings = settingsObj;\r\n\t\t\t\t\tlet logSettings = settingsObj.content as ILogSettings;\r\n\r\n\t\t\t\t\tif (this.initOptionsCommon) {\r\n\t\t\t\t\t\tconst appId = this.initOptionsCommon.appId && this.initOptionsCommon.appId.toString();\r\n\t\t\t\t\t\tconst locale =  this.initOptionsCommon.originalLocale && this.initOptionsCommon.originalLocale.toLowerCase();\r\n\r\n\t\t\t\t\t\t// log settings from more specific to generic order\r\n\t\t\t\t\t\tlogSettings = settingsObj[`content_${appId}_${locale}`] ||\r\n\t\t\t\t\t\t\t\t\t\tsettingsObj[`content_${appId}`] ||\r\n\t\t\t\t\t\t\t\t\t\tsettingsObj[`content_${locale}`] ||\r\n\t\t\t\t\t\t\t\t\t\tsettingsObj[`content`];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (logSettings) {\r\n\t\t\t\t\t\tif (logSettings.consoleLog) {\r\n\t\t\t\t\t\t\tthis.isConsoleLogEnabled = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn logSettings.logLevel;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tif (this.isConsoleLogEnabled) {\r\n\t\t\t\t// tslint:disable:no-console\r\n\t\t\t\tconsole.log(\"Error while getting the current log level: \", e);\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprivate parseObject(tempItem: string): any {\r\n\t\ttry {\r\n\t\t\treturn JSON.parse(tempItem);\r\n\t\t} catch (e) {\r\n\t\t\tif (this.isConsoleLogEnabled) {\r\n\t\t\t\t// tslint:disable:no-console\r\n\t\t\t\tconsole.log(\"Error while parsing the json string for log level: \", e);\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getEventSamplingRate(eventId: string): number {\r\n\t\tlet sampleRate = 1;\r\n\t\tif (this.eventSampling.event) {\r\n\t\t\t// If the event is init with sample rate\r\n\t\t\t// check the sampling result against the sample rate\r\n\t\t\tif (eventId in this.eventSampling.event) {\r\n\t\t\t\tsampleRate = this.eventSampling.event[eventId];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn sampleRate;\r\n\t}\r\n\r\n\tprivate isEventSampled(eventId: string): boolean {\r\n\t\tif (this.eventSampling.event) {\r\n\t\t\tif (eventId in this.eventSampling.event) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nclass TokenManager {\r\n\tpublic static getTenantToken(environment: Environment): string {\r\n\t\tif (environment === Environment.Production) {\r\n\t\t\treturn TokenManager.TENANT_TOKEN_PRODUCTION;\r\n\t\t} else {\r\n\t\t\treturn TokenManager.TENANT_TOKEN_PRE_PRODUCTION;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static TENANT_TOKEN_PRODUCTION: string =\r\n\t\"d79e824386c4441cb8c1d4ae15690526-bd443309-5494-444a-aba9-0af9eef99f84-7360\"; // \"Office Feedback\" Prod Aria tenant\r\n\tprivate static TENANT_TOKEN_PRE_PRODUCTION: string =\r\n\t\"2bf6a2ffddca4a80a892a0b182132961-625cb102-8b0c-480e-af53-92e48695d08d-7736\"; // \"Office Feedback\" Sandbox Aria tenant\r\n}\r\n","/**\r\n * Factory to return ITelemetryLogger objects\r\n */\r\n\r\nimport { App, Browser, Device, Host, Release, Session, User } from \"./Contracts\";\r\nimport ITelemetryLogger from \"./ITelemetryLogger\";\r\nimport AriaTelemetryLogger from \"./AriaTelemetryLogger\";\r\n\r\nexport default class TelemetryLoggerFactory {\r\n\tpublic static create(tenantToken: string, namespace: string, app: App, session: Session,\r\n\t\thost: Host, release: Release, browser: Browser, device: Device, user: User): ITelemetryLogger {\r\n\t\t\treturn new AriaTelemetryLogger(tenantToken, namespace, app, session, host, release, browser, device, user);\r\n\t\t}\r\n}\r\n","/**\r\n * CommonApp.ts\r\n *\r\n * Common logic for entrypoints.\r\n */\r\n\r\nimport \"./Polyfills/Promise\";\r\n\r\nimport Version from \"./Version\";\r\nimport * as Configuration from \"./Configuration/Configuration\";\r\nimport * as Window from \"./Window/Window\";\r\nimport * as Logging from \"./Logging/Logging\";\r\n\r\nconst APP_NAME: string = \"OfficeFeedbackSDK\";\r\n\r\n/**\r\n * Has the SDK been initialized\r\n */\r\nlet initialized: boolean = false;\r\n\r\n/**\r\n * Has the SDK allow AADC\r\n */\r\nlet commonPolicyAllowAADC: boolean = false;\r\n\r\n/**\r\n * Initialize\r\n */\r\nexport function initialize(): void {\r\n\tif (initialized) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (!Window.get().OfficeBrowserFeedback.initOptions) {\r\n\t\tthrow new Error(\"Window.OfficeBrowserFeedback.initOptions not set\");\r\n\t}\r\n\r\n\tWindow.get().OfficeBrowserFeedback.sdkVersion = Version;\r\n\tConfiguration.get().setCommonInitOptions(Window.get().OfficeBrowserFeedback.initOptions);\r\n\tcommonPolicyAllowAADC = Configuration.get().isFeedbackSurveyEnabledByAADC();\r\n\r\n\tLogging.initialize(\r\n\t\tConfiguration.get().getCommonInitOptions(),\r\n\t\tAPP_NAME,\r\n\t\tVersion,\r\n\t\tConfiguration.get().getSdkSessionId(),\r\n\t\tConfiguration.get().getEventSampling()\r\n\t);\r\n\r\n\tinitialized = true;\r\n\r\n\tif (!commonPolicyAllowAADC) {\r\n\t\tLogging.getLogger().logEvent(Logging.EventIds.FEEDBACK_SURVEYSDISABLED_AADC,\r\n\t\t\tLogging.LogLevel.Critical,\r\n\t\t\t{\r\n\t\t\t\tData: JSON.stringify({\r\n\t\t\t\t\tageGroup: Configuration.get().getCommonInitOptions().ageGroup,\r\n\t\t\t\t\tauthenticationType: Configuration.get().getCommonInitOptions().authenticationType,\r\n\t\t\t\t}),\r\n\t\t\t});\r\n\t}\r\n}\r\n\r\n/**\r\n * Reset the module. Used in unit tests.\r\n */\r\nexport function reset() {\r\n\tinitialized = false;\r\n}\r\n\r\n/**\r\n * Return Flag to determine whether Feedback and Survey is enabled by AADC.\r\n * Return true if Feedback and Survey is enabled.\r\n * Otherwise, return false.\r\n */\r\nexport function isFeedbackSurveyEnabledByAADC(): boolean {\r\n\treturn commonPolicyAllowAADC;\r\n}\r\n\r\nWindow.setIsFeedbackSurveyEnabledByAADC(isFeedbackSurveyEnabledByAADC);\r\n","/**\r\n * UIStrings.ts\r\n *\r\n * Module for the strings to display\r\n */\r\n\r\nexport interface IUIStrings {\r\n\tFeedbackSubtitle: string;\r\n\tPrivacyStatement: string;\r\n\r\n\tForm: {\r\n\t\tCommentPlaceholder: string;\r\n\t\tCategoryPlaceholder: string;\r\n\t\tEmailPlaceholder: string;\r\n\t\tRatingLabel: string;\r\n\t\tScreenshotLabel: string;\r\n\t\tEmailCheckBoxLabel: string;\r\n\t\tSubmit: string;\r\n\t\tBasicFormTitle: string;\r\n\t\tCancel: string;\r\n\t\tScreenshotImgAltText: string;\r\n\t\tPrivacyLabel: string;\r\n\t\tPrivacyConsent: string;\r\n\t};\r\n\r\n\tSingleForm: {\r\n\t\tTitle: string;\r\n\t};\r\n\r\n\tSmileForm: {\r\n\t\tAnchor: string;\r\n\t\tTitle: string;\r\n\t};\r\n\r\n\tFrownForm: {\r\n\t\tAnchor: string;\r\n\t\tTitle: string;\r\n\t};\r\n\r\n\tIdeaForm: {\r\n\t\tAnchor: string;\r\n\t\tTitle: string;\r\n\t};\r\n\r\n\tBugForm: {\r\n\t\tAnchor: string;\r\n\t\tTitle: string;\r\n\t};\r\n\r\n\tThanksPanel: {\r\n\t\tTitle: string;\r\n\t\tAppreciateText: string;\r\n\t\tMyFeedbackDescription: string;\r\n\t\tMyFeedbackLinkText: string;\r\n\t\tFeedbackPortalDescription: string;\r\n\t\tFeedbackPortalLinkText: string;\r\n\t\tClose: string;\r\n\t};\r\n\r\n\tFloodgate: {\r\n\t\tNps: {\r\n\t\t\tPrompt: {\r\n\t\t\t\tTitle: string;\r\n\t\t\t\tQuestion: string;\r\n\t\t\t\tYes: string;\r\n\t\t\t\tNo: string;\r\n\t\t\t};\r\n\r\n\t\t\tComment: {\r\n\t\t\t\tQuestion: string;\r\n\t\t\t};\r\n\r\n\t\t\tRating: {\r\n\t\t\t\tQuestion: string;\r\n\t\t\t\tPoints11Value0: string;\r\n\t\t\t\tPoints11Value1: string;\r\n\t\t\t\tPoints11Value2: string;\r\n\t\t\t\tPoints11Value3: string;\r\n\t\t\t\tPoints11Value4: string;\r\n\t\t\t\tPoints11Value5: string;\r\n\t\t\t\tPoints11Value6: string;\r\n\t\t\t\tPoints11Value7: string;\r\n\t\t\t\tPoints11Value8: string;\r\n\t\t\t\tPoints11Value9: string;\r\n\t\t\t\tPoints11Value10: string;\r\n\t\t\t\tPoints5Value1: string;\r\n\t\t\t\tPoints5Value2: string;\r\n\t\t\t\tPoints5Value3: string;\r\n\t\t\t\tPoints5Value4: string;\r\n\t\t\t\tPoints5Value5: string;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tCloseLabel: string;\r\n}\r\n\r\n/**\r\n * Localized UI strings\r\n */\r\nlet uIStrings: IUIStrings;\r\n\r\n/**\r\n * Set UI strings\r\n * @param {string} data List of localized UI strings\r\n */\r\nexport function setUIStrings(data: IUIStrings) {\r\n\tuIStrings = data;\r\n}\r\n\r\n/**\r\n * Get UI strings\r\n * @returns the UIStrings\r\n */\r\nexport function getUIStrings(): IUIStrings {\r\n\treturn uIStrings;\r\n}\r\n","/**\r\n * Constants.ts\r\n *\r\n * A module for all UI constants.\r\n */\r\n\r\n/**\r\n * HTML attribute names\r\n */\r\nexport class AttributeName {\r\n\tpublic static Alt: string = \"alt\";\r\n\tpublic static AriaLabel: string = \"aria-label\";\r\n\tpublic static AriaSelected: string = \"aria-selected\";\r\n\tpublic static AriaOrientation: string = \"aria-orientation\";\r\n\tpublic static AriaExpanded: string = \"aria-expanded\";\r\n\tpublic static AriaControls: string = \"aria-controls\";\r\n\tpublic static AriaHasPopups: string = \"aria-haspopup\";\r\n\tpublic static AriaModal: string = \"aria-modal\";\r\n\tpublic static AriaLabelledBy: string = \"aria-labelledby\";\r\n\tpublic static AriaDescribedBy: string = \"aria-describedby\";\r\n\tpublic static Class: string = \"class\";\r\n\tpublic static DataHtml2CanvasIgnore: string = \"data-html2canvas-ignore\";\r\n\tpublic static Disabled: string = \"disabled\";\r\n\tpublic static Fill: string = \"fill\";\r\n\tpublic static For: string = \"for\";\r\n\tpublic static Preview: string = \"preview\";\r\n\tpublic static Form: string = \"form\";\r\n\tpublic static Height: string = \"height\";\r\n\tpublic static HRef: string = \"href\";\r\n\tpublic static Id: string = \"id\";\r\n\tpublic static MaxLength: string = \"maxlength\";\r\n\tpublic static Name: string = \"name\";\r\n\tpublic static Placeholder: string = \"placeholder\";\r\n\tpublic static Points: string = \"points\";\r\n\tpublic static Rel: string = \"rel\";\r\n\tpublic static Role: string = \"role\";\r\n\tpublic static Source: string = \"src\";\r\n\tpublic static Stroke: string = \"stroke\";\r\n\tpublic static TabIndex: string = \"tabindex\";\r\n\tpublic static Target: string = \"target\";\r\n\tpublic static Transform: string = \"transform\";\r\n\tpublic static Type: string = \"type\";\r\n\tpublic static Value: string = \"value\";\r\n\tpublic static ViewBox: string = \"viewBox\";\r\n\tpublic static Width: string = \"width\";\r\n\tpublic static xlinkHref: string = \"xlink:href\";\r\n\tpublic static X: string = \"x\";\r\n\tpublic static Y: string = \"y\";\r\n}\r\n\r\n/**\r\n * HTML attribute values\r\n */\r\nexport class AttributeValue {\r\n\tpublic static BlankWindow: string = \"_blank\";\r\n\tpublic static Button: string = \"button\";\r\n\tpublic static Dialog: string = \"dialog\";\r\n\tpublic static Tab: string = \"tab\";\r\n\tpublic static TabList: string = \"tablist\";\r\n\tpublic static TabPanel: string = \"tabpanel\";\r\n\tpublic static Checkbox: string = \"checkbox\";\r\n\tpublic static Checked: string = \"checked\";\r\n\tpublic static False: string = \"false\";\r\n\tpublic static Zero: string = \"0\";\r\n\tpublic static Polite: string = \"polite\";\r\n\tpublic static Radio: string = \"radio\";\r\n\tpublic static Submit: string = \"submit\";\r\n\tpublic static ScreenshotPreview: string = \"ScreenshotPreview\";\r\n\tpublic static Text: string = \"text\";\r\n\tpublic static TextAreaMaxLength: string = \"1000\";\r\n\tpublic static True: string = \"true\";\r\n\tpublic static Unchecked: string = \"unchecked\";\r\n\tpublic static NoReferrer: string = \"noreferrer\";\r\n\tpublic static AriaOrientationValueVertical = \"vertical\";\r\n}\r\n\r\n/**\r\n * URL Parameters\r\n */\r\nexport class UrlParameters {\r\n\tpublic static CLCID: string = \"CLCID\";\r\n}\r\n\r\n/**\r\n * CSS classes\r\n */\r\nexport class Classes {\r\n\tpublic static AriaLiveTemplate: string = \"obf-AriaLiveTemplate\";\r\n\tpublic static CheckBox: string = \"obf-CheckBox\";\r\n\tpublic static FontTitle: string = \"obf-FontTitle\";\r\n\tpublic static CloseButton: string = \"obf-CloseButton\";\r\n\tpublic static FontSubtitle: string = \"obf-FontSubtitle\";\r\n\tpublic static FontText: string = \"obf-FontText\";\r\n\tpublic static FontSubText: string = \"obf-FontSubText\";\r\n\tpublic static FontSubSubText: string = \"obf-FontSubSubText\";\r\n\tpublic static Hidden: string = \"obf-Hidden\";\r\n\tpublic static Link: string = \"obf-Link\";\r\n\tpublic static MarginLeft60px: string = \"obf-MarginLeft60px\";\r\n\tpublic static MarginLeft180px: string = \"obf-MarginLeft180px\";\r\n\tpublic static NarrowLayout: string = \"obf-NarrowLayout\";\r\n\tpublic static PrivacyStatementLinkDiv: string = \"obf-PrivacyStatementLinkDiv\";\r\n\tpublic static Rtl: string = \"obf-Rtl\";\r\n\tpublic static Spinner: string = \"obf-Spinner\";\r\n\tpublic static SpinnerCircle: string = \"obf-SpinnerCircle\";\r\n\tpublic static SubmitButton: string = \"obf-SubmitButton\";\r\n\tpublic static CancelButton: string = \"obf-CancelButton\";\r\n\tpublic static TextInput: string = \"obf-TextInput\";\r\n\tpublic static Visible: string = \"obf-Visible\";\r\n\r\n\t// rating control\r\n\tpublic static Rating: string = \"obf-Rating\";\r\n\tpublic static RatingGraphic: string = \"obf-RatingGraphic\";\r\n\tpublic static RatingGraphicFilled: string = \"obf-RatingGraphic-Filled\";\r\n\r\n\t// choice group control\r\n\tpublic static ChoiceGroup: string = \"obf-ChoiceGroup\";\r\n\tpublic static ChoiceGroupIcon: string = \"obf-ChoiceGroupIcon\";\r\n\r\n\t// region BellyBand\r\n\r\n\tpublic static OverallAnchor: string = \"obf-OverallAnchor\";\r\n\tpublic static OverallAnchorActive: string = \"obf-OverallAnchorActive\";\r\n\tpublic static OverallImage: string = \"obf-OverallImage\";\r\n\tpublic static OverallText: string = \"obf-OverallText\";\r\n\tpublic static SingleLayout: string = \"obf-SingleLayout\";\r\n\tpublic static ShowRightBorder: string = \"obf-ShowRightBorder\";\r\n\tpublic static SlideLeft: string = \"obf-slideLeft\";\r\n\tpublic static TextAlignLeft: string = \"obf-TextAlignLeft\";\r\n\tpublic static FormContainer: string = \"obf-FormContainer\";\r\n\tpublic static FormWideContainer: string = \"obf-FormWideContainer\";\r\n\r\n\t// region ThanksPanel\r\n\tpublic static ThanksPanelTitle: string = \"obf-ThanksPanelTitle\";\r\n\tpublic static ThanksPanelMessage: string = \"obf-ThanksPanelMessage\";\r\n\r\n\t// form classes\r\n\tpublic static FormQuestionMiddleText: string = \"obf-FormQuestionMiddleText\";\r\n\tpublic static FormMiddleText: string = \"obf-FormMiddleText\";\r\n\tpublic static FormCategoriesDropdown: string = \"obf-FormCategoriesDropdown\";\r\n\tpublic static FormComment: string = \"obf-FormComment\";\r\n\tpublic static FormRatingContainer: string = \"obf-FormRatingContainer\";\r\n\tpublic static FormRatingLabel: string = \"obf-FormRatingLabel\";\r\n\tpublic static FormRating: string = \"obf-FormRating\";\r\n\tpublic static FormEmailContainer: string = \"obf-FormEmailContainer\";\r\n\tpublic static FormEmailInput: string = \"obf-FormEmailInput\";\r\n\tpublic static FormEmailTextBox: string = \"obf-FormEmailTextBox\";\r\n\tpublic static FormEmailCheckBox: string = \"obf-FormEmailCheckBox\";\r\n\tpublic static FormEmailLabel: string = \"obf-FormEmailLabel\";\r\n\tpublic static FormBottomContainer: string = \"obf-FormBottomContainer\";\r\n\tpublic static FormSubmitButtonContainer: string = \"obf-FormSubmitButtonContainer\";\r\n\tpublic static FormScreenshotContainer: string = \"obf-FormScreenshotContainer\";\r\n\tpublic static FormScreenshotLabel: string = \"obf-FormScreenshotLabel\";\r\n\tpublic static FormScreenshotCheckbox: string = \"obf-FormScreenshotCheckbox\";\r\n\tpublic static FormScreenshotPreview: string = \"obf-FormScreenshotPreview\";\r\n\t// email textbox classes\r\n\tpublic static TFormEmailCheckbox: string = \"obf-TFormEmailCheckbox\";\r\n\tpublic static TFormEmailLabel: string = \"obf-TFormEmailLabel \";\r\n\r\n\t// email checkbox classes\r\n\tpublic static EmailCheckBoxLabel: string = \"obf-EmailCheckBoxLabel\";\r\n\r\n\t// endregion\r\n\r\n\t// region Toast\r\n\r\n\tpublic static Toast: string = \"obf-Toast\";\r\n\tpublic static ToastZoom: string = \"obf-ToastZoom\";\r\n\r\n\t// endregion\r\n}\r\n\r\n/**\r\n * HTML element ids\r\n */\r\nexport class IDs {\r\n\t// region BellyBand\r\n\tpublic static CloseButton: string = \"obf-CloseButton\";\r\n\tpublic static ColumnSeparatorDiv: string = \"obf-ColumnSeparatorDiv\";\r\n\tpublic static OverallAnchorsContainer: string = \"obf-OverallAnchorsContainer\";\r\n\tpublic static OverallFrownAnchor: string = \"obf-OverallFrownAnchor\";\r\n\tpublic static OverallFrownDiv: string = \"obf-OverallFrownDiv\";\r\n\tpublic static OverallFrownImage: string = \"obf-OverallFrownImage\";\r\n\tpublic static OverallFrownText: string = \"obf-OverallFrownText\";\r\n\tpublic static OverallSmileAnchor: string = \"obf-OverallSmileAnchor\";\r\n\tpublic static OverallSmileDiv: string = \"obf-OverallSmileDiv\";\r\n\tpublic static OverallSmileImage: string = \"obf-OverallSmileImage\";\r\n\tpublic static OverallSmileText: string = \"obf-OverallSmileText\";\r\n\tpublic static OverallIdeaAnchor: string = \"obf-OverallIdeaAnchor\";\r\n\tpublic static OverallIdeaDiv: string = \"obf-OverallIdeaDiv\";\r\n\tpublic static OverallIdeaImage: string = \"obf-OverallIdeaImage\";\r\n\tpublic static OverallIdeaText: string = \"obf-OverallIdeaText\";\r\n\tpublic static OverallBugAnchor: string = \"obf-OverallBugAnchor\";\r\n\tpublic static OverallBugDiv: string = \"obf-OverallBugDiv\";\r\n\tpublic static OverallBugImage: string = \"obf-OverallBugImage\";\r\n\tpublic static OverallBugText: string = \"obf-OverallBugText\";\r\n\tpublic static QuestionLeftText: string = \"obf-QuestionLeftText\";\r\n\tpublic static LeftFormContainer: string = \"obf-LeftFormContainer\";\r\n\tpublic static LeftPanelContainer: string = \"obf-LeftPanelContainer\";\r\n\tpublic static MainContainer: string = \"obf-MainContainer\";\r\n\tpublic static MainContentHolder: string = \"obf-MainContentHolder\";\r\n\tpublic static MiddleFormContainer: string = \"obf-MiddleFormContainer\";\r\n\tpublic static OverlayBackground: string = \"obf-OverlayBackground\";\r\n\tpublic static PrivacyStatementLink: string = \"obf-PrivacyStatementLink\";\r\n\tpublic static FirstTabbable: string = \"obf-FirstTabbable\";\r\n\tpublic static LastTabbable: string = \"obf-LastTabbable\";\r\n\tpublic static EmailCheckBox: string = \"obf-EmailCheckBox\";\r\n\r\n\t// Single form ids\r\n\tpublic static SingleFormContainer: string = \"obf-SingleFormContainer\";\r\n\tpublic static SingleFormQuestionMiddleText: string = \"obf-SingleFormQuestionMiddleText\";\r\n\tpublic static SingleFormCategoriesDropdown: string = \"obf-SingleFormCategoriesDropdown\";\r\n\tpublic static SingleFormComment: string = \"obf-SingleFormComment\";\r\n\tpublic static SingleFormEmailInput: string = \"obf-SingleFormEmailInput\";\r\n\tpublic static SingleFormRating: string = \"obf-SingleFormRating\";\r\n\tpublic static SingleFormScreenshotCheckbox: string = \"obf-SingleFormScreenshotCheckbox\";\r\n\tpublic static SingleFormScreenshotPreview: string = \"obf-SingleFormScreenshotPreview\";\r\n\tpublic static SingleFormSubmitButton: string = \"obf-SingleFormSubmitButton\";\r\n\tpublic static SingleFormCancelButton: string = \"obf-SingleFormCancelButton\";\r\n\tpublic static SingleFormSubmitButtonSpinner: string = \"obf-SingleFormSubmitButtonSpinner\";\r\n\r\n\t// Basic form ids\r\n\tpublic static BasicFormContainer: string = \"obf-BasicFormContainer\";\r\n\tpublic static BasicFormQuestionMiddleText: string = \"obf-BasicFormQuestionMiddleText\";\r\n\tpublic static BasicFormCategoriesDropdown: string = \"obf-BasicFormCategoriesDropdown\";\r\n\tpublic static BasicFormComment: string = \"obf-BasicFormComment\";\r\n\tpublic static BasicFormEmailInput: string = \"obf-BasicFormEmailInput\";\r\n\tpublic static BasicFormRating: string = \"obf-BasicFormRating\";\r\n\tpublic static BasicFormScreenshotCheckbox: string = \"obf-BasicFormScreenshotCheckbox\";\r\n\tpublic static BasicFormScreenshotPreview: string = \"obf-BasicFormScreenshotPreview\";\r\n\tpublic static BasicFormSubmitButton: string = \"obf-BasicFormSubmitButton\";\r\n\tpublic static BasicFormCancelButton: string = \"obf-BasicFormCancelButton\";\r\n\tpublic static BasicFormSubmitButtonSpinner: string = \"obf-BasicFormSubmitButtonSpinner\";\r\n\r\n\t// Thanks Panel ids\r\n\tpublic static ThanksPanelContainer: string = \"obf-ThanksPanelContainer\";\r\n\tpublic static ThanksPanelCloseButton: string = \"obf-ThanksPanelCloseButton\";\r\n\tpublic static ThanksPanelDiscussion: string = \"obf-ThanksPanelDiscussion\";\r\n\tpublic static ThanksPanelVerticalContainer: string = \"obf-ThanksPanelVerticalContainer\";\r\n\tpublic static ThanksPanelInnerContainer: string = \"obf-ThanksPanelInnerContainer\";\r\n\tpublic static ThanksPanelParagraph: string = \"obf-ThanksPanelParagraph\";\r\n\r\n\t// Feedback Portal Idea Id\r\n\tpublic static FeedbackPortalIdeaContainer: string = \"obf-FeedbackPortalIdeaContainer\";\r\n\tpublic static OverallFeedbackPortalIdeaAnchor: string = \"obf-OverallFeedbackPortalIdeaAnchor\";\r\n\r\n\t// endregion\r\n\r\n\t// region Toast\r\n\tpublic static ToastContainer: string = \"obf-ToastContainer\";\r\n\tpublic static ToastCancel: string = \"obf-ToastCancel\";\r\n\r\n\t// Prompt ids\r\n\tpublic static TPromptContainer: string = \"obf-TPromptContainer\";\r\n\tpublic static TPromptTitle: string = \"obf-TPromptTitle\";\r\n\tpublic static TPromptText: string = \"obf-TPromptText\";\r\n\r\n\t// Survey ids\r\n\tpublic static TFormContainer: string = \"obf-TFormContainer\";\r\n\tpublic static TFormTitle: string = \"obf-TFormTitle\";\r\n\tpublic static TFormRating: string = \"obf-TFormRating\";\r\n\tpublic static TFormRatingQuestion: string = \"obf-TFormRatingQuestion\";\r\n\tpublic static TFormComment: string = \"obf-TFormComment\";\r\n\tpublic static TFormEmailTextBox: string = \"obf-TFormEmailTextBox\";\r\n\tpublic static TFormEmailCheckBox: string = \"obf-TFormEmailCheckBox\";\r\n\tpublic static TFormEmailLabel: string = \"obf-TFormEmailLabel\";\r\n\tpublic static TFormSubmitButton: string = \"obf-TFormSubmitButton\";\r\n\tpublic static TFormSubmitButtonSpinner: string = \"obf-TFormSubmitButtonSpinner\";\r\n\tpublic static TFormSubmitButtonContainer: string = \"obf-TFormSubmitButtonContainer\";\r\n\r\n\t// endregion\r\n}\r\n\r\n/**\r\n * Keys\r\n */\r\nexport class Keys {\r\n\tpublic static Esc: number = 27;\r\n\tpublic static Tab: number = 9;\r\n}\r\n\r\n/**\r\n * HTML tags\r\n */\r\nexport class Tags {\r\n\tpublic static Anchor: string = \"A\";\r\n\tpublic static Button: string = \"button\";\r\n\tpublic static Defs: string = \"defs\";\r\n\tpublic static Div: string = \"div\";\r\n\tpublic static FieldSet: string = \"fieldset\";\r\n\tpublic static Form: string = \"form\";\r\n\tpublic static Img: string = \"img\";\r\n\tpublic static Input: string = \"input\";\r\n\tpublic static Label: string = \"label\";\r\n\tpublic static Legend: string = \"legend\";\r\n\tpublic static Option: string = \"option\";\r\n\tpublic static Polygon: string = \"polygon\";\r\n\tpublic static Select: string = \"select\";\r\n\tpublic static Span: string = \"span\";\r\n\tpublic static Svg: string = \"svg\";\r\n\tpublic static TextArea: string = \"textarea\";\r\n\tpublic static Use: string = \"use\";\r\n}\r\n\r\n/**\r\n * HTML roles\r\n */\r\nexport class Roles {\r\n\tpublic static Button: string = \"Button\";\r\n}\r\n\r\n/**\r\n * URLs\r\n */\r\nexport class Urls {\r\n\t/**\r\n\t * Link to the feedback Privacy Statement\r\n\t */\r\n\tpublic static PrivacyStatementLink: string = \"https://go.microsoft.com/fwlink/?LinkId=521839\";\r\n}\r\n\r\n/**\r\n * prompt constants\r\n */\r\nexport class PromptConstants {\r\n\tpublic static No: string = \"1\";\r\n\tpublic static Yes: string = \"2\";\r\n}\r\n","/**\r\n * Screenshot.ts\r\n *\r\n * A module for screenshot. It uses the html2canvas package.\r\n */\r\n\r\nconst html2canvas: any = require(\"../app/thirdparty/html2canvas/html2canvas\");\r\n\r\n/**\r\n * Get screenshot\r\n * @param domElement document element or document body \r\n * @param options background color\r\n */\r\nexport function createScreenshot(domElement?: object, options?: any): Promise<HTMLCanvasElement> {\r\n\treturn html2canvas(domElement || document.body, { background: \"#ffffff\", ...options });\r\n}\r\n","/**\r\n * CommonUI.ts\r\n *\r\n * Common logic for UI.\r\n */\r\n\r\nconst html2canvas: any = require(\"../app/thirdparty/html2canvas/html2canvas\");\r\n\r\nimport * as UIStrings from \"./UIStrings/UIStrings\";\r\nimport * as Configuration from \"./Configuration/Configuration\";\r\nimport * as Window from \"./Window/Window\";\r\nimport * as Theme from \"./Theme\";\r\nimport * as Screenshot from \"./Screenshot\";\r\nimport { loadStylesheet, loadScript } from \"./Window/DomUtils\";\r\nimport { IDs } from \"./UI/UiConstants\";\r\nimport { checkCssSelectorToBeSet } from \"./Utils\";\r\n\r\n/**\r\n * Has the SDK been initialized\r\n */\r\nlet initialized: boolean = false;\r\n\r\n/**\r\n * Set ui Strings.\r\n * @param data the ui strings\r\n */\r\nfunction setUIStrings(data: any): void {\r\n\tUIStrings.setUIStrings(data);\r\n};\r\n\r\n/**\r\n * Initialize\r\n */\r\nexport function initialize(): Promise<any> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tif (!initialized) {\r\n\t\t\tconst initOptionsCommon = Configuration.get().getCommonInitOptions();\r\n\t\t\tif (!initOptionsCommon) {\r\n\t\t\t\treject(\"initOptionsCommon is null\");\r\n\t\t\t}\r\n\r\n\t\t\t// Check if custom CSS is being passed.\r\n\t\t\t// tslint:disable-next-line: no-bitwise\r\n\t\t\tif ((initOptionsCommon.customResourcesSetExternally & Configuration.CustomResources.Css) === Configuration.CustomResources.Css) {\r\n\t\t\t\tconst selector = \"#\" + IDs.TPromptTitle;\r\n\r\n\t\t\t\tif (!checkCssSelectorToBeSet(selector)) {\r\n\t\t\t\t\treject(\"Expected custom Css to be set by host but \" + selector + \" was not found to be set.\");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tloadStylesheet(initOptionsCommon.stylesUrl);\r\n\t\t\t}\r\n\r\n\t\t\tTheme.initialize(initOptionsCommon.primaryColour, initOptionsCommon.secondaryColour);\r\n\r\n\t\t\t// Check if custom strings are being passed.\r\n\t\t\t// tslint:disable-next-line: no-bitwise\r\n\t\t\tif ((initOptionsCommon.customResourcesSetExternally & Configuration.CustomResources.Strings) === Configuration.CustomResources.Strings) {\r\n\r\n\t\t\t\tif (!UIStrings.getUIStrings()) {\r\n\t\t\t\t\treject(\"Expected custom strings to be set by host but UIStrings.getUIStrings() is null or undefined\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tinitialized = true;\r\n\t\t\t\tresolve();\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst intlFileUrl =  initOptionsCommon.intlUrl + initOptionsCommon.locale.toLowerCase() + \"/\" +\r\n\t\t\t\t\tinitOptionsCommon.intlFilename;\r\n\r\n\t\t\t\tloadScript(intlFileUrl)\r\n\t\t\t\t.then(\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tif (!UIStrings.getUIStrings()) {\r\n\t\t\t\t\t\t\treject(\"UiStrings were not loaded from \" + intlFileUrl);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tinitialized = true;\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t).catch(\r\n\t\t\t\t\t(err) => {\r\n\t\t\t\t\t\treject(\"Script load failed for \" + intlFileUrl + \". \" + err);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tresolve();\r\n\t\t}\r\n\t});\r\n}\r\n\r\n/**\r\n * Reset the module. Used in unit tests.\r\n */\r\nexport function reset() {\r\n\tinitialized = false;\r\n}\r\n\r\n/* Make the setUIStrings method available globally */\r\nWindow.setSetUiStrings(setUIStrings);\r\nWindow.setCreateScreenshot(Screenshot.createScreenshot);\r\nWindow.get().OfficeBrowserFeedback.html2canvas = html2canvas;\r\n","/*\r\n * DomUtils.ts\r\n *\r\n * Module for page document utility functions\r\n */\r\n\r\n/**\r\n * Load the style sheet\r\n * @param url The url of the stylesheet\r\n */\r\nexport function loadStylesheet(url: string): void {\r\n\tconst link: HTMLLinkElement = document.createElement(\"link\");\r\n\tlink.rel = \"stylesheet\";\r\n\tlink.type = \"text/css\";\r\n\tlink.href = url;\r\n\r\n\tconst entry: HTMLScriptElement = document.getElementsByTagName(\"script\")[0];\r\n\tentry.parentNode.insertBefore(link, entry);\r\n}\r\n\r\n/**\r\n * Load the script and callback after it is loaded\r\n * @param url The url of the script\r\n * @param pageOrigin Optional - Origin of the page\r\n */\r\nexport function loadScript(url: string, pageOrigin: string = (window as any).origin): Promise<void> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst script: any = document.createElement(\"script\");\r\n\t\tscript.async = true;\r\n\r\n\t\tif (script.readyState) { // IE\r\n\t\t\tscript.onreadystatechange = function() {\r\n\t\t\t\tif (script.readyState === \"loaded\" || script.readyState === \"complete\") {\r\n\t\t\t\t\tscript.onreadystatechange = null;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t} else {  // Others\r\n\t\t\tscript.onload = function() {\r\n\t\t\t\tresolve();\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tscript.onerror = function() {\r\n\t\t\treject();\r\n\t\t};\r\n\r\n\t\tscript.src = url;\r\n\r\n\t\t// don't add if origin is not available or when containing \"null\". This is to mitigate possible\r\n\t\t// unexpected behavior with Chrome when a page hosting this SDK is being tested as a local file.\r\n\t\t// The behavior depends on Chrome.exe's --allow-file-access-from-files setting.\r\n\t\tif (pageOrigin && pageOrigin !== \"null\") {\r\n\t\t\tscript.crossOrigin = \"anonymous\";\r\n\t\t}\r\n\r\n\t\tconst entry: HTMLScriptElement = document.getElementsByTagName(\"script\")[0];\r\n\t\tentry.parentNode.insertBefore(script, entry);\r\n\t});\r\n}\r\n","/**\r\n * Theme.ts\r\n *\r\n * Module for the UI Theme\r\n */\r\n\r\nimport { Classes, IDs } from \"./UI/UiConstants\";\r\n\r\nlet defaultPrimaryColour = \"#0167B0\";\r\nlet defaultSecondaryColour = \"#194789\";\r\n\r\n/**\r\n * Init\r\n * @param {string} primaryColour Primary Colour\r\n * @param {string} secondaryColour Secondary Colour\r\n */\r\nexport function initialize(primaryColour: string = undefined, secondaryColour: string = undefined) {\r\n\tif (!primaryColour) {\r\n\t\tprimaryColour = defaultPrimaryColour;\r\n\t}\r\n\r\n\tif (!secondaryColour) {\r\n\t\tsecondaryColour = defaultSecondaryColour;\r\n\t}\r\n\r\n\tlet sheet = document.createElement(\"style\");\r\n\r\n\tsheet.textContent =\r\n\t\t`.${Classes.OverallAnchor}:focus { background-color: ${primaryColour} } ` +\r\n\t\t`.${Classes.OverallAnchor}:hover { background-color: ${secondaryColour} } ` +\r\n\t\t`.${Classes.OverallAnchorActive} { background-color: ${primaryColour} } ` +\r\n\t\t`.${Classes.SpinnerCircle} { background-color: ${primaryColour} } ` +\r\n\t\t// tslint:disable-next-line:max-line-length\r\n\t\t`.${Classes.ChoiceGroup} input[type=radio]:checked+label>.${Classes.ChoiceGroupIcon} { border-color: ${primaryColour} } ` +\r\n\t\t// tslint:disable-next-line:max-line-length\r\n\t\t`.${Classes.ChoiceGroup} input[type=radio]:hover+label>.${Classes.ChoiceGroupIcon} { border-color: ${secondaryColour} } ` +\r\n\t\t// tslint:disable-next-line:max-line-length\r\n\t\t`.${Classes.ChoiceGroup} input[type=radio]:checked+label>.${Classes.ChoiceGroupIcon}>span { background-color: ${primaryColour} } ` +\r\n\t\t`.${Classes.SubmitButton} { background-color: ${primaryColour} } ` +\r\n\t\t`.${Classes.SubmitButton}:hover { background-color: ${secondaryColour} } ` +\r\n\t\t`.${Classes.CancelButton} { background-color: ${primaryColour} } ` +\r\n\t\t`.${Classes.CancelButton}:hover { background-color: ${secondaryColour} } ` +\r\n\t\t`.${Classes.Link} { color: ${primaryColour} } ` +\r\n\t\t`.${Classes.Link}:hover { color: ${secondaryColour} } ` +\r\n\t\t`.${Classes.ThanksPanelTitle} { color: ${primaryColour} } ` +\r\n\t\t`#${IDs.TPromptTitle} { color: ${primaryColour} } ` +\r\n\t\t`#${IDs.TFormTitle} { color: ${primaryColour} } `;\r\n\r\n\tdocument.body.appendChild(sheet);\r\n}\r\n","import * as Configuration from \"../Configuration/Configuration\";\r\n\r\nconst HTTP_TIMEOUT: number = 8000; // timeout in milliseconds\r\n/**\r\n * Make an http request with retries\r\n * @param method the http method \"GET\", \"POST\" etc\r\n * @param url the url\r\n * @param requestBody the request body\r\n * @param maxRetries the maximum number of retries\r\n * @param onLoad the onload handler\r\n */\r\nfunction makeHttpRequest<T>(method: string, url: string, requestBody: any, maxRetries: number,\r\n\tonLoad: (xhr: XMLHttpRequest, resolve: (value?: T) => void, reject: (error?: any) => void) => void\r\n): Promise<T> {\r\n\tlet makeRequest: (retries: number, timeout: number) => Promise<T> =\r\n\t\t(retries: number, timeout: number) => {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tlet xhr: XMLHttpRequest = new XMLHttpRequest();\r\n\t\t\t\txhr.open(method, url, true);\r\n\t\t\t\txhr.timeout = timeout;\r\n\t\t\t\txhr.onload = () => { onLoad(xhr, resolve, reject); };\r\n\t\t\t\txhr.ontimeout = () => {\r\n\t\t\t\t\tif (retries > 0) {\r\n\t\t\t\t\t\t// double the timeout and retry it\r\n\t\t\t\t\t\tmakeRequest(retries - 1, timeout * 2).then(resolve, reject);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treject(new Error(`Request to '${url}' timed out. timeout: ${xhr.timeout}`));\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\txhr.onerror = () => {\r\n\t\t\t\t\tif (retries > 0) {\r\n\t\t\t\t\t\tmakeRequest(retries - 1, timeout).then(resolve, reject);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treject(new Error(`Request to '${url}' errored. ${xhr.status} - ${xhr.statusText} : ${xhr.responseText}`));\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\txhr.send(requestBody);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t// get the input timeout or using the default value if timeout is not defined\r\n\tconst httpTimeout = Configuration.get().getCommonInitOptions().petrolTimeout\r\n\t\t\t\t\t\t? Configuration.get().getCommonInitOptions().petrolTimeout\r\n\t\t\t\t\t\t: HTTP_TIMEOUT;\r\n\r\n\treturn makeRequest(maxRetries, httpTimeout);\r\n}\r\n\r\nconst uploadEndpointInt: string = \"https://petrol-int.office.microsoft.com/v1/feedback\";\r\nconst uploadEndpointProd: string = \"https://petrol.office.microsoft.com/v1/feedback\";\r\n\r\n/**\r\n * Send a payload to Petrol\r\n * @param isProduction is production?\r\n * @param manifest manifest content\r\n * @param screenshot screenshot content\r\n * @param diagnostics diagnostics content\r\n */\r\nexport function send(isProduction: boolean, manifest: Blob, screenshot?: Blob, diagnostics?: Blob): Promise<any> {\r\n\tif (manifest === undefined) {\r\n\t\treturn Promise.reject(new Error(\"Manifest cannot be undefined\"));\r\n\t}\r\n\r\n\tlet formData = new FormData();\r\n\tformData.append(\"Manifest\", manifest);\r\n\r\n\tif (screenshot) {\r\n\t\tformData.append(\"Screenshot\", screenshot);\r\n\t}\r\n\r\n\tif (diagnostics) {\r\n\t\tformData.append(\"Diagnostics\", diagnostics);\r\n\t}\r\n\r\n\treturn makeHttpRequest<any>(\"POST\", isProduction ? uploadEndpointProd : uploadEndpointInt, formData, 2,\r\n\t\tfunction (\r\n\t\t\txhr: XMLHttpRequest,\r\n\t\t\tresolve: (value?: any) => void,\r\n\t\t\treject: (error?: any) => void\r\n\t\t): void {\r\n\t\t\tif (xhr.status !== 200) {\r\n\t\t\t\treject(new Error(\"Non-200 response with status code: \" + xhr.status + \", response: \" + xhr.responseText));\r\n\t\t\t}\r\n\t\t\tresolve();\r\n\t\t});\r\n}\r\n","/**\r\n * Screenshot.ts\r\n * Module for managing the screenshot file\r\n */\r\n\r\n/* tslint:disable max-line-length */\r\nimport {IFile} from \"./IFile\";\r\nimport * as Logging from \"./../../Logging/Logging\";\r\n\r\nexport class Screenshot implements IFile {\r\n\tprivate screenshot: HTMLCanvasElement;\r\n\r\n\tconstructor (screenshot: HTMLCanvasElement) {\r\n\t\tthis.screenshot = screenshot;\r\n\t}\r\n\r\n\tpublic getContent(): Blob {\r\n\t\tlet imgString: string;\r\n\t\ttry {\r\n\t\t\timgString = this.screenshot.toDataURL(\"image/jpeg\").split(\",\")[1];\r\n\t\t} catch (e) {\r\n\t\t\tLogging.getLogger().logEvent(Logging.EventIds.Shared.Screenshot.GetContent.Failed.DefaultImage.Returned.VALUE,\r\n\t\t\t\tLogging.LogLevel.Error, { ErrorMessage: e.toString() });\r\n\r\n\t\t\t// return an image with \"Screenshot cannot be captured\" message\r\n\t\t\timgString = \"iVBORw0KGgoAAAANSUhEUgAAAN0AAAA+AQMAAACV2ox1AAAABGdBTUEAALGPC/xhBQAAAAZQTFRFAAAA////pdmf3QAAAAlwSFlzAAAOwgAADsIBFShKgAAAAjtJREFUSMfV1M1rE0EUAHDBa5r8A9vkL6giFiI0JH+Ih9KLx8TaukkJugShHgrJzYvkVPQkUqgwSePLEELaU+zBg8JKVvSQQNydlsadwCQzziRZ82ETxYMfc3gD8+MxjzcfV8T80f0vkQ8i68tAPSMSQ0PkI6QDpEPkZBHy1Wp1/zjni2lrZq2T2uikDG17A54Hr0vsvwXIl3WXt02zeIHQBSq3DxHk7VO55zIFgLLrcmaaQBGiqCwQArBVQTbNZODNBB5Ee2EEr5eGiDG4k5mcqcy+Ksh+N8K2+bRI1Z68fRMVoV+XmcFwpQJZGohpkds1WtjppGLaq51a2b8yp310UW9/H8VfRj68CIKRsWCFPCCEM419S4bSAOmPmdb3TBrQ4lmnt9n4/Hiv5fTunsOzXbJfLR2rU3Fd5ugOe9mw0lvNOCNxyDdIHkpHCv0S3a+MS0yT+4wkAKx1gBJeVxeMRhSeNZpXJfY+zqAVl+g0mCFRJMgs6oy9+MCMrWZaJJwiWFjuWcIShf+Wk2W9e59OHu21WPdsswZNLKs9wV77mJiaMVbBQ+/1jGZDofFLuOBU/jzG6OQKnkLOZ5EvwolMX2Q19TAX9MWyy/aNarewfZptechdLn8B3TatB/YXB2j4MKw3jTHKX4AO0CbqaSddMokHUbr0PpSXmFG4O4WIu86asCVihfoM6nUmse5gGkbJOyThVesX4UI0d00LBYMr55VuIZl8MkY1uOiTy9v3c+ShuXj5+NdQdL8B+5gmw8WZuREAAAAASUVORK5CYII=\";\r\n\t\t}\r\n\r\n\t\tlet blobBin = atob(imgString);\r\n\t\tlet array = [];\r\n\t\tfor (let i = 0; i < blobBin.length; i++) {\r\n\t\t\tarray.push(blobBin.charCodeAt(i));\r\n\t\t}\r\n\t\tlet file: Blob = new Blob([new Uint8Array(array)], {type: \"image/jpeg\"});\r\n\r\n\t\treturn file;\r\n\t}\r\n}\r\n","/**\r\n * Manifest.ts\r\n * Module for managing the manifest file\r\n */\r\n\r\nimport { IFile } from \"./IFile\";\r\nimport { FeedbackType, SDK_VERSION_PREFIX } from \"./../../Constants\";\r\nimport * as Utils from \"./../../Utils\";\r\nimport Version from \"./../../Version\";\r\nimport * as Window from \"./../../Window/Window\";\r\n\r\nexport class Manifest implements IFile {\r\n\tprivate manifestData: IManifestData;\r\n\r\n\tpublic constructor(manifestType: string, appId: number, submitTime: string, type: ManifestFeedbackType,\r\n\t\tclientFeedbackId: string, applicationGroup: IManifestDataApplication, telemetryGroup: IManifestDataTelemetry,\r\n\t\twebGroup: IManifestDataWeb) {\r\n\t\tthis.manifestData = {\r\n\t\t\tappId: appId,\r\n\t\t\tapplication: applicationGroup,\r\n\t\t\tclientFeedbackId: clientFeedbackId,\r\n\t\t\tmanifestType: manifestType,\r\n\t\t\tsource: \"Client\",\r\n\t\t\tsubmitTime: submitTime,\r\n\t\t\ttelemetry: telemetryGroup,\r\n\t\t\ttype: sanitizeType(type),\r\n\t\t\tweb: webGroup,\r\n\t\t\tsdkVersion: SDK_VERSION_PREFIX\r\n\t\t\t\t+ (Window.get().OfficeBrowserFeedback.sdkVersion !== undefined ?\r\n\t\t\t\t\tWindow.get().OfficeBrowserFeedback.sdkVersion : Version),\r\n\t\t};\r\n\t}\r\n\r\n\tpublic getExtendedManifestData(): string {\r\n\t\treturn this.manifestData.application.extendedManifestData;\r\n\t}\r\n\r\n\tpublic setComment(comment: string) {\r\n\t\tthis.manifestData.comment = comment;\r\n\t}\r\n\r\n\tpublic setEmail(email: string) {\r\n\t\tthis.manifestData.email = email;\r\n\t}\r\n\r\n\tpublic setCategory(category: string) {\r\n\t\tthis.manifestData.telemetry = this.manifestData.telemetry || {};\r\n\t\tthis.manifestData.telemetry.featureArea = category;\r\n\t}\r\n\r\n\tpublic setAppData(appData: string) {\r\n\t\tthis.manifestData.application = this.manifestData.application || {};\r\n\t\tthis.manifestData.application.appData = appData;\r\n\t}\r\n\r\n\tpublic setExtendedManifestData(extendedManifestData: string) {\r\n\t\tthis.manifestData.application = this.manifestData.application || {};\r\n\t\tthis.manifestData.application.extendedManifestData = extendedManifestData;\r\n\t}\r\n\r\n\tpublic setClientFeedbackId(clientFeedbackId: string) {\r\n\t\tthis.manifestData.clientFeedbackId = clientFeedbackId;\r\n\t}\r\n\r\n\tpublic getClientFeedbackId(): string {\r\n\t\treturn this.manifestData.clientFeedbackId;\r\n\t}\r\n\r\n\tpublic setComplianceInformation(authenticationType: string, ageGroup: string, sendFeedbackPolicyValue: string,\r\n\t\tsendSurveyPolicyValue: string, screenshotPolicyValue: string, emailPolicyValue: string) {\r\n\t\tthis.manifestData.complianceChecks = {\r\n\t\t\tauthenticationType: authenticationType,\r\n\t\t\tageGroup: ageGroup,\r\n\t\t\tpolicyAllowFeedback: sendFeedbackPolicyValue,\r\n\t\t\tpolicyAllowSurvey: sendSurveyPolicyValue,\r\n\t\t\tpolicyAllowScreenshot: screenshotPolicyValue,\r\n\t\t\tpolicyAllowContact: emailPolicyValue,\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Set freeform custom values in manifest. Throws if values are already set.\r\n\t * @param values the values as a JS object\r\n\t */\r\n\tpublic setValues(values: object) {\r\n\t\tif (values) {\r\n\t\t\tfor (let field in values) {\r\n\t\t\t\tif (values.hasOwnProperty(field)) {\r\n\t\t\t\t\tif (this.manifestData.hasOwnProperty(field)) {\r\n\t\t\t\t\t\t(<any> this.manifestData)[field] = Utils.overrideValues((<any> values)[field], (<any> this.manifestData)[field]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t(<any> this.manifestData)[field] = (<any> values)[field];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getContent(): Blob {\r\n\t\treturn new Blob([JSON.stringify(this.manifestData)], { type: \"application/json\" });\r\n\t}\r\n}\r\n\r\nfunction sanitizeType(type: ManifestFeedbackType): string {\r\n\tif (type === \"Survey\") {\r\n\t\treturn type;\r\n\t} else {\r\n\t\treturn FeedbackType[type];\r\n\t}\r\n}\r\n\r\nexport type ManifestFeedbackType = FeedbackType | \"Survey\";\r\n\r\n/**\r\n * Interface for the manifest data\r\n */\r\nexport interface IManifestData {\r\n\t// #region \"Required properties\"\r\n\tmanifestType: string;\r\n\tappId: number;\r\n\tsubmitTime: string;\r\n\tsource: string;\r\n\ttype: string;\r\n\tclientFeedbackId: string;\r\n\tsdkVersion: string;\r\n\t// #endregion \"Required properties\"\r\n\tcomment?: string;\r\n\temail?: string;\r\n\trating?: number;\r\n\tsurvey?: IManifestDataSurvey;\r\n\tweb?: IManifestDataWeb;\r\n\tapplication?: IManifestDataApplication;\r\n\ttelemetry?: IManifestDataTelemetry;\r\n\tcomplianceChecks?: IManifestComplianceChecks;\r\n}\r\n\r\n/**\r\n * Interface for survey related properties in manifest\r\n */\r\nexport interface IManifestDataSurvey {\r\n\tsurveyId: string;\r\n}\r\n\r\n/**\r\n * Interface for application related properties in manifest\r\n */\r\nexport interface IManifestDataApplication {\r\n\tappData?: string;\r\n\textendedManifestData?: string;\r\n\tfeedbackTenant?: string;\r\n}\r\n\r\n/**\r\n * Interface for telemetry related properties in manifest\r\n */\r\nexport interface IManifestDataTelemetry {\r\n\taudience?: string;\r\n\taudienceGroup?: string;\r\n\tchannel?: string;\r\n\tdeviceId?: string;\r\n\tdeviceType?: string;\r\n\terrorClassification?: string;\r\n\terrorCode?: string;\r\n\terrorName?: string;\r\n\tfeatureArea?: string;\r\n\tflights?: string;\r\n\tflightSource?: string;\r\n\tfundamentalArea?: string;\r\n\tinstallationType?: string;\r\n\tisLogIncluded?: boolean;\r\n\tisUserSubscriber?: boolean;\r\n\tloggableUserId?: string;\r\n\tofficeArchitecture?: string;\r\n\tofficeBuild?: string;\r\n\tofficeEditingLang?: number;\r\n\tofficeUILang?: number;\r\n\tosBitness?: number;\r\n\tosBuild?: string;\r\n\tosUserLang?: number;\r\n\tplatform?: string;\r\n\tprocessSessionId?: string;\r\n\tringId?: number;\r\n\tsku?: string;\r\n\tsourceContext?: string;\r\n\tsystemProductName?: string;\r\n\tsystemManufacturer?: string;\r\n\ttenantId?: string;\r\n}\r\n\r\n/**\r\n * Interface for web related properties in manifest\r\n */\r\nexport interface IManifestDataWeb {\r\n\tbrowser?: string;\r\n\tbrowserVersion?: string;\r\n\tdataCenter?: string;\r\n\tsourcePageName?: string;\r\n\tsourcePageURI?: string;\r\n}\r\n\r\n/**\r\n * Interface for compliance checks related properties in manifest\r\n */\r\nexport interface IManifestComplianceChecks {\r\n\tauthenticationType?: string;\r\n\tageGroup?: string;\r\n\tpolicyAllowFeedback?: string;\r\n\tpolicyAllowSurvey?: string;\r\n\tpolicyAllowScreenshot?: string;\r\n\tpolicyAllowContact?: string;\r\n}\r\n","/**\r\n * Feedback.ts\r\n *\r\n * Module for payload transport.\r\n */\r\n\r\nimport * as Constants from \"./../Constants\";\r\nimport * as Utils from \"./../Utils\";\r\nimport * as Logging from \"./../Logging/Logging\";\r\nimport * as Petrol from \"./Petrol\";\r\nimport { Screenshot } from \"./Files/Screenshot\";\r\nimport * as Configuration from \"../Configuration/Configuration\";\r\nimport { Manifest, ManifestFeedbackType, IManifestDataApplication, IManifestDataTelemetry, IManifestDataWeb }\r\n\tfrom \"./Files/Manifest\";\r\n\r\nimport { Api } from \"@ms-ofb/officefloodgatecore\";\r\nimport { AgeGroup, AuthenticationType } from \"../Configuration/Configuration\";\r\n\r\nexport { IManifestDataApplication, IManifestDataTelemetry, IManifestDataWeb } from \"./Files/Manifest\"\r\n\r\nexport class Transporter implements Api.ITransporter {\r\n\tprivate manifest: Manifest;\r\n\tprivate screenshot: Screenshot;\r\n\tprivate environment: Constants.Environment;\r\n\tprivate clientFeedbackId: string;\r\n\r\n\tpublic constructor(environment: Constants.Environment, manifestType: string, appId: number, type: ManifestFeedbackType,\r\n\t\tapplicationGroup: IManifestDataApplication, telemetryGroup: IManifestDataTelemetry, webGroup: IManifestDataWeb) {\r\n\r\n\t\tthis.clientFeedbackId = Utils.guid();\r\n\t\tthis.manifest = new Manifest(manifestType, appId, new Date().toISOString(), type,\r\n\t\t\tthis.clientFeedbackId, { ...applicationGroup }, { ...telemetryGroup }, { ...webGroup });\r\n\t\tthis.environment = environment;\r\n\r\n\t\tthis.manifest.setComplianceInformation(AuthenticationType[(Configuration.get().getCommonInitOptions()?.authenticationType) ??\r\n\t\t\tAuthenticationType.Unauthenticated],\r\n\t\t\tAgeGroup[(Configuration.get().getCommonInitOptions()?.ageGroup) ?? AgeGroup.Undefined],\r\n\t\t\tthis.ocpsEnumToString(Configuration.get().getInAppFeedbackInitOptions()?.sendFeedbackPolicyValue),\r\n\t\t\tthis.ocpsBooleanToString(Configuration.get().getFloodgateInitOptions()?.surveyEnabled),\r\n\t\t\tthis.ocpsEnumToString(Configuration.get().getCommonInitOptions()?.screenshotPolicyValue),\r\n\t\t\tthis.ocpsEnumToString(Configuration.get().getCommonInitOptions()?.emailPolicyValue));\r\n\t}\r\n\r\n\tpublic getClientFeedbackId(): string {\r\n\t\treturn this.clientFeedbackId;\r\n\t}\r\n\r\n\tpublic getExtendedManifestData(): string {\r\n\t\treturn this.manifest.getExtendedManifestData();\r\n\t}\r\n\r\n\tpublic setComment(comment: string) {\r\n\t\tthis.manifest.setComment(comment);\r\n\t}\r\n\r\n\tpublic setEmail(email: string) {\r\n\t\tthis.manifest.setEmail(email);\r\n\t}\r\n\r\n\tpublic setCategory(category: string) {\r\n\t\tthis.manifest.setCategory(category);\r\n\t}\r\n\r\n\tpublic setAppData(appData: string) {\r\n\t\tthis.manifest.setAppData(appData);\r\n\t}\r\n\r\n\tpublic setExtendedManifestData(extendedManifestData: string) {\r\n\t\tthis.manifest.setExtendedManifestData(extendedManifestData);\r\n\t}\r\n\r\n\tpublic setScreenshot(screenshot: HTMLCanvasElement) {\r\n\t\tthis.screenshot = new Screenshot(screenshot);\r\n\t}\r\n\r\n\tpublic setClientFeedbackId(clientFeedbackId: string) {\r\n\t\tthis.manifest.setClientFeedbackId(clientFeedbackId);\r\n\t}\r\n\r\n\tpublic getManifest(): Manifest {\r\n\t\treturn this.manifest;\r\n\t}\r\n\r\n\t/**\r\n\t * Set freeform custom values in manifest. Throws if values are already set.\r\n\t * @param values the values as a JS object\r\n\t */\r\n\tpublic setManifestValues(values: object) {\r\n\t\tthis.manifest.setValues(values);\r\n\t}\r\n\r\n\t/**\r\n\t * Submit the payload\r\n\t */\r\n\tpublic submit(): Promise<any> {\r\n\t\tif (!Configuration.get().isFeedbackSurveyEnabledByAADC()) {\r\n\t\t\tLogging.getLogger().logEvent(\r\n\t\t\t\tLogging.EventIds.Shared.Upload.Prevented.VALUE,\r\n\t\t\t\tLogging.LogLevel.Error,\r\n\t\t\t\t{\r\n\t\t\t\t\tData: JSON.stringify({\r\n\t\t\t\t\t\tageGroup: Configuration.get().getCommonInitOptions().ageGroup,\r\n\t\t\t\t\t\tauthenticationType: Configuration.get().getCommonInitOptions().authenticationType,\r\n\t\t\t\t\t}),\r\n\t\t\t\t});\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\r\n\t\tlet manifestContent: Blob = this.manifest.getContent();\r\n\t\tlet screenshotContent: Blob = undefined;\r\n\t\tconst clientFeedbackId: string = this.clientFeedbackId;\r\n\r\n\t\tif (this.screenshot) {\r\n\t\t\tscreenshotContent = this.screenshot.getContent();\r\n\t\t}\r\n\r\n\t\treturn Petrol.send(this.environment === Constants.Environment.Production, manifestContent, screenshotContent)\r\n\t\t\t.catch(\r\n\t\t\t\tfunction onRejected(err: Error) {\r\n\t\t\t\t\tConfiguration.get().setFeedbackSubmitted(false);\r\n\t\t\t\t\tConfiguration.get().getCommonInitOptions().onError(\"Payload submission failed: \" + err.message +\r\n\t\t\t\t\t\t\". ClientFeedbackId: \" + clientFeedbackId);\r\n\t\t\t\t\tLogging.getLogger().logEvent(Logging.EventIds.Shared.Upload.Failed.VALUE,\r\n\t\t\t\t\t\tLogging.LogLevel.Error, { ErrorMessage: err.message, ClientFeedbackId: clientFeedbackId });\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t}\r\n\r\n\tprivate ocpsBooleanToString(policyValue?: boolean) {\r\n\t\tif (policyValue === undefined) {\r\n\t\t\treturn \"Not Configured\";\r\n\t\t}\r\n\r\n\t\tif (policyValue) {\r\n\t\t\treturn \"Enabled\";\r\n\t\t}\r\n\r\n\t\treturn \"Disabled\";\r\n\t}\r\n\r\n\tprivate ocpsEnumToString(policyValue?: Constants.OCPSValues) {\r\n\t\tif (!policyValue) {\r\n\t\t\treturn \"Not Configured\";\r\n\t\t}\r\n\t\tswitch (policyValue) {\r\n\t\t\tcase Constants.OCPSValues.Disabled:\r\n\t\t\t\treturn \"Disabled\";\r\n\t\t\tcase Constants.OCPSValues.Enabled:\r\n\t\t\t\treturn \"Enabled\";\r\n\t\t\tdefault:\r\n\t\t\t\treturn \"Not Configured\";\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * Utils.ts\r\n *\r\n * Module for utility functions\r\n */\r\n\r\nimport { Classes } from \"./UiConstants\";\r\nimport * as Screenshot from \"./../Screenshot\";\r\nimport * as Logging from \"./../Logging/Logging\";\r\n\r\n/**\r\n * Set HTML element visibility\r\n * @param {string} id The Id of the HTML element\r\n * @param {any} vis The visibility to be set (true or false)\r\n * @return {void}\r\n */\r\nexport function setElementVisibility(id: string, vis: boolean): void {\r\n\tlet oldClassName: string = vis ? Classes.Hidden : Classes.Visible;\r\n\tlet newClassName: string = vis ? Classes.Visible : Classes.Hidden;\r\n\r\n\treplaceClassesById(id, oldClassName, newClassName);\r\n}\r\n\r\n/**\r\n * Delete HTML element by Id\r\n * @param {string} id The Id of the HTML element\r\n * @return {void}\r\n */\r\nexport function deleteElementById(id: string): void {\r\n\tlet element: HTMLElement = document.getElementById(id);\r\n\tif (element != null && element.parentNode != null) {\r\n\t\telement.parentNode.removeChild(element);\r\n\t}\r\n}\r\n\r\n/**\r\n * Add a CSS class to an HTML element by Id\r\n * @param {string} id The Id of the HTML element\r\n * @param {string} newClassName The name of CSS class to be added\r\n * @return {void}\r\n */\r\nexport function addClassById(id: string, newClass: string): void {\r\n\tlet element: HTMLElement = document.getElementById(id);\r\n\r\n\tif (!element) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// check is the class already exists, if not add it\r\n\tif (!element.className.match(new RegExp(\"\\\\b\" + newClass + \"\\\\b\"))) {\r\n\t\t// we use className instead of classList to support IE9\r\n\t\telement.className = element.className + \" \" + newClass;\r\n\t}\r\n}\r\n\r\n/**\r\n * Delete a CSS class of an HTML element by Id\r\n * @param {string} id The Id of the HTML element\r\n * @param {string} oldClassName The name of CSS class to be deleted\r\n * @return {void}\r\n */\r\nexport function deleteClassById(id: string, oldClass: string): void {\r\n\tlet element: HTMLElement = document.getElementById(id);\r\n\r\n\tif (!element) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// we use className instead of classList to support IE9\r\n\t// get rid of any occurrences of the class we don\"t want\r\n\telement.className = element.className.split(new RegExp(\"\\\\b\" + oldClass + \"\\\\b\", \"i\")).join(\" \");\r\n\r\n\t// get rid of extra whitespaces\r\n\telement.className = element.className.split(/\\s+/).join(\" \");\r\n}\r\n\r\n/**\r\n * Delete an CSS class and (or) add an CSS class to an HTML element by Id\r\n * @param {string} id The Id of the HTML element\r\n * @param {string} oldClassName The name of CSS class to be deleted\r\n * @param {string} newClassName The name of CSS class to be added\r\n * @return {void}\r\n */\r\nexport function replaceClassesById(id: string, oldClassName?: string, newClassName?: string): void {\r\n\tdeleteClassById(id, oldClassName);\r\n\taddClassById(id, newClassName);\r\n}\r\n\r\n/**\r\n * Set attribute on an HTML element\r\n * @param {string} id The Id of the HTML element\r\n * @param {string} attriName The attribute name\r\n * @param {string} attriValue The attribute value\r\n * @return {void}\r\n */\r\nexport function setAttributeOnHtmlElement(id: string, attriName: string, attriValue: string): void {\r\n\tlet htmlElement: HTMLElement = <HTMLElement> document.getElementById(id);\r\n\tif (htmlElement) {\r\n\t\thtmlElement.setAttribute(attriName, attriValue);\r\n\t}\r\n}\r\n\r\n/**\r\n * Add event listener helper function (wrapper) that deals with IE 8 compatability\r\n * @param object The object to add event listener to\r\n * @param type The event type\r\n * @param listener The listener function\r\n */\r\nexport function addEventListenerHelper(object: any, type: string, listener: (event: Event) => void): void {\r\n\tif (object.addEventListener) {\r\n\t\tobject.addEventListener(type, listener, false);\r\n\t} else if (object.attachEvent) {\r\n\t\tobject.attachEvent(\"on\" + type, listener);\r\n\t}\r\n}\r\n\r\n/**\r\n * Remove event listener helper function (wrapper) that deals with IE 8 compatability\r\n * @param object The object to remove event listener from\r\n * @param type The event type\r\n * @param listener The listener function\r\n */\r\nexport function removeEventListenerHelper(object: any, type: string, listener: (event: Event) => void): void {\r\n\tif (object.removeEventListener) {\r\n\t\tobject.removeEventListener(type, listener, false);\r\n\t} else if (object.detachEvent) {\r\n\t\tobject.detachEvent(\"on\" + type, listener);\r\n\t}\r\n}\r\n\r\n/**\r\n * Register event listener\r\n * @param id The Id of the HTML element\r\n * @param type The event type\r\n * @param listener The listener function\r\n */\r\nexport function registerListener(id: string, type: string, listener: (event: Event) => void): void {\r\n\tlet element: HTMLElement = document.getElementById(id);\r\n\tif (element) {\r\n\t\taddEventListenerHelper(element, type, listener);\r\n\t}\r\n}\r\n\r\n/**\r\n * Register event listener\r\n * @param element The HTML element\r\n * @param type The event type\r\n * @param listener The listener function\r\n */\r\nexport function registerListenerToElement(element: HTMLElement, type: string, listener: (event: Event) => void): void {\r\n\tif (element) {\r\n\t\taddEventListenerHelper(element, type, listener);\r\n\t}\r\n}\r\n\r\n/**\r\n * Un-register event listener\r\n * @param id The Id of the HTML element\r\n * @param type The event type\r\n * @param listener The listener function\r\n */\r\nexport function unregisterListener(id: string, type: string, listener: (event: Event) => void): void {\r\n\tlet element: HTMLElement = document.getElementById(id);\r\n\tif (element) {\r\n\t\tremoveEventListenerHelper(element, type, listener);\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns the version of Internet Explorer or -1 for non-IE browser\r\n * @return {number} The IE version\r\n */\r\nexport function getInternetExplorerVersion(): number {\r\n\tlet rv: number = -1;\r\n\tlet ua: string = window.navigator.userAgent;\r\n\r\n\t// since IE 11, 'MSIE' is not a keyword in its user agent string anymore\r\n\t// determine whether the browser is IE or not, and the version of IE based on Trident keyword and its version\r\n\tif (ua.indexOf(\"Trident\") > -1) {\r\n\t\tlet re: RegExp = new RegExp(\"Trident/([0-9]{1,}[\\.0-9]{0,})\");\r\n\t\tif (re.exec(ua) != null) {\r\n\t\t\trv = parseFloat(RegExp.$1);\r\n\t\t\trv += 4; // trident version + 4 is the IE version\r\n\t\t}\r\n\t}\r\n\treturn rv;\r\n}\r\n\r\n/**\r\n * Check if the current text direction is right to left\r\n */\r\nexport function isRightToLeft(): boolean {\r\n\treturn getComputedStyle(document.documentElement).direction === \"rtl\";\r\n}\r\n\r\n/**\r\n * Screenshot preview is control by screenshot check box. Populate preview if checkbox is checked \r\n * @param screenshotCheckboxId The Id of screenshot checkbox \r\n * @param screenshotPreviewId The Id of preview \r\n */\r\nexport function ScreenshotPreviewByCheckbox(screenshotCheckboxId: string, screenshotPreviewId: string): void {\r\n\tlet screenshotCheckBox = <HTMLInputElement> document.getElementById(screenshotCheckboxId);\r\n\tlet screenshotCheckBoxSelected: boolean = screenshotCheckBox && screenshotCheckBox.checked;\r\n\tlet preview = <HTMLImageElement> document.getElementById(screenshotPreviewId);\r\n\r\n\tif (screenshotCheckBoxSelected) {\r\n\t\tsetElementVisibility(screenshotPreviewId, true);\r\n\t\tlet startTime: number = performance.now();\r\n\t\tScreenshot.createScreenshot(document.body).then(\r\n\t\t\t(canvas: HTMLCanvasElement) => {\r\n\t\t\t\tlet endTime: number = performance.now();\r\n\t\t\t\tLogging.getLogger().logEvent(Logging.EventIds.Shared.Screenshot.Render.Success.VALUE,\r\n\t\t\t\t\tLogging.LogLevel.Critical,\r\n\t\t\t\t\t{ TimeMilliseconds: endTime - startTime });\r\n\r\n\t\t\t\tpreview.src = canvas.toDataURL();\r\n\t\t\t}\r\n\t\t).catch((error: any) => {\r\n\t\t\tlet endTime: number = performance.now();\r\n\t\t\tLogging.getLogger().logEvent(Logging.EventIds.Shared.Screenshot.Render.Failed.VALUE,\r\n\t\t\t\tLogging.LogLevel.Error,\r\n\t\t\t\t{ ErrorMessage: error, TimeMilliseconds: endTime - startTime });\r\n\t\t});\r\n\t} else {\r\n\t\tsetElementVisibility(screenshotPreviewId, false);\r\n\t}\r\n}\r\n","/**\r\n * Spinner.ts\r\n *\r\n * A module for a spinner.\r\n */\r\n\r\nimport { Classes } from \"./UiConstants\";\r\nimport * as Utils from \"./Utils\";\r\n\r\ninterface ICircleObject {\r\n\telement: HTMLDivElement;\r\n\tj: number;\r\n}\r\n\r\nconst animationSpeed = 90;\r\nconst numCircles = 8;\r\nconst offsetSize = 0.2;\r\nconst parentSize = 34;\r\nconst fadeIncrement = 1 / numCircles;\r\n\r\nexport class Spinner {\r\n\tprivate circleObjects: ICircleObject[] = [];\r\n\tprivate interval: ReturnType<typeof setInterval>;\r\n\tprivate spinnerId: string;\r\n\tprivate spinner: HTMLElement;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t * @param id id of the element to attach the spinner to\r\n\t */\r\n\tconstructor(id: string) {\r\n\t\tthis.spinnerId = id;\r\n\t\tthis.spinner = document.getElementById(this.spinnerId);\r\n\t\tthis.createCirclesAndArrange();\r\n\t\tthis.initializeOpacities();\r\n\t\tthis.start();\r\n\t\tUtils.setElementVisibility(id, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys the spinner\r\n\t */\r\n\tpublic destroy() {\r\n\t\tUtils.setElementVisibility(this.spinnerId, false);\r\n\t\tthis.stop();\r\n\t}\r\n\r\n\t/**\r\n\t * Starts the animation\r\n\t */\r\n\tprivate start() {\r\n\t\tthis.stop();\r\n\t\tthis.interval = setInterval(() => {\r\n\t\t\tlet i = this.circleObjects.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\tfade(this.circleObjects[i]);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\tanimationSpeed);\r\n\t}\r\n\r\n\t/**\r\n\t * Stops the animation\r\n\t */\r\n\tprivate stop() {\r\n\t\tclearInterval(this.interval);\r\n\t}\r\n\r\n\tprivate createCirclesAndArrange() {\r\n\t\tlet angle = 0;\r\n\t\tlet offset = parentSize * offsetSize;\r\n\t\tlet step = (2 * Math.PI) / numCircles;\r\n\t\tlet i = numCircles;\r\n\t\tlet circleObject: ICircleObject;\r\n\t\tlet radius = (parentSize - offset) * 0.5;\r\n\r\n\t\twhile (i--) {\r\n\t\t\tlet circle: HTMLDivElement = createCircle();\r\n\t\t\tlet x = Math.round(parentSize * 0.5 + radius * Math.cos(angle) - circle.clientWidth * 0.5) - offset * 0.5;\r\n\t\t\tlet y = Math.round(parentSize * 0.5 + radius * Math.sin(angle) - circle.clientHeight * 0.5) - offset * 0.5;\r\n\t\t\tthis.spinner.appendChild(circle);\r\n\t\t\tcircle.style.left = x + \"px\";\r\n\t\t\tcircle.style.top = y + \"px\";\r\n\t\t\tangle += step;\r\n\t\t\tcircleObject = { element: circle, j: i };\r\n\t\t\tthis.circleObjects.push(circleObject);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate initializeOpacities() {\r\n\t\tlet i = 0;\r\n\t\tlet j = 1;\r\n\t\tlet opacity: number;\r\n\r\n\t\tfor (i; i < numCircles; i++) {\r\n\t\t\tlet circleObject = this.circleObjects[i];\r\n\t\t\topacity = (fadeIncrement * j++);\r\n\t\t\tsetOpacity(circleObject.element, opacity);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction fade(circleObject: any) {\r\n\tlet opacity = getOpacity(circleObject.element) - fadeIncrement;\r\n\r\n\tif (opacity <= 0) {\r\n\t\topacity = 1;\r\n\t}\r\n\r\n\tsetOpacity(circleObject.element, opacity);\r\n}\r\n\r\nfunction getOpacity(element: HTMLDivElement) {\r\n\treturn parseFloat(window.getComputedStyle(element).getPropertyValue(\"opacity\"));\r\n}\r\n\r\nfunction setOpacity(element: HTMLDivElement, opacity: number) {\r\n\telement.style.opacity = opacity.toString();\r\n}\r\n\r\nfunction createCircle(): HTMLDivElement {\r\n\tlet circle: HTMLDivElement = document.createElement(\"div\");\r\n\tcircle.classList.add(Classes.SpinnerCircle);\r\n\tcircle.style.width = circle.style.height = parentSize * offsetSize + \"px\";\r\n\treturn circle;\r\n}\r\n","/**\r\n * TabFocus.ts\r\n *\r\n * Module to handle tab and shift tab focus\r\n */\r\n\r\nimport { Classes, IDs } from \"./../UiConstants\";\r\n\r\n/**\r\n * Keeps tabs and shift tabs focus on visible elements of the feedback dialog\r\n * This prevents tabs and shift tabs cycle focus to elements of the background main page.\r\n * @param focusedElement The in-focus element object\r\n */\r\nexport function cycleTabFocus(focusedElement: Element): void {\r\n\tlet elements = getTabbableElements();\r\n\r\n\t// when a tab lands on the last dummy tabbable element, set focus to the first\r\n\t// visible element which is the one after the first dummy tabbable element\r\n\tif (focusedElement.id === IDs.LastTabbable) {\r\n\t\tfor (let i = 0; i < elements.length; i++) {\r\n\t\t\tlet element = (<HTMLElement> elements[i]);\r\n\r\n\t\t\tif (element.id === IDs.FirstTabbable || !checkVisible(element)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\telement.focus();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// when a shift tab lands on the first dummy tabbable element, set focus to the last\r\n\t\t// visible element which is the one before the last dummy tabbable element\r\n\t} else if (focusedElement.id === IDs.FirstTabbable) {\r\n\t\tfor (let i = elements.length - 1; i >= 0; i--) {\r\n\t\t\tlet element = (<HTMLElement> elements[i]);\r\n\r\n\t\t\tif (element.id === IDs.LastTabbable || !checkVisible(element)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\telement.focus();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns a list of tabbable elements.\r\n * @returns {NodeListOf<Element>} list of tabbable elements\r\n */\r\nfunction getTabbableElements(): NodeListOf<Element> {\r\n\tconst tabbableSelector = \"a[href], area[href], input:not([disabled]):not([tabindex=\\'-1\\']), \" +\r\n\t\t\"button:not([disabled]):not([tabindex=\\'-1\\']), select:not([disabled]):not([tabindex=\\'-1\\']), \" +\r\n\t\t\"textarea:not([disabled]):not([tabindex =\\'-1\\']), \" +\r\n\t\t\"object, *[tabindex]:not([tabindex=\\'-1\\']), *[contenteditable=true]\";\r\n\r\n\treturn document.getElementById(IDs.MainContainer).querySelectorAll(tabbableSelector);\r\n}\r\n\r\n/**\r\n * Returns visibility of an element by inspecting the element's parent class name for visible/hidden value.\r\n * Walk up the parent chain if needed.\r\n * @param element The element object\r\n * @returns {Boolean} whether the element is visible\r\n */\r\nfunction checkVisible(element: HTMLElement): boolean {\r\n\tif (!element.parentElement) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// don't bother if parent element id is just whitespace or empty\r\n\tif (/\\S/.test(element.parentElement.id)) {\r\n\t\tif (element.parentElement.className.indexOf(Classes.Visible) >= 0) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (element.parentElement.className.indexOf(Classes.Hidden) >= 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn checkVisible(element.parentElement);\r\n}\r\n","/**\r\n * Events.ts\r\n *\r\n * A module for all Event handling.\r\n */\r\n\r\nimport { Transporter } from \"./../../Transport/Transport\";\r\nimport * as Configuration from \"./../../Configuration/Configuration\";\r\nimport { IFormTemplate } from \"./FormTemplates/IFormTemplate\";\r\nimport { FeedbackType, PanelType } from \"./../../Constants\";\r\nimport { AttributeName, AttributeValue, Classes, IDs, Keys } from \"./../UiConstants\";\r\nimport * as Logging from \"./../../Logging/Logging\";\r\nimport { IOnDismissDelegate } from \"./../../IOnDismissDelegate\";\r\nimport * as Screenshot from \"./../../Screenshot\";\r\nimport { Spinner } from \"./../SpinnerControl\";\r\nimport * as UiUtils from \"./../Utils\";\r\nimport * as TabFocus from \"./TabFocus\";\r\nimport { IPanelTemplate } from \"./PanelTemplates/IPanelTemplate\";\r\n\r\n/**\r\n * Whether to use narrow layout\r\n */\r\nlet useNarrowLayout: boolean = false;\r\n\r\n/**\r\n * Whether transition enabled or not\r\n */\r\nlet transitionEnabled: boolean = true;\r\n\r\n/**\r\n * Callback for when the feedback dialog is dismissed\r\n */\r\nlet onDismiss: IOnDismissDelegate;\r\n\r\n/**\r\n * The Selected feedback type, undefined if none selected\r\n */\r\nlet selectedFeedbackType: FeedbackType = undefined;\r\n\r\n/**\r\n * The Selected panel type, undefined if none selected\r\n */\r\nlet selectedPanelType: PanelType = undefined;\r\n\r\n/**\r\n * feedbackType -> IFormTemplate mapping for multi BellyBand\r\n */\r\nlet formTemplates: { [key: number]: IFormTemplate };\r\n\r\n/**\r\n * panelType -> IPanelTemplate mapping for multi BellyBand\r\n */\r\nlet panelTemplates: { [key: number]: IPanelTemplate };\r\n\r\nconst anchors: string[] = [IDs.OverallSmileAnchor, IDs.OverallFrownAnchor, IDs.OverallIdeaAnchor, IDs.OverallBugAnchor];\r\n\r\nfunction setAriaSelectedAttributes(anchorID: string): void {\r\n\tlet i: number;\r\n\tfor (i = 0; i < anchors.length; i++) {\r\n\t\tif (anchors[i] === anchorID) {\r\n\t\t\tUiUtils.setAttributeOnHtmlElement(anchors[i], AttributeName.AriaSelected, AttributeValue.True);\r\n\t\t} else {\r\n\t\t\tUiUtils.setAttributeOnHtmlElement(anchors[i], AttributeName.AriaSelected, AttributeValue.False);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Dismiss all, including networking, UI, and events\r\n * @param submitted Was the control submitted (true), or cancelled (false)?\r\n */\r\nfunction dismissAll(): void {\r\n\tunregister();\r\n\tonDismiss(Configuration.get().getFeedbackSubmitted());\r\n\tConfiguration.get().setFeedbackSubmitted(false);\r\n}\r\n\r\n/**\r\n * List of listeners and the ids they are attached to. This ensures all events are correctly unregistered.\r\n */\r\nlet listenersList: { id: string, event: string, listener: (event: Event) => void }[] = [];\r\n\r\nfunction addListener(id: string, event: string, listener: (event: Event) => void): void {\r\n\tUiUtils.registerListener(id, event, listener);\r\n\tlistenersList.push({ event: event, id: id, listener: listener });\r\n}\r\n\r\nfunction removeListeners(): void {\r\n\tfor (let listener of listenersList) {\r\n\t\tUiUtils.unregisterListener(listener.id, listener.event, listener.listener);\r\n\t}\r\n\tlistenersList = [];\r\n}\r\n\r\n/**\r\n * Register events for single belly band\r\n */\r\nexport function registerSingle(feedbackType: FeedbackType,\r\n\tPANELTEMPLATES: { [key: number]: IPanelTemplate },\r\n\tON_DISMISS: IOnDismissDelegate = function (submitted: boolean) { return; }) {\r\n\tselectedFeedbackType = feedbackType;\r\n\tpanelTemplates = PANELTEMPLATES;\r\n\r\n\t// SingleFormTemplate events\r\n\taddListener(IDs.SingleFormSubmitButton, \"click\", submitButtonHandlerFactory(IDs.SingleFormSubmitButton,\r\n\t\tIDs.SingleFormSubmitButtonSpinner, IDs.SingleFormComment, IDs.SingleFormEmailInput,\r\n\t\tIDs.SingleFormScreenshotCheckbox, IDs.SingleFormScreenshotPreview, IDs.SingleFormCategoriesDropdown));\r\n\r\n\t// Screenshot checkbox click events\r\n\taddListener(IDs.SingleFormScreenshotCheckbox, \"click\", ScreenshotCheckboxClickHandler\r\n\t\t(IDs.SingleFormScreenshotCheckbox, IDs.SingleFormScreenshotPreview));\r\n\r\n\t// Close button click event.\r\n\taddListener(IDs.CloseButton, \"click\", () => { dismissAll(); });\r\n\r\n\t// ThanksPanel events\r\n\taddListener(IDs.ThanksPanelCloseButton, \"click\", (event: Event) => CloseButton(event));\r\n\r\n\t// cancel button events\r\n\taddListener(IDs.SingleFormCancelButton, \"click\", CancelButtonHandler);\r\n\tregisterCommon(ON_DISMISS);\r\n}\r\n\r\n/**\r\n * Register events for multi belly band\r\n */\r\nexport function registerMulti(FORMTEMPLATES: { [key: number]: IFormTemplate },\r\n\tPANELTEMPLATES: { [key: number]: IPanelTemplate },\r\n\tUSE_NARROW_LAYOUT: boolean,\r\n\tTRANSITIONENABLED: boolean,\r\n\tON_DISMISS: IOnDismissDelegate = function (submitted: boolean) { return; }) {\r\n\tuseNarrowLayout = USE_NARROW_LAYOUT;\r\n\tformTemplates = FORMTEMPLATES;\r\n\tpanelTemplates = PANELTEMPLATES;\r\n\ttransitionEnabled = TRANSITIONENABLED;\r\n\r\n\taddListener(IDs.OverallSmileAnchor, \"click\", overallSmileHandler);\r\n\taddListener(IDs.OverallFrownAnchor, \"click\", overallFrownHandler);\r\n\taddListener(IDs.OverallIdeaAnchor, \"click\", overallIdeaHandler);\r\n\taddListener(IDs.OverallBugAnchor, \"click\", overallBugHandler);\r\n\taddListener(IDs.CloseButton, \"click\", () => { dismissAll(); });\r\n\r\n\t// BasicFormTemplate events\r\n\taddListener(IDs.BasicFormSubmitButton, \"click\", submitButtonHandlerFactory(IDs.BasicFormSubmitButton,\r\n\t\tIDs.BasicFormSubmitButtonSpinner, IDs.BasicFormComment, IDs.BasicFormEmailInput,\r\n\t\tIDs.BasicFormScreenshotCheckbox, IDs.BasicFormScreenshotPreview, IDs.BasicFormCategoriesDropdown));\r\n\r\n\t// Screenshot checkbox click events\r\n\taddListener(IDs.BasicFormScreenshotCheckbox, \"click\", ScreenshotCheckboxClickHandler(IDs.BasicFormScreenshotCheckbox,\r\n\t\tIDs.BasicFormScreenshotPreview));\r\n\r\n\taddListener(IDs.OverallFeedbackPortalIdeaAnchor, \"click\", overallFeedbackPortalIdeaHandler);\r\n\r\n\t// ThanksPanel events\r\n\taddListener(IDs.ThanksPanelCloseButton, \"click\", (event: Event) => CloseButton(event));\r\n\r\n\t// cancel button events\r\n\taddListener(IDs.BasicFormCancelButton, \"click\", CancelButtonHandler);\r\n\r\n\tregisterCommon(ON_DISMISS);\r\n\r\n\tif (!transitionEnabled) {\r\n\t\tUiUtils.addClassById(IDs.MainContentHolder, Classes.MarginLeft180px);\r\n\t\tUiUtils.addClassById(IDs.ColumnSeparatorDiv, Classes.ShowRightBorder);\r\n\t}\r\n}\r\n\r\nfunction registerCommon(ON_DISMISS: IOnDismissDelegate): void {\r\n\tonDismiss = ON_DISMISS;\r\n\r\n\tUiUtils.addEventListenerHelper(window, \"keyup\", keyEventHandler);\r\n\r\n\taddListener(IDs.OverlayBackground, \"click\", overlayBackgroundHandler);\r\n\taddListener(IDs.MainContainer, \"click\", mainContainerHandler);\r\n\taddListener(IDs.MainContainer, \"keyup\", tabKeyEventHandler);\r\n\taddListener(IDs.PrivacyStatementLink, \"click\", privacyStatementLinkHandler);\r\n\taddListener(IDs.EmailCheckBox, \"click\", emailCheckBoxHandler);\r\n\taddListener(IDs.BasicFormComment, \"keyup\", basicFormInputHandler);\r\n\taddListener(IDs.SingleFormComment, \"keyup\", singleFormInputHandler);\r\n\temailCheckBoxHandler(null); // call the checkbox handler to process the initial state\r\n}\r\n\r\n/**\r\n * Listener un-registration\r\n */\r\nfunction unregister(): void {\r\n\tUiUtils.removeEventListenerHelper(window, \"keyup\", keyEventHandler);\r\n\tremoveListeners();\r\n}\r\n\r\n/**\r\n * Tab key event handler\r\n * @param event The Event object\r\n */\r\nfunction tabKeyEventHandler(event: Event): void {\r\n\tlet keyCode = (<KeyboardEvent> event).keyCode || (<KeyboardEvent> event ).which;\r\n\r\n\tif (keyCode === Keys.Tab) {\r\n\t\tif ((document.activeElement.id === IDs.FirstTabbable && (<KeyboardEvent> event).shiftKey) ||\r\n\t\t\t(document.activeElement.id === IDs.LastTabbable && !(<KeyboardEvent> event).shiftKey)) {\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tTabFocus.cycleTabFocus(document.activeElement);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Key event handler\r\n * @param event The Event object\r\n */\r\nfunction keyEventHandler(event: Event): void {\r\n\t// dismiss feedback upon pressing the escape key\r\n\tif ((<KeyboardEvent> event).keyCode === Keys.Esc) {\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tdismissAll();\r\n\t}\r\n}\r\n\r\n/**\r\n * Overlay background event handler. Dismiss feedback upon clicking on the background area\r\n * @param event The Event object\r\n */\r\nfunction overlayBackgroundHandler(event: Event): void {\r\n\tevent.preventDefault();\r\n\tevent.stopPropagation();\r\n\tdismissAll();\r\n}\r\n\r\n/**\r\n * Main container event handler. When clicking on main container area, do not propagate the event to lower level.\r\n * @param event The Event object\r\n */\r\nfunction mainContainerHandler(event: Event): void {\r\n\tevent.stopPropagation();\r\n}\r\n\r\n/**\r\n * Privacy statement link handler. When clicking on the privacy statement link,\r\n * do not propagate the event to lower level.\r\n * @param event The Event object\r\n */\r\nfunction privacyStatementLinkHandler(event: Event): void {\r\n\tevent.stopPropagation();\r\n}\r\n\r\n/**\r\n * Overall button click handler\r\n * @param event The Event object\r\n * @param achorId The id of the anchor html element which was selected\r\n */\r\nfunction overallHandler(event: Event, anchorId: string): void {\r\n\tevent.preventDefault();\r\n\tevent.stopPropagation();\r\n\r\n\tUiUtils.replaceClassesById(IDs.OverallSmileAnchor, Classes.OverallAnchorActive);\r\n\tUiUtils.replaceClassesById(IDs.OverallFrownAnchor, Classes.OverallAnchorActive);\r\n\tUiUtils.replaceClassesById(IDs.OverallIdeaAnchor, Classes.OverallAnchorActive);\r\n\tUiUtils.replaceClassesById(IDs.OverallBugAnchor, Classes.OverallAnchorActive);\r\n\r\n\tif (anchorId) {\r\n\t\tUiUtils.addClassById(anchorId, Classes.OverallAnchorActive);\r\n\t}\r\n\r\n\tLogging.getLogger().logEvent(\r\n\t\tLogging.EventIds.InApp.UI.Form.Shown.VALUE,\r\n\t\tLogging.LogLevel.Critical,\r\n\t\t{ FeedbackType: selectedFeedbackType, PanelType: selectedPanelType });\r\n\r\n\tif (typeof (selectedFeedbackType) !== \"undefined\") {\r\n\t\tUiUtils.setElementVisibility(IDs.LeftFormContainer, true);\r\n\t\tUiUtils.setElementVisibility(IDs.MiddleFormContainer, true);\r\n\t\tUiUtils.setElementVisibility(IDs.LeftPanelContainer, false);\r\n\t\tlet formTemplate: IFormTemplate = formTemplates[selectedFeedbackType];\r\n\t\tmainContentHolderSlideLeft(formTemplate.containerId);\r\n\r\n\t\tif (transitionEnabled) {\r\n\t\t\tmainContentHolderSlideLeft(formTemplate.containerId);\r\n\t\t}\r\n\t\tformTemplate.onSelect(selectedFeedbackType);\r\n\t}\r\n\r\n\tif (typeof (selectedPanelType) !== \"undefined\") {\r\n\t\tUiUtils.setElementVisibility(IDs.LeftFormContainer, false);\r\n\t\tUiUtils.setElementVisibility(IDs.MiddleFormContainer, false);\r\n\t\tUiUtils.setElementVisibility(IDs.LeftPanelContainer, true);\r\n\t\tfor (let panelType in panelTemplates) {\r\n\t\t\tif (panelTemplates.hasOwnProperty(panelType)) {\r\n\t\t\t\tUiUtils.setElementVisibility(panelTemplates[panelType].containerId, true);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet panelTemplate: IPanelTemplate = panelTemplates[selectedPanelType];\r\n\t\tpanelTemplate.onSelect(selectedPanelType);\r\n\t}\r\n}\r\n\r\n/**\r\n * Smile button event handler\r\n * @param event The Event object\r\n */\r\nfunction overallSmileHandler(event: Event): void {\r\n\tselectedFeedbackType = FeedbackType.Smile;\r\n\tselectedPanelType = undefined;\r\n\tsetAriaSelectedAttributes(IDs.OverallSmileAnchor);\r\n\tUiUtils.setAttributeOnHtmlElement(IDs.MiddleFormContainer, AttributeName.AriaExpanded, AttributeValue.True);\r\n\tUiUtils.setAttributeOnHtmlElement(IDs.MiddleFormContainer, AttributeName.AriaLabelledBy, IDs.OverallSmileAnchor);\r\n\toverallHandler(event, IDs.OverallSmileAnchor);\r\n}\r\n\r\n/**\r\n * Frown button event handler\r\n * @param event The Event object\r\n */\r\nfunction overallFrownHandler(event: Event): void {\r\n\tselectedFeedbackType = FeedbackType.Frown;\r\n\tselectedPanelType = undefined;\r\n\tsetAriaSelectedAttributes(IDs.OverallFrownAnchor);\r\n\tUiUtils.setAttributeOnHtmlElement(IDs.MiddleFormContainer, AttributeName.AriaExpanded, AttributeValue.True);\r\n\tUiUtils.setAttributeOnHtmlElement(IDs.MiddleFormContainer, AttributeName.AriaLabelledBy, IDs.OverallFrownAnchor);\r\n\toverallHandler(event, IDs.OverallFrownAnchor);\r\n}\r\n\r\n/**\r\n * Idea button event handler\r\n * @param event The Event object\r\n */\r\nfunction overallIdeaHandler(event: Event): void {\r\n\tselectedFeedbackType = FeedbackType.Idea;\r\n\tselectedPanelType = undefined;\r\n\tsetAriaSelectedAttributes(IDs.OverallIdeaAnchor);\r\n\tUiUtils.setAttributeOnHtmlElement(IDs.MiddleFormContainer, AttributeName.AriaExpanded, AttributeValue.True);\r\n\tUiUtils.setAttributeOnHtmlElement(IDs.MiddleFormContainer, AttributeName.AriaLabelledBy, IDs.OverallIdeaAnchor);\r\n\toverallHandler(event, IDs.OverallIdeaAnchor);\r\n}\r\n\r\n/**\r\n * Bug button event handler\r\n * @param event The Event object\r\n */\r\nfunction overallBugHandler(event: Event): void {\r\n\tselectedFeedbackType = FeedbackType.Bug;\r\n\tselectedPanelType = undefined;\r\n\tsetAriaSelectedAttributes(IDs.OverallBugAnchor);\r\n\tUiUtils.setAttributeOnHtmlElement(IDs.MiddleFormContainer, AttributeName.AriaExpanded, AttributeValue.True);\r\n\tUiUtils.setAttributeOnHtmlElement(IDs.MiddleFormContainer, AttributeName.AriaLabelledBy, IDs.OverallBugAnchor);\r\n\toverallHandler(event, IDs.OverallBugAnchor);\r\n}\r\n\r\n/**\r\n * Thanks pane event handler\r\n * @param event The Event object\r\n */\r\nfunction overallThanksHandler(event: Event): void {\r\n\tselectedFeedbackType = undefined;\r\n\tselectedPanelType = PanelType.Thanks;\r\n\r\n\tSetVisibilityExceptFor(IDs.ThanksPanelContainer, false);\r\n\r\n\toverallHandler(event, undefined);\r\n}\r\n\r\n/**\r\n * Sets visibility for all content panes except for specified.\r\n * @param except Pane not to set visibility for.\r\n * @param visible Visibility to be set\r\n */\r\nfunction SetVisibilityExceptFor(except: string, visible: boolean) {\r\n\tUiUtils.setElementVisibility(IDs.LeftFormContainer, visible);\r\n\tconst feedbackPanes = document.getElementById(IDs.MiddleFormContainer).children;\r\n\tfor (let currentFeedbackPane = 0; currentFeedbackPane < feedbackPanes.length; currentFeedbackPane++) {\r\n\t\tif (feedbackPanes[currentFeedbackPane].id !== except) {\r\n\t\t\tUiUtils.setElementVisibility(feedbackPanes[currentFeedbackPane].id, visible);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Main content holder slide left animation\r\n * @param {string} containerId The id of the container to be made visible\r\n * @return {void}\r\n */\r\nfunction mainContentHolderSlideLeft(containerId: string): void {\r\n\tfor (let feedbackType in formTemplates) {\r\n\t\tif (formTemplates.hasOwnProperty(feedbackType)) {\r\n\t\t\tUiUtils.setElementVisibility(formTemplates[feedbackType].containerId, false);\r\n\t\t}\r\n\t}\r\n\r\n\tif (useNarrowLayout) {\r\n\t\tUiUtils.setElementVisibility(IDs.LeftFormContainer, false);\r\n\t\tUiUtils.setElementVisibility(IDs.MiddleFormContainer, true);\r\n\t\tUiUtils.setElementVisibility(containerId, true);\r\n\t} else {\r\n\t\tUiUtils.addClassById(IDs.ColumnSeparatorDiv, Classes.ShowRightBorder);\r\n\t\tUiUtils.setElementVisibility(IDs.MiddleFormContainer, true);\r\n\t\tUiUtils.setElementVisibility(containerId, true);\r\n\t\tUiUtils.addClassById(IDs.LeftFormContainer, Classes.SlideLeft);\r\n\t\tUiUtils.addClassById(IDs.MiddleFormContainer, Classes.SlideLeft);\r\n\t}\r\n}\r\n\r\n/**\r\n * Submit button event handler factory\r\n * @param event The Event object\r\n */\r\nfunction submitButtonHandlerFactory(submitButtonId: string, spinnerId: string, commentInputId: string,\r\n\temailInputId: string, screenshotCheckboxId: string, screenshotPreviewId: string,\r\n\tcategoriesDropdownId: string): (event: Event) => void {\r\n\treturn function (event: Event) {\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tUiUtils.setElementVisibility(submitButtonId, false);\r\n\t\tlet spinner = new Spinner(spinnerId);\r\n\r\n\t\tlet transporter: Transporter = new Transporter(\r\n\t\t\tConfiguration.get().getCommonInitOptions().environment,\r\n\t\t\t\"Sas\",\r\n\t\t\tConfiguration.get().getCommonInitOptions().appId,\r\n\t\t\tselectedFeedbackType,\r\n\t\t\tConfiguration.get().getCommonInitOptions().applicationGroup,\r\n\t\t\tConfiguration.get().getCommonInitOptions().telemetryGroup,\r\n\t\t\tConfiguration.get().getCommonInitOptions().webGroup,\r\n\t\t);\r\n\r\n\t\tlet commentElement: HTMLTextAreaElement = <HTMLTextAreaElement> document.getElementById(commentInputId);\r\n\t\tlet commentEntered: boolean = (commentElement && !!commentElement.value);\r\n\t\tif (commentEntered) {\r\n\t\t\ttransporter.setComment(commentElement.value);\r\n\t\t}\r\n\r\n\t\tlet emailCheckBox: HTMLInputElement = <HTMLInputElement> document.getElementById(IDs.EmailCheckBox);\r\n\t\tlet emailElement: HTMLTextAreaElement = <HTMLTextAreaElement> document.getElementById(emailInputId);\r\n\t\tlet isEmailIncluded: boolean = (emailElement && !!emailElement.value);\r\n\t\tif (emailCheckBox && emailCheckBox.checked && isEmailIncluded) {\r\n\t\t\ttransporter.setEmail(emailElement.value);\r\n\t\t}\r\n\r\n\t\tlet screenshotCheckBox = <HTMLInputElement> document.getElementById(screenshotCheckboxId);\r\n\t\tlet screenshotCheckBoxSelected: boolean = screenshotCheckBox && screenshotCheckBox.checked;\r\n\r\n\t\tlet categoryElement: HTMLSelectElement = <HTMLSelectElement> document.getElementById(categoriesDropdownId);\r\n\t\tlet isCategorySelected: boolean = (categoryElement && categoryElement.selectedIndex > 0);\r\n\t\tif (isCategorySelected) {\r\n\t\t\ttransporter.setCategory(categoryElement.value);\r\n\t\t}\r\n\r\n\t\tLogging.getLogger().logEvent(Logging.EventIds.InApp.UI.Form.Submit.VALUE,\r\n\t\t\tLogging.LogLevel.Critical,\r\n\t\t\t{\r\n\t\t\t\tFeedbackType: selectedFeedbackType,\r\n\t\t\t\tIsEmailIncluded: isEmailIncluded,\r\n\t\t\t\tIsScreenshotIncluded: screenshotCheckBoxSelected,\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tif (screenshotCheckBoxSelected) {\r\n\t\t\tlet startTime: number = performance.now();\r\n\t\t\tScreenshot.createScreenshot(document.body).then(\r\n\t\t\t\t(canvas: HTMLCanvasElement) => {\r\n\t\t\t\t\tlet endTime: number = performance.now();\r\n\t\t\t\t\tLogging.getLogger().logEvent(Logging.EventIds.Shared.Screenshot.Render.Success.VALUE,\r\n\t\t\t\t\t\tLogging.LogLevel.Critical,\r\n\t\t\t\t\t\t{ TimeMilliseconds: endTime - startTime });\r\n\t\t\t\t\ttransporter.setScreenshot(canvas);\r\n\t\t\t\t\ttransporter.submit();\r\n\t\t\t\t}\r\n\t\t\t).catch((error: any) => {\r\n\t\t\t\tlet endTime: number = performance.now();\r\n\t\t\t\tLogging.getLogger().logEvent(Logging.EventIds.Shared.Screenshot.Render.Failed.VALUE,\r\n\t\t\t\t\tLogging.LogLevel.Error,\r\n\t\t\t\t\t{ ErrorMessage: error, TimeMilliseconds: endTime - startTime });\r\n\t\t\t\ttransporter.submit();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\ttransporter.submit();\r\n\t\t}\r\n\r\n\t\tspinner.destroy();\r\n\t\tConfiguration.get().setFeedbackSubmitted(true);\r\n\t\tif (!Configuration.get().getInAppFeedbackInitOptions().isShowThanks) {\r\n\t\t\tdismissAll();\r\n\t\t} else {\r\n\t\t\toverallThanksHandler(event);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Close button event\r\n */\r\nfunction CloseButton(event: Event) {\r\n\tSetVisibilityExceptFor(IDs.ThanksPanelContainer, true);\r\n\tdismissAll();\r\n}\r\n\r\nfunction overallFeedbackPortalIdeaHandler(event: Event): void {\r\n\tevent.preventDefault();\r\n\tevent.stopPropagation();\r\n\r\n\twindow.open(Configuration.get().getInAppFeedbackInitOptions().feedbackForumUrl);\r\n\tdismissAll();\r\n}\r\n\r\n/**\r\n * ScreenshotCheckbox Click event handler. Populate preview if checkbox is checked \r\n * @param screenshotCheckboxId The Id of screenshot checkbox\r\n * @param screenshotPreviewId The Id of preview\r\n * @param event The Event object\r\n */\r\nfunction ScreenshotCheckboxClickHandler(screenshotCheckboxId: string, screenshotPreviewId: string): (event: Event) => void {\r\n\treturn function (event: Event) {\r\n\t\tUiUtils.ScreenshotPreviewByCheckbox(screenshotCheckboxId, screenshotPreviewId);\r\n\t};\r\n}\r\n\r\n/**\r\n * Cancel button event handler factory\r\n */\r\nfunction CancelButtonHandler(): void {\r\n\tdismissAll();\r\n}\r\n\r\nfunction emailCheckBoxHandler(event: Event): void {\r\n\t// show email if checked and show default string if unchecked\r\n\tlet emailCheckBox: HTMLInputElement = <HTMLInputElement> document.getElementById(IDs.EmailCheckBox);\r\n\tif (emailCheckBox) {\r\n\t\t// multiFeedback form emailTextBox has id  IDs.BasicFormEmailInput\r\n\t\t// singleFeedback form emailTextBox has id IDs.SingleFormEmailInput\r\n\t\t// First we try to get with IDs.SingleFormEmailInput\r\n\t\t// if it does not exists, which means this is a multiFeedback form, then we get it with IDs.BasicFormEmailInput\r\n\t\tlet emailTextBox: HTMLInputElement = <HTMLInputElement> document.getElementById(IDs.SingleFormEmailInput);\r\n\t\tif (!emailTextBox) {\r\n\t\t\temailTextBox = <HTMLInputElement> document.getElementById(IDs.BasicFormEmailInput);\r\n\t\t}\r\n\t\temailTextBox.value = emailCheckBox.checked ? Configuration.get().getCommonInitOptions().userEmail : null;\r\n\t\temailTextBox.disabled = !emailCheckBox.checked;\r\n\t}\r\n}\r\n\r\nfunction basicFormInputHandler(event: Event): void {\r\n\tlet commentElement: HTMLTextAreaElement = <HTMLTextAreaElement> document.getElementById(IDs.BasicFormComment);\r\n\tlet commentEntered: boolean = (commentElement && !!commentElement.value);\r\n\t(document.getElementById(IDs.BasicFormSubmitButton) as HTMLButtonElement).disabled = !commentEntered;\r\n}\r\n\r\nfunction singleFormInputHandler(event: Event): void {\r\n\tlet commentElement: HTMLTextAreaElement = <HTMLTextAreaElement> document.getElementById(IDs.SingleFormComment);\r\n\tlet commentEntered: boolean = (commentElement && !!commentElement.value);\r\n\t(document.getElementById(IDs.SingleFormSubmitButton) as HTMLButtonElement).disabled = !commentEntered;\r\n}\r\n","/**\r\n * FormTemplateType.ts\r\n *\r\n * An enum for the types of forms available.\r\n */\r\n\r\nexport enum FormTemplateType {\r\n\tSingle = 0,\r\n\tBasic = 1,\r\n\tFeedbackPortalIdea = 2,\r\n}\r\n","/**\r\n * CategoriesDropdown.ts\r\n *\r\n * A module to render the categories dropdown\r\n */\r\n\r\nimport * as UIStrings from \"./../UIStrings/UIStrings\";\r\nimport { Tags }  from \"./UiConstants\";\r\nimport { IUIAsJson } from \"./Renderer\";\r\n\r\n/**\r\n * Generate custom categories drop-down list. The list will contain just the\r\n * placeholder string if customCategories contains no value.\r\n * @param customCategories category values\r\n */\r\nexport function generate(customCategories: string[]): IUIAsJson[] {\r\n\tlet categories = customCategories ? customCategories : [];\r\n\r\n\tlet result: IUIAsJson[] = [{\r\n\t\tattributes: [{ name: \"selected\", value: \"true\" }],\r\n\t\tinnerText: UIStrings.getUIStrings().Form.CategoryPlaceholder,\r\n\t\ttag: Tags.Option,\r\n\t}];\r\n\r\n\tfor (let category of categories) {\r\n\t\tresult.push({\r\n\t\t\tinnerText: category,\r\n\t\t\ttag: Tags.Option,\r\n\t\t});\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n","/**\r\n * RatingControl.ts\r\n *\r\n * A module for a rating control.\r\n */\r\n\r\nimport { AttributeName, Classes, Tags } from \"./UiConstants\";\r\nimport * as Renderer from \"./Renderer\";\r\n\r\nlet starId: string = \"obf-star\";\r\n\r\nlet starDefinition: Renderer.IUIAsJson = {\r\n\tchildren: [\r\n\t\t{\r\n\t\t\tattributes: [\r\n\t\t\t\t{ name: AttributeName.Id, value: starId },\r\n\t\t\t\t{ name: AttributeName.X, value: \"0\" },\r\n\t\t\t\t{ name: AttributeName.Y, value: \"0\" },\r\n\t\t\t\t{ name: AttributeName.Width, value: \"105\" },\r\n\t\t\t\t{ name: AttributeName.Height, value: \"100\" },\r\n\t\t\t\t{\r\n\t\t\t\t\tname: AttributeName.Points,\r\n\t\t\t\t\tvalue: \"52.5, 80.3 84, 100 76.3, 63 105, 38 67.2, 35 52.5, 0 37.8, 35 0, 38 28.7, 63 20, 100 52.5, 80.3\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\tid: starId,\r\n\t\t\ttag: Tags.Polygon,\r\n\t\t},\r\n\t],\r\n\ttag: Tags.Defs,\r\n};\r\n\r\nlet firstStar: Renderer.IUIAsJson = {\r\n\tattributes: [{ name: AttributeName.xlinkHref, value: `#${starId}` }],\r\n\ttag: Tags.Use,\r\n};\r\n\r\nlet secondStar: Renderer.IUIAsJson = {\r\n\tattributes: [\r\n\t\t{ name: AttributeName.xlinkHref, value: `#${starId}` },\r\n\t\t{ name: AttributeName.Transform, value: \"translate(105 0)\" },\r\n\t],\r\n\ttag: Tags.Use,\r\n};\r\n\r\nlet thirdStar: Renderer.IUIAsJson = {\r\n\tattributes: [\r\n\t\t{ name: AttributeName.xlinkHref, value: `#${starId}` },\r\n\t\t{ name: AttributeName.Transform, value: \"translate(210 0)\" },\r\n\t],\r\n\ttag: Tags.Use,\r\n};\r\n\r\nlet fourthStar: Renderer.IUIAsJson = {\r\n\tattributes: [\r\n\t\t{ name: AttributeName.xlinkHref, value: `#${starId}` },\r\n\t\t{ name: AttributeName.Transform, value: \"translate(315 0)\" },\r\n\t],\r\n\ttag: Tags.Use,\r\n};\r\n\r\nlet fifthStar: Renderer.IUIAsJson = {\r\n\tattributes: [\r\n\t\t{ name: AttributeName.xlinkHref, value: `#${starId}` },\r\n\t\t{ name: AttributeName.Transform, value: \"translate(420 0)\" },\r\n\t],\r\n\ttag: Tags.Use,\r\n};\r\n\r\nlet emptyStars: Renderer.IUIAsJson = {\r\n\tattributes: [{ name: AttributeName.ViewBox, value: \"0 0 525 100\" }],\r\n\tchildren: [starDefinition, firstStar, secondStar, thirdStar, fourthStar, fifthStar],\r\n\tclasses: [Classes.RatingGraphic],\r\n\ttag: Tags.Svg,\r\n};\r\n\r\nlet oneFilledStar: Renderer.IUIAsJson = {\r\n\tattributes: [{ name: AttributeName.ViewBox, value: \"0 0 105 100\" }],\r\n\tchildren: [starDefinition, firstStar],\r\n\tclasses: [Classes.RatingGraphic, Classes.RatingGraphicFilled],\r\n\ttag: Tags.Svg,\r\n};\r\n\r\nlet twoFilledStar: Renderer.IUIAsJson = {\r\n\tattributes: [{ name: AttributeName.ViewBox, value: \"0 0 210 100\" }],\r\n\tchildren: [starDefinition, firstStar, secondStar],\r\n\tclasses: [Classes.RatingGraphic, Classes.RatingGraphicFilled],\r\n\ttag: Tags.Svg,\r\n};\r\n\r\nlet threeFilledStar: Renderer.IUIAsJson = {\r\n\tattributes: [{ name: AttributeName.ViewBox, value: \"0 0 315 100\" }],\r\n\tchildren: [starDefinition, firstStar, secondStar, thirdStar],\r\n\tclasses: [Classes.RatingGraphic, Classes.RatingGraphicFilled],\r\n\ttag: Tags.Svg,\r\n};\r\n\r\nlet fourFilledStar: Renderer.IUIAsJson = {\r\n\tattributes: [{ name: AttributeName.ViewBox, value: \"0 0 420 100\" }],\r\n\tchildren: [starDefinition, firstStar, secondStar, thirdStar, fourthStar],\r\n\tclasses: [Classes.RatingGraphic, Classes.RatingGraphicFilled],\r\n\ttag: Tags.Svg,\r\n};\r\n\r\nlet fiveFilledStar: Renderer.IUIAsJson = {\r\n\tattributes: [{ name: AttributeName.ViewBox, value: \"0 0 525 100\" }],\r\n\tchildren: [starDefinition, firstStar, secondStar, thirdStar, fourthStar, fifthStar],\r\n\tclasses: [Classes.RatingGraphic, Classes.RatingGraphicFilled],\r\n\ttag: Tags.Svg,\r\n};\r\n\r\nexport function generate(id: string): Renderer.IUIAsJson {\r\n\treturn {\r\n\t\tchildren: [\r\n\t\t\temptyStars,\r\n\t\t\t{\r\n\t\t\t\tattributes: [\r\n\t\t\t\t\t{ name: AttributeName.Type, value: \"radio\" },\r\n\t\t\t\t\t{ name: AttributeName.Name, value: id },\r\n\t\t\t\t\t{ name: AttributeName.Value, value: \"1\" },\r\n\t\t\t\t],\r\n\t\t\t\ttag: Tags.Input,\r\n\t\t\t},\r\n\t\t\toneFilledStar,\r\n\t\t\t{\r\n\t\t\t\tattributes: [\r\n\t\t\t\t\t{ name: AttributeName.Type, value: \"radio\" },\r\n\t\t\t\t\t{ name: AttributeName.Name, value: id },\r\n\t\t\t\t\t{ name: AttributeName.Value, value: \"2\" },\r\n\t\t\t\t],\r\n\t\t\t\ttag: Tags.Input,\r\n\t\t\t},\r\n\t\t\ttwoFilledStar,\r\n\t\t\t{\r\n\t\t\t\tattributes: [\r\n\t\t\t\t\t{ name: AttributeName.Type, value: \"radio\" },\r\n\t\t\t\t\t{ name: AttributeName.Name, value: id },\r\n\t\t\t\t\t{ name: AttributeName.Value, value: \"3\" },\r\n\t\t\t\t],\r\n\t\t\t\ttag: Tags.Input,\r\n\t\t\t},\r\n\t\t\tthreeFilledStar,\r\n\t\t\t{\r\n\t\t\t\tattributes: [\r\n\t\t\t\t\t{ name: AttributeName.Type, value: \"radio\" },\r\n\t\t\t\t\t{ name: AttributeName.Name, value: id },\r\n\t\t\t\t\t{ name: AttributeName.Value, value: \"4\" },\r\n\t\t\t\t],\r\n\t\t\t\ttag: Tags.Input,\r\n\t\t\t},\r\n\t\t\tfourFilledStar,\r\n\t\t\t{\r\n\t\t\t\tattributes: [\r\n\t\t\t\t\t{ name: AttributeName.Type, value: \"radio\" },\r\n\t\t\t\t\t{ name: AttributeName.Name, value: id },\r\n\t\t\t\t\t{ name: AttributeName.Value, value: \"5\" },\r\n\t\t\t\t],\r\n\t\t\t\ttag: Tags.Input,\r\n\t\t\t},\r\n\t\t\tfiveFilledStar,\r\n\t\t],\r\n\t\tclasses: [Classes.Rating],\r\n\t\tid: id,\r\n\t\ttag: Tags.Span,\r\n\t};\r\n}\r\n","/**\r\n * BasicFormTemplate.ts\r\n *\r\n * A form template with contact info fields.\r\n */\r\n\r\nimport * as UIStrings from \"./../../../UIStrings/UIStrings\";\r\nimport { FormTemplateType } from \"./FormTemplateType\";\r\nimport { IUIAsJson } from \"./../../Renderer\";\r\nimport * as CategoriesDropdown from \"./../../CategoriesDropdown\";\r\nimport * as RatingControl from \"./../../RatingControl\";\r\nimport * as Configuration from \"./../../../Configuration/Configuration\";\r\nimport { FeedbackType, OCPSValues } from \"./../../../Constants\";\r\nimport { AttributeName, AttributeValue, Classes, IDs, Tags, Urls } from \"./../../UiConstants\";\r\n\r\n/**\r\n * Generate the markup\r\n * @returns the markup as json\r\n */\r\nexport function generate(): IUIAsJson {\r\n\tlet categories = Configuration.get().getInAppFeedbackLaunchOptions().categories;\r\n\tlet formSchema = {\r\n\t\tchildren: [\r\n\t\t\t{\r\n\t\t\t\tattributes: [{ name: AttributeName.For, value: IDs.BasicFormComment }],\r\n\t\t\t\tclasses: [Classes.FontSubtitle, Classes.TextAlignLeft, Classes.FormQuestionMiddleText],\r\n\t\t\t\tid: IDs.BasicFormQuestionMiddleText,\r\n\t\t\t\ttag: Tags.Label,\r\n\t\t\t\tinnerText: !Configuration.get().getInAppFeedbackInitOptions().transitionEnabled\r\n\t\t\t\t\t? UIStrings.getUIStrings().SingleForm.Title\r\n\t\t\t\t\t: \"\",\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tattributes: [{ name: AttributeName.Id, value: IDs.BasicFormCategoriesDropdown },\r\n\t\t\t\t{ name: AttributeName.AriaLabel, value: UIStrings.getUIStrings().Form.CategoryPlaceholder }],\r\n\t\t\t\tbrs: categories.show,\r\n\t\t\t\tchildren: CategoriesDropdown.generate(categories ? categories.customCategories : null),\r\n\t\t\t\tclasses: [Classes.FontSubText, Classes.FormCategoriesDropdown, Classes.TextInput],\r\n\t\t\t\ttag: Tags.Select,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tattributes: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: AttributeName.Placeholder,\r\n\t\t\t\t\t\tvalue: UIStrings.getUIStrings().Form.CommentPlaceholder,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: AttributeName.MaxLength,\r\n\t\t\t\t\t\tvalue: AttributeValue.TextAreaMaxLength,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FontSubText, Classes.FormComment, Classes.TextInput],\r\n\t\t\t\tid: IDs.BasicFormComment,\r\n\t\t\t\ttag: Tags.TextArea,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tbrs: false, // disable rating for now\r\n\t\t\t\tchildren: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [{ name: AttributeName.For, value: IDs.BasicFormRating }],\r\n\t\t\t\t\t\tclasses: [Classes.FontText, Classes.TextAlignLeft, Classes.FormRatingLabel],\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.RatingLabel,\r\n\t\t\t\t\t\ttag: Tags.Label,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tRatingControl.generate(IDs.BasicFormRating),\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FormRatingContainer],\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tbrs: isEmailEnabled(),\r\n\t\t\t\tchildren: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Type,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.Checkbox,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeValue.Unchecked,\r\n\t\t\t\t\t\t\t\tvalue: \"\",\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tclasses: [Classes.FormEmailCheckBox, Classes.CheckBox],\r\n\t\t\t\t\t\tid: IDs.EmailCheckBox,\r\n\t\t\t\t\t\ttag: Tags.Input,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [{ name: AttributeName.For, value: IDs.EmailCheckBox }],\r\n\t\t\t\t\t\tclasses: [Classes.FontSubText, Classes.TextAlignLeft, Classes.FormEmailLabel],\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.EmailCheckBoxLabel,\r\n\t\t\t\t\t\ttag: Tags.Label,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Type,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.Text,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Placeholder,\r\n\t\t\t\t\t\t\t\tvalue: UIStrings.getUIStrings().Form.EmailPlaceholder,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.AriaLabel,\r\n\t\t\t\t\t\t\t\tvalue: UIStrings.getUIStrings().Form.EmailPlaceholder,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Name,\r\n\t\t\t\t\t\t\t\tvalue: IDs.BasicFormEmailInput,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.MaxLength,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.TextAreaMaxLength,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Value,\r\n\t\t\t\t\t\t\t\tvalue:\r\n\t\t\t\t\t\t\t\t\tConfiguration.get().getInAppFeedbackInitOptions().userEmail\r\n\t\t\t\t\t\t\t\t\t\t? Configuration.get().getInAppFeedbackInitOptions().userEmail\r\n\t\t\t\t\t\t\t\t\t\t: \"\",\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tclasses: [Classes.FontSubText, Classes.FormEmailInput, Classes.TextInput],\r\n\t\t\t\t\t\tid: IDs.BasicFormEmailInput,\r\n\t\t\t\t\t\ttag: Tags.Input,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FormEmailContainer],\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tchildren: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Type,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.Checkbox,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Value,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.Unchecked,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tbrs: isScreenshotEnabled(),\r\n\t\t\t\t\t\tclasses: [Classes.FormScreenshotCheckbox, Classes.CheckBox],\r\n\t\t\t\t\t\tid: IDs.BasicFormScreenshotCheckbox,\r\n\t\t\t\t\t\ttag: Tags.Input,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [{ name: AttributeName.For, value: IDs.BasicFormScreenshotCheckbox }],\r\n\t\t\t\t\t\tbrs: isScreenshotEnabled(),\r\n\t\t\t\t\t\tclasses: [Classes.FontSubText, Classes.TextAlignLeft, Classes.FormScreenshotLabel],\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.ScreenshotLabel,\r\n\t\t\t\t\t\ttag: Tags.Label,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Preview,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.ScreenshotPreview,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Alt,\r\n\t\t\t\t\t\t\t\tvalue: UIStrings.getUIStrings().Form.ScreenshotImgAltText,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tbrs: Configuration.get().getInAppFeedbackInitOptions().screenshot,\r\n\t\t\t\t\t\tid: IDs.BasicFormScreenshotPreview,\r\n\t\t\t\t\t\tclasses: [Classes.FormScreenshotPreview],\r\n\t\t\t\t\t\ttag: Tags.Img,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FormScreenshotContainer],\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tchildren:\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tclasses: [Classes.FontSubSubText, Classes.TextAlignLeft],\r\n\t\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.PrivacyLabel,\r\n\t\t\t\t\t\t\ttag: Tags.Label,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tclasses: [Classes.FontSubSubText, Classes.TextAlignLeft],\r\n\t\t\t\t\t\t\tinnerText: Configuration.get().getCommonInitOptions().isCommercialHost\r\n\t\t\t\t\t\t\t\t? UIStrings.getUIStrings().Form.PrivacyConsent + \" \" : \"\",\r\n\t\t\t\t\t\t\ttag: Tags.Label,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: AttributeName.HRef,\r\n\t\t\t\t\t\t\t\t\tvalue: Urls.PrivacyStatementLink,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: AttributeName.Target,\r\n\t\t\t\t\t\t\t\t\tvalue: AttributeValue.BlankWindow,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: AttributeName.Rel,\r\n\t\t\t\t\t\t\t\t\tvalue: AttributeValue.NoReferrer,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tclasses: [Classes.Link],\r\n\t\t\t\t\t\t\tid: IDs.PrivacyStatementLink,\r\n\t\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().PrivacyStatement,\r\n\t\t\t\t\t\t\ttag: Tags.Anchor,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FontSubSubText, Classes.TextAlignLeft, Classes.PrivacyStatementLinkDiv],\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tchildren: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{ name: AttributeName.Type, value: AttributeValue.Button },\r\n\t\t\t\t\t\t\t{ name: AttributeName.AriaLabel, value: UIStrings.getUIStrings().Form.Cancel },\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tclasses: [\r\n\t\t\t\t\t\t\tClasses.CancelButton,\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tid: IDs.BasicFormCancelButton,\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.Cancel,\r\n\t\t\t\t\t\ttag: Tags.Button,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Disabled,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.True,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tclasses: [\r\n\t\t\t\t\t\t\tClasses.SubmitButton,\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tid: IDs.BasicFormSubmitButton,\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.Submit,\r\n\t\t\t\t\t\ttag: Tags.Button,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tclasses: [Classes.Spinner, Classes.Hidden],\r\n\t\t\t\t\t\tid: IDs.BasicFormSubmitButtonSpinner,\r\n\t\t\t\t\t\ttag: Tags.Div,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FormSubmitButtonContainer],\r\n\t\t\t},\r\n\t\t],\r\n\t\tclasses: [\r\n\t\t\tConfiguration.get().getInAppFeedbackInitOptions().transitionEnabled ? Classes.Hidden : Classes.Visible,\r\n\t\t\tClasses.MarginLeft60px,\r\n\t\t],\r\n\t\tid: containerId,\r\n\t};\r\n\treturn formSchema;\r\n}\r\n\r\n/**\r\n * The id for the container. This is the id of the top-most element and should\r\n * be unique to each form\r\n */\r\nexport let containerId: string = IDs.BasicFormContainer;\r\n\r\n/**\r\n * Forms may be used for different feedback types. This method executes form\r\n * specific logic when the feedback type is selected\r\n * @param feedbackType feedback type\r\n */\r\nexport function onSelect(feedbackType: FeedbackType): void {\r\n\tswitch (feedbackType) {\r\n\t\tcase FeedbackType.Smile: {\r\n\t\t\tdocument.getElementById(IDs.BasicFormQuestionMiddleText).textContent = UIStrings.getUIStrings().SmileForm.Title;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase FeedbackType.Frown: {\r\n\t\t\tdocument.getElementById(IDs.BasicFormQuestionMiddleText).textContent = UIStrings.getUIStrings().FrownForm.Title;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase FeedbackType.Idea: {\r\n\t\t\tdocument.getElementById(IDs.BasicFormQuestionMiddleText).textContent = UIStrings.getUIStrings().IdeaForm.Title;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase FeedbackType.Bug: {\r\n\t\t\tdocument.getElementById(IDs.BasicFormQuestionMiddleText).textContent = UIStrings.getUIStrings().BugForm.Title;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tdefault: {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tdocument.getElementById(IDs.BasicFormComment).focus();\r\n}\r\n\r\nexport function isEmailEnabled() {\r\n\tif (!Configuration.get().getInAppFeedbackInitOptions().showEmailAddress) {\r\n\t\treturn false;\r\n\t}\r\n\tif (Configuration.get().getCommonInitOptions().isCommercialHost) {\r\n\t\treturn Configuration.get().getCommonInitOptions().emailPolicyValue === OCPSValues.Enabled;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nexport function isScreenshotEnabled() {\r\n\tif (!Configuration.get().getInAppFeedbackInitOptions().screenshot) {\r\n\t\treturn false;\r\n\t}\r\n\tif (Configuration.get().getCommonInitOptions().isCommercialHost) {\r\n\t\treturn Configuration.get().getCommonInitOptions().screenshotPolicyValue === OCPSValues.Enabled;\r\n\t}\r\n\treturn true;\r\n}\r\n/**\r\n * Form template type\r\n */\r\nexport let type: FormTemplateType = FormTemplateType.Basic;\r\n","/**\r\n * SingleFormTemplate.ts\r\n *\r\n * A form template with contact info fields.\r\n */\r\n\r\nimport * as UIStrings from \"./../../../UIStrings/UIStrings\";\r\nimport { FormTemplateType } from \"./FormTemplateType\";\r\nimport { IUIAsJson } from \"./../../Renderer\";\r\nimport * as CategoriesDropdown from \"./../../CategoriesDropdown\";\r\nimport * as RatingControl from \"./../../RatingControl\";\r\nimport * as Configuration from \"./../../../Configuration/Configuration\";\r\nimport { FeedbackType } from \"./../../../Constants\";\r\nimport { AttributeName, AttributeValue, Classes, IDs, Tags, Urls } from \"./../../UiConstants\";\r\nimport * as BasicForm from \"./BasicFormTemplate\";\r\n\r\n/**\r\n * Generate the markup\r\n * @returns the markup as json\r\n */\r\nexport function generate(): IUIAsJson {\r\n\tlet categories = Configuration.get().getInAppFeedbackLaunchOptions().categories;\r\n\r\n\tlet formSchema = {\r\n\t\tchildren: [\r\n\t\t\t{\r\n\t\t\t\tattributes: [{ name: AttributeName.For, value: IDs.SingleFormComment }],\r\n\t\t\t\tclasses: [\r\n\t\t\t\t\tClasses.FontSubtitle,\r\n\t\t\t\t\tClasses.TextAlignLeft,\r\n\t\t\t\t\tClasses.FormQuestionMiddleText,\r\n\t\t\t\t],\r\n\t\t\t\tid: IDs.SingleFormQuestionMiddleText,\r\n\t\t\t\tinnerText: UIStrings.getUIStrings().SingleForm.Title,\r\n\t\t\t\ttag: Tags.Label,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tattributes: [{ name: AttributeName.Id, value: IDs.SingleFormCategoriesDropdown }],\r\n\t\t\t\tbrs: categories.show,\r\n\t\t\t\tchildren: CategoriesDropdown.generate(categories ? categories.customCategories : null),\r\n\t\t\t\tclasses: [Classes.FontSubText, Classes.FormCategoriesDropdown, Classes.TextInput],\r\n\t\t\t\ttag: Tags.Select,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tattributes: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: AttributeName.Placeholder,\r\n\t\t\t\t\t\tvalue: UIStrings.getUIStrings().Form.CommentPlaceholder,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: AttributeName.MaxLength,\r\n\t\t\t\t\t\tvalue: AttributeValue.TextAreaMaxLength,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FontSubText, Classes.FormComment, Classes.TextInput],\r\n\t\t\t\tid: IDs.SingleFormComment,\r\n\t\t\t\ttag: Tags.TextArea,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tbrs: false, // ratings are disabled for now\r\n\t\t\t\tchildren: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [{ name: AttributeName.For, value: IDs.SingleFormRating }],\r\n\t\t\t\t\t\tclasses: [\r\n\t\t\t\t\t\t\tClasses.FontSubText,\r\n\t\t\t\t\t\t\tClasses.TextAlignLeft,\r\n\t\t\t\t\t\t\tClasses.FormRatingLabel,\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.RatingLabel,\r\n\t\t\t\t\t\ttag: Tags.Label,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tRatingControl.generate(IDs.SingleFormRating),\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FormRatingContainer],\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tbrs: BasicForm.isEmailEnabled(),\r\n\t\t\t\tchildren: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Type,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.Checkbox,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeValue.Unchecked,\r\n\t\t\t\t\t\t\t\tvalue: \"\",\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tclasses: [Classes.FormEmailCheckBox, Classes.CheckBox],\r\n\t\t\t\t\t\tid: IDs.EmailCheckBox,\r\n\t\t\t\t\t\ttag: Tags.Input,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [{ name: AttributeName.For, value: IDs.EmailCheckBox }],\r\n\t\t\t\t\t\tclasses: [Classes.FontSubText, Classes.TextAlignLeft, Classes.FormEmailLabel],\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.EmailCheckBoxLabel,\r\n\t\t\t\t\t\ttag: Tags.Label,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Type,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.Text,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Placeholder,\r\n\t\t\t\t\t\t\t\tvalue: UIStrings.getUIStrings().Form.EmailPlaceholder,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.AriaLabel,\r\n\t\t\t\t\t\t\t\tvalue: UIStrings.getUIStrings().Form.EmailPlaceholder,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Name,\r\n\t\t\t\t\t\t\t\tvalue: IDs.SingleFormEmailInput,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.MaxLength,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.TextAreaMaxLength,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Value,\r\n\t\t\t\t\t\t\t\tvalue:\r\n\t\t\t\t\t\t\t\t\tConfiguration.get().getInAppFeedbackInitOptions().userEmail\r\n\t\t\t\t\t\t\t\t\t? Configuration.get().getInAppFeedbackInitOptions().userEmail\r\n\t\t\t\t\t\t\t\t\t: \"\",\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tclasses: [Classes.FontSubText, Classes.FormEmailInput, Classes.TextInput],\r\n\t\t\t\t\t\tid: IDs.SingleFormEmailInput,\r\n\t\t\t\t\t\ttag: Tags.Input,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FormEmailContainer],\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tchildren: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Type,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.Checkbox,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Value,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.Unchecked,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tbrs: BasicForm.isScreenshotEnabled(),\r\n\t\t\t\t\t\tclasses: [Classes.FormScreenshotCheckbox, Classes.CheckBox],\r\n\t\t\t\t\t\tid: IDs.SingleFormScreenshotCheckbox,\r\n\t\t\t\t\t\ttag: Tags.Input,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [{ name: AttributeName.For, value: IDs.SingleFormScreenshotCheckbox }],\r\n\t\t\t\t\t\tbrs: BasicForm.isScreenshotEnabled(),\r\n\t\t\t\t\t\tclasses: [Classes.FontText, Classes.TextAlignLeft, Classes.FormScreenshotLabel],\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.ScreenshotLabel,\r\n\t\t\t\t\t\ttag: Tags.Label,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Preview,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.ScreenshotPreview,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tbrs: Configuration.get().getInAppFeedbackInitOptions().screenshot,\r\n\t\t\t\t\t\tid: IDs.SingleFormScreenshotPreview,\r\n\t\t\t\t\t\tclasses: [Classes.FormScreenshotPreview],\r\n\t\t\t\t\t\ttag: Tags.Img,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FormScreenshotContainer],\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tchildren:\r\n\t\t\t\t[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tclasses: [Classes.FontSubSubText, Classes.TextAlignLeft],\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.PrivacyLabel,\r\n\t\t\t\t\t\ttag: Tags.Label,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tclasses: [Classes.FontSubSubText, Classes.TextAlignLeft],\r\n\t\t\t\t\t\tinnerText: Configuration.get().getCommonInitOptions().isCommercialHost\r\n\t\t\t\t\t\t? UIStrings.getUIStrings().Form.PrivacyConsent + \" \" : \"\",\r\n\t\t\t\t\t\ttag: Tags.Label,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.HRef,\r\n\t\t\t\t\t\t\t\tvalue: Urls.PrivacyStatementLink,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Target,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.BlankWindow,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Rel,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.NoReferrer,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tclasses: [Classes.Link],\r\n\t\t\t\t\t\tid: IDs.PrivacyStatementLink,\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().PrivacyStatement,\r\n\t\t\t\t\t\ttag: Tags.Anchor,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FontSubSubText, Classes.TextAlignLeft, Classes.PrivacyStatementLinkDiv],\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tchildren: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{ name: AttributeName.Type, value: AttributeValue.Button},\r\n\t\t\t\t\t\t\t{ name: AttributeName.AriaLabel, value: UIStrings.getUIStrings().Form.Cancel },\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tclasses: [\r\n\t\t\t\t\t\t\tClasses.CancelButton,\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tid: IDs.SingleFormCancelButton,\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.Cancel,\r\n\t\t\t\t\t\ttag: Tags.Button,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: AttributeName.Disabled,\r\n\t\t\t\t\t\t\t\tvalue: AttributeValue.True,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tclasses: [Classes.SubmitButton],\r\n\t\t\t\t\t\tid: IDs.SingleFormSubmitButton,\r\n\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().Form.Submit,\r\n\t\t\t\t\t\ttag: Tags.Button,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tclasses: [Classes.Spinner, Classes.Hidden],\r\n\t\t\t\t\t\tid: IDs.SingleFormSubmitButtonSpinner,\r\n\t\t\t\t\t\ttag: Tags.Div,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Classes.FormSubmitButtonContainer],\r\n\t\t\t},\r\n\t\t],\r\n\t\tid: containerId,\r\n\t};\r\n\treturn formSchema;\r\n}\r\n\r\n/**\r\n * The id for the container. This is the id of the top-most element and should\r\n * be unique to each form\r\n */\r\nexport let containerId: string = IDs.SingleFormContainer;\r\n\r\n/**\r\n * Forms may be used for different feedback types. This method executes form\r\n * specific logic when the feedback type is selected\r\n * @param feedbackType feedback type\r\n */\r\nexport function onSelect(feedbackType: FeedbackType): void {\r\n\tdocument.getElementById(IDs.SingleFormComment).focus();\r\n}\r\n\r\n/**\r\n * Form template type\r\n */\r\nexport let type: FormTemplateType = FormTemplateType.Single;\r\n","/**\r\n * Layout.ts\r\n *\r\n * Module for the layout\r\n */\r\n\r\nimport { IFormTemplate } from \"./FormTemplates/IFormTemplate\";\r\nimport { FeedbackType } from \"./../../Constants\";\r\nimport { AttributeName, AttributeValue, Classes, IDs, Tags } from \"./../UiConstants\";\r\nimport * as Renderer from \"./../Renderer\";\r\nimport * as UIStrings from \"./../../UIStrings/UIStrings\";\r\nimport * as Utils from \"./../Utils\";\r\nimport * as SingleFormTemplate from \"./FormTemplates/SingleFormTemplate\";\r\nimport { IPanelTemplate } from \"./PanelTemplates/IPanelTemplate\";\r\nimport { IUIAsJson } from \"./../Renderer\";\r\nimport * as Configuration from \"./../../Configuration/Configuration\";\r\n\r\nexport {IFormTemplate} from \"./FormTemplates/IFormTemplate\";\r\n\r\n/**\r\n * Generates the multi layout as a Renderer.IUIAsJson object\r\n *\r\n * The TabFocus.ts has a dependency in the mainContainer. All tabbable elements\r\n * should be placed inside the mainContainer otherwise TabFocus.ts will not\r\n * function as expected.\r\n * @param {[key: number]: IFormTemplate} formTemplates FeedbackType -> FormTemplate mapping\r\n * @param {[key: number]: IPanelTemplate} panelTemplates PanelType -> PanelTemplate mapping\r\n * @returns {Renderer.IUIAsJson} Renderer.IUIAsJson object\r\n */\r\nexport function generateMulti(\r\n\tformTemplates: { [key: number]: IFormTemplate },\r\n\tpanelTemplates: { [key: number]: IPanelTemplate }\r\n): Renderer.IUIAsJson {\r\n\tlet schema: Renderer.IUIAsJson = {\r\n\t\tattributes: [{ name: AttributeName.DataHtml2CanvasIgnore, value: AttributeValue.True }],\r\n\t\tchildren:\r\n\t\t[\r\n\t\t\t{\r\n\t\t\t\tattributes:\r\n\t\t\t\t[\r\n\t\t\t\t\t{ name: AttributeName.Role, value: AttributeValue.Dialog },\r\n\t\t\t\t\t{ name: AttributeName.AriaModal, value: AttributeValue.True },\r\n\t\t\t\t],\r\n\t\t\t\tchildren:\r\n\t\t\t\t[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes:\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t{ name: AttributeName.Role, value: AttributeValue.TabList },\r\n\t\t\t\t\t\t\t{ name: AttributeName.AriaDescribedBy, value: IDs.QuestionLeftText },\r\n\t\t\t\t\t\t\t{ name: AttributeName.AriaLabel, value: UIStrings.getUIStrings().FeedbackSubtitle },\r\n\t\t\t\t\t\t\t{ name: AttributeName.AriaOrientation, value: AttributeValue.AriaOrientationValueVertical},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tchildren:\r\n\t\t\t\t\t\t[\r\n\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t// This adds a \"first\" dummy tabbable div to the mainContainer. It's used as a marker\r\n\t\t\t\t\t\t\t\t// to handle tabs and shift tabs so focus will stay with elements on just the feedback\r\n\t\t\t\t\t\t\t\t// dialog. Do not relocate this without updating the TabFocus.ts code.\r\n\t\t\t\t\t\t\t\tattributes: [{ name: AttributeName.TabIndex, value: AttributeValue.Zero }],\r\n\t\t\t\t\t\t\t\tid: IDs.FirstTabbable,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t\t\t{ name: AttributeName.Type, value: AttributeValue.Button },\r\n\t\t\t\t\t\t\t\t\t{ name: AttributeName.AriaLabel, value: UIStrings.getUIStrings().CloseLabel },\r\n\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\tid: IDs.CloseButton,\r\n\t\t\t\t\t\t\t\tclasses: [Classes.CloseButton],\r\n\t\t\t\t\t\t\t\t// tslint:disable-next-line:max-line-length\r\n\t\t\t\t\t\t\t\tinnerHTML: '<svg viewBox=\"4 4 16 16\" width=\"16px\" height=\"16px\" focusable=\"false\"><path d=\"M19,6.41L17.59,5 12,10.59 6.41,5 5,6.41 10.59,12 5,17.59 6.41,19 12,13.41 17.59,19 19,17.59 13.41,12z\"/></svg>',\r\n\t\t\t\t\t\t\t\ttag: Tags.Button,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tchildren:\r\n\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tclasses: [Classes.FormWideContainer, Classes.Hidden],\r\n\t\t\t\t\t\t\t\t\t\tchildren: generateMultiPanels(panelTemplates),\r\n\t\t\t\t\t\t\t\t\t\tid: IDs.LeftPanelContainer,\r\n\t\t\t\t\t\t\t\t\t\ttag: Tags.Div,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tchildren:\r\n\t\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tclasses: [Classes.FontSubtitle, Classes.TextAlignLeft],\r\n\t\t\t\t\t\t\t\t\t\t\t\tid: IDs.QuestionLeftText,\r\n\t\t\t\t\t\t\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().FeedbackSubtitle,\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tchildren:\r\n\t\t\t\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: generateOverallAnchors(formTemplates),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: IDs.OverallAnchorsContainer,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\t\t\tid: IDs.ColumnSeparatorDiv,\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\tclasses: [Classes.FormContainer],\r\n\t\t\t\t\t\t\t\t\t\tid: IDs.LeftFormContainer,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tchildren: generateMultiForms(formTemplates),\r\n\t\t\t\t\t\t\t\t\t\tclasses:\r\n\t\t\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t\t\tClasses.FormContainer,\r\n\t\t\t\t\t\t\t\t\t\t\t\tConfiguration.get().getInAppFeedbackInitOptions().transitionEnabled ? Classes.Hidden : Classes.Visible,\r\n\t\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\tattributes:\r\n\t\t\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t\t\t{ name: AttributeName.Role, value: AttributeValue.TabPanel},\r\n\t\t\t\t\t\t\t\t\t\t\t\t{ name: AttributeName.AriaExpanded, value: AttributeValue.False},\r\n\t\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\tid: IDs.MiddleFormContainer,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\tclasses: [Classes.Hidden],\r\n\t\t\t\t\t\t\t\tid: IDs.MainContentHolder,\r\n\t\t\t\t\t\t\t\ttag: Tags.Form,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t// This adds a \"last\" dummy tabbable div to the mainContainer. It's used as a marker\r\n\t\t\t\t\t\t\t\t// to handle tabs and shift tabs so focus will stay with elements on just the feedback\r\n\t\t\t\t\t\t\t\t// dialog. Do not relocate this without updating the TabFocus.ts code.\r\n\t\t\t\t\t\t\t\tattributes: [{ name: AttributeName.TabIndex, value: AttributeValue.Zero }],\r\n\t\t\t\t\t\t\t\tid: IDs.LastTabbable,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tid: IDs.MainContainer,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tclasses: [Utils.isRightToLeft() ? Classes.Rtl : \"\" ],\r\n\t\t\t\tid: IDs.OverlayBackground,\r\n\t\t\t},\r\n\t\t],\r\n\t};\r\n\treturn schema;\r\n}\r\n\r\n/**\r\n * Generates the single layout as a Renderer.IUIAsJson object\r\n *\r\n * The TabFocus.ts has a dependency in the mainContainer. All tabbable elements\r\n * should be placed inside the mainContainer otherwise TabFocus.ts will not\r\n * function as expected.\r\n * @param {[key: number]: IPanelTemplate} panelTemplates PanelType -> PanelTemplate mapping\r\n * @returns {Renderer.IUIAsJson} Renderer.IUIAsJson object\r\n */\r\nexport function generateSingle(panelTemplates: { [key: number]: IPanelTemplate }): Renderer.IUIAsJson {\r\n\tlet schema: Renderer.IUIAsJson = {\r\n\t\tattributes: [{ name: AttributeName.DataHtml2CanvasIgnore, value: AttributeValue.True }],\r\n\t\tchildren:\r\n\t\t[\r\n\t\t\t{\r\n\t\t\t\tchildren:\r\n\t\t\t\t[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// This adds a \"first\" dummy tabbable div to the mainContainer. It's used as a marker\r\n\t\t\t\t\t\t// to handle tabs and shift tabs so focus will stay with elements on just the feedback\r\n\t\t\t\t\t\t// dialog. Do not relocate this without updating the TabFocus.ts code.\r\n\t\t\t\t\t\tattributes: [{ name: AttributeName.TabIndex, value: AttributeValue.Zero }],\r\n\t\t\t\t\t\tid: IDs.FirstTabbable,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{ name: AttributeName.Type, value: AttributeValue.Button },\r\n\t\t\t\t\t\t\t{ name: AttributeName.AriaLabel, value: UIStrings.getUIStrings().CloseLabel },\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tid: IDs.CloseButton,\r\n\t\t\t\t\t\tclasses: [Classes.CloseButton],\r\n\t\t\t\t\t\t// tslint:disable-next-line:max-line-length\r\n\t\t\t\t\t\tinnerHTML: '<svg viewBox=\"4 4 16 16\" width=\"16px\" height=\"16px\" focusable=\"false\"><path d=\"M19,6.41L17.59,5 12,10.59 6.41,5 5,6.41 10.59,12 5,17.59 6.41,19 12,13.41 17.59,19 19,17.59 13.41,12z\"/></svg>',\r\n\t\t\t\t\t\ttag: Tags.Button,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tchildren:\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tchildren: [SingleFormTemplate.generate()],\r\n\t\t\t\t\t\t\t\tclasses: [Classes.FormContainer],\r\n\t\t\t\t\t\t\t\tid: IDs.MiddleFormContainer,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t].concat((generateMultiPanels(panelTemplates) as\r\n\t\t\t\t\t\t\tConcatArray<{ children: IUIAsJson[], classes: string[], id: string }>)),\r\n\t\t\t\t\t\tclasses: [Classes.Hidden],\r\n\t\t\t\t\t\tid: IDs.MainContentHolder,\r\n\t\t\t\t\t\ttag: Tags.Form,\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// This adds a \"last\" dummy tabbable div to the mainContainer. It's used as a marker\r\n\t\t\t\t\t\t// to handle tabs and shift tabs so focus will stay with elements on just the feedback\r\n\t\t\t\t\t\t// dialog. Do not relocate this without updating the TabFocus.ts code.\r\n\t\t\t\t\t\tattributes: [{ name: AttributeName.TabIndex, value: AttributeValue.Zero }],\r\n\t\t\t\t\t\tid: IDs.LastTabbable,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tid: IDs.MainContainer,\r\n\t\t\t},\r\n\t\t],\r\n\t\tclasses: [Classes.SingleLayout, Utils.isRightToLeft() ? Classes.Rtl : \"\" ],\r\n\t\tid: IDs.OverlayBackground,\r\n\t};\r\n\treturn schema;\r\n}\r\n\r\n/**\r\n * Generate Renderer.IUIAsJson objects that holds the different forms that will be used on the bellyband.\r\n * This is used to generate just one form of each one of the templates that are actually going to be used.\r\n * @param {[key: number]: IFormTemplate} formTemplates FeedbackType -> FormTemplate mapping\r\n * @returns {Renderer.IUIAsJson} Renderer.IUIAsJson object\r\n */\r\nfunction generateMultiForms(formTemplates: { [key: number]: IFormTemplate }): Renderer.IUIAsJson[] {\r\n\tlet wrapper: Renderer.IUIAsJson = {\r\n\t\tchildren: [],\r\n\t};\r\n\r\n\tlet pushedContainers: { [key: string]: boolean } = {};\r\n\r\n\tfor (let feedbackType in formTemplates) {\r\n\t\tif (formTemplates.hasOwnProperty(feedbackType)) {\r\n\t\t\tlet notExists: boolean = !(formTemplates[feedbackType].containerId in pushedContainers);\r\n\t\t\tif (notExists) {\r\n\t\t\t\twrapper.children.push(formTemplates[feedbackType].generate());\r\n\t\t\t\tpushedContainers[formTemplates[feedbackType].containerId] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn wrapper.children;\r\n}\r\n\r\n/**\r\n * Generate Renderer.IUIAsJson objects that holds the different forms that will be used on the bellyband.\r\n * This is used to generate just one form of each one of the templates that are actually going to be used.\r\n * @param {[key: number]: IFormTemplate} formTemplates FeedbackType -> FormTemplate mapping\r\n * @returns {Renderer.IUIAsJson} Renderer.IUIAsJson object\r\n */\r\nfunction generateMultiPanels(panelTemplates: { [key: number]: IPanelTemplate }): Renderer.IUIAsJson[] {\r\n\tlet wrapper: Renderer.IUIAsJson = {\r\n\t\tchildren: [],\r\n\t};\r\n\r\n\tlet pushedContainers: { [key: string]: boolean } = {};\r\n\r\n\tfor (let panelType in panelTemplates) {\r\n\t\tif (panelTemplates.hasOwnProperty(panelType)) {\r\n\t\t\tlet notExists: boolean = !(panelTemplates[panelType].containerId in pushedContainers);\r\n\t\t\tif (notExists) {\r\n\t\t\t\twrapper.children.push(panelTemplates[panelType].generate());\r\n\t\t\t\tpushedContainers[panelTemplates[panelType].containerId] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn wrapper.children;\r\n}\r\n\r\n/**\r\n * Generates Renderer.IUIAsJson object that holds the different anchors that will be used on the bellyband.\r\n * @param {[key: number]: IFormTemplate} formTemplates FeedbackType -> FormTemplate mapping\r\n * @returns {Renderer.IUIAsJson} Renderer.IUIAsJson object\r\n */\r\nfunction generateOverallAnchors(formTemplates: { [key: number]: IFormTemplate }): Renderer.IUIAsJson[] {\r\n\tlet wrapper: Renderer.IUIAsJson = {\r\n\t\tchildren: [],\r\n\t};\r\n\r\n\tif (FeedbackType.Smile in formTemplates) {\r\n\t\twrapper.children.push(generateOverallAnchor(IDs.OverallSmileAnchor, IDs.OverallSmileImage,\r\n\t\t\t// The svg code for the image\r\n\t\t\t// tslint:disable-next-line:max-line-length\r\n\t\t\t'<svg viewBox=\"0 0 72 72\" width=\"24px\" height=\"24px\" focusable=\"false\"><path d=\"M36 1C16.7 1 1 16.7 1 36s15.7 35 35 35c19.3 0 35-15.7 35-35S55.3 1 36 1ZM49.3 18.3c2.3 0 4.2 2.7 4.2 6 0 3.3-1.9 6-4.2 6 -2.3 0-4.2-2.7-4.2-6C45.1 21 47 18.3 49.3 18.3ZM22.9 18.3c2.3 0 4.2 2.7 4.2 6 0 3.3-1.9 6-4.2 6 -2.3 0-4.2-2.7-4.2-6C18.7 21 20.6 18.3 22.9 18.3ZM36 58.6c-8.5 0-16-4.1-20.9-10.4l3.5-3.6c3.5 4.5 9.9 7.6 17.4 7.6 7.4 0 13.9-3.1 17.4-7.6l3.6 3.6C52.1 54.4 44.4 58.6 36 58.6Z\"/></svg>',\r\n\t\t\tIDs.OverallSmileText, UIStrings.getUIStrings().SmileForm.Anchor));\r\n\t}\r\n\r\n\tif (FeedbackType.Frown in formTemplates) {\r\n\t\twrapper.children.push(generateOverallAnchor(IDs.OverallFrownAnchor, IDs.OverallFrownImage,\r\n\t\t\t// The svg code for the image\r\n\t\t\t// tslint:disable-next-line:max-line-length\r\n\t\t\t'<svg viewBox=\"0 0 72 72\" width=\"24px\" height=\"24px\" focusable=\"false\"><path d=\"M36 1C16.7 1 1 16.7 1 36s15.7 35 35 35c19.3 0 35-15.7 35-35S55.3 1 36 1ZM49.3 18.3c2.3 0 4.2 2.7 4.2 6 0 3.3-1.9 6-4.2 6 -2.3 0-4.2-2.7-4.2-6C45.1 21 47 18.3 49.3 18.3ZM22.9 18.3c2.3 0 4.2 2.7 4.2 6 0 3.3-1.9 6-4.2 6 -2.3 0-4.2-2.7-4.2-6C18.7 21 20.6 18.3 22.9 18.3ZM52.8 57.9c-3.3-4.4-9.6-7.3-16.7-7.3 -7.2 0-13.4 3-16.7 7.3l-3.4-3.4c4.7-6.1 11.9-10 20.1-10 8.2 0 15.5 4 20.2 10L52.8 57.9Z\"/></svg>',\r\n\t\t\tIDs.OverallFrownText, UIStrings.getUIStrings().FrownForm.Anchor));\r\n\t}\r\n\r\n\tif (FeedbackType.IdeaRedirect in formTemplates) {\r\n\t\twrapper.children.push(generateOverallAnchor(IDs.OverallFeedbackPortalIdeaAnchor, IDs.OverallIdeaImage,\r\n\t\t\t// The svg code for the image\r\n\t\t\t// tslint:disable-next-line:max-line-length\r\n\t\t\t'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" focusable=\"false\" viewBox=\"0,0,2048,2048\"><path fill=\"#FAFAFA\" fill-opacity=\"1.000\" d=\"M 213 1920 v -546 l 275 -649 h 1072 l 275 649 v 546 z\" /><path fill=\"#3A3A38\" fill-opacity=\"1.000\" d=\"M 1877 1365 v 598 h -1706 v -598 l 289 -682 h 288 l -41 41 l 44 44 h -239 l -248 597 h 1520 l -221 -532 l 63 -62 m 166 680 h -1536 v 426 h 1536 z\" /><path fill=\"#FAFAFA\" fill-opacity=\"1.000\" d=\"M 1049 1067 l -342 -343 l 664 -664 l 482 483 l -523 524 z\" /><path fill=\"#797774\" fill-opacity=\"1.000\" d=\"M 1536 649 l -271 -272 l 60 -60 l 272 271 m -211 212 l -272 -272 l 60 -60 l 272 271 m -211 211 l -272 -271 l 61 -61 l 271 272 z\" /><path fill=\"#1E8BCD\" fill-opacity=\"1.000\" d=\"M 989 1067 l -343 -343 l 725 -724 l 543 543 l -524 524 h -121 l 524 -524 l -422 -422 l -604 603 l 343 343 z\" /><path fill=\"#3A3A38\" fill-opacity=\"1.000\" d=\"M 1451 1109 h -854 v -85 h 854 z\" /></svg>',\r\n\t\t\tIDs.OverallIdeaText, UIStrings.getUIStrings().IdeaForm.Anchor));\r\n\t}\r\n\r\n\tif (FeedbackType.Idea in formTemplates) {\r\n\t\twrapper.children.push(generateOverallAnchor(IDs.OverallIdeaAnchor, IDs.OverallIdeaImage,\r\n\t\t\t// The svg code for the image\r\n\t\t\t// tslint:disable-next-line:max-line-length\r\n\t\t\t'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" focusable=\"false\" viewBox=\"0,0,2048,2048\"><path fill=\"#FAFAFA\" fill-opacity=\"1.000\" d=\"M 213 1920 v -546 l 275 -649 h 1072 l 275 649 v 546 z\" /><path fill=\"#3A3A38\" fill-opacity=\"1.000\" d=\"M 1877 1365 v 598 h -1706 v -598 l 289 -682 h 288 l -41 41 l 44 44 h -239 l -248 597 h 1520 l -221 -532 l 63 -62 m 166 680 h -1536 v 426 h 1536 z\" /><path fill=\"#FAFAFA\" fill-opacity=\"1.000\" d=\"M 1049 1067 l -342 -343 l 664 -664 l 482 483 l -523 524 z\" /><path fill=\"#797774\" fill-opacity=\"1.000\" d=\"M 1536 649 l -271 -272 l 60 -60 l 272 271 m -211 212 l -272 -272 l 60 -60 l 272 271 m -211 211 l -272 -271 l 61 -61 l 271 272 z\" /><path fill=\"#1E8BCD\" fill-opacity=\"1.000\" d=\"M 989 1067 l -343 -343 l 725 -724 l 543 543 l -524 524 h -121 l 524 -524 l -422 -422 l -604 603 l 343 343 z\" /><path fill=\"#3A3A38\" fill-opacity=\"1.000\" d=\"M 1451 1109 h -854 v -85 h 854 z\" /></svg>',\r\n\t\t\tIDs.OverallIdeaText, UIStrings.getUIStrings().IdeaForm.Anchor));\r\n\t}\r\n\r\n\tif (FeedbackType.Bug in formTemplates) {\r\n\t\twrapper.children.push(generateOverallAnchor(IDs.OverallBugAnchor, IDs.OverallBugImage,\r\n\t\t\t// The svg code for the image\r\n\t\t\t// tslint:disable-next-line:max-line-length\r\n\t\t\t'<svg viewBox=\"150 100 1748 1748\" width=\"24px\" height=\"24px\" focusable=\"false\"><path d=\"M1824 1088q0 26-19 45t-45 19h-224q0 171-67 290l208 209q19 19 19 45t-19 45q-18 19-45 19t-45-19l-198-197q-5 5-15 13t-42 28.5-65 36.5-82 29-97 13v-896h-128v896q-51 0-101.5-13.5t-87-33-66-39-43.5-32.5l-15-14-183 207q-20 21-48 21-24 0-43-16-19-18-20.5-44.5t15.5-46.5l202-227q-58-114-58-274h-224q-26 0-45-19t-19-45 19-45 45-19h224v-294l-173-173q-19-19-19-45t19-45 45-19 45 19l173 173h844l173-173q19-19 45-19t45 19 19 45-19 45l-173 173v294h224q26 0 45 19t19 45zm-480-576h-640q0-133 93.5-226.5t226.5-93.5 226.5 93.5 93.5 226.5z\"/></svg>',\r\n\t\t\tIDs.OverallBugText, UIStrings.getUIStrings().BugForm.Anchor));\r\n\t}\r\n\r\n\treturn wrapper.children;\r\n}\r\n\r\n/**\r\n * Generates a Renderer.IUIAsJson object that holds an anchor that will be used on the bellyband.\r\n * @param overallAnchorID the overall anchor id\r\n * @param overallImageID the image id\r\n * @param imageClass the image class (icon)\r\n * @param overallTextID the id for text box\r\n * @param uiString the string to display\r\n */\r\nfunction generateOverallAnchor(\r\n\toverallAnchorID: string, overallImageID: string, svgImage: string,\r\n\toverallTextID: string, uiString: string): Renderer.IUIAsJson {\r\n\treturn {\r\n\t\tattributes:\r\n\t\t[\r\n\t\t\t{ name: AttributeName.Type, value: AttributeValue.Button },\r\n\t\t\t{ name: AttributeName.Role, value: AttributeValue.Tab },\r\n\t\t\t{ name: AttributeName.AriaLabel, value: uiString },\r\n\t\t\t{ name: AttributeName.AriaSelected, value: AttributeValue.False },\r\n\t\t],\r\n\t\tchildren:\r\n\t\t[\r\n\t\t\t{\r\n\t\t\t\tclasses: [Classes.OverallImage],\r\n\t\t\t\tid: overallImageID,\r\n\t\t\t\tinnerHTML: svgImage,\r\n\t\t\t\ttag: Tags.Div,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tclasses: [Classes.FontSubtitle, Classes.OverallText],\r\n\t\t\t\tid: overallTextID,\r\n\t\t\t\tinnerText: uiString,\r\n\t\t\t},\r\n\t\t],\r\n\t\tclasses: [Classes.OverallAnchor, Classes.TextAlignLeft],\r\n\t\tid: overallAnchorID,\r\n\t\ttag: Tags.Button,\r\n\t};\r\n}\r\n","/* eslint @microsoft/sdl/no-inner-html: \"off\" */\r\n\r\n/**\r\n * Renderer.ts\r\n *\r\n * Module for rendering the markup\r\n */\r\n\r\nimport { AttributeName, Tags } from \"./UiConstants\";\r\n\r\n/**\r\n * Interface for an attribute\r\n */\r\nexport interface IAttribute {\r\n\tname: string;\r\n\tvalue: string;\r\n}\r\n\r\n/**\r\n * Interface for UI(HTML markup) as json\r\n */\r\nexport interface IUIAsJson {\r\n\tid?: string;\r\n\ttag?: string; // div by default\r\n\tclasses?: string[]; // CSS class\r\n\tattributes?: IAttribute[];\r\n\tchildren?: IUIAsJson[];\r\n\tinnerText?: string;\r\n\tinnerHTML?: string;\r\n\tbrs?: any; // should the element and its children be created? true by default\r\n}\r\n\r\n/**\r\n * Create DOM elements from Json structure\r\n * @param {UiAsJson} schema The Json structure\r\n * @param {boolean} svg Create svg element instead of html?\r\n * @return {HTMLElement} HTML elements with tree structure\r\n */\r\nexport function elementFromJson(schema: IUIAsJson, svg?: boolean): Element {\r\n\tif (typeof schema.brs === \"undefined\") {\r\n\t\tschema.brs = true;\r\n\t}\r\n\r\n\tif (!schema.brs) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif (!schema.tag) {\r\n\t\tschema.tag = Tags.Div;\r\n\t}\r\n\r\n\tlet element: Element;\r\n\r\n\tif (schema.tag === Tags.Svg) {\r\n\t\tsvg = true;\r\n\t}\r\n\r\n\tif (svg) {\r\n\t\telement = document.createElementNS(\"http://www.w3.org/2000/svg\", schema.tag);\r\n\t} else {\r\n\t\telement = document.createElement(schema.tag);\r\n\t}\r\n\r\n\tif (schema.attributes) {\r\n\t\tlet attribute: IAttribute;\r\n\t\tfor (let i = 0; i < schema.attributes.length; i++) {\r\n\t\t\tattribute = schema.attributes[i];\r\n\t\t\tif (attribute.name === AttributeName.xlinkHref) {\r\n\t\t\t\telement.setAttributeNS(\"http://www.w3.org/1999/xlink\", AttributeName.HRef, attribute.value);\r\n\t\t\t} else {\r\n\t\t\t\telement.setAttribute(attribute.name, attribute.value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (schema.id) {\r\n\t\telement.id = schema.id;\r\n\t}\r\n\r\n\tif (schema.classes) {\r\n\t\tlet concatClasses: string = schema.classes.join(\" \");\r\n\t\tif (svg) {\r\n\t\t\telement.setAttribute(AttributeName.Class, concatClasses);\r\n\t\t} else {\r\n\t\t\telement.className = concatClasses;\r\n\t\t}\r\n\t}\r\n\r\n\tif (schema.innerText && !svg) {\r\n\t\telement.textContent = schema.innerText;\r\n\t}\r\n\r\n\tif (schema.innerHTML && !svg) {\r\n\t\telement.innerHTML = schema.innerHTML;\r\n\t}\r\n\r\n\tif (schema.children) {\r\n\t\tfor (let i = 0; i < schema.children.length; i++) {\r\n\t\t\t// Sometimes IE mis-reports length\r\n\t\t\tlet cur: IUIAsJson = schema.children[i];\r\n\r\n\t\t\tif (cur) {\r\n\t\t\t\tlet child: Element = elementFromJson(cur, svg);\r\n\r\n\t\t\t\tif (child) {\r\n\t\t\t\t\telement.appendChild(child);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn element;\r\n}\r\n","/**\r\n * ThanksPanelTemplate.ts\r\n *\r\n * A panel rendering a Thank you-message.\r\n */\r\n\r\nimport * as UIStrings from \"./../../../UIStrings/UIStrings\";\r\nimport { IUIAsJson } from \"./../../Renderer\";\r\nimport * as Configuration from \"./../../../Configuration/Configuration\";\r\nimport { PanelType } from \"./../../../Constants\";\r\nimport { IDs, Tags, Classes, Roles } from \"../../UiConstants\";\r\nimport { PanelTemplateType } from \"./PanelTemplateType\";\r\nimport * as IInitOptions from \"./../../../Configuration/IInitOptions\";\r\n\r\n/**\r\n * Function to create a Link Url\r\n * @param url to which the click will be redireced\r\n * @param text display text\r\n * @returns HTML Link with clickable Text based on URL  provided\r\n */\r\nfunction makeLinkText(url: string, text: string): string {\r\n\treturn `<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"${url}\">${text}</a>`;\r\n}\r\n\r\n/**\r\n * Function to create Thank you Page paragraph\r\n * Based on the init parameters, the paragraph is constructed in HTML view which is rendred in innerHTML tag of UIasJSON function.\r\n */\r\nfunction GetThankYouPageText(): string {\r\n\r\n\t// Add a page break to make the paragraph readable\r\n\tlet thankYouPageText: string = `${UIStrings.getUIStrings().ThanksPanel?.AppreciateText}<br><br>`;\r\n\r\n\t// if the age Group is not defined or adult , then only show the link\r\n\tconst ageGroupEnabledForFeedbackUrls: boolean = (Configuration.get().getCommonInitOptions().ageGroup === IInitOptions.AgeGroup.Undefined\r\n\t\t|| Configuration.get().getCommonInitOptions().ageGroup === IInitOptions.AgeGroup.Adult) ? true : false;\r\n\r\n\t// First check if the age group is enabled\r\n\tif (ageGroupEnabledForFeedbackUrls) {\r\n\r\n\t\t// if the My Feedback Portal is enable by the consumer product(office-wac/mso)\r\n\t\tif (!!Configuration.get().getInAppFeedbackInitOptions().myFeedbackForumUrl) {\r\n\t\t\tconst MyFeedbackString = `${UIStrings.getUIStrings().ThanksPanel?.MyFeedbackDescription}\r\n\t\t\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t\t\t${makeLinkText(Configuration.get().getInAppFeedbackInitOptions().myFeedbackForumUrl,\r\n\t\t\t\tUIStrings.getUIStrings().ThanksPanel?.MyFeedbackLinkText)}\r\n\t\t\t\t\t\t\t\t<br><br>`;\r\n\t\t\tthankYouPageText = `${thankYouPageText} ${MyFeedbackString}`;\r\n\t\t}\r\n\r\n\t\t// if the Feedback Forum Link is provided by the consumer product\r\n\t\tif (!!Configuration.get().getInAppFeedbackInitOptions().feedbackForumUrl) {\r\n\t\t\tconst FeedbackPortalText = `${UIStrings.getUIStrings().ThanksPanel?.FeedbackPortalDescription}\r\n\t\t\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t\t\t${makeLinkText(Configuration.get().getInAppFeedbackInitOptions().feedbackForumUrl,\r\n\t\t\t\tUIStrings.getUIStrings().ThanksPanel?.FeedbackPortalLinkText)}\r\n\t\t\t\t\t\t\t\t<br><br>`;\r\n\t\t\tthankYouPageText = `${thankYouPageText} ${FeedbackPortalText}`;\r\n\t\t}\r\n\t}\r\n\r\n\treturn thankYouPageText;\r\n}\r\n\r\n/**\r\n * Generate the markup\r\n * @returns the markup as json\r\n */\r\nexport function generate(): IUIAsJson {\r\n\tlet primaryColor = Configuration.get().getCommonInitOptions().primaryColour;\r\n\r\n\tlet formSchema = {\r\n\t\tchildren: [\r\n\t\t\t{\r\n\t\t\t\ttag: Tags.Div,\r\n\t\t\t\tid: IDs.ThanksPanelInnerContainer,\r\n\t\t\t\tchildren: [\r\n\t\t\t\t\t{\t// added to create margins before feedback image\r\n\t\t\t\t\t\tinnerHTML: \"<br>\",\r\n\t\t\t\t\t\ttag: Tags.Div,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tid: IDs.ThanksPanelDiscussion,\r\n\t\t\t\t\t\tinnerHTML: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 30.4 25.3\"\r\n\trole=\"presentation\" alt=\"\" tabindex=\"-1\" focusable=\"false\">\r\n\t<defs>\r\n\t\t<style>\r\n\t\t\t.cls-1,.cls-3{isolation:isolate;}\r\n\t\t\t.cls-2{fill:#e1dfdd;}\r\n\t\t\t.cls-3{fill:` + primaryColor + `;opacity:0.4;}\r\n\t\t\t.cls-4{fill:#c8c6c4;mix-blend-mode:multiply;}\r\n\t\t\t.cls-5{fill:#fff;}</style>\r\n\t</defs>\r\n\t<title>commentsOffice</title>\r\n\t<g class=\"cls-1\">\r\n\t\t<g id=\"Layer_1\" data-name=\"Layer 1\">\r\n\t\t\t<path class=\"cls-2\" d=\"M17.8,0H1.2A1.216,1.216,0,0,0,0,1.2V15.3a1.1554,1.1554,0,0,0,1.2,1.2H7l.1,\r\n\t\t\t\t4.1L10,16.5h7.9a1.1554,1.1554,0,0,0,1.2-1.2V1.2A1.305,1.305,0,0,0,17.8,0Z\"/>\r\n\t\t\t<path class=\"cls-3\" d=\"M28.5,10.8a6.0429,6.0429,0,0,0-3.2-2,7.1943,7.1943,0,0,0-6.4,1,7.4884,\r\n\t\t\t\t7.4884,0,0,0-3.1,5.7,6.016,6.016,0,0,0,.9,3.7,6.9394,6.9394,0,0,0,5,3.7l2.9,2.4L24.4,23a7.8372,\r\n\t\t\t\t7.8372,0,0,0,3-1.3,7.4574,7.4574,0,0,0,3-4.7A7.5076,7.5076,0,0,0,28.5,10.8Z\"/>\r\n\t\t\t<path id=\"Layer2_1_MEMBER_1_FILL\" data-name=\"Layer2 1 MEMBER 1 FILL\" class=\"cls-4\" d=\"M11.9885,\r\n\t\t\t\t8.0154a.8939.8939,0,1,0,.6371-.2589.8653.8653,0,0,0-.6371.2589M6.8115,9.24A.8977.8977,0,1,0,\r\n\t\t\t\t5.5532,7.9589.8977.8977,0,1,0,6.8115,9.24m3.2259-1.2412a.894.894,0,1,0,.2588.637A.8653.8653,\r\n\t\t\t\t0,0,0,10.0374,7.9983Z\"/>\r\n\t\t\t<path class=\"cls-5\" d=\"M20.9019,16.3243a.8008.8008,0,0,0,.2586-.5659.8371.8371,0,0,\r\n\t\t\t\t0-.21-.5919.7693.7693,0,0,0-1.1091-.05.8379.8379,0,0,0-.2627.5706.8012.8012,0,0,0,\r\n\t\t\t\t.2066.5869.77.77,0,0,0,1.1167.05m1.51-.51a.8014.8014,0,0,0,.2066.5874.7695.7695,0,0,0,\r\n\t\t\t\t1.1127.0541.8379.8379,0,0,0,.2627-.57.8009.8009,0,0,0-.2066-.5869.7694.7694,0,0,\r\n\t\t\t\t0-1.1167-.05.8011.8011,0,0,0-.2587.5663m2.8279.1272a.8371.8371,0,0,0,.21.5919.7693.7693,0,0,\r\n\t\t\t\t0,1.1091.05.8379.8379,0,0,0,.2627-.5706.8012.8012,0,0,0-.2066-.5869.77.77,0,0,\r\n\t\t\t\t0-1.1167-.05A.8008.8008,0,0,0,25.24,15.9416Z\"/>\r\n\t\t</g>\r\n\t</g>\r\n</svg>`,\r\n\t\t\t\t\t\ttag: Tags.Div,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tid: IDs.ThanksPanelVerticalContainer,\r\n\t\t\t\t\t\ttag: Tags.Div,\r\n\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tclasses: [\r\n\t\t\t\t\t\t\t\t\tClasses.FontTitle,\r\n\t\t\t\t\t\t\t\t\tClasses.TextAlignLeft,\r\n\t\t\t\t\t\t\t\t\tClasses.FormQuestionMiddleText,\r\n\t\t\t\t\t\t\t\t\tClasses.ThanksPanelTitle,\r\n\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().ThanksPanel?.Title,\r\n\t\t\t\t\t\t\t\ttag: Tags.Div,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tclasses: [\r\n\t\t\t\t\t\t\t\t\tClasses.FontSubText,\r\n\t\t\t\t\t\t\t\t\tClasses.TextAlignLeft,\r\n\t\t\t\t\t\t\t\t\tClasses.ThanksPanelMessage,\r\n\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t// changed from innerText to innerHTML for rendering clickable Links\r\n\t\t\t\t\t\t\t\tinnerHTML: GetThankYouPageText(),\r\n\t\t\t\t\t\t\t\ttag: Tags.Div,\r\n\t\t\t\t\t\t\t\tid: IDs.ThanksPanelParagraph,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tclasses: [\r\n\t\t\t\t\t\t\t\t\tClasses.SubmitButton,\r\n\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\tid: IDs.ThanksPanelCloseButton,\r\n\t\t\t\t\t\t\t\tinnerText: UIStrings.getUIStrings().ThanksPanel?.Close,\r\n\t\t\t\t\t\t\t\tariaLabel: UIStrings.getUIStrings().ThanksPanel?.Close,\r\n\t\t\t\t\t\t\t\ttag: Tags.Button,\r\n\t\t\t\t\t\t\t\trole: Roles.Button,\r\n\t\t\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tname: \"aria-label\",\r\n\t\t\t\t\t\t\t\t\t\tvalue: UIStrings.getUIStrings().ThanksPanel?.Title + \" \" +\r\n\t\t\t\t\t\t\t\t\t\t\tUIStrings.getUIStrings().ThanksPanel?.AppreciateText + \" \" +\r\n\t\t\t\t\t\t\t\t\t\t\tUIStrings.getUIStrings().ThanksPanel?.Close,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tname: \"type\",\r\n\t\t\t\t\t\t\t\t\t\tvalue: \"button\",\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\t// added to create margins after Close button\r\n\t\t\t\t\t\tinnerHTML: \"<br>\",\r\n\t\t\t\t\t\ttag: Tags.Div,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t},\r\n\t\t],\r\n\t\tclasses: [Classes.Hidden],\r\n\t\tid: containerId,\r\n\t};\r\n\treturn formSchema;\r\n}\r\n\r\n/**\r\n * The id for the container. This is the id of the top-most element and should\r\n * be unique to each form\r\n */\r\nexport let containerId: string = IDs.ThanksPanelContainer;\r\n\r\n/**\r\n * This method executes form\r\n * specific logic when the pane is opened\r\n * @param panelType panel type\r\n */\r\nexport function onSelect(panelType: PanelType): void {\r\n\tif (panelType !== PanelType.Thanks) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tdocument.getElementById(IDs.ThanksPanelCloseButton).focus();\r\n}\r\n\r\n/**\r\n * Form template type\r\n */\r\nexport let type: PanelTemplateType = PanelTemplateType.Thanks;\r\n","import { FeedbackType } from \"../../../Constants\";\r\nimport { IUIAsJson } from \"../../Renderer\";\r\nimport { IDs } from \"../../UiConstants\";\r\nimport { FormTemplateType } from \"./FormTemplateType\";\r\n\r\nexport function generate(): IUIAsJson {\r\n\treturn undefined;\r\n}\r\n\r\nexport let containerId: string = IDs.FeedbackPortalIdeaContainer;\r\n\r\nexport function onSelect(feedbackType: FeedbackType): void {\r\n\t    /* tslint:disable : no-empty */\r\n}\r\n\r\nexport let type: FormTemplateType = FormTemplateType.FeedbackPortalIdea;\r\n","/**\r\n * BellyBand.ts\r\n *\r\n * Module for the BellyBand UI\r\n */\r\n\r\nimport { FeedbackType, PanelType } from \"./../../Constants\";\r\nimport { Classes, IDs } from \"./../UiConstants\";\r\nimport * as Events from \"./Events\";\r\nimport * as Layout from \"./Layout\";\r\nimport * as Renderer from \"./../Renderer\";\r\nimport * as Utils from \"./../Utils\";\r\nimport * as WindowProperties from \"./../../WindowProperties\";\r\nimport { IFormTemplate } from \"./FormTemplates/IFormTemplate\";\r\nimport * as BasicFormTemplate from \"./FormTemplates/BasicFormTemplate\";\r\nimport * as ThanksPanelTemplate from \"./PanelTemplates/ThanksPanelTemplate\";\r\nimport * as FeedbackPortalIdeaTemplate from \"./FormTemplates/FeedbackPortalIdeaTemplate\";\r\nimport * as Configuration from \"./../../Configuration/Configuration\";\r\nimport { IPanelTemplate } from \"./PanelTemplates/IPanelTemplate\";\r\n\r\n/**\r\n * UI initialization for multi, including creating all feedback related HTML elements and setting\r\n * initial visibility of elements\r\n */\r\nexport function createMulti(onClose: () => void) {\r\n\t// Create the panelType -> IPanelTemplate mapping\r\n\tlet panelTemplates: { [key: number]: IPanelTemplate } = {};\r\n\tif (Configuration.get().getInAppFeedbackInitOptions().isShowThanks) {\r\n\t\tpanelTemplates[PanelType.Thanks] = ThanksPanelTemplate;\r\n\t}\r\n\r\n\t// Create the feedbackType -> IFormTemplate mapping\r\n\tlet formTemplates: {[key: number]: IFormTemplate} = {};\r\n\tlet transitionEnabled: boolean = Configuration.get().getInAppFeedbackInitOptions().transitionEnabled;\r\n\tformTemplates[FeedbackType.Smile] = BasicFormTemplate;\r\n\tformTemplates[FeedbackType.Frown] = BasicFormTemplate;\r\n\r\n\tif (Configuration.get().getInAppFeedbackInitOptions().feedbackForumUrl !== undefined) {\r\n\t\tformTemplates[FeedbackType.IdeaRedirect] = FeedbackPortalIdeaTemplate;\r\n\t} else {\r\n\t\tformTemplates[FeedbackType.Idea] = BasicFormTemplate;\r\n\t}\r\n\r\n\tif (Configuration.get().getInAppFeedbackInitOptions().bugForm) {\r\n\t\tformTemplates[FeedbackType.Bug] = BasicFormTemplate;\r\n\t}\r\n\r\n\tcreate(Renderer.elementFromJson(Layout.generateMulti(formTemplates, panelTemplates)));\r\n\r\n\tlet useNarrowScreenLayout = WindowProperties.isNarrow();\r\n\r\n\tEvents.registerMulti(\r\n\t\tformTemplates,\r\n\t\tpanelTemplates,\r\n\t\tuseNarrowScreenLayout,\r\n\t\ttransitionEnabled,\r\n\t\tfunction (submitted: boolean) {\r\n\t\t\tUtils.setElementVisibility(IDs.OverlayBackground, false);\r\n\t\t\tUtils.deleteElementById(IDs.OverlayBackground);\r\n\t\t\tConfiguration.get().getInAppFeedbackInitOptions().onDismiss(submitted);\r\n\t\t\tonClose();\r\n\t\t}\r\n\t);\r\n\r\n\t// If the screen size is narrow, add the Narrow class to the outermost div so that \r\n\t// the CSS used corresponds to the small screen UI\r\n\tif (useNarrowScreenLayout) {\r\n\t\tUtils.addClassById(IDs.OverlayBackground, Classes.NarrowLayout);\r\n\t}\r\n}\r\n\r\n/**\r\n * UI initialization for single, including creating all feedback related HTML elements and setting\r\n * initial visibility of elements\r\n * @return {void}\r\n */\r\nexport function createSingle(onClose: () => void, feedbackType: FeedbackType) {\r\n\t// Create the panelType -> IPanelTemplate mapping\r\n\tlet panelTemplates: { [key: number]: IPanelTemplate } = {};\r\n\tif (Configuration.get().getInAppFeedbackInitOptions().isShowThanks) {\r\n\t\tpanelTemplates[PanelType.Thanks] = ThanksPanelTemplate;\r\n\t}\r\n\r\n\tcreate(Renderer.elementFromJson(Layout.generateSingle(panelTemplates)));\r\n\r\n\tEvents.registerSingle(\r\n\t\tfeedbackType,\r\n\t\tpanelTemplates,\r\n\t\tfunction (submitted: boolean) {\r\n\t\t\tUtils.setElementVisibility(IDs.OverlayBackground, false);\r\n\t\t\tUtils.deleteElementById(IDs.OverlayBackground);\r\n\t\t\tConfiguration.get().getInAppFeedbackInitOptions().onDismiss(submitted);\r\n\t\t\tonClose();\r\n\t\t}\r\n\t);\r\n\r\n\tUtils.addClassById(IDs.OverlayBackground, Classes.SingleLayout);\r\n\tUtils.ScreenshotPreviewByCheckbox(IDs.SingleFormScreenshotCheckbox, IDs.SingleFormScreenshotPreview);\r\n}\r\n\r\n/**\r\n * Attach the UI element to the DOM.\r\n * @param userInterface the UI element\r\n */\r\nfunction create(userInterface: Element) {\r\n\tdocument.body.insertBefore(userInterface, document.body.firstChild);\r\n\r\n\tUtils.setElementVisibility(IDs.OverlayBackground, true);\r\n\r\n\tif (Utils.getInternetExplorerVersion() > 9 || Utils.getInternetExplorerVersion() === -1) {\r\n\t\t// Show the main feedback UI after a certain time to wait for the CSS keyframes animation to finish if \r\n\t\t// the browser is IE10 and above or non-IE\r\n\t\tsetTimeout(onMainContainerRender, 900);\r\n\t} else {\r\n\t\tonMainContainerRender();\r\n\t}\r\n}\r\n\r\n/**\r\n * Code to run when the main container animation has completed.\r\n */\r\nfunction onMainContainerRender(): void {\r\n\t// Show the MainContentHolder inside the MainContainer\r\n\tUtils.setElementVisibility(IDs.MainContentHolder, true);\r\n\tif (document.getElementById(IDs.OverallSmileAnchor)) {\r\n\t\t// Multi feedback\r\n\t\tdocument.getElementById(IDs.OverallSmileAnchor).focus();\r\n\r\n\t\t// If screenshot checkbox is selected, display the preview\r\n\t\tUtils.ScreenshotPreviewByCheckbox(IDs.BasicFormScreenshotCheckbox, IDs.BasicFormScreenshotPreview);\r\n\t} else if (document.getElementById(IDs.SingleFormComment)) {\r\n\t\t// Single feedback\r\n\t\tdocument.getElementById(IDs.SingleFormComment).focus();\r\n\r\n\t\t// If screenshot checkbox is selected, display the preview\r\n\t\tUtils.ScreenshotPreviewByCheckbox(IDs.SingleFormScreenshotCheckbox, IDs.SingleFormScreenshotPreview);\r\n\t}\r\n}\r\n\r\n/**\r\n * UI dismiss. Delete all feedback related HTML elements\r\n * @return {void}\r\n */\r\nexport function dismiss(): void {\r\n\treturn;\r\n}\r\n","/**\r\n * WindowProperties.ts\r\n *\r\n * Module to track window properties.\r\n */\r\n\r\n/**\r\n * Is the window narrow?\r\n * @returns True if it is, false otherwise\r\n */\r\nexport function isNarrow(): boolean {\r\n\tlet narrowScreenBoundary: number = 800;\r\n\r\n\tif (window.innerWidth) {\r\n\t\treturn window.innerWidth < narrowScreenBoundary;\r\n\t}\r\n\r\n\t// if we can't find the width; go with narrow.\r\n\treturn true;\r\n}\r\n","/**\r\n * App_inAppFeedback.ts\r\n *\r\n * The entry point for inAppFeedback.\r\n */\r\n\r\nimport * as CommonApp from \"./CommonApp\";\r\nimport * as CommonUI from \"./CommonUI\";\r\nimport * as Configuration from \"./Configuration/Configuration\";\r\nimport * as Logging from \"./Logging/Logging\";\r\nimport * as UI from \"./UI/BellyBand/BellyBand\";\r\nimport * as Window from \"./Window/Window\";\r\nimport { ILaunchOptionsInAppFeedback } from \"./Configuration/ILaunchOptions\";\r\nimport { OCPSValues, FeedbackStatus } from \"./Constants\";\r\n\r\n/**\r\n * Has inAppFeedback been initialized\r\n */\r\nlet initialized: boolean = false;\r\n\r\n/**\r\n * Initialize\r\n * @returns A promise which will be rejected if the call fails.\r\n */\r\nexport function initialize(): Promise<any> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tif (!initialized) {\r\n\t\t\ttry {\r\n\t\t\t\tCommonApp.initialize();\r\n\t\t\t} catch (err) {\r\n\t\t\t\treject(\"CommonApp initialization failed: {\" + err + \"}\");\r\n\t\t\t}\r\n\r\n\t\t\tCommonUI.initialize()\r\n\t\t\t.then(\r\n\t\t\t\tfunction onInitializeFulfilled() {\r\n\t\t\t\t\tConfiguration.get().setInAppFeedbackInitOptions(Window.get().OfficeBrowserFeedback.initOptions);\r\n\t\t\t\t\tinitialized = true;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t\t.catch(\r\n\t\t\t\tfunction onInitializeRejected(err) { reject(\"Initialization failed: {\" + err + \"}\"); }\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tresolve();\r\n\t\t}\r\n\t});\r\n}\r\n\r\n/**\r\n * Has the control been opened. Prevents more than one dialog being generated.\r\n */\r\nlet opened: boolean = false;\r\n\r\n/**\r\n * Handler to launch the multi feedback dialog\r\n * @param launchOptions optional feedback properties\r\n * @returns A promise which will be rejected if the call fails.\r\n */\r\nexport function multiFeedback(launchOptions?: ILaunchOptionsInAppFeedback): Promise<any> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tif (opened) {\r\n\t\t\treject(\"Control already open\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tinitialize()\r\n\t\t.then(\r\n\t\t\tfunction onInitializeFulfilled() {\r\n\t\t\t\tConfiguration.get().setInAppFeedbackLaunchOptions(launchOptions);\r\n\t\t\t\tUI.createMulti(function () { opened = false; });\r\n\t\t\t\tLogging.getLogger().logEvent(Logging.EventIds.InApp.UI.Picker.Shown.VALUE,\r\n\t\t\t\t\tLogging.LogLevel.Critical,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tIsBugEnabled: Configuration.get().getInAppFeedbackInitOptions().bugForm,\r\n\t\t\t\t\t});\r\n\t\t\t\topened = true;\r\n\t\t\t\tresolve();\r\n\t\t\t}\r\n\t\t)\r\n\t\t.catch(\r\n\t\t\tfunction onInitializeRejected(err) { reject(\"Initialization failed: {\" + err + \"}\"); }\r\n\t\t);\r\n\t});\r\n}\r\n\r\n/**\r\n * Handler to launch the single feedback dialog\r\n * @param feedbackType the feedback type\r\n * @param launchOptions optional feedback properties\r\n * @returns A promise which will be rejected if the call fails.\r\n */\r\nexport function singleFeedback(feedbackType: string, launchOptions?: ILaunchOptionsInAppFeedback): Promise<any> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tif (opened) {\r\n\t\t\treject(\"Control already open\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet feedbackTypeEnum = Configuration.validateFeedbackType(feedbackType);\r\n\r\n\t\tinitialize()\r\n\t\t.then(\r\n\t\t\tfunction onInitializeFulfilled() {\r\n\t\t\t\tConfiguration.get().setInAppFeedbackLaunchOptions(launchOptions);\r\n\t\t\t\tUI.createSingle(function () { opened = false; }, feedbackTypeEnum);\r\n\t\t\t\tLogging.getLogger().logEvent(Logging.EventIds.InApp.UI.Form.Shown.VALUE,\r\n\t\t\t\t\tLogging.LogLevel.Critical,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tFeedbackType: feedbackTypeEnum,\r\n\t\t\t\t\t});\r\n\t\t\t\topened = true;\r\n\t\t\t\tresolve();\r\n\t\t\t}\r\n\t\t)\r\n\t\t.catch(\r\n\t\t\tfunction onInitializeRejected(err) { reject(\"Initialization failed: {\" + err + \"}\"); }\r\n\t\t);\r\n\t});\r\n}\r\n\r\nexport function getFeedbackStatus(): FeedbackStatus {\r\n\r\n\tif (Window.get().OfficeBrowserFeedback.initOptions.isCommercialHost &&\r\n\tWindow.get().OfficeBrowserFeedback.initOptions.sendFeedbackPolicyValue === OCPSValues.Disabled) {\r\n\t\treturn FeedbackStatus.DisabledByAdmin;\r\n\t}\r\n\r\n\tif (!Configuration.get().determineAADCPolicy(Window.get().OfficeBrowserFeedback.initOptions.authenticationType,\r\n\tWindow.get().OfficeBrowserFeedback.initOptions.ageGroup)) {\r\n\t\treturn FeedbackStatus.DisabledByAgeGroup;\r\n\t}\r\n\r\n\treturn FeedbackStatus.Enabled;\r\n}\r\n\r\n/**\r\n * Reset the inappfeedback module. Used in unit tests.\r\n */\r\nexport function reset() {\r\n\tCommonApp.reset();\r\n\tCommonUI.reset();\r\n\tinitialized = false;\r\n\topened = false;\r\n}\r\n\r\n/* Make the FeedbackDialog methods available globally */\r\nWindow.setMultiFeedback(multiFeedback);\r\nWindow.setSingleFeedback(singleFeedback);\r\nWindow.setFeedbackStatus(getFeedbackStatus);\r\n"],"sourceRoot":""}